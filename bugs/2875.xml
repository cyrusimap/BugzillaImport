<?xml version="1.0" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugzilla.cyrusimap.org/bugzilla.dtd">

<bugzilla version="3.2.5.1-2"
          urlbase="https://bugzilla.cyrusimap.org/"
          maintainer="Dave McMurtrie &lt;dave64@andrew.cmu.edu&gt;"
>

    <bug>
          <bug_id>2875</bug_id>
          
          <creation_ts>2006-09-10 19:00 EDT</creation_ts>
          <short_desc>implementation for draft-ietf-imapext-list-extensions-17</short_desc>
          <delta_ts>2010-10-25 18:46:40 EDT</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Cyrus IMAP</product>
          <component>IMAP</component>
          <version>2.3.x</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>CLOSED</bug_status>
          <resolution>FIXED</resolution>
          
          
          
          
          <priority>P3</priority>
          <bug_severity>enhancement</bug_severity>
          <target_milestone>Future</target_milestone>
          
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Martin Konold">martin.konold@erfrakon.de</reporter>
          <assigned_to name="Ken Murchison">murch@andrew.cmu.edu</assigned_to>
          <cc>levin.fritz@konsec.com</cc>
          <qa_contact name="The Cyrus Bugzilla List">cyrus-bugzilla@lists.andrew.cmu.edu</qa_contact>

      

      

      
          <long_desc isprivate="0">
            <who name="Martin Konold">martin.konold@erfrakon.de</who>
            <bug_when>2006-09-10 19:00:35 EDT</bug_when>
            <thetext>As defined in 
http://www.ietf.org/internet-drafts/draft-ietf-imapext-list-extensions-17.txt 
we created a minimal invasive patch for the current cyrus imapd which 
implements the IMAP4 LIST Command Extensions.

The purpose of this patch is &quot;an extension to the base LIST command that will 
allow these additions to be done with mutually compatible options to the LIST 
command, avoiding the exponential increase in specialized list commands&quot;.

This patch adds the new capability LIST-EXTENDED additionally to the old 
LISTEXT capability to cyrus imapd. (--enable-list-extended configure switch)

In order to only compile the support for the old and already expired LISTEXT 
but not for the new capability LIST-EXTENDED the configure 
switch --enable-listext is provided.

It was decided to keep the expired LISTEXT capability in order not to 
unnecessarily removed functionality for some clients which know LISTEXT but not 
LIST-EXTENDED.</thetext>
          </long_desc>
          <long_desc isprivate="0">
            <who name="Martin Konold">martin.konold@erfrakon.de</who>
            <bug_when>2006-09-10 19:04:55 EDT</bug_when>
            <thetext>Created an attachment (id=458)
LIST-EXTENDED capability feature patch r50

Patch for implementing
http://www.ietf.org/internet-drafts/draft-ietf-imapext-list-extensions-17.txt

Mainly developed by Levin Fritz &lt;levin.fritz@konsec.com&gt;, Andreas Mack
&lt;andreas.mack@mediales.com&gt; and Martin Konold &lt;martin.konold@erfrakon.de&gt;.

This patch is against current CVS version. </thetext>
          </long_desc>
          <long_desc isprivate="0">
            <who name="Martin Konold">martin.konold@erfrakon.de</who>
            <bug_when>2006-09-10 19:17:50 EDT</bug_when>
            <thetext>Please review and consider it for inclusion. 

This patch is a prerequisite for the IMAP METADATA Extension as described in 
http://www.ietf.org/internet-drafts/draft-daboo-imap-annotatemore-09.txt.

The IMAP METADATA Extension allows for a clean implementation of server and 
mailbox annotations beyond the currently available limited ANNOTATEMORE 
capability.</thetext>
          </long_desc>
          <long_desc isprivate="0">
            <who name="Martin Konold">martin.konold@erfrakon.de</who>
            <bug_when>2006-09-18 12:34:37 EDT</bug_when>
            <thetext>Created an attachment (id=459)
Improve patch which fixes LIST &quot;&quot; &quot;*%&quot;
</thetext>
          </long_desc>
          <long_desc isprivate="0">
            <who name="Martin Konold">martin.konold@erfrakon.de</who>
            <bug_when>2006-09-18 12:36:23 EDT</bug_when>
            <thetext>Our test suite missed the LIST &quot;&quot; &quot;*%&quot; case as reported by Alexandros Vellis.</thetext>
          </long_desc>
          <long_desc isprivate="0">
            <who name="Ken Murchison">murch@andrew.cmu.edu</who>
            <bug_when>2006-09-25 14:56:03 EDT</bug_when>
            <thetext>I&apos;ve finally had some time to look over the patch and have a few comments.  Note
that I haven&apos;t done any testing to verify its correctness.

1.  I&apos;m only aware of one client which supports LISTEXT and this client also
supports LIST-EXTENDED.  Given this, and the fact that LISTEXT was a non-default
compile-time option, I don&apos;t see the need to keep LISTEXT around (at least not
as a separate code path).

2.  I don&apos;t see anywhere in draft -17 that RECURSIVEMATCH is optional and can
cause a NO response.  If I&apos;m mistaken, please point me to the text.

3.  It doesn&apos;t look like there is any code to suppress the same mailbox being
returned as a result of multiple mailbox patterns.  I think we could use a hash
table (probably one that supports multiple entries per hash value) to accumulate
the matching mailboxes/attributes and then issue the responses at the end rather
than on-the-fly.
</thetext>
          </long_desc>
          <long_desc isprivate="0">
            <who name="Martin Konold">martin.konold@erfrakon.de</who>
            <bug_when>2006-10-16 18:05:27 EDT</bug_when>
            <thetext>Created an attachment (id=471)
Patch for draft-ietf-imapext-list-extensions-18 r59

In the meantime draft-ietf-imapext-list-extensions-17 got obsoleted by
draft-ietf-imapext-list-extensions-18.

This new version of the patch offers

1st Only support --list-extended configure switch and only a single code path
though still supporting LISTEXT und LIST-EXTENDED. (removed configure switch
for deprecated LISTEXT)

2nd Support for LISTEXT will be entirely removed later (provided nobody
complains loudly)

3rd RECURSIVEMATCH is now implemented using a hash table if RECURSIVEMATCH is
part of the LIST command. The hash table overhead is avoided otherwise for
performance reasons. (We want to avoid the overhead of a hash table in the
common case which has no RECURSIVEMATCH. This basically means answering a LIST
command as soon and fast as possible while avoiding any memory overhead is
prefered.)

&gt; 3.  It doesn&apos;t look like there is any code to suppress the same mailbox being

&gt; returned as a result of multiple mailbox patterns.  I think we could use a
&gt; hash table (probably one that supports multiple entries per hash value) to
&gt; accumulate the matching mailboxes/attributes and then issue the responses at
&gt; the end rather than on-the-fly.

draft-ietf-imapext-list-extensions-18 reads &quot;If a mailbox name matches multiple
mailbox patterns from the list, the server SHOULD return only a single LIST
response.&quot;

So suppressing is a SHOULD not a MUST in the draft. Delaying the response
instead of answering on the fly will slow down the client-server communication.
I think that due to the fact that this is a SHOULD requirement the client
cannot rely on this anyway. If the client cannot rely on this it is better
from a scalability/performance point of view better to let the client do the
normalization if the client has a need/use for it.

In other words if it is a SHOULD and this capability cannot be determined by
the client it does not really help but adds extra overhead.

Ken: If you feel strong about this I will happily offer an implementation which
uses a hash to do the normalization though this means
- less memory efficient for the server O(n)
- more cpu usage
- less efficient use in of network bandwidth &lt;- this matters to some
applications
- client cannot rely on it anyway

As an additional alternativ I can offer to provide an implementation which is
optimized. This means we use the less efficient and imho not really useful hash
implementation only in the case of multiple patterns and use the fast and lean
non hash version for the simple and common case with only a single pattern.

Ken: Please decide</thetext>
          </long_desc>
          <long_desc isprivate="0">
            <who name="Ken Murchison">murch@andrew.cmu.edu</who>
            <bug_when>2006-10-19 07:48:44 EDT</bug_when>
            <thetext>Can you provide the patch as a unified diff?  They are much easier to read.</thetext>
          </long_desc>
          <long_desc isprivate="0">
            <who name="Martin Konold">martin.konold@erfrakon.de</who>
            <bug_when>2006-10-19 16:27:57 EDT</bug_when>
            <thetext>Created an attachment (id=472)
unifed diff version of the patch (imho more readable)
</thetext>
          </long_desc>
          <long_desc isprivate="0">
            <who name="Ken Murchison">murch@andrew.cmu.edu</who>
            <bug_when>2006-10-25 14:24:45 EDT</bug_when>
            <thetext>Created an attachment (id=473)
Ken&apos;s modified patch

Here&apos;s a modified version of your patch that removes the configure option and
the old LISTEXT stuff.	I reworked the code a little and fixed a few buglets. 
Please review and see if I&apos;ve totally messed it up.

I haven&apos;t thought about it too much, but we may get a performance bump for
RECURSIVEMATCH by replacing the hash_enumerate()+qsort() with code that creates
a sorted array or b-tree as we populate the hash table.

I also added a comment regarding LIST RETURN (SUBSCRIBED) when used in a
Murder.  Unless we&apos;re talking to a unified server, the output will have to be
compiled from a LIST on a frontend and a LIST (SUBSCRIBED) on the INBOX
backend.</thetext>
          </long_desc>
          <long_desc isprivate="0">
            <who name="Martin Konold">martin.konold@erfrakon.de</who>
            <bug_when>2006-11-06 14:46:26 EDT</bug_when>
            <thetext>&gt; Here&apos;s a modified version of your patch that removes the configure option and
&gt; the old LISTEXT stuff.  I reworked the code a little and fixed a few buglets. 
&gt; Please review and see if I&apos;ve totally messed it up.

I very much like it. Please apply and close the issue. I plan to provide an 
update in case the draft changes again. The plan is to follow the draft and 
drop any former semantics as long as the CAPABILITY string does not change.

&gt; I haven&apos;t thought about it too much, but we may get a performance bump for
&gt; RECURSIVEMATCH by replacing the hash_enumerate()+qsort() with code that 
&gt; creates a sorted array or b-tree as we populate the hash table.

IMHO this is an internal optimization of the implementation which shall not 
prevent us from publishing the current implementation.

But most probably the b-tree approach is overkill though and adds extra 
complexity and extra overhead for the tree structure. 

My guess is that a plain quick sort on an array of strings followed by a 
trivial duplicate removal at the end is fastest due to the fact that we don&apos;t 
need intermediate results.

Using a plain array also has the advantage of being much more friendly to 
modern CPU and cache architectures.

Ken: What do you think? How shall we proceed? Shall we implement a different 
sorting algorithm or shall we commit the code as it is and maybe later optimize 
things?</thetext>
          </long_desc>
          <long_desc isprivate="0">
            <who name="Ken Murchison">murch@andrew.cmu.edu</who>
            <bug_when>2006-11-06 16:58:58 EDT</bug_when>
            <thetext>I&apos;m in the process of moving the 2.3 code to the HEAD of CVS and making any
further changes to 2.2 on a separate branch.  Since the LIST-EXTENDED stuff is
pretty invasive and I&apos;m sure if we&apos;ve tested all of the edge cases yet, I think
I&apos;m going to create a new 2.4 branch and apply the LIST-EXTENDED and METADATA
stuff there.</thetext>
          </long_desc>
          <long_desc isprivate="0">
            <who name="Ken Murchison">murch@andrew.cmu.edu</who>
            <bug_when>2006-12-01 12:49:36 EDT</bug_when>
            <thetext>Applied patch to cyrus-imapd-2_4 branch</thetext>
          </long_desc>
      
          <attachment
              isobsolete="1"
              ispatch="1"
              isprivate="0"
          >
            <attachid>458</attachid>
            <date>2006-09-10 19:04 EDT</date>
            <desc>LIST-EXTENDED capability feature patch r50</desc>
            <filename>list-extended-r50.patch</filename>
            <type>text/plain</type>
            <size>32197</size>
            <attacher>martin.konold@erfrakon.de</attacher>
            
              <data encoding="base64">ZGlmZiAtTmF1ckJiIC0tZXhjbHVkZT0uc3ZuIC4uL2JyYW5jaGVzL2N5cnVzaGVhZC9jb25maWd1
cmUuaW4gLi9jb25maWd1cmUuaW4KLS0tIC4uL2JyYW5jaGVzL2N5cnVzaGVhZC9jb25maWd1cmUu
aW4JMjAwNS0wNC0xMiAyMjowNToyMC4wMDAwMDAwMDAgKzAyMDAKKysrIC4vY29uZmlndXJlLmlu
CTIwMDYtMDgtMjQgMTU6MDU6MTUuMDAwMDAwMDAwICswMjAwCkBAIC05MzMsMTIgKzkzMywyOCBA
QAogCWZpLAogCUFDX01TR19SRVNVTFQobm8pKQogCitFTkFCTEVfTElTVEVYVD1ubwogQUNfQVJH
X0VOQUJMRShsaXN0ZXh0LAotCVsgIC0tZW5hYmxlLWxpc3RleHQgICAgICAgIGVuYWJsZSBJTUFQ
IExpc3QgZXh0ZW5zaW9uc10sCisJWyAgLS1lbmFibGUtbGlzdGV4dCAgICAgICAgZW5hYmxlIElN
QVAgTElTVEVYVCBMaXN0IGV4dGVuc2lvbnNdLAorCUVOQUJMRV9MSVNURVhUPSRlbmFibGV2YWwK
IAlpZiB0ZXN0ICIkZW5hYmxldmFsIiA9IHllczsgdGhlbgogCQlBQ19ERUZJTkUoRU5BQkxFX0xJ
U1RFWFQsW10sW0VuYWJsZSB0aGUgTElTVEVYVCBleHRlbnNpb24/XSkKIAlmaSkKIAorRU5BQkxF
X0xJU1RfRVhURU5ERUQ9bm8KK0FDX0FSR19FTkFCTEUobGlzdC1leHRlbmRlZCwKKwlbICAtLWVu
YWJsZS1saXN0LWV4dGVuZGVkICBlbmFibGUgSU1BUCBMSVNULUVYVEVOREVEIExpc3QgZXh0ZW5z
aW9uc10sCisJRU5BQkxFX0xJU1RfRVhURU5ERUQ9JGVuYWJsZXZhbAorCWlmIHRlc3QgIiRlbmFi
bGV2YWwiID0geWVzOyB0aGVuCisJCUFDX0RFRklORShFTkFCTEVfTElTVF9FWFRFTkRFRCxbXSxb
RW5hYmxlIHRoZSBMSVNULUVYVEVOREVEIGV4dGVuc2lvbj9dKQorCWZpKQorCitpZiB0ZXN0ICIk
RU5BQkxFX0xJU1RFWFQiICE9IG5vOyB0aGVuCisgICAgaWYgdGVzdCAiJEVOQUJMRV9MSVNUX0VY
VEVOREVEIiAhPSBubzsgdGhlbgorCUFDX0VSUk9SKENhbm5vdCBlbmFibGUgYm90aCBMSVNURVhU
IGFuZCBMSVNULUVYVEVOREVEKQorICAgIGZpCitmaQorCiBBQ19BUkdfRU5BQkxFKG5ldHNjYXBl
aGFjaywKIAlbICAtLWVuYWJsZS1uZXRzY2FwZWhhY2sgICBlbmFibGUgTmV0c2NhcGUgaGFjayBm
b3IgdGhlIG1lbnUgb3B0aW9uCiAgICAgICAgICAgICAgICAgICAgICAgICAgIGluIENvbW11bmlj
YXRvciB0byBBZG1pbmlzdHJhdGUgTWFpbF0sCmRpZmYgLU5hdXJCYiAtLWV4Y2x1ZGU9LnN2biAu
Li9icmFuY2hlcy9jeXJ1c2hlYWQvZG9jL3NwZWNzLmh0bWwgLi9kb2Mvc3BlY3MuaHRtbAotLS0g
Li4vYnJhbmNoZXMvY3lydXNoZWFkL2RvYy9zcGVjcy5odG1sCTIwMDYtMDYtMTYgMTc6MTA6Mjgu
MDAwMDAwMDAwICswMjAwCisrKyAuL2RvYy9zcGVjcy5odG1sCTIwMDYtMDgtMTEgMTM6Mzk6MjYu
MDAwMDAwMDAwICswMjAwCkBAIC01NCw3ICs1NCw3IEBACiA8VFI+PFREPjxBIEhSRUY9Imh0dHA6
Ly93d3cuaWV0Zi5vcmcvaW50ZXJuZXQtZHJhZnRzL2RyYWZ0LWlldGYtaW1hcGV4dC1zb3J0LTE3
LnR4dCI+CiBkcmFmdC1pZXRmLWltYXBleHQtc29ydDwvQT48L1REPgogPFREPklNQVAgU09SVCBh
bmQgVEhSRUFEIEV4dGVuc2lvbjwvVEQ+PC9UUj4KLTxUUj48VEQ+PEEgSFJFRj0iaHR0cDovL3d3
dy5pZXRmLm9yZy9pbnRlcm5ldC1kcmFmdHMvZHJhZnQtaWV0Zi1pbWFwZXh0LWxpc3QtZXh0ZW5z
aW9ucy0xMy50eHQiPgorPFRSPjxURD48QSBIUkVGPSJodHRwOi8vd3d3LmlldGYub3JnL2ludGVy
bmV0LWRyYWZ0cy9kcmFmdC1pZXRmLWltYXBleHQtbGlzdC1leHRlbnNpb25zLTE3LnR4dCI+CiBk
cmFmdC1pZXRmLWltYXBleHQtbGlzdC1leHRlbnNpb25zPC9BPjwvVEQ+CiA8VEQ+SU1BUDQgTElT
VCBDb21tYW5kIEV4dGVuc2lvbnM8L1REPjwvVFI+CiA8VFI+PFREPjxBIEhSRUY9Imh0dHA6Ly93
d3cuaWV0Zi5vcmcvaW50ZXJuZXQtZHJhZnRzL2RyYWZ0LWRhYm9vLWltYXAtYW5ub3RhdGVtb3Jl
LTA5LnR4dCI+CmRpZmYgLU5hdXJCYiAtLWV4Y2x1ZGU9LnN2biAuLi9icmFuY2hlcy9jeXJ1c2hl
YWQvaW1hcC9pbWFwZC5jIC4vaW1hcC9pbWFwZC5jCi0tLSAuLi9icmFuY2hlcy9jeXJ1c2hlYWQv
aW1hcC9pbWFwZC5jCTIwMDYtMDgtMDIgMTc6MTY6MjAuMDAwMDAwMDAwICswMjAwCisrKyAuL2lt
YXAvaW1hcGQuYwkyMDA2LTA4LTI0IDE1OjA1OjE1LjAwMDAwMDAwMCArMDIwMApAQCAtMTk0LDYg
KzE5NSw0OCBAQAogICAgIDMxLCAzMSwgMzAsIDMxLCAzMCwgMzEKIH07CiAKKyNpZm5kZWYgRU5B
QkxFX0xJU1RFWFQKK3N0YXRpYyBzdHJ1Y3QgbWJveF9uYW1lX2F0dHJpYnV0ZSB7CisgICAgaW50
IGZsYWc7CisgICAgY2hhciAqaWQ7Cit9IG1ib3hfbmFtZV9hdHRyaWJ1dGVzW10gPSB7CisgICAg
LyogZnJvbSBSRkMgMzUwMSAqLworICAgIHsgTUJPWF9BVFRSSUJVVEVfTk9JTkZFUklPUlMsICAg
IlxcTm9pbmZlcmlvcnMiICAgfSwKKyAgICB7IE1CT1hfQVRUUklCVVRFX05PU0VMRUNULCAgICAg
ICJcXE5vc2VsZWN0IiAgICAgIH0sCisgICAgeyBNQk9YX0FUVFJJQlVURV9NQVJLRUQsICAgICAg
ICAiXFxNYXJrZWQiICAgICAgICB9LAorICAgIHsgTUJPWF9BVFRSSUJVVEVfVU5NQVJLRUQsICAg
ICAgIlxcVW5tYXJrZWQiICAgICAgfSwKKworICAgIC8qIGZyb20gZHJhZnQtaWV0Zi1pbWFwZXh0
LWxpc3QtZXh0ZW5zaW9ucy0xNy50eHQgKi8KKyAgICB7IE1CT1hfQVRUUklCVVRFX05PTkVYSVNU
RU5ULCAgICJcXE5vbkV4aXN0ZW50IiAgIH0sCisgICAgeyBNQk9YX0FUVFJJQlVURV9TVUJTQ1JJ
QkVELCAgICAiXFxTdWJzY3JpYmVkIiAgICB9LAorICAgIHsgTUJPWF9BVFRSSUJVVEVfUkVNT1RF
LCAgICAgICAgIlxcUmVtb3RlIiAgICAgICAgfSwKKyAgICB7IE1CT1hfQVRUUklCVVRFX0hBU0NI
SUxEUkVOLCAgICJcXEhhc0NoaWxkcmVuIiAgIH0sCisgICAgeyBNQk9YX0FUVFJJQlVURV9IQVNO
T0NISUxEUkVOLCAiXFxIYXNOb0NoaWxkcmVuIiB9LAorCisgICAgeyAwLCBOVUxMIH0KK307CisK
Ky8qCisgKiBUaGVzZSBiaXRtYXNrcyBkZWZpbmUgaG93IExpc3Qgc2VsZWN0aW9uIG9wdGlvbnMg
Y2FuIGJlIGNvbWJpbmVkOgorICogbGlzdF9zZWxlY3RfbW9kX29wdHMgbWF5IG9ubHkgYmUgdXNl
ZCBpZiBhdCBsZWFzdCBvbmUgbGlzdF9zZWxlY3RfYmFzZV9vcHQKKyAqIGlzIGFsc28gcHJlc2Vu
dC4KKyAqIEZvciBleGFtcGxlLCAoUkVDVVJTSVZFTUFUQ0gpIGFuZCAoUkVDVVJTSVZFTUFUQ0gg
UkVNT1RFKSBhcmUgaW52YWxpZCwgYnV0CisgKiAoUkVDVVJTSVZFTUFUQ0ggU1VCU0NSSUJFRCkg
aXMgb2suCisgKi8KK3N0YXRpYyBjb25zdCBpbnQgbGlzdF9zZWxlY3RfYmFzZV9vcHRzID0gTElT
VF9TRUxfU1VCU0NSSUJFRDsKK3N0YXRpYyBjb25zdCBpbnQgbGlzdF9zZWxlY3RfbW9kX29wdHMg
PSBMSVNUX1NFTF9SRUNVUlNJVkVNQVRDSDsKKworLyogc3RydWN0dXJlIHRoYXQgbGlzdF9kYXRh
IHBhc3NlcyBpdHMgY2FsbGJhY2tzICovCitzdHJ1Y3QgbGlzdF9yb2NrIHsKKyAgICBpbnQgb3B0
czsKKyAgICBjaGFyICpsYXN0X25hbWU7CisgICAgaW50IGxhc3RfYXR0cmlidXRlczsKKyAgICBp
bnQgdHJhaWxpbmdfcGVyY2VudDsgLyogdGhlIG1haWxib3ggbmFtZSBhcmcgZW5kcyB3aXRoIGEg
JQorICAgICAgICAgICAgICAgICAgICAgICAgICAgKiBjYXVzZXMgc3BlY2lhbCBiZWhhdmlvciB3
aXRoIG5vbi1leHRlbmRlZCBMSVNUCisJCQkgICAqIGFuZCBMU1VCICovCit9OworI2VuZGlmCisK
IHZvaWQgbW90ZF9maWxlKGludCBmZCk7CiB2b2lkIHNodXRfZG93bihpbnQgY29kZSk7CiB2b2lk
IGZhdGFsKGNvbnN0IGNoYXIgKnMsIGludCBjb2RlKTsKQEAgLTIyNSw2ICsyNjgsMTEgQEAKIHZv
aWQgY21kX3JlY29uc3RydWN0KGNvbnN0IGNoYXIgKnRhZywgY29uc3QgY2hhciAqbmFtZSwgaW50
IHJlY3Vyc2l2ZSk7CiB2b2lkIGNtZF9maW5kKGNoYXIgKnRhZywgY2hhciAqbmFtZXNwYWNlLCBj
aGFyICpwYXR0ZXJuKTsKIHZvaWQgY21kX2xpc3QoY2hhciAqdGFnLCBpbnQgbGlzdG9wdHMsIGNo
YXIgKnJlZmVyZW5jZSwgY2hhciAqcGF0dGVybik7CisjaWZuZGVmIEVOQUJMRV9MSVNURVhUCit2
b2lkIHBhcnNlX2xpc3QoY2hhciAqdGFnKTsKK3ZvaWQgZG9fbGlzdChjaGFyICp0YWcsIGludCBs
aXN0b3B0cywgY2hhciAqcmVmZXJlbmNlLAorCSAgICAgc3RydWN0IHN0cmxpc3QgKnBhdHRlcm5z
KTsKKyNlbmRpZgogdm9pZCBjbWRfY2hhbmdlc3ViKGNoYXIgKnRhZywgY2hhciAqbmFtZXNwYWNl
LCBjaGFyICpuYW1lLCBpbnQgYWRkKTsKIHZvaWQgY21kX2dldGFjbChjb25zdCBjaGFyICp0YWcs
IGNvbnN0IGNoYXIgKm5hbWUpOwogdm9pZCBjbWRfbGlzdHJpZ2h0cyhjaGFyICp0YWcsIGNoYXIg
Km5hbWUsIGNoYXIgKmlkZW50aWZpZXIpOwpAQCAtMjY2LDYgKzMxNCwxMSBAQAogCiB2b2lkIGFu
bm90YXRlX3Jlc3BvbnNlKHN0cnVjdCBlbnRyeWF0dGxpc3QgKmwpOwogCisjaWZkZWYgRU5BQkxF
X0xJU1RfRVhURU5ERUQKK2ludCBnZXRsaXN0c2Vsb3B0cyhjaGFyICp0YWcsIGludCAqb3B0cyk7
CitpbnQgZ2V0bGlzdHJldG9wdHMoY2hhciAqdGFnLCBpbnQgKm9wdHMpOworI2VuZGlmCisKICNp
ZmRlZiBFTkFCTEVfTElTVEVYVAogaW50IGdldGxpc3RvcHRzKGNoYXIgKnRhZywgaW50ICpsaXN0
b3B0cyk7CiAjZW5kaWYKQEAgLTI5Miw5ICszNDUsMjcgQEAKIHN0YXRpYyB2b2lkIGZyZWVzb3J0
Y3JpdChzdHJ1Y3Qgc29ydGNyaXQgKnMpOwogCiBzdGF0aWMgaW50IG1haWxib3hkYXRhKGNoYXIg
Km5hbWUsIGludCBtYXRjaGxlbiwgaW50IG1heWNyZWF0ZSwgdm9pZCAqcm9jayk7CisKKyNpZmRl
ZiBFTkFCTEVfTElTVEVYVAogc3RhdGljIGludCBsaXN0ZGF0YShjaGFyICpuYW1lLCBpbnQgbWF0
Y2hsZW4sIGludCBtYXljcmVhdGUsIHZvaWQgKnJvY2spOwogc3RhdGljIHZvaWQgbXN0cmluZ2Rh
dGEoY2hhciAqY21kLCBjaGFyICpuYW1lLCBpbnQgbWF0Y2hsZW4sIGludCBtYXljcmVhdGUsCiAJ
CQlpbnQgbGlzdG9wdHMpOworI2Vsc2UKK3N0YXRpYyBpbnQgc2V0X2hhc2NoaWxkcmVuKGNoYXIg
Km5hbWUsIGludCBtYXRjaGxlbiwgaW50IG1heWNyZWF0ZSwKKwkJCSAgIGludCAqYXR0cmlidXRl
cyk7CitzdGF0aWMgdm9pZCBsaXN0X3Jlc3BvbnNlKGNoYXIgKm5hbWUsIGludCBhdHRyaWJ1dGVz
LCBpbnQgb3B0cyk7CitzdGF0aWMgaW50IHNldF9zdWJzY3JpYmVkKGNoYXIgKm5hbWUsIGludCBt
YXRjaGxlbiwgaW50IG1heWNyZWF0ZSwKKwkJCSAgaW50ICphdHRyaWJ1dGVzKTsKK3N0YXRpYyBj
aGFyICpjYW5vbmljYWxfbGlzdF9wYXR0ZXJuKGNvbnN0IGNoYXIgKnJlZmVyZW5jZSwgY29uc3Qg
Y2hhciAqcGF0dGVybik7CitzdGF0aWMgdm9pZCBjYW5vbmljYWxfbGlzdF9wYXR0ZXJucyhjaGFy
ICpyZWZlcmVuY2UsIHN0cnVjdCBzdHJsaXN0ICpwYXR0ZXJucyk7CitzdGF0aWMgaW50IGxpc3Rf
Y2IoY2hhciAqbmFtZSwgaW50IG1hdGNobGVuLCBpbnQgbWF5Y3JlYXRlLAorCQkgIHN0cnVjdCBs
aXN0X3JvY2sgKnJvY2spOworc3RhdGljIGludCBzdWJzY3JpYmVkX2NiKGNoYXIgKm5hbWUsIGlu
dCBtYXRjaGxlbiwgaW50IG1heWNyZWF0ZSwKKwkJCSBzdHJ1Y3QgbGlzdF9yb2NrICpyb2NrKTsK
K3N0YXRpYyB2b2lkIGxpc3RfZGF0YShjaGFyICpyZWZlcmVuY2UsIGludCBsaXN0b3B0cywgc3Ry
dWN0IHN0cmxpc3QgKnBhdHRlcm5zKTsKK3N0YXRpYyB2b2lkIGxpc3RfZGF0YV9yZW1vdGUoY2hh
ciAqdGFnLCBpbnQgbGlzdG9wdHMsIGNoYXIgKnJlZmVyZW5jZSwKKwkJCSAgICAgc3RydWN0IHN0
cmxpc3QgKnBhdHRlcm4pOworI2VuZGlmCiAKIGV4dGVybiB2b2lkIHNldHByb2N0aXRsZV9pbml0
KGludCBhcmdjLCBjaGFyICoqYXJndiwgY2hhciAqKmVudnApOwogZXh0ZXJuIGludCBwcm9jX3Jl
Z2lzdGVyKGNvbnN0IGNoYXIgKnByb2duYW1lLCBjb25zdCBjaGFyICpjbGllbnRob3N0LCAKQEAg
LTEzNTYsOCArMTQyNyw4IEBACiAJICAgIH0KIAkgICAgZWxzZSBpZiAoIWltYXBkX3VzZXJpZCkg
Z290byBub2xvZ2luOwogCSAgICBlbHNlIGlmICghc3RyY21wKGNtZC5zLCAiTGlzdCIpKSB7Ci0J
CWludCBsaXN0b3B0cyA9IExJU1RfQ0hJTERSRU47CiAjaWZkZWYgRU5BQkxFX0xJU1RFWFQKKwkJ
aW50IGxpc3RvcHRzID0gTElTVF9DSElMRFJFTjsKIAkJLyogQ2hlY2sgZm9yIGFuZCBwYXJzZSBM
SVNURVhUIG9wdGlvbnMgKi8KIAkJYyA9IHByb3RfZ2V0YyhpbWFwZF9pbik7CiAJCWlmIChjID09
ICcoJykgewpAQCAtMTM2OSw3ICsxNDQwLDYgQEAKIAkJfQogCQllbHNlCiAJCSAgICBwcm90X3Vu
Z2V0YyhjLCBpbWFwZF9pbik7Ci0jZW5kaWYgLyogRU5BQkxFX0xJU1RFWFQgKi8KIAkJaWYgKGlt
YXBkX21hZ2ljcGx1cykgbGlzdG9wdHMgKz0gTElTVF9TVUJTQ1JJQkVEOwogCQljID0gZ2V0YXN0
cmluZyhpbWFwZF9pbiwgaW1hcGRfb3V0LCAmYXJnMSk7CiAJCWlmIChjICE9ICcgJykgZ290byBt
aXNzaW5nYXJnczsKQEAgLTEzNzcsNiArMTQ0NywxMiBAQAogCQlpZiAoYyA9PSAnXHInKSBjID0g
cHJvdF9nZXRjKGltYXBkX2luKTsKIAkJaWYgKGMgIT0gJ1xuJykgZ290byBleHRyYWFyZ3M7CiAJ
CWNtZF9saXN0KHRhZy5zLCBsaXN0b3B0cywgYXJnMS5zLCBhcmcyLnMpOworI2Vsc2UgLyogRU5B
QkxFX0xJU1RFWFQgKi8KKwkJaWYgKGMgIT0gJyAnKQorCQkgICAgZ290byBtaXNzaW5nYXJnczsK
KworCQlwYXJzZV9saXN0KHRhZy5zKTsKKyNlbmRpZiAvKiBFTkFCTEVfTElTVEVYVCAqLwogCiAJ
CXNubXBfaW5jcmVtZW50KExJU1RfQ09VTlQsIDEpOwogCSAgICB9CkBAIC0xMzg2LDcgKzE0NjIs
MTIgQEAKIAkJYyA9IGdldGFzdHJpbmcoaW1hcGRfaW4sIGltYXBkX291dCwgJmFyZzIpOwogCQlp
ZiAoYyA9PSAnXHInKSBjID0gcHJvdF9nZXRjKGltYXBkX2luKTsKIAkJaWYgKGMgIT0gJ1xuJykg
Z290byBleHRyYWFyZ3M7CisjaWZkZWYgRU5BQkxFX0xJU1RFWFQKIAkJY21kX2xpc3QodGFnLnMs
IExJU1RfTFNVQiB8IExJU1RfQ0hJTERSRU4sIGFyZzEucywgYXJnMi5zKTsKKyNlbHNlCisJCWNt
ZF9saXN0KHRhZy5zLCBMSVNUX09QVF9MU1VCIHwgTElTVF9TRUxfU1VCU0NSSUJFRCwKKwkJCSBh
cmcxLnMsIGFyZzIucyk7CisjZW5kaWYKIAogCQlzbm1wX2luY3JlbWVudChMU1VCX0NPVU5ULCAx
KTsKIAkgICAgfQpAQCAtMTU1OCw3ICsxNjM5LDEzIEBACiAJCWMgPSBnZXRhc3RyaW5nKGltYXBk
X2luLCBpbWFwZF9vdXQsICZhcmcyKTsKIAkJaWYgKGMgPT0gJ1xyJykgYyA9IHByb3RfZ2V0Yyhp
bWFwZF9pbik7CiAJCWlmIChjICE9ICdcbicpIGdvdG8gZXh0cmFhcmdzOworI2lmZGVmIEVOQUJM
RV9MSVNURVhUCiAJCWNtZF9saXN0KHRhZy5zLCBMSVNUX0NISUxEUkVOIHwgTElTVF9SRU1PVEUs
IGFyZzEucywgYXJnMi5zKTsKKyNlbHNlCisJCWNtZF9saXN0KHRhZy5zLAorCQkJIExJU1RfT1BU
X1JMSVNUIHwgTElTVF9TRUxfUkVNT1RFIHwgTElTVF9SRVRfQ0hJTERSRU4sCisJCQkgYXJnMS5z
LCBhcmcyLnMpOworI2VuZGlmCiAKIC8qIAkJc25tcF9pbmNyZW1lbnQoTElTVF9DT1VOVCwgMSk7
ICovCiAJICAgIH0KQEAgLTE1NjgsOCArMTY1NSwxNiBAQAogCQljID0gZ2V0YXN0cmluZyhpbWFw
ZF9pbiwgaW1hcGRfb3V0LCAmYXJnMik7CiAJCWlmIChjID09ICdccicpIGMgPSBwcm90X2dldGMo
aW1hcGRfaW4pOwogCQlpZiAoYyAhPSAnXG4nKSBnb3RvIGV4dHJhYXJnczsKKyNpZmRlZiBFTkFC
TEVfTElTVEVYVAogCQljbWRfbGlzdCh0YWcucywgTElTVF9MU1VCIHwgTElTVF9DSElMRFJFTiB8
IExJU1RfUkVNT1RFLAogCQkJIGFyZzEucywgYXJnMi5zKTsKKyNlbHNlCisJCWNtZF9saXN0KHRh
Zy5zLAorCQkJIExJU1RfT1BUX1JMSVNUIHwgTElTVF9PUFRfTFNVQiB8IExJU1RfU0VMX1JFTU9U
RQorCQkJIHwgTElTVF9TRUxfU1VCU0NSSUJFRCB8IExJU1RfUkVUX0NISUxEUkVOLAorCQkJIGFy
ZzEucywgYXJnMi5zKTsKKyNlbmRpZgorCiAvKiAJCXNubXBfaW5jcmVtZW50KExTVUJfQ09VTlQs
IDEpOyAqLwogCSAgICB9CiAjaWZkZWYgSEFWRV9TU0wKQEAgLTI1ODcsOSArMjY4MiwxMyBAQAog
CXByb3RfcHJpbnRmKGltYXBkX291dCwgIiBJRExFIik7CiAgICAgfQogCisjaWZkZWYgRU5BQkxF
X0xJU1RfRVhURU5ERUQKKyAgICBwcm90X3ByaW50ZihpbWFwZF9vdXQsICIgTElTVEVYVCBMSVNU
LVNVQlNDUklCRUQgTElTVC1FWFRFTkRFRCIpOworI2VuZGlmCisKICNpZmRlZiBFTkFCTEVfTElT
VEVYVAogICAgIHByb3RfcHJpbnRmKGltYXBkX291dCwgIiBMSVNURVhUIExJU1QtU1VCU0NSSUJF
RCIpOwotI2VuZGlmIC8qIEVOQUJMRV9MSVNURVhUICovCisjZW5kaWYKIAogI2lmZGVmIEVOQUJM
RV9YX05FVFNDQVBFX0hBQ0sKICAgICBwcm90X3ByaW50ZihpbWFwZF9vdXQsICIgWC1ORVRTQ0FQ
RSIpOwpAQCAtNTY2MCw2ICs1NzU5LDggQEAKIAkJZXJyb3JfbWVzc2FnZShJTUFQX09LX0NPTVBM
RVRFRCkpOwogfQogCisjaWZkZWYgRU5BQkxFX0xJU1RFWFQKKwogc3RhdGljIGludCBtc3RyaW5n
ZGF0YWNhbGxzOwogCiAvKgpAQCAtNTc4OSw2ICs1ODkwLDE4NSBAQAogCQllcnJvcl9tZXNzYWdl
KElNQVBfT0tfQ09NUExFVEVEKSwgbXl0aW1lLCBtc3RyaW5nZGF0YWNhbGxzKTsKIH0KICAgCisj
ZWxzZSAvKiBFTkFCTEVfTElTVEVYVCAqLworCisvKiBubyB0aW1lcyB0aGUgY2FsbGJhY2tzIGZv
ciBmaW5kYWxsL2ZpbmRzdWIgaGF2ZSBiZWVuIGNhbGxlZCAqLworc3RhdGljIGludCBsaXN0X2Nh
bGxiYWNrX2NhbGxzOworCisvKgorICogUGFyc2UgYW5kIHBlcmZvcm0gYSBMSVNUIGNvbW1hbmQu
CisgKi8KK3ZvaWQgcGFyc2VfbGlzdChjaGFyICp0YWcpCit7CisgICAgaW50IGxpc3RvcHRzID0g
MDsKKyAgICBzdGF0aWMgc3RydWN0IGJ1ZiBidWY7CisgICAgaW50IGM7CisgICAgc3RydWN0IHN0
cmxpc3QgKnBhdHRlcm5zID0gTlVMTDsKKyAgICBjaGFyICpyZWZlcmVuY2U7CisKKyNpZmRlZiBF
TkFCTEVfTElTVF9FWFRFTkRFRAorICAgIC8qIENoZWNrIGZvciBhbmQgcGFyc2UgTElTVEVYVCBz
ZWxlY3Rpb24gb3B0aW9ucyAqLworICAgIGMgPSBwcm90X2dldGMoaW1hcGRfaW4pOworICAgIGlm
IChjID09ICcoJykgeworCWxpc3RvcHRzIHw9IExJU1RfT1BUX0VYVEVOREVEOworCWMgPSBnZXRs
aXN0c2Vsb3B0cyh0YWcsICZsaXN0b3B0cyk7CisJaWYgKGMgPT0gRU9GKSB7CisJICAgIGVhdGxp
bmUoaW1hcGRfaW4sIGMpOworCSAgICByZXR1cm47CisJfQorICAgIH0KKyAgICBlbHNlCisJcHJv
dF91bmdldGMoYywgaW1hcGRfaW4pOworI2VuZGlmCisKKyAgICBpZiAoaW1hcGRfbWFnaWNwbHVz
KSBsaXN0b3B0cyB8PSBMSVNUX1NFTF9TVUJTQ1JJQkVEIHwgTElTVF9SRVRfU1VCU0NSSUJFRDsK
KworICAgIC8qIFJlYWQgaW4gcmVmZXJlbmNlIG5hbWUgKi8KKyAgICBjID0gZ2V0YXN0cmluZyhp
bWFwZF9pbiwgaW1hcGRfb3V0LCAmYnVmKTsKKyAgICBpZiAoYyA9PSBFT0YgJiYgISpidWYucykg
eworCXByb3RfcHJpbnRmKGltYXBkX291dCwKKwkJICAgICIlcyBCQUQgTWlzc2luZyByZXF1aXJl
ZCBhcmd1bWVudCB0byBMaXN0OiByZWZlcmVuY2UgbmFtZVxyXG4iLAorCQkgICAgdGFnKTsKKwll
YXRsaW5lKGltYXBkX2luLCBjKTsKKwlyZXR1cm47CisgICAgfQorICAgIGlmIChjICE9ICcgJykg
eworCXByb3RfcHJpbnRmKGltYXBkX291dCwKKwkJICAgICIlcyBCQUQgTWlzc2luZyByZXF1aXJl
ZCBhcmd1bWVudCB0byBMaXN0OiBtYWlsYm94IHBhdHRlcm5cclxuIiwgdGFnKTsKKwllYXRsaW5l
KGltYXBkX2luLCBjKTsKKwlyZXR1cm47CisgICAgfQorICAgIHJlZmVyZW5jZSA9IHhzdHJkdXAo
YnVmLnMpOworCisgICAgLyogUmVhZCBpbiBtYWlsYm94IHBhdHRlcm4ocykgKi8KKyNpZmRlZiBF
TkFCTEVfTElTVF9FWFRFTkRFRAorICAgIGMgPSBwcm90X2dldGMoaW1hcGRfaW4pOworICAgIGlm
IChjID09ICcoJykgeworCWxpc3RvcHRzIHw9IExJU1RfT1BUX0VYVEVOREVEIHwgTElTVF9PUFRf
RVhURU5ERURfVjE3OworCWZvciAoOzspIHsKKwkgICAgYyA9IGdldGFzdHJpbmcoaW1hcGRfaW4s
IGltYXBkX291dCwgJmJ1Zik7CisJICAgIGlmICgqYnVmLnMpCisJCWFwcGVuZHN0cmxpc3QoJnBh
dHRlcm5zLCBidWYucyk7CisJICAgIGlmIChjICE9ICcgJykgYnJlYWs7CisJfQorCWlmIChjICE9
ICcpJykgeworCSAgICBwcm90X3ByaW50ZihpbWFwZF9vdXQsCisJCQkiJXMgQkFEIEludmFsaWQg
c3ludGF4IGluIExpc3QgY29tbWFuZFxyXG4iLCB0YWcpOworCSAgICBlYXRsaW5lKGltYXBkX2lu
LCBjKTsKKwkgICAgZ290byBmcmVlYXJnczsKKwl9CisJYyA9IHByb3RfZ2V0YyhpbWFwZF9pbik7
CisgICAgfQorICAgIGVsc2UgeworCXByb3RfdW5nZXRjKGMsIGltYXBkX2luKTsKKyNlbmRpZgor
ICAgIAljID0gZ2V0YXN0cmluZyhpbWFwZF9pbiwgaW1hcGRfb3V0LCAmYnVmKTsKKwlpZiAoYyA9
PSBFT0YpIHsKKwkgICAgcHJvdF9wcmludGYoaW1hcGRfb3V0LAorCQkJIiVzIEJBRCBNaXNzaW5n
IHJlcXVpcmVkIGFyZ3VtZW50IHRvIExpc3Q6IG1haWxib3ggcGF0dGVyblxyXG4iLAorCQkJdGFn
KTsKKwkgICAgZWF0bGluZShpbWFwZF9pbiwgYyk7CisJICAgIGdvdG8gZnJlZWFyZ3M7CisJfQor
CWFwcGVuZHN0cmxpc3QoJnBhdHRlcm5zLCBidWYucyk7CisjaWZkZWYgRU5BQkxFX0xJU1RfRVhU
RU5ERUQKKyAgICB9CisjZW5kaWYKKworI2lmZGVmIEVOQUJMRV9MSVNUX0VYVEVOREVECisgICAg
LyogQ2hlY2sgZm9yIGFuZCBwYXJzZSBMSVNURVhUIHJldHVybiBvcHRpb25zICovCisgICAgaWYg
KGMgPT0gJyAnKSB7CisJbGlzdG9wdHMgfD0gTElTVF9PUFRfRVhURU5ERUQgfCBMSVNUX09QVF9F
WFRFTkRFRF9WMTc7CisJYyA9IGdldGxpc3RyZXRvcHRzKHRhZywgJmxpc3RvcHRzKTsKKwlpZiAo
YyA9PSBFT0YpIHsKKwkgICAgZWF0bGluZShpbWFwZF9pbiwgYyk7CisJICAgIGdvdG8gZnJlZWFy
Z3M7CisJfQorICAgIH0KKyNlbmRpZgorCisgICAgLyogY2hlY2sgZm9yIENSTEYgKi8KKyAgICBp
ZiAoYyA9PSAnXHInKSBjID0gcHJvdF9nZXRjKGltYXBkX2luKTsKKyAgICBpZiAoYyAhPSAnXG4n
KSB7CisJcHJvdF9wcmludGYoaW1hcGRfb3V0LAorCQkgICAgIiVzIEJBRCBVbmV4cGVjdGVkIGV4
dHJhIGFyZ3VtZW50cyB0byBMaXN0XHJcbiIsIHRhZyk7CisJZWF0bGluZShpbWFwZF9pbiwgYyk7
CisJZ290byBmcmVlYXJnczsKKyAgICB9CisKKyAgICBpZiAobGlzdG9wdHMgJiBMSVNUX09QVF9F
WFRFTkRFRF9WMDMgJiYgbGlzdG9wdHMgJiBMSVNUX09QVF9FWFRFTkRFRF9WMTcpIHsKKwkvKiBj
bGllbnQgbWl4ZWQgZGlmZmVyZW50IGxpc3RleHQgdmVyc2lvbnMgKi8KKwlwcm90X3ByaW50Zihp
bWFwZF9vdXQsCisJCSAgICAiJXMgQkFEIEludmFsaWQgc3ludGF4IGluIGV4dGVuZGVkIExpc3Qg
Y29tbWFuZFxyXG4iLCB0YWcpOworCWdvdG8gZnJlZWFyZ3M7CisgICAgfQorCisgICAgZG9fbGlz
dCh0YWcsIGxpc3RvcHRzLCByZWZlcmVuY2UsIHBhdHRlcm5zKTsKKworICBmcmVlYXJnczoKKyAg
ICBmcmVlc3RybGlzdChwYXR0ZXJucyk7CisgICAgZnJlZShyZWZlcmVuY2UpOworICAgIHJldHVy
bjsKK30KKworLyogQSB3cmFwcGVyIGZvciBkb19saXN0LiAqLwordm9pZCBjbWRfbGlzdChjaGFy
ICp0YWcsIGludCBsaXN0b3B0cywgY2hhciAqcmVmZXJlbmNlLCBjaGFyICpwYXR0ZXJuKQorewor
ICAgIGNoYXIgKm5ld19wYXR0ZXJuID0geHN0cmR1cChwYXR0ZXJuKTsKKyAgICBzdHJ1Y3Qgc3Ry
bGlzdCBzdHJsaXN0ID0geyBuZXdfcGF0dGVybiwgTlVMTCwgTlVMTCwgTlVMTCB9OworICAgIGRv
X2xpc3QodGFnLCBsaXN0b3B0cywgcmVmZXJlbmNlLCAmc3RybGlzdCk7CisgICAgZnJlZShzdHJs
aXN0LnMpOworfQorCisvKgorICogUGVyZm9ybSBhIExJU1QsIExTVUIsIFJMSVNUIG9yIFJMU1VC
IGNvbW1hbmQKKyAqLwordm9pZCBkb19saXN0KGNoYXIgKnRhZywgaW50IGxpc3RvcHRzLCBjaGFy
ICpyZWZlcmVuY2UsCisJICAgICBzdHJ1Y3Qgc3RybGlzdCAqcGF0dGVybnMpCit7CisgICAgY2xv
Y2tfdCBzdGFydCA9IGNsb2NrKCk7CisgICAgY2hhciBteXRpbWVbMTAwXTsKKworICAgIGlmIChs
aXN0b3B0cyAmIExJU1RfU0VMX1JFTU9URSkgc3VwcG9ydHNfcmVmZXJyYWxzID0gIWRpc2FibGVf
cmVmZXJyYWxzOworCisgICAgaWYgKGxpc3RvcHRzICYgTElTVF9TRUxfUkVDVVJTSVZFTUFUQ0gp
IHsKKwlwcm90X3ByaW50ZihpbWFwZF9vdXQsCisJCSAgICAiJXMgTk8gU2VydmVyIGRvZXMgbm90
IHN1cHBvcnQgUkVDVVJTSVZFTUFUQ0ggc2VsZWN0aW9uIG9wdGlvblxyXG4iLAorCQkgICAgdGFn
KTsKKwlyZXR1cm47CisgICAgfQorCisgICAgbGlzdF9jYWxsYmFja19jYWxscyA9IDA7CisKKyAg
ICBpZiAoIShsaXN0b3B0cyAmIExJU1RfT1BUX0xTVUIpCisJICAgICYmICEobGlzdG9wdHMgJiBM
SVNUX09QVF9FWFRFTkRFRCkKKwkgICAgJiYgISpwYXR0ZXJucy0+cykgeworCS8qIHNwZWNpYWwg
Y2FzZTogcXVlcnkgdG9wLWxldmVsIGhpZXJhcmNoeSBzZXBhcmF0b3IgKi8KKwlwcm90X3ByaW50
ZihpbWFwZF9vdXQsICIqICVzTElTVCAoXFxOb3NlbGVjdCkgXCIlY1wiIFwiXCJcclxuIiwKKwkJ
ICAgIChsaXN0b3B0cyAmIExJU1RfT1BUX1JMSVNUKSA/ICJSIiA6ICIiLAorCQkgICAgaW1hcGRf
bmFtZXNwYWNlLmhpZXJfc2VwKTsKKyAgICB9IGVsc2UgaWYgKGxpc3RvcHRzICYgKExJU1RfU0VM
X1NVQlNDUklCRUQgfCBMSVNUX1JFVF9TVUJTQ1JJQkVEKQorCSAgICAmJiAoYmFja2VuZF9pbmJv
eCB8fCAoYmFja2VuZF9pbmJveCA9IHByb3h5X2ZpbmRpbmJveHNlcnZlcigpKSkpIHsKKwkvKiBy
ZW1vdGUgaW5ib3ggKi8KKwlsaXN0X2RhdGFfcmVtb3RlKHRhZywgbGlzdG9wdHMsIHJlZmVyZW5j
ZSwgcGF0dGVybnMpOworICAgIH0gZWxzZSB7CisJbGlzdF9kYXRhKHJlZmVyZW5jZSwgbGlzdG9w
dHMsIHBhdHRlcm5zKTsKKyAgICB9CisKKyAgICBpbWFwZF9jaGVjaygobGlzdG9wdHMgJiBMSVNU
X1NFTF9TVUJTQ1JJQkVEKSA/ICBOVUxMIDogYmFja2VuZF9pbmJveCwKKwkJMCwgMCk7CisKKyAg
ICBzbnByaW50ZihteXRpbWUsIHNpemVvZihteXRpbWUpLCAiJTIuM2YiLAorCSAgICAgKGNsb2Nr
KCkgLSBzdGFydCkgLyAoZG91YmxlKSBDTE9DS1NfUEVSX1NFQyk7CisgICAgcHJvdF9wcmludGYo
aW1hcGRfb3V0LCAiJXMgT0sgJXMgKCVzIHNlY3MiLCB0YWcsCisJCWVycm9yX21lc3NhZ2UoSU1B
UF9PS19DT01QTEVURUQpLCBteXRpbWUpOworICAgIGlmIChsaXN0X2NhbGxiYWNrX2NhbGxzKQor
CXByb3RfcHJpbnRmKGltYXBkX291dCwgIiAldSBjYWxscyIsIGxpc3RfY2FsbGJhY2tfY2FsbHMp
OworICAgIHByb3RfcHJpbnRmKGltYXBkX291dCwgIilcclxuIik7Cit9CisKKyNlbmRpZiAvKiBF
TkFCTEVfTElTVEVYVCAqLworCiAvKgogICogUGVyZm9ybSBhIFNVQlNDUklCRSAoYWRkIGlzIG5v
bnplcm8pIG9yCiAgKiBVTlNVQlNDUklCRSAoYWRkIGlzIHplcm8pIGNvbW1hbmQKQEAgLTg3NDks
NiArOTAyOSwxMzYgQEAKIH0KICNlbmRpZiAvKiBFTkFCTEVfTElTVEVYVCAqLwogCisjaWZkZWYg
RU5BQkxFX0xJU1RfRVhURU5ERUQKKy8qCisgKiBQYXJzZSBMSVNUIHNlbGVjdGlvbiBvcHRpb25z
LgorICogVGhlIGNvbW1hbmQgaGFzIGJlZW4gcGFyc2VkIHVwIHRvIGFuZCBpbmNsdWRpbmcgdGhl
IG9wZW5pbmcgJygnLgorICovCitpbnQgZ2V0bGlzdHNlbG9wdHMoY2hhciAqdGFnLCBpbnQgKm9w
dHMpCit7CisgICAgaW50IGM7CisgICAgc3RhdGljIHN0cnVjdCBidWYgYnVmOworCisgICAgaWYg
KCAoYyA9IHByb3RfZ2V0YyhpbWFwZF9pbikpID09ICcpJykKKwlyZXR1cm4gcHJvdF9nZXRjKGlt
YXBkX2luKTsKKyAgICBlbHNlCisJcHJvdF91bmdldGMoYywgaW1hcGRfaW4pOworCisgICAgZm9y
ICg7OykgeworCWMgPSBnZXR3b3JkKGltYXBkX2luLCAmYnVmKTsKKworCWlmICghKmJ1Zi5zKSB7
CisJICAgIHByb3RfcHJpbnRmKGltYXBkX291dCwKKwkJCSIlcyBCQUQgSW52YWxpZCBzeW50YXgg
aW4gTGlzdCBjb21tYW5kXHJcbiIsCisJCQl0YWcpOworCSAgICByZXR1cm4gRU9GOworCX0KKwor
CWxjYXNlKGJ1Zi5zKTsKKworCWlmICghc3RyY21wKGJ1Zi5zLCAic3Vic2NyaWJlZCIpKSB7CisJ
ICAgICpvcHRzIHw9IExJU1RfU0VMX1NVQlNDUklCRUQgfCBMSVNUX1JFVF9TVUJTQ1JJQkVEOwor
CX0gZWxzZSBpZiAoIXN0cmNtcChidWYucywgInJlbW90ZSIpKSB7CisJICAgICpvcHRzIHw9IExJ
U1RfU0VMX1JFTU9URTsKKwl9IGVsc2UgaWYgKCFzdHJjbXAoYnVmLnMsICJyZWN1cnNpdmVtYXRj
aCIpKSB7CisJICAgICpvcHRzIHw9IExJU1RfU0VMX1JFQ1VSU0lWRU1BVENIIHwgTElTVF9PUFRf
RVhURU5ERURfVjE3OworCX0gZWxzZSBpZiAoIXN0cmNtcChidWYucywgImNoaWxkcmVuIikpIHsK
KwkgICAgKm9wdHMgfD0gTElTVF9SRVRfQ0hJTERSRU4gfCBMSVNUX09QVF9FWFRFTkRFRF9WMDM7
CisJfSBlbHNlIHsKKwkgICAgcHJvdF9wcmludGYoaW1hcGRfb3V0LAorCQkJIiVzIEJBRCBJbnZh
bGlkIExpc3Qgc2VsZWN0aW9uIG9wdGlvbiBcIiVzXCJcclxuIiwKKwkJCXRhZywgYnVmLnMpOwor
CSAgICByZXR1cm4gRU9GOworCX0KKworCWlmIChjICE9ICcgJykgYnJlYWs7CisgICAgfQorCisg
ICAgaWYgKGMgIT0gJyknKSB7CisJcHJvdF9wcmludGYoaW1hcGRfb3V0LAorCQkgICAgIiVzIEJB
RCBNaXNzaW5nIGNsb3NlIHBhcmVudGhlc2lzIGZvciBMaXN0IHNlbGVjdGlvbiBvcHRpb25zXHJc
biIsIHRhZyk7CisJcmV0dXJuIEVPRjsKKyAgICB9CisKKyAgICBpZiAoKm9wdHMgJiBsaXN0X3Nl
bGVjdF9tb2Rfb3B0cworCSAgICAmJiAhICgqb3B0cyAmIGxpc3Rfc2VsZWN0X2Jhc2Vfb3B0cykp
IHsKKwlwcm90X3ByaW50ZihpbWFwZF9vdXQsCisJCSAgICAiJXMgQkFEIEludmFsaWQgY29tYmlu
YXRpb24gb2Ygc2VsZWN0aW9uIG9wdGlvbnNcclxuIiwKKwkJICAgIHRhZyk7CisJcmV0dXJuIEVP
RjsKKyAgICB9CisKKyAgICByZXR1cm4gcHJvdF9nZXRjKGltYXBkX2luKTsKK30KKworLyoKKyAq
IFBhcnNlIExJU1QgcmV0dXJuIG9wdGlvbnMuCisgKiBUaGUgY29tbWFuZCBoYXMgYmVlbiBwYXJz
ZWQgdXAgdG8gYW5kIGluY2x1ZGluZyB0aGUgJyAnIGJlZm9yZSBSRVRVUk4uCisgKi8KK2ludCBn
ZXRsaXN0cmV0b3B0cyhjaGFyICp0YWcsIGludCAqb3B0cykgeworICAgIHN0YXRpYyBzdHJ1Y3Qg
YnVmIGJ1ZjsKKyAgICBpbnQgYzsKKworICAgIGMgPSBnZXR3b3JkKGltYXBkX2luLCAmYnVmKTsK
KyAgICBpZiAoISpidWYucykgeworCXByb3RfcHJpbnRmKGltYXBkX291dCwKKwkJICAgICIlcyBC
QUQgSW52YWxpZCBzeW50YXggaW4gTGlzdCBjb21tYW5kXHJcbiIsIHRhZyk7CisJcmV0dXJuIEVP
RjsKKyAgICB9CisgICAgbGNhc2UoYnVmLnMpOworICAgIGlmIChzdHJjYXNlY21wKGJ1Zi5zLCAi
cmV0dXJuIikpIHsKKwlwcm90X3ByaW50ZihpbWFwZF9vdXQsCisJCSAgICAiJXMgQkFEIFVuZXhw
ZWN0ZWQgZXh0cmEgYXJndW1lbnQgdG8gTGlzdDogXCIlc1wiXHJcbiIsCisJCSAgICB0YWcsIGJ1
Zi5zKTsKKwlyZXR1cm4gRU9GOworICAgIH0KKworICAgIGlmIChjICE9ICcgJyB8fCAoYyA9IHBy
b3RfZ2V0YyhpbWFwZF9pbikpICE9ICcoJykgeworCXByb3RfcHJpbnRmKGltYXBkX291dCwKKwkJ
ICAgICIlcyBCQUQgTWlzc2luZyByZXR1cm4gYXJndW1lbnQgbGlzdFxyXG4iLCB0YWcpOworCXJl
dHVybiBFT0Y7CisgICAgfQorCisgICAgaWYgKCAoYyA9IHByb3RfZ2V0YyhpbWFwZF9pbikpID09
ICcpJykKKwlyZXR1cm4gcHJvdF9nZXRjKGltYXBkX2luKTsKKyAgICBlbHNlCisJcHJvdF91bmdl
dGMoYywgaW1hcGRfaW4pOworCisgICAgZm9yICg7OykgeworCWMgPSBnZXR3b3JkKGltYXBkX2lu
LCAmYnVmKTsKKworCWlmICghKmJ1Zi5zKSB7CisJICAgIHByb3RfcHJpbnRmKGltYXBkX291dCwK
KwkJCSIlcyBCQUQgSW52YWxpZCBzeW50YXggaW4gTGlzdCBjb21tYW5kXHJcbiIsIHRhZyk7CisJ
ICAgIHJldHVybiBFT0Y7CisJfQorCisJbGNhc2UoYnVmLnMpOworCisJaWYgKCFzdHJjbXAoYnVm
LnMsICJzdWJzY3JpYmVkIikpCisJICAgICpvcHRzIHw9IExJU1RfUkVUX1NVQlNDUklCRUQ7CisJ
ZWxzZSBpZiAoIXN0cmNtcChidWYucywgImNoaWxkcmVuIikpCisJICAgICpvcHRzIHw9IExJU1Rf
UkVUX0NISUxEUkVOOworCWVsc2UgeworCSAgICBwcm90X3ByaW50ZihpbWFwZF9vdXQsCisJCQki
JXMgQkFEIEludmFsaWQgTGlzdCByZXR1cm4gb3B0aW9uIFwiJXNcIlxyXG4iLAorCQkJdGFnLCBi
dWYucyk7CisJICAgIHJldHVybiBFT0Y7CisJfQorCisJaWYgKGMgIT0gJyAnKSBicmVhazsKKyAg
ICB9CisKKyAgICBpZiAoYyAhPSAnKScpIHsKKwlwcm90X3ByaW50ZihpbWFwZF9vdXQsCisJCSAg
ICAiJXMgQkFEIE1pc3NpbmcgY2xvc2UgcGFyZW50aGVzaXMgZm9yIExpc3QgcmV0dXJuIG9wdGlv
bnNcclxuIiwgdGFnKTsKKwlyZXR1cm4gRU9GOworICAgIH0KKworICAgIHJldHVybiBwcm90X2dl
dGMoaW1hcGRfaW4pOworfQorI2VuZGlmIC8qIEVOQUJMRV9MSVNUX0VYVEVOREVEICovCisKIC8q
CiAgKiBQYXJzZSBhIGRhdGVfdGltZSwgZm9yIHRoZSBBUFBFTkQgY29tbWFuZAogICovCkBAIC05
MTMxLDYgKzk1NDEsOCBAQAogICAgIHJldHVybiAwOwogfQogCisjaWZkZWYgRU5BQkxFX0xJU1RF
WFQKKwogLyoKICAqIElzc3VlIGEgTElTVCBvciBMU1VCIHVudGFnZ2VkIHJlc3BvbnNlCiAgKi8K
QEAgLTkyODUsNiArOTY5NywzNzggQEAKICAgICByZXR1cm4gMDsKIH0KIAorI2Vsc2UgLyogRU5B
QkxFX0xJU1RFWFQgKi8KKworc3RhdGljIGludCBzZXRfaGFzY2hpbGRyZW4oY2hhciAqbmFtZSwg
aW50IG1hdGNobGVuLCBpbnQgbWF5Y3JlYXRlLAorCQkJICAgaW50ICphdHRyaWJ1dGVzKQorewor
ICAgIGxpc3RfY2FsbGJhY2tfY2FsbHMrKzsKKyAgICBpZiAobmFtZVttYXRjaGxlbl0pIHsKKwkq
YXR0cmlidXRlcyB8PSBNQk9YX0FUVFJJQlVURV9IQVNDSElMRFJFTjsKKwlyZXR1cm4gMTsKKyAg
ICB9CisgICAgcmV0dXJuIDA7Cit9CisKKy8qIFByaW50IExJU1Qgb3IgTFNVQiB1bnRhZ2dlZCBy
ZXNwb25zZSAqLworc3RhdGljIHZvaWQgbGlzdF9yZXNwb25zZShjaGFyICpuYW1lLCBpbnQgYXR0
cmlidXRlcywgaW50IG9wdHMpCit7CisgICAgc3RydWN0IG1ib3hfbmFtZV9hdHRyaWJ1dGUgKmF0
dHI7CisgICAgY2hhciBpbnRlcm5hbF9uYW1lW01BWF9NQUlMQk9YX1BBVEgrMV07CisgICAgaW50
IHIsIG1idHlwZSwgZmlyc3QgPSAxOworICAgIGNoYXIgbWJveG5hbWVbTUFYX01BSUxCT1hfUEFU
SCsxXTsKKworICAgIGlmICghbmFtZSkKKwlyZXR1cm47CisKKyAgICAvKiBmaXJzdCBjb252ZXJ0
ICJJTkJPWCIgdG8gInVzZXIuPHVzZXJpZD4iICovCisgICAgaWYgKCFzdHJuY2FzZWNtcChuYW1l
LCAiaW5ib3giLCA1KQorICAgICAgICAgICAgJiYgKCFuYW1lWzVdIHx8IG5hbWVbNV0gPT0gJy4n
KSApIHsKKwkoKmltYXBkX25hbWVzcGFjZS5tYm94bmFtZV90b2ludGVybmFsKSgmaW1hcGRfbmFt
ZXNwYWNlLCAiSU5CT1giLAorCQkJCQkgICAgICAgaW1hcGRfdXNlcmlkLCBpbnRlcm5hbF9uYW1l
KTsKKwlzdHJsY2F0KGludGVybmFsX25hbWUsIG5hbWUrNSwgc2l6ZW9mKGludGVybmFsX25hbWUp
KTsKKyAgICB9CisgICAgZWxzZQorCXN0cmxjcHkoaW50ZXJuYWxfbmFtZSwgbmFtZSwgc2l6ZW9m
KGludGVybmFsX25hbWUpKTsKKworICAgIC8qIGdldCBpbmZvIGFuZCBzZXQgZmxhZ3MgKi8KKyAg
ICByID0gbWJveGxpc3RfZGV0YWlsKGludGVybmFsX25hbWUsICZtYnR5cGUsIE5VTEwsIE5VTEws
IE5VTEwsIE5VTEwsIE5VTEwpOworCisgICAgaWYgKHIgPT0gSU1BUF9NQUlMQk9YX05PTkVYSVNU
RU5UKQorCWF0dHJpYnV0ZXMgfD0gTUJPWF9BVFRSSUJVVEVfTk9ORVhJU1RFTlQgfCBNQk9YX0FU
VFJJQlVURV9OT1NFTEVDVDsKKyAgICBpZiAoIXIgJiYgKG1idHlwZSAmIE1CVFlQRV9SRVNFUlZF
KSkKKwlhdHRyaWJ1dGVzIHw9IE1CT1hfQVRUUklCVVRFX05PU0VMRUNUOworCisgICAgLyogZmln
dXJlIG91dCBcSGFzKE5vKUNoaWxkcmVuIGlmIG5lY2Vzc2FyeSAqLworICAgIGlmICggb3B0cyAm
IExJU1RfUkVUX0NISUxEUkVOCisJICAgICYmICEgKGF0dHJpYnV0ZXMgJiBNQk9YX0FUVFJJQlVU
RV9IQVNDSElMRFJFTikKKwkgICAgJiYgISAoYXR0cmlidXRlcyAmIE1CT1hfQVRUUklCVVRFX0hB
U05PQ0hJTERSRU4pICkgeworCW1ib3hsaXN0X2ZpbmRhbGwoJmltYXBkX25hbWVzcGFjZSwgbmFt
ZSwKKwkJCSBpbWFwZF91c2VyaXNhZG1pbiwgaW1hcGRfdXNlcmlkLCBpbWFwZF9hdXRoc3RhdGUs
CisJCQkgc2V0X2hhc2NoaWxkcmVuLCAmYXR0cmlidXRlcyk7CisJaWYgKCAhIChhdHRyaWJ1dGVz
ICYgTUJPWF9BVFRSSUJVVEVfSEFTQ0hJTERSRU4pICkKKwkgICAgYXR0cmlidXRlcyB8PSBNQk9Y
X0FUVFJJQlVURV9IQVNOT0NISUxEUkVOOworICAgIH0KKworICAgIGlmIChvcHRzICYgTElTVF9P
UFRfTFNVQikgeworCS8qIFxOb3NlbGVjdCBoYXMgYSBzcGVjaWFsIHNlY29uZCBtZWFuaW5nIHdp
dGggKFIpTFNVQiAqLworCWlmICggIShhdHRyaWJ1dGVzICYgTUJPWF9BVFRSSUJVVEVfU1VCU0NS
SUJFRCkKKwkJJiYgYXR0cmlidXRlcyAmIE1CT1hfQVRUUklCVVRFX0NISUxESU5GT19TVUJTQ1JJ
QkVEKQorCSAgICBhdHRyaWJ1dGVzIHw9IE1CT1hfQVRUUklCVVRFX05PU0VMRUNUOworCWF0dHJp
YnV0ZXMgJj0gfk1CT1hfQVRUUklCVVRFX1NVQlNDUklCRUQ7CisgICAgfQorCisgICAgLyogcmVt
b3ZlIHJlZHVuZGFudCBmbGFncyAqLworICAgIGlmIChvcHRzICYgTElTVF9PUFRfRVhURU5ERUQp
IHsKKwlpZiAob3B0cyAmIE1CT1hfQVRUUklCVVRFX05PSU5GRVJJT1JTKQorCSAgICBvcHRzICY9
IH5NQk9YX0FUVFJJQlVURV9IQVNDSElMRFJFTjsKKwlpZiAob3B0cyAmIE1CT1hfQVRUUklCVVRF
X05PTkVYSVNURU5UKQorCSAgICBvcHRzICY9IH5NQk9YX0FUVFJJQlVURV9OT1NFTEVDVDsKKyAg
ICB9CisKKyAgICBwcm90X3ByaW50ZihpbWFwZF9vdXQsICIqICVzICgiLAorCQkob3B0cyAmIExJ
U1RfT1BUX0xTVUIpID8gIkxTVUIiIDogIkxJU1QiKTsKKyAgICBmb3IgKGF0dHIgPSBtYm94X25h
bWVfYXR0cmlidXRlczsgYXR0ci0+aWQ7IGF0dHIrKykKKwlpZiAoYXR0cmlidXRlcyAmIGF0dHIt
PmZsYWcpIHsKKwkgICAgaWYgKGZpcnN0KSBmaXJzdCA9IDA7CisJICAgIGVsc2UgcHJvdF9wdXRj
KCcgJywgaW1hcGRfb3V0KTsKKwkgICAgcHJvdF9wcmludGYoaW1hcGRfb3V0LCBhdHRyLT5pZCk7
CisJfQorICAgIHByb3RfcHJpbnRmKGltYXBkX291dCwgIikgIik7CisKKyAgICBwcm90X3ByaW50
ZihpbWFwZF9vdXQsICJcIiVjXCIgIiwgaW1hcGRfbmFtZXNwYWNlLmhpZXJfc2VwKTsKKyAKKyAg
ICAoKmltYXBkX25hbWVzcGFjZS5tYm94bmFtZV90b2V4dGVybmFsKSgmaW1hcGRfbmFtZXNwYWNl
LCBuYW1lLAorICAgICAgICAgICAgaW1hcGRfdXNlcmlkLCBtYm94bmFtZSk7CisKKyAgICBwcmlu
dGFzdHJpbmcobWJveG5hbWUpOworCisgICAgaWYgKG9wdHMgJiBMSVNUX09QVF9FWFRFTkRFRCAm
JiBhdHRyaWJ1dGVzICYgbGlzdF9jaGlsZGluZm8pIHsKKwlwcm90X3ByaW50ZihpbWFwZF9vdXQs
ICIgKENISUxESU5GTyAoIik7CisJaWYgKGF0dHJpYnV0ZXMgJiBNQk9YX0FUVFJJQlVURV9DSElM
RElORk9fU1VCU0NSSUJFRCkKKwkgICAgcHJvdF9wcmludGYoaW1hcGRfb3V0LCAiU1VCU0NSSUJF
RCIpOworCXByb3RfcHJpbnRmKGltYXBkX291dCwgIikpIik7CisgICAgfQorCisgICAgcHJvdF9w
cmludGYoaW1hcGRfb3V0LCAiXHJcbiIpOworfQorCitzdGF0aWMgaW50IHNldF9zdWJzY3JpYmVk
KGNoYXIgKm5hbWUsIGludCBtYXRjaGxlbiwgaW50IG1heWNyZWF0ZSwKKwkJCSAgaW50ICphdHRy
aWJ1dGVzKQoreworICAgIGxpc3RfY2FsbGJhY2tfY2FsbHMrKzsKKyAgICBpZiAoIW5hbWVbbWF0
Y2hsZW5dKSAKKwkqYXR0cmlidXRlcyB8PSBNQk9YX0FUVFJJQlVURV9TVUJTQ1JJQkVEOworICAg
IHJldHVybiAxOworfQorCisvKiBjYWxsYmFjayBmb3IgbWJveGxpc3RfZmluZGFsbAorICogdXNl
ZCB3aGVuIHRoZSBTVUJTQ1JJQkVEIHNlbGVjdGlvbiBvcHRpb24gaXMgTk9UIGdpdmVuICovCitz
dGF0aWMgaW50IGxpc3RfY2IoY2hhciAqbmFtZSwgaW50IG1hdGNobGVuLCBpbnQgbWF5Y3JlYXRl
LAorCQkgIHN0cnVjdCBsaXN0X3JvY2sgKnJvY2spCit7CisgICAgaW50IGxhc3RfbGVuOworICAg
IGludCBsYXN0X25hbWVfaXNfYW5jZXN0b3IgPQorCXJvY2stPmxhc3RfbmFtZQorCSYmIG1hdGNo
bGVuID49IChsYXN0X2xlbiA9IHN0cmxlbihyb2NrLT5sYXN0X25hbWUpKQorCSYmIG5hbWVbbGFz
dF9sZW5dID09ICcuJworCSYmICFtZW1jbXAocm9jay0+bGFzdF9uYW1lLCBuYW1lLCBsYXN0X2xl
bik7CisKKyAgICBsaXN0X2NhbGxiYWNrX2NhbGxzKys7CisKKyAgICBpZiAobGFzdF9uYW1lX2lz
X2FuY2VzdG9yKQorCXJvY2stPmxhc3RfYXR0cmlidXRlcyB8PSBNQk9YX0FUVFJJQlVURV9IQVND
SElMRFJFTjsKKworICAgIGlmICghbmFtZVttYXRjaGxlbl0pIHsKKwlpZiAoICEgKHJvY2stPmxh
c3RfYXR0cmlidXRlcyAmIE1CT1hfQVRUUklCVVRFX0hBU0NISUxEUkVOKSApCisJICAgIHJvY2st
Pmxhc3RfYXR0cmlidXRlcyB8PSBNQk9YX0FUVFJJQlVURV9IQVNOT0NISUxEUkVOOworCWxpc3Rf
cmVzcG9uc2Uocm9jay0+bGFzdF9uYW1lLCByb2NrLT5sYXN0X2F0dHJpYnV0ZXMsIHJvY2stPm9w
dHMpOworCWZyZWUocm9jay0+bGFzdF9uYW1lKTsKKwlyb2NrLT5sYXN0X25hbWUgPSB4c3RyZHVw
KG5hbWUpOworCXJvY2stPmxhc3RfYXR0cmlidXRlcyA9IDA7CisJaWYgKCFtYXljcmVhdGUpCisJ
ICAgIHJvY2stPmxhc3RfYXR0cmlidXRlcyB8PSBNQk9YX0FUVFJJQlVURV9OT0lORkVSSU9SUzsK
KwkvKiB4eHg6IGlzIHRoZXJlIGEgY2hlYXBlciB3YXkgdG8gZmlndXJlIG91dCBcU3Vic2NyaWJl
ZD8gKi8KKwlpZiAocm9jay0+b3B0cyAmIExJU1RfUkVUX1NVQlNDUklCRUQpCisJICAgIG1ib3hs
aXN0X2ZpbmRzdWIoJmltYXBkX25hbWVzcGFjZSwgbmFtZSwgaW1hcGRfdXNlcmlzYWRtaW4sCisJ
CQkgICAgIGltYXBkX3VzZXJpZCwgaW1hcGRfYXV0aHN0YXRlLCBzZXRfc3Vic2NyaWJlZCwKKwkJ
CSAgICAgJnJvY2stPmxhc3RfYXR0cmlidXRlcywgMCk7CisgICAgfSBlbHNlIGlmIChuYW1lW21h
dGNobGVuXSA9PSAnLicKKwkgICAgJiYgISAocm9jay0+b3B0cyAmIExJU1RfT1BUX0VYVEVOREVE
KQorCSAgICAmJiByb2NrLT50cmFpbGluZ19wZXJjZW50KSB7CisJLyogc3BlY2lhbCBjYXNlOiBp
ZiB0aGUgbWFpbGJveCBuYW1lIGFyZ3VtZW50IG9mIGEgbm9uLWV4dGVuZGVkIExpc3QKKwkgKiBj
b21tYW5kIGVuZHMgd2l0aCAlLCB3ZSBtdXN0IGluY2x1ZGUgbWF0Y2hpbmcgbGV2ZWxzIG9mIGhp
ZXJhcmNoeSAqLworCW5hbWVbbWF0Y2hsZW5dID0gJ1wwJzsKKwlpZiAoICEgKHJvY2stPmxhc3Rf
bmFtZSAmJiAhc3RyY21wKHJvY2stPmxhc3RfbmFtZSwgbmFtZSkpICkgeworCSAgICBsaXN0X3Jl
c3BvbnNlKHJvY2stPmxhc3RfbmFtZSwgcm9jay0+bGFzdF9hdHRyaWJ1dGVzLCByb2NrLT5vcHRz
KTsKKwkgICAgZnJlZShyb2NrLT5sYXN0X25hbWUpOworCSAgICByb2NrLT5sYXN0X25hbWUgPSB4
c3RyZHVwKG5hbWUpOworCSAgICByb2NrLT5sYXN0X2F0dHJpYnV0ZXMgPSBNQk9YX0FUVFJJQlVU
RV9OT05FWElTVEVOVAorCQl8IE1CT1hfQVRUUklCVVRFX05PU0VMRUNUIHwgTUJPWF9BVFRSSUJV
VEVfSEFTQ0hJTERSRU47CisJfQorCW5hbWVbbWF0Y2hsZW5dID0gJy4nOworICAgIH0KKworICAg
IHJldHVybiAwOworfQorCisvKiBjYWxsYmFjayBmb3IgbWJveGxpc3RfZmluZHN1YgorICogdXNl
ZCB3aGVuIFNVQlNDUklCRUQgYnV0IG5vdCBSRUNVUlNJVkVNQVRDSCBpcyBnaXZlbiAqLworc3Rh
dGljIGludCBzdWJzY3JpYmVkX2NiKGNoYXIgKm5hbWUsIGludCBtYXRjaGxlbiwgaW50IG1heWNy
ZWF0ZSwKKwkJCSBzdHJ1Y3QgbGlzdF9yb2NrICpyb2NrKQoreworICAgIGxpc3RfY2FsbGJhY2tf
Y2FsbHMrKzsKKworICAgIGlmICghbmFtZVttYXRjaGxlbl0pIHsKKwlsaXN0X3Jlc3BvbnNlKHJv
Y2stPmxhc3RfbmFtZSwgcm9jay0+bGFzdF9hdHRyaWJ1dGVzLCByb2NrLT5vcHRzKTsKKwlmcmVl
KHJvY2stPmxhc3RfbmFtZSk7CisJcm9jay0+bGFzdF9uYW1lID0geHN0cmR1cChuYW1lKTsKKwly
b2NrLT5sYXN0X2F0dHJpYnV0ZXMgPSBNQk9YX0FUVFJJQlVURV9TVUJTQ1JJQkVEOworCWlmICgh
bWF5Y3JlYXRlKQorCSAgICByb2NrLT5sYXN0X2F0dHJpYnV0ZXMgfD0gTUJPWF9BVFRSSUJVVEVf
Tk9JTkZFUklPUlM7CisgICAgfSBlbHNlIGlmIChuYW1lW21hdGNobGVuXSA9PSAnLicKKwkgICAg
JiYgcm9jay0+b3B0cyAmIExJU1RfT1BUX0xTVUIKKwkgICAgJiYgcm9jay0+dHJhaWxpbmdfcGVy
Y2VudCkgeworCS8qIHNwZWNpYWwgY2FzZTogaWYgdGhlIG1haWxib3ggbmFtZSBhcmd1bWVudCBv
ZiBhbiBMc3ViIGNvbW1hbmQgZW5kcworCSAqIHdpdGggJSwgbWFpbGJveCBuYW1lcyB0aGF0IG1h
dGNoIHRoZSBwYXR0ZXJuIGJ1dCBhcmVuJ3Qgc3Vic2NyaWJlZAorCSAqIG11c3QgYWxzbyBiZSBy
ZXR1cm5lZCBpZiB0aGV5IGhhdmUgYSBjaGlsZCBtYWlsYm94IHRoYXQgaXMKKwkgKiBzdWJzY3Jp
YmVkICovCisJbmFtZVttYXRjaGxlbl0gPSAnXDAnOworCWlmICggISAocm9jay0+bGFzdF9uYW1l
ICYmICFzdHJjbXAocm9jay0+bGFzdF9uYW1lLCBuYW1lKSkgKSB7CisJICAgIGxpc3RfcmVzcG9u
c2Uocm9jay0+bGFzdF9uYW1lLCByb2NrLT5sYXN0X2F0dHJpYnV0ZXMsIHJvY2stPm9wdHMpOwor
CSAgICBmcmVlKHJvY2stPmxhc3RfbmFtZSk7CisJICAgIHJvY2stPmxhc3RfbmFtZSA9IHhzdHJk
dXAobmFtZSk7CisJICAgIHJvY2stPmxhc3RfYXR0cmlidXRlcyA9IE1CT1hfQVRUUklCVVRFX0NI
SUxESU5GT19TVUJTQ1JJQkVEOworCX0KKwluYW1lW21hdGNobGVuXSA9ICcuJzsKKyAgICB9CisK
KyAgICByZXR1cm4gMDsKK30KKworLyoKKyAqIFRha2VzIHRoZSAicmVmZXJlbmNlIG5hbWUiIGFu
ZCAibWFpbGJveCBuYW1lIiBhcmd1bWVudHMgb2YgdGhlIExJU1QgY29tbWFuZAorICogYW5kIHJl
dHVybnMgYSAiY2Fub25pY2FsIExJU1QgcGF0dGVybiIuIFRoZSBjYWxsZXIgaXMgcmVzcG9uc2li
bGUgZm9yCisgKiBmcmVlKClpbmcgdGhlIHJldHVybmVkIHN0cmluZy4KKyAqLworY2hhciAqY2Fu
b25pY2FsX2xpc3RfcGF0dGVybihjb25zdCBjaGFyICpyZWZlcmVuY2UsIGNvbnN0IGNoYXIgKnBh
dHRlcm4pCit7CisgICAgaW50IHBhdGxlbiA9IHN0cmxlbihwYXR0ZXJuKTsKKyAgICBpbnQgcmVm
bGVuID0gc3RybGVuKHJlZmVyZW5jZSk7CisKKyAgICBjaGFyICpidWYgPSB4bWFsbG9jKHBhdGxl
biArIHJlZmxlbiArIDEpOworICAgIGJ1ZlswXSA9ICdcMCc7CisKKyAgICBpZiAoKnJlZmVyZW5j
ZSkgeworCWlmIChyZWZlcmVuY2VbcmVmbGVuLTFdID09IGltYXBkX25hbWVzcGFjZS5oaWVyX3Nl
cCAmJgorCQlwYXR0ZXJuWzBdID09IGltYXBkX25hbWVzcGFjZS5oaWVyX3NlcCkKKwkgICAgLS1y
ZWZsZW47CisJbWVtY3B5KGJ1ZiwgcmVmZXJlbmNlLCByZWZsZW4pOworCWJ1ZltyZWZsZW5dID0g
J1wwJzsKKyAgICB9CisgICAgc3RyY2F0KGJ1ZiwgcGF0dGVybik7CisKKyAgICByZXR1cm4gYnVm
OworfQorCisvKgorICogVHVybnMgdGhlIHN0cmluZ3MgaW4gcGF0dGVybnMgaW50byAiY2Fub25p
Y2FsIExJU1QgcGF0dGVybiJzLiBBbHNvCisgKiB0cmFuc2xhdGVzIGFueSBoaWVyYXJjaHkgc2Vw
YXJhdG9ycy4KKyAqLwordm9pZCBjYW5vbmljYWxfbGlzdF9wYXR0ZXJucyhjaGFyICpyZWZlcmVu
Y2UsIHN0cnVjdCBzdHJsaXN0ICpwYXR0ZXJucykKK3sKKyAgICBzdGF0aWMgaW50IGlnbm9yZXJl
ZmVyZW5jZSA9IDA7CisgICAgY2hhciAqb2xkOworCisgICAgLyogSWdub3JlIHRoZSByZWZlcmVu
Y2UgYXJndW1lbnQ/CisgICAgICAgKHRoZSBiZWhhdmlvciBpbiAxLjUuMTAgJiBvbGRlcikgKi8K
KyAgICBpZiAoaWdub3JlcmVmZXJlbmNlID09IDApCisJaWdub3JlcmVmZXJlbmNlID0gY29uZmln
X2dldHN3aXRjaChJTUFQT1BUX0lHTk9SRVJFRkVSRU5DRSk7CisKKyAgICBmb3IgKDsgcGF0dGVy
bnM7IHBhdHRlcm5zID0gcGF0dGVybnMtPm5leHQpIHsKKwlpZiAoIWlnbm9yZXJlZmVyZW5jZSB8
fCBwYXR0ZXJucy0+c1swXSA9PSBpbWFwZF9uYW1lc3BhY2UuaGllcl9zZXApIHsKKwkgICAgb2xk
ID0gcGF0dGVybnMtPnM7CisJICAgIHBhdHRlcm5zLT5zID0gY2Fub25pY2FsX2xpc3RfcGF0dGVy
bihyZWZlcmVuY2UsIG9sZCk7CisJICAgIGZyZWUob2xkKTsKKwl9CisJLyogVHJhbnNsYXRlIGFu
eSBzZXBhcmF0b3JzIGluIHBhdHRlcm4gKi8KKwltYm94bmFtZV9oaWVyc2VwX3RvaW50ZXJuYWwo
JmltYXBkX25hbWVzcGFjZSwgcGF0dGVybnMtPnMsCisJCQkJICAgIGNvbmZpZ192aXJ0ZG9tYWlu
cyA/CisJCQkJICAgIHN0cmNzcG4ocGF0dGVybnMtPnMsICJAIikgOiAwKTsKKyAgICB9Cit9CisK
Ky8qIFJldHJpZXZlcyB0aGUgZGF0YSBhbmQgcHJpbnRzIHRoZSB1bnRhZ2dlZCByZXNwb25zZXMg
Zm9yIGEgTElTVCBjb21tYW5kLiAqLworc3RhdGljIHZvaWQgbGlzdF9kYXRhKGNoYXIgKnJlZmVy
ZW5jZSwgaW50IGxpc3RvcHRzLCBzdHJ1Y3Qgc3RybGlzdCAqcGF0dGVybnMpCit7CisgICAgaW50
ICgqZmluZGFsbCkoc3RydWN0IG5hbWVzcGFjZSAqbmFtZXNwYWNlLAorCQkgICBjb25zdCBjaGFy
ICpwYXR0ZXJuLCBpbnQgaXNhZG1pbiwgY2hhciAqdXNlcmlkLAorCQkgICBzdHJ1Y3QgYXV0aF9z
dGF0ZSAqYXV0aF9zdGF0ZSwgaW50ICgqcHJvYykoKSwKKwkJICAgdm9pZCAqcm9jayk7CisgICAg
aW50ICgqZmluZHN1Yikoc3RydWN0IG5hbWVzcGFjZSAqbmFtZXNwYWNlLAorCQkgICBjb25zdCBj
aGFyICpwYXR0ZXJuLCBpbnQgaXNhZG1pbiwgY2hhciAqdXNlcmlkLAorCQkgICBzdHJ1Y3QgYXV0
aF9zdGF0ZSAqYXV0aF9zdGF0ZSwgaW50ICgqcHJvYykoKSwKKwkJICAgdm9pZCAqcm9jaywgaW50
IGZvcmNlKTsKKyAgICBzdHJ1Y3Qgc3RybGlzdCAqcGF0dGVybjsKKyAgICBzdHJ1Y3QgbGlzdF9y
b2NrIHJvY2s7CisKKyAgICBjYW5vbmljYWxfbGlzdF9wYXR0ZXJucyhyZWZlcmVuY2UsIHBhdHRl
cm5zKTsKKworICAgIC8qIENoZWNrIHRvIHNlZSBpZiB3ZSBzaG91bGQgb25seSBsaXN0IHRoZSBw
ZXJzb25hbCBuYW1lc3BhY2UgKi8KKyAgICBpZiAoIShsaXN0b3B0cyAmIExJU1RfT1BUX0VYVEVO
REVEKQorCSAgICAmJiAhc3RyY21wKHBhdHRlcm5zLT5zLCAiKiIpCisJICAgICYmIGNvbmZpZ19n
ZXRzd2l0Y2goSU1BUE9QVF9GT09MU1RVUElEQ0xJRU5UUykpIHsKKwlmcmVlKHBhdHRlcm5zLT5z
KTsKKwlwYXR0ZXJucy0+cyA9IHhzdHJkdXAoIklOQk9YKiIpOworCWZpbmRzdWIgPSBtYm94bGlz
dF9maW5kc3ViOworCWZpbmRhbGwgPSBtYm94bGlzdF9maW5kYWxsOworICAgIH0gZWxzZSB7CisJ
ZmluZHN1YiA9IGltYXBkX25hbWVzcGFjZS5tYm94bGlzdF9maW5kc3ViOworCWZpbmRhbGwgPSBp
bWFwZF9uYW1lc3BhY2UubWJveGxpc3RfZmluZGFsbDsKKyAgICB9CisKKyAgICByb2NrLm9wdHMg
PSBsaXN0b3B0czsKKyAgICByb2NrLmxhc3RfbmFtZSA9IE5VTEw7CisKKyAgICBpZiAobGlzdG9w
dHMgJiBMSVNUX1NFTF9TVUJTQ1JJQkVEKSB7CisJZm9yIChwYXR0ZXJuID0gcGF0dGVybnM7IHBh
dHRlcm47IHBhdHRlcm4gPSBwYXR0ZXJuLT5uZXh0KSB7CisJICAgIHJvY2sudHJhaWxpbmdfcGVy
Y2VudCA9IHBhdHRlcm4tPnNbc3RybGVuKHBhdHRlcm4tPnMpIC0gMV0gPT0gJyUnOworCSAgICBm
aW5kc3ViKCZpbWFwZF9uYW1lc3BhY2UsIHBhdHRlcm4tPnMsIGltYXBkX3VzZXJpc2FkbWluLAor
CQkgICAgaW1hcGRfdXNlcmlkLCBpbWFwZF9hdXRoc3RhdGUsIHN1YnNjcmliZWRfY2IsICZyb2Nr
LCAxKTsKKwkgICAgbGlzdF9yZXNwb25zZShyb2NrLmxhc3RfbmFtZSwgcm9jay5sYXN0X2F0dHJp
YnV0ZXMsIHJvY2sub3B0cyk7CisJICAgIGZyZWUocm9jay5sYXN0X25hbWUpOworCSAgICByb2Nr
Lmxhc3RfbmFtZSA9IE5VTEw7CisJfQorICAgIH0gZWxzZSB7CisJcm9jay5vcHRzIHw9IExJU1Rf
UkVUX0NISUxEUkVOOworCWZvciAocGF0dGVybiA9IHBhdHRlcm5zOyBwYXR0ZXJuOyBwYXR0ZXJu
ID0gcGF0dGVybi0+bmV4dCkgeworCSAgICByb2NrLnRyYWlsaW5nX3BlcmNlbnQgPSBwYXR0ZXJu
LT5zW3N0cmxlbihwYXR0ZXJuLT5zKSAtIDFdID09ICclJzsKKwkgICAgZmluZGFsbCgmaW1hcGRf
bmFtZXNwYWNlLCBwYXR0ZXJuLT5zLCBpbWFwZF91c2VyaXNhZG1pbiwKKwkJICAgIGltYXBkX3Vz
ZXJpZCwgaW1hcGRfYXV0aHN0YXRlLCBsaXN0X2NiLCAmcm9jayk7CisJICAgIGxpc3RfcmVzcG9u
c2Uocm9jay5sYXN0X25hbWUsIHJvY2subGFzdF9hdHRyaWJ1dGVzLCByb2NrLm9wdHMpOworCSAg
ICBmcmVlKHJvY2subGFzdF9uYW1lKTsKKwkgICAgcm9jay5sYXN0X25hbWUgPSBOVUxMOworCX0K
KyAgICB9Cit9CisKKy8qCisgKiBSZXRyaWV2ZXMgdGhlIGRhdGEgYW5kIHByaW50cyB0aGUgdW50
YWdnZWQgcmVzcG9uc2VzIGZvciBhIExJU1QgY29tbWFuZCBpbgorICogdGhlIGNhc2Ugb2YgYSBy
ZW1vdGUgaW5ib3guCisgKi8KK3N0YXRpYyB2b2lkIGxpc3RfZGF0YV9yZW1vdGUoY2hhciAqdGFn
LCBpbnQgbGlzdG9wdHMsIGNoYXIgKnJlZmVyZW5jZSwKKwkJCSAgICAgc3RydWN0IHN0cmxpc3Qg
KnBhdHRlcm4pCit7CisgICAgaWYgKGxpc3RvcHRzICYgTElTVF9PUFRfRVhURU5ERUQKKwkgICAg
JiYgIUNBUEEoYmFja2VuZF9pbmJveCwgQ0FQQV9MSVNURVhURU5ERUQpKSB7CisJLyogY2xpZW50
IHdhbnRzIHRvIHVzZSBleHRlbmRlZCBsaXN0IGNvbW1hbmQgYnV0IGJhY2tlbmQgZG9lc24ndAor
CSAqIHN1cHBvcnQgaXQgKi8KKwlwcm90X3ByaW50ZihiYWNrZW5kX2luYm94LT5vdXQsCisJCSAg
ICAiJXMgTk8gQmFja2VuZCBzZXJ2ZXIgZG9lcyBub3Qgc3VwcG9ydCBleHRlbmRlZCBsaXN0IGNv
bW1hbmRcclxuIiwKKwkJICAgIHRhZyk7CisJcmV0dXJuOworICAgIH0KKworICAgIC8qIHByaW50
IHRhZywgY29tbWFuZCBhbmQgbGlzdCBzZWxlY3Rpb24gb3B0aW9ucyAqLworICAgIGlmIChsaXN0
b3B0cyAmIExJU1RfT1BUX0VYVEVOREVEKSB7CisJaW50IGZpcnN0ID0gMTsKKwlwcm90X3ByaW50
ZihiYWNrZW5kX2luYm94LT5vdXQsICIlcyBMaXN0ICgiLCB0YWcpOworCWlmIChsaXN0b3B0cyAm
IExJU1RfU0VMX1NVQlNDUklCRUQpIHsKKwkgICAgcHJvdF9wcmludGYoYmFja2VuZF9pbmJveC0+
b3V0LCAic3Vic2NyaWJlZCIpOworCSAgICBmaXJzdCA9IDA7CisJfQorCWlmIChsaXN0b3B0cyAm
IExJU1RfU0VMX1JFTU9URSkgeworCSAgICBwcm90X3ByaW50ZihiYWNrZW5kX2luYm94LT5vdXQs
ICIgcmVtb3RlIitmaXJzdCk7CisJICAgIGZpcnN0ID0gMDsKKwl9CisJaWYgKGxpc3RvcHRzICYg
TElTVF9TRUxfUkVDVVJTSVZFTUFUQ0gpCisJICAgIHByb3RfcHJpbnRmKGJhY2tlbmRfaW5ib3gt
Pm91dCwgIiByZWN1cnNpdmVtYXRjaCIrZmlyc3QpOworCXByb3RfcHJpbnRmKGJhY2tlbmRfaW5i
b3gtPm91dCwgIikgIik7CisgICAgfSBlbHNlIHsKKwlwcm90X3ByaW50ZihiYWNrZW5kX2luYm94
LT5vdXQsICIlcyBMc3ViICIsIHRhZyk7CisgICAgfQorCisgICAgLyogcHJpbnQgcmVmZXJlbmNl
IGFyZ3VtZW50ICovCisgICAgcHJvdF9wcmludGYoYmFja2VuZF9pbmJveC0+b3V0LAorCQkieyVk
K31cclxuJXMgIiwgc3RybGVuKHJlZmVyZW5jZSksIHJlZmVyZW5jZSk7CisKKyAgICAvKiBwcmlu
dCBtYWlsYm94IHBhdHRlcm4ocykgKi8KKyAgICBpZiAocGF0dGVybi0+bmV4dCkgeworCWludCBm
aXJzdCA9IDE7CisJcHJvdF9wdXRjKCcoJywgYmFja2VuZF9pbmJveC0+b3V0KTsKKwlmb3IgKDsg
cGF0dGVybjsgcGF0dGVybiA9IHBhdHRlcm4tPm5leHQpIHsKKwkgICAgcHJvdF9wcmludGYoYmFj
a2VuZF9pbmJveC0+b3V0LCAKKwkJCSIgeyVkK31cclxuJXMiK2ZpcnN0LCBzdHJsZW4ocGF0dGVy
bi0+cyksIHBhdHRlcm4tPnMpOworCSAgICBmaXJzdCA9IDA7CisJfQorCXByb3RfcHV0YygnKScs
IGJhY2tlbmRfaW5ib3gtPm91dCk7CisgICAgfSBlbHNlIHsKKwlwcm90X3ByaW50ZihiYWNrZW5k
X2luYm94LT5vdXQsIAorCQkgICAgInslZCt9XHJcbiVzIiwgc3RybGVuKHBhdHRlcm4tPnMpLCBw
YXR0ZXJuLT5zKTsKKwlwYXR0ZXJuID0gcGF0dGVybi0+bmV4dDsKKyAgICB9CisKKyAgICAvKiBw
cmludCBsaXN0IHJldHVybiBvcHRpb25zICovCisgICAgaWYgKGxpc3RvcHRzICYgbGlzdF9yZXRf
b3B0cykgeworCXByb3RfcHJpbnRmKGJhY2tlbmRfaW5ib3gtPm91dCwgIiByZXR1cm4gKCIpOwor
CWludCBmaXJzdCA9IDE7CisJaWYgKGxpc3RvcHRzICYgTElTVF9SRVRfU1VCU0NSSUJFRCkgewor
CSAgICBwcm90X3ByaW50ZihiYWNrZW5kX2luYm94LT5vdXQsICJzdWJzY3JpYmVkIik7CisJICAg
IGZpcnN0ID0gMDsKKwl9CisJaWYgKGxpc3RvcHRzICYgTElTVF9SRVRfQ0hJTERSRU4pIHsKKwkg
ICAgcHJvdF9wcmludGYoYmFja2VuZF9pbmJveC0+b3V0LCAiIGNoaWxkcmVuIitmaXJzdCk7CisJ
fQorCXByb3RfcHV0YygnKScsIGJhY2tlbmRfaW5ib3gtPm91dCk7CisgICAgfQorCisgICAgcHJv
dF9wcmludGYoYmFja2VuZF9pbmJveC0+b3V0LCAiXHJcbiIpOworICAgIHBpcGVfbHN1YihiYWNr
ZW5kX2luYm94LCB0YWcsIDAsCisJICAgICAgKGxpc3RvcHRzICYgTElTVF9PUFRfTFNVQikgPyAi
TFNVQiIgOiAiTElTVCIpOworfQorCisjZW5kaWYgLyogRU5BQkxFX0xJU1RFWFQgKi8KKwogLyog
UmVzZXQgdGhlIGdpdmVuIHNhc2xfY29ubl90IHRvIGEgc2FuZSBzdGF0ZSAqLwogc3RhdGljIGlu
dCByZXNldF9zYXNsY29ubihzYXNsX2Nvbm5fdCAqKmNvbm4pIAogewpkaWZmIC1OYXVyQmIgLS1l
eGNsdWRlPS5zdm4gLi4vYnJhbmNoZXMvY3lydXNoZWFkL2ltYXAvaW1hcGQuaCAuL2ltYXAvaW1h
cGQuaAotLS0gLi4vYnJhbmNoZXMvY3lydXNoZWFkL2ltYXAvaW1hcGQuaAkyMDA2LTAzLTMxIDIx
OjIyOjIxLjAwMDAwMDAwMCArMDIwMAorKysgLi9pbWFwL2ltYXBkLmgJMjAwNi0wOC0yNCAxNTox
MDozMS4wMDAwMDAwMDAgKzAyMDAKQEAgLTIyNSw2ICsyMjUsOCBAQAogICAgIFNUQVRVU19ISUdI
RVNUTU9EU0VRID0JKDE8PDUpCiB9OwogCisjaWZkZWYgRU5BQkxFX0xJU1RFWFQKKwogLyogQml0
bWFzayBmb3IgbGlzdCBvcHRpb25zICovCiBlbnVtIHsKICAgICBMSVNUX0xTVUIgPQkJCSgxPDww
KSwKQEAgLTIzNCw2ICsyMzYsNTAgQEAKICAgICBMSVNUX1JFTU9URSA9CQkoMTw8NCkKIH07CiAK
KyNlbHNlIC8qIEVOQUJMRV9MSVNURVhUICovCisKK2VudW0geworICAgIC8qIExJU1Qgc2VsZWN0
aW9uIG9wdGlvbnMgKi8KKyAgICBMSVNUX1NFTF9TVUJTQ1JJQkVEID0JKDE8PDApLAorICAgIExJ
U1RfU0VMX1JFTU9URSA9CQkoMTw8MSksCisgICAgTElTVF9TRUxfUkVDVVJTSVZFTUFUQ0ggPQko
MTw8MiksCisKKyAgICAvKiBMSVNUIHJldHVybiBvcHRpb25zICovCisgICAgTElTVF9SRVRfU1VC
U0NSSUJFRCA9CSgxPDw4KSwKKyAgICBMSVNUX1JFVF9DSElMRFJFTiA9CQkoMTw8OSksCisKKyAg
ICAvKiBvdGhlciBvcHRpb25zICovCisgICAgTElTVF9PUFRfUkxJU1QgPSAgICAgICAgICAgICgx
PDwxNiksCisgICAgTElTVF9PUFRfTFNVQiA9ICAgICAgICAgICAgICgxPDwxNyksCisgICAgTElT
VF9PUFRfRVhURU5ERUQgPSAgICAgICAgICgxPDwxOCksIC8qIGV4dGVuZGVkIExpc3QgY29tbWFu
ZCAqLworICAgIC8qIC4uLiBhcyBzcGVjaWZpZWQgaW4gZHJhZnQtaWV0Zi1pbWFwZXh0LWxpc3Qt
ZXh0ZW5zaW9ucy0wMy50eHQgKi8KKyAgICBMSVNUX09QVF9FWFRFTkRFRF9WMDMgPSAgICAgKDE8
PDE5KSwKKyAgICAvKiAuLi4gYXMgc3BlY2lmaWVkIGluIGRyYWZ0LWlldGYtaW1hcGV4dC1saXN0
LWV4dGVuc2lvbnMtMTcudHh0ICovCisgICAgTElTVF9PUFRfRVhURU5ERURfVjE3ID0gICAgICgx
PDwyMCkKK307CisjZGVmaW5lIGxpc3Rfc2VsX29wdHMgKExJU1RfUkVUX1NVQlNDUklCRUQgLSAx
KQorI2RlZmluZSBsaXN0X3JldF9vcHRzICgoTElTVF9PUFRfUkxJU1QgLSAxKSAmIH5saXN0X3Nl
bF9vcHRzKQorCisvKiBOYW1lIGF0dHJpYnV0ZXMgdGhhdCBtYXkgYmUgcmV0dW5lZCBieSBMSVNU
ICovCitlbnVtIHsKKyAgICAvKiBmcm9tIFJGQyAzNTAxICovCisgICAgTUJPWF9BVFRSSUJVVEVf
Tk9JTkZFUklPUlMgICA9ICgxPDwwKSwKKyAgICBNQk9YX0FUVFJJQlVURV9OT1NFTEVDVCAgICAg
ID0gKDE8PDEpLAorICAgIE1CT1hfQVRUUklCVVRFX01BUktFRCAgICAgICAgPSAoMTw8MiksCisg
ICAgTUJPWF9BVFRSSUJVVEVfVU5NQVJLRUQgICAgICA9ICgxPDwzKSwKKworICAgIC8qIGZyb20g
ZHJhZnQtaWV0Zi1pbWFwZXh0LWxpc3QtZXh0ZW5zaW9ucy0xNy50eHQgKi8KKyAgICBNQk9YX0FU
VFJJQlVURV9OT05FWElTVEVOVCAgID0gKDE8PDQpLAorICAgIE1CT1hfQVRUUklCVVRFX1NVQlND
UklCRUQgICAgPSAoMTw8NSksCisgICAgTUJPWF9BVFRSSUJVVEVfUkVNT1RFICAgICAgICA9ICgx
PDw2KSwKKyAgICBNQk9YX0FUVFJJQlVURV9IQVNDSElMRFJFTiAgID0gKDE8PDcpLAorICAgIE1C
T1hfQVRUUklCVVRFX0hBU05PQ0hJTERSRU4gPSAoMTw8OCksCisgICAgTUJPWF9BVFRSSUJVVEVf
Q0hJTERJTkZPX1NVQlNDUklCRUQgPSAoMTw8OSkKK307CisjZGVmaW5lIGxpc3RfY2hpbGRpbmZv
IChNQk9YX0FUVFJJQlVURV9DSElMRElORk9fU1VCU0NSSUJFRCkKKworI2VuZGlmIC8qIEVOQUJM
RV9MSVNURVhUICovCisKIGV4dGVybiBzdHJ1Y3QgcHJvdHN0cmVhbSAqaW1hcGRfb3V0LCAqaW1h
cGRfaW47CiAKIGV4dGVybiB2b2lkIGluZGV4X2Nsb3NlbWFpbGJveChzdHJ1Y3QgbWFpbGJveCAq
bWFpbGJveCk7CmRpZmYgLU5hdXJCYiAtLWV4Y2x1ZGU9LnN2biAuLi9icmFuY2hlcy9jeXJ1c2hl
YWQvaW1hcC9wcm90b2NvbC5jIC4vaW1hcC9wcm90b2NvbC5jCi0tLSAuLi9icmFuY2hlcy9jeXJ1
c2hlYWQvaW1hcC9wcm90b2NvbC5jCTIwMDYtMDgtMDIgMTc6MTY6MjAuMDAwMDAwMDAwICswMjAw
CisrKyAuL2ltYXAvcHJvdG9jb2wuYwkyMDA2LTA4LTExIDEzOjM5OjI1LjAwMDAwMDAwMCArMDIw
MApAQCAtMTE1LDYgKzExNSw3IEBACiAJICB7ICIgTVVMVElBUFBFTkQiLCBDQVBBX01VTFRJQVBQ
RU5EIH0sCiAJICB7ICIgTElTVC1TVUJTQ1JJQkVEIiwgQ0FQQV9MSVNUU1VCU0NSSUJFRCB9LAog
CSAgeyAiIFJJR0hUUz1reHRlIiwgQ0FQQV9BQ0xSSUdIVFMgfSwKKwkgIHsgIiBMSVNULUVYVEVO
REVEIiwgQ0FQQV9MSVNURVhURU5ERUQgfSwKIAkgIHsgTlVMTCwgMCB9IH0gfSwKICAgICAgIHsg
IlMwMSBTVEFSVFRMUyIsICJTMDEgT0siLCAiUzAxIE5PIiB9LAogICAgICAgeyAiQTAxIEFVVEhF
TlRJQ0FURSIsIDAsIDAsICJBMDEgT0siLCAiQTAxIE5PIiwgIisgIiwgIioiLCBOVUxMIH0sCmRp
ZmYgLU5hdXJCYiAtLWV4Y2x1ZGU9LnN2biAuLi9icmFuY2hlcy9jeXJ1c2hlYWQvaW1hcC9wcm90
b2NvbC5oIC4vaW1hcC9wcm90b2NvbC5oCi0tLSAuLi9icmFuY2hlcy9jeXJ1c2hlYWQvaW1hcC9w
cm90b2NvbC5oCTIwMDYtMDgtMDIgMTc6MTY6MjAuMDAwMDAwMDAwICswMjAwCisrKyAuL2ltYXAv
cHJvdG9jb2wuaAkyMDA2LTA4LTExIDEzOjM5OjI1LjAwMDAwMDAwMCArMDIwMApAQCAtNTcsMTMg
KzU3LDE0IEBACiAgICAgQ0FQQV9NVUxUSUFQUEVORAk9ICgxIDw8IDQpLAogICAgIENBUEFfTElT
VFNVQlNDUklCRUQJPSAoMSA8PCA1KSwKICAgICBDQVBBX0FDTFJJR0hUUwk9ICgxIDw8IDYpLAor
ICAgIENBUEFfTElTVEVYVEVOREVEICAgPSAoMSA8PCA3KSwKIAogICAgIC8qIExNVFAgY2FwYWJp
bGl0aWVzICovCiAgICAgQ0FQQV9QSVBFTElOSU5HCT0gKDEgPDwgMiksCiAgICAgQ0FQQV9JR05P
UkVRVU9UQQk9ICgxIDw8IDMpCiB9OwogCi0jZGVmaW5lIE1BWF9DQVBBIDcKKyNkZWZpbmUgTUFY
X0NBUEEgOAogCiBzdHJ1Y3QgY2FwYV90IHsKICAgICBjb25zdCBjaGFyICpzdHI7Cg==
</data>        

          </attachment>
          <attachment
              isobsolete="1"
              ispatch="1"
              isprivate="0"
          >
            <attachid>459</attachid>
            <date>2006-09-18 12:34 EDT</date>
            <desc>Improve patch which fixes LIST &quot;&quot; &quot;*%&quot;</desc>
            <filename>cyrus-listext.p55</filename>
            <type>text/plain</type>
            <size>32563</size>
            <attacher>martin.konold@erfrakon.de</attacher>
            
              <data encoding="base64">ZGlmZiAtTmF1cmIgLS1leGNsdWRlPS5zdm4gYnJhbmNoZXMvY3lydXNoZWFkL2NvbmZpZ3VyZS5p
biB0cnVuay9jb25maWd1cmUuaW4KLS0tIGJyYW5jaGVzL2N5cnVzaGVhZC9jb25maWd1cmUuaW4J
MjAwNS0wNC0xMiAyMjowNToyMC4wMDAwMDAwMDAgKzAyMDAKKysrIHRydW5rL2NvbmZpZ3VyZS5p
bgkyMDA2LTA4LTI0IDE1OjA1OjE1LjAwMDAwMDAwMCArMDIwMApAQCAtOTMzLDEyICs5MzMsMjgg
QEAKIAlmaSwKIAlBQ19NU0dfUkVTVUxUKG5vKSkKIAorRU5BQkxFX0xJU1RFWFQ9bm8KIEFDX0FS
R19FTkFCTEUobGlzdGV4dCwKLQlbICAtLWVuYWJsZS1saXN0ZXh0ICAgICAgICBlbmFibGUgSU1B
UCBMaXN0IGV4dGVuc2lvbnNdLAorCVsgIC0tZW5hYmxlLWxpc3RleHQgICAgICAgIGVuYWJsZSBJ
TUFQIExJU1RFWFQgTGlzdCBleHRlbnNpb25zXSwKKwlFTkFCTEVfTElTVEVYVD0kZW5hYmxldmFs
CiAJaWYgdGVzdCAiJGVuYWJsZXZhbCIgPSB5ZXM7IHRoZW4KIAkJQUNfREVGSU5FKEVOQUJMRV9M
SVNURVhULFtdLFtFbmFibGUgdGhlIExJU1RFWFQgZXh0ZW5zaW9uP10pCiAJZmkpCiAKK0VOQUJM
RV9MSVNUX0VYVEVOREVEPW5vCitBQ19BUkdfRU5BQkxFKGxpc3QtZXh0ZW5kZWQsCisJWyAgLS1l
bmFibGUtbGlzdC1leHRlbmRlZCAgZW5hYmxlIElNQVAgTElTVC1FWFRFTkRFRCBMaXN0IGV4dGVu
c2lvbnNdLAorCUVOQUJMRV9MSVNUX0VYVEVOREVEPSRlbmFibGV2YWwKKwlpZiB0ZXN0ICIkZW5h
YmxldmFsIiA9IHllczsgdGhlbgorCQlBQ19ERUZJTkUoRU5BQkxFX0xJU1RfRVhURU5ERUQsW10s
W0VuYWJsZSB0aGUgTElTVC1FWFRFTkRFRCBleHRlbnNpb24/XSkKKwlmaSkKKworaWYgdGVzdCAi
JEVOQUJMRV9MSVNURVhUIiAhPSBubzsgdGhlbgorICAgIGlmIHRlc3QgIiRFTkFCTEVfTElTVF9F
WFRFTkRFRCIgIT0gbm87IHRoZW4KKwlBQ19FUlJPUihDYW5ub3QgZW5hYmxlIGJvdGggTElTVEVY
VCBhbmQgTElTVC1FWFRFTkRFRCkKKyAgICBmaQorZmkKKwogQUNfQVJHX0VOQUJMRShuZXRzY2Fw
ZWhhY2ssCiAJWyAgLS1lbmFibGUtbmV0c2NhcGVoYWNrICAgZW5hYmxlIE5ldHNjYXBlIGhhY2sg
Zm9yIHRoZSBtZW51IG9wdGlvbgogICAgICAgICAgICAgICAgICAgICAgICAgICBpbiBDb21tdW5p
Y2F0b3IgdG8gQWRtaW5pc3RyYXRlIE1haWxdLApkaWZmIC1OYXVyYiAtLWV4Y2x1ZGU9LnN2biBi
cmFuY2hlcy9jeXJ1c2hlYWQvZG9jL3NwZWNzLmh0bWwgdHJ1bmsvZG9jL3NwZWNzLmh0bWwKLS0t
IGJyYW5jaGVzL2N5cnVzaGVhZC9kb2Mvc3BlY3MuaHRtbAkyMDA2LTA2LTE2IDE3OjEwOjI4LjAw
MDAwMDAwMCArMDIwMAorKysgdHJ1bmsvZG9jL3NwZWNzLmh0bWwJMjAwNi0wOC0xMSAxMzozOToy
Ni4wMDAwMDAwMDAgKzAyMDAKQEAgLTU0LDcgKzU0LDcgQEAKIDxUUj48VEQ+PEEgSFJFRj0iaHR0
cDovL3d3dy5pZXRmLm9yZy9pbnRlcm5ldC1kcmFmdHMvZHJhZnQtaWV0Zi1pbWFwZXh0LXNvcnQt
MTcudHh0Ij4KIGRyYWZ0LWlldGYtaW1hcGV4dC1zb3J0PC9BPjwvVEQ+CiA8VEQ+SU1BUCBTT1JU
IGFuZCBUSFJFQUQgRXh0ZW5zaW9uPC9URD48L1RSPgotPFRSPjxURD48QSBIUkVGPSJodHRwOi8v
d3d3LmlldGYub3JnL2ludGVybmV0LWRyYWZ0cy9kcmFmdC1pZXRmLWltYXBleHQtbGlzdC1leHRl
bnNpb25zLTEzLnR4dCI+Cis8VFI+PFREPjxBIEhSRUY9Imh0dHA6Ly93d3cuaWV0Zi5vcmcvaW50
ZXJuZXQtZHJhZnRzL2RyYWZ0LWlldGYtaW1hcGV4dC1saXN0LWV4dGVuc2lvbnMtMTcudHh0Ij4K
IGRyYWZ0LWlldGYtaW1hcGV4dC1saXN0LWV4dGVuc2lvbnM8L0E+PC9URD4KIDxURD5JTUFQNCBM
SVNUIENvbW1hbmQgRXh0ZW5zaW9uczwvVEQ+PC9UUj4KIDxUUj48VEQ+PEEgSFJFRj0iaHR0cDov
L3d3dy5pZXRmLm9yZy9pbnRlcm5ldC1kcmFmdHMvZHJhZnQtZGFib28taW1hcC1hbm5vdGF0ZW1v
cmUtMDkudHh0Ij4KZGlmZiAtTmF1cmIgLS1leGNsdWRlPS5zdm4gYnJhbmNoZXMvY3lydXNoZWFk
L2ltYXAvaW1hcGQuYyB0cnVuay9pbWFwL2ltYXBkLmMKLS0tIGJyYW5jaGVzL2N5cnVzaGVhZC9p
bWFwL2ltYXBkLmMJMjAwNi0wOS0xNSAxNDo1NDoyNi4wMDAwMDAwMDAgKzAyMDAKKysrIHRydW5r
L2ltYXAvaW1hcGQuYwkyMDA2LTA5LTE4IDEyOjA0OjQ2LjAwMDAwMDAwMCArMDIwMApAQCAtMTU1
LDYgKzE1NSw3IEBACiBzdGF0aWMgc2FzbF9jb25uX3QgKmltYXBkX3Nhc2xjb25uOyAvKiB0aGUg
c2FzbCBjb25uZWN0aW9uIGNvbnRleHQgKi8KIHN0YXRpYyBpbnQgaW1hcGRfc3RhcnR0bHNfZG9u
ZSA9IDA7IC8qIGhhdmUgd2UgZG9uZSBhIHN1Y2Nlc3NmdWwgc3RhcnR0bHM/ICovCiBjb25zdCBj
aGFyICpwbGFpbnRleHRsb2dpbmFsZXJ0ID0gTlVMTDsKKwogI2lmZGVmIEhBVkVfU1NMCiAvKiBv
dXIgdGxzIGNvbm5lY3Rpb24sIGlmIGFueSAqLwogc3RhdGljIFNTTCAqdGxzX2Nvbm4gPSBOVUxM
OwpAQCAtMTk0LDYgKzE5NSw0OCBAQAogICAgIDMxLCAzMSwgMzAsIDMxLCAzMCwgMzEKIH07CiAK
KyNpZm5kZWYgRU5BQkxFX0xJU1RFWFQKK3N0YXRpYyBzdHJ1Y3QgbWJveF9uYW1lX2F0dHJpYnV0
ZSB7CisgICAgaW50IGZsYWc7CisgICAgY2hhciAqaWQ7Cit9IG1ib3hfbmFtZV9hdHRyaWJ1dGVz
W10gPSB7CisgICAgLyogZnJvbSBSRkMgMzUwMSAqLworICAgIHsgTUJPWF9BVFRSSUJVVEVfTk9J
TkZFUklPUlMsICAgIlxcTm9pbmZlcmlvcnMiICAgfSwKKyAgICB7IE1CT1hfQVRUUklCVVRFX05P
U0VMRUNULCAgICAgICJcXE5vc2VsZWN0IiAgICAgIH0sCisgICAgeyBNQk9YX0FUVFJJQlVURV9N
QVJLRUQsICAgICAgICAiXFxNYXJrZWQiICAgICAgICB9LAorICAgIHsgTUJPWF9BVFRSSUJVVEVf
VU5NQVJLRUQsICAgICAgIlxcVW5tYXJrZWQiICAgICAgfSwKKworICAgIC8qIGZyb20gZHJhZnQt
aWV0Zi1pbWFwZXh0LWxpc3QtZXh0ZW5zaW9ucy0xNy50eHQgKi8KKyAgICB7IE1CT1hfQVRUUklC
VVRFX05PTkVYSVNURU5ULCAgICJcXE5vbkV4aXN0ZW50IiAgIH0sCisgICAgeyBNQk9YX0FUVFJJ
QlVURV9TVUJTQ1JJQkVELCAgICAiXFxTdWJzY3JpYmVkIiAgICB9LAorICAgIHsgTUJPWF9BVFRS
SUJVVEVfUkVNT1RFLCAgICAgICAgIlxcUmVtb3RlIiAgICAgICAgfSwKKyAgICB7IE1CT1hfQVRU
UklCVVRFX0hBU0NISUxEUkVOLCAgICJcXEhhc0NoaWxkcmVuIiAgIH0sCisgICAgeyBNQk9YX0FU
VFJJQlVURV9IQVNOT0NISUxEUkVOLCAiXFxIYXNOb0NoaWxkcmVuIiB9LAorCisgICAgeyAwLCBO
VUxMIH0KK307CisKKy8qCisgKiBUaGVzZSBiaXRtYXNrcyBkZWZpbmUgaG93IExpc3Qgc2VsZWN0
aW9uIG9wdGlvbnMgY2FuIGJlIGNvbWJpbmVkOgorICogbGlzdF9zZWxlY3RfbW9kX29wdHMgbWF5
IG9ubHkgYmUgdXNlZCBpZiBhdCBsZWFzdCBvbmUgbGlzdF9zZWxlY3RfYmFzZV9vcHQKKyAqIGlz
IGFsc28gcHJlc2VudC4KKyAqIEZvciBleGFtcGxlLCAoUkVDVVJTSVZFTUFUQ0gpIGFuZCAoUkVD
VVJTSVZFTUFUQ0ggUkVNT1RFKSBhcmUgaW52YWxpZCwgYnV0CisgKiAoUkVDVVJTSVZFTUFUQ0gg
U1VCU0NSSUJFRCkgaXMgb2suCisgKi8KK3N0YXRpYyBjb25zdCBpbnQgbGlzdF9zZWxlY3RfYmFz
ZV9vcHRzID0gTElTVF9TRUxfU1VCU0NSSUJFRDsKK3N0YXRpYyBjb25zdCBpbnQgbGlzdF9zZWxl
Y3RfbW9kX29wdHMgPSBMSVNUX1NFTF9SRUNVUlNJVkVNQVRDSDsKKworLyogc3RydWN0dXJlIHRo
YXQgbGlzdF9kYXRhIHBhc3NlcyBpdHMgY2FsbGJhY2tzICovCitzdHJ1Y3QgbGlzdF9yb2NrIHsK
KyAgICBpbnQgb3B0czsKKyAgICBjaGFyICpsYXN0X25hbWU7CisgICAgaW50IGxhc3RfYXR0cmli
dXRlczsKKyAgICBpbnQgdHJhaWxpbmdfcGVyY2VudDsgLyogdGhlIG1haWxib3ggbmFtZSBhcmcg
ZW5kcyB3aXRoIGEgJQorICAgICAgICAgICAgICAgICAgICAgICAgICAgKiBjYXVzZXMgc3BlY2lh
bCBiZWhhdmlvciB3aXRoIG5vbi1leHRlbmRlZCBMSVNUCisJCQkgICAqIGFuZCBMU1VCICovCit9
OworI2VuZGlmCisKIHZvaWQgbW90ZF9maWxlKGludCBmZCk7CiB2b2lkIHNodXRfZG93bihpbnQg
Y29kZSk7CiB2b2lkIGZhdGFsKGNvbnN0IGNoYXIgKnMsIGludCBjb2RlKTsKQEAgLTIyNSw2ICsy
NjgsMTEgQEAKIHZvaWQgY21kX3JlY29uc3RydWN0KGNvbnN0IGNoYXIgKnRhZywgY29uc3QgY2hh
ciAqbmFtZSwgaW50IHJlY3Vyc2l2ZSk7CiB2b2lkIGNtZF9maW5kKGNoYXIgKnRhZywgY2hhciAq
bmFtZXNwYWNlLCBjaGFyICpwYXR0ZXJuKTsKIHZvaWQgY21kX2xpc3QoY2hhciAqdGFnLCBpbnQg
bGlzdG9wdHMsIGNoYXIgKnJlZmVyZW5jZSwgY2hhciAqcGF0dGVybik7CisjaWZuZGVmIEVOQUJM
RV9MSVNURVhUCit2b2lkIHBhcnNlX2xpc3QoY2hhciAqdGFnKTsKK3ZvaWQgZG9fbGlzdChjaGFy
ICp0YWcsIGludCBsaXN0b3B0cywgY2hhciAqcmVmZXJlbmNlLAorCSAgICAgc3RydWN0IHN0cmxp
c3QgKnBhdHRlcm5zKTsKKyNlbmRpZgogdm9pZCBjbWRfY2hhbmdlc3ViKGNoYXIgKnRhZywgY2hh
ciAqbmFtZXNwYWNlLCBjaGFyICpuYW1lLCBpbnQgYWRkKTsKIHZvaWQgY21kX2dldGFjbChjb25z
dCBjaGFyICp0YWcsIGNvbnN0IGNoYXIgKm5hbWUpOwogdm9pZCBjbWRfbGlzdHJpZ2h0cyhjaGFy
ICp0YWcsIGNoYXIgKm5hbWUsIGNoYXIgKmlkZW50aWZpZXIpOwpAQCAtMjY2LDYgKzMxNCwxMSBA
QAogCiB2b2lkIGFubm90YXRlX3Jlc3BvbnNlKHN0cnVjdCBlbnRyeWF0dGxpc3QgKmwpOwogCisj
aWZkZWYgRU5BQkxFX0xJU1RfRVhURU5ERUQKK2ludCBnZXRsaXN0c2Vsb3B0cyhjaGFyICp0YWcs
IGludCAqb3B0cyk7CitpbnQgZ2V0bGlzdHJldG9wdHMoY2hhciAqdGFnLCBpbnQgKm9wdHMpOwor
I2VuZGlmCisKICNpZmRlZiBFTkFCTEVfTElTVEVYVAogaW50IGdldGxpc3RvcHRzKGNoYXIgKnRh
ZywgaW50ICpsaXN0b3B0cyk7CiAjZW5kaWYKQEAgLTI5Miw5ICszNDUsMjcgQEAKIHN0YXRpYyB2
b2lkIGZyZWVzb3J0Y3JpdChzdHJ1Y3Qgc29ydGNyaXQgKnMpOwogCiBzdGF0aWMgaW50IG1haWxi
b3hkYXRhKGNoYXIgKm5hbWUsIGludCBtYXRjaGxlbiwgaW50IG1heWNyZWF0ZSwgdm9pZCAqcm9j
ayk7CisKKyNpZmRlZiBFTkFCTEVfTElTVEVYVAogc3RhdGljIGludCBsaXN0ZGF0YShjaGFyICpu
YW1lLCBpbnQgbWF0Y2hsZW4sIGludCBtYXljcmVhdGUsIHZvaWQgKnJvY2spOwogc3RhdGljIHZv
aWQgbXN0cmluZ2RhdGEoY2hhciAqY21kLCBjaGFyICpuYW1lLCBpbnQgbWF0Y2hsZW4sIGludCBt
YXljcmVhdGUsCiAJCQlpbnQgbGlzdG9wdHMpOworI2Vsc2UKK3N0YXRpYyBpbnQgc2V0X2hhc2No
aWxkcmVuKGNoYXIgKm5hbWUsIGludCBtYXRjaGxlbiwgaW50IG1heWNyZWF0ZSwKKwkJCSAgIGlu
dCAqYXR0cmlidXRlcyk7CitzdGF0aWMgdm9pZCBsaXN0X3Jlc3BvbnNlKGNoYXIgKm5hbWUsIGlu
dCBhdHRyaWJ1dGVzLCBpbnQgb3B0cyk7CitzdGF0aWMgaW50IHNldF9zdWJzY3JpYmVkKGNoYXIg
Km5hbWUsIGludCBtYXRjaGxlbiwgaW50IG1heWNyZWF0ZSwKKwkJCSAgaW50ICphdHRyaWJ1dGVz
KTsKK3N0YXRpYyBjaGFyICpjYW5vbmljYWxfbGlzdF9wYXR0ZXJuKGNvbnN0IGNoYXIgKnJlZmVy
ZW5jZSwgY29uc3QgY2hhciAqcGF0dGVybik7CitzdGF0aWMgdm9pZCBjYW5vbmljYWxfbGlzdF9w
YXR0ZXJucyhjaGFyICpyZWZlcmVuY2UsIHN0cnVjdCBzdHJsaXN0ICpwYXR0ZXJucyk7CitzdGF0
aWMgaW50IGxpc3RfY2IoY2hhciAqbmFtZSwgaW50IG1hdGNobGVuLCBpbnQgbWF5Y3JlYXRlLAor
CQkgIHN0cnVjdCBsaXN0X3JvY2sgKnJvY2spOworc3RhdGljIGludCBzdWJzY3JpYmVkX2NiKGNo
YXIgKm5hbWUsIGludCBtYXRjaGxlbiwgaW50IG1heWNyZWF0ZSwKKwkJCSBzdHJ1Y3QgbGlzdF9y
b2NrICpyb2NrKTsKK3N0YXRpYyB2b2lkIGxpc3RfZGF0YShjaGFyICpyZWZlcmVuY2UsIGludCBs
aXN0b3B0cywgc3RydWN0IHN0cmxpc3QgKnBhdHRlcm5zKTsKK3N0YXRpYyB2b2lkIGxpc3RfZGF0
YV9yZW1vdGUoY2hhciAqdGFnLCBpbnQgbGlzdG9wdHMsIGNoYXIgKnJlZmVyZW5jZSwKKwkJCSAg
ICAgc3RydWN0IHN0cmxpc3QgKnBhdHRlcm4pOworI2VuZGlmCiAKIGV4dGVybiB2b2lkIHNldHBy
b2N0aXRsZV9pbml0KGludCBhcmdjLCBjaGFyICoqYXJndiwgY2hhciAqKmVudnApOwogZXh0ZXJu
IGludCBwcm9jX3JlZ2lzdGVyKGNvbnN0IGNoYXIgKnByb2duYW1lLCBjb25zdCBjaGFyICpjbGll
bnRob3N0LCAKQEAgLTEzNTYsOCArMTQyNyw4IEBACiAJICAgIH0KIAkgICAgZWxzZSBpZiAoIWlt
YXBkX3VzZXJpZCkgZ290byBub2xvZ2luOwogCSAgICBlbHNlIGlmICghc3RyY21wKGNtZC5zLCAi
TGlzdCIpKSB7Ci0JCWludCBsaXN0b3B0cyA9IExJU1RfQ0hJTERSRU47CiAjaWZkZWYgRU5BQkxF
X0xJU1RFWFQKKwkJaW50IGxpc3RvcHRzID0gTElTVF9DSElMRFJFTjsKIAkJLyogQ2hlY2sgZm9y
IGFuZCBwYXJzZSBMSVNURVhUIG9wdGlvbnMgKi8KIAkJYyA9IHByb3RfZ2V0YyhpbWFwZF9pbik7
CiAJCWlmIChjID09ICcoJykgewpAQCAtMTM2OSw3ICsxNDQwLDYgQEAKIAkJfQogCQllbHNlCiAJ
CSAgICBwcm90X3VuZ2V0YyhjLCBpbWFwZF9pbik7Ci0jZW5kaWYgLyogRU5BQkxFX0xJU1RFWFQg
Ki8KIAkJaWYgKGltYXBkX21hZ2ljcGx1cykgbGlzdG9wdHMgKz0gTElTVF9TVUJTQ1JJQkVEOwog
CQljID0gZ2V0YXN0cmluZyhpbWFwZF9pbiwgaW1hcGRfb3V0LCAmYXJnMSk7CiAJCWlmIChjICE9
ICcgJykgZ290byBtaXNzaW5nYXJnczsKQEAgLTEzNzcsNiArMTQ0NywxMiBAQAogCQlpZiAoYyA9
PSAnXHInKSBjID0gcHJvdF9nZXRjKGltYXBkX2luKTsKIAkJaWYgKGMgIT0gJ1xuJykgZ290byBl
eHRyYWFyZ3M7CiAJCWNtZF9saXN0KHRhZy5zLCBsaXN0b3B0cywgYXJnMS5zLCBhcmcyLnMpOwor
I2Vsc2UgLyogRU5BQkxFX0xJU1RFWFQgKi8KKwkJaWYgKGMgIT0gJyAnKQorCQkgICAgZ290byBt
aXNzaW5nYXJnczsKKworCQlwYXJzZV9saXN0KHRhZy5zKTsKKyNlbmRpZiAvKiBFTkFCTEVfTElT
VEVYVCAqLwogCiAJCXNubXBfaW5jcmVtZW50KExJU1RfQ09VTlQsIDEpOwogCSAgICB9CkBAIC0x
Mzg2LDcgKzE0NjIsMTIgQEAKIAkJYyA9IGdldGFzdHJpbmcoaW1hcGRfaW4sIGltYXBkX291dCwg
JmFyZzIpOwogCQlpZiAoYyA9PSAnXHInKSBjID0gcHJvdF9nZXRjKGltYXBkX2luKTsKIAkJaWYg
KGMgIT0gJ1xuJykgZ290byBleHRyYWFyZ3M7CisjaWZkZWYgRU5BQkxFX0xJU1RFWFQKIAkJY21k
X2xpc3QodGFnLnMsIExJU1RfTFNVQiB8IExJU1RfQ0hJTERSRU4sIGFyZzEucywgYXJnMi5zKTsK
KyNlbHNlCisJCWNtZF9saXN0KHRhZy5zLCBMSVNUX09QVF9MU1VCIHwgTElTVF9TRUxfU1VCU0NS
SUJFRCwKKwkJCSBhcmcxLnMsIGFyZzIucyk7CisjZW5kaWYKIAogCQlzbm1wX2luY3JlbWVudChM
U1VCX0NPVU5ULCAxKTsKIAkgICAgfQpAQCAtMTU1OCw3ICsxNjM5LDEzIEBACiAJCWMgPSBnZXRh
c3RyaW5nKGltYXBkX2luLCBpbWFwZF9vdXQsICZhcmcyKTsKIAkJaWYgKGMgPT0gJ1xyJykgYyA9
IHByb3RfZ2V0YyhpbWFwZF9pbik7CiAJCWlmIChjICE9ICdcbicpIGdvdG8gZXh0cmFhcmdzOwor
I2lmZGVmIEVOQUJMRV9MSVNURVhUCiAJCWNtZF9saXN0KHRhZy5zLCBMSVNUX0NISUxEUkVOIHwg
TElTVF9SRU1PVEUsIGFyZzEucywgYXJnMi5zKTsKKyNlbHNlCisJCWNtZF9saXN0KHRhZy5zLAor
CQkJIExJU1RfT1BUX1JMSVNUIHwgTElTVF9TRUxfUkVNT1RFIHwgTElTVF9SRVRfQ0hJTERSRU4s
CisJCQkgYXJnMS5zLCBhcmcyLnMpOworI2VuZGlmCiAKIC8qIAkJc25tcF9pbmNyZW1lbnQoTElT
VF9DT1VOVCwgMSk7ICovCiAJICAgIH0KQEAgLTE1NjgsOCArMTY1NSwxNiBAQAogCQljID0gZ2V0
YXN0cmluZyhpbWFwZF9pbiwgaW1hcGRfb3V0LCAmYXJnMik7CiAJCWlmIChjID09ICdccicpIGMg
PSBwcm90X2dldGMoaW1hcGRfaW4pOwogCQlpZiAoYyAhPSAnXG4nKSBnb3RvIGV4dHJhYXJnczsK
KyNpZmRlZiBFTkFCTEVfTElTVEVYVAogCQljbWRfbGlzdCh0YWcucywgTElTVF9MU1VCIHwgTElT
VF9DSElMRFJFTiB8IExJU1RfUkVNT1RFLAogCQkJIGFyZzEucywgYXJnMi5zKTsKKyNlbHNlCisJ
CWNtZF9saXN0KHRhZy5zLAorCQkJIExJU1RfT1BUX1JMSVNUIHwgTElTVF9PUFRfTFNVQiB8IExJ
U1RfU0VMX1JFTU9URQorCQkJIHwgTElTVF9TRUxfU1VCU0NSSUJFRCB8IExJU1RfUkVUX0NISUxE
UkVOLAorCQkJIGFyZzEucywgYXJnMi5zKTsKKyNlbmRpZgorCiAvKiAJCXNubXBfaW5jcmVtZW50
KExTVUJfQ09VTlQsIDEpOyAqLwogCSAgICB9CiAjaWZkZWYgSEFWRV9TU0wKQEAgLTI1ODcsOSAr
MjY4MiwxMyBAQAogCXByb3RfcHJpbnRmKGltYXBkX291dCwgIiBJRExFIik7CiAgICAgfQogCisj
aWZkZWYgRU5BQkxFX0xJU1RfRVhURU5ERUQKKyAgICBwcm90X3ByaW50ZihpbWFwZF9vdXQsICIg
TElTVEVYVCBMSVNULVNVQlNDUklCRUQgTElTVC1FWFRFTkRFRCIpOworI2VuZGlmCisKICNpZmRl
ZiBFTkFCTEVfTElTVEVYVAogICAgIHByb3RfcHJpbnRmKGltYXBkX291dCwgIiBMSVNURVhUIExJ
U1QtU1VCU0NSSUJFRCIpOwotI2VuZGlmIC8qIEVOQUJMRV9MSVNURVhUICovCisjZW5kaWYKIAog
I2lmZGVmIEVOQUJMRV9YX05FVFNDQVBFX0hBQ0sKICAgICBwcm90X3ByaW50ZihpbWFwZF9vdXQs
ICIgWC1ORVRTQ0FQRSIpOwpAQCAtNTY3MSw2ICs1NzcwLDggQEAKIAkJZXJyb3JfbWVzc2FnZShJ
TUFQX09LX0NPTVBMRVRFRCkpOwogfQogCisjaWZkZWYgRU5BQkxFX0xJU1RFWFQKKwogc3RhdGlj
IGludCBtc3RyaW5nZGF0YWNhbGxzOwogCiAvKgpAQCAtNTgwMCw2ICs1OTAxLDE4NSBAQAogCQll
cnJvcl9tZXNzYWdlKElNQVBfT0tfQ09NUExFVEVEKSwgbXl0aW1lLCBtc3RyaW5nZGF0YWNhbGxz
KTsKIH0KICAgCisjZWxzZSAvKiBFTkFCTEVfTElTVEVYVCAqLworCisvKiBubyB0aW1lcyB0aGUg
Y2FsbGJhY2tzIGZvciBmaW5kYWxsL2ZpbmRzdWIgaGF2ZSBiZWVuIGNhbGxlZCAqLworc3RhdGlj
IGludCBsaXN0X2NhbGxiYWNrX2NhbGxzOworCisvKgorICogUGFyc2UgYW5kIHBlcmZvcm0gYSBM
SVNUIGNvbW1hbmQuCisgKi8KK3ZvaWQgcGFyc2VfbGlzdChjaGFyICp0YWcpCit7CisgICAgaW50
IGxpc3RvcHRzID0gMDsKKyAgICBzdGF0aWMgc3RydWN0IGJ1ZiBidWY7CisgICAgaW50IGM7Cisg
ICAgc3RydWN0IHN0cmxpc3QgKnBhdHRlcm5zID0gTlVMTDsKKyAgICBjaGFyICpyZWZlcmVuY2U7
CisKKyNpZmRlZiBFTkFCTEVfTElTVF9FWFRFTkRFRAorICAgIC8qIENoZWNrIGZvciBhbmQgcGFy
c2UgTElTVEVYVCBzZWxlY3Rpb24gb3B0aW9ucyAqLworICAgIGMgPSBwcm90X2dldGMoaW1hcGRf
aW4pOworICAgIGlmIChjID09ICcoJykgeworCWxpc3RvcHRzIHw9IExJU1RfT1BUX0VYVEVOREVE
OworCWMgPSBnZXRsaXN0c2Vsb3B0cyh0YWcsICZsaXN0b3B0cyk7CisJaWYgKGMgPT0gRU9GKSB7
CisJICAgIGVhdGxpbmUoaW1hcGRfaW4sIGMpOworCSAgICByZXR1cm47CisJfQorICAgIH0KKyAg
ICBlbHNlCisJcHJvdF91bmdldGMoYywgaW1hcGRfaW4pOworI2VuZGlmCisKKyAgICBpZiAoaW1h
cGRfbWFnaWNwbHVzKSBsaXN0b3B0cyB8PSBMSVNUX1NFTF9TVUJTQ1JJQkVEIHwgTElTVF9SRVRf
U1VCU0NSSUJFRDsKKworICAgIC8qIFJlYWQgaW4gcmVmZXJlbmNlIG5hbWUgKi8KKyAgICBjID0g
Z2V0YXN0cmluZyhpbWFwZF9pbiwgaW1hcGRfb3V0LCAmYnVmKTsKKyAgICBpZiAoYyA9PSBFT0Yg
JiYgISpidWYucykgeworCXByb3RfcHJpbnRmKGltYXBkX291dCwKKwkJICAgICIlcyBCQUQgTWlz
c2luZyByZXF1aXJlZCBhcmd1bWVudCB0byBMaXN0OiByZWZlcmVuY2UgbmFtZVxyXG4iLAorCQkg
ICAgdGFnKTsKKwllYXRsaW5lKGltYXBkX2luLCBjKTsKKwlyZXR1cm47CisgICAgfQorICAgIGlm
IChjICE9ICcgJykgeworCXByb3RfcHJpbnRmKGltYXBkX291dCwKKwkJICAgICIlcyBCQUQgTWlz
c2luZyByZXF1aXJlZCBhcmd1bWVudCB0byBMaXN0OiBtYWlsYm94IHBhdHRlcm5cclxuIiwgdGFn
KTsKKwllYXRsaW5lKGltYXBkX2luLCBjKTsKKwlyZXR1cm47CisgICAgfQorICAgIHJlZmVyZW5j
ZSA9IHhzdHJkdXAoYnVmLnMpOworCisgICAgLyogUmVhZCBpbiBtYWlsYm94IHBhdHRlcm4ocykg
Ki8KKyNpZmRlZiBFTkFCTEVfTElTVF9FWFRFTkRFRAorICAgIGMgPSBwcm90X2dldGMoaW1hcGRf
aW4pOworICAgIGlmIChjID09ICcoJykgeworCWxpc3RvcHRzIHw9IExJU1RfT1BUX0VYVEVOREVE
IHwgTElTVF9PUFRfRVhURU5ERURfVjE3OworCWZvciAoOzspIHsKKwkgICAgYyA9IGdldGFzdHJp
bmcoaW1hcGRfaW4sIGltYXBkX291dCwgJmJ1Zik7CisJICAgIGlmICgqYnVmLnMpCisJCWFwcGVu
ZHN0cmxpc3QoJnBhdHRlcm5zLCBidWYucyk7CisJICAgIGlmIChjICE9ICcgJykgYnJlYWs7CisJ
fQorCWlmIChjICE9ICcpJykgeworCSAgICBwcm90X3ByaW50ZihpbWFwZF9vdXQsCisJCQkiJXMg
QkFEIEludmFsaWQgc3ludGF4IGluIExpc3QgY29tbWFuZFxyXG4iLCB0YWcpOworCSAgICBlYXRs
aW5lKGltYXBkX2luLCBjKTsKKwkgICAgZ290byBmcmVlYXJnczsKKwl9CisJYyA9IHByb3RfZ2V0
YyhpbWFwZF9pbik7CisgICAgfQorICAgIGVsc2UgeworCXByb3RfdW5nZXRjKGMsIGltYXBkX2lu
KTsKKyNlbmRpZgorICAgIAljID0gZ2V0YXN0cmluZyhpbWFwZF9pbiwgaW1hcGRfb3V0LCAmYnVm
KTsKKwlpZiAoYyA9PSBFT0YpIHsKKwkgICAgcHJvdF9wcmludGYoaW1hcGRfb3V0LAorCQkJIiVz
IEJBRCBNaXNzaW5nIHJlcXVpcmVkIGFyZ3VtZW50IHRvIExpc3Q6IG1haWxib3ggcGF0dGVyblxy
XG4iLAorCQkJdGFnKTsKKwkgICAgZWF0bGluZShpbWFwZF9pbiwgYyk7CisJICAgIGdvdG8gZnJl
ZWFyZ3M7CisJfQorCWFwcGVuZHN0cmxpc3QoJnBhdHRlcm5zLCBidWYucyk7CisjaWZkZWYgRU5B
QkxFX0xJU1RfRVhURU5ERUQKKyAgICB9CisjZW5kaWYKKworI2lmZGVmIEVOQUJMRV9MSVNUX0VY
VEVOREVECisgICAgLyogQ2hlY2sgZm9yIGFuZCBwYXJzZSBMSVNURVhUIHJldHVybiBvcHRpb25z
ICovCisgICAgaWYgKGMgPT0gJyAnKSB7CisJbGlzdG9wdHMgfD0gTElTVF9PUFRfRVhURU5ERUQg
fCBMSVNUX09QVF9FWFRFTkRFRF9WMTc7CisJYyA9IGdldGxpc3RyZXRvcHRzKHRhZywgJmxpc3Rv
cHRzKTsKKwlpZiAoYyA9PSBFT0YpIHsKKwkgICAgZWF0bGluZShpbWFwZF9pbiwgYyk7CisJICAg
IGdvdG8gZnJlZWFyZ3M7CisJfQorICAgIH0KKyNlbmRpZgorCisgICAgLyogY2hlY2sgZm9yIENS
TEYgKi8KKyAgICBpZiAoYyA9PSAnXHInKSBjID0gcHJvdF9nZXRjKGltYXBkX2luKTsKKyAgICBp
ZiAoYyAhPSAnXG4nKSB7CisJcHJvdF9wcmludGYoaW1hcGRfb3V0LAorCQkgICAgIiVzIEJBRCBV
bmV4cGVjdGVkIGV4dHJhIGFyZ3VtZW50cyB0byBMaXN0XHJcbiIsIHRhZyk7CisJZWF0bGluZShp
bWFwZF9pbiwgYyk7CisJZ290byBmcmVlYXJnczsKKyAgICB9CisKKyAgICBpZiAobGlzdG9wdHMg
JiBMSVNUX09QVF9FWFRFTkRFRF9WMDMgJiYgbGlzdG9wdHMgJiBMSVNUX09QVF9FWFRFTkRFRF9W
MTcpIHsKKwkvKiBjbGllbnQgbWl4ZWQgZGlmZmVyZW50IGxpc3RleHQgdmVyc2lvbnMgKi8KKwlw
cm90X3ByaW50ZihpbWFwZF9vdXQsCisJCSAgICAiJXMgQkFEIEludmFsaWQgc3ludGF4IGluIGV4
dGVuZGVkIExpc3QgY29tbWFuZFxyXG4iLCB0YWcpOworCWdvdG8gZnJlZWFyZ3M7CisgICAgfQor
CisgICAgZG9fbGlzdCh0YWcsIGxpc3RvcHRzLCByZWZlcmVuY2UsIHBhdHRlcm5zKTsKKworICBm
cmVlYXJnczoKKyAgICBmcmVlc3RybGlzdChwYXR0ZXJucyk7CisgICAgZnJlZShyZWZlcmVuY2Up
OworICAgIHJldHVybjsKK30KKworLyogQSB3cmFwcGVyIGZvciBkb19saXN0LiAqLwordm9pZCBj
bWRfbGlzdChjaGFyICp0YWcsIGludCBsaXN0b3B0cywgY2hhciAqcmVmZXJlbmNlLCBjaGFyICpw
YXR0ZXJuKQoreworICAgIGNoYXIgKm5ld19wYXR0ZXJuID0geHN0cmR1cChwYXR0ZXJuKTsKKyAg
ICBzdHJ1Y3Qgc3RybGlzdCBzdHJsaXN0ID0geyBuZXdfcGF0dGVybiwgTlVMTCwgTlVMTCwgTlVM
TCB9OworICAgIGRvX2xpc3QodGFnLCBsaXN0b3B0cywgcmVmZXJlbmNlLCAmc3RybGlzdCk7Cisg
ICAgZnJlZShzdHJsaXN0LnMpOworfQorCisvKgorICogUGVyZm9ybSBhIExJU1QsIExTVUIsIFJM
SVNUIG9yIFJMU1VCIGNvbW1hbmQKKyAqLwordm9pZCBkb19saXN0KGNoYXIgKnRhZywgaW50IGxp
c3RvcHRzLCBjaGFyICpyZWZlcmVuY2UsCisJICAgICBzdHJ1Y3Qgc3RybGlzdCAqcGF0dGVybnMp
Cit7CisgICAgY2xvY2tfdCBzdGFydCA9IGNsb2NrKCk7CisgICAgY2hhciBteXRpbWVbMTAwXTsK
KworICAgIGlmIChsaXN0b3B0cyAmIExJU1RfU0VMX1JFTU9URSkgc3VwcG9ydHNfcmVmZXJyYWxz
ID0gIWRpc2FibGVfcmVmZXJyYWxzOworCisgICAgaWYgKGxpc3RvcHRzICYgTElTVF9TRUxfUkVD
VVJTSVZFTUFUQ0gpIHsKKwlwcm90X3ByaW50ZihpbWFwZF9vdXQsCisJCSAgICAiJXMgTk8gU2Vy
dmVyIGRvZXMgbm90IHN1cHBvcnQgUkVDVVJTSVZFTUFUQ0ggc2VsZWN0aW9uIG9wdGlvblxyXG4i
LAorCQkgICAgdGFnKTsKKwlyZXR1cm47CisgICAgfQorCisgICAgbGlzdF9jYWxsYmFja19jYWxs
cyA9IDA7CisKKyAgICBpZiAoIShsaXN0b3B0cyAmIExJU1RfT1BUX0xTVUIpCisJICAgICYmICEo
bGlzdG9wdHMgJiBMSVNUX09QVF9FWFRFTkRFRCkKKwkgICAgJiYgISpwYXR0ZXJucy0+cykgewor
CS8qIHNwZWNpYWwgY2FzZTogcXVlcnkgdG9wLWxldmVsIGhpZXJhcmNoeSBzZXBhcmF0b3IgKi8K
Kwlwcm90X3ByaW50ZihpbWFwZF9vdXQsICIqICVzTElTVCAoXFxOb3NlbGVjdCkgXCIlY1wiIFwi
XCJcclxuIiwKKwkJICAgIChsaXN0b3B0cyAmIExJU1RfT1BUX1JMSVNUKSA/ICJSIiA6ICIiLAor
CQkgICAgaW1hcGRfbmFtZXNwYWNlLmhpZXJfc2VwKTsKKyAgICB9IGVsc2UgaWYgKGxpc3RvcHRz
ICYgKExJU1RfU0VMX1NVQlNDUklCRUQgfCBMSVNUX1JFVF9TVUJTQ1JJQkVEKQorCSAgICAmJiAo
YmFja2VuZF9pbmJveCB8fCAoYmFja2VuZF9pbmJveCA9IHByb3h5X2ZpbmRpbmJveHNlcnZlcigp
KSkpIHsKKwkvKiByZW1vdGUgaW5ib3ggKi8KKwlsaXN0X2RhdGFfcmVtb3RlKHRhZywgbGlzdG9w
dHMsIHJlZmVyZW5jZSwgcGF0dGVybnMpOworICAgIH0gZWxzZSB7CisJbGlzdF9kYXRhKHJlZmVy
ZW5jZSwgbGlzdG9wdHMsIHBhdHRlcm5zKTsKKyAgICB9CisKKyAgICBpbWFwZF9jaGVjaygobGlz
dG9wdHMgJiBMSVNUX1NFTF9TVUJTQ1JJQkVEKSA/ICBOVUxMIDogYmFja2VuZF9pbmJveCwKKwkJ
MCwgMCk7CisKKyAgICBzbnByaW50ZihteXRpbWUsIHNpemVvZihteXRpbWUpLCAiJTIuM2YiLAor
CSAgICAgKGNsb2NrKCkgLSBzdGFydCkgLyAoZG91YmxlKSBDTE9DS1NfUEVSX1NFQyk7CisgICAg
cHJvdF9wcmludGYoaW1hcGRfb3V0LCAiJXMgT0sgJXMgKCVzIHNlY3MiLCB0YWcsCisJCWVycm9y
X21lc3NhZ2UoSU1BUF9PS19DT01QTEVURUQpLCBteXRpbWUpOworICAgIGlmIChsaXN0X2NhbGxi
YWNrX2NhbGxzKQorCXByb3RfcHJpbnRmKGltYXBkX291dCwgIiAldSBjYWxscyIsIGxpc3RfY2Fs
bGJhY2tfY2FsbHMpOworICAgIHByb3RfcHJpbnRmKGltYXBkX291dCwgIilcclxuIik7Cit9CisK
KyNlbmRpZiAvKiBFTkFCTEVfTElTVEVYVCAqLworCiAvKgogICogUGVyZm9ybSBhIFNVQlNDUklC
RSAoYWRkIGlzIG5vbnplcm8pIG9yCiAgKiBVTlNVQlNDUklCRSAoYWRkIGlzIHplcm8pIGNvbW1h
bmQKQEAgLTg3NTIsNiArOTAzMiwxMzYgQEAKIH0KICNlbmRpZiAvKiBFTkFCTEVfTElTVEVYVCAq
LwogCisjaWZkZWYgRU5BQkxFX0xJU1RfRVhURU5ERUQKKy8qCisgKiBQYXJzZSBMSVNUIHNlbGVj
dGlvbiBvcHRpb25zLgorICogVGhlIGNvbW1hbmQgaGFzIGJlZW4gcGFyc2VkIHVwIHRvIGFuZCBp
bmNsdWRpbmcgdGhlIG9wZW5pbmcgJygnLgorICovCitpbnQgZ2V0bGlzdHNlbG9wdHMoY2hhciAq
dGFnLCBpbnQgKm9wdHMpCit7CisgICAgaW50IGM7CisgICAgc3RhdGljIHN0cnVjdCBidWYgYnVm
OworCisgICAgaWYgKCAoYyA9IHByb3RfZ2V0YyhpbWFwZF9pbikpID09ICcpJykKKwlyZXR1cm4g
cHJvdF9nZXRjKGltYXBkX2luKTsKKyAgICBlbHNlCisJcHJvdF91bmdldGMoYywgaW1hcGRfaW4p
OworCisgICAgZm9yICg7OykgeworCWMgPSBnZXR3b3JkKGltYXBkX2luLCAmYnVmKTsKKworCWlm
ICghKmJ1Zi5zKSB7CisJICAgIHByb3RfcHJpbnRmKGltYXBkX291dCwKKwkJCSIlcyBCQUQgSW52
YWxpZCBzeW50YXggaW4gTGlzdCBjb21tYW5kXHJcbiIsCisJCQl0YWcpOworCSAgICByZXR1cm4g
RU9GOworCX0KKworCWxjYXNlKGJ1Zi5zKTsKKworCWlmICghc3RyY21wKGJ1Zi5zLCAic3Vic2Ny
aWJlZCIpKSB7CisJICAgICpvcHRzIHw9IExJU1RfU0VMX1NVQlNDUklCRUQgfCBMSVNUX1JFVF9T
VUJTQ1JJQkVEOworCX0gZWxzZSBpZiAoIXN0cmNtcChidWYucywgInJlbW90ZSIpKSB7CisJICAg
ICpvcHRzIHw9IExJU1RfU0VMX1JFTU9URTsKKwl9IGVsc2UgaWYgKCFzdHJjbXAoYnVmLnMsICJy
ZWN1cnNpdmVtYXRjaCIpKSB7CisJICAgICpvcHRzIHw9IExJU1RfU0VMX1JFQ1VSU0lWRU1BVENI
IHwgTElTVF9PUFRfRVhURU5ERURfVjE3OworCX0gZWxzZSBpZiAoIXN0cmNtcChidWYucywgImNo
aWxkcmVuIikpIHsKKwkgICAgKm9wdHMgfD0gTElTVF9SRVRfQ0hJTERSRU4gfCBMSVNUX09QVF9F
WFRFTkRFRF9WMDM7CisJfSBlbHNlIHsKKwkgICAgcHJvdF9wcmludGYoaW1hcGRfb3V0LAorCQkJ
IiVzIEJBRCBJbnZhbGlkIExpc3Qgc2VsZWN0aW9uIG9wdGlvbiBcIiVzXCJcclxuIiwKKwkJCXRh
ZywgYnVmLnMpOworCSAgICByZXR1cm4gRU9GOworCX0KKworCWlmIChjICE9ICcgJykgYnJlYWs7
CisgICAgfQorCisgICAgaWYgKGMgIT0gJyknKSB7CisJcHJvdF9wcmludGYoaW1hcGRfb3V0LAor
CQkgICAgIiVzIEJBRCBNaXNzaW5nIGNsb3NlIHBhcmVudGhlc2lzIGZvciBMaXN0IHNlbGVjdGlv
biBvcHRpb25zXHJcbiIsIHRhZyk7CisJcmV0dXJuIEVPRjsKKyAgICB9CisKKyAgICBpZiAoKm9w
dHMgJiBsaXN0X3NlbGVjdF9tb2Rfb3B0cworCSAgICAmJiAhICgqb3B0cyAmIGxpc3Rfc2VsZWN0
X2Jhc2Vfb3B0cykpIHsKKwlwcm90X3ByaW50ZihpbWFwZF9vdXQsCisJCSAgICAiJXMgQkFEIElu
dmFsaWQgY29tYmluYXRpb24gb2Ygc2VsZWN0aW9uIG9wdGlvbnNcclxuIiwKKwkJICAgIHRhZyk7
CisJcmV0dXJuIEVPRjsKKyAgICB9CisKKyAgICByZXR1cm4gcHJvdF9nZXRjKGltYXBkX2luKTsK
K30KKworLyoKKyAqIFBhcnNlIExJU1QgcmV0dXJuIG9wdGlvbnMuCisgKiBUaGUgY29tbWFuZCBo
YXMgYmVlbiBwYXJzZWQgdXAgdG8gYW5kIGluY2x1ZGluZyB0aGUgJyAnIGJlZm9yZSBSRVRVUk4u
CisgKi8KK2ludCBnZXRsaXN0cmV0b3B0cyhjaGFyICp0YWcsIGludCAqb3B0cykgeworICAgIHN0
YXRpYyBzdHJ1Y3QgYnVmIGJ1ZjsKKyAgICBpbnQgYzsKKworICAgIGMgPSBnZXR3b3JkKGltYXBk
X2luLCAmYnVmKTsKKyAgICBpZiAoISpidWYucykgeworCXByb3RfcHJpbnRmKGltYXBkX291dCwK
KwkJICAgICIlcyBCQUQgSW52YWxpZCBzeW50YXggaW4gTGlzdCBjb21tYW5kXHJcbiIsIHRhZyk7
CisJcmV0dXJuIEVPRjsKKyAgICB9CisgICAgbGNhc2UoYnVmLnMpOworICAgIGlmIChzdHJjYXNl
Y21wKGJ1Zi5zLCAicmV0dXJuIikpIHsKKwlwcm90X3ByaW50ZihpbWFwZF9vdXQsCisJCSAgICAi
JXMgQkFEIFVuZXhwZWN0ZWQgZXh0cmEgYXJndW1lbnQgdG8gTGlzdDogXCIlc1wiXHJcbiIsCisJ
CSAgICB0YWcsIGJ1Zi5zKTsKKwlyZXR1cm4gRU9GOworICAgIH0KKworICAgIGlmIChjICE9ICcg
JyB8fCAoYyA9IHByb3RfZ2V0YyhpbWFwZF9pbikpICE9ICcoJykgeworCXByb3RfcHJpbnRmKGlt
YXBkX291dCwKKwkJICAgICIlcyBCQUQgTWlzc2luZyByZXR1cm4gYXJndW1lbnQgbGlzdFxyXG4i
LCB0YWcpOworCXJldHVybiBFT0Y7CisgICAgfQorCisgICAgaWYgKCAoYyA9IHByb3RfZ2V0Yyhp
bWFwZF9pbikpID09ICcpJykKKwlyZXR1cm4gcHJvdF9nZXRjKGltYXBkX2luKTsKKyAgICBlbHNl
CisJcHJvdF91bmdldGMoYywgaW1hcGRfaW4pOworCisgICAgZm9yICg7OykgeworCWMgPSBnZXR3
b3JkKGltYXBkX2luLCAmYnVmKTsKKworCWlmICghKmJ1Zi5zKSB7CisJICAgIHByb3RfcHJpbnRm
KGltYXBkX291dCwKKwkJCSIlcyBCQUQgSW52YWxpZCBzeW50YXggaW4gTGlzdCBjb21tYW5kXHJc
biIsIHRhZyk7CisJICAgIHJldHVybiBFT0Y7CisJfQorCisJbGNhc2UoYnVmLnMpOworCisJaWYg
KCFzdHJjbXAoYnVmLnMsICJzdWJzY3JpYmVkIikpCisJICAgICpvcHRzIHw9IExJU1RfUkVUX1NV
QlNDUklCRUQ7CisJZWxzZSBpZiAoIXN0cmNtcChidWYucywgImNoaWxkcmVuIikpCisJICAgICpv
cHRzIHw9IExJU1RfUkVUX0NISUxEUkVOOworCWVsc2UgeworCSAgICBwcm90X3ByaW50ZihpbWFw
ZF9vdXQsCisJCQkiJXMgQkFEIEludmFsaWQgTGlzdCByZXR1cm4gb3B0aW9uIFwiJXNcIlxyXG4i
LAorCQkJdGFnLCBidWYucyk7CisJICAgIHJldHVybiBFT0Y7CisJfQorCisJaWYgKGMgIT0gJyAn
KSBicmVhazsKKyAgICB9CisKKyAgICBpZiAoYyAhPSAnKScpIHsKKwlwcm90X3ByaW50ZihpbWFw
ZF9vdXQsCisJCSAgICAiJXMgQkFEIE1pc3NpbmcgY2xvc2UgcGFyZW50aGVzaXMgZm9yIExpc3Qg
cmV0dXJuIG9wdGlvbnNcclxuIiwgdGFnKTsKKwlyZXR1cm4gRU9GOworICAgIH0KKworICAgIHJl
dHVybiBwcm90X2dldGMoaW1hcGRfaW4pOworfQorI2VuZGlmIC8qIEVOQUJMRV9MSVNUX0VYVEVO
REVEICovCisKIC8qCiAgKiBQYXJzZSBhIGRhdGVfdGltZSwgZm9yIHRoZSBBUFBFTkQgY29tbWFu
ZAogICovCkBAIC05MTM0LDYgKzk1NDQsOCBAQAogICAgIHJldHVybiAwOwogfQogCisjaWZkZWYg
RU5BQkxFX0xJU1RFWFQKKwogLyoKICAqIElzc3VlIGEgTElTVCBvciBMU1VCIHVudGFnZ2VkIHJl
c3BvbnNlCiAgKi8KQEAgLTkyODgsNiArOTcwMCwzNzkgQEAKICAgICByZXR1cm4gMDsKIH0KIAor
I2Vsc2UgLyogRU5BQkxFX0xJU1RFWFQgKi8KKworc3RhdGljIGludCBzZXRfaGFzY2hpbGRyZW4o
Y2hhciAqbmFtZSwgaW50IG1hdGNobGVuLCBpbnQgbWF5Y3JlYXRlLAorCQkJICAgaW50ICphdHRy
aWJ1dGVzKQoreworICAgIGxpc3RfY2FsbGJhY2tfY2FsbHMrKzsKKyAgICBpZiAobmFtZVttYXRj
aGxlbl0pIHsKKwkqYXR0cmlidXRlcyB8PSBNQk9YX0FUVFJJQlVURV9IQVNDSElMRFJFTjsKKwly
ZXR1cm4gMTsKKyAgICB9CisgICAgcmV0dXJuIDA7Cit9CisKKy8qIFByaW50IExJU1Qgb3IgTFNV
QiB1bnRhZ2dlZCByZXNwb25zZSAqLworc3RhdGljIHZvaWQgbGlzdF9yZXNwb25zZShjaGFyICpu
YW1lLCBpbnQgYXR0cmlidXRlcywgaW50IG9wdHMpCit7CisgICAgc3RydWN0IG1ib3hfbmFtZV9h
dHRyaWJ1dGUgKmF0dHI7CisgICAgY2hhciBpbnRlcm5hbF9uYW1lW01BWF9NQUlMQk9YX1BBVEgr
MV07CisgICAgaW50IHIsIG1idHlwZSwgZmlyc3QgPSAxOworICAgIGNoYXIgbWJveG5hbWVbTUFY
X01BSUxCT1hfUEFUSCsxXTsKKworICAgIGlmICghbmFtZSkKKwlyZXR1cm47CisKKyAgICAvKiBm
aXJzdCBjb252ZXJ0ICJJTkJPWCIgdG8gInVzZXIuPHVzZXJpZD4iICovCisgICAgaWYgKCFzdHJu
Y2FzZWNtcChuYW1lLCAiaW5ib3giLCA1KQorICAgICAgICAgICAgJiYgKCFuYW1lWzVdIHx8IG5h
bWVbNV0gPT0gJy4nKSApIHsKKwkoKmltYXBkX25hbWVzcGFjZS5tYm94bmFtZV90b2ludGVybmFs
KSgmaW1hcGRfbmFtZXNwYWNlLCAiSU5CT1giLAorCQkJCQkgICAgICAgaW1hcGRfdXNlcmlkLCBp
bnRlcm5hbF9uYW1lKTsKKwlzdHJsY2F0KGludGVybmFsX25hbWUsIG5hbWUrNSwgc2l6ZW9mKGlu
dGVybmFsX25hbWUpKTsKKyAgICB9CisgICAgZWxzZQorCXN0cmxjcHkoaW50ZXJuYWxfbmFtZSwg
bmFtZSwgc2l6ZW9mKGludGVybmFsX25hbWUpKTsKKworICAgIC8qIGdldCBpbmZvIGFuZCBzZXQg
ZmxhZ3MgKi8KKyAgICByID0gbWJveGxpc3RfZGV0YWlsKGludGVybmFsX25hbWUsICZtYnR5cGUs
IE5VTEwsIE5VTEwsIE5VTEwsIE5VTEwsIE5VTEwpOworCisgICAgaWYgKHIgPT0gSU1BUF9NQUlM
Qk9YX05PTkVYSVNURU5UKQorCWF0dHJpYnV0ZXMgfD0gTUJPWF9BVFRSSUJVVEVfTk9ORVhJU1RF
TlQgfCBNQk9YX0FUVFJJQlVURV9OT1NFTEVDVDsKKyAgICBpZiAoIXIgJiYgKG1idHlwZSAmIE1C
VFlQRV9SRVNFUlZFKSkKKwlhdHRyaWJ1dGVzIHw9IE1CT1hfQVRUUklCVVRFX05PU0VMRUNUOwor
CisgICAgLyogZmlndXJlIG91dCBcSGFzKE5vKUNoaWxkcmVuIGlmIG5lY2Vzc2FyeSAqLworICAg
IGlmICggb3B0cyAmIExJU1RfUkVUX0NISUxEUkVOCisJICAgICYmICEgKGF0dHJpYnV0ZXMgJiBN
Qk9YX0FUVFJJQlVURV9IQVNDSElMRFJFTikKKwkgICAgJiYgISAoYXR0cmlidXRlcyAmIE1CT1hf
QVRUUklCVVRFX0hBU05PQ0hJTERSRU4pICkgeworCW1ib3hsaXN0X2ZpbmRhbGwoJmltYXBkX25h
bWVzcGFjZSwgbmFtZSwKKwkJCSBpbWFwZF91c2VyaXNhZG1pbiwgaW1hcGRfdXNlcmlkLCBpbWFw
ZF9hdXRoc3RhdGUsCisJCQkgc2V0X2hhc2NoaWxkcmVuLCAmYXR0cmlidXRlcyk7CisJaWYgKCAh
IChhdHRyaWJ1dGVzICYgTUJPWF9BVFRSSUJVVEVfSEFTQ0hJTERSRU4pICkKKwkgICAgYXR0cmli
dXRlcyB8PSBNQk9YX0FUVFJJQlVURV9IQVNOT0NISUxEUkVOOworICAgIH0KKworICAgIGlmIChv
cHRzICYgTElTVF9PUFRfTFNVQikgeworCS8qIFxOb3NlbGVjdCBoYXMgYSBzcGVjaWFsIHNlY29u
ZCBtZWFuaW5nIHdpdGggKFIpTFNVQiAqLworCWlmICggIShhdHRyaWJ1dGVzICYgTUJPWF9BVFRS
SUJVVEVfU1VCU0NSSUJFRCkKKwkJJiYgYXR0cmlidXRlcyAmIE1CT1hfQVRUUklCVVRFX0NISUxE
SU5GT19TVUJTQ1JJQkVEKQorCSAgICBhdHRyaWJ1dGVzIHw9IE1CT1hfQVRUUklCVVRFX05PU0VM
RUNUOworCWF0dHJpYnV0ZXMgJj0gfk1CT1hfQVRUUklCVVRFX1NVQlNDUklCRUQ7CisgICAgfQor
CisgICAgLyogcmVtb3ZlIHJlZHVuZGFudCBmbGFncyAqLworICAgIGlmIChvcHRzICYgTElTVF9P
UFRfRVhURU5ERUQpIHsKKwlpZiAob3B0cyAmIE1CT1hfQVRUUklCVVRFX05PSU5GRVJJT1JTKQor
CSAgICBvcHRzICY9IH5NQk9YX0FUVFJJQlVURV9IQVNDSElMRFJFTjsKKwlpZiAob3B0cyAmIE1C
T1hfQVRUUklCVVRFX05PTkVYSVNURU5UKQorCSAgICBvcHRzICY9IH5NQk9YX0FUVFJJQlVURV9O
T1NFTEVDVDsKKyAgICB9CisKKyAgICBwcm90X3ByaW50ZihpbWFwZF9vdXQsICIqICVzICgiLAor
CQkob3B0cyAmIExJU1RfT1BUX0xTVUIpID8gIkxTVUIiIDogIkxJU1QiKTsKKyAgICBmb3IgKGF0
dHIgPSBtYm94X25hbWVfYXR0cmlidXRlczsgYXR0ci0+aWQ7IGF0dHIrKykKKwlpZiAoYXR0cmli
dXRlcyAmIGF0dHItPmZsYWcpIHsKKwkgICAgaWYgKGZpcnN0KSBmaXJzdCA9IDA7CisJICAgIGVs
c2UgcHJvdF9wdXRjKCcgJywgaW1hcGRfb3V0KTsKKwkgICAgcHJvdF9wcmludGYoaW1hcGRfb3V0
LCBhdHRyLT5pZCk7CisJfQorICAgIHByb3RfcHJpbnRmKGltYXBkX291dCwgIikgIik7CisKKyAg
ICBwcm90X3ByaW50ZihpbWFwZF9vdXQsICJcIiVjXCIgIiwgaW1hcGRfbmFtZXNwYWNlLmhpZXJf
c2VwKTsKKyAKKyAgICAoKmltYXBkX25hbWVzcGFjZS5tYm94bmFtZV90b2V4dGVybmFsKSgmaW1h
cGRfbmFtZXNwYWNlLCBuYW1lLAorICAgICAgICAgICAgaW1hcGRfdXNlcmlkLCBtYm94bmFtZSk7
CisKKyAgICBwcmludGFzdHJpbmcobWJveG5hbWUpOworCisgICAgaWYgKG9wdHMgJiBMSVNUX09Q
VF9FWFRFTkRFRCAmJiBhdHRyaWJ1dGVzICYgbGlzdF9jaGlsZGluZm8pIHsKKwlwcm90X3ByaW50
ZihpbWFwZF9vdXQsICIgKENISUxESU5GTyAoIik7CisJaWYgKGF0dHJpYnV0ZXMgJiBNQk9YX0FU
VFJJQlVURV9DSElMRElORk9fU1VCU0NSSUJFRCkKKwkgICAgcHJvdF9wcmludGYoaW1hcGRfb3V0
LCAiU1VCU0NSSUJFRCIpOworCXByb3RfcHJpbnRmKGltYXBkX291dCwgIikpIik7CisgICAgfQor
CisgICAgcHJvdF9wcmludGYoaW1hcGRfb3V0LCAiXHJcbiIpOworfQorCitzdGF0aWMgaW50IHNl
dF9zdWJzY3JpYmVkKGNoYXIgKm5hbWUsIGludCBtYXRjaGxlbiwgaW50IG1heWNyZWF0ZSwKKwkJ
CSAgaW50ICphdHRyaWJ1dGVzKQoreworICAgIGxpc3RfY2FsbGJhY2tfY2FsbHMrKzsKKyAgICBp
ZiAoIW5hbWVbbWF0Y2hsZW5dKSAKKwkqYXR0cmlidXRlcyB8PSBNQk9YX0FUVFJJQlVURV9TVUJT
Q1JJQkVEOworICAgIHJldHVybiAxOworfQorCisvKiBjYWxsYmFjayBmb3IgbWJveGxpc3RfZmlu
ZGFsbAorICogdXNlZCB3aGVuIHRoZSBTVUJTQ1JJQkVEIHNlbGVjdGlvbiBvcHRpb24gaXMgTk9U
IGdpdmVuICovCitzdGF0aWMgaW50IGxpc3RfY2IoY2hhciAqbmFtZSwgaW50IG1hdGNobGVuLCBp
bnQgbWF5Y3JlYXRlLAorCQkgIHN0cnVjdCBsaXN0X3JvY2sgKnJvY2spCit7CisgICAgaW50IGxh
c3RfbGVuOworICAgIGludCBsYXN0X25hbWVfaXNfYW5jZXN0b3IgPQorCXJvY2stPmxhc3RfbmFt
ZQorCSYmIG1hdGNobGVuID49IChsYXN0X2xlbiA9IHN0cmxlbihyb2NrLT5sYXN0X25hbWUpKQor
CSYmIG5hbWVbbGFzdF9sZW5dID09ICcuJworCSYmICFtZW1jbXAocm9jay0+bGFzdF9uYW1lLCBu
YW1lLCBsYXN0X2xlbik7CisKKyAgICBsaXN0X2NhbGxiYWNrX2NhbGxzKys7CisKKyAgICBpZiAo
bGFzdF9uYW1lX2lzX2FuY2VzdG9yKQorCXJvY2stPmxhc3RfYXR0cmlidXRlcyB8PSBNQk9YX0FU
VFJJQlVURV9IQVNDSElMRFJFTjsKKworICAgIGlmICghbmFtZVttYXRjaGxlbl0pIHsKKwlpZiAo
ICEgKHJvY2stPmxhc3RfYXR0cmlidXRlcyAmIE1CT1hfQVRUUklCVVRFX0hBU0NISUxEUkVOKSAp
CisJICAgIHJvY2stPmxhc3RfYXR0cmlidXRlcyB8PSBNQk9YX0FUVFJJQlVURV9IQVNOT0NISUxE
UkVOOworCWxpc3RfcmVzcG9uc2Uocm9jay0+bGFzdF9uYW1lLCByb2NrLT5sYXN0X2F0dHJpYnV0
ZXMsIHJvY2stPm9wdHMpOworCWZyZWUocm9jay0+bGFzdF9uYW1lKTsKKwlyb2NrLT5sYXN0X25h
bWUgPSB4c3RyZHVwKG5hbWUpOworCXJvY2stPmxhc3RfYXR0cmlidXRlcyA9IDA7CisJaWYgKCFt
YXljcmVhdGUpCisJICAgIHJvY2stPmxhc3RfYXR0cmlidXRlcyB8PSBNQk9YX0FUVFJJQlVURV9O
T0lORkVSSU9SUzsKKwkvKiB4eHg6IGlzIHRoZXJlIGEgY2hlYXBlciB3YXkgdG8gZmlndXJlIG91
dCBcU3Vic2NyaWJlZD8gKi8KKwlpZiAocm9jay0+b3B0cyAmIExJU1RfUkVUX1NVQlNDUklCRUQp
CisJICAgIG1ib3hsaXN0X2ZpbmRzdWIoJmltYXBkX25hbWVzcGFjZSwgbmFtZSwgaW1hcGRfdXNl
cmlzYWRtaW4sCisJCQkgICAgIGltYXBkX3VzZXJpZCwgaW1hcGRfYXV0aHN0YXRlLCBzZXRfc3Vi
c2NyaWJlZCwKKwkJCSAgICAgJnJvY2stPmxhc3RfYXR0cmlidXRlcywgMCk7CisgICAgfSBlbHNl
IGlmIChuYW1lW21hdGNobGVuXSA9PSAnLicKKwkgICAgJiYgISAocm9jay0+b3B0cyAmIExJU1Rf
T1BUX0VYVEVOREVEKQorCSAgICAmJiByb2NrLT50cmFpbGluZ19wZXJjZW50KSB7CisJLyogc3Bl
Y2lhbCBjYXNlOiBpZiB0aGUgbWFpbGJveCBuYW1lIGFyZ3VtZW50IG9mIGEgbm9uLWV4dGVuZGVk
IExpc3QKKwkgKiBjb21tYW5kIGVuZHMgd2l0aCAlLCB3ZSBtdXN0IGluY2x1ZGUgbWF0Y2hpbmcg
bGV2ZWxzIG9mIGhpZXJhcmNoeSAqLworCWlmICggISAocm9jay0+bGFzdF9uYW1lCisJCSAgICAm
JiAhc3RybmNtcChyb2NrLT5sYXN0X25hbWUsIG5hbWUsIG1hdGNobGVuKQorCQkgICAgJiYgKHJv
Y2stPmxhc3RfbmFtZVttYXRjaGxlbl0gPT0gJ1wwJworCQkJfHwgcm9jay0+bGFzdF9uYW1lW21h
dGNobGVuXSA9PSAnLicpKSApIHsKKwkgICAgbGlzdF9yZXNwb25zZShyb2NrLT5sYXN0X25hbWUs
IHJvY2stPmxhc3RfYXR0cmlidXRlcywgcm9jay0+b3B0cyk7CisJICAgIGZyZWUocm9jay0+bGFz
dF9uYW1lKTsKKwkgICAgcm9jay0+bGFzdF9uYW1lID0geHN0cm5kdXAobmFtZSwgbWF0Y2hsZW4p
OworCSAgICByb2NrLT5sYXN0X2F0dHJpYnV0ZXMgPSBNQk9YX0FUVFJJQlVURV9OT05FWElTVEVO
VAorCQl8IE1CT1hfQVRUUklCVVRFX05PU0VMRUNUIHwgTUJPWF9BVFRSSUJVVEVfSEFTQ0hJTERS
RU47CisJfQorICAgIH0KKworICAgIHJldHVybiAwOworfQorCisvKiBjYWxsYmFjayBmb3IgbWJv
eGxpc3RfZmluZHN1YgorICogdXNlZCB3aGVuIFNVQlNDUklCRUQgYnV0IG5vdCBSRUNVUlNJVkVN
QVRDSCBpcyBnaXZlbiAqLworc3RhdGljIGludCBzdWJzY3JpYmVkX2NiKGNoYXIgKm5hbWUsIGlu
dCBtYXRjaGxlbiwgaW50IG1heWNyZWF0ZSwKKwkJCSBzdHJ1Y3QgbGlzdF9yb2NrICpyb2NrKQor
eworICAgIGxpc3RfY2FsbGJhY2tfY2FsbHMrKzsKKworICAgIGlmICghbmFtZVttYXRjaGxlbl0p
IHsKKwlsaXN0X3Jlc3BvbnNlKHJvY2stPmxhc3RfbmFtZSwgcm9jay0+bGFzdF9hdHRyaWJ1dGVz
LCByb2NrLT5vcHRzKTsKKwlmcmVlKHJvY2stPmxhc3RfbmFtZSk7CisJcm9jay0+bGFzdF9uYW1l
ID0geHN0cmR1cChuYW1lKTsKKwlyb2NrLT5sYXN0X2F0dHJpYnV0ZXMgPSBNQk9YX0FUVFJJQlVU
RV9TVUJTQ1JJQkVEOworCWlmICghbWF5Y3JlYXRlKQorCSAgICByb2NrLT5sYXN0X2F0dHJpYnV0
ZXMgfD0gTUJPWF9BVFRSSUJVVEVfTk9JTkZFUklPUlM7CisgICAgfSBlbHNlIGlmIChuYW1lW21h
dGNobGVuXSA9PSAnLicKKwkgICAgJiYgcm9jay0+b3B0cyAmIExJU1RfT1BUX0xTVUIKKwkgICAg
JiYgcm9jay0+dHJhaWxpbmdfcGVyY2VudCkgeworCS8qIHNwZWNpYWwgY2FzZTogaWYgdGhlIG1h
aWxib3ggbmFtZSBhcmd1bWVudCBvZiBhbiBMc3ViIGNvbW1hbmQgZW5kcworCSAqIHdpdGggJSwg
bWFpbGJveCBuYW1lcyB0aGF0IG1hdGNoIHRoZSBwYXR0ZXJuIGJ1dCBhcmVuJ3Qgc3Vic2NyaWJl
ZAorCSAqIG11c3QgYWxzbyBiZSByZXR1cm5lZCBpZiB0aGV5IGhhdmUgYSBjaGlsZCBtYWlsYm94
IHRoYXQgaXMKKwkgKiBzdWJzY3JpYmVkICovCisJbmFtZVttYXRjaGxlbl0gPSAnXDAnOworCWlm
ICggISAocm9jay0+bGFzdF9uYW1lICYmICFzdHJjbXAocm9jay0+bGFzdF9uYW1lLCBuYW1lKSkg
KSB7CisJICAgIGxpc3RfcmVzcG9uc2Uocm9jay0+bGFzdF9uYW1lLCByb2NrLT5sYXN0X2F0dHJp
YnV0ZXMsIHJvY2stPm9wdHMpOworCSAgICBmcmVlKHJvY2stPmxhc3RfbmFtZSk7CisJICAgIHJv
Y2stPmxhc3RfbmFtZSA9IHhzdHJkdXAobmFtZSk7CisJICAgIHJvY2stPmxhc3RfYXR0cmlidXRl
cyA9IE1CT1hfQVRUUklCVVRFX0NISUxESU5GT19TVUJTQ1JJQkVEOworCX0KKwluYW1lW21hdGNo
bGVuXSA9ICcuJzsKKyAgICB9CisKKyAgICByZXR1cm4gMDsKK30KKworLyoKKyAqIFRha2VzIHRo
ZSAicmVmZXJlbmNlIG5hbWUiIGFuZCAibWFpbGJveCBuYW1lIiBhcmd1bWVudHMgb2YgdGhlIExJ
U1QgY29tbWFuZAorICogYW5kIHJldHVybnMgYSAiY2Fub25pY2FsIExJU1QgcGF0dGVybiIuIFRo
ZSBjYWxsZXIgaXMgcmVzcG9uc2libGUgZm9yCisgKiBmcmVlKClpbmcgdGhlIHJldHVybmVkIHN0
cmluZy4KKyAqLworY2hhciAqY2Fub25pY2FsX2xpc3RfcGF0dGVybihjb25zdCBjaGFyICpyZWZl
cmVuY2UsIGNvbnN0IGNoYXIgKnBhdHRlcm4pCit7CisgICAgaW50IHBhdGxlbiA9IHN0cmxlbihw
YXR0ZXJuKTsKKyAgICBpbnQgcmVmbGVuID0gc3RybGVuKHJlZmVyZW5jZSk7CisKKyAgICBjaGFy
ICpidWYgPSB4bWFsbG9jKHBhdGxlbiArIHJlZmxlbiArIDEpOworICAgIGJ1ZlswXSA9ICdcMCc7
CisKKyAgICBpZiAoKnJlZmVyZW5jZSkgeworCWlmIChyZWZlcmVuY2VbcmVmbGVuLTFdID09IGlt
YXBkX25hbWVzcGFjZS5oaWVyX3NlcCAmJgorCQlwYXR0ZXJuWzBdID09IGltYXBkX25hbWVzcGFj
ZS5oaWVyX3NlcCkKKwkgICAgLS1yZWZsZW47CisJbWVtY3B5KGJ1ZiwgcmVmZXJlbmNlLCByZWZs
ZW4pOworCWJ1ZltyZWZsZW5dID0gJ1wwJzsKKyAgICB9CisgICAgc3RyY2F0KGJ1ZiwgcGF0dGVy
bik7CisKKyAgICByZXR1cm4gYnVmOworfQorCisvKgorICogVHVybnMgdGhlIHN0cmluZ3MgaW4g
cGF0dGVybnMgaW50byAiY2Fub25pY2FsIExJU1QgcGF0dGVybiJzLiBBbHNvCisgKiB0cmFuc2xh
dGVzIGFueSBoaWVyYXJjaHkgc2VwYXJhdG9ycy4KKyAqLwordm9pZCBjYW5vbmljYWxfbGlzdF9w
YXR0ZXJucyhjaGFyICpyZWZlcmVuY2UsIHN0cnVjdCBzdHJsaXN0ICpwYXR0ZXJucykKK3sKKyAg
ICBzdGF0aWMgaW50IGlnbm9yZXJlZmVyZW5jZSA9IDA7CisgICAgY2hhciAqb2xkOworCisgICAg
LyogSWdub3JlIHRoZSByZWZlcmVuY2UgYXJndW1lbnQ/CisgICAgICAgKHRoZSBiZWhhdmlvciBp
biAxLjUuMTAgJiBvbGRlcikgKi8KKyAgICBpZiAoaWdub3JlcmVmZXJlbmNlID09IDApCisJaWdu
b3JlcmVmZXJlbmNlID0gY29uZmlnX2dldHN3aXRjaChJTUFQT1BUX0lHTk9SRVJFRkVSRU5DRSk7
CisKKyAgICBmb3IgKDsgcGF0dGVybnM7IHBhdHRlcm5zID0gcGF0dGVybnMtPm5leHQpIHsKKwlp
ZiAoIWlnbm9yZXJlZmVyZW5jZSB8fCBwYXR0ZXJucy0+c1swXSA9PSBpbWFwZF9uYW1lc3BhY2Uu
aGllcl9zZXApIHsKKwkgICAgb2xkID0gcGF0dGVybnMtPnM7CisJICAgIHBhdHRlcm5zLT5zID0g
Y2Fub25pY2FsX2xpc3RfcGF0dGVybihyZWZlcmVuY2UsIG9sZCk7CisJICAgIGZyZWUob2xkKTsK
Kwl9CisJLyogVHJhbnNsYXRlIGFueSBzZXBhcmF0b3JzIGluIHBhdHRlcm4gKi8KKwltYm94bmFt
ZV9oaWVyc2VwX3RvaW50ZXJuYWwoJmltYXBkX25hbWVzcGFjZSwgcGF0dGVybnMtPnMsCisJCQkJ
ICAgIGNvbmZpZ192aXJ0ZG9tYWlucyA/CisJCQkJICAgIHN0cmNzcG4ocGF0dGVybnMtPnMsICJA
IikgOiAwKTsKKyAgICB9Cit9CisKKy8qIFJldHJpZXZlcyB0aGUgZGF0YSBhbmQgcHJpbnRzIHRo
ZSB1bnRhZ2dlZCByZXNwb25zZXMgZm9yIGEgTElTVCBjb21tYW5kLiAqLworc3RhdGljIHZvaWQg
bGlzdF9kYXRhKGNoYXIgKnJlZmVyZW5jZSwgaW50IGxpc3RvcHRzLCBzdHJ1Y3Qgc3RybGlzdCAq
cGF0dGVybnMpCit7CisgICAgaW50ICgqZmluZGFsbCkoc3RydWN0IG5hbWVzcGFjZSAqbmFtZXNw
YWNlLAorCQkgICBjb25zdCBjaGFyICpwYXR0ZXJuLCBpbnQgaXNhZG1pbiwgY2hhciAqdXNlcmlk
LAorCQkgICBzdHJ1Y3QgYXV0aF9zdGF0ZSAqYXV0aF9zdGF0ZSwgaW50ICgqcHJvYykoKSwKKwkJ
ICAgdm9pZCAqcm9jayk7CisgICAgaW50ICgqZmluZHN1Yikoc3RydWN0IG5hbWVzcGFjZSAqbmFt
ZXNwYWNlLAorCQkgICBjb25zdCBjaGFyICpwYXR0ZXJuLCBpbnQgaXNhZG1pbiwgY2hhciAqdXNl
cmlkLAorCQkgICBzdHJ1Y3QgYXV0aF9zdGF0ZSAqYXV0aF9zdGF0ZSwgaW50ICgqcHJvYykoKSwK
KwkJICAgdm9pZCAqcm9jaywgaW50IGZvcmNlKTsKKyAgICBzdHJ1Y3Qgc3RybGlzdCAqcGF0dGVy
bjsKKyAgICBzdHJ1Y3QgbGlzdF9yb2NrIHJvY2s7CisKKyAgICBjYW5vbmljYWxfbGlzdF9wYXR0
ZXJucyhyZWZlcmVuY2UsIHBhdHRlcm5zKTsKKworICAgIC8qIENoZWNrIHRvIHNlZSBpZiB3ZSBz
aG91bGQgb25seSBsaXN0IHRoZSBwZXJzb25hbCBuYW1lc3BhY2UgKi8KKyAgICBpZiAoIShsaXN0
b3B0cyAmIExJU1RfT1BUX0VYVEVOREVEKQorCSAgICAmJiAhc3RyY21wKHBhdHRlcm5zLT5zLCAi
KiIpCisJICAgICYmIGNvbmZpZ19nZXRzd2l0Y2goSU1BUE9QVF9GT09MU1RVUElEQ0xJRU5UUykp
IHsKKwlmcmVlKHBhdHRlcm5zLT5zKTsKKwlwYXR0ZXJucy0+cyA9IHhzdHJkdXAoIklOQk9YKiIp
OworCWZpbmRzdWIgPSBtYm94bGlzdF9maW5kc3ViOworCWZpbmRhbGwgPSBtYm94bGlzdF9maW5k
YWxsOworICAgIH0gZWxzZSB7CisJZmluZHN1YiA9IGltYXBkX25hbWVzcGFjZS5tYm94bGlzdF9m
aW5kc3ViOworCWZpbmRhbGwgPSBpbWFwZF9uYW1lc3BhY2UubWJveGxpc3RfZmluZGFsbDsKKyAg
ICB9CisKKyAgICByb2NrLm9wdHMgPSBsaXN0b3B0czsKKyAgICByb2NrLmxhc3RfbmFtZSA9IE5V
TEw7CisKKyAgICBpZiAobGlzdG9wdHMgJiBMSVNUX1NFTF9TVUJTQ1JJQkVEKSB7CisJZm9yIChw
YXR0ZXJuID0gcGF0dGVybnM7IHBhdHRlcm47IHBhdHRlcm4gPSBwYXR0ZXJuLT5uZXh0KSB7CisJ
ICAgIHJvY2sudHJhaWxpbmdfcGVyY2VudCA9IHBhdHRlcm4tPnNbc3RybGVuKHBhdHRlcm4tPnMp
IC0gMV0gPT0gJyUnOworCSAgICBmaW5kc3ViKCZpbWFwZF9uYW1lc3BhY2UsIHBhdHRlcm4tPnMs
IGltYXBkX3VzZXJpc2FkbWluLAorCQkgICAgaW1hcGRfdXNlcmlkLCBpbWFwZF9hdXRoc3RhdGUs
IHN1YnNjcmliZWRfY2IsICZyb2NrLCAxKTsKKwkgICAgbGlzdF9yZXNwb25zZShyb2NrLmxhc3Rf
bmFtZSwgcm9jay5sYXN0X2F0dHJpYnV0ZXMsIHJvY2sub3B0cyk7CisJICAgIGZyZWUocm9jay5s
YXN0X25hbWUpOworCSAgICByb2NrLmxhc3RfbmFtZSA9IE5VTEw7CisJfQorICAgIH0gZWxzZSB7
CisJcm9jay5vcHRzIHw9IExJU1RfUkVUX0NISUxEUkVOOworCWZvciAocGF0dGVybiA9IHBhdHRl
cm5zOyBwYXR0ZXJuOyBwYXR0ZXJuID0gcGF0dGVybi0+bmV4dCkgeworCSAgICByb2NrLnRyYWls
aW5nX3BlcmNlbnQgPSBwYXR0ZXJuLT5zW3N0cmxlbihwYXR0ZXJuLT5zKSAtIDFdID09ICclJzsK
KwkgICAgZmluZGFsbCgmaW1hcGRfbmFtZXNwYWNlLCBwYXR0ZXJuLT5zLCBpbWFwZF91c2VyaXNh
ZG1pbiwKKwkJICAgIGltYXBkX3VzZXJpZCwgaW1hcGRfYXV0aHN0YXRlLCBsaXN0X2NiLCAmcm9j
ayk7CisJICAgIGxpc3RfcmVzcG9uc2Uocm9jay5sYXN0X25hbWUsIHJvY2subGFzdF9hdHRyaWJ1
dGVzLCByb2NrLm9wdHMpOworCSAgICBmcmVlKHJvY2subGFzdF9uYW1lKTsKKwkgICAgcm9jay5s
YXN0X25hbWUgPSBOVUxMOworCX0KKyAgICB9Cit9CisKKy8qCisgKiBSZXRyaWV2ZXMgdGhlIGRh
dGEgYW5kIHByaW50cyB0aGUgdW50YWdnZWQgcmVzcG9uc2VzIGZvciBhIExJU1QgY29tbWFuZCBp
bgorICogdGhlIGNhc2Ugb2YgYSByZW1vdGUgaW5ib3guCisgKi8KK3N0YXRpYyB2b2lkIGxpc3Rf
ZGF0YV9yZW1vdGUoY2hhciAqdGFnLCBpbnQgbGlzdG9wdHMsIGNoYXIgKnJlZmVyZW5jZSwKKwkJ
CSAgICAgc3RydWN0IHN0cmxpc3QgKnBhdHRlcm4pCit7CisgICAgaWYgKGxpc3RvcHRzICYgTElT
VF9PUFRfRVhURU5ERUQKKwkgICAgJiYgIUNBUEEoYmFja2VuZF9pbmJveCwgQ0FQQV9MSVNURVhU
RU5ERUQpKSB7CisJLyogY2xpZW50IHdhbnRzIHRvIHVzZSBleHRlbmRlZCBsaXN0IGNvbW1hbmQg
YnV0IGJhY2tlbmQgZG9lc24ndAorCSAqIHN1cHBvcnQgaXQgKi8KKwlwcm90X3ByaW50ZihiYWNr
ZW5kX2luYm94LT5vdXQsCisJCSAgICAiJXMgTk8gQmFja2VuZCBzZXJ2ZXIgZG9lcyBub3Qgc3Vw
cG9ydCBleHRlbmRlZCBsaXN0IGNvbW1hbmRcclxuIiwKKwkJICAgIHRhZyk7CisJcmV0dXJuOwor
ICAgIH0KKworICAgIC8qIHByaW50IHRhZywgY29tbWFuZCBhbmQgbGlzdCBzZWxlY3Rpb24gb3B0
aW9ucyAqLworICAgIGlmIChsaXN0b3B0cyAmIExJU1RfT1BUX0VYVEVOREVEKSB7CisJaW50IGZp
cnN0ID0gMTsKKwlwcm90X3ByaW50ZihiYWNrZW5kX2luYm94LT5vdXQsICIlcyBMaXN0ICgiLCB0
YWcpOworCWlmIChsaXN0b3B0cyAmIExJU1RfU0VMX1NVQlNDUklCRUQpIHsKKwkgICAgcHJvdF9w
cmludGYoYmFja2VuZF9pbmJveC0+b3V0LCAic3Vic2NyaWJlZCIpOworCSAgICBmaXJzdCA9IDA7
CisJfQorCWlmIChsaXN0b3B0cyAmIExJU1RfU0VMX1JFTU9URSkgeworCSAgICBwcm90X3ByaW50
ZihiYWNrZW5kX2luYm94LT5vdXQsICIgcmVtb3RlIitmaXJzdCk7CisJICAgIGZpcnN0ID0gMDsK
Kwl9CisJaWYgKGxpc3RvcHRzICYgTElTVF9TRUxfUkVDVVJTSVZFTUFUQ0gpCisJICAgIHByb3Rf
cHJpbnRmKGJhY2tlbmRfaW5ib3gtPm91dCwgIiByZWN1cnNpdmVtYXRjaCIrZmlyc3QpOworCXBy
b3RfcHJpbnRmKGJhY2tlbmRfaW5ib3gtPm91dCwgIikgIik7CisgICAgfSBlbHNlIHsKKwlwcm90
X3ByaW50ZihiYWNrZW5kX2luYm94LT5vdXQsICIlcyBMc3ViICIsIHRhZyk7CisgICAgfQorCisg
ICAgLyogcHJpbnQgcmVmZXJlbmNlIGFyZ3VtZW50ICovCisgICAgcHJvdF9wcmludGYoYmFja2Vu
ZF9pbmJveC0+b3V0LAorCQkieyVkK31cclxuJXMgIiwgc3RybGVuKHJlZmVyZW5jZSksIHJlZmVy
ZW5jZSk7CisKKyAgICAvKiBwcmludCBtYWlsYm94IHBhdHRlcm4ocykgKi8KKyAgICBpZiAocGF0
dGVybi0+bmV4dCkgeworCWludCBmaXJzdCA9IDE7CisJcHJvdF9wdXRjKCcoJywgYmFja2VuZF9p
bmJveC0+b3V0KTsKKwlmb3IgKDsgcGF0dGVybjsgcGF0dGVybiA9IHBhdHRlcm4tPm5leHQpIHsK
KwkgICAgcHJvdF9wcmludGYoYmFja2VuZF9pbmJveC0+b3V0LCAKKwkJCSIgeyVkK31cclxuJXMi
K2ZpcnN0LCBzdHJsZW4ocGF0dGVybi0+cyksIHBhdHRlcm4tPnMpOworCSAgICBmaXJzdCA9IDA7
CisJfQorCXByb3RfcHV0YygnKScsIGJhY2tlbmRfaW5ib3gtPm91dCk7CisgICAgfSBlbHNlIHsK
Kwlwcm90X3ByaW50ZihiYWNrZW5kX2luYm94LT5vdXQsIAorCQkgICAgInslZCt9XHJcbiVzIiwg
c3RybGVuKHBhdHRlcm4tPnMpLCBwYXR0ZXJuLT5zKTsKKwlwYXR0ZXJuID0gcGF0dGVybi0+bmV4
dDsKKyAgICB9CisKKyAgICAvKiBwcmludCBsaXN0IHJldHVybiBvcHRpb25zICovCisgICAgaWYg
KGxpc3RvcHRzICYgbGlzdF9yZXRfb3B0cykgeworCXByb3RfcHJpbnRmKGJhY2tlbmRfaW5ib3gt
Pm91dCwgIiByZXR1cm4gKCIpOworCWludCBmaXJzdCA9IDE7CisJaWYgKGxpc3RvcHRzICYgTElT
VF9SRVRfU1VCU0NSSUJFRCkgeworCSAgICBwcm90X3ByaW50ZihiYWNrZW5kX2luYm94LT5vdXQs
ICJzdWJzY3JpYmVkIik7CisJICAgIGZpcnN0ID0gMDsKKwl9CisJaWYgKGxpc3RvcHRzICYgTElT
VF9SRVRfQ0hJTERSRU4pIHsKKwkgICAgcHJvdF9wcmludGYoYmFja2VuZF9pbmJveC0+b3V0LCAi
IGNoaWxkcmVuIitmaXJzdCk7CisJfQorCXByb3RfcHV0YygnKScsIGJhY2tlbmRfaW5ib3gtPm91
dCk7CisgICAgfQorCisgICAgcHJvdF9wcmludGYoYmFja2VuZF9pbmJveC0+b3V0LCAiXHJcbiIp
OworICAgIHBpcGVfbHN1YihiYWNrZW5kX2luYm94LCB0YWcsIDAsCisJICAgICAgKGxpc3RvcHRz
ICYgTElTVF9PUFRfTFNVQikgPyAiTFNVQiIgOiAiTElTVCIpOworfQorCisjZW5kaWYgLyogRU5B
QkxFX0xJU1RFWFQgKi8KKwogLyogUmVzZXQgdGhlIGdpdmVuIHNhc2xfY29ubl90IHRvIGEgc2Fu
ZSBzdGF0ZSAqLwogc3RhdGljIGludCByZXNldF9zYXNsY29ubihzYXNsX2Nvbm5fdCAqKmNvbm4p
IAogewpkaWZmIC1OYXVyYiAtLWV4Y2x1ZGU9LnN2biBicmFuY2hlcy9jeXJ1c2hlYWQvaW1hcC9p
bWFwZC5oIHRydW5rL2ltYXAvaW1hcGQuaAotLS0gYnJhbmNoZXMvY3lydXNoZWFkL2ltYXAvaW1h
cGQuaAkyMDA2LTAzLTMxIDIxOjIyOjIxLjAwMDAwMDAwMCArMDIwMAorKysgdHJ1bmsvaW1hcC9p
bWFwZC5oCTIwMDYtMDgtMjQgMTU6MTA6MzEuMDAwMDAwMDAwICswMjAwCkBAIC0yMjUsNiArMjI1
LDggQEAKICAgICBTVEFUVVNfSElHSEVTVE1PRFNFUSA9CSgxPDw1KQogfTsKIAorI2lmZGVmIEVO
QUJMRV9MSVNURVhUCisKIC8qIEJpdG1hc2sgZm9yIGxpc3Qgb3B0aW9ucyAqLwogZW51bSB7CiAg
ICAgTElTVF9MU1VCID0JCQkoMTw8MCksCkBAIC0yMzQsNiArMjM2LDUwIEBACiAgICAgTElTVF9S
RU1PVEUgPQkJKDE8PDQpCiB9OwogCisjZWxzZSAvKiBFTkFCTEVfTElTVEVYVCAqLworCitlbnVt
IHsKKyAgICAvKiBMSVNUIHNlbGVjdGlvbiBvcHRpb25zICovCisgICAgTElTVF9TRUxfU1VCU0NS
SUJFRCA9CSgxPDwwKSwKKyAgICBMSVNUX1NFTF9SRU1PVEUgPQkJKDE8PDEpLAorICAgIExJU1Rf
U0VMX1JFQ1VSU0lWRU1BVENIID0JKDE8PDIpLAorCisgICAgLyogTElTVCByZXR1cm4gb3B0aW9u
cyAqLworICAgIExJU1RfUkVUX1NVQlNDUklCRUQgPQkoMTw8OCksCisgICAgTElTVF9SRVRfQ0hJ
TERSRU4gPQkJKDE8PDkpLAorCisgICAgLyogb3RoZXIgb3B0aW9ucyAqLworICAgIExJU1RfT1BU
X1JMSVNUID0gICAgICAgICAgICAoMTw8MTYpLAorICAgIExJU1RfT1BUX0xTVUIgPSAgICAgICAg
ICAgICAoMTw8MTcpLAorICAgIExJU1RfT1BUX0VYVEVOREVEID0gICAgICAgICAoMTw8MTgpLCAv
KiBleHRlbmRlZCBMaXN0IGNvbW1hbmQgKi8KKyAgICAvKiAuLi4gYXMgc3BlY2lmaWVkIGluIGRy
YWZ0LWlldGYtaW1hcGV4dC1saXN0LWV4dGVuc2lvbnMtMDMudHh0ICovCisgICAgTElTVF9PUFRf
RVhURU5ERURfVjAzID0gICAgICgxPDwxOSksCisgICAgLyogLi4uIGFzIHNwZWNpZmllZCBpbiBk
cmFmdC1pZXRmLWltYXBleHQtbGlzdC1leHRlbnNpb25zLTE3LnR4dCAqLworICAgIExJU1RfT1BU
X0VYVEVOREVEX1YxNyA9ICAgICAoMTw8MjApCit9OworI2RlZmluZSBsaXN0X3NlbF9vcHRzIChM
SVNUX1JFVF9TVUJTQ1JJQkVEIC0gMSkKKyNkZWZpbmUgbGlzdF9yZXRfb3B0cyAoKExJU1RfT1BU
X1JMSVNUIC0gMSkgJiB+bGlzdF9zZWxfb3B0cykKKworLyogTmFtZSBhdHRyaWJ1dGVzIHRoYXQg
bWF5IGJlIHJldHVuZWQgYnkgTElTVCAqLworZW51bSB7CisgICAgLyogZnJvbSBSRkMgMzUwMSAq
LworICAgIE1CT1hfQVRUUklCVVRFX05PSU5GRVJJT1JTICAgPSAoMTw8MCksCisgICAgTUJPWF9B
VFRSSUJVVEVfTk9TRUxFQ1QgICAgICA9ICgxPDwxKSwKKyAgICBNQk9YX0FUVFJJQlVURV9NQVJL
RUQgICAgICAgID0gKDE8PDIpLAorICAgIE1CT1hfQVRUUklCVVRFX1VOTUFSS0VEICAgICAgPSAo
MTw8MyksCisKKyAgICAvKiBmcm9tIGRyYWZ0LWlldGYtaW1hcGV4dC1saXN0LWV4dGVuc2lvbnMt
MTcudHh0ICovCisgICAgTUJPWF9BVFRSSUJVVEVfTk9ORVhJU1RFTlQgICA9ICgxPDw0KSwKKyAg
ICBNQk9YX0FUVFJJQlVURV9TVUJTQ1JJQkVEICAgID0gKDE8PDUpLAorICAgIE1CT1hfQVRUUklC
VVRFX1JFTU9URSAgICAgICAgPSAoMTw8NiksCisgICAgTUJPWF9BVFRSSUJVVEVfSEFTQ0hJTERS
RU4gICA9ICgxPDw3KSwKKyAgICBNQk9YX0FUVFJJQlVURV9IQVNOT0NISUxEUkVOID0gKDE8PDgp
LAorICAgIE1CT1hfQVRUUklCVVRFX0NISUxESU5GT19TVUJTQ1JJQkVEID0gKDE8PDkpCit9Owor
I2RlZmluZSBsaXN0X2NoaWxkaW5mbyAoTUJPWF9BVFRSSUJVVEVfQ0hJTERJTkZPX1NVQlNDUklC
RUQpCisKKyNlbmRpZiAvKiBFTkFCTEVfTElTVEVYVCAqLworCiBleHRlcm4gc3RydWN0IHByb3Rz
dHJlYW0gKmltYXBkX291dCwgKmltYXBkX2luOwogCiBleHRlcm4gdm9pZCBpbmRleF9jbG9zZW1h
aWxib3goc3RydWN0IG1haWxib3ggKm1haWxib3gpOwpkaWZmIC1OYXVyYiAtLWV4Y2x1ZGU9LnN2
biBicmFuY2hlcy9jeXJ1c2hlYWQvaW1hcC9wcm90b2NvbC5jIHRydW5rL2ltYXAvcHJvdG9jb2wu
YwotLS0gYnJhbmNoZXMvY3lydXNoZWFkL2ltYXAvcHJvdG9jb2wuYwkyMDA2LTA4LTAyIDE3OjE2
OjIwLjAwMDAwMDAwMCArMDIwMAorKysgdHJ1bmsvaW1hcC9wcm90b2NvbC5jCTIwMDYtMDgtMTEg
MTM6Mzk6MjUuMDAwMDAwMDAwICswMjAwCkBAIC0xMTUsNiArMTE1LDcgQEAKIAkgIHsgIiBNVUxU
SUFQUEVORCIsIENBUEFfTVVMVElBUFBFTkQgfSwKIAkgIHsgIiBMSVNULVNVQlNDUklCRUQiLCBD
QVBBX0xJU1RTVUJTQ1JJQkVEIH0sCiAJICB7ICIgUklHSFRTPWt4dGUiLCBDQVBBX0FDTFJJR0hU
UyB9LAorCSAgeyAiIExJU1QtRVhURU5ERUQiLCBDQVBBX0xJU1RFWFRFTkRFRCB9LAogCSAgeyBO
VUxMLCAwIH0gfSB9LAogICAgICAgeyAiUzAxIFNUQVJUVExTIiwgIlMwMSBPSyIsICJTMDEgTk8i
IH0sCiAgICAgICB7ICJBMDEgQVVUSEVOVElDQVRFIiwgMCwgMCwgIkEwMSBPSyIsICJBMDEgTk8i
LCAiKyAiLCAiKiIsIE5VTEwgfSwKZGlmZiAtTmF1cmIgLS1leGNsdWRlPS5zdm4gYnJhbmNoZXMv
Y3lydXNoZWFkL2ltYXAvcHJvdG9jb2wuaCB0cnVuay9pbWFwL3Byb3RvY29sLmgKLS0tIGJyYW5j
aGVzL2N5cnVzaGVhZC9pbWFwL3Byb3RvY29sLmgJMjAwNi0wOC0wMiAxNzoxNjoyMC4wMDAwMDAw
MDAgKzAyMDAKKysrIHRydW5rL2ltYXAvcHJvdG9jb2wuaAkyMDA2LTA4LTExIDEzOjM5OjI1LjAw
MDAwMDAwMCArMDIwMApAQCAtNTcsMTMgKzU3LDE0IEBACiAgICAgQ0FQQV9NVUxUSUFQUEVORAk9
ICgxIDw8IDQpLAogICAgIENBUEFfTElTVFNVQlNDUklCRUQJPSAoMSA8PCA1KSwKICAgICBDQVBB
X0FDTFJJR0hUUwk9ICgxIDw8IDYpLAorICAgIENBUEFfTElTVEVYVEVOREVEICAgPSAoMSA8PCA3
KSwKIAogICAgIC8qIExNVFAgY2FwYWJpbGl0aWVzICovCiAgICAgQ0FQQV9QSVBFTElOSU5HCT0g
KDEgPDwgMiksCiAgICAgQ0FQQV9JR05PUkVRVU9UQQk9ICgxIDw8IDMpCiB9OwogCi0jZGVmaW5l
IE1BWF9DQVBBIDcKKyNkZWZpbmUgTUFYX0NBUEEgOAogCiBzdHJ1Y3QgY2FwYV90IHsKICAgICBj
b25zdCBjaGFyICpzdHI7Cg==
</data>        

          </attachment>
          <attachment
              isobsolete="1"
              ispatch="1"
              isprivate="0"
          >
            <attachid>471</attachid>
            <date>2006-10-16 18:05 EDT</date>
            <desc>Patch for draft-ietf-imapext-list-extensions-18 r59</desc>
            <filename>list-extended-r59.patch</filename>
            <type>text/plain</type>
            <size>41193</size>
            <attacher>martin.konold@erfrakon.de</attacher>
            
              <data encoding="base64">ZGlmZiAtciAtLWV4Y2x1ZGU9LnN2biAuLi9jeXJ1c2hlYWQvY29uZmlndXJlLmluIC4vY29uZmln
dXJlLmluCjkzNiw5MzdjOTM2LDkzNwo8IEFDX0FSR19FTkFCTEUobGlzdGV4dCwKPCAJWyAgLS1l
bmFibGUtbGlzdGV4dCAgICAgICAgZW5hYmxlIElNQVAgTGlzdCBleHRlbnNpb25zXSwKLS0tCj4g
QUNfQVJHX0VOQUJMRShsaXN0LWV4dGVuZGVkLAo+IAlbICAtLWVuYWJsZS1saXN0LWV4dGVuZGVk
ICBlbmFibGUgSU1BUCBMSVNULUVYVEVOREVEIExpc3QgZXh0ZW5zaW9uc10sCjkzOWM5MzkKPCAJ
CUFDX0RFRklORShFTkFCTEVfTElTVEVYVCxbXSxbRW5hYmxlIHRoZSBMSVNURVhUIGV4dGVuc2lv
bj9dKQotLS0KPiAJCUFDX0RFRklORShFTkFCTEVfTElTVF9FWFRFTkRFRCxbXSxbRW5hYmxlIHRo
ZSBMSVNULUVYVEVOREVEIGV4dGVuc2lvbj9dKQpkaWZmIC1yIC0tZXhjbHVkZT0uc3ZuIC4uL2N5
cnVzaGVhZC9kb2Mvc3BlY3MuaHRtbCAuL2RvYy9zcGVjcy5odG1sCjU3YzU3CjwgPFRSPjxURD48
QSBIUkVGPSJodHRwOi8vd3d3LmlldGYub3JnL2ludGVybmV0LWRyYWZ0cy9kcmFmdC1pZXRmLWlt
YXBleHQtbGlzdC1leHRlbnNpb25zLTEzLnR4dCI+Ci0tLQo+IDxUUj48VEQ+PEEgSFJFRj0iaHR0
cDovL3d3dy5pZXRmLm9yZy9pbnRlcm5ldC1kcmFmdHMvZHJhZnQtaWV0Zi1pbWFwZXh0LWxpc3Qt
ZXh0ZW5zaW9ucy0xNy50eHQiPgpkaWZmIC1yIC0tZXhjbHVkZT0uc3ZuIC4uL2N5cnVzaGVhZC9p
bWFwL2ltYXBkLmMgLi9pbWFwL2ltYXBkLmMKNzRhNzUKPiAjaW5jbHVkZSAiaGFzaC5oIgoxNTdh
MTU5Cj4gCjE5NmExOTksMjUyCj4gc3RhdGljIHN0cnVjdCBtYm94X25hbWVfYXR0cmlidXRlIHsK
PiAgICAgaW50IGZsYWc7Cj4gICAgIGNoYXIgKmlkOwo+IH0gbWJveF9uYW1lX2F0dHJpYnV0ZXNb
XSA9IHsKPiAgICAgLyogZnJvbSBSRkMgMzUwMSAqLwo+ICAgICB7IE1CT1hfQVRUUklCVVRFX05P
SU5GRVJJT1JTLCAgICJcXE5vaW5mZXJpb3JzIiAgIH0sCj4gICAgIHsgTUJPWF9BVFRSSUJVVEVf
Tk9TRUxFQ1QsICAgICAgIlxcTm9zZWxlY3QiICAgICAgfSwKPiAgICAgeyBNQk9YX0FUVFJJQlVU
RV9NQVJLRUQsICAgICAgICAiXFxNYXJrZWQiICAgICAgICB9LAo+ICAgICB7IE1CT1hfQVRUUklC
VVRFX1VOTUFSS0VELCAgICAgICJcXFVubWFya2VkIiAgICAgIH0sCj4gCj4gICAgIC8qIGZyb20g
ZHJhZnQtaWV0Zi1pbWFwZXh0LWxpc3QtZXh0ZW5zaW9ucy0xNy50eHQgKi8KPiAgICAgeyBNQk9Y
X0FUVFJJQlVURV9OT05FWElTVEVOVCwgICAiXFxOb25FeGlzdGVudCIgICB9LAo+ICAgICB7IE1C
T1hfQVRUUklCVVRFX1NVQlNDUklCRUQsICAgICJcXFN1YnNjcmliZWQiICAgIH0sCj4gICAgIHsg
TUJPWF9BVFRSSUJVVEVfUkVNT1RFLCAgICAgICAgIlxcUmVtb3RlIiAgICAgICAgfSwKPiAgICAg
eyBNQk9YX0FUVFJJQlVURV9IQVNDSElMRFJFTiwgICAiXFxIYXNDaGlsZHJlbiIgICB9LAo+ICAg
ICB7IE1CT1hfQVRUUklCVVRFX0hBU05PQ0hJTERSRU4sICJcXEhhc05vQ2hpbGRyZW4iIH0sCj4g
Cj4gICAgIHsgMCwgTlVMTCB9Cj4gfTsKPiAKPiAvKgo+ICAqIFRoZXNlIGJpdG1hc2tzIGRlZmlu
ZSBob3cgTGlzdCBzZWxlY3Rpb24gb3B0aW9ucyBjYW4gYmUgY29tYmluZWQ6Cj4gICogbGlzdF9z
ZWxlY3RfbW9kX29wdHMgbWF5IG9ubHkgYmUgdXNlZCBpZiBhdCBsZWFzdCBvbmUgbGlzdF9zZWxl
Y3RfYmFzZV9vcHQKPiAgKiBpcyBhbHNvIHByZXNlbnQuCj4gICogRm9yIGV4YW1wbGUsIChSRUNV
UlNJVkVNQVRDSCkgYW5kIChSRUNVUlNJVkVNQVRDSCBSRU1PVEUpIGFyZSBpbnZhbGlkLCBidXQK
PiAgKiAoUkVDVVJTSVZFTUFUQ0ggU1VCU0NSSUJFRCkgaXMgb2suCj4gICovCj4gc3RhdGljIGNv
bnN0IGludCBsaXN0X3NlbGVjdF9iYXNlX29wdHMgPSBMSVNUX1NFTF9TVUJTQ1JJQkVEOwo+IHN0
YXRpYyBjb25zdCBpbnQgbGlzdF9zZWxlY3RfbW9kX29wdHMgPSBMSVNUX1NFTF9SRUNVUlNJVkVN
QVRDSDsKPiAKPiAvKiBzdHJ1Y3R1cmUgdGhhdCBsaXN0X2RhdGEgcGFzc2VzIGl0cyBjYWxsYmFj
a3MgKi8KPiBzdHJ1Y3QgbGlzdF9yb2NrIHsKPiAgICAgaW50IG9wdHM7Cj4gICAgIGNoYXIgKmxh
c3RfbmFtZTsKPiAgICAgaW50IGxhc3RfYXR0cmlidXRlczsKPiAgICAgaW50IHRyYWlsaW5nX3Bl
cmNlbnQ7IC8qIHRoZSBtYWlsYm94IG5hbWUgYXJnIGVuZHMgd2l0aCBhICUKPiAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAqIGNhdXNlcyBzcGVjaWFsIGJlaGF2aW9yIHdpdGggbm9uLWV4dGVu
ZGVkIExJU1QKPiAJCQkgICAqIGFuZCBMU1VCICovCj4gfTsKPiAKPiAvKiBJbmZvcm1hdGlvbiBh
Ym91dCBvbmUgbWFpbGJveCBuYW1lIHRoYXQgTElTVCByZXR1cm5zICovCj4gc3RydWN0IGxpc3Rf
ZW50cnkgewo+ICAgICBjaGFyICpuYW1lOwo+ICAgICBpbnQgYXR0cmlidXRlczsgLyogYml0bWFw
IG9mIE1CT1hfQVRUUklCVVRFXyogKi8KPiB9Owo+IAo+IC8qIHN0cnVjdHVyZSB0aGF0IGxpc3Rf
ZGF0YV9yZWN1cnNpdmVtYXRjaCBwYXNzZXMgaXRzIGNhbGxiYWNrcyAqLwo+IHN0cnVjdCBsaXN0
X3JvY2tfcmVjdXJzaXZlbWF0Y2ggewo+ICAgICBpbnQgb3B0czsKPiAgICAgc3RydWN0IGhhc2hf
dGFibGUgdGFibGU7ICAgIC8qIG1hcHMgbWFpbGJveCBuYW1lcyB0byBhdHRyaWJ1dGVzIChpbnQg
KikgKi8KPiAgICAgaW50IGNvdW50OyAgICAgICAgICAgICAgICAgIC8qICMgb2YgZW50cmllcyBp
biB0YWJsZSAqLwo+ICAgICBzdHJ1Y3QgbGlzdF9lbnRyeSAqYXJyYXk7Cj4gfTsKPiAKMjI3YTI4
NCwyODYKPiB2b2lkIHBhcnNlX2xpc3QoY2hhciAqdGFnKTsKPiB2b2lkIGRvX2xpc3QoY2hhciAq
dGFnLCBpbnQgbGlzdG9wdHMsIGNoYXIgKnJlZmVyZW5jZSwKPiAJICAgICBzdHJ1Y3Qgc3RybGlz
dCAqcGF0dGVybnMpOwoyNjksMjcwYzMyOCwzMzAKPCAjaWZkZWYgRU5BQkxFX0xJU1RFWFQKPCBp
bnQgZ2V0bGlzdG9wdHMoY2hhciAqdGFnLCBpbnQgKmxpc3RvcHRzKTsKLS0tCj4gI2lmZGVmIEVO
QUJMRV9MSVNUX0VYVEVOREVECj4gaW50IGdldGxpc3RzZWxvcHRzKGNoYXIgKnRhZywgaW50ICpv
cHRzKTsKPiBpbnQgZ2V0bGlzdHJldG9wdHMoY2hhciAqdGFnLCBpbnQgKm9wdHMpOwoyOTUsMjk3
YzM1NSwzNjkKPCBzdGF0aWMgaW50IGxpc3RkYXRhKGNoYXIgKm5hbWUsIGludCBtYXRjaGxlbiwg
aW50IG1heWNyZWF0ZSwgdm9pZCAqcm9jayk7Cjwgc3RhdGljIHZvaWQgbXN0cmluZ2RhdGEoY2hh
ciAqY21kLCBjaGFyICpuYW1lLCBpbnQgbWF0Y2hsZW4sIGludCBtYXljcmVhdGUsCjwgCQkJaW50
IGxpc3RvcHRzKTsKLS0tCj4gCj4gc3RhdGljIGludCBzZXRfaGFzY2hpbGRyZW4oY2hhciAqbmFt
ZSwgaW50IG1hdGNobGVuLCBpbnQgbWF5Y3JlYXRlLAo+IAkJCSAgIGludCAqYXR0cmlidXRlcyk7
Cj4gc3RhdGljIHZvaWQgbGlzdF9yZXNwb25zZShjaGFyICpuYW1lLCBpbnQgYXR0cmlidXRlcywg
aW50IG9wdHMpOwo+IHN0YXRpYyBpbnQgc2V0X3N1YnNjcmliZWQoY2hhciAqbmFtZSwgaW50IG1h
dGNobGVuLCBpbnQgbWF5Y3JlYXRlLAo+IAkJCSAgaW50ICphdHRyaWJ1dGVzKTsKPiBzdGF0aWMg
Y2hhciAqY2Fub25pY2FsX2xpc3RfcGF0dGVybihjb25zdCBjaGFyICpyZWZlcmVuY2UsIGNvbnN0
IGNoYXIgKnBhdHRlcm4pOwo+IHN0YXRpYyB2b2lkIGNhbm9uaWNhbF9saXN0X3BhdHRlcm5zKGNo
YXIgKnJlZmVyZW5jZSwgc3RydWN0IHN0cmxpc3QgKnBhdHRlcm5zKTsKPiBzdGF0aWMgaW50IGxp
c3RfY2IoY2hhciAqbmFtZSwgaW50IG1hdGNobGVuLCBpbnQgbWF5Y3JlYXRlLAo+IAkJICBzdHJ1
Y3QgbGlzdF9yb2NrICpyb2NrKTsKPiBzdGF0aWMgaW50IHN1YnNjcmliZWRfY2IoY2hhciAqbmFt
ZSwgaW50IG1hdGNobGVuLCBpbnQgbWF5Y3JlYXRlLAo+IAkJCSBzdHJ1Y3QgbGlzdF9yb2NrICpy
b2NrKTsKPiBzdGF0aWMgdm9pZCBsaXN0X2RhdGEoY2hhciAqcmVmZXJlbmNlLCBpbnQgbGlzdG9w
dHMsIHN0cnVjdCBzdHJsaXN0ICpwYXR0ZXJucyk7Cj4gc3RhdGljIHZvaWQgbGlzdF9kYXRhX3Jl
bW90ZShjaGFyICp0YWcsIGludCBsaXN0b3B0cywgY2hhciAqcmVmZXJlbmNlLAo+IAkJCSAgICAg
c3RydWN0IHN0cmxpc3QgKnBhdHRlcm4pOwoxMzU5LDEzNzljMTQzMSwxNDM0CjwgCQlpbnQgbGlz
dG9wdHMgPSBMSVNUX0NISUxEUkVOOwo8ICNpZmRlZiBFTkFCTEVfTElTVEVYVAo8IAkJLyogQ2hl
Y2sgZm9yIGFuZCBwYXJzZSBMSVNURVhUIG9wdGlvbnMgKi8KPCAJCWMgPSBwcm90X2dldGMoaW1h
cGRfaW4pOwo8IAkJaWYgKGMgPT0gJygnKSB7CjwgCQkgICAgYyA9IGdldGxpc3RvcHRzKHRhZy5z
LCAmbGlzdG9wdHMpOwo8IAkJICAgIGlmIChjID09IEVPRikgewo8IAkJCWVhdGxpbmUoaW1hcGRf
aW4sIGMpOwo8IAkJCWNvbnRpbnVlOwo8IAkJICAgIH0KPCAJCX0KPCAJCWVsc2UKPCAJCSAgICBw
cm90X3VuZ2V0YyhjLCBpbWFwZF9pbik7CjwgI2VuZGlmIC8qIEVOQUJMRV9MSVNURVhUICovCjwg
CQlpZiAoaW1hcGRfbWFnaWNwbHVzKSBsaXN0b3B0cyArPSBMSVNUX1NVQlNDUklCRUQ7CjwgCQlj
ID0gZ2V0YXN0cmluZyhpbWFwZF9pbiwgaW1hcGRfb3V0LCAmYXJnMSk7CjwgCQlpZiAoYyAhPSAn
ICcpIGdvdG8gbWlzc2luZ2FyZ3M7CjwgCQljID0gZ2V0YXN0cmluZyhpbWFwZF9pbiwgaW1hcGRf
b3V0LCAmYXJnMik7CjwgCQlpZiAoYyA9PSAnXHInKSBjID0gcHJvdF9nZXRjKGltYXBkX2luKTsK
PCAJCWlmIChjICE9ICdcbicpIGdvdG8gZXh0cmFhcmdzOwo8IAkJY21kX2xpc3QodGFnLnMsIGxp
c3RvcHRzLCBhcmcxLnMsIGFyZzIucyk7Ci0tLQo+IAkJaWYgKGMgIT0gJyAnKQo+IAkJICAgIGdv
dG8gbWlzc2luZ2FyZ3M7Cj4gCj4gCQlwYXJzZV9saXN0KHRhZy5zKTsKMTM4OWMxNDQ0LDE0NDUK
PCAJCWNtZF9saXN0KHRhZy5zLCBMSVNUX0xTVUIgfCBMSVNUX0NISUxEUkVOLCBhcmcxLnMsIGFy
ZzIucyk7Ci0tLQo+IAkJY21kX2xpc3QodGFnLnMsIExJU1RfT1BUX0xTVUIgfCBMSVNUX1NFTF9T
VUJTQ1JJQkVELAo+IAkJCSBhcmcxLnMsIGFyZzIucyk7CjE1NjFjMTYxNywxNjE5CjwgCQljbWRf
bGlzdCh0YWcucywgTElTVF9DSElMRFJFTiB8IExJU1RfUkVNT1RFLCBhcmcxLnMsIGFyZzIucyk7
Ci0tLQo+IAkJY21kX2xpc3QodGFnLnMsCj4gCQkJIExJU1RfT1BUX1JMSVNUIHwgTElTVF9TRUxf
UkVNT1RFIHwgTElTVF9SRVRfQ0hJTERSRU4sCj4gCQkJIGFyZzEucywgYXJnMi5zKTsKMTU3MWMx
NjI5LDE2MzEKPCAJCWNtZF9saXN0KHRhZy5zLCBMSVNUX0xTVUIgfCBMSVNUX0NISUxEUkVOIHwg
TElTVF9SRU1PVEUsCi0tLQo+IAkJY21kX2xpc3QodGFnLnMsCj4gCQkJIExJU1RfT1BUX1JMSVNU
IHwgTElTVF9PUFRfTFNVQiB8IExJU1RfU0VMX1JFTU9URQo+IAkJCSB8IExJU1RfU0VMX1NVQlND
UklCRUQgfCBMSVNUX1JFVF9DSElMRFJFTiwKMTU3MmExNjMzCj4gCjI1OTAsMjU5MmMyNjUxLDI2
NTMKPCAjaWZkZWYgRU5BQkxFX0xJU1RFWFQKPCAgICAgcHJvdF9wcmludGYoaW1hcGRfb3V0LCAi
IExJU1RFWFQgTElTVC1TVUJTQ1JJQkVEIik7CjwgI2VuZGlmIC8qIEVOQUJMRV9MSVNURVhUICov
Ci0tLQo+ICNpZmRlZiBFTkFCTEVfTElTVF9FWFRFTkRFRAo+ICAgICBwcm90X3ByaW50ZihpbWFw
ZF9vdXQsICIgTElTVEVYVCBMSVNULVNVQlNDUklCRUQgTElTVC1FWFRFTkRFRCIpOwo+ICNlbmRp
Zgo1Njc1YzU3MzYsNTczNwo8IHN0YXRpYyBpbnQgbXN0cmluZ2RhdGFjYWxsczsKLS0tCj4gLyog
bm8gdGltZXMgdGhlIGNhbGxiYWNrcyBmb3IgZmluZGFsbC9maW5kc3ViIGhhdmUgYmVlbiBjYWxs
ZWQgKi8KPiBzdGF0aWMgaW50IGxpc3RfY2FsbGJhY2tfY2FsbHM7CjU2NzhjNTc0MAo8ICAqIFBl
cmZvcm0gYSBMSVNUIG9yIExTVUIgY29tbWFuZAotLS0KPiAgKiBQYXJzZSBhbmQgcGVyZm9ybSBh
IExJU1QgY29tbWFuZC4KNTY4MGM1NzQyCjwgdm9pZCBjbWRfbGlzdChjaGFyICp0YWcsIGludCBs
aXN0b3B0cywgY2hhciAqcmVmZXJlbmNlLCBjaGFyICpwYXR0ZXJuKQotLS0KPiB2b2lkIHBhcnNl
X2xpc3QoY2hhciAqdGFnKQo1NjgyLDU2OTdjNTc0NCw1NzQ4CjwgICAgIGNoYXIgKmJ1ZiA9IE5V
TEw7CjwgICAgIGludCBwYXRsZW4gPSAwOwo8ICAgICBpbnQgcmVmbGVuID0gMDsKPCAgICAgc3Rh
dGljIGludCBpZ25vcmVyZWZlcmVuY2UgPSAwOwo8ICAgICBjbG9ja190IHN0YXJ0ID0gY2xvY2so
KTsKPCAgICAgY2hhciBteXRpbWVbMTAwXTsKPCAgICAgaW50ICgqZmluZGFsbCkoc3RydWN0IG5h
bWVzcGFjZSAqbmFtZXNwYWNlLAo8IAkJICAgY29uc3QgY2hhciAqcGF0dGVybiwgaW50IGlzYWRt
aW4sIGNoYXIgKnVzZXJpZCwgCjwgCQkgICBzdHJ1Y3QgYXV0aF9zdGF0ZSAqYXV0aF9zdGF0ZSwg
aW50ICgqcHJvYykoKSwKPCAJCSAgIHZvaWQgKnJvY2spOwo8ICAgICBpbnQgKCpmaW5kc3ViKShz
dHJ1Y3QgbmFtZXNwYWNlICpuYW1lc3BhY2UsCjwgCQkgICBjb25zdCBjaGFyICpwYXR0ZXJuLCBp
bnQgaXNhZG1pbiwgY2hhciAqdXNlcmlkLCAKPCAJCSAgIHN0cnVjdCBhdXRoX3N0YXRlICphdXRo
X3N0YXRlLCBpbnQgKCpwcm9jKSgpLAo8IAkJICAgdm9pZCAqcm9jaywgaW50IGZvcmNlKTsKPCAK
PCAgICAgaWYgKGxpc3RvcHRzICYgTElTVF9SRU1PVEUpIHN1cHBvcnRzX3JlZmVycmFscyA9ICFk
aXNhYmxlX3JlZmVycmFsczsKLS0tCj4gICAgIGludCBsaXN0b3B0cyA9IDA7Cj4gICAgIHN0YXRp
YyBzdHJ1Y3QgYnVmIGJ1ZjsKPiAgICAgaW50IGM7Cj4gICAgIHN0cnVjdCBzdHJsaXN0ICpwYXR0
ZXJucyA9IE5VTEw7Cj4gICAgIGNoYXIgKnJlZmVyZW5jZTsKNTY5OSw1NzAyYzU3NTAsNTc1OQo8
ICAgICAvKiBJZ25vcmUgdGhlIHJlZmVyZW5jZSBhcmd1bWVudD8KPCAgICAgICAgKHRoZSBiZWhh
dmlvciBpbiAxLjUuMTAgJiBvbGRlcikgKi8KPCAgICAgaWYgKGlnbm9yZXJlZmVyZW5jZSA9PSAw
KSB7CjwgCWlnbm9yZXJlZmVyZW5jZSA9IGNvbmZpZ19nZXRzd2l0Y2goSU1BUE9QVF9JR05PUkVS
RUZFUkVOQ0UpOwotLS0KPiAjaWZkZWYgRU5BQkxFX0xJU1RfRVhURU5ERUQKPiAgICAgLyogQ2hl
Y2sgZm9yIGFuZCBwYXJzZSBMSVNURVhUIHNlbGVjdGlvbiBvcHRpb25zICovCj4gICAgIGMgPSBw
cm90X2dldGMoaW1hcGRfaW4pOwo+ICAgICBpZiAoYyA9PSAnKCcpIHsKPiAJbGlzdG9wdHMgfD0g
TElTVF9PUFRfRVhURU5ERUQ7Cj4gCWMgPSBnZXRsaXN0c2Vsb3B0cyh0YWcsICZsaXN0b3B0cyk7
Cj4gCWlmIChjID09IEVPRikgewo+IAkgICAgZWF0bGluZShpbWFwZF9pbiwgYyk7Cj4gCSAgICBy
ZXR1cm47Cj4gCX0KNTcwM2E1NzYxLDU3NjMKPiAgICAgZWxzZQo+IAlwcm90X3VuZ2V0YyhjLCBp
bWFwZF9pbik7Cj4gI2VuZGlmCjU3MDUsNTcwNmM1NzY1CjwgICAgIC8qIFJlc2V0IHN0YXRlIGlu
IG1zdHJpbmdkYXRhICovCjwgICAgIG1zdHJpbmdkYXRhKE5VTEwsIE5VTEwsIDAsIDAsIDApOwot
LS0KPiAgICAgaWYgKGltYXBkX21hZ2ljcGx1cykgbGlzdG9wdHMgfD0gTElTVF9TRUxfU1VCU0NS
SUJFRCB8IExJU1RfUkVUX1NVQlNDUklCRUQ7CjU3MDgsNTcyNGM1NzY3LDU3OTMKPCAgICAgaWYg
KCFwYXR0ZXJuWzBdICYmICEobGlzdG9wdHMgJiBMSVNUX0xTVUIpKSB7CjwgCS8qIFNwZWNpYWwg
Y2FzZTogcXVlcnkgdG9wLWxldmVsIGhpZXJhcmNoeSBzZXBhcmF0b3IgKi8KPCAJcHJvdF9wcmlu
dGYoaW1hcGRfb3V0LCAiKiBMSVNUIChcXE5vc2VsZWN0KSBcIiVjXCIgXCJcIlxyXG4iLAo8IAkJ
ICAgIGltYXBkX25hbWVzcGFjZS5oaWVyX3NlcCk7CjwgICAgIH0gZWxzZSBpZiAoKGxpc3RvcHRz
ICYgKExJU1RfTFNVQiB8IExJU1RfU1VCU0NSSUJFRCkpICYmCjwgCSAgICAgICAoYmFja2VuZF9p
bmJveCB8fCAoYmFja2VuZF9pbmJveCA9IHByb3h5X2ZpbmRpbmJveHNlcnZlcigpKSkpIHsKPCAJ
LyogcmVtb3RlIElOQk9YICovCjwgCWlmICgobGlzdG9wdHMgJiBMSVNUX1NVQlNDUklCRUQpICYm
IChsaXN0b3B0cyAmIExJU1RfRVhUKSAmJgo8IAkgICAgQ0FQQShiYWNrZW5kX2luYm94LCBDQVBB
X0xJU1RTVUJTQ1JJQkVEKSkgewo8IAkgICAgcHJvdF9wcmludGYoYmFja2VuZF9pbmJveC0+b3V0
LCAiJXMgTGlzdCAoc3Vic2NyaWJlZCIsIHRhZyk7CjwgCSAgICBpZiAobGlzdG9wdHMgJiBMSVNU
X0NISUxEUkVOKQo8IAkJcHJvdF9wcmludGYoYmFja2VuZF9pbmJveC0+b3V0LCAiIGNoaWxkcmVu
Iik7CjwgCSAgICBpZiAobGlzdG9wdHMgJiBMSVNUX1JFTU9URSkKPCAJCXByb3RfcHJpbnRmKGJh
Y2tlbmRfaW5ib3gtPm91dCwgIiByZW1vdGUiKTsKPCAJICAgIHByb3RfcHJpbnRmKGJhY2tlbmRf
aW5ib3gtPm91dCwgIikgIik7CjwgCX0gZWxzZSB7CjwgCSAgICBwcm90X3ByaW50ZihiYWNrZW5k
X2luYm94LT5vdXQsICIlcyBMc3ViICIsIHRhZyk7Ci0tLQo+ICAgICAvKiBSZWFkIGluIHJlZmVy
ZW5jZSBuYW1lICovCj4gICAgIGMgPSBnZXRhc3RyaW5nKGltYXBkX2luLCBpbWFwZF9vdXQsICZi
dWYpOwo+ICAgICBpZiAoYyA9PSBFT0YgJiYgISpidWYucykgewo+IAlwcm90X3ByaW50ZihpbWFw
ZF9vdXQsCj4gCQkgICAgIiVzIEJBRCBNaXNzaW5nIHJlcXVpcmVkIGFyZ3VtZW50IHRvIExpc3Q6
IHJlZmVyZW5jZSBuYW1lXHJcbiIsCj4gCQkgICAgdGFnKTsKPiAJZWF0bGluZShpbWFwZF9pbiwg
Yyk7Cj4gCXJldHVybjsKPiAgICAgfQo+ICAgICBpZiAoYyAhPSAnICcpIHsKPiAJcHJvdF9wcmlu
dGYoaW1hcGRfb3V0LAo+IAkJICAgICIlcyBCQUQgTWlzc2luZyByZXF1aXJlZCBhcmd1bWVudCB0
byBMaXN0OiBtYWlsYm94IHBhdHRlcm5cclxuIiwgdGFnKTsKPiAJZWF0bGluZShpbWFwZF9pbiwg
Yyk7Cj4gCXJldHVybjsKPiAgICAgfQo+ICAgICByZWZlcmVuY2UgPSB4c3RyZHVwKGJ1Zi5zKTsK
PiAKPiAgICAgLyogUmVhZCBpbiBtYWlsYm94IHBhdHRlcm4ocykgKi8KPiAjaWZkZWYgRU5BQkxF
X0xJU1RfRVhURU5ERUQKPiAgICAgYyA9IHByb3RfZ2V0YyhpbWFwZF9pbik7Cj4gICAgIGlmIChj
ID09ICcoJykgewo+IAlsaXN0b3B0cyB8PSBMSVNUX09QVF9FWFRFTkRFRCB8IExJU1RfT1BUX0VY
VEVOREVEX1YxNzsKPiAJZm9yICg7Oykgewo+IAkgICAgYyA9IGdldGFzdHJpbmcoaW1hcGRfaW4s
IGltYXBkX291dCwgJmJ1Zik7Cj4gCSAgICBpZiAoKmJ1Zi5zKQo+IAkJYXBwZW5kc3RybGlzdCgm
cGF0dGVybnMsIGJ1Zi5zKTsKPiAJICAgIGlmIChjICE9ICcgJykgYnJlYWs7CjU3MjYsNTc0NGM1
Nzk1LDU4MTcKPCAJcHJvdF9wcmludGYoYmFja2VuZF9pbmJveC0+b3V0LCAKPCAJCSAgICAieyVk
K31cclxuJXMgeyVkK31cclxuJXNcclxuIiwKPCAJCSAgICBzdHJsZW4ocmVmZXJlbmNlKSwgcmVm
ZXJlbmNlLAo8IAkJICAgIHN0cmxlbihwYXR0ZXJuKSwgcGF0dGVybik7CjwgCXBpcGVfbHN1Yihi
YWNrZW5kX2luYm94LCB0YWcsIDAsIChsaXN0b3B0cyAmIExJU1RfTFNVQikgPyAiTFNVQiIgOiAi
TElTVCIpOwo8ICAgICB9IGVsc2Ugewo8IAkvKiBEbyB3ZSBuZWVkIHRvIGNvbmNhdGVuYXRlIGZp
ZWxkcz8gKi8KPCAJaWYgKCFpZ25vcmVyZWZlcmVuY2UgfHwgcGF0dGVyblswXSA9PSBpbWFwZF9u
YW1lc3BhY2UuaGllcl9zZXApIHsKPCAJICAgIC8qIEVpdGhlcgo8IAkgICAgICogLSBuYW1lIGJl
Z2lucyB3aXRoIGRvdAo8IAkgICAgICogLSB3ZSdyZSBjb25maWd1cmVkIHRvIGhvbm9yIHRoZSBy
ZWZlcmVuY2UgYXJndW1lbnQgKi8KPCAKPCAJICAgIC8qIEFsbG9jYXRlIGEgYnVmZmVyLCBmaWd1
cmUgb3V0IGhvdyB0byBzdGljayB0aGUgYXJndW1lbnRzCjwgCSAgICAgICB0b2dldGhlciwgZG8g
aXQsIHRoZW4gZG8gdGhhdCBpbnN0ZWFkIG9mIHVzaW5nIHBhdHRlcm4uICovCjwgCSAgICBwYXRs
ZW4gPSBzdHJsZW4ocGF0dGVybik7CjwgCSAgICByZWZsZW4gPSBzdHJsZW4ocmVmZXJlbmNlKTsK
PCAJICAgIAo8IAkgICAgYnVmID0geG1hbGxvYyhwYXRsZW4gKyByZWZsZW4gKyAxKTsKPCAJICAg
IGJ1ZlswXSA9ICdcMCc7Ci0tLQo+IAlpZiAoYyAhPSAnKScpIHsKPiAJICAgIHByb3RfcHJpbnRm
KGltYXBkX291dCwKPiAJCQkiJXMgQkFEIEludmFsaWQgc3ludGF4IGluIExpc3QgY29tbWFuZFxy
XG4iLCB0YWcpOwo+IAkgICAgZWF0bGluZShpbWFwZF9pbiwgYyk7Cj4gCSAgICBnb3RvIGZyZWVh
cmdzOwo+IAl9Cj4gCWMgPSBwcm90X2dldGMoaW1hcGRfaW4pOwo+ICAgICB9Cj4gICAgIGVsc2Ug
ewo+IAlwcm90X3VuZ2V0YyhjLCBpbWFwZF9pbik7Cj4gI2VuZGlmCj4gICAgIAljID0gZ2V0YXN0
cmluZyhpbWFwZF9pbiwgaW1hcGRfb3V0LCAmYnVmKTsKPiAJaWYgKGMgPT0gRU9GKSB7Cj4gCSAg
ICBwcm90X3ByaW50ZihpbWFwZF9vdXQsCj4gCQkJIiVzIEJBRCBNaXNzaW5nIHJlcXVpcmVkIGFy
Z3VtZW50IHRvIExpc3Q6IG1haWxib3ggcGF0dGVyblxyXG4iLAo+IAkJCXRhZyk7Cj4gCSAgICBl
YXRsaW5lKGltYXBkX2luLCBjKTsKPiAJICAgIGdvdG8gZnJlZWFyZ3M7Cj4gCX0KPiAJYXBwZW5k
c3RybGlzdCgmcGF0dGVybnMsIGJ1Zi5zKTsKPiAjaWZkZWYgRU5BQkxFX0xJU1RfRVhURU5ERUQK
PiAgICAgfQo+ICNlbmRpZgo1NzQ2LDU3NTVjNTgxOSw1ODI2CjwgCSAgICBpZiAoKnJlZmVyZW5j
ZSkgewo8IAkJLyogY2hlY2sgZm9yIExJU1QgQS4gLkIsIGNoYW5nZSB0byBMSVNUICIiIEEuQiAq
Lwo8IAkJaWYgKHJlZmVyZW5jZVtyZWZsZW4tMV0gPT0gaW1hcGRfbmFtZXNwYWNlLmhpZXJfc2Vw
ICYmCjwgCQkgICAgcGF0dGVyblswXSA9PSBpbWFwZF9uYW1lc3BhY2UuaGllcl9zZXApIHsKPCAJ
CSAgICByZWZlcmVuY2VbLS1yZWZsZW5dID0gJ1wwJzsKPCAJCX0KPCAJCXN0cmNweShidWYsIHJl
ZmVyZW5jZSk7CjwgCSAgICB9CjwgCSAgICBzdHJjYXQoYnVmLCBwYXR0ZXJuKTsKPCAJICAgIHBh
dHRlcm4gPSBidWY7Ci0tLQo+ICNpZmRlZiBFTkFCTEVfTElTVF9FWFRFTkRFRAo+ICAgICAvKiBD
aGVjayBmb3IgYW5kIHBhcnNlIExJU1RFWFQgcmV0dXJuIG9wdGlvbnMgKi8KPiAgICAgaWYgKGMg
PT0gJyAnKSB7Cj4gCWxpc3RvcHRzIHw9IExJU1RfT1BUX0VYVEVOREVEIHwgTElTVF9PUFRfRVhU
RU5ERURfVjE3Owo+IAljID0gZ2V0bGlzdHJldG9wdHModGFnLCAmbGlzdG9wdHMpOwo+IAlpZiAo
YyA9PSBFT0YpIHsKPiAJICAgIGVhdGxpbmUoaW1hcGRfaW4sIGMpOwo+IAkgICAgZ290byBmcmVl
YXJnczsKNTc1NmE1ODI4LDU4MjkKPiAgICAgfQo+ICNlbmRpZgo1NzU4LDU3NjFjNTgzMSw1ODM4
CjwgCS8qIFRyYW5zbGF0ZSBhbnkgc2VwYXJhdG9ycyBpbiBwYXR0ZXJuICovCjwgCW1ib3huYW1l
X2hpZXJzZXBfdG9pbnRlcm5hbCgmaW1hcGRfbmFtZXNwYWNlLCBwYXR0ZXJuLAo8IAkJCQkgICAg
Y29uZmlnX3ZpcnRkb21haW5zID8KPCAJCQkJICAgIHN0cmNzcG4ocGF0dGVybiwgIkAiKSA6IDAp
OwotLS0KPiAgICAgLyogY2hlY2sgZm9yIENSTEYgKi8KPiAgICAgaWYgKGMgPT0gJ1xyJykgYyA9
IHByb3RfZ2V0YyhpbWFwZF9pbik7Cj4gICAgIGlmIChjICE9ICdcbicpIHsKPiAJcHJvdF9wcmlu
dGYoaW1hcGRfb3V0LAo+IAkJICAgICIlcyBCQUQgVW5leHBlY3RlZCBleHRyYSBhcmd1bWVudHMg
dG8gTGlzdFxyXG4iLCB0YWcpOwo+IAllYXRsaW5lKGltYXBkX2luLCBjKTsKPiAJZ290byBmcmVl
YXJnczsKPiAgICAgfQo1NzYzLDU3NzVjNTg0MCw1ODQ1CjwgCS8qIENoZWNrIHRvIHNlZSBpZiB3
ZSBzaG91bGQgb25seSBsaXN0IHRoZSBwZXJzb25hbCBuYW1lc3BhY2UgKi8KPCAJaWYgKCFzdHJj
bXAocGF0dGVybiwgIioiKQo8IAkgICAgJiYgY29uZmlnX2dldHN3aXRjaChJTUFQT1BUX0ZPT0xT
VFVQSURDTElFTlRTKSkgewo8IAkgICAgaWYgKGJ1ZikgZnJlZShidWYpOwo8IAkgICAgYnVmID0g
eHN0cmR1cCgiSU5CT1gqIik7CjwgCSAgICBwYXR0ZXJuID0gYnVmOwo8IAkgICAgZmluZHN1YiA9
IG1ib3hsaXN0X2ZpbmRzdWI7CjwgCSAgICBmaW5kYWxsID0gbWJveGxpc3RfZmluZGFsbDsKPCAJ
fQo8IAllbHNlIHsKPCAJICAgIGZpbmRzdWIgPSBpbWFwZF9uYW1lc3BhY2UubWJveGxpc3RfZmlu
ZHN1YjsKPCAJICAgIGZpbmRhbGwgPSBpbWFwZF9uYW1lc3BhY2UubWJveGxpc3RfZmluZGFsbDsK
PCAJfQotLS0KPiAgICAgaWYgKGxpc3RvcHRzICYgTElTVF9PUFRfRVhURU5ERURfVjAzICYmIGxp
c3RvcHRzICYgTElTVF9PUFRfRVhURU5ERURfVjE3KSB7Cj4gCS8qIGNsaWVudCBtaXhlZCBkaWZm
ZXJlbnQgbGlzdGV4dCB2ZXJzaW9ucyAqLwo+IAlwcm90X3ByaW50ZihpbWFwZF9vdXQsCj4gCQkg
ICAgIiVzIEJBRCBJbnZhbGlkIHN5bnRheCBpbiBleHRlbmRlZCBMaXN0IGNvbW1hbmRcclxuIiwg
dGFnKTsKPiAJZ290byBmcmVlYXJnczsKPiAgICAgfQo1Nzc3LDU3NzhjNTg0Nwo8IAlpZiAobGlz
dG9wdHMgJiAoTElTVF9MU1VCIHwgTElTVF9TVUJTQ1JJQkVEKSkgewo8IAkgICAgaW50IGZvcmNl
ID0gY29uZmlnX2dldHN3aXRjaChJTUFQT1BUX0FMTE9XQUxMU1VCU0NSSUJFKTsKLS0tCj4gICAg
IGRvX2xpc3QodGFnLCBsaXN0b3B0cywgcmVmZXJlbmNlLCBwYXR0ZXJucyk7CjU3ODAsNTc4OGM1
ODQ5LDU4NTMKPCAJICAgICgqZmluZHN1YikoJmltYXBkX25hbWVzcGFjZSwgcGF0dGVybiwKPCAJ
CSAgICAgICBpbWFwZF91c2VyaXNhZG1pbiwgaW1hcGRfdXNlcmlkLCBpbWFwZF9hdXRoc3RhdGUs
CjwgCQkgICAgICAgbGlzdGRhdGEsICZsaXN0b3B0cywgZm9yY2UpOwo8IAl9CjwgCWVsc2Ugewo8
IAkgICAgKCpmaW5kYWxsKSgmaW1hcGRfbmFtZXNwYWNlLCBwYXR0ZXJuLAo8IAkJICAgICAgIGlt
YXBkX3VzZXJpc2FkbWluLCBpbWFwZF91c2VyaWQsIGltYXBkX2F1dGhzdGF0ZSwKPCAJCSAgICAg
ICBsaXN0ZGF0YSwgJmxpc3RvcHRzKTsKPCAJfQotLS0KPiAgIGZyZWVhcmdzOgo+ICAgICBmcmVl
c3RybGlzdChwYXR0ZXJucyk7Cj4gICAgIGZyZWUocmVmZXJlbmNlKTsKPiAgICAgcmV0dXJuOwo+
IH0KNTc5MGM1ODU1LDU4NzUKPCAJbGlzdGRhdGEoKGNoYXIgKikwLCAwLCAwLCAmbGlzdG9wdHMp
OwotLS0KPiAvKiBBIHdyYXBwZXIgZm9yIGRvX2xpc3QuICovCj4gdm9pZCBjbWRfbGlzdChjaGFy
ICp0YWcsIGludCBsaXN0b3B0cywgY2hhciAqcmVmZXJlbmNlLCBjaGFyICpwYXR0ZXJuKQo+IHsK
PiAgICAgY2hhciAqbmV3X3BhdHRlcm4gPSB4c3RyZHVwKHBhdHRlcm4pOwo+ICAgICBzdHJ1Y3Qg
c3RybGlzdCBzdHJsaXN0ID0geyBuZXdfcGF0dGVybiwgTlVMTCwgTlVMTCwgTlVMTCB9Owo+ICAg
ICBkb19saXN0KHRhZywgbGlzdG9wdHMsIHJlZmVyZW5jZSwgJnN0cmxpc3QpOwo+ICAgICBmcmVl
KHN0cmxpc3Qucyk7Cj4gfQo+IAo+IC8qCj4gICogUGVyZm9ybSBhIExJU1QsIExTVUIsIFJMSVNU
IG9yIFJMU1VCIGNvbW1hbmQKPiAgKi8KPiB2b2lkIGRvX2xpc3QoY2hhciAqdGFnLCBpbnQgbGlz
dG9wdHMsIGNoYXIgKnJlZmVyZW5jZSwKPiAJICAgICBzdHJ1Y3Qgc3RybGlzdCAqcGF0dGVybnMp
Cj4gewo+ICAgICBjbG9ja190IHN0YXJ0ID0gY2xvY2soKTsKPiAgICAgY2hhciBteXRpbWVbMTAw
XTsKPiAKPiAgICAgaWYgKGxpc3RvcHRzICYgTElTVF9TRUxfUkVNT1RFKSBzdXBwb3J0c19yZWZl
cnJhbHMgPSAhZGlzYWJsZV9yZWZlcnJhbHM7Cj4gCj4gICAgIGxpc3RfY2FsbGJhY2tfY2FsbHMg
PSAwOwo1NzkyYzU4NzcsNTg4OQo8IAlpZiAoYnVmKSBmcmVlKGJ1Zik7Ci0tLQo+ICAgICBpZiAo
IShsaXN0b3B0cyAmIExJU1RfT1BUX0xTVUIpCj4gCSAgICAmJiAhKGxpc3RvcHRzICYgTElTVF9P
UFRfRVhURU5ERUQpCj4gCSAgICAmJiAhKnBhdHRlcm5zLT5zKSB7Cj4gCS8qIHNwZWNpYWwgY2Fz
ZTogcXVlcnkgdG9wLWxldmVsIGhpZXJhcmNoeSBzZXBhcmF0b3IgKi8KPiAJcHJvdF9wcmludGYo
aW1hcGRfb3V0LCAiKiAlc0xJU1QgKFxcTm9zZWxlY3QpIFwiJWNcIiBcIlwiXHJcbiIsCj4gCQkg
ICAgKGxpc3RvcHRzICYgTElTVF9PUFRfUkxJU1QpID8gIlIiIDogIiIsCj4gCQkgICAgaW1hcGRf
bmFtZXNwYWNlLmhpZXJfc2VwKTsKPiAgICAgfSBlbHNlIGlmIChsaXN0b3B0cyAmIChMSVNUX1NF
TF9TVUJTQ1JJQkVEIHwgTElTVF9SRVRfU1VCU0NSSUJFRCkKPiAJICAgICYmIChiYWNrZW5kX2lu
Ym94IHx8IChiYWNrZW5kX2luYm94ID0gcHJveHlfZmluZGluYm94c2VydmVyKCkpKSkgewo+IAkv
KiByZW1vdGUgaW5ib3ggKi8KPiAJbGlzdF9kYXRhX3JlbW90ZSh0YWcsIGxpc3RvcHRzLCByZWZl
cmVuY2UsIHBhdHRlcm5zKTsKPiAgICAgfSBlbHNlIHsKPiAJbGlzdF9kYXRhKHJlZmVyZW5jZSwg
bGlzdG9wdHMsIHBhdHRlcm5zKTsKNTc5NSw1Nzk2YzU4OTIsNTg5Mwo8ICAgICBpbWFwZF9jaGVj
ayghKGxpc3RvcHRzICYgKExJU1RfTFNVQiB8IExJU1RfU1VCU0NSSUJFRCkpID8KPCAJCWJhY2tl
bmRfaW5ib3ggOiBOVUxMLCAwLCAwKTsKLS0tCj4gICAgIGltYXBkX2NoZWNrKChsaXN0b3B0cyAm
IExJU1RfU0VMX1NVQlNDUklCRUQpID8gIE5VTEwgOiBiYWNrZW5kX2luYm94LAo+IAkJMCwgMCk7
CjU4MDAsNTgwMWM1ODk3LDU5MDEKPCAgICAgcHJvdF9wcmludGYoaW1hcGRfb3V0LCAiJXMgT0sg
JXMgKCVzIHNlY3MgJWQgY2FsbHMpXHJcbiIsIHRhZywKPCAJCWVycm9yX21lc3NhZ2UoSU1BUF9P
S19DT01QTEVURUQpLCBteXRpbWUsIG1zdHJpbmdkYXRhY2FsbHMpOwotLS0KPiAgICAgcHJvdF9w
cmludGYoaW1hcGRfb3V0LCAiJXMgT0sgJXMgKCVzIHNlY3MiLCB0YWcsCj4gCQllcnJvcl9tZXNz
YWdlKElNQVBfT0tfQ09NUExFVEVEKSwgbXl0aW1lKTsKPiAgICAgaWYgKGxpc3RfY2FsbGJhY2tf
Y2FsbHMpCj4gCXByb3RfcHJpbnRmKGltYXBkX291dCwgIiAldSBjYWxscyIsIGxpc3RfY2FsbGJh
Y2tfY2FsbHMpOwo+ICAgICBwcm90X3ByaW50ZihpbWFwZF9vdXQsICIpXHJcbiIpOwo1ODAzYzU5
MDMKPCAgIAotLS0KPiAKODcwOWM4ODA5CjwgI2lmZGVmIEVOQUJMRV9MSVNURVhUCi0tLQo+ICNp
ZmRlZiBFTkFCTEVfTElTVF9FWFRFTkRFRAo4NzExYzg4MTEKPCAgKiBQYXJzZSBMSVNUIG9wdGlv
bnMuCi0tLQo+ICAqIFBhcnNlIExJU1Qgc2VsZWN0aW9uIG9wdGlvbnMuCjg3MTRjODgxNAo8IGlu
dCBnZXRsaXN0b3B0cyhjaGFyICp0YWcsIGludCAqbGlzdG9wdHMpCi0tLQo+IGludCBnZXRsaXN0
c2Vsb3B0cyhjaGFyICp0YWcsIGludCAqb3B0cykKODcxN2M4ODE3CjwgICAgIHN0YXRpYyBzdHJ1
Y3QgYnVmIGFyZzsKLS0tCj4gICAgIHN0YXRpYyBzdHJ1Y3QgYnVmIGJ1ZjsKODcxOWM4ODE5LDg4
MjIKPCAgICAgKmxpc3RvcHRzID0gTElTVF9FWFQ7Ci0tLQo+ICAgICBpZiAoIChjID0gcHJvdF9n
ZXRjKGltYXBkX2luKSkgPT0gJyknKQo+IAlyZXR1cm4gcHJvdF9nZXRjKGltYXBkX2luKTsKPiAg
ICAgZWxzZQo+IAlwcm90X3VuZ2V0YyhjLCBpbWFwZF9pbik7Cjg3MjIsODcyM2M4ODI1CjwgCWMg
PSBnZXR3b3JkKGltYXBkX2luLCAmYXJnKTsKPCAJaWYgKCFhcmcuc1swXSkgYnJlYWs7Ci0tLQo+
IAljID0gZ2V0d29yZChpbWFwZF9pbiwgJmJ1Zik7Cjg3MjUsODcyN2M4ODI3LDg4MzEKPCAJbGNh
c2UoYXJnLnMpOwo8IAlpZiAoIXN0cmNtcChhcmcucywgInN1YnNjcmliZWQiKSkgewo8IAkgICAg
Kmxpc3RvcHRzIHw9IExJU1RfU1VCU0NSSUJFRDsKLS0tCj4gCWlmICghKmJ1Zi5zKSB7Cj4gCSAg
ICBwcm90X3ByaW50ZihpbWFwZF9vdXQsCj4gCQkJIiVzIEJBRCBJbnZhbGlkIHN5bnRheCBpbiBM
aXN0IGNvbW1hbmRcclxuIiwKPiAJCQl0YWcpOwo+IAkgICAgcmV0dXJuIEVPRjsKODcyOSw4NzMw
Yzg4MzMsODg0OAo8IAllbHNlIGlmICghc3RyY21wKGFyZy5zLCAiY2hpbGRyZW4iKSkgewo8IAkg
ICAgKmxpc3RvcHRzIHw9IExJU1RfQ0hJTERSRU47Ci0tLQo+IAo+IAlsY2FzZShidWYucyk7Cj4g
Cj4gCWlmICghc3RyY21wKGJ1Zi5zLCAic3Vic2NyaWJlZCIpKSB7Cj4gCSAgICAqb3B0cyB8PSBM
SVNUX1NFTF9TVUJTQ1JJQkVEIHwgTElTVF9SRVRfU1VCU0NSSUJFRDsKPiAJfSBlbHNlIGlmICgh
c3RyY21wKGJ1Zi5zLCAicmVtb3RlIikpIHsKPiAJICAgICpvcHRzIHw9IExJU1RfU0VMX1JFTU9U
RTsKPiAJfSBlbHNlIGlmICghc3RyY21wKGJ1Zi5zLCAicmVjdXJzaXZlbWF0Y2giKSkgewo+IAkg
ICAgKm9wdHMgfD0gTElTVF9TRUxfUkVDVVJTSVZFTUFUQ0ggfCBMSVNUX09QVF9FWFRFTkRFRF9W
MTc7Cj4gCX0gZWxzZSBpZiAoIXN0cmNtcChidWYucywgImNoaWxkcmVuIikpIHsKPiAJICAgICpv
cHRzIHw9IExJU1RfUkVUX0NISUxEUkVOIHwgTElTVF9PUFRfRVhURU5ERURfVjAzOwo+IAl9IGVs
c2Ugewo+IAkgICAgcHJvdF9wcmludGYoaW1hcGRfb3V0LAo+IAkJCSIlcyBCQUQgSW52YWxpZCBM
aXN0IHNlbGVjdGlvbiBvcHRpb24gXCIlc1wiXHJcbiIsCj4gCQkJdGFnLCBidWYucyk7Cj4gCSAg
ICByZXR1cm4gRU9GOwo4NzMyLDg3MzNjODg1MCw4OTEwCjwgCWVsc2UgaWYgKCFzdHJjbXAoYXJn
LnMsICJyZW1vdGUiKSkgewo8IAkgICAgKmxpc3RvcHRzIHw9IExJU1RfUkVNT1RFOwotLS0KPiAK
PiAJaWYgKGMgIT0gJyAnKSBicmVhazsKPiAgICAgfQo+IAo+ICAgICBpZiAoYyAhPSAnKScpIHsK
PiAJcHJvdF9wcmludGYoaW1hcGRfb3V0LAo+IAkJICAgICIlcyBCQUQgTWlzc2luZyBjbG9zZSBw
YXJlbnRoZXNpcyBmb3IgTGlzdCBzZWxlY3Rpb24gb3B0aW9uc1xyXG4iLCB0YWcpOwo+IAlyZXR1
cm4gRU9GOwo+ICAgICB9Cj4gCj4gICAgIGlmICgqb3B0cyAmIGxpc3Rfc2VsZWN0X21vZF9vcHRz
Cj4gCSAgICAmJiAhICgqb3B0cyAmIGxpc3Rfc2VsZWN0X2Jhc2Vfb3B0cykpIHsKPiAJcHJvdF9w
cmludGYoaW1hcGRfb3V0LAo+IAkJICAgICIlcyBCQUQgSW52YWxpZCBjb21iaW5hdGlvbiBvZiBz
ZWxlY3Rpb24gb3B0aW9uc1xyXG4iLAo+IAkJICAgIHRhZyk7Cj4gCXJldHVybiBFT0Y7Cj4gICAg
IH0KPiAKPiAgICAgcmV0dXJuIHByb3RfZ2V0YyhpbWFwZF9pbik7Cj4gfQo+IAo+IC8qCj4gICog
UGFyc2UgTElTVCByZXR1cm4gb3B0aW9ucy4KPiAgKiBUaGUgY29tbWFuZCBoYXMgYmVlbiBwYXJz
ZWQgdXAgdG8gYW5kIGluY2x1ZGluZyB0aGUgJyAnIGJlZm9yZSBSRVRVUk4uCj4gICovCj4gaW50
IGdldGxpc3RyZXRvcHRzKGNoYXIgKnRhZywgaW50ICpvcHRzKSB7Cj4gICAgIHN0YXRpYyBzdHJ1
Y3QgYnVmIGJ1ZjsKPiAgICAgaW50IGM7Cj4gCj4gICAgIGMgPSBnZXR3b3JkKGltYXBkX2luLCAm
YnVmKTsKPiAgICAgaWYgKCEqYnVmLnMpIHsKPiAJcHJvdF9wcmludGYoaW1hcGRfb3V0LAo+IAkJ
ICAgICIlcyBCQUQgSW52YWxpZCBzeW50YXggaW4gTGlzdCBjb21tYW5kXHJcbiIsIHRhZyk7Cj4g
CXJldHVybiBFT0Y7Cj4gICAgIH0KPiAgICAgbGNhc2UoYnVmLnMpOwo+ICAgICBpZiAoc3RyY2Fz
ZWNtcChidWYucywgInJldHVybiIpKSB7Cj4gCXByb3RfcHJpbnRmKGltYXBkX291dCwKPiAJCSAg
ICAiJXMgQkFEIFVuZXhwZWN0ZWQgZXh0cmEgYXJndW1lbnQgdG8gTGlzdDogXCIlc1wiXHJcbiIs
Cj4gCQkgICAgdGFnLCBidWYucyk7Cj4gCXJldHVybiBFT0Y7Cj4gICAgIH0KPiAKPiAgICAgaWYg
KGMgIT0gJyAnIHx8IChjID0gcHJvdF9nZXRjKGltYXBkX2luKSkgIT0gJygnKSB7Cj4gCXByb3Rf
cHJpbnRmKGltYXBkX291dCwKPiAJCSAgICAiJXMgQkFEIE1pc3NpbmcgcmV0dXJuIGFyZ3VtZW50
IGxpc3RcclxuIiwgdGFnKTsKPiAJcmV0dXJuIEVPRjsKPiAgICAgfQo+IAo+ICAgICBpZiAoIChj
ID0gcHJvdF9nZXRjKGltYXBkX2luKSkgPT0gJyknKQo+IAlyZXR1cm4gcHJvdF9nZXRjKGltYXBk
X2luKTsKPiAgICAgZWxzZQo+IAlwcm90X3VuZ2V0YyhjLCBpbWFwZF9pbik7Cj4gCj4gICAgIGZv
ciAoOzspIHsKPiAJYyA9IGdldHdvcmQoaW1hcGRfaW4sICZidWYpOwo+IAo+IAlpZiAoISpidWYu
cykgewo+IAkgICAgcHJvdF9wcmludGYoaW1hcGRfb3V0LAo+IAkJCSIlcyBCQUQgSW52YWxpZCBz
eW50YXggaW4gTGlzdCBjb21tYW5kXHJcbiIsIHRhZyk7Cj4gCSAgICByZXR1cm4gRU9GOwo4NzM0
YTg5MTIsODkxOAo+IAo+IAlsY2FzZShidWYucyk7Cj4gCj4gCWlmICghc3RyY21wKGJ1Zi5zLCAi
c3Vic2NyaWJlZCIpKQo+IAkgICAgKm9wdHMgfD0gTElTVF9SRVRfU1VCU0NSSUJFRDsKPiAJZWxz
ZSBpZiAoIXN0cmNtcChidWYucywgImNoaWxkcmVuIikpCj4gCSAgICAqb3B0cyB8PSBMSVNUX1JF
VF9DSElMRFJFTjsKODczNiw4NzM3Yzg5MjAsODkyMgo8IAkgICAgcHJvdF9wcmludGYoaW1hcGRf
b3V0LCAiJXMgQkFEIEludmFsaWQgTGlzdCBvcHRpb24gJXNcclxuIiwKPCAJCQl0YWcsIGFyZy5z
KTsKLS0tCj4gCSAgICBwcm90X3ByaW50ZihpbWFwZF9vdXQsCj4gCQkJIiVzIEJBRCBJbnZhbGlk
IExpc3QgcmV0dXJuIG9wdGlvbiBcIiVzXCJcclxuIiwKPiAJCQl0YWcsIGJ1Zi5zKTsKODc0NmM4
OTMxCjwgCQkgICAgIiVzIEJBRCBNaXNzaW5nIGNsb3NlIHBhcmVudGhlc2lzIGluIExpc3Rcclxu
IiwgdGFnKTsKLS0tCj4gCQkgICAgIiVzIEJBRCBNaXNzaW5nIGNsb3NlIHBhcmVudGhlc2lzIGZv
ciBMaXN0IHJldHVybiBvcHRpb25zXHJcbiIsIHRhZyk7Cjg3NTAsODc1MmM4OTM1CjwgICAgIGMg
PSBwcm90X2dldGMoaW1hcGRfaW4pOwo8IAo8ICAgICByZXR1cm4gYzsKLS0tCj4gICAgIHJldHVy
biBwcm90X2dldGMoaW1hcGRfaW4pOwo4NzU0Yzg5MzcKPCAjZW5kaWYgLyogRU5BQkxFX0xJU1RF
WFQgKi8KLS0tCj4gI2VuZGlmIC8qIEVOQUJMRV9MSVNUX0VYVEVOREVEICovCjkxMzgsOTE0MmM5
MzIxLDkzMzMKPCAvKgo8ICAqIElzc3VlIGEgTElTVCBvciBMU1VCIHVudGFnZ2VkIHJlc3BvbnNl
CjwgICovCjwgc3RhdGljIHZvaWQgbXN0cmluZ2RhdGEoY2hhciAqY21kLCBjaGFyICpuYW1lLCBp
bnQgbWF0Y2hsZW4sIGludCBtYXljcmVhdGUsCjwgCQkJaW50IGxpc3RvcHRzKQotLS0KPiBzdGF0
aWMgaW50IHNldF9oYXNjaGlsZHJlbihjaGFyICpuYW1lLCBpbnQgbWF0Y2hsZW4sIGludCBtYXlj
cmVhdGUsCj4gCQkJICAgaW50ICphdHRyaWJ1dGVzKQo+IHsKPiAgICAgbGlzdF9jYWxsYmFja19j
YWxscysrOwo+ICAgICBpZiAobmFtZVttYXRjaGxlbl0pIHsKPiAJKmF0dHJpYnV0ZXMgfD0gTUJP
WF9BVFRSSUJVVEVfSEFTQ0hJTERSRU47Cj4gCXJldHVybiAxOwo+ICAgICB9Cj4gICAgIHJldHVy
biAwOwo+IH0KPiAKPiAvKiBQcmludCBMSVNUIG9yIExTVUIgdW50YWdnZWQgcmVzcG9uc2UgKi8K
PiBzdGF0aWMgdm9pZCBsaXN0X3Jlc3BvbnNlKGNoYXIgKm5hbWUsIGludCBhdHRyaWJ1dGVzLCBp
bnQgb3B0cykKOTE0NCw5MTUwYzkzMzUsOTMzNwo8ICAgICBzdGF0aWMgY2hhciBsYXN0bmFtZVtN
QVhfTUFJTEJPWF9QQVRIKzFdOwo8ICAgICBzdGF0aWMgaW50IGxhc3RuYW1lZGVsYXllZCA9IDA7
CjwgICAgIHN0YXRpYyBpbnQgbGFzdG5hbWVub2luZmVyaW9ycyA9IDA7CjwgICAgIHN0YXRpYyBp
bnQgbm9uZXhpc3RlbnQgPSAwOwo8ICAgICBzdGF0aWMgaW50IHNhd3VzZXIgPSAwOwo8ICAgICBp
bnQgbGFzdG5hbWVoYXNzdWIgPSAwOwo8ICAgICBpbnQgYywgbWJ0eXBlOwotLS0KPiAgICAgc3Ry
dWN0IG1ib3hfbmFtZV9hdHRyaWJ1dGUgKmF0dHI7Cj4gICAgIGNoYXIgaW50ZXJuYWxfbmFtZVtN
QVhfTUFJTEJPWF9QQVRIKzFdOwo+ICAgICBpbnQgciwgbWJ0eXBlLCBmaXJzdCA9IDE7CjkxNTMs
OTE5NWM5MzQwLDkzNDgKPCAgICAgLyogV2UgaGF2ZSB0byByZXNldCB0aGUgc2F3dXNlciBmbGFn
IGJlZm9yZSBlYWNoIGxpc3QgY29tbWFuZC4KPCAgICAgICogSGFuZGxlIGl0IGFzIGEgZGlydHkg
aGFjay4KPCAgICAgICovCjwgICAgIGlmIChjbWQgPT0gTlVMTCkgewo8IAlzYXd1c2VyID0gMDsK
PCAJbXN0cmluZ2RhdGFjYWxscyA9IDA7CjwgCXJldHVybjsKPCAgICAgfQo8ICAgICBtc3RyaW5n
ZGF0YWNhbGxzKys7CjwgCjwgICAgIGlmIChsYXN0bmFtZWRlbGF5ZWQpIHsKPCAJLyogQ2hlY2sg
aWYgbGFzdG5hbWUgaGFzIGNoaWxkcmVuICovCjwgCWlmIChuYW1lICYmIHN0cm5jbXAobGFzdG5h
bWUsIG5hbWUsIHN0cmxlbihsYXN0bmFtZSkpID09IDAgJiYKPCAJICAgIG5hbWVbc3RybGVuKGxh
c3RuYW1lKV0gPT0gJy4nKSB7CjwgCSAgICBsYXN0bmFtZWhhc3N1YiA9IDE7CjwgCX0KPCAJcHJv
dF9wcmludGYoaW1hcGRfb3V0LCAiKiAlcyAoIiwgY21kKTsKPCAJaWYgKG5vbmV4aXN0ZW50ID09
IElNQVBfTUFJTEJPWF9SRVNFUlZFRCkgewo8IAkgICAgLyogTElTVEVYVCB3YW50cyBcXFBsYWNl
SG9sZGVyIGluc3RlYWQgb2YgXFxOb3NlbGVjdCAqLwo8IAkgICAgaWYgKGxpc3RvcHRzICYgTElT
VF9FWFQpCjwgCQlwcm90X3ByaW50ZihpbWFwZF9vdXQsICJcXFBsYWNlSG9sZGVyIik7CjwgCSAg
ICBlbHNlCjwgCQlwcm90X3ByaW50ZihpbWFwZF9vdXQsICJcXE5vc2VsZWN0Iik7CjwgCX0gZWxz
ZSBpZiAobm9uZXhpc3RlbnQpIHsKPCAJICAgIHByb3RfcHJpbnRmKGltYXBkX291dCwgIlxcTm9u
RXhpc3RlbnQiKTsKPCAJfQo8IAlpZiAobGFzdG5hbWVub2luZmVyaW9ycykgewo8IAkgICAgcHJv
dF9wcmludGYoaW1hcGRfb3V0LCAiJXNcXE5vaW5mZXJpb3JzIiwgbm9uZXhpc3RlbnQgPyAiICIg
OiAiIik7CjwgCX0KPCAJZWxzZSBpZiAoKGxpc3RvcHRzICYgTElTVF9DSElMRFJFTikgJiYKPCAJ
CSAvKiB3ZSBjYW4ndCBkZXRlcm1pbmUgXEhhc05vQ2hpbGRyZW4gZm9yIHN1YnNjcmlwdGlvbnMg
Ki8KPCAJCSAobGFzdG5hbWVoYXNzdWIgfHwKPCAJCSAgIShsaXN0b3B0cyAmIChMSVNUX0xTVUIg
fCBMSVNUX1NVQlNDUklCRUQpKSkpIHsKPCAJICAgIHByb3RfcHJpbnRmKGltYXBkX291dCwgIiVz
JXMiLCBub25leGlzdGVudCA/ICIgIiA6ICIiLAo8IAkJCWxhc3RuYW1laGFzc3ViID8gIlxcSGFz
Q2hpbGRyZW4iIDogIlxcSGFzTm9DaGlsZHJlbiIpOwo8IAl9CjwgCXByb3RfcHJpbnRmKGltYXBk
X291dCwgIikgXCIlY1wiICIsIGltYXBkX25hbWVzcGFjZS5oaWVyX3NlcCk7CjwgCQkgICAgCjwg
CSgqaW1hcGRfbmFtZXNwYWNlLm1ib3huYW1lX3RvZXh0ZXJuYWwpKCZpbWFwZF9uYW1lc3BhY2Us
IGxhc3RuYW1lLAo8IAkJCQkJICAgICAgIGltYXBkX3VzZXJpZCwgbWJveG5hbWUpOwo8IAlwcmlu
dHN0cmluZyhtYm94bmFtZSk7CjwgCXByb3RfcHJpbnRmKGltYXBkX291dCwgIlxyXG4iKTsKPCAJ
bGFzdG5hbWVkZWxheWVkID0gbGFzdG5hbWVub2luZmVyaW9ycyA9IG5vbmV4aXN0ZW50ID0gMDsK
LS0tCj4gICAgIGlmICghbmFtZSkKPiAJcmV0dXJuOwo+IAo+ICAgICAvKiBmaXJzdCBjb252ZXJ0
ICJJTkJPWCIgdG8gInVzZXIuPHVzZXJpZD4iICovCj4gICAgIGlmICghc3RybmNhc2VjbXAobmFt
ZSwgImluYm94IiwgNSkKPiAgICAgICAgICAgICAmJiAoIW5hbWVbNV0gfHwgbmFtZVs1XSA9PSAn
LicpICkgewo+IAkoKmltYXBkX25hbWVzcGFjZS5tYm94bmFtZV90b2ludGVybmFsKSgmaW1hcGRf
bmFtZXNwYWNlLCAiSU5CT1giLAo+IAkJCQkJICAgICAgIGltYXBkX3VzZXJpZCwgaW50ZXJuYWxf
bmFtZSk7Cj4gCXN0cmxjYXQoaW50ZXJuYWxfbmFtZSwgbmFtZSs1LCBzaXplb2YoaW50ZXJuYWxf
bmFtZSkpOwo5MTk2YTkzNTAsOTM1MQo+ICAgICBlbHNlCj4gCXN0cmxjcHkoaW50ZXJuYWxfbmFt
ZSwgbmFtZSwgc2l6ZW9mKGludGVybmFsX25hbWUpKTsKOTE5OCw5MjAxYzkzNTMsOTQwOQo8ICAg
ICAvKiBTcGVjaWFsLWNhc2UgdG8gZmx1c2ggYW55IGZpbmFsIHN0YXRlICovCjwgICAgIGlmICgh
bmFtZSkgewo8IAlsYXN0bmFtZVswXSA9ICdcMCc7CjwgCXJldHVybjsKLS0tCj4gICAgIC8qIGdl
dCBpbmZvIGFuZCBzZXQgZmxhZ3MgKi8KPiAgICAgciA9IG1ib3hsaXN0X2RldGFpbChpbnRlcm5h
bF9uYW1lLCAmbWJ0eXBlLCBOVUxMLCBOVUxMLCBOVUxMLCBOVUxMLCBOVUxMKTsKPiAKPiAgICAg
aWYgKHIgPT0gSU1BUF9NQUlMQk9YX05PTkVYSVNURU5UKQo+IAlhdHRyaWJ1dGVzIHw9IE1CT1hf
QVRUUklCVVRFX05PTkVYSVNURU5UIHwgTUJPWF9BVFRSSUJVVEVfTk9TRUxFQ1Q7Cj4gICAgIGlm
ICghciAmJiAobWJ0eXBlICYgTUJUWVBFX1JFU0VSVkUpKQo+IAlhdHRyaWJ1dGVzIHw9IE1CT1hf
QVRUUklCVVRFX05PU0VMRUNUOwo+IAo+ICAgICAvKiBmaWd1cmUgb3V0IFxIYXMoTm8pQ2hpbGRy
ZW4gaWYgbmVjZXNzYXJ5ICovCj4gICAgIGlmICggb3B0cyAmIExJU1RfUkVUX0NISUxEUkVOCj4g
CSAgICAmJiAhIChhdHRyaWJ1dGVzICYgTUJPWF9BVFRSSUJVVEVfSEFTQ0hJTERSRU4pCj4gCSAg
ICAmJiAhIChhdHRyaWJ1dGVzICYgTUJPWF9BVFRSSUJVVEVfSEFTTk9DSElMRFJFTikgKSB7Cj4g
CW1ib3hsaXN0X2ZpbmRhbGwoJmltYXBkX25hbWVzcGFjZSwgbmFtZSwKPiAJCQkgaW1hcGRfdXNl
cmlzYWRtaW4sIGltYXBkX3VzZXJpZCwgaW1hcGRfYXV0aHN0YXRlLAo+IAkJCSBzZXRfaGFzY2hp
bGRyZW4sICZhdHRyaWJ1dGVzKTsKPiAJaWYgKCAhIChhdHRyaWJ1dGVzICYgTUJPWF9BVFRSSUJV
VEVfSEFTQ0hJTERSRU4pICkKPiAJICAgIGF0dHJpYnV0ZXMgfD0gTUJPWF9BVFRSSUJVVEVfSEFT
Tk9DSElMRFJFTjsKPiAgICAgfQo+IAo+ICAgICBpZiAob3B0cyAmIExJU1RfT1BUX0xTVUIpIHsK
PiAJLyogXE5vc2VsZWN0IGhhcyBhIHNwZWNpYWwgc2Vjb25kIG1lYW5pbmcgd2l0aCAoUilMU1VC
ICovCj4gCWlmICggIShhdHRyaWJ1dGVzICYgTUJPWF9BVFRSSUJVVEVfU1VCU0NSSUJFRCkKPiAJ
CSYmIGF0dHJpYnV0ZXMgJiBNQk9YX0FUVFJJQlVURV9DSElMRElORk9fU1VCU0NSSUJFRCkKPiAJ
ICAgIGF0dHJpYnV0ZXMgfD0gTUJPWF9BVFRSSUJVVEVfTk9TRUxFQ1Q7Cj4gCWF0dHJpYnV0ZXMg
Jj0gfk1CT1hfQVRUUklCVVRFX1NVQlNDUklCRUQ7Cj4gICAgIH0KPiAKPiAgICAgLyogcmVtb3Zl
IHJlZHVuZGFudCBmbGFncyAqLwo+ICAgICBpZiAob3B0cyAmIExJU1RfT1BUX0VYVEVOREVEKSB7
Cj4gCWlmIChvcHRzICYgTUJPWF9BVFRSSUJVVEVfTk9JTkZFUklPUlMpCj4gCSAgICBvcHRzICY9
IH5NQk9YX0FUVFJJQlVURV9IQVNDSElMRFJFTjsKPiAJaWYgKG9wdHMgJiBNQk9YX0FUVFJJQlVU
RV9OT05FWElTVEVOVCkKPiAJICAgIG9wdHMgJj0gfk1CT1hfQVRUUklCVVRFX05PU0VMRUNUOwo+
ICAgICB9Cj4gCj4gICAgIHByb3RfcHJpbnRmKGltYXBkX291dCwgIiogJXMgKCIsCj4gCQkob3B0
cyAmIExJU1RfT1BUX0xTVUIpID8gIkxTVUIiIDogIkxJU1QiKTsKPiAgICAgZm9yIChhdHRyID0g
bWJveF9uYW1lX2F0dHJpYnV0ZXM7IGF0dHItPmlkOyBhdHRyKyspCj4gCWlmIChhdHRyaWJ1dGVz
ICYgYXR0ci0+ZmxhZykgewo+IAkgICAgaWYgKGZpcnN0KSBmaXJzdCA9IDA7Cj4gCSAgICBlbHNl
IHByb3RfcHV0YygnICcsIGltYXBkX291dCk7Cj4gCSAgICBwcm90X3ByaW50ZihpbWFwZF9vdXQs
IGF0dHItPmlkKTsKPiAJfQo+ICAgICBwcm90X3ByaW50ZihpbWFwZF9vdXQsICIpICIpOwo+IAo+
ICAgICBwcm90X3ByaW50ZihpbWFwZF9vdXQsICJcIiVjXCIgIiwgaW1hcGRfbmFtZXNwYWNlLmhp
ZXJfc2VwKTsKPiAgCj4gICAgICgqaW1hcGRfbmFtZXNwYWNlLm1ib3huYW1lX3RvZXh0ZXJuYWwp
KCZpbWFwZF9uYW1lc3BhY2UsIG5hbWUsCj4gICAgICAgICAgICAgaW1hcGRfdXNlcmlkLCBtYm94
bmFtZSk7Cj4gCj4gICAgIHByaW50YXN0cmluZyhtYm94bmFtZSk7Cj4gCj4gICAgIGlmIChvcHRz
ICYgTElTVF9PUFRfRVhURU5ERUQgJiYgYXR0cmlidXRlcyAmIGxpc3RfY2hpbGRpbmZvKSB7Cj4g
CXByb3RfcHJpbnRmKGltYXBkX291dCwgIiAoQ0hJTERJTkZPICgiKTsKPiAJaWYgKGF0dHJpYnV0
ZXMgJiBNQk9YX0FUVFJJQlVURV9DSElMRElORk9fU1VCU0NSSUJFRCkKPiAJICAgIHByb3RfcHJp
bnRmKGltYXBkX291dCwgIlNVQlNDUklCRUQiKTsKPiAJcHJvdF9wcmludGYoaW1hcGRfb3V0LCAi
KSkiKTsKOTIwNCw5MjA4Yzk0MTIsOTQ2OQo8ICAgICAvKiBTdXBwcmVzcyBhbnkgb3V0cHV0IG9m
IGEgcGFydGlhbCBtYXRjaCAqLwo8ICAgICBpZiAoKG5hbWVbbWF0Y2hsZW5dCjwgCSAmJiBzdHJu
Y21wKGxhc3RuYW1lLCBuYW1lLCBtYXRjaGxlbikgPT0gMAo8IAkgJiYgKGxhc3RuYW1lW21hdGNo
bGVuXSA9PSAnXDAnIHx8IGxhc3RuYW1lW21hdGNobGVuXSA9PSAnLicpKSkgewo8IAlyZXR1cm47
Ci0tLQo+ICAgICBwcm90X3ByaW50ZihpbWFwZF9vdXQsICJcclxuIik7Cj4gfQo+IAo+IHN0YXRp
YyBpbnQgc2V0X3N1YnNjcmliZWQoY2hhciAqbmFtZSwgaW50IG1hdGNobGVuLCBpbnQgbWF5Y3Jl
YXRlLAo+IAkJCSAgaW50ICphdHRyaWJ1dGVzKQo+IHsKPiAgICAgbGlzdF9jYWxsYmFja19jYWxs
cysrOwo+ICAgICBpZiAoIW5hbWVbbWF0Y2hsZW5dKSAKPiAJKmF0dHJpYnV0ZXMgfD0gTUJPWF9B
VFRSSUJVVEVfU1VCU0NSSUJFRDsKPiAgICAgcmV0dXJuIDE7Cj4gfQo+IAo+IC8qIGNhbGxiYWNr
IGZvciBtYm94bGlzdF9maW5kYWxsCj4gICogdXNlZCB3aGVuIHRoZSBTVUJTQ1JJQkVEIHNlbGVj
dGlvbiBvcHRpb24gaXMgTk9UIGdpdmVuICovCj4gc3RhdGljIGludCBsaXN0X2NiKGNoYXIgKm5h
bWUsIGludCBtYXRjaGxlbiwgaW50IG1heWNyZWF0ZSwKPiAJCSAgc3RydWN0IGxpc3Rfcm9jayAq
cm9jaykKPiB7Cj4gICAgIGludCBsYXN0X2xlbjsKPiAgICAgaW50IGxhc3RfbmFtZV9pc19hbmNl
c3RvciA9Cj4gCXJvY2stPmxhc3RfbmFtZQo+IAkmJiBtYXRjaGxlbiA+PSAobGFzdF9sZW4gPSBz
dHJsZW4ocm9jay0+bGFzdF9uYW1lKSkKPiAJJiYgbmFtZVtsYXN0X2xlbl0gPT0gJy4nCj4gCSYm
ICFtZW1jbXAocm9jay0+bGFzdF9uYW1lLCBuYW1lLCBsYXN0X2xlbik7Cj4gCj4gICAgIGxpc3Rf
Y2FsbGJhY2tfY2FsbHMrKzsKPiAKPiAgICAgaWYgKGxhc3RfbmFtZV9pc19hbmNlc3RvcikKPiAJ
cm9jay0+bGFzdF9hdHRyaWJ1dGVzIHw9IE1CT1hfQVRUUklCVVRFX0hBU0NISUxEUkVOOwo+IAo+
ICAgICBpZiAoIW5hbWVbbWF0Y2hsZW5dKSB7Cj4gCWlmICggISAocm9jay0+bGFzdF9hdHRyaWJ1
dGVzICYgTUJPWF9BVFRSSUJVVEVfSEFTQ0hJTERSRU4pICkKPiAJICAgIHJvY2stPmxhc3RfYXR0
cmlidXRlcyB8PSBNQk9YX0FUVFJJQlVURV9IQVNOT0NISUxEUkVOOwo+IAlsaXN0X3Jlc3BvbnNl
KHJvY2stPmxhc3RfbmFtZSwgcm9jay0+bGFzdF9hdHRyaWJ1dGVzLCByb2NrLT5vcHRzKTsKPiAJ
ZnJlZShyb2NrLT5sYXN0X25hbWUpOwo+IAlyb2NrLT5sYXN0X25hbWUgPSB4c3RyZHVwKG5hbWUp
Owo+IAlyb2NrLT5sYXN0X2F0dHJpYnV0ZXMgPSAwOwo+IAlpZiAoIW1heWNyZWF0ZSkKPiAJICAg
IHJvY2stPmxhc3RfYXR0cmlidXRlcyB8PSBNQk9YX0FUVFJJQlVURV9OT0lORkVSSU9SUzsKPiAJ
LyogeHh4OiBpcyB0aGVyZSBhIGNoZWFwZXIgd2F5IHRvIGZpZ3VyZSBvdXQgXFN1YnNjcmliZWQ/
ICovCj4gCWlmIChyb2NrLT5vcHRzICYgTElTVF9SRVRfU1VCU0NSSUJFRCkKPiAJICAgIG1ib3hs
aXN0X2ZpbmRzdWIoJmltYXBkX25hbWVzcGFjZSwgbmFtZSwgaW1hcGRfdXNlcmlzYWRtaW4sCj4g
CQkJICAgICBpbWFwZF91c2VyaWQsIGltYXBkX2F1dGhzdGF0ZSwgc2V0X3N1YnNjcmliZWQsCj4g
CQkJICAgICAmcm9jay0+bGFzdF9hdHRyaWJ1dGVzLCAwKTsKPiAgICAgfSBlbHNlIGlmIChuYW1l
W21hdGNobGVuXSA9PSAnLicKPiAJICAgICYmICEgKHJvY2stPm9wdHMgJiBMSVNUX09QVF9FWFRF
TkRFRCkKPiAJICAgICYmIHJvY2stPnRyYWlsaW5nX3BlcmNlbnQpIHsKPiAJLyogc3BlY2lhbCBj
YXNlOiBpZiB0aGUgbWFpbGJveCBuYW1lIGFyZ3VtZW50IG9mIGEgbm9uLWV4dGVuZGVkIExpc3QK
PiAJICogY29tbWFuZCBlbmRzIHdpdGggJSwgd2UgbXVzdCBpbmNsdWRlIG1hdGNoaW5nIGxldmVs
cyBvZiBoaWVyYXJjaHkgKi8KPiAJaWYgKCAhIChyb2NrLT5sYXN0X25hbWUKPiAJCSAgICAmJiAh
c3RybmNtcChyb2NrLT5sYXN0X25hbWUsIG5hbWUsIG1hdGNobGVuKQo+IAkJICAgICYmIChyb2Nr
LT5sYXN0X25hbWVbbWF0Y2hsZW5dID09ICdcMCcKPiAJCQl8fCByb2NrLT5sYXN0X25hbWVbbWF0
Y2hsZW5dID09ICcuJykpICkgewo+IAkgICAgbGlzdF9yZXNwb25zZShyb2NrLT5sYXN0X25hbWUs
IHJvY2stPmxhc3RfYXR0cmlidXRlcywgcm9jay0+b3B0cyk7Cj4gCSAgICBmcmVlKHJvY2stPmxh
c3RfbmFtZSk7Cj4gCSAgICByb2NrLT5sYXN0X25hbWUgPSB4c3RybmR1cChuYW1lLCBtYXRjaGxl
bik7Cj4gCSAgICByb2NrLT5sYXN0X2F0dHJpYnV0ZXMgPSBNQk9YX0FUVFJJQlVURV9OT05FWElT
VEVOVAo+IAkJfCBNQk9YX0FUVFJJQlVURV9OT1NFTEVDVCB8IE1CT1hfQVRUUklCVVRFX0hBU0NI
SUxEUkVOOwo+IAl9CjkyMTAsOTIxN2M5NDcxLDk1MDMKPCAJCjwgICAgIC8qCjwgICAgICAqIFdl
IGNhbiBnZXQgYSBwYXJ0aWFsIG1hdGNoIGZvciAidXNlciIgbXVsdGlwbGUgdGltZXMgd2l0aAo8
ICAgICAgKiBvdGhlciBtYXRjaGVzIGluYmV0d2Vlbi4gIEhhbmRsZSBpdCBhcyBhIHNwZWNpYWwg
Y2FzZQo8ICAgICAgKi8KPCAgICAgaWYgKG1hdGNobGVuID09IDQgJiYgc3RybmNhc2VjbXAobmFt
ZSwgInVzZXIiLCA0KSA9PSAwKSB7CjwgCWlmIChzYXd1c2VyKSByZXR1cm47CjwgCXNhd3VzZXIg
PSAxOwotLS0KPiAKPiAgICAgcmV0dXJuIDA7Cj4gfQo+IAo+IC8qIGNhbGxiYWNrIGZvciBtYm94
bGlzdF9maW5kc3ViCj4gICogdXNlZCB3aGVuIFNVQlNDUklCRUQgYnV0IG5vdCBSRUNVUlNJVkVN
QVRDSCBpcyBnaXZlbiAqLwo+IHN0YXRpYyBpbnQgc3Vic2NyaWJlZF9jYihjaGFyICpuYW1lLCBp
bnQgbWF0Y2hsZW4sIGludCBtYXljcmVhdGUsCj4gCQkJIHN0cnVjdCBsaXN0X3JvY2sgKnJvY2sp
Cj4gewo+ICAgICBsaXN0X2NhbGxiYWNrX2NhbGxzKys7Cj4gCj4gICAgIGlmICghbmFtZVttYXRj
aGxlbl0pIHsKPiAJbGlzdF9yZXNwb25zZShyb2NrLT5sYXN0X25hbWUsIHJvY2stPmxhc3RfYXR0
cmlidXRlcywgcm9jay0+b3B0cyk7Cj4gCWZyZWUocm9jay0+bGFzdF9uYW1lKTsKPiAJcm9jay0+
bGFzdF9uYW1lID0geHN0cmR1cChuYW1lKTsKPiAJcm9jay0+bGFzdF9hdHRyaWJ1dGVzID0gTUJP
WF9BVFRSSUJVVEVfU1VCU0NSSUJFRDsKPiAJaWYgKCFtYXljcmVhdGUpCj4gCSAgICByb2NrLT5s
YXN0X2F0dHJpYnV0ZXMgfD0gTUJPWF9BVFRSSUJVVEVfTk9JTkZFUklPUlM7Cj4gICAgIH0gZWxz
ZSBpZiAobmFtZVttYXRjaGxlbl0gPT0gJy4nCj4gCSAgICAmJiByb2NrLT5vcHRzICYgTElTVF9P
UFRfTFNVQgo+IAkgICAgJiYgcm9jay0+dHJhaWxpbmdfcGVyY2VudCkgewo+IAkvKiBzcGVjaWFs
IGNhc2U6IGlmIHRoZSBtYWlsYm94IG5hbWUgYXJndW1lbnQgb2YgYW4gTHN1YiBjb21tYW5kIGVu
ZHMKPiAJICogd2l0aCAlLCBtYWlsYm94IG5hbWVzIHRoYXQgbWF0Y2ggdGhlIHBhdHRlcm4gYnV0
IGFyZW4ndCBzdWJzY3JpYmVkCj4gCSAqIG11c3QgYWxzbyBiZSByZXR1cm5lZCBpZiB0aGV5IGhh
dmUgYSBjaGlsZCBtYWlsYm94IHRoYXQgaXMKPiAJICogc3Vic2NyaWJlZCAqLwo+IAluYW1lW21h
dGNobGVuXSA9ICdcMCc7Cj4gCWlmICggISAocm9jay0+bGFzdF9uYW1lICYmICFzdHJjbXAocm9j
ay0+bGFzdF9uYW1lLCBuYW1lKSkgKSB7Cj4gCSAgICBsaXN0X3Jlc3BvbnNlKHJvY2stPmxhc3Rf
bmFtZSwgcm9jay0+bGFzdF9hdHRyaWJ1dGVzLCByb2NrLT5vcHRzKTsKPiAJICAgIGZyZWUocm9j
ay0+bGFzdF9uYW1lKTsKPiAJICAgIHJvY2stPmxhc3RfbmFtZSA9IHhzdHJkdXAobmFtZSk7Cj4g
CSAgICByb2NrLT5sYXN0X2F0dHJpYnV0ZXMgPSBNQk9YX0FUVFJJQlVURV9DSElMRElORk9fU1VC
U0NSSUJFRDsKPiAJfQo+IAluYW1lW21hdGNobGVuXSA9ICcuJzsKOTIyMCw5MjIyYzk1MDYsOTUw
Nwo8ICAgICBzdHJsY3B5KGxhc3RuYW1lLCBuYW1lLCBzaXplb2YobGFzdG5hbWUpKTsKPCAgICAg
bGFzdG5hbWVbbWF0Y2hsZW5dID0gJ1wwJzsKPCAgICAgbm9uZXhpc3RlbnQgPSAwOwotLS0KPiAg
ICAgcmV0dXJuIDA7Cj4gfQo5MjI0LDkyMjljOTUwOSw5NTI3CjwgICAgIC8qIE5vdyB3ZSBuZWVk
IHRvIHNlZSBpZiB0aGlzIG1haWxib3ggZXhpc3RzICovCjwgICAgIC8qIGZpcnN0IGNvbnZlcnQg
IklOQk9YIiB0byAidXNlci48dXNlcmlkPiIgKi8KPCAgICAgaWYgKCFzdHJuY2FzZWNtcChsYXN0
bmFtZSwgImluYm94IiwgNSkpIHsKPCAJKCppbWFwZF9uYW1lc3BhY2UubWJveG5hbWVfdG9pbnRl
cm5hbCkoJmltYXBkX25hbWVzcGFjZSwgIklOQk9YIiwKPCAJCQkJCSAgICAgICBpbWFwZF91c2Vy
aWQsIG1ib3huYW1lKTsKPCAJc3RybGNhdChtYm94bmFtZSwgbGFzdG5hbWUrNSwgc2l6ZW9mKG1i
b3huYW1lKSk7Ci0tLQo+IC8qCj4gICogVGFrZXMgdGhlICJyZWZlcmVuY2UgbmFtZSIgYW5kICJt
YWlsYm94IG5hbWUiIGFyZ3VtZW50cyBvZiB0aGUgTElTVCBjb21tYW5kCj4gICogYW5kIHJldHVy
bnMgYSAiY2Fub25pY2FsIExJU1QgcGF0dGVybiIuIFRoZSBjYWxsZXIgaXMgcmVzcG9uc2libGUg
Zm9yCj4gICogZnJlZSgpaW5nIHRoZSByZXR1cm5lZCBzdHJpbmcuCj4gICovCj4gY2hhciAqY2Fu
b25pY2FsX2xpc3RfcGF0dGVybihjb25zdCBjaGFyICpyZWZlcmVuY2UsIGNvbnN0IGNoYXIgKnBh
dHRlcm4pCj4gewo+ICAgICBpbnQgcGF0bGVuID0gc3RybGVuKHBhdHRlcm4pOwo+ICAgICBpbnQg
cmVmbGVuID0gc3RybGVuKHJlZmVyZW5jZSk7Cj4gCj4gICAgIGNoYXIgKmJ1ZiA9IHhtYWxsb2Mo
cGF0bGVuICsgcmVmbGVuICsgMSk7Cj4gICAgIGJ1ZlswXSA9ICdcMCc7Cj4gCj4gICAgIGlmICgq
cmVmZXJlbmNlKSB7Cj4gCWlmIChyZWZlcmVuY2VbcmVmbGVuLTFdID09IGltYXBkX25hbWVzcGFj
ZS5oaWVyX3NlcCAmJgo+IAkJcGF0dGVyblswXSA9PSBpbWFwZF9uYW1lc3BhY2UuaGllcl9zZXAp
Cj4gCSAgICAtLXJlZmxlbjsKPiAJbWVtY3B5KGJ1ZiwgcmVmZXJlbmNlLCByZWZsZW4pOwo+IAli
dWZbcmVmbGVuXSA9ICdcMCc7CjkyMzEsOTIzMmM5NTI5CjwgICAgIGVsc2UKPCAJc3RybGNweSht
Ym94bmFtZSwgbGFzdG5hbWUsIHNpemVvZihtYm94bmFtZSkpOwotLS0KPiAgICAgc3RyY2F0KGJ1
ZiwgcGF0dGVybik7CjkyMzQsOTIzOGM5NTMxLDk1MzIKPCAgICAgLyogTG9vayBpdCB1cCAqLwo8
ICAgICBub25leGlzdGVudCA9IG1ib3hsaXN0X2RldGFpbChtYm94bmFtZSwgJm1idHlwZSwKPCAJ
CQkJICBOVUxMLCBOVUxMLCBOVUxMLCBOVUxMLCBOVUxMKTsKPCAgICAgaWYoIW5vbmV4aXN0ZW50
ICYmIChtYnR5cGUgJiBNQlRZUEVfUkVTRVJWRSkpCjwgCW5vbmV4aXN0ZW50ID0gSU1BUF9NQUlM
Qk9YX1JFU0VSVkVEOwotLS0KPiAgICAgcmV0dXJuIGJ1ZjsKPiB9CjkyNDAsOTI0M2M5NTM0LDk1
NTcKPCAgICAgaWYgKCFuYW1lW21hdGNobGVuXSkgewo8IAlsYXN0bmFtZWRlbGF5ZWQgPSAxOwo8
IAlpZiAoIW1heWNyZWF0ZSkgbGFzdG5hbWVub2luZmVyaW9ycyA9IDE7CjwgCXJldHVybjsKLS0t
Cj4gLyoKPiAgKiBUdXJucyB0aGUgc3RyaW5ncyBpbiBwYXR0ZXJucyBpbnRvICJjYW5vbmljYWwg
TElTVCBwYXR0ZXJuInMuIEFsc28KPiAgKiB0cmFuc2xhdGVzIGFueSBoaWVyYXJjaHkgc2VwYXJh
dG9ycy4KPiAgKi8KPiB2b2lkIGNhbm9uaWNhbF9saXN0X3BhdHRlcm5zKGNoYXIgKnJlZmVyZW5j
ZSwgc3RydWN0IHN0cmxpc3QgKnBhdHRlcm5zKQo+IHsKPiAgICAgc3RhdGljIGludCBpZ25vcmVy
ZWZlcmVuY2UgPSAwOwo+ICAgICBjaGFyICpvbGQ7Cj4gCj4gICAgIC8qIElnbm9yZSB0aGUgcmVm
ZXJlbmNlIGFyZ3VtZW50Pwo+ICAgICAgICAodGhlIGJlaGF2aW9yIGluIDEuNS4xMCAmIG9sZGVy
KSAqLwo+ICAgICBpZiAoaWdub3JlcmVmZXJlbmNlID09IDApCj4gCWlnbm9yZXJlZmVyZW5jZSA9
IGNvbmZpZ19nZXRzd2l0Y2goSU1BUE9QVF9JR05PUkVSRUZFUkVOQ0UpOwo+IAo+ICAgICBmb3Ig
KDsgcGF0dGVybnM7IHBhdHRlcm5zID0gcGF0dGVybnMtPm5leHQpIHsKPiAJaWYgKCFpZ25vcmVy
ZWZlcmVuY2UgfHwgcGF0dGVybnMtPnNbMF0gPT0gaW1hcGRfbmFtZXNwYWNlLmhpZXJfc2VwKSB7
Cj4gCSAgICBvbGQgPSBwYXR0ZXJucy0+czsKPiAJICAgIHBhdHRlcm5zLT5zID0gY2Fub25pY2Fs
X2xpc3RfcGF0dGVybihyZWZlcmVuY2UsIG9sZCk7Cj4gCSAgICBmcmVlKG9sZCk7Cj4gCX0KPiAJ
LyogVHJhbnNsYXRlIGFueSBzZXBhcmF0b3JzIGluIHBhdHRlcm4gKi8KPiAJbWJveG5hbWVfaGll
cnNlcF90b2ludGVybmFsKCZpbWFwZF9uYW1lc3BhY2UsIHBhdHRlcm5zLT5zLAo+IAkJCQkgICAg
Y29uZmlnX3ZpcnRkb21haW5zID8KPiAJCQkJICAgIHN0cmNzcG4ocGF0dGVybnMtPnMsICJAIikg
OiAwKTsKOTI0NGE5NTU5Cj4gfQo5MjQ2LDkyNTVjOTU2MSw5NTgwCjwgICAgIGMgPSBuYW1lW21h
dGNobGVuXTsKPCAgICAgaWYgKGMpIG5hbWVbbWF0Y2hsZW5dID0gJ1wwJzsKPCAgICAgcHJvdF9w
cmludGYoaW1hcGRfb3V0LCAiKiAlcyAoIiwgY21kKTsKPCAgICAgaWYgKGMpIHsKPCAJLyogSGFu
ZGxlIG5hbWVzcGFjZSBwcmVmaXggYXMgYSBzcGVjaWFsIGNhc2UgKi8gCjwgCWlmICghc3RyY21w
KG5hbWUsICJ1c2VyIikgfHwKPCAJICAgICFzdHJjbXAobmFtZSwgaW1hcGRfbmFtZXNwYWNlLnBy
ZWZpeFtOQU1FU1BBQ0VfU0hBUkVEXSkpIHsKPCAJICAgIHByb3RfcHJpbnRmKGltYXBkX291dCwg
IlxcTm9zZWxlY3QiKTsKPCAJICAgIGlmIChsaXN0b3B0cyAmIExJU1RfRVhUKQo8IAkJcHJvdF9w
cmludGYoaW1hcGRfb3V0LCAiIFxcUGxhY2VIb2xkZXIiKTsKLS0tCj4gLyogY2FsbGJhY2sgZm9y
IG1ib3hsaXN0X2ZpbmRzdWIKPiAgKiB1c2VkIGJ5IGxpc3RfZGF0YV9yZWN1cnNpdmVtYXRjaCAq
Lwo+IHN0YXRpYyBpbnQgcmVjdXJzaXZlbWF0Y2hfY2IoY2hhciAqbmFtZSwgaW50IG1hdGNobGVu
LCBpbnQgbWF5Y3JlYXRlLAo+IAkJCSAgICAgc3RydWN0IGxpc3Rfcm9ja19yZWN1cnNpdmVtYXRj
aCAqcm9jaykgewo+ICAgICBsaXN0X2NhbGxiYWNrX2NhbGxzKys7Cj4gCj4gICAgIGlmIChuYW1l
W21hdGNobGVuXSkgewo+IAlpZiAobmFtZVttYXRjaGxlbl0gPT0gJy4nKSB7Cj4gCSAgICBpbnQg
KnBhcmVudF9pbmZvOwo+IAkgICAgbmFtZVttYXRjaGxlbl0gPSAnXDAnOwo+IAkgICAgcGFyZW50
X2luZm8gPSBoYXNoX2xvb2t1cChuYW1lLCAmcm9jay0+dGFibGUpOwo+IAkgICAgaWYgKCFwYXJl
bnRfaW5mbykgewo+IAkJcGFyZW50X2luZm8gPSB4em1hbGxvYyhzaXplb2YoaW50KSk7Cj4gCQlo
YXNoX2luc2VydChuYW1lLCBwYXJlbnRfaW5mbywgJnJvY2stPnRhYmxlKTsKPiAJCXJvY2stPmNv
dW50Kys7Cj4gCQlpZiAoIW1heWNyZWF0ZSkKPiAJCSAgICAqcGFyZW50X2luZm8gfD0gTUJPWF9B
VFRSSUJVVEVfTk9JTkZFUklPUlM7Cj4gCSAgICB9Cj4gCSAgICAqcGFyZW50X2luZm8gfD0gTUJP
WF9BVFRSSUJVVEVfQ0hJTERJTkZPX1NVQlNDUklCRUQ7Cj4gCSAgICBuYW1lW21hdGNobGVuXSA9
ICcuJzsKOTI1Nyw5MjY0Yzk1ODIsOTU5MAo8IAllbHNlIHsKPCAJICAgIGlmIChub25leGlzdGVu
dCkKPCAJCXByb3RfcHJpbnRmKGltYXBkX291dCwgIlxcTm9uRXhpc3RlbnQiKTsKPCAJICAgIC8q
IExJU1RFWFQgdXNlcyBcUGxhY2VIb2xkZXIgaW5zdGVhZCBvZiBcTm9zZWxlY3QgKi8KPCAJICAg
IGlmIChsaXN0b3B0cyAmIExJU1RfRVhUKQo8IAkJcHJvdF9wcmludGYoaW1hcGRfb3V0LCAiJXNc
XFBsYWNlSG9sZGVyIiwgbm9uZXhpc3RlbnQgPyAiICIgOiAiIik7CjwgCSAgICBlbHNlCjwgCQlw
cm90X3ByaW50ZihpbWFwZF9vdXQsICIlc1xcTm9zZWxlY3QiLCBub25leGlzdGVudCA/ICIgIiA6
ICIiKTsKLS0tCj4gICAgIH0gZWxzZSB7Cj4gCWludCAqbGlzdF9pbmZvID0gaGFzaF9sb29rdXAo
bmFtZSwgJnJvY2stPnRhYmxlKTsKPiAJaWYgKCFsaXN0X2luZm8pIHsKPiAJICAgIGxpc3RfaW5m
byA9IHh6bWFsbG9jKHNpemVvZihpbnQpKTsKPiAJICAgIGhhc2hfaW5zZXJ0KG5hbWUsIGxpc3Rf
aW5mbywgJnJvY2stPnRhYmxlKTsKPiAJICAgIHJvY2stPmNvdW50Kys7Cj4gCSAgICAqbGlzdF9p
bmZvIHw9IE1CT1hfQVRUUklCVVRFX1NVQlNDUklCRUQ7Cj4gCSAgICBpZiAoIW1heWNyZWF0ZSkK
PiAJCSpsaXN0X2luZm8gfD0gTUJPWF9BVFRSSUJVVEVfTk9JTkZFUklPUlM7CjkyNjYsOTI2N2Q5
NTkxCjwgCWlmIChsaXN0b3B0cyAmIExJU1RfQ0hJTERSRU4pCjwgCSAgICBwcm90X3ByaW50Zihp
bWFwZF9vdXQsICIgXFxIYXNDaGlsZHJlbiIpOwo5MjY5ZDk1OTIKPCAgICAgcHJvdF9wcmludGYo
aW1hcGRfb3V0LCAiKSBcIiVjXCIgIiwgaW1hcGRfbmFtZXNwYWNlLmhpZXJfc2VwKTsKOTI3MSw5
Mjc2Yzk1OTQsOTcwNwo8ICAgICAoKmltYXBkX25hbWVzcGFjZS5tYm94bmFtZV90b2V4dGVybmFs
KSgmaW1hcGRfbmFtZXNwYWNlLCBuYW1lLAo8IAkJCQkJICAgaW1hcGRfdXNlcmlkLCBtYm94bmFt
ZSk7CjwgICAgIHByaW50c3RyaW5nKG1ib3huYW1lKTsKPCAgICAgcHJvdF9wcmludGYoaW1hcGRf
b3V0LCAiXHJcbiIpOwo8ICAgICBpZiAoYykgbmFtZVttYXRjaGxlbl0gPSBjOwo8ICAgICByZXR1
cm47Ci0tLQo+ICAgICByZXR1cm4gMDsKPiB9Cj4gCj4gLyogY2FsbGJhY2sgZm9yIGhhc2hfZW51
bWVyYXRlICovCj4gdm9pZCBjb3B5X3RvX2FycmF5KGNoYXIgKmtleSwgdm9pZCAqZGF0YSwgdm9p
ZCAqdm9pZF9yb2NrKSB7Cj4gICAgIGludCAqYXR0cmlidXRlcyA9IChpbnQgKilkYXRhOwo+ICAg
ICBzdHJ1Y3QgbGlzdF9yb2NrX3JlY3Vyc2l2ZW1hdGNoICpyb2NrID0KPiAJKHN0cnVjdCBsaXN0
X3JvY2tfcmVjdXJzaXZlbWF0Y2ggKil2b2lkX3JvY2s7Cj4gICAgIGFzc2VydChyb2NrLT5jb3Vu
dCA+IDApOwo+ICAgICByb2NrLT5hcnJheVstLXJvY2stPmNvdW50XS5uYW1lID0ga2V5Owo+ICAg
ICByb2NrLT5hcnJheVtyb2NrLT5jb3VudF0uYXR0cmlidXRlcyA9ICphdHRyaWJ1dGVzOwo+IH0K
PiAKPiAvKiBDb21wYXJhdG9yIGZvciByZXZlcnNlLXNvcnRpbmcgYW4gYXJyYXkgb2Ygc3RydWN0
IGxpc3RfZW50cnkgYnkgbmFtZS4gKi8KPiBpbnQgbGlzdF9lbnRyeV9jb21wYXJhdG9yKGNvbnN0
IHZvaWQgKnAxLCBjb25zdCB2b2lkICpwMikgewo+ICAgICBjb25zdCBzdHJ1Y3QgbGlzdF9lbnRy
eSAqZTEgPSAoc3RydWN0IGxpc3RfZW50cnkgKilwMTsKPiAgICAgY29uc3Qgc3RydWN0IGxpc3Rf
ZW50cnkgKmUyID0gKHN0cnVjdCBsaXN0X2VudHJ5ICopcDI7Cj4gICAgIHJldHVybiAtIHN0cmNt
cChlMS0+bmFtZSwgZTItPm5hbWUpOwo+IH0KPiAKPiBzdGF0aWMgdm9pZCBsaXN0X2RhdGFfcmVj
dXJzaXZlbWF0Y2goc3RydWN0IHN0cmxpc3QgKnBhdHRlcm5zLCBpbnQgb3B0cywKPiAJCQkJICAg
ICBpbnQgKCpmaW5kc3ViKShzdHJ1Y3QgbmFtZXNwYWNlICosCj4gCQkJCQkgY29uc3QgY2hhciAq
LCBpbnQsIGNoYXIgKiwKPiAJCQkJCSBzdHJ1Y3QgYXV0aF9zdGF0ZSAqLCBpbnQgKCopKCksCj4g
CQkJCQkgdm9pZCAqLCBpbnQpKSB7Cj4gICAgIHN0cnVjdCBzdHJsaXN0ICpwYXR0ZXJuOwo+ICAg
ICBzdHJ1Y3QgbGlzdF9yb2NrX3JlY3Vyc2l2ZW1hdGNoIHJvY2s7Cj4gCj4gICAgIHJvY2suY291
bnQgPSAwOwo+ICAgICByb2NrLm9wdHMgPSBvcHRzOwo+ICAgICBjb25zdHJ1Y3RfaGFzaF90YWJs
ZSgmcm9jay50YWJsZSwgMTAwLCAxKTsKPiAKPiAgICAgLyogZmluZCAqLwo+ICAgICBmb3IgKHBh
dHRlcm4gPSBwYXR0ZXJuczsgcGF0dGVybjsgcGF0dGVybiA9IHBhdHRlcm4tPm5leHQpCj4gCWZp
bmRzdWIoJmltYXBkX25hbWVzcGFjZSwgcGF0dGVybi0+cywgaW1hcGRfdXNlcmlzYWRtaW4sIGlt
YXBkX3VzZXJpZCwKPiAJCWltYXBkX2F1dGhzdGF0ZSwgcmVjdXJzaXZlbWF0Y2hfY2IsICZyb2Nr
LCAxKTsKPiAKPiAgICAgaWYgKHJvY2suY291bnQpIHsKPiAJLyogc29ydCAqLwo+IAlpbnQgZW50
cmllcyA9IHJvY2suY291bnQ7Cj4gCXJvY2suYXJyYXkgPSB4bWFsbG9jKGVudHJpZXMgKiAoc2l6
ZW9mKHN0cnVjdCBsaXN0X2VudHJ5KSkpOwo+IAloYXNoX2VudW1lcmF0ZSgmcm9jay50YWJsZSwg
Y29weV90b19hcnJheSwgJnJvY2spOwo+IAlxc29ydChyb2NrLmFycmF5LCBlbnRyaWVzLCBzaXpl
b2Yoc3RydWN0IGxpc3RfZW50cnkpLAo+IAkgICAgICBsaXN0X2VudHJ5X2NvbXBhcmF0b3IpOwo+
IAlhc3NlcnQocm9jay5jb3VudCA9PSAwKTsKPiAKPiAJLyogcHJpbnQgKi8KPiAJZm9yIChlbnRy
aWVzLS07IGVudHJpZXMgPj0gMDsgZW50cmllcy0tKQo+IAkgICAgbGlzdF9yZXNwb25zZShyb2Nr
LmFycmF5W2VudHJpZXNdLm5hbWUsCj4gCQkgICAgcm9jay5hcnJheVtlbnRyaWVzXS5hdHRyaWJ1
dGVzLAo+IAkJICAgIHJvY2sub3B0cyk7Cj4gCj4gCWZyZWUocm9jay5hcnJheSk7Cj4gICAgIH0K
PiAKPiAgICAgZnJlZV9oYXNoX3RhYmxlKCZyb2NrLnRhYmxlLCBmcmVlKTsKPiB9Cj4gCj4gLyog
UmV0cmlldmVzIHRoZSBkYXRhIGFuZCBwcmludHMgdGhlIHVudGFnZ2VkIHJlc3BvbnNlcyBmb3Ig
YSBMSVNUIGNvbW1hbmQuICovCj4gc3RhdGljIHZvaWQgbGlzdF9kYXRhKGNoYXIgKnJlZmVyZW5j
ZSwgaW50IGxpc3RvcHRzLCBzdHJ1Y3Qgc3RybGlzdCAqcGF0dGVybnMpCj4gewo+ICAgICBpbnQg
KCpmaW5kYWxsKShzdHJ1Y3QgbmFtZXNwYWNlICpuYW1lc3BhY2UsCj4gCQkgICBjb25zdCBjaGFy
ICpwYXR0ZXJuLCBpbnQgaXNhZG1pbiwgY2hhciAqdXNlcmlkLAo+IAkJICAgc3RydWN0IGF1dGhf
c3RhdGUgKmF1dGhfc3RhdGUsIGludCAoKnByb2MpKCksCj4gCQkgICB2b2lkICpyb2NrKTsKPiAg
ICAgaW50ICgqZmluZHN1Yikoc3RydWN0IG5hbWVzcGFjZSAqbmFtZXNwYWNlLAo+IAkJICAgY29u
c3QgY2hhciAqcGF0dGVybiwgaW50IGlzYWRtaW4sIGNoYXIgKnVzZXJpZCwKPiAJCSAgIHN0cnVj
dCBhdXRoX3N0YXRlICphdXRoX3N0YXRlLCBpbnQgKCpwcm9jKSgpLAo+IAkJICAgdm9pZCAqcm9j
aywgaW50IGZvcmNlKTsKPiAgICAgY2Fub25pY2FsX2xpc3RfcGF0dGVybnMocmVmZXJlbmNlLCBw
YXR0ZXJucyk7Cj4gCj4gICAgIC8qIENoZWNrIHRvIHNlZSBpZiB3ZSBzaG91bGQgb25seSBsaXN0
IHRoZSBwZXJzb25hbCBuYW1lc3BhY2UgKi8KPiAgICAgaWYgKCEobGlzdG9wdHMgJiBMSVNUX09Q
VF9FWFRFTkRFRCkKPiAJICAgICYmICFzdHJjbXAocGF0dGVybnMtPnMsICIqIikKPiAJICAgICYm
IGNvbmZpZ19nZXRzd2l0Y2goSU1BUE9QVF9GT09MU1RVUElEQ0xJRU5UUykpIHsKPiAJZnJlZShw
YXR0ZXJucy0+cyk7Cj4gCXBhdHRlcm5zLT5zID0geHN0cmR1cCgiSU5CT1gqIik7Cj4gCWZpbmRz
dWIgPSBtYm94bGlzdF9maW5kc3ViOwo+IAlmaW5kYWxsID0gbWJveGxpc3RfZmluZGFsbDsKPiAg
ICAgfSBlbHNlIHsKPiAJZmluZHN1YiA9IGltYXBkX25hbWVzcGFjZS5tYm94bGlzdF9maW5kc3Vi
Owo+IAlmaW5kYWxsID0gaW1hcGRfbmFtZXNwYWNlLm1ib3hsaXN0X2ZpbmRhbGw7Cj4gICAgIH0K
PiAKPiAgICAgaWYgKGxpc3RvcHRzICYgTElTVF9TRUxfUkVDVVJTSVZFTUFUQ0gpIHsKPiAJbGlz
dF9kYXRhX3JlY3Vyc2l2ZW1hdGNoKHBhdHRlcm5zLCBsaXN0b3B0cywgZmluZHN1Yik7Cj4gICAg
IH0gZWxzZSB7Cj4gCXN0cnVjdCBzdHJsaXN0ICpwYXR0ZXJuOwo+IAlzdHJ1Y3QgbGlzdF9yb2Nr
IHJvY2s7Cj4gCXJvY2sub3B0cyA9IGxpc3RvcHRzOwo+IAlyb2NrLmxhc3RfbmFtZSA9IE5VTEw7
Cj4gCWlmIChsaXN0b3B0cyAmIExJU1RfU0VMX1NVQlNDUklCRUQpIHsKPiAJICAgIGZvciAocGF0
dGVybiA9IHBhdHRlcm5zOyBwYXR0ZXJuOyBwYXR0ZXJuID0gcGF0dGVybi0+bmV4dCkgewo+IAkJ
cm9jay50cmFpbGluZ19wZXJjZW50ID0KPiAJCSAgICBwYXR0ZXJuLT5zW3N0cmxlbihwYXR0ZXJu
LT5zKSAtIDFdID09ICclJzsKPiAJCWZpbmRzdWIoJmltYXBkX25hbWVzcGFjZSwgcGF0dGVybi0+
cywgaW1hcGRfdXNlcmlzYWRtaW4sCj4gCQkJaW1hcGRfdXNlcmlkLCBpbWFwZF9hdXRoc3RhdGUs
IHN1YnNjcmliZWRfY2IsICZyb2NrLCAxKTsKPiAJCWxpc3RfcmVzcG9uc2Uocm9jay5sYXN0X25h
bWUsIHJvY2subGFzdF9hdHRyaWJ1dGVzLCByb2NrLm9wdHMpOwo+IAkJZnJlZShyb2NrLmxhc3Rf
bmFtZSk7Cj4gCQlyb2NrLmxhc3RfbmFtZSA9IE5VTEw7Cj4gCSAgICB9Cj4gCX0gZWxzZSB7Cj4g
CSAgICByb2NrLm9wdHMgfD0gTElTVF9SRVRfQ0hJTERSRU47Cj4gCSAgICBmb3IgKHBhdHRlcm4g
PSBwYXR0ZXJuczsgcGF0dGVybjsgcGF0dGVybiA9IHBhdHRlcm4tPm5leHQpIHsKPiAJCXJvY2su
dHJhaWxpbmdfcGVyY2VudCA9Cj4gCQkgICAgcGF0dGVybi0+c1tzdHJsZW4ocGF0dGVybi0+cykg
LSAxXSA9PSAnJSc7Cj4gCQlmaW5kYWxsKCZpbWFwZF9uYW1lc3BhY2UsIHBhdHRlcm4tPnMsIGlt
YXBkX3VzZXJpc2FkbWluLAo+IAkJCWltYXBkX3VzZXJpZCwgaW1hcGRfYXV0aHN0YXRlLCBsaXN0
X2NiLCAmcm9jayk7Cj4gCQlsaXN0X3Jlc3BvbnNlKHJvY2subGFzdF9uYW1lLCByb2NrLmxhc3Rf
YXR0cmlidXRlcywgcm9jay5vcHRzKTsKPiAJCWZyZWUocm9jay5sYXN0X25hbWUpOwo+IAkJcm9j
ay5sYXN0X25hbWUgPSBOVUxMOwo+IAkgICAgfQo+IAl9Cj4gICAgIH0KOTI4MGM5NzExLDk3MTIK
PCAgKiBJc3N1ZSBhIExJU1QgdW50YWdnZWQgcmVzcG9uc2UKLS0tCj4gICogUmV0cmlldmVzIHRo
ZSBkYXRhIGFuZCBwcmludHMgdGhlIHVudGFnZ2VkIHJlc3BvbnNlcyBmb3IgYSBMSVNUIGNvbW1h
bmQgaW4KPiAgKiB0aGUgY2FzZSBvZiBhIHJlbW90ZSBpbmJveC4KOTI4MmM5NzE0LDk3MTUKPCBz
dGF0aWMgaW50IGxpc3RkYXRhKGNoYXIgKm5hbWUsIGludCBtYXRjaGxlbiwgaW50IG1heWNyZWF0
ZSwgdm9pZCAqcm9jaykKLS0tCj4gc3RhdGljIHZvaWQgbGlzdF9kYXRhX3JlbW90ZShjaGFyICp0
YWcsIGludCBsaXN0b3B0cywgY2hhciAqcmVmZXJlbmNlLAo+IAkJCSAgICAgc3RydWN0IHN0cmxp
c3QgKnBhdHRlcm4pCjkyODQsOTI4N2M5NzE3LDk3MjUKPCAgICAgaW50IGxpc3RvcHRzID0gKigo
aW50ICopcm9jayk7CjwgICAgIAo8ICAgICBtc3RyaW5nZGF0YSgoKGxpc3RvcHRzICYgTElTVF9M
U1VCKSA/ICJMU1VCIiA6ICJMSVNUIiksCjwgCW5hbWUsIG1hdGNobGVuLCBtYXljcmVhdGUsIGxp
c3RvcHRzKTsKLS0tCj4gICAgIGlmIChsaXN0b3B0cyAmIExJU1RfT1BUX0VYVEVOREVECj4gCSAg
ICAmJiAhQ0FQQShiYWNrZW5kX2luYm94LCBDQVBBX0xJU1RFWFRFTkRFRCkpIHsKPiAJLyogY2xp
ZW50IHdhbnRzIHRvIHVzZSBleHRlbmRlZCBsaXN0IGNvbW1hbmQgYnV0IGJhY2tlbmQgZG9lc24n
dAo+IAkgKiBzdXBwb3J0IGl0ICovCj4gCXByb3RfcHJpbnRmKGJhY2tlbmRfaW5ib3gtPm91dCwK
PiAJCSAgICAiJXMgTk8gQmFja2VuZCBzZXJ2ZXIgZG9lcyBub3Qgc3VwcG9ydCBleHRlbmRlZCBs
aXN0IGNvbW1hbmRcclxuIiwKPiAJCSAgICB0YWcpOwo+IAlyZXR1cm47Cj4gICAgIH0KOTI4OWM5
NzI3LDk3ODIKPCAgICAgcmV0dXJuIDA7Ci0tLQo+ICAgICAvKiBwcmludCB0YWcsIGNvbW1hbmQg
YW5kIGxpc3Qgc2VsZWN0aW9uIG9wdGlvbnMgKi8KPiAgICAgaWYgKGxpc3RvcHRzICYgTElTVF9P
UFRfRVhURU5ERUQpIHsKPiAJaW50IGZpcnN0ID0gMTsKPiAJcHJvdF9wcmludGYoYmFja2VuZF9p
bmJveC0+b3V0LCAiJXMgTGlzdCAoIiwgdGFnKTsKPiAJaWYgKGxpc3RvcHRzICYgTElTVF9TRUxf
U1VCU0NSSUJFRCkgewo+IAkgICAgcHJvdF9wcmludGYoYmFja2VuZF9pbmJveC0+b3V0LCAic3Vi
c2NyaWJlZCIpOwo+IAkgICAgZmlyc3QgPSAwOwo+IAl9Cj4gCWlmIChsaXN0b3B0cyAmIExJU1Rf
U0VMX1JFTU9URSkgewo+IAkgICAgcHJvdF9wcmludGYoYmFja2VuZF9pbmJveC0+b3V0LCAiIHJl
bW90ZSIrZmlyc3QpOwo+IAkgICAgZmlyc3QgPSAwOwo+IAl9Cj4gCWlmIChsaXN0b3B0cyAmIExJ
U1RfU0VMX1JFQ1VSU0lWRU1BVENIKQo+IAkgICAgcHJvdF9wcmludGYoYmFja2VuZF9pbmJveC0+
b3V0LCAiIHJlY3Vyc2l2ZW1hdGNoIitmaXJzdCk7Cj4gCXByb3RfcHJpbnRmKGJhY2tlbmRfaW5i
b3gtPm91dCwgIikgIik7Cj4gICAgIH0gZWxzZSB7Cj4gCXByb3RfcHJpbnRmKGJhY2tlbmRfaW5i
b3gtPm91dCwgIiVzIExzdWIgIiwgdGFnKTsKPiAgICAgfQo+IAo+ICAgICAvKiBwcmludCByZWZl
cmVuY2UgYXJndW1lbnQgKi8KPiAgICAgcHJvdF9wcmludGYoYmFja2VuZF9pbmJveC0+b3V0LAo+
IAkJInslZCt9XHJcbiVzICIsIHN0cmxlbihyZWZlcmVuY2UpLCByZWZlcmVuY2UpOwo+IAo+ICAg
ICAvKiBwcmludCBtYWlsYm94IHBhdHRlcm4ocykgKi8KPiAgICAgaWYgKHBhdHRlcm4tPm5leHQp
IHsKPiAJaW50IGZpcnN0ID0gMTsKPiAJcHJvdF9wdXRjKCcoJywgYmFja2VuZF9pbmJveC0+b3V0
KTsKPiAJZm9yICg7IHBhdHRlcm47IHBhdHRlcm4gPSBwYXR0ZXJuLT5uZXh0KSB7Cj4gCSAgICBw
cm90X3ByaW50ZihiYWNrZW5kX2luYm94LT5vdXQsIAo+IAkJCSIgeyVkK31cclxuJXMiK2ZpcnN0
LCBzdHJsZW4ocGF0dGVybi0+cyksIHBhdHRlcm4tPnMpOwo+IAkgICAgZmlyc3QgPSAwOwo+IAl9
Cj4gCXByb3RfcHV0YygnKScsIGJhY2tlbmRfaW5ib3gtPm91dCk7Cj4gICAgIH0gZWxzZSB7Cj4g
CXByb3RfcHJpbnRmKGJhY2tlbmRfaW5ib3gtPm91dCwgCj4gCQkgICAgInslZCt9XHJcbiVzIiwg
c3RybGVuKHBhdHRlcm4tPnMpLCBwYXR0ZXJuLT5zKTsKPiAJcGF0dGVybiA9IHBhdHRlcm4tPm5l
eHQ7Cj4gICAgIH0KPiAKPiAgICAgLyogcHJpbnQgbGlzdCByZXR1cm4gb3B0aW9ucyAqLwo+ICAg
ICBpZiAobGlzdG9wdHMgJiBsaXN0X3JldF9vcHRzKSB7Cj4gCXByb3RfcHJpbnRmKGJhY2tlbmRf
aW5ib3gtPm91dCwgIiByZXR1cm4gKCIpOwo+IAlpbnQgZmlyc3QgPSAxOwo+IAlpZiAobGlzdG9w
dHMgJiBMSVNUX1JFVF9TVUJTQ1JJQkVEKSB7Cj4gCSAgICBwcm90X3ByaW50ZihiYWNrZW5kX2lu
Ym94LT5vdXQsICJzdWJzY3JpYmVkIik7Cj4gCSAgICBmaXJzdCA9IDA7Cj4gCX0KPiAJaWYgKGxp
c3RvcHRzICYgTElTVF9SRVRfQ0hJTERSRU4pIHsKPiAJICAgIHByb3RfcHJpbnRmKGJhY2tlbmRf
aW5ib3gtPm91dCwgIiBjaGlsZHJlbiIrZmlyc3QpOwo+IAl9Cj4gCXByb3RfcHV0YygnKScsIGJh
Y2tlbmRfaW5ib3gtPm91dCk7Cj4gICAgIH0KPiAKPiAgICAgcHJvdF9wcmludGYoYmFja2VuZF9p
bmJveC0+b3V0LCAiXHJcbiIpOwo+ICAgICBwaXBlX2xzdWIoYmFja2VuZF9pbmJveCwgdGFnLCAw
LAo+IAkgICAgICAobGlzdG9wdHMgJiBMSVNUX09QVF9MU1VCKSA/ICJMU1VCIiA6ICJMSVNUIik7
CmRpZmYgLXIgLS1leGNsdWRlPS5zdm4gLi4vY3lydXNoZWFkL2ltYXAvaW1hcGQuaCAuL2ltYXAv
aW1hcGQuaAoyMjhkMjI3CjwgLyogQml0bWFzayBmb3IgbGlzdCBvcHRpb25zICovCjIzMCwyMzRj
MjI5LDI0NQo8ICAgICBMSVNUX0xTVUIgPQkJCSgxPDwwKSwKPCAgICAgTElTVF9FWFQgPQkJCSgx
PDwxKSwKPCAgICAgTElTVF9TVUJTQ1JJQkVEID0JCSgxPDwyKSwKPCAgICAgTElTVF9DSElMRFJF
TiA9CQkoMTw8MyksCjwgICAgIExJU1RfUkVNT1RFID0JCSgxPDw0KQotLS0KPiAgICAgLyogTElT
VCBzZWxlY3Rpb24gb3B0aW9ucyAqLwo+ICAgICBMSVNUX1NFTF9TVUJTQ1JJQkVEID0JKDE8PDAp
LAo+ICAgICBMSVNUX1NFTF9SRU1PVEUgPQkJKDE8PDEpLAo+ICAgICBMSVNUX1NFTF9SRUNVUlNJ
VkVNQVRDSCA9CSgxPDwyKSwKPiAKPiAgICAgLyogTElTVCByZXR1cm4gb3B0aW9ucyAqLwo+ICAg
ICBMSVNUX1JFVF9TVUJTQ1JJQkVEID0JKDE8PDgpLAo+ICAgICBMSVNUX1JFVF9DSElMRFJFTiA9
CQkoMTw8OSksCj4gCj4gICAgIC8qIG90aGVyIG9wdGlvbnMgKi8KPiAgICAgTElTVF9PUFRfUkxJ
U1QgPSAgICAgICAgICAgICgxPDwxNiksCj4gICAgIExJU1RfT1BUX0xTVUIgPSAgICAgICAgICAg
ICAoMTw8MTcpLAo+ICAgICBMSVNUX09QVF9FWFRFTkRFRCA9ICAgICAgICAgKDE8PDE4KSwgLyog
ZXh0ZW5kZWQgTGlzdCBjb21tYW5kICovCj4gICAgIC8qIC4uLiBhcyBzcGVjaWZpZWQgaW4gZHJh
ZnQtaWV0Zi1pbWFwZXh0LWxpc3QtZXh0ZW5zaW9ucy0wMy50eHQgKi8KPiAgICAgTElTVF9PUFRf
RVhURU5ERURfVjAzID0gICAgICgxPDwxOSksCj4gICAgIC8qIC4uLiBhcyBzcGVjaWZpZWQgaW4g
ZHJhZnQtaWV0Zi1pbWFwZXh0LWxpc3QtZXh0ZW5zaW9ucy0xNy50eHQgKi8KPiAgICAgTElTVF9P
UFRfRVhURU5ERURfVjE3ID0gICAgICgxPDwyMCkKMjM1YTI0NywyNjYKPiAjZGVmaW5lIGxpc3Rf
c2VsX29wdHMgKExJU1RfUkVUX1NVQlNDUklCRUQgLSAxKQo+ICNkZWZpbmUgbGlzdF9yZXRfb3B0
cyAoKExJU1RfT1BUX1JMSVNUIC0gMSkgJiB+bGlzdF9zZWxfb3B0cykKPiAKPiAvKiBOYW1lIGF0
dHJpYnV0ZXMgdGhhdCBtYXkgYmUgcmV0dW5lZCBieSBMSVNUICovCj4gZW51bSB7Cj4gICAgIC8q
IGZyb20gUkZDIDM1MDEgKi8KPiAgICAgTUJPWF9BVFRSSUJVVEVfTk9JTkZFUklPUlMgICA9ICgx
PDwwKSwKPiAgICAgTUJPWF9BVFRSSUJVVEVfTk9TRUxFQ1QgICAgICA9ICgxPDwxKSwKPiAgICAg
TUJPWF9BVFRSSUJVVEVfTUFSS0VEICAgICAgICA9ICgxPDwyKSwKPiAgICAgTUJPWF9BVFRSSUJV
VEVfVU5NQVJLRUQgICAgICA9ICgxPDwzKSwKPiAKPiAgICAgLyogZnJvbSBkcmFmdC1pZXRmLWlt
YXBleHQtbGlzdC1leHRlbnNpb25zLTE3LnR4dCAqLwo+ICAgICBNQk9YX0FUVFJJQlVURV9OT05F
WElTVEVOVCAgID0gKDE8PDQpLAo+ICAgICBNQk9YX0FUVFJJQlVURV9TVUJTQ1JJQkVEICAgID0g
KDE8PDUpLAo+ICAgICBNQk9YX0FUVFJJQlVURV9SRU1PVEUgICAgICAgID0gKDE8PDYpLAo+ICAg
ICBNQk9YX0FUVFJJQlVURV9IQVNDSElMRFJFTiAgID0gKDE8PDcpLAo+ICAgICBNQk9YX0FUVFJJ
QlVURV9IQVNOT0NISUxEUkVOID0gKDE8PDgpLAo+ICAgICBNQk9YX0FUVFJJQlVURV9DSElMRElO
Rk9fU1VCU0NSSUJFRCA9ICgxPDw5KQo+IH07Cj4gI2RlZmluZSBsaXN0X2NoaWxkaW5mbyAoTUJP
WF9BVFRSSUJVVEVfQ0hJTERJTkZPX1NVQlNDUklCRUQpCmRpZmYgLXIgLS1leGNsdWRlPS5zdm4g
Li4vY3lydXNoZWFkL2ltYXAvcHJvdG9jb2wuYyAuL2ltYXAvcHJvdG9jb2wuYwoxMTdhMTE4Cj4g
CSAgeyAiIExJU1QtRVhURU5ERUQiLCBDQVBBX0xJU1RFWFRFTkRFRCB9LApkaWZmIC1yIC0tZXhj
bHVkZT0uc3ZuIC4uL2N5cnVzaGVhZC9pbWFwL3Byb3RvY29sLmggLi9pbWFwL3Byb3RvY29sLmgK
NTlhNjAKPiAgICAgQ0FQQV9MSVNURVhURU5ERUQgICA9ICgxIDw8IDcpLAo2NmM2Nwo8ICNkZWZp
bmUgTUFYX0NBUEEgNwotLS0KPiAjZGVmaW5lIE1BWF9DQVBBIDgK
</data>        

          </attachment>
          <attachment
              isobsolete="1"
              ispatch="1"
              isprivate="0"
          >
            <attachid>472</attachid>
            <date>2006-10-19 16:27 EDT</date>
            <desc>unifed diff version of the patch (imho more readable)</desc>
            <filename>list-extended-r59-u.patch</filename>
            <type>text/plain</type>
            <size>43967</size>
            <attacher>martin.konold@erfrakon.de</attacher>
            
              <data encoding="base64">ZGlmZiAtTmF1ciAtLWV4Y2x1ZGU9LnN2biAuLi9icmFuY2hlcy9jeXJ1c2hlYWQvY29uZmlndXJl
LmluIC4vY29uZmlndXJlLmluCi0tLSAuLi9icmFuY2hlcy9jeXJ1c2hlYWQvY29uZmlndXJlLmlu
CTIwMDUtMDQtMTIgMjI6MDU6MjAuMDAwMDAwMDAwICswMjAwCisrKyAuL2NvbmZpZ3VyZS5pbgky
MDA2LTEwLTA0IDE2OjQ5OjA0LjAwMDAwMDAwMCArMDIwMApAQCAtOTMzLDEwICs5MzMsMTAgQEAK
IAlmaSwKIAlBQ19NU0dfUkVTVUxUKG5vKSkKIAotQUNfQVJHX0VOQUJMRShsaXN0ZXh0LAotCVsg
IC0tZW5hYmxlLWxpc3RleHQgICAgICAgIGVuYWJsZSBJTUFQIExpc3QgZXh0ZW5zaW9uc10sCitB
Q19BUkdfRU5BQkxFKGxpc3QtZXh0ZW5kZWQsCisJWyAgLS1lbmFibGUtbGlzdC1leHRlbmRlZCAg
ZW5hYmxlIElNQVAgTElTVC1FWFRFTkRFRCBMaXN0IGV4dGVuc2lvbnNdLAogCWlmIHRlc3QgIiRl
bmFibGV2YWwiID0geWVzOyB0aGVuCi0JCUFDX0RFRklORShFTkFCTEVfTElTVEVYVCxbXSxbRW5h
YmxlIHRoZSBMSVNURVhUIGV4dGVuc2lvbj9dKQorCQlBQ19ERUZJTkUoRU5BQkxFX0xJU1RfRVhU
RU5ERUQsW10sW0VuYWJsZSB0aGUgTElTVC1FWFRFTkRFRCBleHRlbnNpb24/XSkKIAlmaSkKIAog
QUNfQVJHX0VOQUJMRShuZXRzY2FwZWhhY2ssCmRpZmYgLU5hdXIgLS1leGNsdWRlPS5zdm4gLi4v
YnJhbmNoZXMvY3lydXNoZWFkL2RvYy9zcGVjcy5odG1sIC4vZG9jL3NwZWNzLmh0bWwKLS0tIC4u
L2JyYW5jaGVzL2N5cnVzaGVhZC9kb2Mvc3BlY3MuaHRtbAkyMDA2LTA2LTE2IDE3OjEwOjI4LjAw
MDAwMDAwMCArMDIwMAorKysgLi9kb2Mvc3BlY3MuaHRtbAkyMDA2LTA4LTExIDEzOjM5OjI2LjAw
MDAwMDAwMCArMDIwMApAQCAtNTQsNyArNTQsNyBAQAogPFRSPjxURD48QSBIUkVGPSJodHRwOi8v
d3d3LmlldGYub3JnL2ludGVybmV0LWRyYWZ0cy9kcmFmdC1pZXRmLWltYXBleHQtc29ydC0xNy50
eHQiPgogZHJhZnQtaWV0Zi1pbWFwZXh0LXNvcnQ8L0E+PC9URD4KIDxURD5JTUFQIFNPUlQgYW5k
IFRIUkVBRCBFeHRlbnNpb248L1REPjwvVFI+Ci08VFI+PFREPjxBIEhSRUY9Imh0dHA6Ly93d3cu
aWV0Zi5vcmcvaW50ZXJuZXQtZHJhZnRzL2RyYWZ0LWlldGYtaW1hcGV4dC1saXN0LWV4dGVuc2lv
bnMtMTMudHh0Ij4KKzxUUj48VEQ+PEEgSFJFRj0iaHR0cDovL3d3dy5pZXRmLm9yZy9pbnRlcm5l
dC1kcmFmdHMvZHJhZnQtaWV0Zi1pbWFwZXh0LWxpc3QtZXh0ZW5zaW9ucy0xNy50eHQiPgogZHJh
ZnQtaWV0Zi1pbWFwZXh0LWxpc3QtZXh0ZW5zaW9uczwvQT48L1REPgogPFREPklNQVA0IExJU1Qg
Q29tbWFuZCBFeHRlbnNpb25zPC9URD48L1RSPgogPFRSPjxURD48QSBIUkVGPSJodHRwOi8vd3d3
LmlldGYub3JnL2ludGVybmV0LWRyYWZ0cy9kcmFmdC1kYWJvby1pbWFwLWFubm90YXRlbW9yZS0w
OS50eHQiPgpkaWZmIC1OYXVyIC0tZXhjbHVkZT0uc3ZuIC4uL2JyYW5jaGVzL2N5cnVzaGVhZC9p
bWFwL2ltYXBkLmMgLi9pbWFwL2ltYXBkLmMKLS0tIC4uL2JyYW5jaGVzL2N5cnVzaGVhZC9pbWFw
L2ltYXBkLmMJMjAwNi0xMC0wNCAxNjo0NjozNi4wMDAwMDAwMDAgKzAyMDAKKysrIC4vaW1hcC9p
bWFwZC5jCTIwMDYtMTAtMDQgMTY6NDk6MjkuMDAwMDAwMDAwICswMjAwCkBAIC03Miw2ICs3Miw3
IEBACiAjaW5jbHVkZSAiZXhpdGNvZGVzLmgiCiAjaW5jbHVkZSAiaWRsZS5oIgogI2luY2x1ZGUg
Imdsb2JhbC5oIgorI2luY2x1ZGUgImhhc2guaCIKICNpbmNsdWRlICJpbWFwX2Vyci5oIgogI2lu
Y2x1ZGUgInByb3h5LmgiCiAjaW5jbHVkZSAiaW1hcF9wcm94eS5oIgpAQCAtMTU1LDYgKzE1Niw3
IEBACiBzdGF0aWMgc2FzbF9jb25uX3QgKmltYXBkX3Nhc2xjb25uOyAvKiB0aGUgc2FzbCBjb25u
ZWN0aW9uIGNvbnRleHQgKi8KIHN0YXRpYyBpbnQgaW1hcGRfc3RhcnR0bHNfZG9uZSA9IDA7IC8q
IGhhdmUgd2UgZG9uZSBhIHN1Y2Nlc3NmdWwgc3RhcnR0bHM/ICovCiBjb25zdCBjaGFyICpwbGFp
bnRleHRsb2dpbmFsZXJ0ID0gTlVMTDsKKwogI2lmZGVmIEhBVkVfU1NMCiAvKiBvdXIgdGxzIGNv
bm5lY3Rpb24sIGlmIGFueSAqLwogc3RhdGljIFNTTCAqdGxzX2Nvbm4gPSBOVUxMOwpAQCAtMTk0
LDYgKzE5Niw2MCBAQAogICAgIDMxLCAzMSwgMzAsIDMxLCAzMCwgMzEKIH07CiAKK3N0YXRpYyBz
dHJ1Y3QgbWJveF9uYW1lX2F0dHJpYnV0ZSB7CisgICAgaW50IGZsYWc7CisgICAgY2hhciAqaWQ7
Cit9IG1ib3hfbmFtZV9hdHRyaWJ1dGVzW10gPSB7CisgICAgLyogZnJvbSBSRkMgMzUwMSAqLwor
ICAgIHsgTUJPWF9BVFRSSUJVVEVfTk9JTkZFUklPUlMsICAgIlxcTm9pbmZlcmlvcnMiICAgfSwK
KyAgICB7IE1CT1hfQVRUUklCVVRFX05PU0VMRUNULCAgICAgICJcXE5vc2VsZWN0IiAgICAgIH0s
CisgICAgeyBNQk9YX0FUVFJJQlVURV9NQVJLRUQsICAgICAgICAiXFxNYXJrZWQiICAgICAgICB9
LAorICAgIHsgTUJPWF9BVFRSSUJVVEVfVU5NQVJLRUQsICAgICAgIlxcVW5tYXJrZWQiICAgICAg
fSwKKworICAgIC8qIGZyb20gZHJhZnQtaWV0Zi1pbWFwZXh0LWxpc3QtZXh0ZW5zaW9ucy0xNy50
eHQgKi8KKyAgICB7IE1CT1hfQVRUUklCVVRFX05PTkVYSVNURU5ULCAgICJcXE5vbkV4aXN0ZW50
IiAgIH0sCisgICAgeyBNQk9YX0FUVFJJQlVURV9TVUJTQ1JJQkVELCAgICAiXFxTdWJzY3JpYmVk
IiAgICB9LAorICAgIHsgTUJPWF9BVFRSSUJVVEVfUkVNT1RFLCAgICAgICAgIlxcUmVtb3RlIiAg
ICAgICAgfSwKKyAgICB7IE1CT1hfQVRUUklCVVRFX0hBU0NISUxEUkVOLCAgICJcXEhhc0NoaWxk
cmVuIiAgIH0sCisgICAgeyBNQk9YX0FUVFJJQlVURV9IQVNOT0NISUxEUkVOLCAiXFxIYXNOb0No
aWxkcmVuIiB9LAorCisgICAgeyAwLCBOVUxMIH0KK307CisKKy8qCisgKiBUaGVzZSBiaXRtYXNr
cyBkZWZpbmUgaG93IExpc3Qgc2VsZWN0aW9uIG9wdGlvbnMgY2FuIGJlIGNvbWJpbmVkOgorICog
bGlzdF9zZWxlY3RfbW9kX29wdHMgbWF5IG9ubHkgYmUgdXNlZCBpZiBhdCBsZWFzdCBvbmUgbGlz
dF9zZWxlY3RfYmFzZV9vcHQKKyAqIGlzIGFsc28gcHJlc2VudC4KKyAqIEZvciBleGFtcGxlLCAo
UkVDVVJTSVZFTUFUQ0gpIGFuZCAoUkVDVVJTSVZFTUFUQ0ggUkVNT1RFKSBhcmUgaW52YWxpZCwg
YnV0CisgKiAoUkVDVVJTSVZFTUFUQ0ggU1VCU0NSSUJFRCkgaXMgb2suCisgKi8KK3N0YXRpYyBj
b25zdCBpbnQgbGlzdF9zZWxlY3RfYmFzZV9vcHRzID0gTElTVF9TRUxfU1VCU0NSSUJFRDsKK3N0
YXRpYyBjb25zdCBpbnQgbGlzdF9zZWxlY3RfbW9kX29wdHMgPSBMSVNUX1NFTF9SRUNVUlNJVkVN
QVRDSDsKKworLyogc3RydWN0dXJlIHRoYXQgbGlzdF9kYXRhIHBhc3NlcyBpdHMgY2FsbGJhY2tz
ICovCitzdHJ1Y3QgbGlzdF9yb2NrIHsKKyAgICBpbnQgb3B0czsKKyAgICBjaGFyICpsYXN0X25h
bWU7CisgICAgaW50IGxhc3RfYXR0cmlidXRlczsKKyAgICBpbnQgdHJhaWxpbmdfcGVyY2VudDsg
LyogdGhlIG1haWxib3ggbmFtZSBhcmcgZW5kcyB3aXRoIGEgJQorICAgICAgICAgICAgICAgICAg
ICAgICAgICAgKiBjYXVzZXMgc3BlY2lhbCBiZWhhdmlvciB3aXRoIG5vbi1leHRlbmRlZCBMSVNU
CisJCQkgICAqIGFuZCBMU1VCICovCit9OworCisvKiBJbmZvcm1hdGlvbiBhYm91dCBvbmUgbWFp
bGJveCBuYW1lIHRoYXQgTElTVCByZXR1cm5zICovCitzdHJ1Y3QgbGlzdF9lbnRyeSB7CisgICAg
Y2hhciAqbmFtZTsKKyAgICBpbnQgYXR0cmlidXRlczsgLyogYml0bWFwIG9mIE1CT1hfQVRUUklC
VVRFXyogKi8KK307CisKKy8qIHN0cnVjdHVyZSB0aGF0IGxpc3RfZGF0YV9yZWN1cnNpdmVtYXRj
aCBwYXNzZXMgaXRzIGNhbGxiYWNrcyAqLworc3RydWN0IGxpc3Rfcm9ja19yZWN1cnNpdmVtYXRj
aCB7CisgICAgaW50IG9wdHM7CisgICAgc3RydWN0IGhhc2hfdGFibGUgdGFibGU7ICAgIC8qIG1h
cHMgbWFpbGJveCBuYW1lcyB0byBhdHRyaWJ1dGVzIChpbnQgKikgKi8KKyAgICBpbnQgY291bnQ7
ICAgICAgICAgICAgICAgICAgLyogIyBvZiBlbnRyaWVzIGluIHRhYmxlICovCisgICAgc3RydWN0
IGxpc3RfZW50cnkgKmFycmF5OworfTsKKwogdm9pZCBtb3RkX2ZpbGUoaW50IGZkKTsKIHZvaWQg
c2h1dF9kb3duKGludCBjb2RlKTsKIHZvaWQgZmF0YWwoY29uc3QgY2hhciAqcywgaW50IGNvZGUp
OwpAQCAtMjI1LDYgKzI4MSw5IEBACiB2b2lkIGNtZF9yZWNvbnN0cnVjdChjb25zdCBjaGFyICp0
YWcsIGNvbnN0IGNoYXIgKm5hbWUsIGludCByZWN1cnNpdmUpOwogdm9pZCBjbWRfZmluZChjaGFy
ICp0YWcsIGNoYXIgKm5hbWVzcGFjZSwgY2hhciAqcGF0dGVybik7CiB2b2lkIGNtZF9saXN0KGNo
YXIgKnRhZywgaW50IGxpc3RvcHRzLCBjaGFyICpyZWZlcmVuY2UsIGNoYXIgKnBhdHRlcm4pOwor
dm9pZCBwYXJzZV9saXN0KGNoYXIgKnRhZyk7Cit2b2lkIGRvX2xpc3QoY2hhciAqdGFnLCBpbnQg
bGlzdG9wdHMsIGNoYXIgKnJlZmVyZW5jZSwKKwkgICAgIHN0cnVjdCBzdHJsaXN0ICpwYXR0ZXJu
cyk7CiB2b2lkIGNtZF9jaGFuZ2VzdWIoY2hhciAqdGFnLCBjaGFyICpuYW1lc3BhY2UsIGNoYXIg
Km5hbWUsIGludCBhZGQpOwogdm9pZCBjbWRfZ2V0YWNsKGNvbnN0IGNoYXIgKnRhZywgY29uc3Qg
Y2hhciAqbmFtZSk7CiB2b2lkIGNtZF9saXN0cmlnaHRzKGNoYXIgKnRhZywgY2hhciAqbmFtZSwg
Y2hhciAqaWRlbnRpZmllcik7CkBAIC0yNjYsOCArMzI1LDkgQEAKIAogdm9pZCBhbm5vdGF0ZV9y
ZXNwb25zZShzdHJ1Y3QgZW50cnlhdHRsaXN0ICpsKTsKIAotI2lmZGVmIEVOQUJMRV9MSVNURVhU
Ci1pbnQgZ2V0bGlzdG9wdHMoY2hhciAqdGFnLCBpbnQgKmxpc3RvcHRzKTsKKyNpZmRlZiBFTkFC
TEVfTElTVF9FWFRFTkRFRAoraW50IGdldGxpc3RzZWxvcHRzKGNoYXIgKnRhZywgaW50ICpvcHRz
KTsKK2ludCBnZXRsaXN0cmV0b3B0cyhjaGFyICp0YWcsIGludCAqb3B0cyk7CiAjZW5kaWYKIAog
aW50IGdldHNlYXJjaHByb2dyYW0oY2hhciAqdGFnLCBzdHJ1Y3Qgc2VhcmNoYXJncyAqc2VhcmNo
YXJncywKQEAgLTI5Miw5ICszNTIsMjEgQEAKIHN0YXRpYyB2b2lkIGZyZWVzb3J0Y3JpdChzdHJ1
Y3Qgc29ydGNyaXQgKnMpOwogCiBzdGF0aWMgaW50IG1haWxib3hkYXRhKGNoYXIgKm5hbWUsIGlu
dCBtYXRjaGxlbiwgaW50IG1heWNyZWF0ZSwgdm9pZCAqcm9jayk7Ci1zdGF0aWMgaW50IGxpc3Rk
YXRhKGNoYXIgKm5hbWUsIGludCBtYXRjaGxlbiwgaW50IG1heWNyZWF0ZSwgdm9pZCAqcm9jayk7
Ci1zdGF0aWMgdm9pZCBtc3RyaW5nZGF0YShjaGFyICpjbWQsIGNoYXIgKm5hbWUsIGludCBtYXRj
aGxlbiwgaW50IG1heWNyZWF0ZSwKLQkJCWludCBsaXN0b3B0cyk7CisKK3N0YXRpYyBpbnQgc2V0
X2hhc2NoaWxkcmVuKGNoYXIgKm5hbWUsIGludCBtYXRjaGxlbiwgaW50IG1heWNyZWF0ZSwKKwkJ
CSAgIGludCAqYXR0cmlidXRlcyk7CitzdGF0aWMgdm9pZCBsaXN0X3Jlc3BvbnNlKGNoYXIgKm5h
bWUsIGludCBhdHRyaWJ1dGVzLCBpbnQgb3B0cyk7CitzdGF0aWMgaW50IHNldF9zdWJzY3JpYmVk
KGNoYXIgKm5hbWUsIGludCBtYXRjaGxlbiwgaW50IG1heWNyZWF0ZSwKKwkJCSAgaW50ICphdHRy
aWJ1dGVzKTsKK3N0YXRpYyBjaGFyICpjYW5vbmljYWxfbGlzdF9wYXR0ZXJuKGNvbnN0IGNoYXIg
KnJlZmVyZW5jZSwgY29uc3QgY2hhciAqcGF0dGVybik7CitzdGF0aWMgdm9pZCBjYW5vbmljYWxf
bGlzdF9wYXR0ZXJucyhjaGFyICpyZWZlcmVuY2UsIHN0cnVjdCBzdHJsaXN0ICpwYXR0ZXJucyk7
CitzdGF0aWMgaW50IGxpc3RfY2IoY2hhciAqbmFtZSwgaW50IG1hdGNobGVuLCBpbnQgbWF5Y3Jl
YXRlLAorCQkgIHN0cnVjdCBsaXN0X3JvY2sgKnJvY2spOworc3RhdGljIGludCBzdWJzY3JpYmVk
X2NiKGNoYXIgKm5hbWUsIGludCBtYXRjaGxlbiwgaW50IG1heWNyZWF0ZSwKKwkJCSBzdHJ1Y3Qg
bGlzdF9yb2NrICpyb2NrKTsKK3N0YXRpYyB2b2lkIGxpc3RfZGF0YShjaGFyICpyZWZlcmVuY2Us
IGludCBsaXN0b3B0cywgc3RydWN0IHN0cmxpc3QgKnBhdHRlcm5zKTsKK3N0YXRpYyB2b2lkIGxp
c3RfZGF0YV9yZW1vdGUoY2hhciAqdGFnLCBpbnQgbGlzdG9wdHMsIGNoYXIgKnJlZmVyZW5jZSwK
KwkJCSAgICAgc3RydWN0IHN0cmxpc3QgKnBhdHRlcm4pOwogCiBleHRlcm4gdm9pZCBzZXRwcm9j
dGl0bGVfaW5pdChpbnQgYXJnYywgY2hhciAqKmFyZ3YsIGNoYXIgKiplbnZwKTsKIGV4dGVybiBp
bnQgcHJvY19yZWdpc3Rlcihjb25zdCBjaGFyICpwcm9nbmFtZSwgY29uc3QgY2hhciAqY2xpZW50
aG9zdCwgCkBAIC0xMzU2LDI3ICsxNDI4LDEwIEBACiAJICAgIH0KIAkgICAgZWxzZSBpZiAoIWlt
YXBkX3VzZXJpZCkgZ290byBub2xvZ2luOwogCSAgICBlbHNlIGlmICghc3RyY21wKGNtZC5zLCAi
TGlzdCIpKSB7Ci0JCWludCBsaXN0b3B0cyA9IExJU1RfQ0hJTERSRU47Ci0jaWZkZWYgRU5BQkxF
X0xJU1RFWFQKLQkJLyogQ2hlY2sgZm9yIGFuZCBwYXJzZSBMSVNURVhUIG9wdGlvbnMgKi8KLQkJ
YyA9IHByb3RfZ2V0YyhpbWFwZF9pbik7Ci0JCWlmIChjID09ICcoJykgewotCQkgICAgYyA9IGdl
dGxpc3RvcHRzKHRhZy5zLCAmbGlzdG9wdHMpOwotCQkgICAgaWYgKGMgPT0gRU9GKSB7Ci0JCQll
YXRsaW5lKGltYXBkX2luLCBjKTsKLQkJCWNvbnRpbnVlOwotCQkgICAgfQotCQl9Ci0JCWVsc2UK
LQkJICAgIHByb3RfdW5nZXRjKGMsIGltYXBkX2luKTsKLSNlbmRpZiAvKiBFTkFCTEVfTElTVEVY
VCAqLwotCQlpZiAoaW1hcGRfbWFnaWNwbHVzKSBsaXN0b3B0cyArPSBMSVNUX1NVQlNDUklCRUQ7
Ci0JCWMgPSBnZXRhc3RyaW5nKGltYXBkX2luLCBpbWFwZF9vdXQsICZhcmcxKTsKLQkJaWYgKGMg
IT0gJyAnKSBnb3RvIG1pc3NpbmdhcmdzOwotCQljID0gZ2V0YXN0cmluZyhpbWFwZF9pbiwgaW1h
cGRfb3V0LCAmYXJnMik7Ci0JCWlmIChjID09ICdccicpIGMgPSBwcm90X2dldGMoaW1hcGRfaW4p
OwotCQlpZiAoYyAhPSAnXG4nKSBnb3RvIGV4dHJhYXJnczsKLQkJY21kX2xpc3QodGFnLnMsIGxp
c3RvcHRzLCBhcmcxLnMsIGFyZzIucyk7CisJCWlmIChjICE9ICcgJykKKwkJICAgIGdvdG8gbWlz
c2luZ2FyZ3M7CisKKwkJcGFyc2VfbGlzdCh0YWcucyk7CiAKIAkJc25tcF9pbmNyZW1lbnQoTElT
VF9DT1VOVCwgMSk7CiAJICAgIH0KQEAgLTEzODYsNyArMTQ0MSw4IEBACiAJCWMgPSBnZXRhc3Ry
aW5nKGltYXBkX2luLCBpbWFwZF9vdXQsICZhcmcyKTsKIAkJaWYgKGMgPT0gJ1xyJykgYyA9IHBy
b3RfZ2V0YyhpbWFwZF9pbik7CiAJCWlmIChjICE9ICdcbicpIGdvdG8gZXh0cmFhcmdzOwotCQlj
bWRfbGlzdCh0YWcucywgTElTVF9MU1VCIHwgTElTVF9DSElMRFJFTiwgYXJnMS5zLCBhcmcyLnMp
OworCQljbWRfbGlzdCh0YWcucywgTElTVF9PUFRfTFNVQiB8IExJU1RfU0VMX1NVQlNDUklCRUQs
CisJCQkgYXJnMS5zLCBhcmcyLnMpOwogCiAJCXNubXBfaW5jcmVtZW50KExTVUJfQ09VTlQsIDEp
OwogCSAgICB9CkBAIC0xNTU4LDcgKzE2MTQsOSBAQAogCQljID0gZ2V0YXN0cmluZyhpbWFwZF9p
biwgaW1hcGRfb3V0LCAmYXJnMik7CiAJCWlmIChjID09ICdccicpIGMgPSBwcm90X2dldGMoaW1h
cGRfaW4pOwogCQlpZiAoYyAhPSAnXG4nKSBnb3RvIGV4dHJhYXJnczsKLQkJY21kX2xpc3QodGFn
LnMsIExJU1RfQ0hJTERSRU4gfCBMSVNUX1JFTU9URSwgYXJnMS5zLCBhcmcyLnMpOworCQljbWRf
bGlzdCh0YWcucywKKwkJCSBMSVNUX09QVF9STElTVCB8IExJU1RfU0VMX1JFTU9URSB8IExJU1Rf
UkVUX0NISUxEUkVOLAorCQkJIGFyZzEucywgYXJnMi5zKTsKIAogLyogCQlzbm1wX2luY3JlbWVu
dChMSVNUX0NPVU5ULCAxKTsgKi8KIAkgICAgfQpAQCAtMTU2OCw4ICsxNjI2LDExIEBACiAJCWMg
PSBnZXRhc3RyaW5nKGltYXBkX2luLCBpbWFwZF9vdXQsICZhcmcyKTsKIAkJaWYgKGMgPT0gJ1xy
JykgYyA9IHByb3RfZ2V0YyhpbWFwZF9pbik7CiAJCWlmIChjICE9ICdcbicpIGdvdG8gZXh0cmFh
cmdzOwotCQljbWRfbGlzdCh0YWcucywgTElTVF9MU1VCIHwgTElTVF9DSElMRFJFTiB8IExJU1Rf
UkVNT1RFLAorCQljbWRfbGlzdCh0YWcucywKKwkJCSBMSVNUX09QVF9STElTVCB8IExJU1RfT1BU
X0xTVUIgfCBMSVNUX1NFTF9SRU1PVEUKKwkJCSB8IExJU1RfU0VMX1NVQlNDUklCRUQgfCBMSVNU
X1JFVF9DSElMRFJFTiwKIAkJCSBhcmcxLnMsIGFyZzIucyk7CisKIC8qIAkJc25tcF9pbmNyZW1l
bnQoTFNVQl9DT1VOVCwgMSk7ICovCiAJICAgIH0KICNpZmRlZiBIQVZFX1NTTApAQCAtMjU4Nyw5
ICsyNjQ4LDkgQEAKIAlwcm90X3ByaW50ZihpbWFwZF9vdXQsICIgSURMRSIpOwogICAgIH0KIAot
I2lmZGVmIEVOQUJMRV9MSVNURVhUCi0gICAgcHJvdF9wcmludGYoaW1hcGRfb3V0LCAiIExJU1RF
WFQgTElTVC1TVUJTQ1JJQkVEIik7Ci0jZW5kaWYgLyogRU5BQkxFX0xJU1RFWFQgKi8KKyNpZmRl
ZiBFTkFCTEVfTElTVF9FWFRFTkRFRAorICAgIHByb3RfcHJpbnRmKGltYXBkX291dCwgIiBMSVNU
RVhUIExJU1QtU1VCU0NSSUJFRCBMSVNULUVYVEVOREVEIik7CisjZW5kaWYKIAogI2lmZGVmIEVO
QUJMRV9YX05FVFNDQVBFX0hBQ0sKICAgICBwcm90X3ByaW50ZihpbWFwZF9vdXQsICIgWC1ORVRT
Q0FQRSIpOwpAQCAtNTY3MiwxMzUgKzU3MzMsMTc0IEBACiAJCWVycm9yX21lc3NhZ2UoSU1BUF9P
S19DT01QTEVURUQpKTsKIH0KIAotc3RhdGljIGludCBtc3RyaW5nZGF0YWNhbGxzOworLyogbm8g
dGltZXMgdGhlIGNhbGxiYWNrcyBmb3IgZmluZGFsbC9maW5kc3ViIGhhdmUgYmVlbiBjYWxsZWQg
Ki8KK3N0YXRpYyBpbnQgbGlzdF9jYWxsYmFja19jYWxsczsKIAogLyoKLSAqIFBlcmZvcm0gYSBM
SVNUIG9yIExTVUIgY29tbWFuZAorICogUGFyc2UgYW5kIHBlcmZvcm0gYSBMSVNUIGNvbW1hbmQu
CiAgKi8KLXZvaWQgY21kX2xpc3QoY2hhciAqdGFnLCBpbnQgbGlzdG9wdHMsIGNoYXIgKnJlZmVy
ZW5jZSwgY2hhciAqcGF0dGVybikKK3ZvaWQgcGFyc2VfbGlzdChjaGFyICp0YWcpCiB7Ci0gICAg
Y2hhciAqYnVmID0gTlVMTDsKLSAgICBpbnQgcGF0bGVuID0gMDsKLSAgICBpbnQgcmVmbGVuID0g
MDsKLSAgICBzdGF0aWMgaW50IGlnbm9yZXJlZmVyZW5jZSA9IDA7Ci0gICAgY2xvY2tfdCBzdGFy
dCA9IGNsb2NrKCk7Ci0gICAgY2hhciBteXRpbWVbMTAwXTsKLSAgICBpbnQgKCpmaW5kYWxsKShz
dHJ1Y3QgbmFtZXNwYWNlICpuYW1lc3BhY2UsCi0JCSAgIGNvbnN0IGNoYXIgKnBhdHRlcm4sIGlu
dCBpc2FkbWluLCBjaGFyICp1c2VyaWQsIAotCQkgICBzdHJ1Y3QgYXV0aF9zdGF0ZSAqYXV0aF9z
dGF0ZSwgaW50ICgqcHJvYykoKSwKLQkJICAgdm9pZCAqcm9jayk7Ci0gICAgaW50ICgqZmluZHN1
Yikoc3RydWN0IG5hbWVzcGFjZSAqbmFtZXNwYWNlLAotCQkgICBjb25zdCBjaGFyICpwYXR0ZXJu
LCBpbnQgaXNhZG1pbiwgY2hhciAqdXNlcmlkLCAKLQkJICAgc3RydWN0IGF1dGhfc3RhdGUgKmF1
dGhfc3RhdGUsIGludCAoKnByb2MpKCksCi0JCSAgIHZvaWQgKnJvY2ssIGludCBmb3JjZSk7Ci0K
LSAgICBpZiAobGlzdG9wdHMgJiBMSVNUX1JFTU9URSkgc3VwcG9ydHNfcmVmZXJyYWxzID0gIWRp
c2FibGVfcmVmZXJyYWxzOworICAgIGludCBsaXN0b3B0cyA9IDA7CisgICAgc3RhdGljIHN0cnVj
dCBidWYgYnVmOworICAgIGludCBjOworICAgIHN0cnVjdCBzdHJsaXN0ICpwYXR0ZXJucyA9IE5V
TEw7CisgICAgY2hhciAqcmVmZXJlbmNlOwogCi0gICAgLyogSWdub3JlIHRoZSByZWZlcmVuY2Ug
YXJndW1lbnQ/Ci0gICAgICAgKHRoZSBiZWhhdmlvciBpbiAxLjUuMTAgJiBvbGRlcikgKi8KLSAg
ICBpZiAoaWdub3JlcmVmZXJlbmNlID09IDApIHsKLQlpZ25vcmVyZWZlcmVuY2UgPSBjb25maWdf
Z2V0c3dpdGNoKElNQVBPUFRfSUdOT1JFUkVGRVJFTkNFKTsKKyNpZmRlZiBFTkFCTEVfTElTVF9F
WFRFTkRFRAorICAgIC8qIENoZWNrIGZvciBhbmQgcGFyc2UgTElTVEVYVCBzZWxlY3Rpb24gb3B0
aW9ucyAqLworICAgIGMgPSBwcm90X2dldGMoaW1hcGRfaW4pOworICAgIGlmIChjID09ICcoJykg
eworCWxpc3RvcHRzIHw9IExJU1RfT1BUX0VYVEVOREVEOworCWMgPSBnZXRsaXN0c2Vsb3B0cyh0
YWcsICZsaXN0b3B0cyk7CisJaWYgKGMgPT0gRU9GKSB7CisJICAgIGVhdGxpbmUoaW1hcGRfaW4s
IGMpOworCSAgICByZXR1cm47CisJfQogICAgIH0KKyAgICBlbHNlCisJcHJvdF91bmdldGMoYywg
aW1hcGRfaW4pOworI2VuZGlmCiAKLSAgICAvKiBSZXNldCBzdGF0ZSBpbiBtc3RyaW5nZGF0YSAq
LwotICAgIG1zdHJpbmdkYXRhKE5VTEwsIE5VTEwsIDAsIDAsIDApOworICAgIGlmIChpbWFwZF9t
YWdpY3BsdXMpIGxpc3RvcHRzIHw9IExJU1RfU0VMX1NVQlNDUklCRUQgfCBMSVNUX1JFVF9TVUJT
Q1JJQkVEOwogCi0gICAgaWYgKCFwYXR0ZXJuWzBdICYmICEobGlzdG9wdHMgJiBMSVNUX0xTVUIp
KSB7Ci0JLyogU3BlY2lhbCBjYXNlOiBxdWVyeSB0b3AtbGV2ZWwgaGllcmFyY2h5IHNlcGFyYXRv
ciAqLwotCXByb3RfcHJpbnRmKGltYXBkX291dCwgIiogTElTVCAoXFxOb3NlbGVjdCkgXCIlY1wi
IFwiXCJcclxuIiwKLQkJICAgIGltYXBkX25hbWVzcGFjZS5oaWVyX3NlcCk7Ci0gICAgfSBlbHNl
IGlmICgobGlzdG9wdHMgJiAoTElTVF9MU1VCIHwgTElTVF9TVUJTQ1JJQkVEKSkgJiYKLQkgICAg
ICAgKGJhY2tlbmRfaW5ib3ggfHwgKGJhY2tlbmRfaW5ib3ggPSBwcm94eV9maW5kaW5ib3hzZXJ2
ZXIoKSkpKSB7Ci0JLyogcmVtb3RlIElOQk9YICovCi0JaWYgKChsaXN0b3B0cyAmIExJU1RfU1VC
U0NSSUJFRCkgJiYgKGxpc3RvcHRzICYgTElTVF9FWFQpICYmCi0JICAgIENBUEEoYmFja2VuZF9p
bmJveCwgQ0FQQV9MSVNUU1VCU0NSSUJFRCkpIHsKLQkgICAgcHJvdF9wcmludGYoYmFja2VuZF9p
bmJveC0+b3V0LCAiJXMgTGlzdCAoc3Vic2NyaWJlZCIsIHRhZyk7Ci0JICAgIGlmIChsaXN0b3B0
cyAmIExJU1RfQ0hJTERSRU4pCi0JCXByb3RfcHJpbnRmKGJhY2tlbmRfaW5ib3gtPm91dCwgIiBj
aGlsZHJlbiIpOwotCSAgICBpZiAobGlzdG9wdHMgJiBMSVNUX1JFTU9URSkKLQkJcHJvdF9wcmlu
dGYoYmFja2VuZF9pbmJveC0+b3V0LCAiIHJlbW90ZSIpOwotCSAgICBwcm90X3ByaW50ZihiYWNr
ZW5kX2luYm94LT5vdXQsICIpICIpOwotCX0gZWxzZSB7Ci0JICAgIHByb3RfcHJpbnRmKGJhY2tl
bmRfaW5ib3gtPm91dCwgIiVzIExzdWIgIiwgdGFnKTsKKyAgICAvKiBSZWFkIGluIHJlZmVyZW5j
ZSBuYW1lICovCisgICAgYyA9IGdldGFzdHJpbmcoaW1hcGRfaW4sIGltYXBkX291dCwgJmJ1Zik7
CisgICAgaWYgKGMgPT0gRU9GICYmICEqYnVmLnMpIHsKKwlwcm90X3ByaW50ZihpbWFwZF9vdXQs
CisJCSAgICAiJXMgQkFEIE1pc3NpbmcgcmVxdWlyZWQgYXJndW1lbnQgdG8gTGlzdDogcmVmZXJl
bmNlIG5hbWVcclxuIiwKKwkJICAgIHRhZyk7CisJZWF0bGluZShpbWFwZF9pbiwgYyk7CisJcmV0
dXJuOworICAgIH0KKyAgICBpZiAoYyAhPSAnICcpIHsKKwlwcm90X3ByaW50ZihpbWFwZF9vdXQs
CisJCSAgICAiJXMgQkFEIE1pc3NpbmcgcmVxdWlyZWQgYXJndW1lbnQgdG8gTGlzdDogbWFpbGJv
eCBwYXR0ZXJuXHJcbiIsIHRhZyk7CisJZWF0bGluZShpbWFwZF9pbiwgYyk7CisJcmV0dXJuOwor
ICAgIH0KKyAgICByZWZlcmVuY2UgPSB4c3RyZHVwKGJ1Zi5zKTsKKworICAgIC8qIFJlYWQgaW4g
bWFpbGJveCBwYXR0ZXJuKHMpICovCisjaWZkZWYgRU5BQkxFX0xJU1RfRVhURU5ERUQKKyAgICBj
ID0gcHJvdF9nZXRjKGltYXBkX2luKTsKKyAgICBpZiAoYyA9PSAnKCcpIHsKKwlsaXN0b3B0cyB8
PSBMSVNUX09QVF9FWFRFTkRFRCB8IExJU1RfT1BUX0VYVEVOREVEX1YxNzsKKwlmb3IgKDs7KSB7
CisJICAgIGMgPSBnZXRhc3RyaW5nKGltYXBkX2luLCBpbWFwZF9vdXQsICZidWYpOworCSAgICBp
ZiAoKmJ1Zi5zKQorCQlhcHBlbmRzdHJsaXN0KCZwYXR0ZXJucywgYnVmLnMpOworCSAgICBpZiAo
YyAhPSAnICcpIGJyZWFrOwogCX0KLQlwcm90X3ByaW50ZihiYWNrZW5kX2luYm94LT5vdXQsIAot
CQkgICAgInslZCt9XHJcbiVzIHslZCt9XHJcbiVzXHJcbiIsCi0JCSAgICBzdHJsZW4ocmVmZXJl
bmNlKSwgcmVmZXJlbmNlLAotCQkgICAgc3RybGVuKHBhdHRlcm4pLCBwYXR0ZXJuKTsKLQlwaXBl
X2xzdWIoYmFja2VuZF9pbmJveCwgdGFnLCAwLCAobGlzdG9wdHMgJiBMSVNUX0xTVUIpID8gIkxT
VUIiIDogIkxJU1QiKTsKLSAgICB9IGVsc2UgewotCS8qIERvIHdlIG5lZWQgdG8gY29uY2F0ZW5h
dGUgZmllbGRzPyAqLwotCWlmICghaWdub3JlcmVmZXJlbmNlIHx8IHBhdHRlcm5bMF0gPT0gaW1h
cGRfbmFtZXNwYWNlLmhpZXJfc2VwKSB7Ci0JICAgIC8qIEVpdGhlcgotCSAgICAgKiAtIG5hbWUg
YmVnaW5zIHdpdGggZG90Ci0JICAgICAqIC0gd2UncmUgY29uZmlndXJlZCB0byBob25vciB0aGUg
cmVmZXJlbmNlIGFyZ3VtZW50ICovCi0KLQkgICAgLyogQWxsb2NhdGUgYSBidWZmZXIsIGZpZ3Vy
ZSBvdXQgaG93IHRvIHN0aWNrIHRoZSBhcmd1bWVudHMKLQkgICAgICAgdG9nZXRoZXIsIGRvIGl0
LCB0aGVuIGRvIHRoYXQgaW5zdGVhZCBvZiB1c2luZyBwYXR0ZXJuLiAqLwotCSAgICBwYXRsZW4g
PSBzdHJsZW4ocGF0dGVybik7Ci0JICAgIHJlZmxlbiA9IHN0cmxlbihyZWZlcmVuY2UpOwotCSAg
ICAKLQkgICAgYnVmID0geG1hbGxvYyhwYXRsZW4gKyByZWZsZW4gKyAxKTsKLQkgICAgYnVmWzBd
ID0gJ1wwJzsKKwlpZiAoYyAhPSAnKScpIHsKKwkgICAgcHJvdF9wcmludGYoaW1hcGRfb3V0LAor
CQkJIiVzIEJBRCBJbnZhbGlkIHN5bnRheCBpbiBMaXN0IGNvbW1hbmRcclxuIiwgdGFnKTsKKwkg
ICAgZWF0bGluZShpbWFwZF9pbiwgYyk7CisJICAgIGdvdG8gZnJlZWFyZ3M7CisJfQorCWMgPSBw
cm90X2dldGMoaW1hcGRfaW4pOworICAgIH0KKyAgICBlbHNlIHsKKwlwcm90X3VuZ2V0YyhjLCBp
bWFwZF9pbik7CisjZW5kaWYKKyAgICAJYyA9IGdldGFzdHJpbmcoaW1hcGRfaW4sIGltYXBkX291
dCwgJmJ1Zik7CisJaWYgKGMgPT0gRU9GKSB7CisJICAgIHByb3RfcHJpbnRmKGltYXBkX291dCwK
KwkJCSIlcyBCQUQgTWlzc2luZyByZXF1aXJlZCBhcmd1bWVudCB0byBMaXN0OiBtYWlsYm94IHBh
dHRlcm5cclxuIiwKKwkJCXRhZyk7CisJICAgIGVhdGxpbmUoaW1hcGRfaW4sIGMpOworCSAgICBn
b3RvIGZyZWVhcmdzOworCX0KKwlhcHBlbmRzdHJsaXN0KCZwYXR0ZXJucywgYnVmLnMpOworI2lm
ZGVmIEVOQUJMRV9MSVNUX0VYVEVOREVECisgICAgfQorI2VuZGlmCiAKLQkgICAgaWYgKCpyZWZl
cmVuY2UpIHsKLQkJLyogY2hlY2sgZm9yIExJU1QgQS4gLkIsIGNoYW5nZSB0byBMSVNUICIiIEEu
QiAqLwotCQlpZiAocmVmZXJlbmNlW3JlZmxlbi0xXSA9PSBpbWFwZF9uYW1lc3BhY2UuaGllcl9z
ZXAgJiYKLQkJICAgIHBhdHRlcm5bMF0gPT0gaW1hcGRfbmFtZXNwYWNlLmhpZXJfc2VwKSB7Ci0J
CSAgICByZWZlcmVuY2VbLS1yZWZsZW5dID0gJ1wwJzsKLQkJfQotCQlzdHJjcHkoYnVmLCByZWZl
cmVuY2UpOwotCSAgICB9Ci0JICAgIHN0cmNhdChidWYsIHBhdHRlcm4pOwotCSAgICBwYXR0ZXJu
ID0gYnVmOworI2lmZGVmIEVOQUJMRV9MSVNUX0VYVEVOREVECisgICAgLyogQ2hlY2sgZm9yIGFu
ZCBwYXJzZSBMSVNURVhUIHJldHVybiBvcHRpb25zICovCisgICAgaWYgKGMgPT0gJyAnKSB7CisJ
bGlzdG9wdHMgfD0gTElTVF9PUFRfRVhURU5ERUQgfCBMSVNUX09QVF9FWFRFTkRFRF9WMTc7CisJ
YyA9IGdldGxpc3RyZXRvcHRzKHRhZywgJmxpc3RvcHRzKTsKKwlpZiAoYyA9PSBFT0YpIHsKKwkg
ICAgZWF0bGluZShpbWFwZF9pbiwgYyk7CisJICAgIGdvdG8gZnJlZWFyZ3M7CiAJfQorICAgIH0K
KyNlbmRpZgogCi0JLyogVHJhbnNsYXRlIGFueSBzZXBhcmF0b3JzIGluIHBhdHRlcm4gKi8KLQlt
Ym94bmFtZV9oaWVyc2VwX3RvaW50ZXJuYWwoJmltYXBkX25hbWVzcGFjZSwgcGF0dGVybiwKLQkJ
CQkgICAgY29uZmlnX3ZpcnRkb21haW5zID8KLQkJCQkgICAgc3RyY3NwbihwYXR0ZXJuLCAiQCIp
IDogMCk7CisgICAgLyogY2hlY2sgZm9yIENSTEYgKi8KKyAgICBpZiAoYyA9PSAnXHInKSBjID0g
cHJvdF9nZXRjKGltYXBkX2luKTsKKyAgICBpZiAoYyAhPSAnXG4nKSB7CisJcHJvdF9wcmludGYo
aW1hcGRfb3V0LAorCQkgICAgIiVzIEJBRCBVbmV4cGVjdGVkIGV4dHJhIGFyZ3VtZW50cyB0byBM
aXN0XHJcbiIsIHRhZyk7CisJZWF0bGluZShpbWFwZF9pbiwgYyk7CisJZ290byBmcmVlYXJnczsK
KyAgICB9CiAKLQkvKiBDaGVjayB0byBzZWUgaWYgd2Ugc2hvdWxkIG9ubHkgbGlzdCB0aGUgcGVy
c29uYWwgbmFtZXNwYWNlICovCi0JaWYgKCFzdHJjbXAocGF0dGVybiwgIioiKQotCSAgICAmJiBj
b25maWdfZ2V0c3dpdGNoKElNQVBPUFRfRk9PTFNUVVBJRENMSUVOVFMpKSB7Ci0JICAgIGlmIChi
dWYpIGZyZWUoYnVmKTsKLQkgICAgYnVmID0geHN0cmR1cCgiSU5CT1gqIik7Ci0JICAgIHBhdHRl
cm4gPSBidWY7Ci0JICAgIGZpbmRzdWIgPSBtYm94bGlzdF9maW5kc3ViOwotCSAgICBmaW5kYWxs
ID0gbWJveGxpc3RfZmluZGFsbDsKLQl9Ci0JZWxzZSB7Ci0JICAgIGZpbmRzdWIgPSBpbWFwZF9u
YW1lc3BhY2UubWJveGxpc3RfZmluZHN1YjsKLQkgICAgZmluZGFsbCA9IGltYXBkX25hbWVzcGFj
ZS5tYm94bGlzdF9maW5kYWxsOwotCX0KKyAgICBpZiAobGlzdG9wdHMgJiBMSVNUX09QVF9FWFRF
TkRFRF9WMDMgJiYgbGlzdG9wdHMgJiBMSVNUX09QVF9FWFRFTkRFRF9WMTcpIHsKKwkvKiBjbGll
bnQgbWl4ZWQgZGlmZmVyZW50IGxpc3RleHQgdmVyc2lvbnMgKi8KKwlwcm90X3ByaW50ZihpbWFw
ZF9vdXQsCisJCSAgICAiJXMgQkFEIEludmFsaWQgc3ludGF4IGluIGV4dGVuZGVkIExpc3QgY29t
bWFuZFxyXG4iLCB0YWcpOworCWdvdG8gZnJlZWFyZ3M7CisgICAgfQogCi0JaWYgKGxpc3RvcHRz
ICYgKExJU1RfTFNVQiB8IExJU1RfU1VCU0NSSUJFRCkpIHsKLQkgICAgaW50IGZvcmNlID0gY29u
ZmlnX2dldHN3aXRjaChJTUFQT1BUX0FMTE9XQUxMU1VCU0NSSUJFKTsKKyAgICBkb19saXN0KHRh
ZywgbGlzdG9wdHMsIHJlZmVyZW5jZSwgcGF0dGVybnMpOwogCi0JICAgICgqZmluZHN1YikoJmlt
YXBkX25hbWVzcGFjZSwgcGF0dGVybiwKLQkJICAgICAgIGltYXBkX3VzZXJpc2FkbWluLCBpbWFw
ZF91c2VyaWQsIGltYXBkX2F1dGhzdGF0ZSwKLQkJICAgICAgIGxpc3RkYXRhLCAmbGlzdG9wdHMs
IGZvcmNlKTsKLQl9Ci0JZWxzZSB7Ci0JICAgICgqZmluZGFsbCkoJmltYXBkX25hbWVzcGFjZSwg
cGF0dGVybiwKLQkJICAgICAgIGltYXBkX3VzZXJpc2FkbWluLCBpbWFwZF91c2VyaWQsIGltYXBk
X2F1dGhzdGF0ZSwKLQkJICAgICAgIGxpc3RkYXRhLCAmbGlzdG9wdHMpOwotCX0KKyAgZnJlZWFy
Z3M6CisgICAgZnJlZXN0cmxpc3QocGF0dGVybnMpOworICAgIGZyZWUocmVmZXJlbmNlKTsKKyAg
ICByZXR1cm47Cit9CiAKLQlsaXN0ZGF0YSgoY2hhciAqKTAsIDAsIDAsICZsaXN0b3B0cyk7Cisv
KiBBIHdyYXBwZXIgZm9yIGRvX2xpc3QuICovCit2b2lkIGNtZF9saXN0KGNoYXIgKnRhZywgaW50
IGxpc3RvcHRzLCBjaGFyICpyZWZlcmVuY2UsIGNoYXIgKnBhdHRlcm4pCit7CisgICAgY2hhciAq
bmV3X3BhdHRlcm4gPSB4c3RyZHVwKHBhdHRlcm4pOworICAgIHN0cnVjdCBzdHJsaXN0IHN0cmxp
c3QgPSB7IG5ld19wYXR0ZXJuLCBOVUxMLCBOVUxMLCBOVUxMIH07CisgICAgZG9fbGlzdCh0YWcs
IGxpc3RvcHRzLCByZWZlcmVuY2UsICZzdHJsaXN0KTsKKyAgICBmcmVlKHN0cmxpc3Qucyk7Cit9
CisKKy8qCisgKiBQZXJmb3JtIGEgTElTVCwgTFNVQiwgUkxJU1Qgb3IgUkxTVUIgY29tbWFuZAor
ICovCit2b2lkIGRvX2xpc3QoY2hhciAqdGFnLCBpbnQgbGlzdG9wdHMsIGNoYXIgKnJlZmVyZW5j
ZSwKKwkgICAgIHN0cnVjdCBzdHJsaXN0ICpwYXR0ZXJucykKK3sKKyAgICBjbG9ja190IHN0YXJ0
ID0gY2xvY2soKTsKKyAgICBjaGFyIG15dGltZVsxMDBdOworCisgICAgaWYgKGxpc3RvcHRzICYg
TElTVF9TRUxfUkVNT1RFKSBzdXBwb3J0c19yZWZlcnJhbHMgPSAhZGlzYWJsZV9yZWZlcnJhbHM7
CisKKyAgICBsaXN0X2NhbGxiYWNrX2NhbGxzID0gMDsKIAotCWlmIChidWYpIGZyZWUoYnVmKTsK
KyAgICBpZiAoIShsaXN0b3B0cyAmIExJU1RfT1BUX0xTVUIpCisJICAgICYmICEobGlzdG9wdHMg
JiBMSVNUX09QVF9FWFRFTkRFRCkKKwkgICAgJiYgISpwYXR0ZXJucy0+cykgeworCS8qIHNwZWNp
YWwgY2FzZTogcXVlcnkgdG9wLWxldmVsIGhpZXJhcmNoeSBzZXBhcmF0b3IgKi8KKwlwcm90X3By
aW50ZihpbWFwZF9vdXQsICIqICVzTElTVCAoXFxOb3NlbGVjdCkgXCIlY1wiIFwiXCJcclxuIiwK
KwkJICAgIChsaXN0b3B0cyAmIExJU1RfT1BUX1JMSVNUKSA/ICJSIiA6ICIiLAorCQkgICAgaW1h
cGRfbmFtZXNwYWNlLmhpZXJfc2VwKTsKKyAgICB9IGVsc2UgaWYgKGxpc3RvcHRzICYgKExJU1Rf
U0VMX1NVQlNDUklCRUQgfCBMSVNUX1JFVF9TVUJTQ1JJQkVEKQorCSAgICAmJiAoYmFja2VuZF9p
bmJveCB8fCAoYmFja2VuZF9pbmJveCA9IHByb3h5X2ZpbmRpbmJveHNlcnZlcigpKSkpIHsKKwkv
KiByZW1vdGUgaW5ib3ggKi8KKwlsaXN0X2RhdGFfcmVtb3RlKHRhZywgbGlzdG9wdHMsIHJlZmVy
ZW5jZSwgcGF0dGVybnMpOworICAgIH0gZWxzZSB7CisJbGlzdF9kYXRhKHJlZmVyZW5jZSwgbGlz
dG9wdHMsIHBhdHRlcm5zKTsKICAgICB9CiAKLSAgICBpbWFwZF9jaGVjayghKGxpc3RvcHRzICYg
KExJU1RfTFNVQiB8IExJU1RfU1VCU0NSSUJFRCkpID8KLQkJYmFja2VuZF9pbmJveCA6IE5VTEws
IDAsIDApOworICAgIGltYXBkX2NoZWNrKChsaXN0b3B0cyAmIExJU1RfU0VMX1NVQlNDUklCRUQp
ID8gIE5VTEwgOiBiYWNrZW5kX2luYm94LAorCQkwLCAwKTsKIAogICAgIHNucHJpbnRmKG15dGlt
ZSwgc2l6ZW9mKG15dGltZSksICIlMi4zZiIsCiAJICAgICAoY2xvY2soKSAtIHN0YXJ0KSAvIChk
b3VibGUpIENMT0NLU19QRVJfU0VDKTsKLSAgICBwcm90X3ByaW50ZihpbWFwZF9vdXQsICIlcyBP
SyAlcyAoJXMgc2VjcyAlZCBjYWxscylcclxuIiwgdGFnLAotCQllcnJvcl9tZXNzYWdlKElNQVBf
T0tfQ09NUExFVEVEKSwgbXl0aW1lLCBtc3RyaW5nZGF0YWNhbGxzKTsKKyAgICBwcm90X3ByaW50
ZihpbWFwZF9vdXQsICIlcyBPSyAlcyAoJXMgc2VjcyIsIHRhZywKKwkJZXJyb3JfbWVzc2FnZShJ
TUFQX09LX0NPTVBMRVRFRCksIG15dGltZSk7CisgICAgaWYgKGxpc3RfY2FsbGJhY2tfY2FsbHMp
CisJcHJvdF9wcmludGYoaW1hcGRfb3V0LCAiICV1IGNhbGxzIiwgbGlzdF9jYWxsYmFja19jYWxs
cyk7CisgICAgcHJvdF9wcmludGYoaW1hcGRfb3V0LCAiKVxyXG4iKTsKIH0KLSAgCisKIC8qCiAg
KiBQZXJmb3JtIGEgU1VCU0NSSUJFIChhZGQgaXMgbm9uemVybykgb3IKICAqIFVOU1VCU0NSSUJF
IChhZGQgaXMgemVybykgY29tbWFuZApAQCAtODcwNiwzNSArODgwNiwxMjAgQEAKICNlbmRpZgog
fQogCi0jaWZkZWYgRU5BQkxFX0xJU1RFWFQKKyNpZmRlZiBFTkFCTEVfTElTVF9FWFRFTkRFRAog
LyoKLSAqIFBhcnNlIExJU1Qgb3B0aW9ucy4KKyAqIFBhcnNlIExJU1Qgc2VsZWN0aW9uIG9wdGlv
bnMuCiAgKiBUaGUgY29tbWFuZCBoYXMgYmVlbiBwYXJzZWQgdXAgdG8gYW5kIGluY2x1ZGluZyB0
aGUgb3BlbmluZyAnKCcuCiAgKi8KLWludCBnZXRsaXN0b3B0cyhjaGFyICp0YWcsIGludCAqbGlz
dG9wdHMpCitpbnQgZ2V0bGlzdHNlbG9wdHMoY2hhciAqdGFnLCBpbnQgKm9wdHMpCiB7CiAgICAg
aW50IGM7Ci0gICAgc3RhdGljIHN0cnVjdCBidWYgYXJnOworICAgIHN0YXRpYyBzdHJ1Y3QgYnVm
IGJ1ZjsKIAotICAgICpsaXN0b3B0cyA9IExJU1RfRVhUOworICAgIGlmICggKGMgPSBwcm90X2dl
dGMoaW1hcGRfaW4pKSA9PSAnKScpCisJcmV0dXJuIHByb3RfZ2V0YyhpbWFwZF9pbik7CisgICAg
ZWxzZQorCXByb3RfdW5nZXRjKGMsIGltYXBkX2luKTsKIAogICAgIGZvciAoOzspIHsKLQljID0g
Z2V0d29yZChpbWFwZF9pbiwgJmFyZyk7Ci0JaWYgKCFhcmcuc1swXSkgYnJlYWs7CisJYyA9IGdl
dHdvcmQoaW1hcGRfaW4sICZidWYpOwogCi0JbGNhc2UoYXJnLnMpOwotCWlmICghc3RyY21wKGFy
Zy5zLCAic3Vic2NyaWJlZCIpKSB7Ci0JICAgICpsaXN0b3B0cyB8PSBMSVNUX1NVQlNDUklCRUQ7
CisJaWYgKCEqYnVmLnMpIHsKKwkgICAgcHJvdF9wcmludGYoaW1hcGRfb3V0LAorCQkJIiVzIEJB
RCBJbnZhbGlkIHN5bnRheCBpbiBMaXN0IGNvbW1hbmRcclxuIiwKKwkJCXRhZyk7CisJICAgIHJl
dHVybiBFT0Y7CiAJfQotCWVsc2UgaWYgKCFzdHJjbXAoYXJnLnMsICJjaGlsZHJlbiIpKSB7Ci0J
ICAgICpsaXN0b3B0cyB8PSBMSVNUX0NISUxEUkVOOworCisJbGNhc2UoYnVmLnMpOworCisJaWYg
KCFzdHJjbXAoYnVmLnMsICJzdWJzY3JpYmVkIikpIHsKKwkgICAgKm9wdHMgfD0gTElTVF9TRUxf
U1VCU0NSSUJFRCB8IExJU1RfUkVUX1NVQlNDUklCRUQ7CisJfSBlbHNlIGlmICghc3RyY21wKGJ1
Zi5zLCAicmVtb3RlIikpIHsKKwkgICAgKm9wdHMgfD0gTElTVF9TRUxfUkVNT1RFOworCX0gZWxz
ZSBpZiAoIXN0cmNtcChidWYucywgInJlY3Vyc2l2ZW1hdGNoIikpIHsKKwkgICAgKm9wdHMgfD0g
TElTVF9TRUxfUkVDVVJTSVZFTUFUQ0ggfCBMSVNUX09QVF9FWFRFTkRFRF9WMTc7CisJfSBlbHNl
IGlmICghc3RyY21wKGJ1Zi5zLCAiY2hpbGRyZW4iKSkgeworCSAgICAqb3B0cyB8PSBMSVNUX1JF
VF9DSElMRFJFTiB8IExJU1RfT1BUX0VYVEVOREVEX1YwMzsKKwl9IGVsc2UgeworCSAgICBwcm90
X3ByaW50ZihpbWFwZF9vdXQsCisJCQkiJXMgQkFEIEludmFsaWQgTGlzdCBzZWxlY3Rpb24gb3B0
aW9uIFwiJXNcIlxyXG4iLAorCQkJdGFnLCBidWYucyk7CisJICAgIHJldHVybiBFT0Y7CiAJfQot
CWVsc2UgaWYgKCFzdHJjbXAoYXJnLnMsICJyZW1vdGUiKSkgewotCSAgICAqbGlzdG9wdHMgfD0g
TElTVF9SRU1PVEU7CisKKwlpZiAoYyAhPSAnICcpIGJyZWFrOworICAgIH0KKworICAgIGlmIChj
ICE9ICcpJykgeworCXByb3RfcHJpbnRmKGltYXBkX291dCwKKwkJICAgICIlcyBCQUQgTWlzc2lu
ZyBjbG9zZSBwYXJlbnRoZXNpcyBmb3IgTGlzdCBzZWxlY3Rpb24gb3B0aW9uc1xyXG4iLCB0YWcp
OworCXJldHVybiBFT0Y7CisgICAgfQorCisgICAgaWYgKCpvcHRzICYgbGlzdF9zZWxlY3RfbW9k
X29wdHMKKwkgICAgJiYgISAoKm9wdHMgJiBsaXN0X3NlbGVjdF9iYXNlX29wdHMpKSB7CisJcHJv
dF9wcmludGYoaW1hcGRfb3V0LAorCQkgICAgIiVzIEJBRCBJbnZhbGlkIGNvbWJpbmF0aW9uIG9m
IHNlbGVjdGlvbiBvcHRpb25zXHJcbiIsCisJCSAgICB0YWcpOworCXJldHVybiBFT0Y7CisgICAg
fQorCisgICAgcmV0dXJuIHByb3RfZ2V0YyhpbWFwZF9pbik7Cit9CisKKy8qCisgKiBQYXJzZSBM
SVNUIHJldHVybiBvcHRpb25zLgorICogVGhlIGNvbW1hbmQgaGFzIGJlZW4gcGFyc2VkIHVwIHRv
IGFuZCBpbmNsdWRpbmcgdGhlICcgJyBiZWZvcmUgUkVUVVJOLgorICovCitpbnQgZ2V0bGlzdHJl
dG9wdHMoY2hhciAqdGFnLCBpbnQgKm9wdHMpIHsKKyAgICBzdGF0aWMgc3RydWN0IGJ1ZiBidWY7
CisgICAgaW50IGM7CisKKyAgICBjID0gZ2V0d29yZChpbWFwZF9pbiwgJmJ1Zik7CisgICAgaWYg
KCEqYnVmLnMpIHsKKwlwcm90X3ByaW50ZihpbWFwZF9vdXQsCisJCSAgICAiJXMgQkFEIEludmFs
aWQgc3ludGF4IGluIExpc3QgY29tbWFuZFxyXG4iLCB0YWcpOworCXJldHVybiBFT0Y7CisgICAg
fQorICAgIGxjYXNlKGJ1Zi5zKTsKKyAgICBpZiAoc3RyY2FzZWNtcChidWYucywgInJldHVybiIp
KSB7CisJcHJvdF9wcmludGYoaW1hcGRfb3V0LAorCQkgICAgIiVzIEJBRCBVbmV4cGVjdGVkIGV4
dHJhIGFyZ3VtZW50IHRvIExpc3Q6IFwiJXNcIlxyXG4iLAorCQkgICAgdGFnLCBidWYucyk7CisJ
cmV0dXJuIEVPRjsKKyAgICB9CisKKyAgICBpZiAoYyAhPSAnICcgfHwgKGMgPSBwcm90X2dldGMo
aW1hcGRfaW4pKSAhPSAnKCcpIHsKKwlwcm90X3ByaW50ZihpbWFwZF9vdXQsCisJCSAgICAiJXMg
QkFEIE1pc3NpbmcgcmV0dXJuIGFyZ3VtZW50IGxpc3RcclxuIiwgdGFnKTsKKwlyZXR1cm4gRU9G
OworICAgIH0KKworICAgIGlmICggKGMgPSBwcm90X2dldGMoaW1hcGRfaW4pKSA9PSAnKScpCisJ
cmV0dXJuIHByb3RfZ2V0YyhpbWFwZF9pbik7CisgICAgZWxzZQorCXByb3RfdW5nZXRjKGMsIGlt
YXBkX2luKTsKKworICAgIGZvciAoOzspIHsKKwljID0gZ2V0d29yZChpbWFwZF9pbiwgJmJ1Zik7
CisKKwlpZiAoISpidWYucykgeworCSAgICBwcm90X3ByaW50ZihpbWFwZF9vdXQsCisJCQkiJXMg
QkFEIEludmFsaWQgc3ludGF4IGluIExpc3QgY29tbWFuZFxyXG4iLCB0YWcpOworCSAgICByZXR1
cm4gRU9GOwogCX0KKworCWxjYXNlKGJ1Zi5zKTsKKworCWlmICghc3RyY21wKGJ1Zi5zLCAic3Vi
c2NyaWJlZCIpKQorCSAgICAqb3B0cyB8PSBMSVNUX1JFVF9TVUJTQ1JJQkVEOworCWVsc2UgaWYg
KCFzdHJjbXAoYnVmLnMsICJjaGlsZHJlbiIpKQorCSAgICAqb3B0cyB8PSBMSVNUX1JFVF9DSElM
RFJFTjsKIAllbHNlIHsKLQkgICAgcHJvdF9wcmludGYoaW1hcGRfb3V0LCAiJXMgQkFEIEludmFs
aWQgTGlzdCBvcHRpb24gJXNcclxuIiwKLQkJCXRhZywgYXJnLnMpOworCSAgICBwcm90X3ByaW50
ZihpbWFwZF9vdXQsCisJCQkiJXMgQkFEIEludmFsaWQgTGlzdCByZXR1cm4gb3B0aW9uIFwiJXNc
IlxyXG4iLAorCQkJdGFnLCBidWYucyk7CiAJICAgIHJldHVybiBFT0Y7CiAJfQogCkBAIC04NzQz
LDE1ICs4OTI4LDEzIEBACiAKICAgICBpZiAoYyAhPSAnKScpIHsKIAlwcm90X3ByaW50ZihpbWFw
ZF9vdXQsCi0JCSAgICAiJXMgQkFEIE1pc3NpbmcgY2xvc2UgcGFyZW50aGVzaXMgaW4gTGlzdFxy
XG4iLCB0YWcpOworCQkgICAgIiVzIEJBRCBNaXNzaW5nIGNsb3NlIHBhcmVudGhlc2lzIGZvciBM
aXN0IHJldHVybiBvcHRpb25zXHJcbiIsIHRhZyk7CiAJcmV0dXJuIEVPRjsKICAgICB9CiAKLSAg
ICBjID0gcHJvdF9nZXRjKGltYXBkX2luKTsKLQotICAgIHJldHVybiBjOworICAgIHJldHVybiBw
cm90X2dldGMoaW1hcGRfaW4pOwogfQotI2VuZGlmIC8qIEVOQUJMRV9MSVNURVhUICovCisjZW5k
aWYgLyogRU5BQkxFX0xJU1RfRVhURU5ERUQgKi8KIAogLyoKICAqIFBhcnNlIGEgZGF0ZV90aW1l
LCBmb3IgdGhlIEFQUEVORCBjb21tYW5kCkBAIC05MTM1LDE1OCArOTMxOCw0NjggQEAKICAgICBy
ZXR1cm4gMDsKIH0KIAotLyoKLSAqIElzc3VlIGEgTElTVCBvciBMU1VCIHVudGFnZ2VkIHJlc3Bv
bnNlCi0gKi8KLXN0YXRpYyB2b2lkIG1zdHJpbmdkYXRhKGNoYXIgKmNtZCwgY2hhciAqbmFtZSwg
aW50IG1hdGNobGVuLCBpbnQgbWF5Y3JlYXRlLAotCQkJaW50IGxpc3RvcHRzKQorc3RhdGljIGlu
dCBzZXRfaGFzY2hpbGRyZW4oY2hhciAqbmFtZSwgaW50IG1hdGNobGVuLCBpbnQgbWF5Y3JlYXRl
LAorCQkJICAgaW50ICphdHRyaWJ1dGVzKQoreworICAgIGxpc3RfY2FsbGJhY2tfY2FsbHMrKzsK
KyAgICBpZiAobmFtZVttYXRjaGxlbl0pIHsKKwkqYXR0cmlidXRlcyB8PSBNQk9YX0FUVFJJQlVU
RV9IQVNDSElMRFJFTjsKKwlyZXR1cm4gMTsKKyAgICB9CisgICAgcmV0dXJuIDA7Cit9CisKKy8q
IFByaW50IExJU1Qgb3IgTFNVQiB1bnRhZ2dlZCByZXNwb25zZSAqLworc3RhdGljIHZvaWQgbGlz
dF9yZXNwb25zZShjaGFyICpuYW1lLCBpbnQgYXR0cmlidXRlcywgaW50IG9wdHMpCiB7Ci0gICAg
c3RhdGljIGNoYXIgbGFzdG5hbWVbTUFYX01BSUxCT1hfUEFUSCsxXTsKLSAgICBzdGF0aWMgaW50
IGxhc3RuYW1lZGVsYXllZCA9IDA7Ci0gICAgc3RhdGljIGludCBsYXN0bmFtZW5vaW5mZXJpb3Jz
ID0gMDsKLSAgICBzdGF0aWMgaW50IG5vbmV4aXN0ZW50ID0gMDsKLSAgICBzdGF0aWMgaW50IHNh
d3VzZXIgPSAwOwotICAgIGludCBsYXN0bmFtZWhhc3N1YiA9IDA7Ci0gICAgaW50IGMsIG1idHlw
ZTsKKyAgICBzdHJ1Y3QgbWJveF9uYW1lX2F0dHJpYnV0ZSAqYXR0cjsKKyAgICBjaGFyIGludGVy
bmFsX25hbWVbTUFYX01BSUxCT1hfUEFUSCsxXTsKKyAgICBpbnQgciwgbWJ0eXBlLCBmaXJzdCA9
IDE7CiAgICAgY2hhciBtYm94bmFtZVtNQVhfTUFJTEJPWF9QQVRIKzFdOwogCi0gICAgLyogV2Ug
aGF2ZSB0byByZXNldCB0aGUgc2F3dXNlciBmbGFnIGJlZm9yZSBlYWNoIGxpc3QgY29tbWFuZC4K
LSAgICAgKiBIYW5kbGUgaXQgYXMgYSBkaXJ0eSBoYWNrLgotICAgICAqLwotICAgIGlmIChjbWQg
PT0gTlVMTCkgewotCXNhd3VzZXIgPSAwOwotCW1zdHJpbmdkYXRhY2FsbHMgPSAwOwotCXJldHVy
bjsKLSAgICB9Ci0gICAgbXN0cmluZ2RhdGFjYWxscysrOwotCi0gICAgaWYgKGxhc3RuYW1lZGVs
YXllZCkgewotCS8qIENoZWNrIGlmIGxhc3RuYW1lIGhhcyBjaGlsZHJlbiAqLwotCWlmIChuYW1l
ICYmIHN0cm5jbXAobGFzdG5hbWUsIG5hbWUsIHN0cmxlbihsYXN0bmFtZSkpID09IDAgJiYKLQkg
ICAgbmFtZVtzdHJsZW4obGFzdG5hbWUpXSA9PSAnLicpIHsKLQkgICAgbGFzdG5hbWVoYXNzdWIg
PSAxOwotCX0KLQlwcm90X3ByaW50ZihpbWFwZF9vdXQsICIqICVzICgiLCBjbWQpOwotCWlmIChu
b25leGlzdGVudCA9PSBJTUFQX01BSUxCT1hfUkVTRVJWRUQpIHsKLQkgICAgLyogTElTVEVYVCB3
YW50cyBcXFBsYWNlSG9sZGVyIGluc3RlYWQgb2YgXFxOb3NlbGVjdCAqLwotCSAgICBpZiAobGlz
dG9wdHMgJiBMSVNUX0VYVCkKLQkJcHJvdF9wcmludGYoaW1hcGRfb3V0LCAiXFxQbGFjZUhvbGRl
ciIpOwotCSAgICBlbHNlCi0JCXByb3RfcHJpbnRmKGltYXBkX291dCwgIlxcTm9zZWxlY3QiKTsK
LQl9IGVsc2UgaWYgKG5vbmV4aXN0ZW50KSB7Ci0JICAgIHByb3RfcHJpbnRmKGltYXBkX291dCwg
IlxcTm9uRXhpc3RlbnQiKTsKLQl9Ci0JaWYgKGxhc3RuYW1lbm9pbmZlcmlvcnMpIHsKLQkgICAg
cHJvdF9wcmludGYoaW1hcGRfb3V0LCAiJXNcXE5vaW5mZXJpb3JzIiwgbm9uZXhpc3RlbnQgPyAi
ICIgOiAiIik7Ci0JfQotCWVsc2UgaWYgKChsaXN0b3B0cyAmIExJU1RfQ0hJTERSRU4pICYmCi0J
CSAvKiB3ZSBjYW4ndCBkZXRlcm1pbmUgXEhhc05vQ2hpbGRyZW4gZm9yIHN1YnNjcmlwdGlvbnMg
Ki8KLQkJIChsYXN0bmFtZWhhc3N1YiB8fAotCQkgICEobGlzdG9wdHMgJiAoTElTVF9MU1VCIHwg
TElTVF9TVUJTQ1JJQkVEKSkpKSB7Ci0JICAgIHByb3RfcHJpbnRmKGltYXBkX291dCwgIiVzJXMi
LCBub25leGlzdGVudCA/ICIgIiA6ICIiLAotCQkJbGFzdG5hbWVoYXNzdWIgPyAiXFxIYXNDaGls
ZHJlbiIgOiAiXFxIYXNOb0NoaWxkcmVuIik7Ci0JfQotCXByb3RfcHJpbnRmKGltYXBkX291dCwg
IikgXCIlY1wiICIsIGltYXBkX25hbWVzcGFjZS5oaWVyX3NlcCk7Ci0JCSAgICAKLQkoKmltYXBk
X25hbWVzcGFjZS5tYm94bmFtZV90b2V4dGVybmFsKSgmaW1hcGRfbmFtZXNwYWNlLCBsYXN0bmFt
ZSwKLQkJCQkJICAgICAgIGltYXBkX3VzZXJpZCwgbWJveG5hbWUpOwotCXByaW50c3RyaW5nKG1i
b3huYW1lKTsKLQlwcm90X3ByaW50ZihpbWFwZF9vdXQsICJcclxuIik7Ci0JbGFzdG5hbWVkZWxh
eWVkID0gbGFzdG5hbWVub2luZmVyaW9ycyA9IG5vbmV4aXN0ZW50ID0gMDsKKyAgICBpZiAoIW5h
bWUpCisJcmV0dXJuOworCisgICAgLyogZmlyc3QgY29udmVydCAiSU5CT1giIHRvICJ1c2VyLjx1
c2VyaWQ+IiAqLworICAgIGlmICghc3RybmNhc2VjbXAobmFtZSwgImluYm94IiwgNSkKKyAgICAg
ICAgICAgICYmICghbmFtZVs1XSB8fCBuYW1lWzVdID09ICcuJykgKSB7CisJKCppbWFwZF9uYW1l
c3BhY2UubWJveG5hbWVfdG9pbnRlcm5hbCkoJmltYXBkX25hbWVzcGFjZSwgIklOQk9YIiwKKwkJ
CQkJICAgICAgIGltYXBkX3VzZXJpZCwgaW50ZXJuYWxfbmFtZSk7CisJc3RybGNhdChpbnRlcm5h
bF9uYW1lLCBuYW1lKzUsIHNpemVvZihpbnRlcm5hbF9uYW1lKSk7CiAgICAgfQorICAgIGVsc2UK
KwlzdHJsY3B5KGludGVybmFsX25hbWUsIG5hbWUsIHNpemVvZihpbnRlcm5hbF9uYW1lKSk7CiAK
LSAgICAvKiBTcGVjaWFsLWNhc2UgdG8gZmx1c2ggYW55IGZpbmFsIHN0YXRlICovCi0gICAgaWYg
KCFuYW1lKSB7Ci0JbGFzdG5hbWVbMF0gPSAnXDAnOwotCXJldHVybjsKKyAgICAvKiBnZXQgaW5m
byBhbmQgc2V0IGZsYWdzICovCisgICAgciA9IG1ib3hsaXN0X2RldGFpbChpbnRlcm5hbF9uYW1l
LCAmbWJ0eXBlLCBOVUxMLCBOVUxMLCBOVUxMLCBOVUxMLCBOVUxMKTsKKworICAgIGlmIChyID09
IElNQVBfTUFJTEJPWF9OT05FWElTVEVOVCkKKwlhdHRyaWJ1dGVzIHw9IE1CT1hfQVRUUklCVVRF
X05PTkVYSVNURU5UIHwgTUJPWF9BVFRSSUJVVEVfTk9TRUxFQ1Q7CisgICAgaWYgKCFyICYmICht
YnR5cGUgJiBNQlRZUEVfUkVTRVJWRSkpCisJYXR0cmlidXRlcyB8PSBNQk9YX0FUVFJJQlVURV9O
T1NFTEVDVDsKKworICAgIC8qIGZpZ3VyZSBvdXQgXEhhcyhObylDaGlsZHJlbiBpZiBuZWNlc3Nh
cnkgKi8KKyAgICBpZiAoIG9wdHMgJiBMSVNUX1JFVF9DSElMRFJFTgorCSAgICAmJiAhIChhdHRy
aWJ1dGVzICYgTUJPWF9BVFRSSUJVVEVfSEFTQ0hJTERSRU4pCisJICAgICYmICEgKGF0dHJpYnV0
ZXMgJiBNQk9YX0FUVFJJQlVURV9IQVNOT0NISUxEUkVOKSApIHsKKwltYm94bGlzdF9maW5kYWxs
KCZpbWFwZF9uYW1lc3BhY2UsIG5hbWUsCisJCQkgaW1hcGRfdXNlcmlzYWRtaW4sIGltYXBkX3Vz
ZXJpZCwgaW1hcGRfYXV0aHN0YXRlLAorCQkJIHNldF9oYXNjaGlsZHJlbiwgJmF0dHJpYnV0ZXMp
OworCWlmICggISAoYXR0cmlidXRlcyAmIE1CT1hfQVRUUklCVVRFX0hBU0NISUxEUkVOKSApCisJ
ICAgIGF0dHJpYnV0ZXMgfD0gTUJPWF9BVFRSSUJVVEVfSEFTTk9DSElMRFJFTjsKKyAgICB9CisK
KyAgICBpZiAob3B0cyAmIExJU1RfT1BUX0xTVUIpIHsKKwkvKiBcTm9zZWxlY3QgaGFzIGEgc3Bl
Y2lhbCBzZWNvbmQgbWVhbmluZyB3aXRoIChSKUxTVUIgKi8KKwlpZiAoICEoYXR0cmlidXRlcyAm
IE1CT1hfQVRUUklCVVRFX1NVQlNDUklCRUQpCisJCSYmIGF0dHJpYnV0ZXMgJiBNQk9YX0FUVFJJ
QlVURV9DSElMRElORk9fU1VCU0NSSUJFRCkKKwkgICAgYXR0cmlidXRlcyB8PSBNQk9YX0FUVFJJ
QlVURV9OT1NFTEVDVDsKKwlhdHRyaWJ1dGVzICY9IH5NQk9YX0FUVFJJQlVURV9TVUJTQ1JJQkVE
OworICAgIH0KKworICAgIC8qIHJlbW92ZSByZWR1bmRhbnQgZmxhZ3MgKi8KKyAgICBpZiAob3B0
cyAmIExJU1RfT1BUX0VYVEVOREVEKSB7CisJaWYgKG9wdHMgJiBNQk9YX0FUVFJJQlVURV9OT0lO
RkVSSU9SUykKKwkgICAgb3B0cyAmPSB+TUJPWF9BVFRSSUJVVEVfSEFTQ0hJTERSRU47CisJaWYg
KG9wdHMgJiBNQk9YX0FUVFJJQlVURV9OT05FWElTVEVOVCkKKwkgICAgb3B0cyAmPSB+TUJPWF9B
VFRSSUJVVEVfTk9TRUxFQ1Q7CisgICAgfQorCisgICAgcHJvdF9wcmludGYoaW1hcGRfb3V0LCAi
KiAlcyAoIiwKKwkJKG9wdHMgJiBMSVNUX09QVF9MU1VCKSA/ICJMU1VCIiA6ICJMSVNUIik7Cisg
ICAgZm9yIChhdHRyID0gbWJveF9uYW1lX2F0dHJpYnV0ZXM7IGF0dHItPmlkOyBhdHRyKyspCisJ
aWYgKGF0dHJpYnV0ZXMgJiBhdHRyLT5mbGFnKSB7CisJICAgIGlmIChmaXJzdCkgZmlyc3QgPSAw
OworCSAgICBlbHNlIHByb3RfcHV0YygnICcsIGltYXBkX291dCk7CisJICAgIHByb3RfcHJpbnRm
KGltYXBkX291dCwgYXR0ci0+aWQpOworCX0KKyAgICBwcm90X3ByaW50ZihpbWFwZF9vdXQsICIp
ICIpOworCisgICAgcHJvdF9wcmludGYoaW1hcGRfb3V0LCAiXCIlY1wiICIsIGltYXBkX25hbWVz
cGFjZS5oaWVyX3NlcCk7CisgCisgICAgKCppbWFwZF9uYW1lc3BhY2UubWJveG5hbWVfdG9leHRl
cm5hbCkoJmltYXBkX25hbWVzcGFjZSwgbmFtZSwKKyAgICAgICAgICAgIGltYXBkX3VzZXJpZCwg
bWJveG5hbWUpOworCisgICAgcHJpbnRhc3RyaW5nKG1ib3huYW1lKTsKKworICAgIGlmIChvcHRz
ICYgTElTVF9PUFRfRVhURU5ERUQgJiYgYXR0cmlidXRlcyAmIGxpc3RfY2hpbGRpbmZvKSB7CisJ
cHJvdF9wcmludGYoaW1hcGRfb3V0LCAiIChDSElMRElORk8gKCIpOworCWlmIChhdHRyaWJ1dGVz
ICYgTUJPWF9BVFRSSUJVVEVfQ0hJTERJTkZPX1NVQlNDUklCRUQpCisJICAgIHByb3RfcHJpbnRm
KGltYXBkX291dCwgIlNVQlNDUklCRUQiKTsKKwlwcm90X3ByaW50ZihpbWFwZF9vdXQsICIpKSIp
OwogICAgIH0KIAotICAgIC8qIFN1cHByZXNzIGFueSBvdXRwdXQgb2YgYSBwYXJ0aWFsIG1hdGNo
ICovCi0gICAgaWYgKChuYW1lW21hdGNobGVuXQotCSAmJiBzdHJuY21wKGxhc3RuYW1lLCBuYW1l
LCBtYXRjaGxlbikgPT0gMAotCSAmJiAobGFzdG5hbWVbbWF0Y2hsZW5dID09ICdcMCcgfHwgbGFz
dG5hbWVbbWF0Y2hsZW5dID09ICcuJykpKSB7Ci0JcmV0dXJuOworICAgIHByb3RfcHJpbnRmKGlt
YXBkX291dCwgIlxyXG4iKTsKK30KKworc3RhdGljIGludCBzZXRfc3Vic2NyaWJlZChjaGFyICpu
YW1lLCBpbnQgbWF0Y2hsZW4sIGludCBtYXljcmVhdGUsCisJCQkgIGludCAqYXR0cmlidXRlcykK
K3sKKyAgICBsaXN0X2NhbGxiYWNrX2NhbGxzKys7CisgICAgaWYgKCFuYW1lW21hdGNobGVuXSkg
CisJKmF0dHJpYnV0ZXMgfD0gTUJPWF9BVFRSSUJVVEVfU1VCU0NSSUJFRDsKKyAgICByZXR1cm4g
MTsKK30KKworLyogY2FsbGJhY2sgZm9yIG1ib3hsaXN0X2ZpbmRhbGwKKyAqIHVzZWQgd2hlbiB0
aGUgU1VCU0NSSUJFRCBzZWxlY3Rpb24gb3B0aW9uIGlzIE5PVCBnaXZlbiAqLworc3RhdGljIGlu
dCBsaXN0X2NiKGNoYXIgKm5hbWUsIGludCBtYXRjaGxlbiwgaW50IG1heWNyZWF0ZSwKKwkJICBz
dHJ1Y3QgbGlzdF9yb2NrICpyb2NrKQoreworICAgIGludCBsYXN0X2xlbjsKKyAgICBpbnQgbGFz
dF9uYW1lX2lzX2FuY2VzdG9yID0KKwlyb2NrLT5sYXN0X25hbWUKKwkmJiBtYXRjaGxlbiA+PSAo
bGFzdF9sZW4gPSBzdHJsZW4ocm9jay0+bGFzdF9uYW1lKSkKKwkmJiBuYW1lW2xhc3RfbGVuXSA9
PSAnLicKKwkmJiAhbWVtY21wKHJvY2stPmxhc3RfbmFtZSwgbmFtZSwgbGFzdF9sZW4pOworCisg
ICAgbGlzdF9jYWxsYmFja19jYWxscysrOworCisgICAgaWYgKGxhc3RfbmFtZV9pc19hbmNlc3Rv
cikKKwlyb2NrLT5sYXN0X2F0dHJpYnV0ZXMgfD0gTUJPWF9BVFRSSUJVVEVfSEFTQ0hJTERSRU47
CisKKyAgICBpZiAoIW5hbWVbbWF0Y2hsZW5dKSB7CisJaWYgKCAhIChyb2NrLT5sYXN0X2F0dHJp
YnV0ZXMgJiBNQk9YX0FUVFJJQlVURV9IQVNDSElMRFJFTikgKQorCSAgICByb2NrLT5sYXN0X2F0
dHJpYnV0ZXMgfD0gTUJPWF9BVFRSSUJVVEVfSEFTTk9DSElMRFJFTjsKKwlsaXN0X3Jlc3BvbnNl
KHJvY2stPmxhc3RfbmFtZSwgcm9jay0+bGFzdF9hdHRyaWJ1dGVzLCByb2NrLT5vcHRzKTsKKwlm
cmVlKHJvY2stPmxhc3RfbmFtZSk7CisJcm9jay0+bGFzdF9uYW1lID0geHN0cmR1cChuYW1lKTsK
Kwlyb2NrLT5sYXN0X2F0dHJpYnV0ZXMgPSAwOworCWlmICghbWF5Y3JlYXRlKQorCSAgICByb2Nr
LT5sYXN0X2F0dHJpYnV0ZXMgfD0gTUJPWF9BVFRSSUJVVEVfTk9JTkZFUklPUlM7CisJLyogeHh4
OiBpcyB0aGVyZSBhIGNoZWFwZXIgd2F5IHRvIGZpZ3VyZSBvdXQgXFN1YnNjcmliZWQ/ICovCisJ
aWYgKHJvY2stPm9wdHMgJiBMSVNUX1JFVF9TVUJTQ1JJQkVEKQorCSAgICBtYm94bGlzdF9maW5k
c3ViKCZpbWFwZF9uYW1lc3BhY2UsIG5hbWUsIGltYXBkX3VzZXJpc2FkbWluLAorCQkJICAgICBp
bWFwZF91c2VyaWQsIGltYXBkX2F1dGhzdGF0ZSwgc2V0X3N1YnNjcmliZWQsCisJCQkgICAgICZy
b2NrLT5sYXN0X2F0dHJpYnV0ZXMsIDApOworICAgIH0gZWxzZSBpZiAobmFtZVttYXRjaGxlbl0g
PT0gJy4nCisJICAgICYmICEgKHJvY2stPm9wdHMgJiBMSVNUX09QVF9FWFRFTkRFRCkKKwkgICAg
JiYgcm9jay0+dHJhaWxpbmdfcGVyY2VudCkgeworCS8qIHNwZWNpYWwgY2FzZTogaWYgdGhlIG1h
aWxib3ggbmFtZSBhcmd1bWVudCBvZiBhIG5vbi1leHRlbmRlZCBMaXN0CisJICogY29tbWFuZCBl
bmRzIHdpdGggJSwgd2UgbXVzdCBpbmNsdWRlIG1hdGNoaW5nIGxldmVscyBvZiBoaWVyYXJjaHkg
Ki8KKwlpZiAoICEgKHJvY2stPmxhc3RfbmFtZQorCQkgICAgJiYgIXN0cm5jbXAocm9jay0+bGFz
dF9uYW1lLCBuYW1lLCBtYXRjaGxlbikKKwkJICAgICYmIChyb2NrLT5sYXN0X25hbWVbbWF0Y2hs
ZW5dID09ICdcMCcKKwkJCXx8IHJvY2stPmxhc3RfbmFtZVttYXRjaGxlbl0gPT0gJy4nKSkgKSB7
CisJICAgIGxpc3RfcmVzcG9uc2Uocm9jay0+bGFzdF9uYW1lLCByb2NrLT5sYXN0X2F0dHJpYnV0
ZXMsIHJvY2stPm9wdHMpOworCSAgICBmcmVlKHJvY2stPmxhc3RfbmFtZSk7CisJICAgIHJvY2st
Pmxhc3RfbmFtZSA9IHhzdHJuZHVwKG5hbWUsIG1hdGNobGVuKTsKKwkgICAgcm9jay0+bGFzdF9h
dHRyaWJ1dGVzID0gTUJPWF9BVFRSSUJVVEVfTk9ORVhJU1RFTlQKKwkJfCBNQk9YX0FUVFJJQlVU
RV9OT1NFTEVDVCB8IE1CT1hfQVRUUklCVVRFX0hBU0NISUxEUkVOOworCX0KICAgICB9Ci0JCi0g
ICAgLyoKLSAgICAgKiBXZSBjYW4gZ2V0IGEgcGFydGlhbCBtYXRjaCBmb3IgInVzZXIiIG11bHRp
cGxlIHRpbWVzIHdpdGgKLSAgICAgKiBvdGhlciBtYXRjaGVzIGluYmV0d2Vlbi4gIEhhbmRsZSBp
dCBhcyBhIHNwZWNpYWwgY2FzZQotICAgICAqLwotICAgIGlmIChtYXRjaGxlbiA9PSA0ICYmIHN0
cm5jYXNlY21wKG5hbWUsICJ1c2VyIiwgNCkgPT0gMCkgewotCWlmIChzYXd1c2VyKSByZXR1cm47
Ci0Jc2F3dXNlciA9IDE7CisKKyAgICByZXR1cm4gMDsKK30KKworLyogY2FsbGJhY2sgZm9yIG1i
b3hsaXN0X2ZpbmRzdWIKKyAqIHVzZWQgd2hlbiBTVUJTQ1JJQkVEIGJ1dCBub3QgUkVDVVJTSVZF
TUFUQ0ggaXMgZ2l2ZW4gKi8KK3N0YXRpYyBpbnQgc3Vic2NyaWJlZF9jYihjaGFyICpuYW1lLCBp
bnQgbWF0Y2hsZW4sIGludCBtYXljcmVhdGUsCisJCQkgc3RydWN0IGxpc3Rfcm9jayAqcm9jaykK
K3sKKyAgICBsaXN0X2NhbGxiYWNrX2NhbGxzKys7CisKKyAgICBpZiAoIW5hbWVbbWF0Y2hsZW5d
KSB7CisJbGlzdF9yZXNwb25zZShyb2NrLT5sYXN0X25hbWUsIHJvY2stPmxhc3RfYXR0cmlidXRl
cywgcm9jay0+b3B0cyk7CisJZnJlZShyb2NrLT5sYXN0X25hbWUpOworCXJvY2stPmxhc3RfbmFt
ZSA9IHhzdHJkdXAobmFtZSk7CisJcm9jay0+bGFzdF9hdHRyaWJ1dGVzID0gTUJPWF9BVFRSSUJV
VEVfU1VCU0NSSUJFRDsKKwlpZiAoIW1heWNyZWF0ZSkKKwkgICAgcm9jay0+bGFzdF9hdHRyaWJ1
dGVzIHw9IE1CT1hfQVRUUklCVVRFX05PSU5GRVJJT1JTOworICAgIH0gZWxzZSBpZiAobmFtZVtt
YXRjaGxlbl0gPT0gJy4nCisJICAgICYmIHJvY2stPm9wdHMgJiBMSVNUX09QVF9MU1VCCisJICAg
ICYmIHJvY2stPnRyYWlsaW5nX3BlcmNlbnQpIHsKKwkvKiBzcGVjaWFsIGNhc2U6IGlmIHRoZSBt
YWlsYm94IG5hbWUgYXJndW1lbnQgb2YgYW4gTHN1YiBjb21tYW5kIGVuZHMKKwkgKiB3aXRoICUs
IG1haWxib3ggbmFtZXMgdGhhdCBtYXRjaCB0aGUgcGF0dGVybiBidXQgYXJlbid0IHN1YnNjcmli
ZWQKKwkgKiBtdXN0IGFsc28gYmUgcmV0dXJuZWQgaWYgdGhleSBoYXZlIGEgY2hpbGQgbWFpbGJv
eCB0aGF0IGlzCisJICogc3Vic2NyaWJlZCAqLworCW5hbWVbbWF0Y2hsZW5dID0gJ1wwJzsKKwlp
ZiAoICEgKHJvY2stPmxhc3RfbmFtZSAmJiAhc3RyY21wKHJvY2stPmxhc3RfbmFtZSwgbmFtZSkp
ICkgeworCSAgICBsaXN0X3Jlc3BvbnNlKHJvY2stPmxhc3RfbmFtZSwgcm9jay0+bGFzdF9hdHRy
aWJ1dGVzLCByb2NrLT5vcHRzKTsKKwkgICAgZnJlZShyb2NrLT5sYXN0X25hbWUpOworCSAgICBy
b2NrLT5sYXN0X25hbWUgPSB4c3RyZHVwKG5hbWUpOworCSAgICByb2NrLT5sYXN0X2F0dHJpYnV0
ZXMgPSBNQk9YX0FUVFJJQlVURV9DSElMRElORk9fU1VCU0NSSUJFRDsKKwl9CisJbmFtZVttYXRj
aGxlbl0gPSAnLic7CiAgICAgfQogCi0gICAgc3RybGNweShsYXN0bmFtZSwgbmFtZSwgc2l6ZW9m
KGxhc3RuYW1lKSk7Ci0gICAgbGFzdG5hbWVbbWF0Y2hsZW5dID0gJ1wwJzsKLSAgICBub25leGlz
dGVudCA9IDA7CisgICAgcmV0dXJuIDA7Cit9CiAKLSAgICAvKiBOb3cgd2UgbmVlZCB0byBzZWUg
aWYgdGhpcyBtYWlsYm94IGV4aXN0cyAqLwotICAgIC8qIGZpcnN0IGNvbnZlcnQgIklOQk9YIiB0
byAidXNlci48dXNlcmlkPiIgKi8KLSAgICBpZiAoIXN0cm5jYXNlY21wKGxhc3RuYW1lLCAiaW5i
b3giLCA1KSkgewotCSgqaW1hcGRfbmFtZXNwYWNlLm1ib3huYW1lX3RvaW50ZXJuYWwpKCZpbWFw
ZF9uYW1lc3BhY2UsICJJTkJPWCIsCi0JCQkJCSAgICAgICBpbWFwZF91c2VyaWQsIG1ib3huYW1l
KTsKLQlzdHJsY2F0KG1ib3huYW1lLCBsYXN0bmFtZSs1LCBzaXplb2YobWJveG5hbWUpKTsKKy8q
CisgKiBUYWtlcyB0aGUgInJlZmVyZW5jZSBuYW1lIiBhbmQgIm1haWxib3ggbmFtZSIgYXJndW1l
bnRzIG9mIHRoZSBMSVNUIGNvbW1hbmQKKyAqIGFuZCByZXR1cm5zIGEgImNhbm9uaWNhbCBMSVNU
IHBhdHRlcm4iLiBUaGUgY2FsbGVyIGlzIHJlc3BvbnNpYmxlIGZvcgorICogZnJlZSgpaW5nIHRo
ZSByZXR1cm5lZCBzdHJpbmcuCisgKi8KK2NoYXIgKmNhbm9uaWNhbF9saXN0X3BhdHRlcm4oY29u
c3QgY2hhciAqcmVmZXJlbmNlLCBjb25zdCBjaGFyICpwYXR0ZXJuKQoreworICAgIGludCBwYXRs
ZW4gPSBzdHJsZW4ocGF0dGVybik7CisgICAgaW50IHJlZmxlbiA9IHN0cmxlbihyZWZlcmVuY2Up
OworCisgICAgY2hhciAqYnVmID0geG1hbGxvYyhwYXRsZW4gKyByZWZsZW4gKyAxKTsKKyAgICBi
dWZbMF0gPSAnXDAnOworCisgICAgaWYgKCpyZWZlcmVuY2UpIHsKKwlpZiAocmVmZXJlbmNlW3Jl
Zmxlbi0xXSA9PSBpbWFwZF9uYW1lc3BhY2UuaGllcl9zZXAgJiYKKwkJcGF0dGVyblswXSA9PSBp
bWFwZF9uYW1lc3BhY2UuaGllcl9zZXApCisJICAgIC0tcmVmbGVuOworCW1lbWNweShidWYsIHJl
ZmVyZW5jZSwgcmVmbGVuKTsKKwlidWZbcmVmbGVuXSA9ICdcMCc7CiAgICAgfQotICAgIGVsc2UK
LQlzdHJsY3B5KG1ib3huYW1lLCBsYXN0bmFtZSwgc2l6ZW9mKG1ib3huYW1lKSk7CisgICAgc3Ry
Y2F0KGJ1ZiwgcGF0dGVybik7CiAKLSAgICAvKiBMb29rIGl0IHVwICovCi0gICAgbm9uZXhpc3Rl
bnQgPSBtYm94bGlzdF9kZXRhaWwobWJveG5hbWUsICZtYnR5cGUsCi0JCQkJICBOVUxMLCBOVUxM
LCBOVUxMLCBOVUxMLCBOVUxMKTsKLSAgICBpZighbm9uZXhpc3RlbnQgJiYgKG1idHlwZSAmIE1C
VFlQRV9SRVNFUlZFKSkKLQlub25leGlzdGVudCA9IElNQVBfTUFJTEJPWF9SRVNFUlZFRDsKKyAg
ICByZXR1cm4gYnVmOworfQogCi0gICAgaWYgKCFuYW1lW21hdGNobGVuXSkgewotCWxhc3RuYW1l
ZGVsYXllZCA9IDE7Ci0JaWYgKCFtYXljcmVhdGUpIGxhc3RuYW1lbm9pbmZlcmlvcnMgPSAxOwot
CXJldHVybjsKKy8qCisgKiBUdXJucyB0aGUgc3RyaW5ncyBpbiBwYXR0ZXJucyBpbnRvICJjYW5v
bmljYWwgTElTVCBwYXR0ZXJuInMuIEFsc28KKyAqIHRyYW5zbGF0ZXMgYW55IGhpZXJhcmNoeSBz
ZXBhcmF0b3JzLgorICovCit2b2lkIGNhbm9uaWNhbF9saXN0X3BhdHRlcm5zKGNoYXIgKnJlZmVy
ZW5jZSwgc3RydWN0IHN0cmxpc3QgKnBhdHRlcm5zKQoreworICAgIHN0YXRpYyBpbnQgaWdub3Jl
cmVmZXJlbmNlID0gMDsKKyAgICBjaGFyICpvbGQ7CisKKyAgICAvKiBJZ25vcmUgdGhlIHJlZmVy
ZW5jZSBhcmd1bWVudD8KKyAgICAgICAodGhlIGJlaGF2aW9yIGluIDEuNS4xMCAmIG9sZGVyKSAq
LworICAgIGlmIChpZ25vcmVyZWZlcmVuY2UgPT0gMCkKKwlpZ25vcmVyZWZlcmVuY2UgPSBjb25m
aWdfZ2V0c3dpdGNoKElNQVBPUFRfSUdOT1JFUkVGRVJFTkNFKTsKKworICAgIGZvciAoOyBwYXR0
ZXJuczsgcGF0dGVybnMgPSBwYXR0ZXJucy0+bmV4dCkgeworCWlmICghaWdub3JlcmVmZXJlbmNl
IHx8IHBhdHRlcm5zLT5zWzBdID09IGltYXBkX25hbWVzcGFjZS5oaWVyX3NlcCkgeworCSAgICBv
bGQgPSBwYXR0ZXJucy0+czsKKwkgICAgcGF0dGVybnMtPnMgPSBjYW5vbmljYWxfbGlzdF9wYXR0
ZXJuKHJlZmVyZW5jZSwgb2xkKTsKKwkgICAgZnJlZShvbGQpOworCX0KKwkvKiBUcmFuc2xhdGUg
YW55IHNlcGFyYXRvcnMgaW4gcGF0dGVybiAqLworCW1ib3huYW1lX2hpZXJzZXBfdG9pbnRlcm5h
bCgmaW1hcGRfbmFtZXNwYWNlLCBwYXR0ZXJucy0+cywKKwkJCQkgICAgY29uZmlnX3ZpcnRkb21h
aW5zID8KKwkJCQkgICAgc3RyY3NwbihwYXR0ZXJucy0+cywgIkAiKSA6IDApOwogICAgIH0KK30K
IAotICAgIGMgPSBuYW1lW21hdGNobGVuXTsKLSAgICBpZiAoYykgbmFtZVttYXRjaGxlbl0gPSAn
XDAnOwotICAgIHByb3RfcHJpbnRmKGltYXBkX291dCwgIiogJXMgKCIsIGNtZCk7Ci0gICAgaWYg
KGMpIHsKLQkvKiBIYW5kbGUgbmFtZXNwYWNlIHByZWZpeCBhcyBhIHNwZWNpYWwgY2FzZSAqLyAK
LQlpZiAoIXN0cmNtcChuYW1lLCAidXNlciIpIHx8Ci0JICAgICFzdHJjbXAobmFtZSwgaW1hcGRf
bmFtZXNwYWNlLnByZWZpeFtOQU1FU1BBQ0VfU0hBUkVEXSkpIHsKLQkgICAgcHJvdF9wcmludGYo
aW1hcGRfb3V0LCAiXFxOb3NlbGVjdCIpOwotCSAgICBpZiAobGlzdG9wdHMgJiBMSVNUX0VYVCkK
LQkJcHJvdF9wcmludGYoaW1hcGRfb3V0LCAiIFxcUGxhY2VIb2xkZXIiKTsKKy8qIGNhbGxiYWNr
IGZvciBtYm94bGlzdF9maW5kc3ViCisgKiB1c2VkIGJ5IGxpc3RfZGF0YV9yZWN1cnNpdmVtYXRj
aCAqLworc3RhdGljIGludCByZWN1cnNpdmVtYXRjaF9jYihjaGFyICpuYW1lLCBpbnQgbWF0Y2hs
ZW4sIGludCBtYXljcmVhdGUsCisJCQkgICAgIHN0cnVjdCBsaXN0X3JvY2tfcmVjdXJzaXZlbWF0
Y2ggKnJvY2spIHsKKyAgICBsaXN0X2NhbGxiYWNrX2NhbGxzKys7CisKKyAgICBpZiAobmFtZVtt
YXRjaGxlbl0pIHsKKwlpZiAobmFtZVttYXRjaGxlbl0gPT0gJy4nKSB7CisJICAgIGludCAqcGFy
ZW50X2luZm87CisJICAgIG5hbWVbbWF0Y2hsZW5dID0gJ1wwJzsKKwkgICAgcGFyZW50X2luZm8g
PSBoYXNoX2xvb2t1cChuYW1lLCAmcm9jay0+dGFibGUpOworCSAgICBpZiAoIXBhcmVudF9pbmZv
KSB7CisJCXBhcmVudF9pbmZvID0geHptYWxsb2Moc2l6ZW9mKGludCkpOworCQloYXNoX2luc2Vy
dChuYW1lLCBwYXJlbnRfaW5mbywgJnJvY2stPnRhYmxlKTsKKwkJcm9jay0+Y291bnQrKzsKKwkJ
aWYgKCFtYXljcmVhdGUpCisJCSAgICAqcGFyZW50X2luZm8gfD0gTUJPWF9BVFRSSUJVVEVfTk9J
TkZFUklPUlM7CisJICAgIH0KKwkgICAgKnBhcmVudF9pbmZvIHw9IE1CT1hfQVRUUklCVVRFX0NI
SUxESU5GT19TVUJTQ1JJQkVEOworCSAgICBuYW1lW21hdGNobGVuXSA9ICcuJzsKIAl9Ci0JZWxz
ZSB7Ci0JICAgIGlmIChub25leGlzdGVudCkKLQkJcHJvdF9wcmludGYoaW1hcGRfb3V0LCAiXFxO
b25FeGlzdGVudCIpOwotCSAgICAvKiBMSVNURVhUIHVzZXMgXFBsYWNlSG9sZGVyIGluc3RlYWQg
b2YgXE5vc2VsZWN0ICovCi0JICAgIGlmIChsaXN0b3B0cyAmIExJU1RfRVhUKQotCQlwcm90X3By
aW50ZihpbWFwZF9vdXQsICIlc1xcUGxhY2VIb2xkZXIiLCBub25leGlzdGVudCA/ICIgIiA6ICIi
KTsKLQkgICAgZWxzZQotCQlwcm90X3ByaW50ZihpbWFwZF9vdXQsICIlc1xcTm9zZWxlY3QiLCBu
b25leGlzdGVudCA/ICIgIiA6ICIiKTsKKyAgICB9IGVsc2UgeworCWludCAqbGlzdF9pbmZvID0g
aGFzaF9sb29rdXAobmFtZSwgJnJvY2stPnRhYmxlKTsKKwlpZiAoIWxpc3RfaW5mbykgeworCSAg
ICBsaXN0X2luZm8gPSB4em1hbGxvYyhzaXplb2YoaW50KSk7CisJICAgIGhhc2hfaW5zZXJ0KG5h
bWUsIGxpc3RfaW5mbywgJnJvY2stPnRhYmxlKTsKKwkgICAgcm9jay0+Y291bnQrKzsKKwkgICAg
Kmxpc3RfaW5mbyB8PSBNQk9YX0FUVFJJQlVURV9TVUJTQ1JJQkVEOworCSAgICBpZiAoIW1heWNy
ZWF0ZSkKKwkJKmxpc3RfaW5mbyB8PSBNQk9YX0FUVFJJQlVURV9OT0lORkVSSU9SUzsKIAl9Ci0J
aWYgKGxpc3RvcHRzICYgTElTVF9DSElMRFJFTikKLQkgICAgcHJvdF9wcmludGYoaW1hcGRfb3V0
LCAiIFxcSGFzQ2hpbGRyZW4iKTsKICAgICB9Ci0gICAgcHJvdF9wcmludGYoaW1hcGRfb3V0LCAi
KSBcIiVjXCIgIiwgaW1hcGRfbmFtZXNwYWNlLmhpZXJfc2VwKTsKIAotICAgICgqaW1hcGRfbmFt
ZXNwYWNlLm1ib3huYW1lX3RvZXh0ZXJuYWwpKCZpbWFwZF9uYW1lc3BhY2UsIG5hbWUsCi0JCQkJ
CSAgIGltYXBkX3VzZXJpZCwgbWJveG5hbWUpOwotICAgIHByaW50c3RyaW5nKG1ib3huYW1lKTsK
LSAgICBwcm90X3ByaW50ZihpbWFwZF9vdXQsICJcclxuIik7Ci0gICAgaWYgKGMpIG5hbWVbbWF0
Y2hsZW5dID0gYzsKLSAgICByZXR1cm47CisgICAgcmV0dXJuIDA7Cit9CisKKy8qIGNhbGxiYWNr
IGZvciBoYXNoX2VudW1lcmF0ZSAqLwordm9pZCBjb3B5X3RvX2FycmF5KGNoYXIgKmtleSwgdm9p
ZCAqZGF0YSwgdm9pZCAqdm9pZF9yb2NrKSB7CisgICAgaW50ICphdHRyaWJ1dGVzID0gKGludCAq
KWRhdGE7CisgICAgc3RydWN0IGxpc3Rfcm9ja19yZWN1cnNpdmVtYXRjaCAqcm9jayA9CisJKHN0
cnVjdCBsaXN0X3JvY2tfcmVjdXJzaXZlbWF0Y2ggKil2b2lkX3JvY2s7CisgICAgYXNzZXJ0KHJv
Y2stPmNvdW50ID4gMCk7CisgICAgcm9jay0+YXJyYXlbLS1yb2NrLT5jb3VudF0ubmFtZSA9IGtl
eTsKKyAgICByb2NrLT5hcnJheVtyb2NrLT5jb3VudF0uYXR0cmlidXRlcyA9ICphdHRyaWJ1dGVz
OworfQorCisvKiBDb21wYXJhdG9yIGZvciByZXZlcnNlLXNvcnRpbmcgYW4gYXJyYXkgb2Ygc3Ry
dWN0IGxpc3RfZW50cnkgYnkgbmFtZS4gKi8KK2ludCBsaXN0X2VudHJ5X2NvbXBhcmF0b3IoY29u
c3Qgdm9pZCAqcDEsIGNvbnN0IHZvaWQgKnAyKSB7CisgICAgY29uc3Qgc3RydWN0IGxpc3RfZW50
cnkgKmUxID0gKHN0cnVjdCBsaXN0X2VudHJ5ICopcDE7CisgICAgY29uc3Qgc3RydWN0IGxpc3Rf
ZW50cnkgKmUyID0gKHN0cnVjdCBsaXN0X2VudHJ5ICopcDI7CisgICAgcmV0dXJuIC0gc3RyY21w
KGUxLT5uYW1lLCBlMi0+bmFtZSk7Cit9CisKK3N0YXRpYyB2b2lkIGxpc3RfZGF0YV9yZWN1cnNp
dmVtYXRjaChzdHJ1Y3Qgc3RybGlzdCAqcGF0dGVybnMsIGludCBvcHRzLAorCQkJCSAgICAgaW50
ICgqZmluZHN1Yikoc3RydWN0IG5hbWVzcGFjZSAqLAorCQkJCQkgY29uc3QgY2hhciAqLCBpbnQs
IGNoYXIgKiwKKwkJCQkJIHN0cnVjdCBhdXRoX3N0YXRlICosIGludCAoKikoKSwKKwkJCQkJIHZv
aWQgKiwgaW50KSkgeworICAgIHN0cnVjdCBzdHJsaXN0ICpwYXR0ZXJuOworICAgIHN0cnVjdCBs
aXN0X3JvY2tfcmVjdXJzaXZlbWF0Y2ggcm9jazsKKworICAgIHJvY2suY291bnQgPSAwOworICAg
IHJvY2sub3B0cyA9IG9wdHM7CisgICAgY29uc3RydWN0X2hhc2hfdGFibGUoJnJvY2sudGFibGUs
IDEwMCwgMSk7CisKKyAgICAvKiBmaW5kICovCisgICAgZm9yIChwYXR0ZXJuID0gcGF0dGVybnM7
IHBhdHRlcm47IHBhdHRlcm4gPSBwYXR0ZXJuLT5uZXh0KQorCWZpbmRzdWIoJmltYXBkX25hbWVz
cGFjZSwgcGF0dGVybi0+cywgaW1hcGRfdXNlcmlzYWRtaW4sIGltYXBkX3VzZXJpZCwKKwkJaW1h
cGRfYXV0aHN0YXRlLCByZWN1cnNpdmVtYXRjaF9jYiwgJnJvY2ssIDEpOworCisgICAgaWYgKHJv
Y2suY291bnQpIHsKKwkvKiBzb3J0ICovCisJaW50IGVudHJpZXMgPSByb2NrLmNvdW50OworCXJv
Y2suYXJyYXkgPSB4bWFsbG9jKGVudHJpZXMgKiAoc2l6ZW9mKHN0cnVjdCBsaXN0X2VudHJ5KSkp
OworCWhhc2hfZW51bWVyYXRlKCZyb2NrLnRhYmxlLCBjb3B5X3RvX2FycmF5LCAmcm9jayk7CisJ
cXNvcnQocm9jay5hcnJheSwgZW50cmllcywgc2l6ZW9mKHN0cnVjdCBsaXN0X2VudHJ5KSwKKwkg
ICAgICBsaXN0X2VudHJ5X2NvbXBhcmF0b3IpOworCWFzc2VydChyb2NrLmNvdW50ID09IDApOwor
CisJLyogcHJpbnQgKi8KKwlmb3IgKGVudHJpZXMtLTsgZW50cmllcyA+PSAwOyBlbnRyaWVzLS0p
CisJICAgIGxpc3RfcmVzcG9uc2Uocm9jay5hcnJheVtlbnRyaWVzXS5uYW1lLAorCQkgICAgcm9j
ay5hcnJheVtlbnRyaWVzXS5hdHRyaWJ1dGVzLAorCQkgICAgcm9jay5vcHRzKTsKKworCWZyZWUo
cm9jay5hcnJheSk7CisgICAgfQorCisgICAgZnJlZV9oYXNoX3RhYmxlKCZyb2NrLnRhYmxlLCBm
cmVlKTsKK30KKworLyogUmV0cmlldmVzIHRoZSBkYXRhIGFuZCBwcmludHMgdGhlIHVudGFnZ2Vk
IHJlc3BvbnNlcyBmb3IgYSBMSVNUIGNvbW1hbmQuICovCitzdGF0aWMgdm9pZCBsaXN0X2RhdGEo
Y2hhciAqcmVmZXJlbmNlLCBpbnQgbGlzdG9wdHMsIHN0cnVjdCBzdHJsaXN0ICpwYXR0ZXJucykK
K3sKKyAgICBpbnQgKCpmaW5kYWxsKShzdHJ1Y3QgbmFtZXNwYWNlICpuYW1lc3BhY2UsCisJCSAg
IGNvbnN0IGNoYXIgKnBhdHRlcm4sIGludCBpc2FkbWluLCBjaGFyICp1c2VyaWQsCisJCSAgIHN0
cnVjdCBhdXRoX3N0YXRlICphdXRoX3N0YXRlLCBpbnQgKCpwcm9jKSgpLAorCQkgICB2b2lkICpy
b2NrKTsKKyAgICBpbnQgKCpmaW5kc3ViKShzdHJ1Y3QgbmFtZXNwYWNlICpuYW1lc3BhY2UsCisJ
CSAgIGNvbnN0IGNoYXIgKnBhdHRlcm4sIGludCBpc2FkbWluLCBjaGFyICp1c2VyaWQsCisJCSAg
IHN0cnVjdCBhdXRoX3N0YXRlICphdXRoX3N0YXRlLCBpbnQgKCpwcm9jKSgpLAorCQkgICB2b2lk
ICpyb2NrLCBpbnQgZm9yY2UpOworICAgIGNhbm9uaWNhbF9saXN0X3BhdHRlcm5zKHJlZmVyZW5j
ZSwgcGF0dGVybnMpOworCisgICAgLyogQ2hlY2sgdG8gc2VlIGlmIHdlIHNob3VsZCBvbmx5IGxp
c3QgdGhlIHBlcnNvbmFsIG5hbWVzcGFjZSAqLworICAgIGlmICghKGxpc3RvcHRzICYgTElTVF9P
UFRfRVhURU5ERUQpCisJICAgICYmICFzdHJjbXAocGF0dGVybnMtPnMsICIqIikKKwkgICAgJiYg
Y29uZmlnX2dldHN3aXRjaChJTUFQT1BUX0ZPT0xTVFVQSURDTElFTlRTKSkgeworCWZyZWUocGF0
dGVybnMtPnMpOworCXBhdHRlcm5zLT5zID0geHN0cmR1cCgiSU5CT1gqIik7CisJZmluZHN1YiA9
IG1ib3hsaXN0X2ZpbmRzdWI7CisJZmluZGFsbCA9IG1ib3hsaXN0X2ZpbmRhbGw7CisgICAgfSBl
bHNlIHsKKwlmaW5kc3ViID0gaW1hcGRfbmFtZXNwYWNlLm1ib3hsaXN0X2ZpbmRzdWI7CisJZmlu
ZGFsbCA9IGltYXBkX25hbWVzcGFjZS5tYm94bGlzdF9maW5kYWxsOworICAgIH0KKworICAgIGlm
IChsaXN0b3B0cyAmIExJU1RfU0VMX1JFQ1VSU0lWRU1BVENIKSB7CisJbGlzdF9kYXRhX3JlY3Vy
c2l2ZW1hdGNoKHBhdHRlcm5zLCBsaXN0b3B0cywgZmluZHN1Yik7CisgICAgfSBlbHNlIHsKKwlz
dHJ1Y3Qgc3RybGlzdCAqcGF0dGVybjsKKwlzdHJ1Y3QgbGlzdF9yb2NrIHJvY2s7CisJcm9jay5v
cHRzID0gbGlzdG9wdHM7CisJcm9jay5sYXN0X25hbWUgPSBOVUxMOworCWlmIChsaXN0b3B0cyAm
IExJU1RfU0VMX1NVQlNDUklCRUQpIHsKKwkgICAgZm9yIChwYXR0ZXJuID0gcGF0dGVybnM7IHBh
dHRlcm47IHBhdHRlcm4gPSBwYXR0ZXJuLT5uZXh0KSB7CisJCXJvY2sudHJhaWxpbmdfcGVyY2Vu
dCA9CisJCSAgICBwYXR0ZXJuLT5zW3N0cmxlbihwYXR0ZXJuLT5zKSAtIDFdID09ICclJzsKKwkJ
ZmluZHN1YigmaW1hcGRfbmFtZXNwYWNlLCBwYXR0ZXJuLT5zLCBpbWFwZF91c2VyaXNhZG1pbiwK
KwkJCWltYXBkX3VzZXJpZCwgaW1hcGRfYXV0aHN0YXRlLCBzdWJzY3JpYmVkX2NiLCAmcm9jaywg
MSk7CisJCWxpc3RfcmVzcG9uc2Uocm9jay5sYXN0X25hbWUsIHJvY2subGFzdF9hdHRyaWJ1dGVz
LCByb2NrLm9wdHMpOworCQlmcmVlKHJvY2subGFzdF9uYW1lKTsKKwkJcm9jay5sYXN0X25hbWUg
PSBOVUxMOworCSAgICB9CisJfSBlbHNlIHsKKwkgICAgcm9jay5vcHRzIHw9IExJU1RfUkVUX0NI
SUxEUkVOOworCSAgICBmb3IgKHBhdHRlcm4gPSBwYXR0ZXJuczsgcGF0dGVybjsgcGF0dGVybiA9
IHBhdHRlcm4tPm5leHQpIHsKKwkJcm9jay50cmFpbGluZ19wZXJjZW50ID0KKwkJICAgIHBhdHRl
cm4tPnNbc3RybGVuKHBhdHRlcm4tPnMpIC0gMV0gPT0gJyUnOworCQlmaW5kYWxsKCZpbWFwZF9u
YW1lc3BhY2UsIHBhdHRlcm4tPnMsIGltYXBkX3VzZXJpc2FkbWluLAorCQkJaW1hcGRfdXNlcmlk
LCBpbWFwZF9hdXRoc3RhdGUsIGxpc3RfY2IsICZyb2NrKTsKKwkJbGlzdF9yZXNwb25zZShyb2Nr
Lmxhc3RfbmFtZSwgcm9jay5sYXN0X2F0dHJpYnV0ZXMsIHJvY2sub3B0cyk7CisJCWZyZWUocm9j
ay5sYXN0X25hbWUpOworCQlyb2NrLmxhc3RfbmFtZSA9IE5VTEw7CisJICAgIH0KKwl9CisgICAg
fQogfQogCiAvKgotICogSXNzdWUgYSBMSVNUIHVudGFnZ2VkIHJlc3BvbnNlCisgKiBSZXRyaWV2
ZXMgdGhlIGRhdGEgYW5kIHByaW50cyB0aGUgdW50YWdnZWQgcmVzcG9uc2VzIGZvciBhIExJU1Qg
Y29tbWFuZCBpbgorICogdGhlIGNhc2Ugb2YgYSByZW1vdGUgaW5ib3guCiAgKi8KLXN0YXRpYyBp
bnQgbGlzdGRhdGEoY2hhciAqbmFtZSwgaW50IG1hdGNobGVuLCBpbnQgbWF5Y3JlYXRlLCB2b2lk
ICpyb2NrKQorc3RhdGljIHZvaWQgbGlzdF9kYXRhX3JlbW90ZShjaGFyICp0YWcsIGludCBsaXN0
b3B0cywgY2hhciAqcmVmZXJlbmNlLAorCQkJICAgICBzdHJ1Y3Qgc3RybGlzdCAqcGF0dGVybikK
IHsKLSAgICBpbnQgbGlzdG9wdHMgPSAqKChpbnQgKilyb2NrKTsKLSAgICAKLSAgICBtc3RyaW5n
ZGF0YSgoKGxpc3RvcHRzICYgTElTVF9MU1VCKSA/ICJMU1VCIiA6ICJMSVNUIiksCi0JbmFtZSwg
bWF0Y2hsZW4sIG1heWNyZWF0ZSwgbGlzdG9wdHMpOworICAgIGlmIChsaXN0b3B0cyAmIExJU1Rf
T1BUX0VYVEVOREVECisJICAgICYmICFDQVBBKGJhY2tlbmRfaW5ib3gsIENBUEFfTElTVEVYVEVO
REVEKSkgeworCS8qIGNsaWVudCB3YW50cyB0byB1c2UgZXh0ZW5kZWQgbGlzdCBjb21tYW5kIGJ1
dCBiYWNrZW5kIGRvZXNuJ3QKKwkgKiBzdXBwb3J0IGl0ICovCisJcHJvdF9wcmludGYoYmFja2Vu
ZF9pbmJveC0+b3V0LAorCQkgICAgIiVzIE5PIEJhY2tlbmQgc2VydmVyIGRvZXMgbm90IHN1cHBv
cnQgZXh0ZW5kZWQgbGlzdCBjb21tYW5kXHJcbiIsCisJCSAgICB0YWcpOworCXJldHVybjsKKyAg
ICB9CiAKLSAgICByZXR1cm4gMDsKKyAgICAvKiBwcmludCB0YWcsIGNvbW1hbmQgYW5kIGxpc3Qg
c2VsZWN0aW9uIG9wdGlvbnMgKi8KKyAgICBpZiAobGlzdG9wdHMgJiBMSVNUX09QVF9FWFRFTkRF
RCkgeworCWludCBmaXJzdCA9IDE7CisJcHJvdF9wcmludGYoYmFja2VuZF9pbmJveC0+b3V0LCAi
JXMgTGlzdCAoIiwgdGFnKTsKKwlpZiAobGlzdG9wdHMgJiBMSVNUX1NFTF9TVUJTQ1JJQkVEKSB7
CisJICAgIHByb3RfcHJpbnRmKGJhY2tlbmRfaW5ib3gtPm91dCwgInN1YnNjcmliZWQiKTsKKwkg
ICAgZmlyc3QgPSAwOworCX0KKwlpZiAobGlzdG9wdHMgJiBMSVNUX1NFTF9SRU1PVEUpIHsKKwkg
ICAgcHJvdF9wcmludGYoYmFja2VuZF9pbmJveC0+b3V0LCAiIHJlbW90ZSIrZmlyc3QpOworCSAg
ICBmaXJzdCA9IDA7CisJfQorCWlmIChsaXN0b3B0cyAmIExJU1RfU0VMX1JFQ1VSU0lWRU1BVENI
KQorCSAgICBwcm90X3ByaW50ZihiYWNrZW5kX2luYm94LT5vdXQsICIgcmVjdXJzaXZlbWF0Y2gi
K2ZpcnN0KTsKKwlwcm90X3ByaW50ZihiYWNrZW5kX2luYm94LT5vdXQsICIpICIpOworICAgIH0g
ZWxzZSB7CisJcHJvdF9wcmludGYoYmFja2VuZF9pbmJveC0+b3V0LCAiJXMgTHN1YiAiLCB0YWcp
OworICAgIH0KKworICAgIC8qIHByaW50IHJlZmVyZW5jZSBhcmd1bWVudCAqLworICAgIHByb3Rf
cHJpbnRmKGJhY2tlbmRfaW5ib3gtPm91dCwKKwkJInslZCt9XHJcbiVzICIsIHN0cmxlbihyZWZl
cmVuY2UpLCByZWZlcmVuY2UpOworCisgICAgLyogcHJpbnQgbWFpbGJveCBwYXR0ZXJuKHMpICov
CisgICAgaWYgKHBhdHRlcm4tPm5leHQpIHsKKwlpbnQgZmlyc3QgPSAxOworCXByb3RfcHV0Yygn
KCcsIGJhY2tlbmRfaW5ib3gtPm91dCk7CisJZm9yICg7IHBhdHRlcm47IHBhdHRlcm4gPSBwYXR0
ZXJuLT5uZXh0KSB7CisJICAgIHByb3RfcHJpbnRmKGJhY2tlbmRfaW5ib3gtPm91dCwgCisJCQki
IHslZCt9XHJcbiVzIitmaXJzdCwgc3RybGVuKHBhdHRlcm4tPnMpLCBwYXR0ZXJuLT5zKTsKKwkg
ICAgZmlyc3QgPSAwOworCX0KKwlwcm90X3B1dGMoJyknLCBiYWNrZW5kX2luYm94LT5vdXQpOwor
ICAgIH0gZWxzZSB7CisJcHJvdF9wcmludGYoYmFja2VuZF9pbmJveC0+b3V0LCAKKwkJICAgICJ7
JWQrfVxyXG4lcyIsIHN0cmxlbihwYXR0ZXJuLT5zKSwgcGF0dGVybi0+cyk7CisJcGF0dGVybiA9
IHBhdHRlcm4tPm5leHQ7CisgICAgfQorCisgICAgLyogcHJpbnQgbGlzdCByZXR1cm4gb3B0aW9u
cyAqLworICAgIGlmIChsaXN0b3B0cyAmIGxpc3RfcmV0X29wdHMpIHsKKwlwcm90X3ByaW50Zihi
YWNrZW5kX2luYm94LT5vdXQsICIgcmV0dXJuICgiKTsKKwlpbnQgZmlyc3QgPSAxOworCWlmIChs
aXN0b3B0cyAmIExJU1RfUkVUX1NVQlNDUklCRUQpIHsKKwkgICAgcHJvdF9wcmludGYoYmFja2Vu
ZF9pbmJveC0+b3V0LCAic3Vic2NyaWJlZCIpOworCSAgICBmaXJzdCA9IDA7CisJfQorCWlmIChs
aXN0b3B0cyAmIExJU1RfUkVUX0NISUxEUkVOKSB7CisJICAgIHByb3RfcHJpbnRmKGJhY2tlbmRf
aW5ib3gtPm91dCwgIiBjaGlsZHJlbiIrZmlyc3QpOworCX0KKwlwcm90X3B1dGMoJyknLCBiYWNr
ZW5kX2luYm94LT5vdXQpOworICAgIH0KKworICAgIHByb3RfcHJpbnRmKGJhY2tlbmRfaW5ib3gt
Pm91dCwgIlxyXG4iKTsKKyAgICBwaXBlX2xzdWIoYmFja2VuZF9pbmJveCwgdGFnLCAwLAorCSAg
ICAgIChsaXN0b3B0cyAmIExJU1RfT1BUX0xTVUIpID8gIkxTVUIiIDogIkxJU1QiKTsKIH0KIAog
LyogUmVzZXQgdGhlIGdpdmVuIHNhc2xfY29ubl90IHRvIGEgc2FuZSBzdGF0ZSAqLwpkaWZmIC1O
YXVyIC0tZXhjbHVkZT0uc3ZuIC4uL2JyYW5jaGVzL2N5cnVzaGVhZC9pbWFwL2ltYXBkLmggLi9p
bWFwL2ltYXBkLmgKLS0tIC4uL2JyYW5jaGVzL2N5cnVzaGVhZC9pbWFwL2ltYXBkLmgJMjAwNi0w
My0zMSAyMToyMjoyMS4wMDAwMDAwMDAgKzAyMDAKKysrIC4vaW1hcC9pbWFwZC5oCTIwMDYtMTAt
MDQgMTY6NDk6MDQuMDAwMDAwMDAwICswMjAwCkBAIC0yMjUsMTQgKzIyNSw0NSBAQAogICAgIFNU
QVRVU19ISUdIRVNUTU9EU0VRID0JKDE8PDUpCiB9OwogCi0vKiBCaXRtYXNrIGZvciBsaXN0IG9w
dGlvbnMgKi8KIGVudW0gewotICAgIExJU1RfTFNVQiA9CQkJKDE8PDApLAotICAgIExJU1RfRVhU
ID0JCQkoMTw8MSksCi0gICAgTElTVF9TVUJTQ1JJQkVEID0JCSgxPDwyKSwKLSAgICBMSVNUX0NI
SUxEUkVOID0JCSgxPDwzKSwKLSAgICBMSVNUX1JFTU9URSA9CQkoMTw8NCkKKyAgICAvKiBMSVNU
IHNlbGVjdGlvbiBvcHRpb25zICovCisgICAgTElTVF9TRUxfU1VCU0NSSUJFRCA9CSgxPDwwKSwK
KyAgICBMSVNUX1NFTF9SRU1PVEUgPQkJKDE8PDEpLAorICAgIExJU1RfU0VMX1JFQ1VSU0lWRU1B
VENIID0JKDE8PDIpLAorCisgICAgLyogTElTVCByZXR1cm4gb3B0aW9ucyAqLworICAgIExJU1Rf
UkVUX1NVQlNDUklCRUQgPQkoMTw8OCksCisgICAgTElTVF9SRVRfQ0hJTERSRU4gPQkJKDE8PDkp
LAorCisgICAgLyogb3RoZXIgb3B0aW9ucyAqLworICAgIExJU1RfT1BUX1JMSVNUID0gICAgICAg
ICAgICAoMTw8MTYpLAorICAgIExJU1RfT1BUX0xTVUIgPSAgICAgICAgICAgICAoMTw8MTcpLAor
ICAgIExJU1RfT1BUX0VYVEVOREVEID0gICAgICAgICAoMTw8MTgpLCAvKiBleHRlbmRlZCBMaXN0
IGNvbW1hbmQgKi8KKyAgICAvKiAuLi4gYXMgc3BlY2lmaWVkIGluIGRyYWZ0LWlldGYtaW1hcGV4
dC1saXN0LWV4dGVuc2lvbnMtMDMudHh0ICovCisgICAgTElTVF9PUFRfRVhURU5ERURfVjAzID0g
ICAgICgxPDwxOSksCisgICAgLyogLi4uIGFzIHNwZWNpZmllZCBpbiBkcmFmdC1pZXRmLWltYXBl
eHQtbGlzdC1leHRlbnNpb25zLTE3LnR4dCAqLworICAgIExJU1RfT1BUX0VYVEVOREVEX1YxNyA9
ICAgICAoMTw8MjApCiB9OworI2RlZmluZSBsaXN0X3NlbF9vcHRzIChMSVNUX1JFVF9TVUJTQ1JJ
QkVEIC0gMSkKKyNkZWZpbmUgbGlzdF9yZXRfb3B0cyAoKExJU1RfT1BUX1JMSVNUIC0gMSkgJiB+
bGlzdF9zZWxfb3B0cykKKworLyogTmFtZSBhdHRyaWJ1dGVzIHRoYXQgbWF5IGJlIHJldHVuZWQg
YnkgTElTVCAqLworZW51bSB7CisgICAgLyogZnJvbSBSRkMgMzUwMSAqLworICAgIE1CT1hfQVRU
UklCVVRFX05PSU5GRVJJT1JTICAgPSAoMTw8MCksCisgICAgTUJPWF9BVFRSSUJVVEVfTk9TRUxF
Q1QgICAgICA9ICgxPDwxKSwKKyAgICBNQk9YX0FUVFJJQlVURV9NQVJLRUQgICAgICAgID0gKDE8
PDIpLAorICAgIE1CT1hfQVRUUklCVVRFX1VOTUFSS0VEICAgICAgPSAoMTw8MyksCisKKyAgICAv
KiBmcm9tIGRyYWZ0LWlldGYtaW1hcGV4dC1saXN0LWV4dGVuc2lvbnMtMTcudHh0ICovCisgICAg
TUJPWF9BVFRSSUJVVEVfTk9ORVhJU1RFTlQgICA9ICgxPDw0KSwKKyAgICBNQk9YX0FUVFJJQlVU
RV9TVUJTQ1JJQkVEICAgID0gKDE8PDUpLAorICAgIE1CT1hfQVRUUklCVVRFX1JFTU9URSAgICAg
ICAgPSAoMTw8NiksCisgICAgTUJPWF9BVFRSSUJVVEVfSEFTQ0hJTERSRU4gICA9ICgxPDw3KSwK
KyAgICBNQk9YX0FUVFJJQlVURV9IQVNOT0NISUxEUkVOID0gKDE8PDgpLAorICAgIE1CT1hfQVRU
UklCVVRFX0NISUxESU5GT19TVUJTQ1JJQkVEID0gKDE8PDkpCit9OworI2RlZmluZSBsaXN0X2No
aWxkaW5mbyAoTUJPWF9BVFRSSUJVVEVfQ0hJTERJTkZPX1NVQlNDUklCRUQpCiAKIGV4dGVybiBz
dHJ1Y3QgcHJvdHN0cmVhbSAqaW1hcGRfb3V0LCAqaW1hcGRfaW47CiAKZGlmZiAtTmF1ciAtLWV4
Y2x1ZGU9LnN2biAuLi9icmFuY2hlcy9jeXJ1c2hlYWQvaW1hcC9wcm90b2NvbC5jIC4vaW1hcC9w
cm90b2NvbC5jCi0tLSAuLi9icmFuY2hlcy9jeXJ1c2hlYWQvaW1hcC9wcm90b2NvbC5jCTIwMDYt
MDgtMDIgMTc6MTY6MjAuMDAwMDAwMDAwICswMjAwCisrKyAuL2ltYXAvcHJvdG9jb2wuYwkyMDA2
LTA4LTExIDEzOjM5OjI1LjAwMDAwMDAwMCArMDIwMApAQCAtMTE1LDYgKzExNSw3IEBACiAJICB7
ICIgTVVMVElBUFBFTkQiLCBDQVBBX01VTFRJQVBQRU5EIH0sCiAJICB7ICIgTElTVC1TVUJTQ1JJ
QkVEIiwgQ0FQQV9MSVNUU1VCU0NSSUJFRCB9LAogCSAgeyAiIFJJR0hUUz1reHRlIiwgQ0FQQV9B
Q0xSSUdIVFMgfSwKKwkgIHsgIiBMSVNULUVYVEVOREVEIiwgQ0FQQV9MSVNURVhURU5ERUQgfSwK
IAkgIHsgTlVMTCwgMCB9IH0gfSwKICAgICAgIHsgIlMwMSBTVEFSVFRMUyIsICJTMDEgT0siLCAi
UzAxIE5PIiB9LAogICAgICAgeyAiQTAxIEFVVEhFTlRJQ0FURSIsIDAsIDAsICJBMDEgT0siLCAi
QTAxIE5PIiwgIisgIiwgIioiLCBOVUxMIH0sCmRpZmYgLU5hdXIgLS1leGNsdWRlPS5zdm4gLi4v
YnJhbmNoZXMvY3lydXNoZWFkL2ltYXAvcHJvdG9jb2wuaCAuL2ltYXAvcHJvdG9jb2wuaAotLS0g
Li4vYnJhbmNoZXMvY3lydXNoZWFkL2ltYXAvcHJvdG9jb2wuaAkyMDA2LTA4LTAyIDE3OjE2OjIw
LjAwMDAwMDAwMCArMDIwMAorKysgLi9pbWFwL3Byb3RvY29sLmgJMjAwNi0wOC0xMSAxMzozOToy
NS4wMDAwMDAwMDAgKzAyMDAKQEAgLTU3LDEzICs1NywxNCBAQAogICAgIENBUEFfTVVMVElBUFBF
TkQJPSAoMSA8PCA0KSwKICAgICBDQVBBX0xJU1RTVUJTQ1JJQkVECT0gKDEgPDwgNSksCiAgICAg
Q0FQQV9BQ0xSSUdIVFMJPSAoMSA8PCA2KSwKKyAgICBDQVBBX0xJU1RFWFRFTkRFRCAgID0gKDEg
PDwgNyksCiAKICAgICAvKiBMTVRQIGNhcGFiaWxpdGllcyAqLwogICAgIENBUEFfUElQRUxJTklO
Rwk9ICgxIDw8IDIpLAogICAgIENBUEFfSUdOT1JFUVVPVEEJPSAoMSA8PCAzKQogfTsKIAotI2Rl
ZmluZSBNQVhfQ0FQQSA3CisjZGVmaW5lIE1BWF9DQVBBIDgKIAogc3RydWN0IGNhcGFfdCB7CiAg
ICAgY29uc3QgY2hhciAqc3RyOwo=
</data>        

          </attachment>
          <attachment
              isobsolete="0"
              ispatch="1"
              isprivate="0"
          >
            <attachid>473</attachid>
            <date>2006-10-25 14:24 EDT</date>
            <desc>Ken&apos;s modified patch</desc>
            <filename>list-extended.patch</filename>
            <type>text/plain</type>
            <size>46001</size>
            <attacher>murch@andrew.cmu.edu</attacher>
            
              <data encoding="base64">SW5kZXg6IGNvbmZpZ3VyZS5pbgo9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09ClJDUyBmaWxlOiAvYWZzL2FuZHJldy9zeXN0
ZW0vY3ZzL3NyYy9jeXJ1cy9jb25maWd1cmUuaW4sdgpyZXRyaWV2aW5nIHJldmlzaW9uIDEuMjY4
LjIuMjMKZGlmZiAtdSAtcjEuMjY4LjIuMjMgY29uZmlndXJlLmluCi0tLSBjb25maWd1cmUuaW4J
MTIgQXByIDIwMDUgMjA6MDU6MjAgLTAwMDAJMS4yNjguMi4yMworKysgY29uZmlndXJlLmluCTI1
IE9jdCAyMDA2IDE4OjE2OjI4IC0wMDAwCkBAIC05MzMsMTIgKzkzMyw2IEBACiAJZmksCiAJQUNf
TVNHX1JFU1VMVChubykpCiAKLUFDX0FSR19FTkFCTEUobGlzdGV4dCwKLQlbICAtLWVuYWJsZS1s
aXN0ZXh0ICAgICAgICBlbmFibGUgSU1BUCBMaXN0IGV4dGVuc2lvbnNdLAotCWlmIHRlc3QgIiRl
bmFibGV2YWwiID0geWVzOyB0aGVuCi0JCUFDX0RFRklORShFTkFCTEVfTElTVEVYVCxbXSxbRW5h
YmxlIHRoZSBMSVNURVhUIGV4dGVuc2lvbj9dKQotCWZpKQotCiBBQ19BUkdfRU5BQkxFKG5ldHNj
YXBlaGFjaywKIAlbICAtLWVuYWJsZS1uZXRzY2FwZWhhY2sgICBlbmFibGUgTmV0c2NhcGUgaGFj
ayBmb3IgdGhlIG1lbnUgb3B0aW9uCiAgICAgICAgICAgICAgICAgICAgICAgICAgIGluIENvbW11
bmljYXRvciB0byBBZG1pbmlzdHJhdGUgTWFpbF0sCkluZGV4OiBkb2Mvc3BlY3MuaHRtbAo9PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09ClJDUyBmaWxlOiAvYWZzL2FuZHJldy9zeXN0ZW0vY3ZzL3NyYy9jeXJ1cy9kb2Mvc3Bl
Y3MuaHRtbCx2CnJldHJpZXZpbmcgcmV2aXNpb24gMS41MC4yLjMyCmRpZmYgLXUgLXIxLjUwLjIu
MzIgc3BlY3MuaHRtbAotLS0gZG9jL3NwZWNzLmh0bWwJMTYgSnVuIDIwMDYgMTU6MTA6MjggLTAw
MDAJMS41MC4yLjMyCisrKyBkb2Mvc3BlY3MuaHRtbAkyNSBPY3QgMjAwNiAxODoxNjoyOCAtMDAw
MApAQCAtNTQsNyArNTQsNyBAQAogPFRSPjxURD48QSBIUkVGPSJodHRwOi8vd3d3LmlldGYub3Jn
L2ludGVybmV0LWRyYWZ0cy9kcmFmdC1pZXRmLWltYXBleHQtc29ydC0xNy50eHQiPgogZHJhZnQt
aWV0Zi1pbWFwZXh0LXNvcnQ8L0E+PC9URD4KIDxURD5JTUFQIFNPUlQgYW5kIFRIUkVBRCBFeHRl
bnNpb248L1REPjwvVFI+Ci08VFI+PFREPjxBIEhSRUY9Imh0dHA6Ly93d3cuaWV0Zi5vcmcvaW50
ZXJuZXQtZHJhZnRzL2RyYWZ0LWlldGYtaW1hcGV4dC1saXN0LWV4dGVuc2lvbnMtMTMudHh0Ij4K
KzxUUj48VEQ+PEEgSFJFRj0iaHR0cDovL3d3dy5pZXRmLm9yZy9pbnRlcm5ldC1kcmFmdHMvZHJh
ZnQtaWV0Zi1pbWFwZXh0LWxpc3QtZXh0ZW5zaW9ucy0xOC50eHQiPgogZHJhZnQtaWV0Zi1pbWFw
ZXh0LWxpc3QtZXh0ZW5zaW9uczwvQT48L1REPgogPFREPklNQVA0IExJU1QgQ29tbWFuZCBFeHRl
bnNpb25zPC9URD48L1RSPgogPFRSPjxURD48QSBIUkVGPSJodHRwOi8vd3d3LmlldGYub3JnL2lu
dGVybmV0LWRyYWZ0cy9kcmFmdC1kYWJvby1pbWFwLWFubm90YXRlbW9yZS0wOS50eHQiPgpJbmRl
eDogaW1hcC9pbWFwZC5jCj09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT0KUkNTIGZpbGU6IC9hZnMvYW5kcmV3L3N5c3RlbS9j
dnMvc3JjL2N5cnVzL2ltYXAvaW1hcGQuYyx2CnJldHJpZXZpbmcgcmV2aXNpb24gMS40NDMuMi45
MApkaWZmIC11IC1yMS40NDMuMi45MCBpbWFwZC5jCi0tLSBpbWFwL2ltYXBkLmMJMyBPY3QgMjAw
NiAyMDowODoyNyAtMDAwMAkxLjQ0My4yLjkwCisrKyBpbWFwL2ltYXBkLmMJMjUgT2N0IDIwMDYg
MTg6MTY6MjkgLTAwMDAKQEAgLTY4LDEwICs2OCwxMiBAQAogI2luY2x1ZGUgImFwcGVuZC5oIgog
I2luY2x1ZGUgImF1dGguaCIKICNpbmNsdWRlICJiYWNrZW5kLmgiCisjaW5jbHVkZSAiYnNlYXJj
aC5oIgogI2luY2x1ZGUgImNoYXJzZXQuaCIKICNpbmNsdWRlICJleGl0Y29kZXMuaCIKICNpbmNs
dWRlICJpZGxlLmgiCiAjaW5jbHVkZSAiZ2xvYmFsLmgiCisjaW5jbHVkZSAiaGFzaC5oIgogI2lu
Y2x1ZGUgImltYXBfZXJyLmgiCiAjaW5jbHVkZSAicHJveHkuaCIKICNpbmNsdWRlICJpbWFwX3By
b3h5LmgiCkBAIC0xNTUsNiArMTU3LDcgQEAKIHN0YXRpYyBzYXNsX2Nvbm5fdCAqaW1hcGRfc2Fz
bGNvbm47IC8qIHRoZSBzYXNsIGNvbm5lY3Rpb24gY29udGV4dCAqLwogc3RhdGljIGludCBpbWFw
ZF9zdGFydHRsc19kb25lID0gMDsgLyogaGF2ZSB3ZSBkb25lIGEgc3VjY2Vzc2Z1bCBzdGFydHRs
cz8gKi8KIGNvbnN0IGNoYXIgKnBsYWludGV4dGxvZ2luYWxlcnQgPSBOVUxMOworCiAjaWZkZWYg
SEFWRV9TU0wKIC8qIG91ciB0bHMgY29ubmVjdGlvbiwgaWYgYW55ICovCiBzdGF0aWMgU1NMICp0
bHNfY29ubiA9IE5VTEw7CkBAIC0xOTQsNiArMTk3LDYwIEBACiAgICAgMzEsIDMxLCAzMCwgMzEs
IDMwLCAzMQogfTsKIAorc3RhdGljIHN0cnVjdCBtYm94X25hbWVfYXR0cmlidXRlIHsKKyAgICBp
bnQgZmxhZzsKKyAgICBjaGFyICppZDsKK30gbWJveF9uYW1lX2F0dHJpYnV0ZXNbXSA9IHsKKyAg
ICAvKiBmcm9tIFJGQyAzNTAxICovCisgICAgeyBNQk9YX0FUVFJJQlVURV9OT0lORkVSSU9SUywg
ICAiXFxOb2luZmVyaW9ycyIgICB9LAorICAgIHsgTUJPWF9BVFRSSUJVVEVfTk9TRUxFQ1QsICAg
ICAgIlxcTm9zZWxlY3QiICAgICAgfSwKKyAgICB7IE1CT1hfQVRUUklCVVRFX01BUktFRCwgICAg
ICAgICJcXE1hcmtlZCIgICAgICAgIH0sCisgICAgeyBNQk9YX0FUVFJJQlVURV9VTk1BUktFRCwg
ICAgICAiXFxVbm1hcmtlZCIgICAgICB9LAorCisgICAgLyogZnJvbSBkcmFmdC1pZXRmLWltYXBl
eHQtbGlzdC1leHRlbnNpb25zLTE4LnR4dCAqLworICAgIHsgTUJPWF9BVFRSSUJVVEVfTk9ORVhJ
U1RFTlQsICAgIlxcTm9uRXhpc3RlbnQiICAgfSwKKyAgICB7IE1CT1hfQVRUUklCVVRFX1NVQlND
UklCRUQsICAgICJcXFN1YnNjcmliZWQiICAgIH0sCisgICAgeyBNQk9YX0FUVFJJQlVURV9SRU1P
VEUsICAgICAgICAiXFxSZW1vdGUiICAgICAgICB9LAorICAgIHsgTUJPWF9BVFRSSUJVVEVfSEFT
Q0hJTERSRU4sICAgIlxcSGFzQ2hpbGRyZW4iICAgfSwKKyAgICB7IE1CT1hfQVRUUklCVVRFX0hB
U05PQ0hJTERSRU4sICJcXEhhc05vQ2hpbGRyZW4iIH0sCisKKyAgICB7IDAsIE5VTEwgfQorfTsK
KworLyoKKyAqIFRoZXNlIGJpdG1hc2tzIGRlZmluZSBob3cgTGlzdCBzZWxlY3Rpb24gb3B0aW9u
cyBjYW4gYmUgY29tYmluZWQ6CisgKiBsaXN0X3NlbGVjdF9tb2Rfb3B0cyBtYXkgb25seSBiZSB1
c2VkIGlmIGF0IGxlYXN0IG9uZSBsaXN0X3NlbGVjdF9iYXNlX29wdAorICogaXMgYWxzbyBwcmVz
ZW50LgorICogRm9yIGV4YW1wbGUsIChSRUNVUlNJVkVNQVRDSCkgYW5kIChSRUNVUlNJVkVNQVRD
SCBSRU1PVEUpIGFyZSBpbnZhbGlkLCBidXQKKyAqIChSRUNVUlNJVkVNQVRDSCBTVUJTQ1JJQkVE
KSBpcyBvay4KKyAqLworc3RhdGljIGNvbnN0IGludCBsaXN0X3NlbGVjdF9iYXNlX29wdHMgPSBM
SVNUX1NFTF9TVUJTQ1JJQkVEOworc3RhdGljIGNvbnN0IGludCBsaXN0X3NlbGVjdF9tb2Rfb3B0
cyAgPSBMSVNUX1NFTF9SRUNVUlNJVkVNQVRDSDsKKworLyogc3RydWN0dXJlIHRoYXQgbGlzdF9k
YXRhIHBhc3NlcyBpdHMgY2FsbGJhY2tzICovCitzdHJ1Y3QgbGlzdF9yb2NrIHsKKyAgICBpbnQg
b3B0czsKKyAgICBjaGFyICpsYXN0X25hbWU7CisgICAgaW50IGxhc3RfYXR0cmlidXRlczsKKyAg
ICBpbnQgdHJhaWxpbmdfcGVyY2VudDsgLyogdGhlIG1haWxib3ggbmFtZSBhcmcgZW5kcyB3aXRo
IGEgJQorICAgICAgICAgICAgICAgICAgICAgICAgICAgKiBjYXVzZXMgc3BlY2lhbCBiZWhhdmlv
ciB3aXRoIG5vbi1leHRlbmRlZCBMSVNUCisJCQkgICAqIGFuZCBMU1VCICovCit9OworCisvKiBJ
bmZvcm1hdGlvbiBhYm91dCBvbmUgbWFpbGJveCBuYW1lIHRoYXQgTElTVCByZXR1cm5zICovCitz
dHJ1Y3QgbGlzdF9lbnRyeSB7CisgICAgY2hhciAqbmFtZTsKKyAgICBpbnQgYXR0cmlidXRlczsg
LyogYml0bWFwIG9mIE1CT1hfQVRUUklCVVRFXyogKi8KK307CisKKy8qIHN0cnVjdHVyZSB0aGF0
IGxpc3RfZGF0YV9yZWN1cnNpdmVtYXRjaCBwYXNzZXMgaXRzIGNhbGxiYWNrcyAqLworc3RydWN0
IGxpc3Rfcm9ja19yZWN1cnNpdmVtYXRjaCB7CisgICAgaW50IG9wdHM7CisgICAgc3RydWN0IGhh
c2hfdGFibGUgdGFibGU7ICAgIC8qIG1hcHMgbWFpbGJveCBuYW1lcyB0byBhdHRyaWJ1dGVzIChp
bnQgKikgKi8KKyAgICBpbnQgY291bnQ7ICAgICAgICAgICAgICAgICAgLyogIyBvZiBlbnRyaWVz
IGluIHRhYmxlICovCisgICAgc3RydWN0IGxpc3RfZW50cnkgKmFycmF5OworfTsKKwogdm9pZCBt
b3RkX2ZpbGUoaW50IGZkKTsKIHZvaWQgc2h1dF9kb3duKGludCBjb2RlKTsKIHZvaWQgZmF0YWwo
Y29uc3QgY2hhciAqcywgaW50IGNvZGUpOwpAQCAtMjI0LDcgKzI4MSwxMCBAQAogdm9pZCBjbWRf
cmVuYW1lKGNoYXIgKnRhZywgY2hhciAqb2xkbmFtZSwgY2hhciAqbmV3bmFtZSwgY2hhciAqcGFy
dGl0aW9uKTsKIHZvaWQgY21kX3JlY29uc3RydWN0KGNvbnN0IGNoYXIgKnRhZywgY29uc3QgY2hh
ciAqbmFtZSwgaW50IHJlY3Vyc2l2ZSk7CiB2b2lkIGNtZF9maW5kKGNoYXIgKnRhZywgY2hhciAq
bmFtZXNwYWNlLCBjaGFyICpwYXR0ZXJuKTsKLXZvaWQgY21kX2xpc3QoY2hhciAqdGFnLCBpbnQg
bGlzdG9wdHMsIGNoYXIgKnJlZmVyZW5jZSwgY2hhciAqcGF0dGVybik7Cit2b2lkIHBhcnNlX2xp
c3QoY2hhciAqdGFnLCBpbnQgKmxpc3RvcHRzLCBzdHJ1Y3QgYnVmICpyZWZlcmVuY2UsCisJCXN0
cnVjdCBzdHJsaXN0ICoqcGF0dGVybnMpOwordm9pZCBjbWRfbGlzdChjaGFyICp0YWcsIGludCBs
aXN0b3B0cywgY2hhciAqcmVmZXJlbmNlLAorCSAgICAgIHN0cnVjdCBzdHJsaXN0ICpwYXR0ZXJu
cyk7CiB2b2lkIGNtZF9jaGFuZ2VzdWIoY2hhciAqdGFnLCBjaGFyICpuYW1lc3BhY2UsIGNoYXIg
Km5hbWUsIGludCBhZGQpOwogdm9pZCBjbWRfZ2V0YWNsKGNvbnN0IGNoYXIgKnRhZywgY29uc3Qg
Y2hhciAqbmFtZSk7CiB2b2lkIGNtZF9saXN0cmlnaHRzKGNoYXIgKnRhZywgY2hhciAqbmFtZSwg
Y2hhciAqaWRlbnRpZmllcik7CkBAIC0yNjYsOSArMzI2LDggQEAKIAogdm9pZCBhbm5vdGF0ZV9y
ZXNwb25zZShzdHJ1Y3QgZW50cnlhdHRsaXN0ICpsKTsKIAotI2lmZGVmIEVOQUJMRV9MSVNURVhU
Ci1pbnQgZ2V0bGlzdG9wdHMoY2hhciAqdGFnLCBpbnQgKmxpc3RvcHRzKTsKLSNlbmRpZgoraW50
IGdldGxpc3RzZWxvcHRzKGNoYXIgKnRhZywgaW50ICpvcHRzKTsKK2ludCBnZXRsaXN0cmV0b3B0
cyhjaGFyICp0YWcsIGludCAqb3B0cyk7CiAKIGludCBnZXRzZWFyY2hwcm9ncmFtKGNoYXIgKnRh
Zywgc3RydWN0IHNlYXJjaGFyZ3MgKnNlYXJjaGFyZ3MsCiAJCQlpbnQgKmNoYXJzZXQsIGludCBw
YXJzZWNoYXJzZXQpOwpAQCAtMjkyLDkgKzM1MSwyMSBAQAogc3RhdGljIHZvaWQgZnJlZXNvcnRj
cml0KHN0cnVjdCBzb3J0Y3JpdCAqcyk7CiAKIHN0YXRpYyBpbnQgbWFpbGJveGRhdGEoY2hhciAq
bmFtZSwgaW50IG1hdGNobGVuLCBpbnQgbWF5Y3JlYXRlLCB2b2lkICpyb2NrKTsKLXN0YXRpYyBp
bnQgbGlzdGRhdGEoY2hhciAqbmFtZSwgaW50IG1hdGNobGVuLCBpbnQgbWF5Y3JlYXRlLCB2b2lk
ICpyb2NrKTsKLXN0YXRpYyB2b2lkIG1zdHJpbmdkYXRhKGNoYXIgKmNtZCwgY2hhciAqbmFtZSwg
aW50IG1hdGNobGVuLCBpbnQgbWF5Y3JlYXRlLAotCQkJaW50IGxpc3RvcHRzKTsKKworc3RhdGlj
IGludCBzZXRfaGFzY2hpbGRyZW4oY2hhciAqbmFtZSwgaW50IG1hdGNobGVuLCBpbnQgbWF5Y3Jl
YXRlLAorCQkJICAgaW50ICphdHRyaWJ1dGVzKTsKK3N0YXRpYyB2b2lkIGxpc3RfcmVzcG9uc2Uo
Y2hhciAqbmFtZSwgaW50IGF0dHJpYnV0ZXMsIGludCBvcHRzKTsKK3N0YXRpYyBpbnQgc2V0X3N1
YnNjcmliZWQoY2hhciAqbmFtZSwgaW50IG1hdGNobGVuLCBpbnQgbWF5Y3JlYXRlLAorCQkJICBp
bnQgKmF0dHJpYnV0ZXMpOworc3RhdGljIGNoYXIgKmNhbm9uaWNhbF9saXN0X3BhdHRlcm4oY29u
c3QgY2hhciAqcmVmZXJlbmNlLCBjb25zdCBjaGFyICpwYXR0ZXJuKTsKK3N0YXRpYyB2b2lkIGNh
bm9uaWNhbF9saXN0X3BhdHRlcm5zKGNoYXIgKnJlZmVyZW5jZSwgc3RydWN0IHN0cmxpc3QgKnBh
dHRlcm5zKTsKK3N0YXRpYyBpbnQgbGlzdF9jYihjaGFyICpuYW1lLCBpbnQgbWF0Y2hsZW4sIGlu
dCBtYXljcmVhdGUsCisJCSAgc3RydWN0IGxpc3Rfcm9jayAqcm9jayk7CitzdGF0aWMgaW50IHN1
YnNjcmliZWRfY2IoY2hhciAqbmFtZSwgaW50IG1hdGNobGVuLCBpbnQgbWF5Y3JlYXRlLAorCQkJ
IHN0cnVjdCBsaXN0X3JvY2sgKnJvY2spOworc3RhdGljIHZvaWQgbGlzdF9kYXRhKGludCBsaXN0
b3B0cywgY2hhciAqcmVmZXJlbmNlLCBzdHJ1Y3Qgc3RybGlzdCAqcGF0dGVybnMpOworc3RhdGlj
IHZvaWQgbGlzdF9kYXRhX3JlbW90ZShjaGFyICp0YWcsIGludCBsaXN0b3B0cywgY2hhciAqcmVm
ZXJlbmNlLAorCQkJICAgICBzdHJ1Y3Qgc3RybGlzdCAqcGF0dGVybik7CiAKIGV4dGVybiB2b2lk
IHNldHByb2N0aXRsZV9pbml0KGludCBhcmdjLCBjaGFyICoqYXJndiwgY2hhciAqKmVudnApOwog
ZXh0ZXJuIGludCBwcm9jX3JlZ2lzdGVyKGNvbnN0IGNoYXIgKnByb2duYW1lLCBjb25zdCBjaGFy
ICpjbGllbnRob3N0LCAKQEAgLTEzNTYsMzcgKzE0MjcsMzIgQEAKIAkgICAgfQogCSAgICBlbHNl
IGlmICghaW1hcGRfdXNlcmlkKSBnb3RvIG5vbG9naW47CiAJICAgIGVsc2UgaWYgKCFzdHJjbXAo
Y21kLnMsICJMaXN0IikpIHsKLQkJaW50IGxpc3RvcHRzID0gTElTVF9DSElMRFJFTjsKLSNpZmRl
ZiBFTkFCTEVfTElTVEVYVAotCQkvKiBDaGVjayBmb3IgYW5kIHBhcnNlIExJU1RFWFQgb3B0aW9u
cyAqLwotCQljID0gcHJvdF9nZXRjKGltYXBkX2luKTsKLQkJaWYgKGMgPT0gJygnKSB7Ci0JCSAg
ICBjID0gZ2V0bGlzdG9wdHModGFnLnMsICZsaXN0b3B0cyk7Ci0JCSAgICBpZiAoYyA9PSBFT0Yp
IHsKLQkJCWVhdGxpbmUoaW1hcGRfaW4sIGMpOwotCQkJY29udGludWU7Ci0JCSAgICB9Ci0JCX0K
LQkJZWxzZQotCQkgICAgcHJvdF91bmdldGMoYywgaW1hcGRfaW4pOwotI2VuZGlmIC8qIEVOQUJM
RV9MSVNURVhUICovCi0JCWlmIChpbWFwZF9tYWdpY3BsdXMpIGxpc3RvcHRzICs9IExJU1RfU1VC
U0NSSUJFRDsKLQkJYyA9IGdldGFzdHJpbmcoaW1hcGRfaW4sIGltYXBkX291dCwgJmFyZzEpOwor
CQlpbnQgbGlzdG9wdHMgPSAwOworCQlzdHJ1Y3Qgc3RybGlzdCAqcGF0dGVybnMgPSBOVUxMOwor
CiAJCWlmIChjICE9ICcgJykgZ290byBtaXNzaW5nYXJnczsKLQkJYyA9IGdldGFzdHJpbmcoaW1h
cGRfaW4sIGltYXBkX291dCwgJmFyZzIpOwotCQlpZiAoYyA9PSAnXHInKSBjID0gcHJvdF9nZXRj
KGltYXBkX2luKTsKLQkJaWYgKGMgIT0gJ1xuJykgZ290byBleHRyYWFyZ3M7Ci0JCWNtZF9saXN0
KHRhZy5zLCBsaXN0b3B0cywgYXJnMS5zLCBhcmcyLnMpOworCisJCXBhcnNlX2xpc3QodGFnLnMs
ICZsaXN0b3B0cywgJmFyZzEsICZwYXR0ZXJucyk7CisJCWlmIChwYXR0ZXJucyl7CisJCSAgICBj
bWRfbGlzdCh0YWcucywgbGlzdG9wdHMsIGFyZzEucywgcGF0dGVybnMpOworCQkgICAgZnJlZXN0
cmxpc3QocGF0dGVybnMpOworCQl9CiAKIAkJc25tcF9pbmNyZW1lbnQoTElTVF9DT1VOVCwgMSk7
CiAJICAgIH0KIAkgICAgZWxzZSBpZiAoIXN0cmNtcChjbWQucywgIkxzdWIiKSkgeworCQlzdHJ1
Y3Qgc3RybGlzdCAqcGF0dGVybiA9IE5VTEw7CisKIAkJYyA9IGdldGFzdHJpbmcoaW1hcGRfaW4s
IGltYXBkX291dCwgJmFyZzEpOwogCQlpZiAoYyAhPSAnICcpIGdvdG8gbWlzc2luZ2FyZ3M7CiAJ
CWMgPSBnZXRhc3RyaW5nKGltYXBkX2luLCBpbWFwZF9vdXQsICZhcmcyKTsKIAkJaWYgKGMgPT0g
J1xyJykgYyA9IHByb3RfZ2V0YyhpbWFwZF9pbik7CiAJCWlmIChjICE9ICdcbicpIGdvdG8gZXh0
cmFhcmdzOwotCQljbWRfbGlzdCh0YWcucywgTElTVF9MU1VCIHwgTElTVF9DSElMRFJFTiwgYXJn
MS5zLCBhcmcyLnMpOworCisJCWFwcGVuZHN0cmxpc3QoJnBhdHRlcm4sIGFyZzIucyk7CisJCWNt
ZF9saXN0KHRhZy5zLCBMSVNUX09QVF9MU1VCIHwgTElTVF9TRUxfU1VCU0NSSUJFRCwKKwkJCSBh
cmcxLnMsIHBhdHRlcm4pOworCQlmcmVlc3RybGlzdChwYXR0ZXJuKTsKIAogCQlzbm1wX2luY3Jl
bWVudChMU1VCX0NPVU5ULCAxKTsKIAkgICAgfQpAQCAtMTU1MywyMyArMTYxOSwzOCBAQAogCQkv
KiBzbm1wX2luY3JlbWVudChSRUNPTlNUUlVDVF9DT1VOVCwgMSk7ICovCiAJICAgIH0gCiAJICAg
IGVsc2UgaWYgKCFzdHJjbXAoY21kLnMsICJSbGlzdCIpKSB7CisJCXN0cnVjdCBzdHJsaXN0ICpw
YXR0ZXJuID0gTlVMTDsKKwogCQljID0gZ2V0YXN0cmluZyhpbWFwZF9pbiwgaW1hcGRfb3V0LCAm
YXJnMSk7CiAJCWlmIChjICE9ICcgJykgZ290byBtaXNzaW5nYXJnczsKIAkJYyA9IGdldGFzdHJp
bmcoaW1hcGRfaW4sIGltYXBkX291dCwgJmFyZzIpOwogCQlpZiAoYyA9PSAnXHInKSBjID0gcHJv
dF9nZXRjKGltYXBkX2luKTsKIAkJaWYgKGMgIT0gJ1xuJykgZ290byBleHRyYWFyZ3M7Ci0JCWNt
ZF9saXN0KHRhZy5zLCBMSVNUX0NISUxEUkVOIHwgTElTVF9SRU1PVEUsIGFyZzEucywgYXJnMi5z
KTsKKworCQlhcHBlbmRzdHJsaXN0KCZwYXR0ZXJuLCBhcmcyLnMpOworCQljbWRfbGlzdCh0YWcu
cywKKwkJCSBMSVNUX09QVF9STElTVCB8IExJU1RfU0VMX1JFTU9URSB8IExJU1RfUkVUX0NISUxE
UkVOLAorCQkJIGFyZzEucywgcGF0dGVybik7CisJCWZyZWVzdHJsaXN0KHBhdHRlcm4pOwogCiAv
KiAJCXNubXBfaW5jcmVtZW50KExJU1RfQ09VTlQsIDEpOyAqLwogCSAgICB9CiAJICAgIGVsc2Ug
aWYgKCFzdHJjbXAoY21kLnMsICJSbHN1YiIpKSB7CisJCXN0cnVjdCBzdHJsaXN0ICpwYXR0ZXJu
ID0gTlVMTDsKKwogCQljID0gZ2V0YXN0cmluZyhpbWFwZF9pbiwgaW1hcGRfb3V0LCAmYXJnMSk7
CiAJCWlmIChjICE9ICcgJykgZ290byBtaXNzaW5nYXJnczsKIAkJYyA9IGdldGFzdHJpbmcoaW1h
cGRfaW4sIGltYXBkX291dCwgJmFyZzIpOwogCQlpZiAoYyA9PSAnXHInKSBjID0gcHJvdF9nZXRj
KGltYXBkX2luKTsKIAkJaWYgKGMgIT0gJ1xuJykgZ290byBleHRyYWFyZ3M7Ci0JCWNtZF9saXN0
KHRhZy5zLCBMSVNUX0xTVUIgfCBMSVNUX0NISUxEUkVOIHwgTElTVF9SRU1PVEUsCi0JCQkgYXJn
MS5zLCBhcmcyLnMpOworCisJCWFwcGVuZHN0cmxpc3QoJnBhdHRlcm4sIGFyZzIucyk7CisJCWNt
ZF9saXN0KHRhZy5zLAorCQkJIExJU1RfT1BUX1JMSVNUIHwgTElTVF9PUFRfTFNVQiB8IExJU1Rf
U0VMX1JFTU9URQorCQkJIHwgTElTVF9TRUxfU1VCU0NSSUJFRCwKKwkJCSBhcmcxLnMsIHBhdHRl
cm4pOworCQlmcmVlc3RybGlzdChwYXR0ZXJuKTsKKwogLyogCQlzbm1wX2luY3JlbWVudChMU1VC
X0NPVU5ULCAxKTsgKi8KIAkgICAgfQogI2lmZGVmIEhBVkVfU1NMCkBAIC0yNTg3LDE3ICsyNjY4
LDEzIEBACiAJcHJvdF9wcmludGYoaW1hcGRfb3V0LCAiIElETEUiKTsKICAgICB9CiAKLSNpZmRl
ZiBFTkFCTEVfTElTVEVYVAotICAgIHByb3RfcHJpbnRmKGltYXBkX291dCwgIiBMSVNURVhUIExJ
U1QtU1VCU0NSSUJFRCIpOwotI2VuZGlmIC8qIEVOQUJMRV9MSVNURVhUICovCisjaWZkZWYgSEFW
RV9TU0wKKyAgICBwcm90X3ByaW50ZihpbWFwZF9vdXQsICIgVVJMQVVUSCIpOworI2VuZGlmCiAK
ICNpZmRlZiBFTkFCTEVfWF9ORVRTQ0FQRV9IQUNLCiAgICAgcHJvdF9wcmludGYoaW1hcGRfb3V0
LCAiIFgtTkVUU0NBUEUiKTsKICNlbmRpZgotCi0jaWZkZWYgSEFWRV9TU0wKLSAgICBwcm90X3By
aW50ZihpbWFwZF9vdXQsICIgVVJMQVVUSCIpOwotI2VuZGlmCiB9CiAKIC8qCkBAIC01NjcyLDEz
NSArNTc0OSwxNTUgQEAKIAkJZXJyb3JfbWVzc2FnZShJTUFQX09LX0NPTVBMRVRFRCkpOwogfQog
Ci1zdGF0aWMgaW50IG1zdHJpbmdkYXRhY2FsbHM7CisvKiBubyB0aW1lcyB0aGUgY2FsbGJhY2tz
IGZvciBmaW5kYWxsL2ZpbmRzdWIgaGF2ZSBiZWVuIGNhbGxlZCAqLworc3RhdGljIGludCBsaXN0
X2NhbGxiYWNrX2NhbGxzOwogCiAvKgotICogUGVyZm9ybSBhIExJU1Qgb3IgTFNVQiBjb21tYW5k
CisgKiBQYXJzZSBhIExJU1QgY29tbWFuZC4KICAqLwotdm9pZCBjbWRfbGlzdChjaGFyICp0YWcs
IGludCBsaXN0b3B0cywgY2hhciAqcmVmZXJlbmNlLCBjaGFyICpwYXR0ZXJuKQordm9pZCBwYXJz
ZV9saXN0KGNoYXIgKnRhZywgaW50ICpsaXN0b3B0cywgc3RydWN0IGJ1ZiAqcmVmZXJlbmNlLAor
CQlzdHJ1Y3Qgc3RybGlzdCAqKnBhdHRlcm5zKQogewotICAgIGNoYXIgKmJ1ZiA9IE5VTEw7Ci0g
ICAgaW50IHBhdGxlbiA9IDA7Ci0gICAgaW50IHJlZmxlbiA9IDA7Ci0gICAgc3RhdGljIGludCBp
Z25vcmVyZWZlcmVuY2UgPSAwOwotICAgIGNsb2NrX3Qgc3RhcnQgPSBjbG9jaygpOwotICAgIGNo
YXIgbXl0aW1lWzEwMF07Ci0gICAgaW50ICgqZmluZGFsbCkoc3RydWN0IG5hbWVzcGFjZSAqbmFt
ZXNwYWNlLAotCQkgICBjb25zdCBjaGFyICpwYXR0ZXJuLCBpbnQgaXNhZG1pbiwgY2hhciAqdXNl
cmlkLCAKLQkJICAgc3RydWN0IGF1dGhfc3RhdGUgKmF1dGhfc3RhdGUsIGludCAoKnByb2MpKCks
Ci0JCSAgIHZvaWQgKnJvY2spOwotICAgIGludCAoKmZpbmRzdWIpKHN0cnVjdCBuYW1lc3BhY2Ug
Km5hbWVzcGFjZSwKLQkJICAgY29uc3QgY2hhciAqcGF0dGVybiwgaW50IGlzYWRtaW4sIGNoYXIg
KnVzZXJpZCwgCi0JCSAgIHN0cnVjdCBhdXRoX3N0YXRlICphdXRoX3N0YXRlLCBpbnQgKCpwcm9j
KSgpLAotCQkgICB2b2lkICpyb2NrLCBpbnQgZm9yY2UpOworICAgIHN0YXRpYyBzdHJ1Y3QgYnVm
IGJ1ZjsKKyAgICBpbnQgYzsKIAotICAgIGlmIChsaXN0b3B0cyAmIExJU1RfUkVNT1RFKSBzdXBw
b3J0c19yZWZlcnJhbHMgPSAhZGlzYWJsZV9yZWZlcnJhbHM7CisgICAgKmxpc3RvcHRzID0gMDsK
KyAgICAqcGF0dGVybnMgPSBOVUxMOwogCi0gICAgLyogSWdub3JlIHRoZSByZWZlcmVuY2UgYXJn
dW1lbnQ/Ci0gICAgICAgKHRoZSBiZWhhdmlvciBpbiAxLjUuMTAgJiBvbGRlcikgKi8KLSAgICBp
ZiAoaWdub3JlcmVmZXJlbmNlID09IDApIHsKLQlpZ25vcmVyZWZlcmVuY2UgPSBjb25maWdfZ2V0
c3dpdGNoKElNQVBPUFRfSUdOT1JFUkVGRVJFTkNFKTsKKyAgICAvKiBDaGVjayBmb3IgYW5kIHBh
cnNlIExJU1QtRVhURU5ERUQgc2VsZWN0aW9uIG9wdGlvbnMgKi8KKyAgICBjID0gcHJvdF9nZXRj
KGltYXBkX2luKTsKKyAgICBpZiAoYyA9PSAnKCcpIHsKKwkqbGlzdG9wdHMgfD0gTElTVF9PUFRf
RVhURU5ERUQ7CisJYyA9IGdldGxpc3RzZWxvcHRzKHRhZywgbGlzdG9wdHMpOworCWlmIChjID09
IEVPRikgeworCSAgICBlYXRsaW5lKGltYXBkX2luLCBjKTsKKwkgICAgcmV0dXJuOworCX0KICAg
ICB9CisgICAgZWxzZQorCXByb3RfdW5nZXRjKGMsIGltYXBkX2luKTsKIAotICAgIC8qIFJlc2V0
IHN0YXRlIGluIG1zdHJpbmdkYXRhICovCi0gICAgbXN0cmluZ2RhdGEoTlVMTCwgTlVMTCwgMCwg
MCwgMCk7CisgICAgaWYgKGltYXBkX21hZ2ljcGx1cykgKmxpc3RvcHRzIHw9IExJU1RfU0VMX1NV
QlNDUklCRUQgfCBMSVNUX1JFVF9TVUJTQ1JJQkVEOwogCi0gICAgaWYgKCFwYXR0ZXJuWzBdICYm
ICEobGlzdG9wdHMgJiBMSVNUX0xTVUIpKSB7Ci0JLyogU3BlY2lhbCBjYXNlOiBxdWVyeSB0b3At
bGV2ZWwgaGllcmFyY2h5IHNlcGFyYXRvciAqLwotCXByb3RfcHJpbnRmKGltYXBkX291dCwgIiog
TElTVCAoXFxOb3NlbGVjdCkgXCIlY1wiIFwiXCJcclxuIiwKLQkJICAgIGltYXBkX25hbWVzcGFj
ZS5oaWVyX3NlcCk7Ci0gICAgfSBlbHNlIGlmICgobGlzdG9wdHMgJiAoTElTVF9MU1VCIHwgTElT
VF9TVUJTQ1JJQkVEKSkgJiYKLQkgICAgICAgKGJhY2tlbmRfaW5ib3ggfHwgKGJhY2tlbmRfaW5i
b3ggPSBwcm94eV9maW5kaW5ib3hzZXJ2ZXIoKSkpKSB7Ci0JLyogcmVtb3RlIElOQk9YICovCi0J
aWYgKChsaXN0b3B0cyAmIExJU1RfU1VCU0NSSUJFRCkgJiYgKGxpc3RvcHRzICYgTElTVF9FWFQp
ICYmCi0JICAgIENBUEEoYmFja2VuZF9pbmJveCwgQ0FQQV9MSVNUU1VCU0NSSUJFRCkpIHsKLQkg
ICAgcHJvdF9wcmludGYoYmFja2VuZF9pbmJveC0+b3V0LCAiJXMgTGlzdCAoc3Vic2NyaWJlZCIs
IHRhZyk7Ci0JICAgIGlmIChsaXN0b3B0cyAmIExJU1RfQ0hJTERSRU4pCi0JCXByb3RfcHJpbnRm
KGJhY2tlbmRfaW5ib3gtPm91dCwgIiBjaGlsZHJlbiIpOwotCSAgICBpZiAobGlzdG9wdHMgJiBM
SVNUX1JFTU9URSkKLQkJcHJvdF9wcmludGYoYmFja2VuZF9pbmJveC0+b3V0LCAiIHJlbW90ZSIp
OwotCSAgICBwcm90X3ByaW50ZihiYWNrZW5kX2luYm94LT5vdXQsICIpICIpOwotCX0gZWxzZSB7
Ci0JICAgIHByb3RfcHJpbnRmKGJhY2tlbmRfaW5ib3gtPm91dCwgIiVzIExzdWIgIiwgdGFnKTsK
KyAgICAvKiBSZWFkIGluIHJlZmVyZW5jZSBuYW1lICovCisgICAgYyA9IGdldGFzdHJpbmcoaW1h
cGRfaW4sIGltYXBkX291dCwgcmVmZXJlbmNlKTsKKyAgICBpZiAoYyA9PSBFT0YgJiYgISpyZWZl
cmVuY2UtPnMpIHsKKwlwcm90X3ByaW50ZihpbWFwZF9vdXQsCisJCSAgICAiJXMgQkFEIE1pc3Np
bmcgcmVxdWlyZWQgYXJndW1lbnQgdG8gTGlzdDogcmVmZXJlbmNlIG5hbWVcclxuIiwKKwkJICAg
IHRhZyk7CisJZWF0bGluZShpbWFwZF9pbiwgYyk7CisJcmV0dXJuOworICAgIH0KKyAgICBpZiAo
YyAhPSAnICcpIHsKKwlwcm90X3ByaW50ZihpbWFwZF9vdXQsCisJCSAgICAiJXMgQkFEIE1pc3Np
bmcgcmVxdWlyZWQgYXJndW1lbnQgdG8gTGlzdDogbWFpbGJveCBwYXR0ZXJuXHJcbiIsIHRhZyk7
CisJZWF0bGluZShpbWFwZF9pbiwgYyk7CisJcmV0dXJuOworICAgIH0KKworICAgIC8qIFJlYWQg
aW4gbWFpbGJveCBwYXR0ZXJuKHMpICovCisgICAgYyA9IHByb3RfZ2V0YyhpbWFwZF9pbik7Cisg
ICAgaWYgKGMgPT0gJygnKSB7CisJKmxpc3RvcHRzIHw9IExJU1RfT1BUX0VYVEVOREVEOworCWZv
ciAoOzspIHsKKwkgICAgYyA9IGdldGFzdHJpbmcoaW1hcGRfaW4sIGltYXBkX291dCwgJmJ1Zik7
CisJICAgIGlmICgqYnVmLnMpCisJCWFwcGVuZHN0cmxpc3QocGF0dGVybnMsIGJ1Zi5zKTsKKwkg
ICAgaWYgKGMgIT0gJyAnKSBicmVhazsKIAl9Ci0JcHJvdF9wcmludGYoYmFja2VuZF9pbmJveC0+
b3V0LCAKLQkJICAgICJ7JWQrfVxyXG4lcyB7JWQrfVxyXG4lc1xyXG4iLAotCQkgICAgc3RybGVu
KHJlZmVyZW5jZSksIHJlZmVyZW5jZSwKLQkJICAgIHN0cmxlbihwYXR0ZXJuKSwgcGF0dGVybik7
Ci0JcGlwZV9sc3ViKGJhY2tlbmRfaW5ib3gsIHRhZywgMCwgKGxpc3RvcHRzICYgTElTVF9MU1VC
KSA/ICJMU1VCIiA6ICJMSVNUIik7Ci0gICAgfSBlbHNlIHsKLQkvKiBEbyB3ZSBuZWVkIHRvIGNv
bmNhdGVuYXRlIGZpZWxkcz8gKi8KLQlpZiAoIWlnbm9yZXJlZmVyZW5jZSB8fCBwYXR0ZXJuWzBd
ID09IGltYXBkX25hbWVzcGFjZS5oaWVyX3NlcCkgewotCSAgICAvKiBFaXRoZXIKLQkgICAgICog
LSBuYW1lIGJlZ2lucyB3aXRoIGRvdAotCSAgICAgKiAtIHdlJ3JlIGNvbmZpZ3VyZWQgdG8gaG9u
b3IgdGhlIHJlZmVyZW5jZSBhcmd1bWVudCAqLwotCi0JICAgIC8qIEFsbG9jYXRlIGEgYnVmZmVy
LCBmaWd1cmUgb3V0IGhvdyB0byBzdGljayB0aGUgYXJndW1lbnRzCi0JICAgICAgIHRvZ2V0aGVy
LCBkbyBpdCwgdGhlbiBkbyB0aGF0IGluc3RlYWQgb2YgdXNpbmcgcGF0dGVybi4gKi8KLQkgICAg
cGF0bGVuID0gc3RybGVuKHBhdHRlcm4pOwotCSAgICByZWZsZW4gPSBzdHJsZW4ocmVmZXJlbmNl
KTsKLQkgICAgCi0JICAgIGJ1ZiA9IHhtYWxsb2MocGF0bGVuICsgcmVmbGVuICsgMSk7Ci0JICAg
IGJ1ZlswXSA9ICdcMCc7CisJaWYgKGMgIT0gJyknKSB7CisJICAgIHByb3RfcHJpbnRmKGltYXBk
X291dCwKKwkJCSIlcyBCQUQgSW52YWxpZCBzeW50YXggaW4gTGlzdCBjb21tYW5kXHJcbiIsIHRh
Zyk7CisJICAgIGVhdGxpbmUoaW1hcGRfaW4sIGMpOworCSAgICBnb3RvIGZyZWVhcmdzOworCX0K
KwljID0gcHJvdF9nZXRjKGltYXBkX2luKTsKKyAgICB9CisgICAgZWxzZSB7CisJcHJvdF91bmdl
dGMoYywgaW1hcGRfaW4pOworICAgIAljID0gZ2V0YXN0cmluZyhpbWFwZF9pbiwgaW1hcGRfb3V0
LCAmYnVmKTsKKwlpZiAoYyA9PSBFT0YpIHsKKwkgICAgcHJvdF9wcmludGYoaW1hcGRfb3V0LAor
CQkJIiVzIEJBRCBNaXNzaW5nIHJlcXVpcmVkIGFyZ3VtZW50IHRvIExpc3Q6IG1haWxib3ggcGF0
dGVyblxyXG4iLAorCQkJdGFnKTsKKwkgICAgZWF0bGluZShpbWFwZF9pbiwgYyk7CisJICAgIGdv
dG8gZnJlZWFyZ3M7CisJfQorCWFwcGVuZHN0cmxpc3QocGF0dGVybnMsIGJ1Zi5zKTsKKyAgICB9
CiAKLQkgICAgaWYgKCpyZWZlcmVuY2UpIHsKLQkJLyogY2hlY2sgZm9yIExJU1QgQS4gLkIsIGNo
YW5nZSB0byBMSVNUICIiIEEuQiAqLwotCQlpZiAocmVmZXJlbmNlW3JlZmxlbi0xXSA9PSBpbWFw
ZF9uYW1lc3BhY2UuaGllcl9zZXAgJiYKLQkJICAgIHBhdHRlcm5bMF0gPT0gaW1hcGRfbmFtZXNw
YWNlLmhpZXJfc2VwKSB7Ci0JCSAgICByZWZlcmVuY2VbLS1yZWZsZW5dID0gJ1wwJzsKLQkJfQot
CQlzdHJjcHkoYnVmLCByZWZlcmVuY2UpOwotCSAgICB9Ci0JICAgIHN0cmNhdChidWYsIHBhdHRl
cm4pOwotCSAgICBwYXR0ZXJuID0gYnVmOworICAgIC8qIENoZWNrIGZvciBhbmQgcGFyc2UgTElT
VC1FWFRFTkRFRCByZXR1cm4gb3B0aW9ucyAqLworICAgIGlmIChjID09ICcgJykgeworCSpsaXN0
b3B0cyB8PSBMSVNUX09QVF9FWFRFTkRFRDsKKwljID0gZ2V0bGlzdHJldG9wdHModGFnLCBsaXN0
b3B0cyk7CisJaWYgKGMgPT0gRU9GKSB7CisJICAgIGVhdGxpbmUoaW1hcGRfaW4sIGMpOworCSAg
ICBnb3RvIGZyZWVhcmdzOwogCX0KKyAgICB9CiAKLQkvKiBUcmFuc2xhdGUgYW55IHNlcGFyYXRv
cnMgaW4gcGF0dGVybiAqLwotCW1ib3huYW1lX2hpZXJzZXBfdG9pbnRlcm5hbCgmaW1hcGRfbmFt
ZXNwYWNlLCBwYXR0ZXJuLAotCQkJCSAgICBjb25maWdfdmlydGRvbWFpbnMgPwotCQkJCSAgICBz
dHJjc3BuKHBhdHRlcm4sICJAIikgOiAwKTsKKyAgICAvKiBjaGVjayBmb3IgQ1JMRiAqLworICAg
IGlmIChjID09ICdccicpIGMgPSBwcm90X2dldGMoaW1hcGRfaW4pOworICAgIGlmIChjICE9ICdc
bicpIHsKKwlwcm90X3ByaW50ZihpbWFwZF9vdXQsCisJCSAgICAiJXMgQkFEIFVuZXhwZWN0ZWQg
ZXh0cmEgYXJndW1lbnRzIHRvIExpc3RcclxuIiwgdGFnKTsKKwllYXRsaW5lKGltYXBkX2luLCBj
KTsKKwlnb3RvIGZyZWVhcmdzOworICAgIH0KIAotCS8qIENoZWNrIHRvIHNlZSBpZiB3ZSBzaG91
bGQgb25seSBsaXN0IHRoZSBwZXJzb25hbCBuYW1lc3BhY2UgKi8KLQlpZiAoIXN0cmNtcChwYXR0
ZXJuLCAiKiIpCi0JICAgICYmIGNvbmZpZ19nZXRzd2l0Y2goSU1BUE9QVF9GT09MU1RVUElEQ0xJ
RU5UUykpIHsKLQkgICAgaWYgKGJ1ZikgZnJlZShidWYpOwotCSAgICBidWYgPSB4c3RyZHVwKCJJ
TkJPWCoiKTsKLQkgICAgcGF0dGVybiA9IGJ1ZjsKLQkgICAgZmluZHN1YiA9IG1ib3hsaXN0X2Zp
bmRzdWI7Ci0JICAgIGZpbmRhbGwgPSBtYm94bGlzdF9maW5kYWxsOwotCX0KLQllbHNlIHsKLQkg
ICAgZmluZHN1YiA9IGltYXBkX25hbWVzcGFjZS5tYm94bGlzdF9maW5kc3ViOwotCSAgICBmaW5k
YWxsID0gaW1hcGRfbmFtZXNwYWNlLm1ib3hsaXN0X2ZpbmRhbGw7Ci0JfQorICAgIHJldHVybjsK
IAotCWlmIChsaXN0b3B0cyAmIChMSVNUX0xTVUIgfCBMSVNUX1NVQlNDUklCRUQpKSB7Ci0JICAg
IGludCBmb3JjZSA9IGNvbmZpZ19nZXRzd2l0Y2goSU1BUE9QVF9BTExPV0FMTFNVQlNDUklCRSk7
CisgIGZyZWVhcmdzOgorICAgIGZyZWVzdHJsaXN0KCpwYXR0ZXJucyk7CisgICAgKnBhdHRlcm5z
ID0gTlVMTDsKKyAgICByZXR1cm47Cit9CiAKLQkgICAgKCpmaW5kc3ViKSgmaW1hcGRfbmFtZXNw
YWNlLCBwYXR0ZXJuLAotCQkgICAgICAgaW1hcGRfdXNlcmlzYWRtaW4sIGltYXBkX3VzZXJpZCwg
aW1hcGRfYXV0aHN0YXRlLAotCQkgICAgICAgbGlzdGRhdGEsICZsaXN0b3B0cywgZm9yY2UpOwot
CX0KLQllbHNlIHsKLQkgICAgKCpmaW5kYWxsKSgmaW1hcGRfbmFtZXNwYWNlLCBwYXR0ZXJuLAot
CQkgICAgICAgaW1hcGRfdXNlcmlzYWRtaW4sIGltYXBkX3VzZXJpZCwgaW1hcGRfYXV0aHN0YXRl
LAotCQkgICAgICAgbGlzdGRhdGEsICZsaXN0b3B0cyk7Ci0JfQorLyoKKyAqIFBlcmZvcm0gYSBM
SVNULCBMU1VCLCBSTElTVCBvciBSTFNVQiBjb21tYW5kCisgKi8KK3ZvaWQgY21kX2xpc3QoY2hh
ciAqdGFnLCBpbnQgbGlzdG9wdHMsIGNoYXIgKnJlZmVyZW5jZSwKKwkgICAgICBzdHJ1Y3Qgc3Ry
bGlzdCAqcGF0dGVybnMpCit7CisgICAgY2xvY2tfdCBzdGFydCA9IGNsb2NrKCk7CisgICAgY2hh
ciBteXRpbWVbMTAwXTsKIAotCWxpc3RkYXRhKChjaGFyICopMCwgMCwgMCwgJmxpc3RvcHRzKTsK
KyAgICBpZiAobGlzdG9wdHMgJiBMSVNUX1NFTF9SRU1PVEUpIHN1cHBvcnRzX3JlZmVycmFscyA9
ICFkaXNhYmxlX3JlZmVycmFsczsKIAotCWlmIChidWYpIGZyZWUoYnVmKTsKKyAgICBsaXN0X2Nh
bGxiYWNrX2NhbGxzID0gMDsKKworICAgIGlmICghKGxpc3RvcHRzICYgTElTVF9PUFRfTFNVQikK
KwkgICAgJiYgIShsaXN0b3B0cyAmIExJU1RfT1BUX0VYVEVOREVEKQorCSAgICAmJiAhKnBhdHRl
cm5zLT5zKSB7CisJLyogc3BlY2lhbCBjYXNlOiBxdWVyeSB0b3AtbGV2ZWwgaGllcmFyY2h5IHNl
cGFyYXRvciAqLworCXByb3RfcHJpbnRmKGltYXBkX291dCwgIiogTElTVCAoXFxOb3NlbGVjdCkg
XCIlY1wiIFwiXCJcclxuIiwKKwkJICAgIGltYXBkX25hbWVzcGFjZS5oaWVyX3NlcCk7CisgICAg
fSBlbHNlIGlmIChsaXN0b3B0cyAmIChMSVNUX1NFTF9TVUJTQ1JJQkVEIHwgTElTVF9SRVRfU1VC
U0NSSUJFRCkKKwkgICAgJiYgKGJhY2tlbmRfaW5ib3ggfHwgKGJhY2tlbmRfaW5ib3ggPSBwcm94
eV9maW5kaW5ib3hzZXJ2ZXIoKSkpKSB7CisJLyogcmVtb3RlIGluYm94ICovCisKKwkvKiBYWFgg
ICBJZiB3ZSBhcmUgaW4gYSBzdGFuZGFyZCBNdXJkZXIsIGFuZCBhcmUgZ2l2ZW4KKwkgICBMSVNU
ICgpIFJFVFVSTiAoU1VCU0NSSUJFRCksIHdlIG5lZWQgdG8gZ2V0IHRoZSBtYXRjaGluZworCSAg
IG1haWxib3hlcyBsb2NhbGx5IChmcm9udGVuZCkgYW5kIHRoZSBzdWJzY3JpcHRpb25zIHJlbW90
ZWx5CisJICAgKElOQk9YIGJhY2tlbmQpLiAgV2UgY2FuIG9ubHkgcGFzcyB0aGUgYnVjayB0byB0
aGUgSU5CT1ggYmFja2VuZAorCSAgIGlmIGl0cyBydW5uaW5nIGEgdW5pZmllZCBjb25maWcgKi8K
KwlsaXN0X2RhdGFfcmVtb3RlKHRhZywgbGlzdG9wdHMsIHJlZmVyZW5jZSwgcGF0dGVybnMpOwor
ICAgIH0gZWxzZSB7CisJbGlzdF9kYXRhKGxpc3RvcHRzLCByZWZlcmVuY2UsIHBhdHRlcm5zKTsK
ICAgICB9CiAKLSAgICBpbWFwZF9jaGVjayghKGxpc3RvcHRzICYgKExJU1RfTFNVQiB8IExJU1Rf
U1VCU0NSSUJFRCkpID8KLQkJYmFja2VuZF9pbmJveCA6IE5VTEwsIDAsIDApOworICAgIGltYXBk
X2NoZWNrKChsaXN0b3B0cyAmIExJU1RfU0VMX1NVQlNDUklCRUQpID8gIE5VTEwgOiBiYWNrZW5k
X2luYm94LAorCQkwLCAwKTsKIAogICAgIHNucHJpbnRmKG15dGltZSwgc2l6ZW9mKG15dGltZSks
ICIlMi4zZiIsCiAJICAgICAoY2xvY2soKSAtIHN0YXJ0KSAvIChkb3VibGUpIENMT0NLU19QRVJf
U0VDKTsKLSAgICBwcm90X3ByaW50ZihpbWFwZF9vdXQsICIlcyBPSyAlcyAoJXMgc2VjcyAlZCBj
YWxscylcclxuIiwgdGFnLAotCQllcnJvcl9tZXNzYWdlKElNQVBfT0tfQ09NUExFVEVEKSwgbXl0
aW1lLCBtc3RyaW5nZGF0YWNhbGxzKTsKKyAgICBwcm90X3ByaW50ZihpbWFwZF9vdXQsICIlcyBP
SyAlcyAoJXMgc2VjcyIsIHRhZywKKwkJZXJyb3JfbWVzc2FnZShJTUFQX09LX0NPTVBMRVRFRCks
IG15dGltZSk7CisgICAgaWYgKGxpc3RfY2FsbGJhY2tfY2FsbHMpCisJcHJvdF9wcmludGYoaW1h
cGRfb3V0LCAiICV1IGNhbGxzIiwgbGlzdF9jYWxsYmFja19jYWxscyk7CisgICAgcHJvdF9wcmlu
dGYoaW1hcGRfb3V0LCAiKVxyXG4iKTsKIH0KLSAgCisKIC8qCiAgKiBQZXJmb3JtIGEgU1VCU0NS
SUJFIChhZGQgaXMgbm9uemVybykgb3IKICAqIFVOU1VCU0NSSUJFIChhZGQgaXMgemVybykgY29t
bWFuZApAQCAtODcwNiwzNSArODgwMywxMTcgQEAKICNlbmRpZgogfQogCi0jaWZkZWYgRU5BQkxF
X0xJU1RFWFQKIC8qCi0gKiBQYXJzZSBMSVNUIG9wdGlvbnMuCisgKiBQYXJzZSBMSVNUIHNlbGVj
dGlvbiBvcHRpb25zLgogICogVGhlIGNvbW1hbmQgaGFzIGJlZW4gcGFyc2VkIHVwIHRvIGFuZCBp
bmNsdWRpbmcgdGhlIG9wZW5pbmcgJygnLgogICovCi1pbnQgZ2V0bGlzdG9wdHMoY2hhciAqdGFn
LCBpbnQgKmxpc3RvcHRzKQoraW50IGdldGxpc3RzZWxvcHRzKGNoYXIgKnRhZywgaW50ICpvcHRz
KQogewogICAgIGludCBjOwotICAgIHN0YXRpYyBzdHJ1Y3QgYnVmIGFyZzsKKyAgICBzdGF0aWMg
c3RydWN0IGJ1ZiBidWY7CiAKLSAgICAqbGlzdG9wdHMgPSBMSVNUX0VYVDsKKyAgICBpZiAoIChj
ID0gcHJvdF9nZXRjKGltYXBkX2luKSkgPT0gJyknKQorCXJldHVybiBwcm90X2dldGMoaW1hcGRf
aW4pOworICAgIGVsc2UKKwlwcm90X3VuZ2V0YyhjLCBpbWFwZF9pbik7CiAKICAgICBmb3IgKDs7
KSB7Ci0JYyA9IGdldHdvcmQoaW1hcGRfaW4sICZhcmcpOwotCWlmICghYXJnLnNbMF0pIGJyZWFr
OworCWMgPSBnZXR3b3JkKGltYXBkX2luLCAmYnVmKTsKIAotCWxjYXNlKGFyZy5zKTsKLQlpZiAo
IXN0cmNtcChhcmcucywgInN1YnNjcmliZWQiKSkgewotCSAgICAqbGlzdG9wdHMgfD0gTElTVF9T
VUJTQ1JJQkVEOworCWlmICghKmJ1Zi5zKSB7CisJICAgIHByb3RfcHJpbnRmKGltYXBkX291dCwK
KwkJCSIlcyBCQUQgSW52YWxpZCBzeW50YXggaW4gTGlzdCBjb21tYW5kXHJcbiIsCisJCQl0YWcp
OworCSAgICByZXR1cm4gRU9GOwogCX0KLQllbHNlIGlmICghc3RyY21wKGFyZy5zLCAiY2hpbGRy
ZW4iKSkgewotCSAgICAqbGlzdG9wdHMgfD0gTElTVF9DSElMRFJFTjsKKworCWxjYXNlKGJ1Zi5z
KTsKKworCWlmICghc3RyY21wKGJ1Zi5zLCAic3Vic2NyaWJlZCIpKSB7CisJICAgICpvcHRzIHw9
IExJU1RfU0VMX1NVQlNDUklCRUQgfCBMSVNUX1JFVF9TVUJTQ1JJQkVEOworCX0gZWxzZSBpZiAo
IXN0cmNtcChidWYucywgInJlbW90ZSIpKSB7CisJICAgICpvcHRzIHw9IExJU1RfU0VMX1JFTU9U
RTsKKwl9IGVsc2UgaWYgKCFzdHJjbXAoYnVmLnMsICJyZWN1cnNpdmVtYXRjaCIpKSB7CisJICAg
ICpvcHRzIHw9IExJU1RfU0VMX1JFQ1VSU0lWRU1BVENIOworCX0gZWxzZSB7CisJICAgIHByb3Rf
cHJpbnRmKGltYXBkX291dCwKKwkJCSIlcyBCQUQgSW52YWxpZCBMaXN0IHNlbGVjdGlvbiBvcHRp
b24gXCIlc1wiXHJcbiIsCisJCQl0YWcsIGJ1Zi5zKTsKKwkgICAgcmV0dXJuIEVPRjsKIAl9Ci0J
ZWxzZSBpZiAoIXN0cmNtcChhcmcucywgInJlbW90ZSIpKSB7Ci0JICAgICpsaXN0b3B0cyB8PSBM
SVNUX1JFTU9URTsKKworCWlmIChjICE9ICcgJykgYnJlYWs7CisgICAgfQorCisgICAgaWYgKGMg
IT0gJyknKSB7CisJcHJvdF9wcmludGYoaW1hcGRfb3V0LAorCQkgICAgIiVzIEJBRCBNaXNzaW5n
IGNsb3NlIHBhcmVudGhlc2lzIGZvciBMaXN0IHNlbGVjdGlvbiBvcHRpb25zXHJcbiIsIHRhZyk7
CisJcmV0dXJuIEVPRjsKKyAgICB9CisKKyAgICBpZiAoKm9wdHMgJiBsaXN0X3NlbGVjdF9tb2Rf
b3B0cworCSAgICAmJiAhICgqb3B0cyAmIGxpc3Rfc2VsZWN0X2Jhc2Vfb3B0cykpIHsKKwlwcm90
X3ByaW50ZihpbWFwZF9vdXQsCisJCSAgICAiJXMgQkFEIEludmFsaWQgY29tYmluYXRpb24gb2Yg
c2VsZWN0aW9uIG9wdGlvbnNcclxuIiwKKwkJICAgIHRhZyk7CisJcmV0dXJuIEVPRjsKKyAgICB9
CisKKyAgICByZXR1cm4gcHJvdF9nZXRjKGltYXBkX2luKTsKK30KKworLyoKKyAqIFBhcnNlIExJ
U1QgcmV0dXJuIG9wdGlvbnMuCisgKiBUaGUgY29tbWFuZCBoYXMgYmVlbiBwYXJzZWQgdXAgdG8g
YW5kIGluY2x1ZGluZyB0aGUgJyAnIGJlZm9yZSBSRVRVUk4uCisgKi8KK2ludCBnZXRsaXN0cmV0
b3B0cyhjaGFyICp0YWcsIGludCAqb3B0cykgeworICAgIHN0YXRpYyBzdHJ1Y3QgYnVmIGJ1ZjsK
KyAgICBpbnQgYzsKKworICAgIGMgPSBnZXR3b3JkKGltYXBkX2luLCAmYnVmKTsKKyAgICBpZiAo
ISpidWYucykgeworCXByb3RfcHJpbnRmKGltYXBkX291dCwKKwkJICAgICIlcyBCQUQgSW52YWxp
ZCBzeW50YXggaW4gTGlzdCBjb21tYW5kXHJcbiIsIHRhZyk7CisJcmV0dXJuIEVPRjsKKyAgICB9
CisgICAgbGNhc2UoYnVmLnMpOworICAgIGlmIChzdHJjYXNlY21wKGJ1Zi5zLCAicmV0dXJuIikp
IHsKKwlwcm90X3ByaW50ZihpbWFwZF9vdXQsCisJCSAgICAiJXMgQkFEIFVuZXhwZWN0ZWQgZXh0
cmEgYXJndW1lbnQgdG8gTGlzdDogXCIlc1wiXHJcbiIsCisJCSAgICB0YWcsIGJ1Zi5zKTsKKwly
ZXR1cm4gRU9GOworICAgIH0KKworICAgIGlmIChjICE9ICcgJyB8fCAoYyA9IHByb3RfZ2V0Yyhp
bWFwZF9pbikpICE9ICcoJykgeworCXByb3RfcHJpbnRmKGltYXBkX291dCwKKwkJICAgICIlcyBC
QUQgTWlzc2luZyByZXR1cm4gYXJndW1lbnQgbGlzdFxyXG4iLCB0YWcpOworCXJldHVybiBFT0Y7
CisgICAgfQorCisgICAgaWYgKCAoYyA9IHByb3RfZ2V0YyhpbWFwZF9pbikpID09ICcpJykKKwly
ZXR1cm4gcHJvdF9nZXRjKGltYXBkX2luKTsKKyAgICBlbHNlCisJcHJvdF91bmdldGMoYywgaW1h
cGRfaW4pOworCisgICAgZm9yICg7OykgeworCWMgPSBnZXR3b3JkKGltYXBkX2luLCAmYnVmKTsK
KworCWlmICghKmJ1Zi5zKSB7CisJICAgIHByb3RfcHJpbnRmKGltYXBkX291dCwKKwkJCSIlcyBC
QUQgSW52YWxpZCBzeW50YXggaW4gTGlzdCBjb21tYW5kXHJcbiIsIHRhZyk7CisJICAgIHJldHVy
biBFT0Y7CiAJfQorCisJbGNhc2UoYnVmLnMpOworCisJaWYgKCFzdHJjbXAoYnVmLnMsICJzdWJz
Y3JpYmVkIikpCisJICAgICpvcHRzIHw9IExJU1RfUkVUX1NVQlNDUklCRUQ7CisJZWxzZSBpZiAo
IXN0cmNtcChidWYucywgImNoaWxkcmVuIikpCisJICAgICpvcHRzIHw9IExJU1RfUkVUX0NISUxE
UkVOOwogCWVsc2UgewotCSAgICBwcm90X3ByaW50ZihpbWFwZF9vdXQsICIlcyBCQUQgSW52YWxp
ZCBMaXN0IG9wdGlvbiAlc1xyXG4iLAotCQkJdGFnLCBhcmcucyk7CisJICAgIHByb3RfcHJpbnRm
KGltYXBkX291dCwKKwkJCSIlcyBCQUQgSW52YWxpZCBMaXN0IHJldHVybiBvcHRpb24gXCIlc1wi
XHJcbiIsCisJCQl0YWcsIGJ1Zi5zKTsKIAkgICAgcmV0dXJuIEVPRjsKIAl9CiAKQEAgLTg3NDMs
MTUgKzg5MjIsMTIgQEAKIAogICAgIGlmIChjICE9ICcpJykgewogCXByb3RfcHJpbnRmKGltYXBk
X291dCwKLQkJICAgICIlcyBCQUQgTWlzc2luZyBjbG9zZSBwYXJlbnRoZXNpcyBpbiBMaXN0XHJc
biIsIHRhZyk7CisJCSAgICAiJXMgQkFEIE1pc3NpbmcgY2xvc2UgcGFyZW50aGVzaXMgZm9yIExp
c3QgcmV0dXJuIG9wdGlvbnNcclxuIiwgdGFnKTsKIAlyZXR1cm4gRU9GOwogICAgIH0KIAotICAg
IGMgPSBwcm90X2dldGMoaW1hcGRfaW4pOwotCi0gICAgcmV0dXJuIGM7CisgICAgcmV0dXJuIHBy
b3RfZ2V0YyhpbWFwZF9pbik7CiB9Ci0jZW5kaWYgLyogRU5BQkxFX0xJU1RFWFQgKi8KIAogLyoK
ICAqIFBhcnNlIGEgZGF0ZV90aW1lLCBmb3IgdGhlIEFQUEVORCBjb21tYW5kCkBAIC05MTM1LDE1
OCArOTMxMSw0ODYgQEAKICAgICByZXR1cm4gMDsKIH0KIAotLyoKLSAqIElzc3VlIGEgTElTVCBv
ciBMU1VCIHVudGFnZ2VkIHJlc3BvbnNlCi0gKi8KLXN0YXRpYyB2b2lkIG1zdHJpbmdkYXRhKGNo
YXIgKmNtZCwgY2hhciAqbmFtZSwgaW50IG1hdGNobGVuLCBpbnQgbWF5Y3JlYXRlLAotCQkJaW50
IGxpc3RvcHRzKQorc3RhdGljIGludCBzZXRfaGFzY2hpbGRyZW4oY2hhciAqbmFtZSwgaW50IG1h
dGNobGVuLCBpbnQgbWF5Y3JlYXRlLAorCQkJICAgaW50ICphdHRyaWJ1dGVzKQogewotICAgIHN0
YXRpYyBjaGFyIGxhc3RuYW1lW01BWF9NQUlMQk9YX1BBVEgrMV07Ci0gICAgc3RhdGljIGludCBs
YXN0bmFtZWRlbGF5ZWQgPSAwOwotICAgIHN0YXRpYyBpbnQgbGFzdG5hbWVub2luZmVyaW9ycyA9
IDA7Ci0gICAgc3RhdGljIGludCBub25leGlzdGVudCA9IDA7Ci0gICAgc3RhdGljIGludCBzYXd1
c2VyID0gMDsKLSAgICBpbnQgbGFzdG5hbWVoYXNzdWIgPSAwOwotICAgIGludCBjLCBtYnR5cGU7
Ci0gICAgY2hhciBtYm94bmFtZVtNQVhfTUFJTEJPWF9QQVRIKzFdOwotCi0gICAgLyogV2UgaGF2
ZSB0byByZXNldCB0aGUgc2F3dXNlciBmbGFnIGJlZm9yZSBlYWNoIGxpc3QgY29tbWFuZC4KLSAg
ICAgKiBIYW5kbGUgaXQgYXMgYSBkaXJ0eSBoYWNrLgotICAgICAqLwotICAgIGlmIChjbWQgPT0g
TlVMTCkgewotCXNhd3VzZXIgPSAwOwotCW1zdHJpbmdkYXRhY2FsbHMgPSAwOwotCXJldHVybjsK
LSAgICB9Ci0gICAgbXN0cmluZ2RhdGFjYWxscysrOwotCi0gICAgaWYgKGxhc3RuYW1lZGVsYXll
ZCkgewotCS8qIENoZWNrIGlmIGxhc3RuYW1lIGhhcyBjaGlsZHJlbiAqLwotCWlmIChuYW1lICYm
IHN0cm5jbXAobGFzdG5hbWUsIG5hbWUsIHN0cmxlbihsYXN0bmFtZSkpID09IDAgJiYKLQkgICAg
bmFtZVtzdHJsZW4obGFzdG5hbWUpXSA9PSAnLicpIHsKLQkgICAgbGFzdG5hbWVoYXNzdWIgPSAx
OwotCX0KLQlwcm90X3ByaW50ZihpbWFwZF9vdXQsICIqICVzICgiLCBjbWQpOwotCWlmIChub25l
eGlzdGVudCA9PSBJTUFQX01BSUxCT1hfUkVTRVJWRUQpIHsKLQkgICAgLyogTElTVEVYVCB3YW50
cyBcXFBsYWNlSG9sZGVyIGluc3RlYWQgb2YgXFxOb3NlbGVjdCAqLwotCSAgICBpZiAobGlzdG9w
dHMgJiBMSVNUX0VYVCkKLQkJcHJvdF9wcmludGYoaW1hcGRfb3V0LCAiXFxQbGFjZUhvbGRlciIp
OwotCSAgICBlbHNlCi0JCXByb3RfcHJpbnRmKGltYXBkX291dCwgIlxcTm9zZWxlY3QiKTsKLQl9
IGVsc2UgaWYgKG5vbmV4aXN0ZW50KSB7Ci0JICAgIHByb3RfcHJpbnRmKGltYXBkX291dCwgIlxc
Tm9uRXhpc3RlbnQiKTsKLQl9Ci0JaWYgKGxhc3RuYW1lbm9pbmZlcmlvcnMpIHsKLQkgICAgcHJv
dF9wcmludGYoaW1hcGRfb3V0LCAiJXNcXE5vaW5mZXJpb3JzIiwgbm9uZXhpc3RlbnQgPyAiICIg
OiAiIik7Ci0JfQotCWVsc2UgaWYgKChsaXN0b3B0cyAmIExJU1RfQ0hJTERSRU4pICYmCi0JCSAv
KiB3ZSBjYW4ndCBkZXRlcm1pbmUgXEhhc05vQ2hpbGRyZW4gZm9yIHN1YnNjcmlwdGlvbnMgKi8K
LQkJIChsYXN0bmFtZWhhc3N1YiB8fAotCQkgICEobGlzdG9wdHMgJiAoTElTVF9MU1VCIHwgTElT
VF9TVUJTQ1JJQkVEKSkpKSB7Ci0JICAgIHByb3RfcHJpbnRmKGltYXBkX291dCwgIiVzJXMiLCBu
b25leGlzdGVudCA/ICIgIiA6ICIiLAotCQkJbGFzdG5hbWVoYXNzdWIgPyAiXFxIYXNDaGlsZHJl
biIgOiAiXFxIYXNOb0NoaWxkcmVuIik7Ci0JfQotCXByb3RfcHJpbnRmKGltYXBkX291dCwgIikg
XCIlY1wiICIsIGltYXBkX25hbWVzcGFjZS5oaWVyX3NlcCk7Ci0JCSAgICAKLQkoKmltYXBkX25h
bWVzcGFjZS5tYm94bmFtZV90b2V4dGVybmFsKSgmaW1hcGRfbmFtZXNwYWNlLCBsYXN0bmFtZSwK
LQkJCQkJICAgICAgIGltYXBkX3VzZXJpZCwgbWJveG5hbWUpOwotCXByaW50c3RyaW5nKG1ib3hu
YW1lKTsKLQlwcm90X3ByaW50ZihpbWFwZF9vdXQsICJcclxuIik7Ci0JbGFzdG5hbWVkZWxheWVk
ID0gbGFzdG5hbWVub2luZmVyaW9ycyA9IG5vbmV4aXN0ZW50ID0gMDsKKyAgICBsaXN0X2NhbGxi
YWNrX2NhbGxzKys7CisgICAgaWYgKG5hbWVbbWF0Y2hsZW5dKSB7CisJKmF0dHJpYnV0ZXMgfD0g
TUJPWF9BVFRSSUJVVEVfSEFTQ0hJTERSRU47CisJcmV0dXJuIENZUlVTREJfRE9ORTsKICAgICB9
CisgICAgcmV0dXJuIDA7Cit9CiAKLSAgICAvKiBTcGVjaWFsLWNhc2UgdG8gZmx1c2ggYW55IGZp
bmFsIHN0YXRlICovCi0gICAgaWYgKCFuYW1lKSB7Ci0JbGFzdG5hbWVbMF0gPSAnXDAnOwotCXJl
dHVybjsKLSAgICB9CisvKiBQcmludCBMSVNUIG9yIExTVUIgdW50YWdnZWQgcmVzcG9uc2UgKi8K
K3N0YXRpYyB2b2lkIGxpc3RfcmVzcG9uc2UoY2hhciAqbmFtZSwgaW50IGF0dHJpYnV0ZXMsIGlu
dCBvcHRzKQoreworICAgIHN0cnVjdCBtYm94X25hbWVfYXR0cmlidXRlICphdHRyOworICAgIGNo
YXIgaW50ZXJuYWxfbmFtZVtNQVhfTUFJTEJPWF9QQVRIKzFdOworICAgIGludCByLCBtYnR5cGUs
IGZpcnN0ID0gMTsKKyAgICBjaGFyIG1ib3huYW1lW01BWF9NQUlMQk9YX1BBVEgrMV07CiAKLSAg
ICAvKiBTdXBwcmVzcyBhbnkgb3V0cHV0IG9mIGEgcGFydGlhbCBtYXRjaCAqLwotICAgIGlmICgo
bmFtZVttYXRjaGxlbl0KLQkgJiYgc3RybmNtcChsYXN0bmFtZSwgbmFtZSwgbWF0Y2hsZW4pID09
IDAKLQkgJiYgKGxhc3RuYW1lW21hdGNobGVuXSA9PSAnXDAnIHx8IGxhc3RuYW1lW21hdGNobGVu
XSA9PSAnLicpKSkgeworICAgIGlmICghbmFtZSkKIAlyZXR1cm47CisKKyAgICAvKiBmaXJzdCBj
b252ZXJ0ICJJTkJPWCIgdG8gInVzZXIuPHVzZXJpZD4iICovCisgICAgaWYgKCFzdHJuY2FzZWNt
cChuYW1lLCAiaW5ib3giLCA1KQorICAgICAgICAgICAgJiYgKCFuYW1lWzVdIHx8IG5hbWVbNV0g
PT0gJy4nKSApIHsKKwkoKmltYXBkX25hbWVzcGFjZS5tYm94bmFtZV90b2ludGVybmFsKSgmaW1h
cGRfbmFtZXNwYWNlLCAiSU5CT1giLAorCQkJCQkgICAgICAgaW1hcGRfdXNlcmlkLCBpbnRlcm5h
bF9uYW1lKTsKKwlzdHJsY2F0KGludGVybmFsX25hbWUsIG5hbWUrNSwgc2l6ZW9mKGludGVybmFs
X25hbWUpKTsKICAgICB9Ci0JCi0gICAgLyoKLSAgICAgKiBXZSBjYW4gZ2V0IGEgcGFydGlhbCBt
YXRjaCBmb3IgInVzZXIiIG11bHRpcGxlIHRpbWVzIHdpdGgKLSAgICAgKiBvdGhlciBtYXRjaGVz
IGluYmV0d2Vlbi4gIEhhbmRsZSBpdCBhcyBhIHNwZWNpYWwgY2FzZQorICAgIGVsc2UKKwlzdHJs
Y3B5KGludGVybmFsX25hbWUsIG5hbWUsIHNpemVvZihpbnRlcm5hbF9uYW1lKSk7CisKKyAgICAv
KiBnZXQgaW5mbyBhbmQgc2V0IGZsYWdzICovCisgICAgciA9IG1ib3hsaXN0X2RldGFpbChpbnRl
cm5hbF9uYW1lLCAmbWJ0eXBlLCBOVUxMLCBOVUxMLCBOVUxMLCBOVUxMLCBOVUxMKTsKKworICAg
IGlmIChyID09IElNQVBfTUFJTEJPWF9OT05FWElTVEVOVCkKKwlhdHRyaWJ1dGVzIHw9IChvcHRz
ICYgTElTVF9PUFRfRVhURU5ERUQgPworCQkgICAgICAgTUJPWF9BVFRSSUJVVEVfTk9ORVhJU1RF
TlQgOiBNQk9YX0FUVFJJQlVURV9OT1NFTEVDVCk7CisgICAgaWYgKCFyICYmIChtYnR5cGUgJiBN
QlRZUEVfUkVTRVJWRSkpCisJYXR0cmlidXRlcyB8PSBNQk9YX0FUVFJJQlVURV9OT1NFTEVDVDsK
KworICAgIC8qIGZpZ3VyZSBvdXQgXEhhcyhObylDaGlsZHJlbiBpZiBuZWNlc3NhcnkKKyAgICAg
ICBUaGlzIGlzIG1haW5seSB1c2VkIGZvciBMSVNUIChTVUJTQ1JJQkVEKSBSRVRVUk4gKENISUxE
UkVOKQogICAgICAqLwotICAgIGlmIChtYXRjaGxlbiA9PSA0ICYmIHN0cm5jYXNlY21wKG5hbWUs
ICJ1c2VyIiwgNCkgPT0gMCkgewotCWlmIChzYXd1c2VyKSByZXR1cm47Ci0Jc2F3dXNlciA9IDE7
CisgICAgaWYgKCBvcHRzICYgTElTVF9SRVRfQ0hJTERSRU4KKwkgICAgJiYgISAoYXR0cmlidXRl
cyAmIE1CT1hfQVRUUklCVVRFX0hBU0NISUxEUkVOKQorCSAgICAmJiAhIChhdHRyaWJ1dGVzICYg
TUJPWF9BVFRSSUJVVEVfSEFTTk9DSElMRFJFTikgKSB7CisJbWJveGxpc3RfZmluZGFsbCgmaW1h
cGRfbmFtZXNwYWNlLCBuYW1lLAorCQkJIGltYXBkX3VzZXJpc2FkbWluLCBpbWFwZF91c2VyaWQs
IGltYXBkX2F1dGhzdGF0ZSwKKwkJCSBzZXRfaGFzY2hpbGRyZW4sICZhdHRyaWJ1dGVzKTsKKwlp
ZiAoICEgKGF0dHJpYnV0ZXMgJiBNQk9YX0FUVFJJQlVURV9IQVNDSElMRFJFTikgKQorCSAgICBh
dHRyaWJ1dGVzIHw9IE1CT1hfQVRUUklCVVRFX0hBU05PQ0hJTERSRU47CisgICAgfQorCisgICAg
aWYgKG9wdHMgJiBMSVNUX09QVF9MU1VCKSB7CisJLyogXE5vc2VsZWN0IGhhcyBhIHNwZWNpYWwg
c2Vjb25kIG1lYW5pbmcgd2l0aCAoUilMU1VCICovCisJaWYgKCAhKGF0dHJpYnV0ZXMgJiBNQk9Y
X0FUVFJJQlVURV9TVUJTQ1JJQkVEKQorCQkmJiBhdHRyaWJ1dGVzICYgTUJPWF9BVFRSSUJVVEVf
Q0hJTERJTkZPX1NVQlNDUklCRUQpCisJICAgIGF0dHJpYnV0ZXMgfD0gTUJPWF9BVFRSSUJVVEVf
Tk9TRUxFQ1Q7CisJYXR0cmlidXRlcyAmPSB+TUJPWF9BVFRSSUJVVEVfU1VCU0NSSUJFRDsKKyAg
ICB9CisKKyAgICAvKiByZW1vdmUgcmVkdW5kYW50IGZsYWdzICovCisgICAgaWYgKG9wdHMgJiBM
SVNUX09QVF9FWFRFTkRFRCkgeworCS8qIFxOb0luZmVyaW9ycyBpbXBsaWVzIFxIYXNOb0NoaWxk
cmVuICovCisJaWYgKGF0dHJpYnV0ZXMgJiBNQk9YX0FUVFJJQlVURV9OT0lORkVSSU9SUykKKwkg
ICAgYXR0cmlidXRlcyAmPSB+TUJPWF9BVFRSSUJVVEVfSEFTTk9DSElMRFJFTjsKKwkvKiBcTm9u
RXhpc3RlbnQgaW1wbGllcyBcTm9TZWxlY3QgKi8KKwlpZiAoYXR0cmlidXRlcyAmIE1CT1hfQVRU
UklCVVRFX05PTkVYSVNURU5UKQorCSAgICBhdHRyaWJ1dGVzICY9IH5NQk9YX0FUVFJJQlVURV9O
T1NFTEVDVDsKKyAgICB9CisKKyAgICBwcm90X3ByaW50ZihpbWFwZF9vdXQsICIqICVzICgiLAor
CQkob3B0cyAmIExJU1RfT1BUX0xTVUIpID8gIkxTVUIiIDogIkxJU1QiKTsKKyAgICBmb3IgKGF0
dHIgPSBtYm94X25hbWVfYXR0cmlidXRlczsgYXR0ci0+aWQ7IGF0dHIrKykKKwlpZiAoYXR0cmli
dXRlcyAmIGF0dHItPmZsYWcpIHsKKwkgICAgaWYgKGZpcnN0KSBmaXJzdCA9IDA7CisJICAgIGVs
c2UgcHJvdF9wdXRjKCcgJywgaW1hcGRfb3V0KTsKKwkgICAgcHJvdF9wcmludGYoaW1hcGRfb3V0
LCBhdHRyLT5pZCk7CisJfQorICAgIHByb3RfcHJpbnRmKGltYXBkX291dCwgIikgIik7CisKKyAg
ICBwcm90X3ByaW50ZihpbWFwZF9vdXQsICJcIiVjXCIgIiwgaW1hcGRfbmFtZXNwYWNlLmhpZXJf
c2VwKTsKKyAKKyAgICAoKmltYXBkX25hbWVzcGFjZS5tYm94bmFtZV90b2V4dGVybmFsKSgmaW1h
cGRfbmFtZXNwYWNlLCBuYW1lLAorICAgICAgICAgICAgaW1hcGRfdXNlcmlkLCBtYm94bmFtZSk7
CisKKyAgICBwcmludGFzdHJpbmcobWJveG5hbWUpOworCisgICAgaWYgKG9wdHMgJiBMSVNUX09Q
VF9FWFRFTkRFRCAmJgorCWF0dHJpYnV0ZXMgJiBNQk9YX0FUVFJJQlVURV9DSElMRElORk9fU1VC
U0NSSUJFRCkgeworCXByb3RfcHJpbnRmKGltYXBkX291dCwgIiAoQ0hJTERJTkZPICgiKTsKKwlp
ZiAoYXR0cmlidXRlcyAmIE1CT1hfQVRUUklCVVRFX0NISUxESU5GT19TVUJTQ1JJQkVEKQorCSAg
ICBwcm90X3ByaW50ZihpbWFwZF9vdXQsICJTVUJTQ1JJQkVEIik7CisJcHJvdF9wcmludGYoaW1h
cGRfb3V0LCAiKSkiKTsKICAgICB9CiAKLSAgICBzdHJsY3B5KGxhc3RuYW1lLCBuYW1lLCBzaXpl
b2YobGFzdG5hbWUpKTsKLSAgICBsYXN0bmFtZVttYXRjaGxlbl0gPSAnXDAnOwotICAgIG5vbmV4
aXN0ZW50ID0gMDsKKyAgICBwcm90X3ByaW50ZihpbWFwZF9vdXQsICJcclxuIik7Cit9CisKK3N0
YXRpYyBpbnQgc2V0X3N1YnNjcmliZWQoY2hhciAqbmFtZSwgaW50IG1hdGNobGVuLCBpbnQgbWF5
Y3JlYXRlLAorCQkJICBpbnQgKmF0dHJpYnV0ZXMpCit7CisgICAgbGlzdF9jYWxsYmFja19jYWxs
cysrOworICAgIGlmICghbmFtZVttYXRjaGxlbl0pIAorCSphdHRyaWJ1dGVzIHw9IE1CT1hfQVRU
UklCVVRFX1NVQlNDUklCRUQ7CisgICAgcmV0dXJuIENZUlVTREJfRE9ORTsKK30KKworLyogY2Fs
bGJhY2sgZm9yIG1ib3hsaXN0X2ZpbmRhbGwKKyAqIHVzZWQgd2hlbiB0aGUgU1VCU0NSSUJFRCBz
ZWxlY3Rpb24gb3B0aW9uIGlzIE5PVCBnaXZlbiAqLworc3RhdGljIGludCBsaXN0X2NiKGNoYXIg
Km5hbWUsIGludCBtYXRjaGxlbiwgaW50IG1heWNyZWF0ZSwKKwkJICBzdHJ1Y3QgbGlzdF9yb2Nr
ICpyb2NrKQoreworICAgIGludCBsYXN0X2xlbjsKKyAgICBpbnQgbGFzdF9uYW1lX2lzX2FuY2Vz
dG9yID0KKwlyb2NrLT5sYXN0X25hbWUKKwkmJiBtYXRjaGxlbiA+PSAobGFzdF9sZW4gPSBzdHJs
ZW4ocm9jay0+bGFzdF9uYW1lKSkKKwkmJiBuYW1lW2xhc3RfbGVuXSA9PSAnLicKKwkmJiAhbWVt
Y21wKHJvY2stPmxhc3RfbmFtZSwgbmFtZSwgbGFzdF9sZW4pOwogCi0gICAgLyogTm93IHdlIG5l
ZWQgdG8gc2VlIGlmIHRoaXMgbWFpbGJveCBleGlzdHMgKi8KLSAgICAvKiBmaXJzdCBjb252ZXJ0
ICJJTkJPWCIgdG8gInVzZXIuPHVzZXJpZD4iICovCi0gICAgaWYgKCFzdHJuY2FzZWNtcChsYXN0
bmFtZSwgImluYm94IiwgNSkpIHsKLQkoKmltYXBkX25hbWVzcGFjZS5tYm94bmFtZV90b2ludGVy
bmFsKSgmaW1hcGRfbmFtZXNwYWNlLCAiSU5CT1giLAotCQkJCQkgICAgICAgaW1hcGRfdXNlcmlk
LCBtYm94bmFtZSk7Ci0Jc3RybGNhdChtYm94bmFtZSwgbGFzdG5hbWUrNSwgc2l6ZW9mKG1ib3hu
YW1lKSk7CisgICAgbGlzdF9jYWxsYmFja19jYWxscysrOworCisgICAgaWYgKGxhc3RfbmFtZV9p
c19hbmNlc3RvcikKKwlyb2NrLT5sYXN0X2F0dHJpYnV0ZXMgfD0gTUJPWF9BVFRSSUJVVEVfSEFT
Q0hJTERSRU47CisKKyAgICBpZiAoIW5hbWVbbWF0Y2hsZW5dKSB7CisJLyogZXhhY3QgbWF0Y2gg
Ki8KKwlpZiAoICEgKHJvY2stPmxhc3RfYXR0cmlidXRlcyAmIE1CT1hfQVRUUklCVVRFX0hBU0NI
SUxEUkVOKSApCisJICAgIHJvY2stPmxhc3RfYXR0cmlidXRlcyB8PSBNQk9YX0FUVFJJQlVURV9I
QVNOT0NISUxEUkVOOworCWxpc3RfcmVzcG9uc2Uocm9jay0+bGFzdF9uYW1lLCByb2NrLT5sYXN0
X2F0dHJpYnV0ZXMsIHJvY2stPm9wdHMpOworCWZyZWUocm9jay0+bGFzdF9uYW1lKTsKKwlyb2Nr
LT5sYXN0X25hbWUgPSB4c3RyZHVwKG5hbWUpOworCXJvY2stPmxhc3RfYXR0cmlidXRlcyA9IDA7
CisJaWYgKCFtYXljcmVhdGUpCisJICAgIHJvY2stPmxhc3RfYXR0cmlidXRlcyB8PSBNQk9YX0FU
VFJJQlVURV9OT0lORkVSSU9SUzsKKwkvKiB4eHg6IGlzIHRoZXJlIGEgY2hlYXBlciB3YXkgdG8g
ZmlndXJlIG91dCBcU3Vic2NyaWJlZD8gKi8KKwlpZiAocm9jay0+b3B0cyAmIExJU1RfUkVUX1NV
QlNDUklCRUQpCisJICAgIG1ib3hsaXN0X2ZpbmRzdWIoJmltYXBkX25hbWVzcGFjZSwgbmFtZSwg
aW1hcGRfdXNlcmlzYWRtaW4sCisJCQkgICAgIGltYXBkX3VzZXJpZCwgaW1hcGRfYXV0aHN0YXRl
LCBzZXRfc3Vic2NyaWJlZCwKKwkJCSAgICAgJnJvY2stPmxhc3RfYXR0cmlidXRlcywgMCk7Cisg
ICAgfSBlbHNlIGlmIChuYW1lW21hdGNobGVuXSA9PSAnLicKKwkgICAgJiYgISAocm9jay0+b3B0
cyAmIExJU1RfT1BUX0VYVEVOREVEKQorCSAgICAmJiByb2NrLT50cmFpbGluZ19wZXJjZW50KSB7
CisJLyogc3BlY2lhbCBjYXNlOiBpZiB0aGUgbWFpbGJveCBuYW1lIGFyZ3VtZW50IG9mIGEgbm9u
LWV4dGVuZGVkIExpc3QKKwkgKiBjb21tYW5kIGVuZHMgd2l0aCAlLCB3ZSBtdXN0IGluY2x1ZGUg
bWF0Y2hpbmcgbGV2ZWxzIG9mIGhpZXJhcmNoeSAqLworCWlmICggISAocm9jay0+bGFzdF9uYW1l
CisJCSAgICAmJiAhc3RybmNtcChyb2NrLT5sYXN0X25hbWUsIG5hbWUsIG1hdGNobGVuKQorCQkg
ICAgJiYgKHJvY2stPmxhc3RfbmFtZVttYXRjaGxlbl0gPT0gJ1wwJworCQkJfHwgcm9jay0+bGFz
dF9uYW1lW21hdGNobGVuXSA9PSAnLicpKSApIHsKKwkgICAgbGlzdF9yZXNwb25zZShyb2NrLT5s
YXN0X25hbWUsIHJvY2stPmxhc3RfYXR0cmlidXRlcywgcm9jay0+b3B0cyk7CisJICAgIGZyZWUo
cm9jay0+bGFzdF9uYW1lKTsKKwkgICAgcm9jay0+bGFzdF9uYW1lID0geHN0cm5kdXAobmFtZSwg
bWF0Y2hsZW4pOworCSAgICByb2NrLT5sYXN0X2F0dHJpYnV0ZXMgPSBNQk9YX0FUVFJJQlVURV9O
T05FWElTVEVOVAorCQl8IE1CT1hfQVRUUklCVVRFX05PU0VMRUNUIHwgTUJPWF9BVFRSSUJVVEVf
SEFTQ0hJTERSRU47CisJfQogICAgIH0KLSAgICBlbHNlCi0Jc3RybGNweShtYm94bmFtZSwgbGFz
dG5hbWUsIHNpemVvZihtYm94bmFtZSkpOwogCi0gICAgLyogTG9vayBpdCB1cCAqLwotICAgIG5v
bmV4aXN0ZW50ID0gbWJveGxpc3RfZGV0YWlsKG1ib3huYW1lLCAmbWJ0eXBlLAotCQkJCSAgTlVM
TCwgTlVMTCwgTlVMTCwgTlVMTCwgTlVMTCk7Ci0gICAgaWYoIW5vbmV4aXN0ZW50ICYmIChtYnR5
cGUgJiBNQlRZUEVfUkVTRVJWRSkpCi0Jbm9uZXhpc3RlbnQgPSBJTUFQX01BSUxCT1hfUkVTRVJW
RUQ7CisgICAgcmV0dXJuIDA7Cit9CisKKy8qIGNhbGxiYWNrIGZvciBtYm94bGlzdF9maW5kc3Vi
CisgKiB1c2VkIHdoZW4gU1VCU0NSSUJFRCBidXQgbm90IFJFQ1VSU0lWRU1BVENIIGlzIGdpdmVu
ICovCitzdGF0aWMgaW50IHN1YnNjcmliZWRfY2IoY2hhciAqbmFtZSwgaW50IG1hdGNobGVuLCBp
bnQgbWF5Y3JlYXRlLAorCQkJIHN0cnVjdCBsaXN0X3JvY2sgKnJvY2spCit7CisgICAgaW50IGxh
c3RfbGVuOworICAgIGludCBsYXN0X25hbWVfaXNfYW5jZXN0b3IgPQorCXJvY2stPmxhc3RfbmFt
ZQorCSYmIG1hdGNobGVuID49IChsYXN0X2xlbiA9IHN0cmxlbihyb2NrLT5sYXN0X25hbWUpKQor
CSYmIG5hbWVbbGFzdF9sZW5dID09ICcuJworCSYmICFtZW1jbXAocm9jay0+bGFzdF9uYW1lLCBu
YW1lLCBsYXN0X2xlbik7CisKKyAgICBsaXN0X2NhbGxiYWNrX2NhbGxzKys7CisKKyAgICBpZiAo
bGFzdF9uYW1lX2lzX2FuY2VzdG9yKQorCXJvY2stPmxhc3RfYXR0cmlidXRlcyB8PSBNQk9YX0FU
VFJJQlVURV9IQVNDSElMRFJFTjsKIAogICAgIGlmICghbmFtZVttYXRjaGxlbl0pIHsKLQlsYXN0
bmFtZWRlbGF5ZWQgPSAxOwotCWlmICghbWF5Y3JlYXRlKSBsYXN0bmFtZW5vaW5mZXJpb3JzID0g
MTsKLQlyZXR1cm47CisJLyogZXhhY3QgbWF0Y2ggKi8KKwlsaXN0X3Jlc3BvbnNlKHJvY2stPmxh
c3RfbmFtZSwgcm9jay0+bGFzdF9hdHRyaWJ1dGVzLCByb2NrLT5vcHRzKTsKKwlmcmVlKHJvY2st
Pmxhc3RfbmFtZSk7CisJcm9jay0+bGFzdF9uYW1lID0geHN0cmR1cChuYW1lKTsKKwlyb2NrLT5s
YXN0X2F0dHJpYnV0ZXMgPSBNQk9YX0FUVFJJQlVURV9TVUJTQ1JJQkVEOworCWlmICghbWF5Y3Jl
YXRlKQorCSAgICByb2NrLT5sYXN0X2F0dHJpYnV0ZXMgfD0gTUJPWF9BVFRSSUJVVEVfTk9JTkZF
UklPUlM7CisgICAgfSBlbHNlIGlmIChuYW1lW21hdGNobGVuXSA9PSAnLicKKwkgICAgJiYgcm9j
ay0+b3B0cyAmIExJU1RfT1BUX0xTVUIKKwkgICAgJiYgcm9jay0+dHJhaWxpbmdfcGVyY2VudCkg
eworCS8qIHNwZWNpYWwgY2FzZTogaWYgdGhlIG1haWxib3ggbmFtZSBhcmd1bWVudCBvZiBhbiBM
c3ViIGNvbW1hbmQgZW5kcworCSAqIHdpdGggJSwgbWFpbGJveCBuYW1lcyB0aGF0IG1hdGNoIHRo
ZSBwYXR0ZXJuIGJ1dCBhcmVuJ3Qgc3Vic2NyaWJlZAorCSAqIG11c3QgYWxzbyBiZSByZXR1cm5l
ZCBpZiB0aGV5IGhhdmUgYSBjaGlsZCBtYWlsYm94IHRoYXQgaXMKKwkgKiBzdWJzY3JpYmVkICov
CisJbmFtZVttYXRjaGxlbl0gPSAnXDAnOworCWlmICggISAocm9jay0+bGFzdF9uYW1lICYmICFz
dHJjbXAocm9jay0+bGFzdF9uYW1lLCBuYW1lKSkgKSB7CisJICAgIGxpc3RfcmVzcG9uc2Uocm9j
ay0+bGFzdF9uYW1lLCByb2NrLT5sYXN0X2F0dHJpYnV0ZXMsIHJvY2stPm9wdHMpOworCSAgICBm
cmVlKHJvY2stPmxhc3RfbmFtZSk7CisJICAgIHJvY2stPmxhc3RfbmFtZSA9IHhzdHJkdXAobmFt
ZSk7CisJICAgIHJvY2stPmxhc3RfYXR0cmlidXRlcyA9IE1CT1hfQVRUUklCVVRFX0NISUxESU5G
T19TVUJTQ1JJQkVEOworCX0KKwluYW1lW21hdGNobGVuXSA9ICcuJzsKKyAgICB9CisKKyAgICBy
ZXR1cm4gMDsKK30KKworLyoKKyAqIFRha2VzIHRoZSAicmVmZXJlbmNlIG5hbWUiIGFuZCAibWFp
bGJveCBuYW1lIiBhcmd1bWVudHMgb2YgdGhlIExJU1QgY29tbWFuZAorICogYW5kIHJldHVybnMg
YSAiY2Fub25pY2FsIExJU1QgcGF0dGVybiIuIFRoZSBjYWxsZXIgaXMgcmVzcG9uc2libGUgZm9y
CisgKiBmcmVlKClpbmcgdGhlIHJldHVybmVkIHN0cmluZy4KKyAqLworY2hhciAqY2Fub25pY2Fs
X2xpc3RfcGF0dGVybihjb25zdCBjaGFyICpyZWZlcmVuY2UsIGNvbnN0IGNoYXIgKnBhdHRlcm4p
Cit7CisgICAgaW50IHBhdGxlbiA9IHN0cmxlbihwYXR0ZXJuKTsKKyAgICBpbnQgcmVmbGVuID0g
c3RybGVuKHJlZmVyZW5jZSk7CisKKyAgICBjaGFyICpidWYgPSB4bWFsbG9jKHBhdGxlbiArIHJl
ZmxlbiArIDEpOworICAgIGJ1ZlswXSA9ICdcMCc7CisKKyAgICBpZiAoKnJlZmVyZW5jZSkgewor
CWlmIChyZWZlcmVuY2VbcmVmbGVuLTFdID09IGltYXBkX25hbWVzcGFjZS5oaWVyX3NlcCAmJgor
CQlwYXR0ZXJuWzBdID09IGltYXBkX25hbWVzcGFjZS5oaWVyX3NlcCkKKwkgICAgLS1yZWZsZW47
CisJbWVtY3B5KGJ1ZiwgcmVmZXJlbmNlLCByZWZsZW4pOworCWJ1ZltyZWZsZW5dID0gJ1wwJzsK
KyAgICB9CisgICAgc3RyY2F0KGJ1ZiwgcGF0dGVybik7CisKKyAgICByZXR1cm4gYnVmOworfQor
CisvKgorICogVHVybnMgdGhlIHN0cmluZ3MgaW4gcGF0dGVybnMgaW50byAiY2Fub25pY2FsIExJ
U1QgcGF0dGVybiJzLiBBbHNvCisgKiB0cmFuc2xhdGVzIGFueSBoaWVyYXJjaHkgc2VwYXJhdG9y
cy4KKyAqLwordm9pZCBjYW5vbmljYWxfbGlzdF9wYXR0ZXJucyhjaGFyICpyZWZlcmVuY2UsIHN0
cnVjdCBzdHJsaXN0ICpwYXR0ZXJucykKK3sKKyAgICBzdGF0aWMgaW50IGlnbm9yZXJlZmVyZW5j
ZSA9IDA7CisgICAgY2hhciAqb2xkOworCisgICAgLyogSWdub3JlIHRoZSByZWZlcmVuY2UgYXJn
dW1lbnQ/CisgICAgICAgKHRoZSBiZWhhdmlvciBpbiAxLjUuMTAgJiBvbGRlcikgKi8KKyAgICBp
ZiAoaWdub3JlcmVmZXJlbmNlID09IDApCisJaWdub3JlcmVmZXJlbmNlID0gY29uZmlnX2dldHN3
aXRjaChJTUFQT1BUX0lHTk9SRVJFRkVSRU5DRSk7CisKKyAgICBmb3IgKDsgcGF0dGVybnM7IHBh
dHRlcm5zID0gcGF0dGVybnMtPm5leHQpIHsKKwlpZiAoIWlnbm9yZXJlZmVyZW5jZSB8fCBwYXR0
ZXJucy0+c1swXSA9PSBpbWFwZF9uYW1lc3BhY2UuaGllcl9zZXApIHsKKwkgICAgb2xkID0gcGF0
dGVybnMtPnM7CisJICAgIHBhdHRlcm5zLT5zID0gY2Fub25pY2FsX2xpc3RfcGF0dGVybihyZWZl
cmVuY2UsIG9sZCk7CisJICAgIGZyZWUob2xkKTsKKwl9CisJLyogVHJhbnNsYXRlIGFueSBzZXBh
cmF0b3JzIGluIHBhdHRlcm4gKi8KKwltYm94bmFtZV9oaWVyc2VwX3RvaW50ZXJuYWwoJmltYXBk
X25hbWVzcGFjZSwgcGF0dGVybnMtPnMsCisJCQkJICAgIGNvbmZpZ192aXJ0ZG9tYWlucyA/CisJ
CQkJICAgIHN0cmNzcG4ocGF0dGVybnMtPnMsICJAIikgOiAwKTsKICAgICB9Cit9CiAKLSAgICBj
ID0gbmFtZVttYXRjaGxlbl07Ci0gICAgaWYgKGMpIG5hbWVbbWF0Y2hsZW5dID0gJ1wwJzsKLSAg
ICBwcm90X3ByaW50ZihpbWFwZF9vdXQsICIqICVzICgiLCBjbWQpOwotICAgIGlmIChjKSB7Ci0J
LyogSGFuZGxlIG5hbWVzcGFjZSBwcmVmaXggYXMgYSBzcGVjaWFsIGNhc2UgKi8gCi0JaWYgKCFz
dHJjbXAobmFtZSwgInVzZXIiKSB8fAotCSAgICAhc3RyY21wKG5hbWUsIGltYXBkX25hbWVzcGFj
ZS5wcmVmaXhbTkFNRVNQQUNFX1NIQVJFRF0pKSB7Ci0JICAgIHByb3RfcHJpbnRmKGltYXBkX291
dCwgIlxcTm9zZWxlY3QiKTsKLQkgICAgaWYgKGxpc3RvcHRzICYgTElTVF9FWFQpCi0JCXByb3Rf
cHJpbnRmKGltYXBkX291dCwgIiBcXFBsYWNlSG9sZGVyIik7CisvKiBjYWxsYmFjayBmb3IgbWJv
eGxpc3RfZmluZHN1YgorICogdXNlZCBieSBsaXN0X2RhdGFfcmVjdXJzaXZlbWF0Y2ggKi8KK3N0
YXRpYyBpbnQgcmVjdXJzaXZlbWF0Y2hfY2IoY2hhciAqbmFtZSwgaW50IG1hdGNobGVuLCBpbnQg
bWF5Y3JlYXRlLAorCQkJICAgICBzdHJ1Y3QgbGlzdF9yb2NrX3JlY3Vyc2l2ZW1hdGNoICpyb2Nr
KSB7CisgICAgbGlzdF9jYWxsYmFja19jYWxscysrOworCisgICAgaWYgKG5hbWVbbWF0Y2hsZW5d
KSB7CisJaWYgKG5hbWVbbWF0Y2hsZW5dID09ICcuJykgeworCSAgICBpbnQgKnBhcmVudF9pbmZv
OworCSAgICBuYW1lW21hdGNobGVuXSA9ICdcMCc7CisJICAgIHBhcmVudF9pbmZvID0gaGFzaF9s
b29rdXAobmFtZSwgJnJvY2stPnRhYmxlKTsKKwkgICAgaWYgKCFwYXJlbnRfaW5mbykgeworCQlw
YXJlbnRfaW5mbyA9IHh6bWFsbG9jKHNpemVvZihpbnQpKTsKKwkJaWYgKCFtYXljcmVhdGUpICpw
YXJlbnRfaW5mbyB8PSBNQk9YX0FUVFJJQlVURV9OT0lORkVSSU9SUzsKKwkJaGFzaF9pbnNlcnQo
bmFtZSwgcGFyZW50X2luZm8sICZyb2NrLT50YWJsZSk7CisJCXJvY2stPmNvdW50Kys7CisJICAg
IH0KKwkgICAgKnBhcmVudF9pbmZvIHw9IE1CT1hfQVRUUklCVVRFX0NISUxESU5GT19TVUJTQ1JJ
QkVEOworCSAgICBuYW1lW21hdGNobGVuXSA9ICcuJzsKIAl9Ci0JZWxzZSB7Ci0JICAgIGlmIChu
b25leGlzdGVudCkKLQkJcHJvdF9wcmludGYoaW1hcGRfb3V0LCAiXFxOb25FeGlzdGVudCIpOwot
CSAgICAvKiBMSVNURVhUIHVzZXMgXFBsYWNlSG9sZGVyIGluc3RlYWQgb2YgXE5vc2VsZWN0ICov
Ci0JICAgIGlmIChsaXN0b3B0cyAmIExJU1RfRVhUKQotCQlwcm90X3ByaW50ZihpbWFwZF9vdXQs
ICIlc1xcUGxhY2VIb2xkZXIiLCBub25leGlzdGVudCA/ICIgIiA6ICIiKTsKLQkgICAgZWxzZQot
CQlwcm90X3ByaW50ZihpbWFwZF9vdXQsICIlc1xcTm9zZWxlY3QiLCBub25leGlzdGVudCA/ICIg
IiA6ICIiKTsKKyAgICB9IGVsc2UgeworCWludCAqbGlzdF9pbmZvID0gaGFzaF9sb29rdXAobmFt
ZSwgJnJvY2stPnRhYmxlKTsKKwlpZiAoIWxpc3RfaW5mbykgeworCSAgICBsaXN0X2luZm8gPSB4
em1hbGxvYyhzaXplb2YoaW50KSk7CisJICAgICpsaXN0X2luZm8gfD0gTUJPWF9BVFRSSUJVVEVf
U1VCU0NSSUJFRDsKKwkgICAgaWYgKCFtYXljcmVhdGUpICpsaXN0X2luZm8gfD0gTUJPWF9BVFRS
SUJVVEVfTk9JTkZFUklPUlM7CisJICAgIGhhc2hfaW5zZXJ0KG5hbWUsIGxpc3RfaW5mbywgJnJv
Y2stPnRhYmxlKTsKKwkgICAgcm9jay0+Y291bnQrKzsKIAl9Ci0JaWYgKGxpc3RvcHRzICYgTElT
VF9DSElMRFJFTikKLQkgICAgcHJvdF9wcmludGYoaW1hcGRfb3V0LCAiIFxcSGFzQ2hpbGRyZW4i
KTsKICAgICB9Ci0gICAgcHJvdF9wcmludGYoaW1hcGRfb3V0LCAiKSBcIiVjXCIgIiwgaW1hcGRf
bmFtZXNwYWNlLmhpZXJfc2VwKTsKIAotICAgICgqaW1hcGRfbmFtZXNwYWNlLm1ib3huYW1lX3Rv
ZXh0ZXJuYWwpKCZpbWFwZF9uYW1lc3BhY2UsIG5hbWUsCi0JCQkJCSAgIGltYXBkX3VzZXJpZCwg
bWJveG5hbWUpOwotICAgIHByaW50c3RyaW5nKG1ib3huYW1lKTsKLSAgICBwcm90X3ByaW50Zihp
bWFwZF9vdXQsICJcclxuIik7Ci0gICAgaWYgKGMpIG5hbWVbbWF0Y2hsZW5dID0gYzsKLSAgICBy
ZXR1cm47CisgICAgcmV0dXJuIDA7Cit9CisKKy8qIGNhbGxiYWNrIGZvciBoYXNoX2VudW1lcmF0
ZSAqLwordm9pZCBjb3B5X3RvX2FycmF5KGNoYXIgKmtleSwgdm9pZCAqZGF0YSwgdm9pZCAqdm9p
ZF9yb2NrKSB7CisgICAgaW50ICphdHRyaWJ1dGVzID0gKGludCAqKWRhdGE7CisgICAgc3RydWN0
IGxpc3Rfcm9ja19yZWN1cnNpdmVtYXRjaCAqcm9jayA9CisJKHN0cnVjdCBsaXN0X3JvY2tfcmVj
dXJzaXZlbWF0Y2ggKil2b2lkX3JvY2s7CisgICAgYXNzZXJ0KHJvY2stPmNvdW50ID4gMCk7Cisg
ICAgcm9jay0+YXJyYXlbLS1yb2NrLT5jb3VudF0ubmFtZSA9IGtleTsKKyAgICByb2NrLT5hcnJh
eVtyb2NrLT5jb3VudF0uYXR0cmlidXRlcyA9ICphdHRyaWJ1dGVzOworfQorCisvKiBDb21wYXJh
dG9yIGZvciByZXZlcnNlLXNvcnRpbmcgYW4gYXJyYXkgb2Ygc3RydWN0IGxpc3RfZW50cnkgYnkg
bWJveG5hbWUuICovCitpbnQgbGlzdF9lbnRyeV9jb21wYXJhdG9yKGNvbnN0IHZvaWQgKnAxLCBj
b25zdCB2b2lkICpwMikgeworICAgIGNvbnN0IHN0cnVjdCBsaXN0X2VudHJ5ICplMSA9IChzdHJ1
Y3QgbGlzdF9lbnRyeSAqKXAxOworICAgIGNvbnN0IHN0cnVjdCBsaXN0X2VudHJ5ICplMiA9IChz
dHJ1Y3QgbGlzdF9lbnRyeSAqKXAyOworCisgICAgcmV0dXJuIGJzZWFyY2hfY29tcGFyZShlMi0+
bmFtZSwgZTEtPm5hbWUpOworfQorCitzdGF0aWMgdm9pZCBsaXN0X2RhdGFfcmVjdXJzaXZlbWF0
Y2goc3RydWN0IHN0cmxpc3QgKnBhdHRlcm5zLCBpbnQgb3B0cywKKwkJCQkgICAgIGludCAoKmZp
bmRzdWIpKHN0cnVjdCBuYW1lc3BhY2UgKiwKKwkJCQkJIGNvbnN0IGNoYXIgKiwgaW50LCBjaGFy
ICosCisJCQkJCSBzdHJ1Y3QgYXV0aF9zdGF0ZSAqLCBpbnQgKCopKCksCisJCQkJCSB2b2lkICos
IGludCkpIHsKKyAgICBzdHJ1Y3Qgc3RybGlzdCAqcGF0dGVybjsKKyAgICBzdHJ1Y3QgbGlzdF9y
b2NrX3JlY3Vyc2l2ZW1hdGNoIHJvY2s7CisKKyAgICByb2NrLmNvdW50ID0gMDsKKyAgICByb2Nr
Lm9wdHMgPSBvcHRzOworICAgIGNvbnN0cnVjdF9oYXNoX3RhYmxlKCZyb2NrLnRhYmxlLCAxMDAs
IDEpOworCisgICAgLyogZmluZCAqLworICAgIGZvciAocGF0dGVybiA9IHBhdHRlcm5zOyBwYXR0
ZXJuOyBwYXR0ZXJuID0gcGF0dGVybi0+bmV4dCkKKwlmaW5kc3ViKCZpbWFwZF9uYW1lc3BhY2Us
IHBhdHRlcm4tPnMsIGltYXBkX3VzZXJpc2FkbWluLCBpbWFwZF91c2VyaWQsCisJCWltYXBkX2F1
dGhzdGF0ZSwgcmVjdXJzaXZlbWF0Y2hfY2IsICZyb2NrLCAxKTsKKworICAgIGlmIChyb2NrLmNv
dW50KSB7CisJLyogc29ydCAqLworCWludCBlbnRyaWVzID0gcm9jay5jb3VudDsKKwlyb2NrLmFy
cmF5ID0geG1hbGxvYyhlbnRyaWVzICogKHNpemVvZihzdHJ1Y3QgbGlzdF9lbnRyeSkpKTsKKwlo
YXNoX2VudW1lcmF0ZSgmcm9jay50YWJsZSwgY29weV90b19hcnJheSwgJnJvY2spOworCXFzb3J0
KHJvY2suYXJyYXksIGVudHJpZXMsIHNpemVvZihzdHJ1Y3QgbGlzdF9lbnRyeSksCisJICAgICAg
bGlzdF9lbnRyeV9jb21wYXJhdG9yKTsKKwlhc3NlcnQocm9jay5jb3VudCA9PSAwKTsKKworCS8q
IHByaW50ICovCisJZm9yIChlbnRyaWVzLS07IGVudHJpZXMgPj0gMDsgZW50cmllcy0tKQorCSAg
ICBsaXN0X3Jlc3BvbnNlKHJvY2suYXJyYXlbZW50cmllc10ubmFtZSwKKwkJICAgIHJvY2suYXJy
YXlbZW50cmllc10uYXR0cmlidXRlcywKKwkJICAgIHJvY2sub3B0cyk7CisKKwlmcmVlKHJvY2su
YXJyYXkpOworICAgIH0KKworICAgIGZyZWVfaGFzaF90YWJsZSgmcm9jay50YWJsZSwgZnJlZSk7
Cit9CisKKy8qIFJldHJpZXZlcyB0aGUgZGF0YSBhbmQgcHJpbnRzIHRoZSB1bnRhZ2dlZCByZXNw
b25zZXMgZm9yIGEgTElTVCBjb21tYW5kLiAqLworc3RhdGljIHZvaWQgbGlzdF9kYXRhKGludCBs
aXN0b3B0cywgY2hhciAqcmVmZXJlbmNlLCBzdHJ1Y3Qgc3RybGlzdCAqcGF0dGVybnMpCit7Cisg
ICAgaW50ICgqZmluZGFsbCkoc3RydWN0IG5hbWVzcGFjZSAqbmFtZXNwYWNlLAorCQkgICBjb25z
dCBjaGFyICpwYXR0ZXJuLCBpbnQgaXNhZG1pbiwgY2hhciAqdXNlcmlkLAorCQkgICBzdHJ1Y3Qg
YXV0aF9zdGF0ZSAqYXV0aF9zdGF0ZSwgaW50ICgqcHJvYykoKSwKKwkJICAgdm9pZCAqcm9jayk7
CisgICAgaW50ICgqZmluZHN1Yikoc3RydWN0IG5hbWVzcGFjZSAqbmFtZXNwYWNlLAorCQkgICBj
b25zdCBjaGFyICpwYXR0ZXJuLCBpbnQgaXNhZG1pbiwgY2hhciAqdXNlcmlkLAorCQkgICBzdHJ1
Y3QgYXV0aF9zdGF0ZSAqYXV0aF9zdGF0ZSwgaW50ICgqcHJvYykoKSwKKwkJICAgdm9pZCAqcm9j
aywgaW50IGZvcmNlKTsKKyAgICBjYW5vbmljYWxfbGlzdF9wYXR0ZXJucyhyZWZlcmVuY2UsIHBh
dHRlcm5zKTsKKworICAgIC8qIENoZWNrIHRvIHNlZSBpZiB3ZSBzaG91bGQgb25seSBsaXN0IHRo
ZSBwZXJzb25hbCBuYW1lc3BhY2UgKi8KKyAgICBpZiAoIShsaXN0b3B0cyAmIExJU1RfT1BUX0VY
VEVOREVEKQorCSAgICAmJiAhc3RyY21wKHBhdHRlcm5zLT5zLCAiKiIpCisJICAgICYmIGNvbmZp
Z19nZXRzd2l0Y2goSU1BUE9QVF9GT09MU1RVUElEQ0xJRU5UUykpIHsKKwlmcmVlKHBhdHRlcm5z
LT5zKTsKKwlwYXR0ZXJucy0+cyA9IHhzdHJkdXAoIklOQk9YKiIpOworCWZpbmRzdWIgPSBtYm94
bGlzdF9maW5kc3ViOworCWZpbmRhbGwgPSBtYm94bGlzdF9maW5kYWxsOworICAgIH0gZWxzZSB7
CisJZmluZHN1YiA9IGltYXBkX25hbWVzcGFjZS5tYm94bGlzdF9maW5kc3ViOworCWZpbmRhbGwg
PSBpbWFwZF9uYW1lc3BhY2UubWJveGxpc3RfZmluZGFsbDsKKyAgICB9CisKKyAgICBpZiAobGlz
dG9wdHMgJiBMSVNUX1NFTF9SRUNVUlNJVkVNQVRDSCkgeworCWxpc3RfZGF0YV9yZWN1cnNpdmVt
YXRjaChwYXR0ZXJucywgbGlzdG9wdHMsIGZpbmRzdWIpOworICAgIH0gZWxzZSB7CisJc3RydWN0
IHN0cmxpc3QgKnBhdHRlcm47CisJc3RydWN0IGxpc3Rfcm9jayByb2NrOworCXJvY2sub3B0cyA9
IGxpc3RvcHRzOworCXJvY2subGFzdF9uYW1lID0gTlVMTDsKKwlpZiAobGlzdG9wdHMgJiBMSVNU
X1NFTF9TVUJTQ1JJQkVEKSB7CisJICAgIGZvciAocGF0dGVybiA9IHBhdHRlcm5zOyBwYXR0ZXJu
OyBwYXR0ZXJuID0gcGF0dGVybi0+bmV4dCkgeworCQlyb2NrLnRyYWlsaW5nX3BlcmNlbnQgPQor
CQkgICAgcGF0dGVybi0+c1tzdHJsZW4ocGF0dGVybi0+cykgLSAxXSA9PSAnJSc7CisJCWZpbmRz
dWIoJmltYXBkX25hbWVzcGFjZSwgcGF0dGVybi0+cywgaW1hcGRfdXNlcmlzYWRtaW4sCisJCQlp
bWFwZF91c2VyaWQsIGltYXBkX2F1dGhzdGF0ZSwgc3Vic2NyaWJlZF9jYiwgJnJvY2ssIDEpOwor
CQlsaXN0X3Jlc3BvbnNlKHJvY2subGFzdF9uYW1lLCByb2NrLmxhc3RfYXR0cmlidXRlcywgcm9j
ay5vcHRzKTsKKwkJZnJlZShyb2NrLmxhc3RfbmFtZSk7CisJCXJvY2subGFzdF9uYW1lID0gTlVM
TDsKKwkgICAgfQorCX0gZWxzZSB7CisJICAgIC8qIGltcGxpY2l0bHkgcmV0dXJuIENISUxEUkVO
IGluZm8gKi8KKwkgICAgcm9jay5vcHRzIHw9IExJU1RfUkVUX0NISUxEUkVOOworCSAgICBmb3Ig
KHBhdHRlcm4gPSBwYXR0ZXJuczsgcGF0dGVybjsgcGF0dGVybiA9IHBhdHRlcm4tPm5leHQpIHsK
KwkJcm9jay50cmFpbGluZ19wZXJjZW50ID0KKwkJICAgIHBhdHRlcm4tPnNbc3RybGVuKHBhdHRl
cm4tPnMpIC0gMV0gPT0gJyUnOworCQlmaW5kYWxsKCZpbWFwZF9uYW1lc3BhY2UsIHBhdHRlcm4t
PnMsIGltYXBkX3VzZXJpc2FkbWluLAorCQkJaW1hcGRfdXNlcmlkLCBpbWFwZF9hdXRoc3RhdGUs
IGxpc3RfY2IsICZyb2NrKTsKKwkJbGlzdF9yZXNwb25zZShyb2NrLmxhc3RfbmFtZSwgcm9jay5s
YXN0X2F0dHJpYnV0ZXMsIHJvY2sub3B0cyk7CisJCWZyZWUocm9jay5sYXN0X25hbWUpOworCQly
b2NrLmxhc3RfbmFtZSA9IE5VTEw7CisJICAgIH0KKwl9CisgICAgfQogfQogCiAvKgotICogSXNz
dWUgYSBMSVNUIHVudGFnZ2VkIHJlc3BvbnNlCisgKiBSZXRyaWV2ZXMgdGhlIGRhdGEgYW5kIHBy
aW50cyB0aGUgdW50YWdnZWQgcmVzcG9uc2VzIGZvciBhIExJU1QgY29tbWFuZCBpbgorICogdGhl
IGNhc2Ugb2YgYSByZW1vdGUgaW5ib3guCiAgKi8KLXN0YXRpYyBpbnQgbGlzdGRhdGEoY2hhciAq
bmFtZSwgaW50IG1hdGNobGVuLCBpbnQgbWF5Y3JlYXRlLCB2b2lkICpyb2NrKQorc3RhdGljIHZv
aWQgbGlzdF9kYXRhX3JlbW90ZShjaGFyICp0YWcsIGludCBsaXN0b3B0cywgY2hhciAqcmVmZXJl
bmNlLAorCQkJICAgICBzdHJ1Y3Qgc3RybGlzdCAqcGF0dGVybikKIHsKLSAgICBpbnQgbGlzdG9w
dHMgPSAqKChpbnQgKilyb2NrKTsKLSAgICAKLSAgICBtc3RyaW5nZGF0YSgoKGxpc3RvcHRzICYg
TElTVF9MU1VCKSA/ICJMU1VCIiA6ICJMSVNUIiksCi0JbmFtZSwgbWF0Y2hsZW4sIG1heWNyZWF0
ZSwgbGlzdG9wdHMpOworICAgIGlmIChsaXN0b3B0cyAmIExJU1RfT1BUX0VYVEVOREVECisJICAg
ICYmICFDQVBBKGJhY2tlbmRfaW5ib3gsIENBUEFfTElTVEVYVEVOREVEKSkgeworCS8qIGNsaWVu
dCB3YW50cyB0byB1c2UgZXh0ZW5kZWQgbGlzdCBjb21tYW5kIGJ1dCBiYWNrZW5kIGRvZXNuJ3QK
KwkgKiBzdXBwb3J0IGl0ICovCisJcHJvdF9wcmludGYoYmFja2VuZF9pbmJveC0+b3V0LAorCQkg
ICAgIiVzIE5PIEJhY2tlbmQgc2VydmVyIGRvZXMgbm90IHN1cHBvcnQgZXh0ZW5kZWQgbGlzdCBj
b21tYW5kXHJcbiIsCisJCSAgICB0YWcpOworCXJldHVybjsKKyAgICB9CiAKLSAgICByZXR1cm4g
MDsKKyAgICAvKiBwcmludCB0YWcsIGNvbW1hbmQgYW5kIGxpc3Qgc2VsZWN0aW9uIG9wdGlvbnMg
Ki8KKyAgICBpZiAobGlzdG9wdHMgJiBMSVNUX09QVF9FWFRFTkRFRCkgeworCWludCBmaXJzdCA9
IDE7CisJcHJvdF9wcmludGYoYmFja2VuZF9pbmJveC0+b3V0LCAiJXMgTGlzdCAoIiwgdGFnKTsK
KwlpZiAobGlzdG9wdHMgJiBMSVNUX1NFTF9TVUJTQ1JJQkVEKSB7CisJICAgIHByb3RfcHJpbnRm
KGJhY2tlbmRfaW5ib3gtPm91dCwgInN1YnNjcmliZWQiKTsKKwkgICAgZmlyc3QgPSAwOworCX0K
KwlpZiAobGlzdG9wdHMgJiBMSVNUX1NFTF9SRU1PVEUpIHsKKwkgICAgcHJvdF9wcmludGYoYmFj
a2VuZF9pbmJveC0+b3V0LCAiIHJlbW90ZSIrZmlyc3QpOworCSAgICBmaXJzdCA9IDA7CisJfQor
CWlmIChsaXN0b3B0cyAmIExJU1RfU0VMX1JFQ1VSU0lWRU1BVENIKQorCSAgICBwcm90X3ByaW50
ZihiYWNrZW5kX2luYm94LT5vdXQsICIgcmVjdXJzaXZlbWF0Y2giK2ZpcnN0KTsKKwlwcm90X3By
aW50ZihiYWNrZW5kX2luYm94LT5vdXQsICIpICIpOworICAgIH0gZWxzZSB7CisJcHJvdF9wcmlu
dGYoYmFja2VuZF9pbmJveC0+b3V0LCAiJXMgTHN1YiAiLCB0YWcpOworICAgIH0KKworICAgIC8q
IHByaW50IHJlZmVyZW5jZSBhcmd1bWVudCAqLworICAgIHByb3RfcHJpbnRmKGJhY2tlbmRfaW5i
b3gtPm91dCwKKwkJInslZCt9XHJcbiVzICIsIHN0cmxlbihyZWZlcmVuY2UpLCByZWZlcmVuY2Up
OworCisgICAgLyogcHJpbnQgbWFpbGJveCBwYXR0ZXJuKHMpICovCisgICAgaWYgKHBhdHRlcm4t
Pm5leHQpIHsKKwlpbnQgZmlyc3QgPSAxOworCXByb3RfcHV0YygnKCcsIGJhY2tlbmRfaW5ib3gt
Pm91dCk7CisJZm9yICg7IHBhdHRlcm47IHBhdHRlcm4gPSBwYXR0ZXJuLT5uZXh0KSB7CisJICAg
IHByb3RfcHJpbnRmKGJhY2tlbmRfaW5ib3gtPm91dCwgCisJCQkiIHslZCt9XHJcbiVzIitmaXJz
dCwgc3RybGVuKHBhdHRlcm4tPnMpLCBwYXR0ZXJuLT5zKTsKKwkgICAgZmlyc3QgPSAwOworCX0K
Kwlwcm90X3B1dGMoJyknLCBiYWNrZW5kX2luYm94LT5vdXQpOworICAgIH0gZWxzZSB7CisJcHJv
dF9wcmludGYoYmFja2VuZF9pbmJveC0+b3V0LCAKKwkJICAgICJ7JWQrfVxyXG4lcyIsIHN0cmxl
bihwYXR0ZXJuLT5zKSwgcGF0dGVybi0+cyk7CisJcGF0dGVybiA9IHBhdHRlcm4tPm5leHQ7Cisg
ICAgfQorCisgICAgLyogcHJpbnQgbGlzdCByZXR1cm4gb3B0aW9ucyAqLworICAgIGlmIChsaXN0
b3B0cyAmIGxpc3RfcmV0X29wdHMpIHsKKwlwcm90X3ByaW50ZihiYWNrZW5kX2luYm94LT5vdXQs
ICIgcmV0dXJuICgiKTsKKwlpbnQgZmlyc3QgPSAxOworCWlmIChsaXN0b3B0cyAmIExJU1RfUkVU
X1NVQlNDUklCRUQpIHsKKwkgICAgcHJvdF9wcmludGYoYmFja2VuZF9pbmJveC0+b3V0LCAic3Vi
c2NyaWJlZCIpOworCSAgICBmaXJzdCA9IDA7CisJfQorCWlmIChsaXN0b3B0cyAmIExJU1RfUkVU
X0NISUxEUkVOKSB7CisJICAgIHByb3RfcHJpbnRmKGJhY2tlbmRfaW5ib3gtPm91dCwgIiBjaGls
ZHJlbiIrZmlyc3QpOworCX0KKwlwcm90X3B1dGMoJyknLCBiYWNrZW5kX2luYm94LT5vdXQpOwor
ICAgIH0KKworICAgIHByb3RfcHJpbnRmKGJhY2tlbmRfaW5ib3gtPm91dCwgIlxyXG4iKTsKKyAg
ICBwaXBlX2xzdWIoYmFja2VuZF9pbmJveCwgdGFnLCAwLAorCSAgICAgIChsaXN0b3B0cyAmIExJ
U1RfT1BUX0xTVUIpID8gIkxTVUIiIDogIkxJU1QiKTsKIH0KIAogLyogUmVzZXQgdGhlIGdpdmVu
IHNhc2xfY29ubl90IHRvIGEgc2FuZSBzdGF0ZSAqLwpJbmRleDogaW1hcC9pbWFwZC5oCj09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT0KUkNTIGZpbGU6IC9hZnMvYW5kcmV3L3N5c3RlbS9jdnMvc3JjL2N5cnVzL2ltYXAvaW1h
cGQuaCx2CnJldHJpZXZpbmcgcmV2aXNpb24gMS41NS4yLjQKZGlmZiAtdSAtcjEuNTUuMi40IGlt
YXBkLmgKLS0tIGltYXAvaW1hcGQuaAkzMSBNYXIgMjAwNiAxOToyMjoyMSAtMDAwMAkxLjU1LjIu
NAorKysgaW1hcC9pbWFwZC5oCTI1IE9jdCAyMDA2IDE4OjE2OjI5IC0wMDAwCkBAIC0yMjUsMTMg
KzIyNSwzOSBAQAogICAgIFNUQVRVU19ISUdIRVNUTU9EU0VRID0JKDE8PDUpCiB9OwogCi0vKiBC
aXRtYXNrIGZvciBsaXN0IG9wdGlvbnMgKi8KIGVudW0gewotICAgIExJU1RfTFNVQiA9CQkJKDE8
PDApLAotICAgIExJU1RfRVhUID0JCQkoMTw8MSksCi0gICAgTElTVF9TVUJTQ1JJQkVEID0JCSgx
PDwyKSwKLSAgICBMSVNUX0NISUxEUkVOID0JCSgxPDwzKSwKLSAgICBMSVNUX1JFTU9URSA9CQko
MTw8NCkKKyAgICAvKiBMSVNUIHNlbGVjdGlvbiBvcHRpb25zICovCisgICAgTElTVF9TRUxfU1VC
U0NSSUJFRCA9CSgxPDwwKSwKKyAgICBMSVNUX1NFTF9SRU1PVEUgPQkJKDE8PDEpLAorICAgIExJ
U1RfU0VMX1JFQ1VSU0lWRU1BVENIID0JKDE8PDIpLAorCisgICAgLyogTElTVCByZXR1cm4gb3B0
aW9ucyAqLworICAgIExJU1RfUkVUX1NVQlNDUklCRUQgPQkoMTw8OCksCisgICAgTElTVF9SRVRf
Q0hJTERSRU4gPQkJKDE8PDkpLAorCisgICAgLyogb3RoZXIgb3B0aW9ucyAqLworICAgIExJU1Rf
T1BUX1JMSVNUID0JCSgxPDwxNiksCisgICAgTElTVF9PUFRfTFNVQiA9CQkoMTw8MTcpLAorICAg
IExJU1RfT1BUX0VYVEVOREVEID0JCSgxPDwxOCkgIC8qIEV4dGVuZGVkIExpc3QgY29tbWFuZCAq
LworfTsKKyNkZWZpbmUgbGlzdF9zZWxfb3B0cyAoTElTVF9SRVRfU1VCU0NSSUJFRCAtIDEpCisj
ZGVmaW5lIGxpc3RfcmV0X29wdHMgKChMSVNUX09QVF9STElTVCAtIDEpICYgfmxpc3Rfc2VsX29w
dHMpCisKKy8qIE5hbWUgYXR0cmlidXRlcyB0aGF0IG1heSBiZSByZXR1bmVkIGJ5IExJU1QgKi8K
K2VudW0geworICAgIC8qIGZyb20gUkZDIDM1MDEgKi8KKyAgICBNQk9YX0FUVFJJQlVURV9OT0lO
RkVSSU9SUyA9CSgxPDwwKSwKKyAgICBNQk9YX0FUVFJJQlVURV9OT1NFTEVDVCA9CQkoMTw8MSks
CisgICAgTUJPWF9BVFRSSUJVVEVfTUFSS0VEID0JCSgxPDwyKSwKKyAgICBNQk9YX0FUVFJJQlVU
RV9VTk1BUktFRCA9CQkoMTw8MyksCisKKyAgICAvKiBmcm9tIGRyYWZ0LWlldGYtaW1hcGV4dC1s
aXN0LWV4dGVuc2lvbnMtMTgudHh0ICovCisgICAgTUJPWF9BVFRSSUJVVEVfTk9ORVhJU1RFTlQg
PQkoMTw8NCksCisgICAgTUJPWF9BVFRSSUJVVEVfU1VCU0NSSUJFRCA9CQkoMTw8NSksCisgICAg
TUJPWF9BVFRSSUJVVEVfUkVNT1RFID0JCSgxPDw2KSwKKyAgICBNQk9YX0FUVFJJQlVURV9IQVND
SElMRFJFTiA9CSgxPDw3KSwKKyAgICBNQk9YX0FUVFJJQlVURV9IQVNOT0NISUxEUkVOID0JKDE8
PDgpLAorICAgIE1CT1hfQVRUUklCVVRFX0NISUxESU5GT19TVUJTQ1JJQkVEID0gKDE8PDkpCiB9
OwogCiBleHRlcm4gc3RydWN0IHByb3RzdHJlYW0gKmltYXBkX291dCwgKmltYXBkX2luOwpJbmRl
eDogaW1hcC9wcm90b2NvbC5jCj09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KUkNTIGZpbGU6IC9hZnMvYW5kcmV3L3N5c3Rl
bS9jdnMvc3JjL2N5cnVzL2ltYXAvcHJvdG9jb2wuYyx2CnJldHJpZXZpbmcgcmV2aXNpb24gMS4y
LjIuMTQKZGlmZiAtdSAtcjEuMi4yLjE0IHByb3RvY29sLmMKLS0tIGltYXAvcHJvdG9jb2wuYwky
IEF1ZyAyMDA2IDE1OjE2OjIwIC0wMDAwCTEuMi4yLjE0CisrKyBpbWFwL3Byb3RvY29sLmMJMjUg
T2N0IDIwMDYgMTg6MTY6MjkgLTAwMDAKQEAgLTExMyw4ICsxMTMsOCBAQAogCSAgeyAiIElETEUi
LCBDQVBBX0lETEUgfSwKIAkgIHsgIiBNVVBEQVRFIiwgQ0FQQV9NVVBEQVRFIH0sCiAJICB7ICIg
TVVMVElBUFBFTkQiLCBDQVBBX01VTFRJQVBQRU5EIH0sCi0JICB7ICIgTElTVC1TVUJTQ1JJQkVE
IiwgQ0FQQV9MSVNUU1VCU0NSSUJFRCB9LAogCSAgeyAiIFJJR0hUUz1reHRlIiwgQ0FQQV9BQ0xS
SUdIVFMgfSwKKwkgIHsgIiBMSVNULUVYVEVOREVEIiwgQ0FQQV9MSVNURVhURU5ERUQgfSwKIAkg
IHsgTlVMTCwgMCB9IH0gfSwKICAgICAgIHsgIlMwMSBTVEFSVFRMUyIsICJTMDEgT0siLCAiUzAx
IE5PIiB9LAogICAgICAgeyAiQTAxIEFVVEhFTlRJQ0FURSIsIDAsIDAsICJBMDEgT0siLCAiQTAx
IE5PIiwgIisgIiwgIioiLCBOVUxMIH0sCkluZGV4OiBpbWFwL3Byb3RvY29sLmgKPT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PQpSQ1MgZmlsZTogL2Fmcy9hbmRyZXcvc3lzdGVtL2N2cy9zcmMvY3lydXMvaW1hcC9wcm90b2Nv
bC5oLHYKcmV0cmlldmluZyByZXZpc2lvbiAxLjIuMi43CmRpZmYgLXUgLXIxLjIuMi43IHByb3Rv
Y29sLmgKLS0tIGltYXAvcHJvdG9jb2wuaAkyIEF1ZyAyMDA2IDE1OjE2OjIwIC0wMDAwCTEuMi4y
LjcKKysrIGltYXAvcHJvdG9jb2wuaAkyNSBPY3QgMjAwNiAxODoxNjoyOSAtMDAwMApAQCAtNTUs
OCArNTUsOCBAQAogICAgIENBUEFfSURMRQkJPSAoMSA8PCAyKSwKICAgICBDQVBBX01VUERBVEUJ
PSAoMSA8PCAzKSwKICAgICBDQVBBX01VTFRJQVBQRU5ECT0gKDEgPDwgNCksCi0gICAgQ0FQQV9M
SVNUU1VCU0NSSUJFRAk9ICgxIDw8IDUpLAotICAgIENBUEFfQUNMUklHSFRTCT0gKDEgPDwgNiks
CisgICAgQ0FQQV9BQ0xSSUdIVFMJPSAoMSA8PCA1KSwKKyAgICBDQVBBX0xJU1RFWFRFTkRFRCAg
ID0gKDEgPDwgNiksCiAKICAgICAvKiBMTVRQIGNhcGFiaWxpdGllcyAqLwogICAgIENBUEFfUElQ
RUxJTklORwk9ICgxIDw8IDIpLApJbmRleDogaW1hcC92ZXJzaW9uLmgKPT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQpSQ1Mg
ZmlsZTogL2Fmcy9hbmRyZXcvc3lzdGVtL2N2cy9zcmMvY3lydXMvaW1hcC92ZXJzaW9uLmgsdgpy
ZXRyaWV2aW5nIHJldmlzaW9uIDEuMTI4LjIuMTcKZGlmZiAtdSAtcjEuMTI4LjIuMTcgdmVyc2lv
bi5oCi0tLSBpbWFwL3ZlcnNpb24uaAkxMCBKdWwgMjAwNiAxMzo0NjoyMCAtMDAwMAkxLjEyOC4y
LjE3CisrKyBpbWFwL3ZlcnNpb24uaAkyNSBPY3QgMjAwNiAxODoxNjoyOSAtMDAwMApAQCAtNjUs
OSArNjUsOSBAQAogI2RlZmluZSBDQVBBX1BPU1RBVVRIX1NUUklORyAiIEFDTCBSSUdIVFM9a3h0
ZSBRVU9UQSAiIFwKIAkiTUFJTEJPWC1SRUZFUlJBTFMgTkFNRVNQQUNFIFVJRFBMVVMgIiBcCiAJ
Ik5PX0FUT01JQ19SRU5BTUUgVU5TRUxFQ1QgIiBcCi0JIkNISUxEUkVOIE1VTFRJQVBQRU5EIEJJ
TkFSWSAiIFwKKwkiQ0hJTERSRU4gTVVMVElBUFBFTkQgQklOQVJZIENBVEVOQVRFIENPTkRTVE9S
RSAiIFwKIAkiU09SVCBTT1JUPU1PRFNFUSBUSFJFQUQ9T1JERVJFRFNVQkpFQ1QgVEhSRUFEPVJF
RkVSRU5DRVMgIiBcCi0JIkFOTk9UQVRFTU9SRSBDQVRFTkFURSBDT05EU1RPUkUiCisJIkFOTk9U
QVRFTU9SRSBMSVNULUVYVEVOREVEIgogCiAKIC8qIFZhbHVlcyBmb3IgSUQgcHJvY2Vzc2luZyAq
Lwo=
</data>        

          </attachment>
      

    </bug>

</bugzilla>