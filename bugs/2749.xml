<?xml version="1.0" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugzilla.cyrusimap.org/bugzilla.dtd">

<bugzilla version="3.2.5.1-2"
          urlbase="https://bugzilla.cyrusimap.org/"
          maintainer="Dave McMurtrie &lt;dave64@andrew.cmu.edu&gt;"
>

    <bug>
          <bug_id>2749</bug_id>
          
          <creation_ts>2005-11-03 10:41 EDT</creation_ts>
          <short_desc>Wrong result of LIST and LSUB commands in some cases</short_desc>
          <delta_ts>2006-02-21 05:49:43 EDT</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Cyrus IMAP</product>
          <component>IMAP</component>
          <version>2.2.x</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>NEW</bug_status>
          
          
          
          
          
          <priority>P2</priority>
          <bug_severity>bug</bug_severity>
          <target_milestone>Future</target_milestone>
          
          <blocked>2750</blocked>
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Alexander Drozdov">dzal_mail@mtu-net.ru</reporter>
          <assigned_to name="Ken Murchison">murch@andrew.cmu.edu</assigned_to>
          <cc>kvk@elbrus.ru</cc>
    
    <cc>sorcerer@elbrus.ru</cc>
          <qa_contact name="The Cyrus Bugzilla List">cyrus-bugzilla@lists.andrew.cmu.edu</qa_contact>

      

      

      
          <long_desc isprivate="0">
            <who name="Alexander Drozdov">dzal_mail@mtu-net.ru</who>
            <bug_when>2005-11-03 10:41:11 EDT</bug_when>
            <thetext>Wrong result of LIST and LSUB commands in some cases where
altnamespace config variable is enabled.

imapd.conf:
configdirectory: &lt;somedir&gt;
partition-default: &lt;somedir&gt;
loginrealms: domain.ru
altnamespace: 1

You may also enable unixhierarchysep variable in imapd.conf.

commands:
. login sorcerer q
. OK User logged in
. list &quot;&quot; *
* LIST (\Noinferiors) &quot;.&quot; &quot;INBOX&quot;
* LIST (\HasNoChildren) &quot;.&quot; &quot;public&quot;
* LIST (\HasNoChildren) &quot;.&quot; &quot;test.test&quot;
* LIST (\HasChildren) &quot;.&quot; &quot;Other Users.u1&quot;
* LIST (\HasNoChildren) &quot;.&quot; &quot;Other Users.u1.u1public&quot;
* LIST (\HasNoChildren) &quot;.&quot; &quot;Other Users.u2.sp&quot;
* LIST (\HasChildren) &quot;.&quot; &quot;Other Users.u3&quot;
* LIST (\HasChildren) &quot;.&quot; &quot;Other Users.u3.supertestdir&quot;
* LIST (\HasNoChildren) &quot;.&quot; &quot;Other Users.u3.supertestdir.subdir&quot;
* LIST (\HasChildren) &quot;.&quot; &quot;Shared Folders.sf1&quot;
* LIST (\HasNoChildren) &quot;.&quot; &quot;Shared Folders.sf1.subfolder&quot;
* LIST (\HasChildren) &quot;.&quot; &quot;Shared Folders.sf2&quot;
* LIST (\HasNoChildren) &quot;.&quot; &quot;Shared Folders.sf2.subfolder&quot;
. OK Completed (0.010 secs 14 calls)
. list &quot;&quot; O*u*
* LIST (\HasChildren) &quot;.&quot; &quot;Other Users.u1&quot;
* LIST (\HasNoChildren) &quot;.&quot; &quot;Other Users.u1.u1public&quot;
* LIST (\HasNoChildren) &quot;.&quot; &quot;Other Users.u2.sp&quot;
* LIST (\HasChildren) &quot;.&quot; &quot;Other Users.u3&quot;
* LIST (\HasChildren) &quot;.&quot; &quot;Other Users.u3.supertestdir&quot;
* LIST (\HasNoChildren) &quot;.&quot; &quot;Other Users.u3.supertestdir.subdir&quot;
. OK Completed (0.010 secs 7 calls)

You may think that it is OK, but:
. list &quot;&quot; O*U*
. OK Completed (0.000 secs 1 calls)

Why? Because imap server tries to translates any pattern from user&apos;s
namespace to the internal one and than compares internal mailboxnames
with it. In my opinion such translation is impossible. In our case the
real pattern is not &quot;O*U*&quot;. It is &quot;*U*&quot;, and mailbox
&quot;user.u1.u1public&quot; and other are comparing with this pattern. I
believe that there is the only way to fix it: it is not to try to
change nor pattern or mailboxnames.

There is another reason why I need to modify the current behaviour. My
primary task is to add such new functionality to the imap server that
the server could hide real userids and show other ones which it may
get from, for example, LDAP. I have to made trivial modifications in
the file imapd/mboxname.c to add this ability to the server. But
nothing works because LIST and LSUB handlers don&apos;t call functions from
imapd/mboxname.c when it is needed and compare with internal names
instead of user&apos;s namespace mailboxnames.</thetext>
          </long_desc>
          <long_desc isprivate="0">
            <who name="Alexander Drozdov">dzal_mail@mtu-net.ru</who>
            <bug_when>2005-11-03 10:52:24 EDT</bug_when>
            <thetext>Created an attachment (id=391)
Set of patches

The attached patch includes patches from my bugs 2746, 2747, 2478.
Unfortunatelly, my patch also depends on Simon Matter&apos;s patchset:
http://www.invoca.ch/pub/packages/cyrus-imapd/

Note that there are bugs in the server with my patch in some cases. I haven&apos;t
corrected it yet.</thetext>
          </long_desc>
          <long_desc isprivate="0">
            <who name="Alexander Drozdov">dzal_mail@mtu-net.ru</who>
            <bug_when>2005-11-15 04:10:33 EDT</bug_when>
            <thetext>Created an attachment (id=398)
Update

This is the new version of my patch. I don&apos;t see any bugs now.</thetext>
          </long_desc>
          <long_desc isprivate="0">
            <who name="Alexander Drozdov">dzal_mail@mtu-net.ru</who>
            <bug_when>2005-12-30 07:27:30 EDT</bug_when>
            <thetext>Created an attachment (id=408)
Update

Bugs in utilities and minor bugs was fixed.</thetext>
          </long_desc>
          <long_desc isprivate="0">
            <who name="Alexander Drozdov">dzal_mail@mtu-net.ru</who>
            <bug_when>2006-02-21 05:49:43 EDT</bug_when>
            <thetext>Created an attachment (id=423)
Update

Return \NonExistent in LIST/LSUB responses as in the nonmodified version (fixes
in imapd.c:mstringdata()).</thetext>
          </long_desc>
      
          <attachment
              isobsolete="1"
              ispatch="1"
              isprivate="0"
          >
            <attachid>391</attachid>
            <date>2005-11-03 10:52 EDT</date>
            <desc>Set of patches</desc>
            <filename>mypatches.diff</filename>
            <type>text/plain</type>
            <size>51817</size>
            <attacher>dzal_mail@mtu-net.ru</attacher>
            
              <data encoding="base64">ZGlmZiAtQyAzIC1yIGN5cnVzLWltYXBkLTIuMi4xMi5zdXBlcm9sZC9pbWFwL2Fubm90YXRlLmMg
Y3lydXMtaW1hcGQtMi4yLjEyLm9sZC9pbWFwL2Fubm90YXRlLmMKKioqIGN5cnVzLWltYXBkLTIu
Mi4xMi5zdXBlcm9sZC9pbWFwL2Fubm90YXRlLmMJMjAwNS0wMi0xNCAwOTozOTo1NCArMDMwMAot
LS0gY3lydXMtaW1hcGQtMi4yLjEyLm9sZC9pbWFwL2Fubm90YXRlLmMJMjAwNS0xMC0zMSAxNToz
ODozNyArMDMwMAoqKioqKioqKioqKioqKioKKioqIDM3MywzODEgKioqKgogICAgICBpbnQga2V5
bGVuLCByOwogICAgICBzdHJ1Y3QgZmluZF9yb2NrIGZyb2NrOwogIAohICAgICBmcm9jay5tZ2xv
YiA9IGdsb2JfaW5pdChtYWlsYm94LCBHTE9CX0hJRVJBUkNIWSk7CiEgICAgIGZyb2NrLmVnbG9i
ID0gZ2xvYl9pbml0KGVudHJ5LCBHTE9CX0hJRVJBUkNIWSk7CiEgICAgIEdMT0JfU0VUX1NFUEFS
QVRPUihmcm9jay5lZ2xvYiwgJy8nKTsKICAgICAgZnJvY2sucHJvYyA9IHByb2M7CiAgICAgIGZy
b2NrLnJvY2sgPSByb2NrOwogIAotLS0gMzczLDM4MSAtLS0tCiAgICAgIGludCBrZXlsZW4sIHI7
CiAgICAgIHN0cnVjdCBmaW5kX3JvY2sgZnJvY2s7CiAgCiEgICAgIC8qIGNhbid0IHVuZGVyc3Rh
bmQgaXQgeWV0IC0tIHNvcmNlcmVyICovCiEgICAgIGZyb2NrLm1nbG9iID0gZ2xvYl9pbml0KG1h
aWxib3gsICcuJywgR0xPQl9ISUVSQVJDSFkpOwohICAgICBmcm9jay5lZ2xvYiA9IGdsb2JfaW5p
dChlbnRyeSwgJy8nLCBHTE9CX0hJRVJBUkNIWSk7CiAgICAgIGZyb2NrLnByb2MgPSBwcm9jOwog
ICAgICBmcm9jay5yb2NrID0gcm9jazsKICAKKioqKioqKioqKioqKioqCioqKiAxMDIyLDEwMjgg
KioqKgogICAgICB3aGlsZSAoYSkgewogIAlpbnQgYXR0cmliY291bnQ7CiAgCiEgCWcgPSBnbG9i
X2luaXQoYS0+cywgR0xPQl9ISUVSQVJDSFkpOwogIAkKICAJZm9yIChhdHRyaWJjb3VudCA9IDA7
CiAgCSAgICAgYW5ub3RhdGlvbl9hdHRyaWJ1dGVzW2F0dHJpYmNvdW50XS5uYW1lOwotLS0gMTAy
MiwxMDI4IC0tLS0KICAgICAgd2hpbGUgKGEpIHsKICAJaW50IGF0dHJpYmNvdW50OwogIAohIAln
ID0gZ2xvYl9pbml0KGEtPnMsICcuJywgR0xPQl9ISUVSQVJDSFkpOwogIAkKICAJZm9yIChhdHRy
aWJjb3VudCA9IDA7CiAgCSAgICAgYW5ub3RhdGlvbl9hdHRyaWJ1dGVzW2F0dHJpYmNvdW50XS5u
YW1lOwoqKioqKioqKioqKioqKioKKioqIDEwNTUsMTA2MiAqKioqCiAgCWludCBlbnRyeWNvdW50
OwogIAlpbnQgY2hlY2tfZGIgPSAwOyAvKiBzaG91bGQgd2UgY2hlY2sgdGhlIGRiIGZvciB0aGlz
IGVudHJ5PyAqLwogIAohIAlnID0gZ2xvYl9pbml0KGUtPnMsIEdMT0JfSElFUkFSQ0hZKTsKISAJ
R0xPQl9TRVRfU0VQQVJBVE9SKGcsICcvJyk7CiAgCiAgCWZvciAoZW50cnljb3VudCA9IDA7CiAg
CSAgICAgbm9uX2RiX2VudHJpZXNbZW50cnljb3VudF0ubmFtZTsKLS0tIDEwNTUsMTA2MSAtLS0t
CiAgCWludCBlbnRyeWNvdW50OwogIAlpbnQgY2hlY2tfZGIgPSAwOyAvKiBzaG91bGQgd2UgY2hl
Y2sgdGhlIGRiIGZvciB0aGlzIGVudHJ5PyAqLwogIAohIAlnID0gZ2xvYl9pbml0KGUtPnMsICcv
JywgR0xPQl9ISUVSQVJDSFkpOwogIAogIAlmb3IgKGVudHJ5Y291bnQgPSAwOwogIAkgICAgIG5v
bl9kYl9lbnRyaWVzW2VudHJ5Y291bnRdLm5hbWU7CmRpZmYgLUMgMyAtciBjeXJ1cy1pbWFwZC0y
LjIuMTIuc3VwZXJvbGQvaW1hcC9pbWFwZC5jIGN5cnVzLWltYXBkLTIuMi4xMi5vbGQvaW1hcC9p
bWFwZC5jCioqKiBjeXJ1cy1pbWFwZC0yLjIuMTIuc3VwZXJvbGQvaW1hcC9pbWFwZC5jCTIwMDUt
MTAtMzEgMTU6NDE6MDYgKzAzMDAKLS0tIGN5cnVzLWltYXBkLTIuMi4xMi5vbGQvaW1hcC9pbWFw
ZC5jCTIwMDUtMTAtMzEgMTU6Mzg6NTcgKzAzMDAKKioqKioqKioqKioqKioqCioqKiAxNjkzLDE2
OTggKioqKgotLS0gMTY5MywxNzA5IC0tLS0KICAgICAgfQogIH0KICAKKyBzdGF0aWMgdm9pZCB1
c2VyaWRfdG9pbnRlcm5hbChzdHJ1Y3QgbmFtZXNwYWNlICpuYW1lc3BhY2UsIGNoYXIgKnVzZXJp
ZCkKKyB7CisgICAgIGNoYXIgaGllcnNlcF9vcmlnID0gbmFtZXNwYWNlLT5oaWVyX3NlcDsKKyAK
KyAgICAgbmFtZXNwYWNlLT5oaWVyX3NlcD0nLyc7CisgICAgIG1ib3huYW1lX2hpZXJzZXBfdG9p
bnRlcm5hbChuYW1lc3BhY2UsIHVzZXJpZCwKKyAJCQkJY29uZmlnX3ZpcnRkb21haW5zID8KKyAJ
CQkJc3RyY3Nwbih1c2VyaWQsICJAIikgOiAwKTsKKyAgICAgbmFtZXNwYWNlLT5oaWVyX3NlcD1o
aWVyc2VwX29yaWc7CisgfQorIAogIC8qCiAgICogQXV0b2NyZWF0ZSBJbmJveCBhbmQgc3ViZm9s
ZGVycyB1cG9uIGxvZ2luCiAgICovCioqKioqKioqKioqKioqKgoqKiogMTg4MCwxODg4ICoqKioK
ICAgICAgfQogIAogICAgICAvKiBUcmFuc2xhdGUgYW55IHNlcGFyYXRvcnMgaW4gdXNlcmlkICov
CiEgICAgIG1ib3huYW1lX2hpZXJzZXBfdG9pbnRlcm5hbCgmaW1hcGRfbmFtZXNwYWNlLCBpbWFw
ZF91c2VyaWQsCiEgCQkJCWNvbmZpZ192aXJ0ZG9tYWlucyA/CiEgCQkJCXN0cmNzcG4oaW1hcGRf
dXNlcmlkLCAiQCIpIDogMCk7CiAgCiAgICAgIGZyZWVidWYoJnBhc3N3ZGJ1Zik7CiAgCi0tLSAx
ODkxLDE4OTcgLS0tLQogICAgICB9CiAgCiAgICAgIC8qIFRyYW5zbGF0ZSBhbnkgc2VwYXJhdG9y
cyBpbiB1c2VyaWQgKi8KISAgICAgdXNlcmlkX3RvaW50ZXJuYWwoJmltYXBkX25hbWVzcGFjZSwg
aW1hcGRfdXNlcmlkKTsKICAKICAgICAgZnJlZWJ1ZigmcGFzc3dkYnVmKTsKICAKKioqKioqKioq
KioqKioqCioqKiAyMDI5LDIwMzcgKioqKgogICAgICB9CiAgCiAgICAgIC8qIFRyYW5zbGF0ZSBh
bnkgc2VwYXJhdG9ycyBpbiB1c2VyaWQgKi8KISAgICAgbWJveG5hbWVfaGllcnNlcF90b2ludGVy
bmFsKCZpbWFwZF9uYW1lc3BhY2UsIGltYXBkX3VzZXJpZCwKISAJCQkJY29uZmlnX3ZpcnRkb21h
aW5zID8KISAJCQkJc3RyY3NwbihpbWFwZF91c2VyaWQsICJAIikgOiAwKTsKICAKICAgICAgYXV0
b2NyZWF0ZV9pbmJveCgpOwogIAotLS0gMjAzOCwyMDQ0IC0tLS0KICAgICAgfQogIAogICAgICAv
KiBUcmFuc2xhdGUgYW55IHNlcGFyYXRvcnMgaW4gdXNlcmlkICovCiEgICAgIHVzZXJpZF90b2lu
dGVybmFsKCZpbWFwZF9uYW1lc3BhY2UsIGltYXBkX3VzZXJpZCk7CiAgCiAgICAgIGF1dG9jcmVh
dGVfaW5ib3goKTsKICAKKioqKioqKioqKioqKioqCioqKiAzNzY0LDM3NzkgKioqKgogIH0JCiAg
CiAgLyogQ2FsbGJhY2sgZm9yIHVzZSBieSBjbWRfZGVsZXRlICovCiAgc3RhdGljIGludCBkZWxt
Ym94KGNoYXIgKm5hbWUsCiAgCQkgICBpbnQgbWF0Y2hsZW4gX19hdHRyaWJ1dGVfXygodW51c2Vk
KSksCiAgCQkgICBpbnQgbWF5Y3JlYXRlIF9fYXR0cmlidXRlX18oKHVudXNlZCkpLAogIAkJICAg
dm9pZCAqcm9jayBfX2F0dHJpYnV0ZV9fKCh1bnVzZWQpKSkKICB7CiAgICAgIGludCByOwogIAoh
ICAgICByID0gbWJveGxpc3RfZGVsZXRlbWFpbGJveChuYW1lLCBpbWFwZF91c2VyaXNhZG1pbiwK
ISAJCQkgICAgICAgaW1hcGRfdXNlcmlkLCBpbWFwZF9hdXRoc3RhdGUsCiEgCQkJICAgICAgIDAs
IDAsIDAsIDEpOwogICAgICAKICAgICAgaWYocikgewogIAlwcm90X3ByaW50ZihpbWFwZF9vdXQs
ICIqIE5PIGRlbGV0ZSAlczogJXNcclxuIiwKLS0tIDM3NzEsMzc5MiAtLS0tCiAgfQkKICAKICAv
KiBDYWxsYmFjayBmb3IgdXNlIGJ5IGNtZF9kZWxldGUgKi8KKyAvKiBuYW1lIGlzIGFuIGV4dGVy
bmFsIG5hbWUgKi8KICBzdGF0aWMgaW50IGRlbG1ib3goY2hhciAqbmFtZSwKICAJCSAgIGludCBt
YXRjaGxlbiBfX2F0dHJpYnV0ZV9fKCh1bnVzZWQpKSwKICAJCSAgIGludCBtYXljcmVhdGUgX19h
dHRyaWJ1dGVfXygodW51c2VkKSksCiAgCQkgICB2b2lkICpyb2NrIF9fYXR0cmlidXRlX18oKHVu
dXNlZCkpKQogIHsKICAgICAgaW50IHI7CisgICAgIGNoYXIgaW50bmFtZVtNQVhfTUFJTEJPWF9O
QU1FKzFdOwogIAohICAgICByID0gKCppbWFwZF9uYW1lc3BhY2UubWJveG5hbWVfdG9pbnRlcm5h
bCkoJmltYXBkX25hbWVzcGFjZSwgbmFtZSwKISAJCQkJCSAgICAgICBpbWFwZF91c2VyaWQsIGlu
dG5hbWUpOwohIAohICAgICBpZighcikKISAJciA9IG1ib3hsaXN0X2RlbGV0ZW1haWxib3goaW50
bmFtZSwgaW1hcGRfdXNlcmlzYWRtaW4sCiEgCQkJCSAgIGltYXBkX3VzZXJpZCwgaW1hcGRfYXV0
aHN0YXRlLAohIAkJCQkgICAwLCAwLCAwLCAxKTsKICAgICAgCiAgICAgIGlmKHIpIHsKICAJcHJv
dF9wcmludGYoaW1hcGRfb3V0LCAiKiBOTyBkZWxldGUgJXM6ICVzXHJcbiIsCioqKioqKioqKioq
KioqKgoqKiogMzgxNiwzODMxICoqKioKICAgICAgaWYgKCFyICYmICFsb2NhbG9ubHkgJiYKICAJ
IXN0cm5jbXAobWFpbGJveG5hbWUrZG9tYWlubGVuLCAidXNlci4iLCA1KSAmJgogIAkhc3RyY2hy
KG1haWxib3huYW1lK2RvbWFpbmxlbis1LCAnLicpKSB7CiAgIAlpbnQgbWFpbGJveG5hbWVfbGVu
ID0gc3RybGVuKG1haWxib3huYW1lKTsKICAKICAgCS8qIElmIHdlIGFyZW4ndCB0b28gY2xvc2Ug
dG8gTUFYX01BSUxCT1hfTkFNRSwgYXBwZW5kIC4qICovCiEgIAlwID0gbWFpbGJveG5hbWUgKyBt
YWlsYm94bmFtZV9sZW47IC8qIGVuZCBvZiBtYWlsYm94bmFtZSAqLwohICAJaWYgKG1haWxib3hu
YW1lX2xlbiA8IHNpemVvZihtYWlsYm94bmFtZSkgLSAzKSB7CiEgIAkgICAgc3RyY3B5KHAsICIu
KiIpOwohICAJfQogIAkKICAJLyogYnVpbGQgYSBsaXN0IG9mIG1haWxib3hlcyAtIHdlJ3JlIHVz
aW5nIGludGVybmFsIG5hbWVzIGhlcmUgKi8KISAJbWJveGxpc3RfZmluZGFsbChOVUxMLCBtYWls
Ym94bmFtZSwgaW1hcGRfdXNlcmlzYWRtaW4sIGltYXBkX3VzZXJpZCwKICAJCQkgaW1hcGRfYXV0
aHN0YXRlLCBkZWxtYm94LCBOVUxMKTsKICAKICAJLyogdGFrZSBjYXJlIG9mIGRlbGV0aW5nIEFD
THMsIHN1YnNjcmlwdGlvbnMsIHNlZW4gc3RhdGUgYW5kIHF1b3RhcyAqLwotLS0gMzgyOSwzODUx
IC0tLS0KICAgICAgaWYgKCFyICYmICFsb2NhbG9ubHkgJiYKICAJIXN0cm5jbXAobWFpbGJveG5h
bWUrZG9tYWlubGVuLCAidXNlci4iLCA1KSAmJgogIAkhc3RyY2hyKG1haWxib3huYW1lK2RvbWFp
bmxlbis1LCAnLicpKSB7CisgCWNoYXIgbmFtZV9jb3B5W01BWF9NQUlMQk9YX05BTUUrMV07Cisg
IAlpbnQgbmFtZV9sZW4gPSBzdHJsZW4obmFtZSk7CiAgIAlpbnQgbWFpbGJveG5hbWVfbGVuID0g
c3RybGVuKG1haWxib3huYW1lKTsKICAKKyAJbWVtY3B5KG5hbWVfY29weSwgbmFtZSwgbmFtZV9s
ZW4pOwogICAJLyogSWYgd2UgYXJlbid0IHRvbyBjbG9zZSB0byBNQVhfTUFJTEJPWF9OQU1FLCBh
cHBlbmQgLiogKi8KISAgCXAgPSBuYW1lX2NvcHkgKyBuYW1lX2xlbjsgLyogZW5kIG9mIG5hbWUg
Ki8KISAgCWlmIChuYW1lX2xlbiA8IHNpemVvZihuYW1lX2NvcHkpIC0gMykgewohIAkgICAgKnA9
aW1hcGRfbmFtZXNwYWNlLmhpZXJfc2VwOwohIAkgICAgcFsxXT0nKic7CiEgCSAgICBwWzJdPTA7
CiEgCX0KISAJZWxzZQohIAkgICAgKnA9MDsKICAJCiAgCS8qIGJ1aWxkIGEgbGlzdCBvZiBtYWls
Ym94ZXMgLSB3ZSdyZSB1c2luZyBpbnRlcm5hbCBuYW1lcyBoZXJlICovCiEgCW1ib3hsaXN0X2Zp
bmRhbGwoJmltYXBkX25hbWVzcGFjZSwgbmFtZV9jb3B5LCBpbWFwZF91c2VyaXNhZG1pbiwgaW1h
cGRfdXNlcmlkLAogIAkJCSBpbWFwZF9hdXRoc3RhdGUsIGRlbG1ib3gsIE5VTEwpOwogIAogIAkv
KiB0YWtlIGNhcmUgb2YgZGVsZXRpbmcgQUNMcywgc3Vic2NyaXB0aW9ucywgc2VlbiBzdGF0ZSBh
bmQgcXVvdGFzICovCioqKioqKioqKioqKioqKgoqKiogMzg2NywzODc5ICoqKioKICB9OwogIAog
IC8qIENhbGxiYWNrIGZvciB1c2UgYnkgY21kX3JlbmFtZSAqLwogIHN0YXRpYyBpbnQgcmVubWJv
eChjaGFyICpuYW1lLAogIAkJICAgaW50IG1hdGNobGVuIF9fYXR0cmlidXRlX18oKHVudXNlZCkp
LAogIAkJICAgaW50IG1heWNyZWF0ZSBfX2F0dHJpYnV0ZV9fKCh1bnVzZWQpKSwKICAJCSAgIHZv
aWQgKnJvY2spCiAgewohICAgICBjaGFyIG9sZGV4dG5hbWVbTUFYX01BSUxCT1hfTkFNRSsxXTsK
ISAgICAgY2hhciBuZXdleHRuYW1lW01BWF9NQUlMQk9YX05BTUUrMV07CiAgICAgIHN0cnVjdCBy
ZW5yb2NrICp0ZXh0ID0gKHN0cnVjdCByZW5yb2NrICopcm9jazsKICAgICAgaW50IHI7CiAgCi0t
LSAzODg3LDM5MDAgLS0tLQogIH07CiAgCiAgLyogQ2FsbGJhY2sgZm9yIHVzZSBieSBjbWRfcmVu
YW1lICovCisgLyogJ25hbWUnIGlzIGFuIGV4dGVybmFsIG1haWxib3ggbmFtZSEgKi8KICBzdGF0
aWMgaW50IHJlbm1ib3goY2hhciAqbmFtZSwKICAJCSAgIGludCBtYXRjaGxlbiBfX2F0dHJpYnV0
ZV9fKCh1bnVzZWQpKSwKICAJCSAgIGludCBtYXljcmVhdGUgX19hdHRyaWJ1dGVfXygodW51c2Vk
KSksCiAgCQkgICB2b2lkICpyb2NrKQogIHsKISAgICAgY2hhciBvbGRpbnRuYW1lW01BWF9NQUlM
Qk9YX05BTUUrMV07CiEgICAgIGNoYXIgbmV3aW50bmFtZVtNQVhfTUFJTEJPWF9OQU1FKzFdOwog
ICAgICBzdHJ1Y3QgcmVucm9jayAqdGV4dCA9IChzdHJ1Y3QgcmVucm9jayAqKXJvY2s7CiAgICAg
IGludCByOwogIAoqKioqKioqKioqKioqKioKKioqIDM4ODIsMzkxNyAqKioqCiAgCiAgICAgIHN0
cmNweSh0ZXh0LT5uZXdtYWlsYm94bmFtZSArIHRleHQtPm5sLCBuYW1lICsgdGV4dC0+b2wpOwog
IAohICAgICByID0gbWJveGxpc3RfcmVuYW1lbWFpbGJveChuYW1lLCB0ZXh0LT5uZXdtYWlsYm94
bmFtZSwKICAJCQkgICAgICAgdGV4dC0+cGFydGl0aW9uLAogIAkJCSAgICAgICAxLCBpbWFwZF91
c2VyaWQsIGltYXBkX2F1dGhzdGF0ZSk7CiAgICAgIAotICAgICAoKmltYXBkX25hbWVzcGFjZS5t
Ym94bmFtZV90b2V4dGVybmFsKSgmaW1hcGRfbmFtZXNwYWNlLAotIAkJCQkJICAgbmFtZSwKLSAJ
CQkJCSAgIGltYXBkX3VzZXJpZCwgb2xkZXh0bmFtZSk7Ci0gICAgICgqaW1hcGRfbmFtZXNwYWNl
Lm1ib3huYW1lX3RvZXh0ZXJuYWwpKCZpbWFwZF9uYW1lc3BhY2UsCi0gCQkJCQkgICB0ZXh0LT5u
ZXdtYWlsYm94bmFtZSwKLSAJCQkJCSAgIGltYXBkX3VzZXJpZCwgbmV3ZXh0bmFtZSk7Ci0gCiAg
ICAgIGlmKHIpIHsKICAJcHJvdF9wcmludGYoaW1hcGRfb3V0LCAiKiBOTyByZW5hbWUgJXMgJXM6
ICVzXHJcbiIsCiEgCQkgICAgb2xkZXh0bmFtZSwgbmV3ZXh0bmFtZSwgZXJyb3JfbWVzc2FnZShy
KSk7CiAgCWlmIChSRU5BTUVfU1RPUF9PTl9FUlJPUikgcmV0dXJuIHI7CiAgICAgIH0gZWxzZSB7
CiAgCS8qIElmIHdlJ3JlIHJlbmFtaW5nIGEgdXNlciwgY2hhbmdlIHF1b3Rhcm9vdCBhbmQgQUNM
ICovCiAgCWlmICh0ZXh0LT5yZW5hbWVfdXNlcikgewohIAkgICAgdXNlcl9jb3B5cXVvdGFyb290
KG5hbWUsIHRleHQtPm5ld21haWxib3huYW1lKTsKISAJICAgIHVzZXJfcmVuYW1lYWNsKHRleHQt
Pm5ld21haWxib3huYW1lLAogIAkJCSAgIHRleHQtPmFjbF9vbGR1c2VyLCB0ZXh0LT5hY2xfbmV3
dXNlcik7CiAgCX0KICAKICAJLyogUmVuYW1lIG1haWxib3ggYW5ub3RhdGlvbnMgKi8KISAJYW5u
b3RhdGVtb3JlX3JlbmFtZShuYW1lLCB0ZXh0LT5uZXdtYWlsYm94bmFtZSwKICAJCQkgICAgdGV4
dC0+cmVuYW1lX3VzZXIgPyB0ZXh0LT5vbGR1c2VyIDogTlVMTCwKICAJCQkgICAgdGV4dC0+bmV3
dXNlcik7CiAgCQogIAlwcm90X3ByaW50ZihpbWFwZF9vdXQsICIqIE9LIHJlbmFtZSAlcyAlc1xy
XG4iLAohIAkJICAgIG9sZGV4dG5hbWUsIG5ld2V4dG5hbWUpOwogICAgICB9CiAgCiAgICAgIHBy
b3RfZmx1c2goaW1hcGRfb3V0KTsKLS0tIDM5MDMsMzk0MSAtLS0tCiAgCiAgICAgIHN0cmNweSh0
ZXh0LT5uZXdtYWlsYm94bmFtZSArIHRleHQtPm5sLCBuYW1lICsgdGV4dC0+b2wpOwogIAohICAg
ICBpZigoKmltYXBkX25hbWVzcGFjZS5tYm94bmFtZV90b2ludGVybmFsKSgmaW1hcGRfbmFtZXNw
YWNlLAohIAkJCQkJICAgICAgdGV4dC0+bmV3bWFpbGJveG5hbWUsCiEgCQkJCQkgICAgICBpbWFw
ZF91c2VyaWQsIG5ld2ludG5hbWUpKQohIAlyZXR1cm4gMDsKISAKISAgICAgaWYoKCppbWFwZF9u
YW1lc3BhY2UubWJveG5hbWVfdG9pbnRlcm5hbCkoJmltYXBkX25hbWVzcGFjZSwKISAJCQkJCSAg
ICAgIG5hbWUsCiEgCQkJCQkgICAgICBpbWFwZF91c2VyaWQsIG9sZGludG5hbWUpKQohIAlyZXR1
cm4gMDsKISAKISAgICAgciA9IG1ib3hsaXN0X3JlbmFtZW1haWxib3gob2xkaW50bmFtZSwgbmV3
aW50bmFtZSwKICAJCQkgICAgICAgdGV4dC0+cGFydGl0aW9uLAogIAkJCSAgICAgICAxLCBpbWFw
ZF91c2VyaWQsIGltYXBkX2F1dGhzdGF0ZSk7CiAgICAgIAogICAgICBpZihyKSB7CiAgCXByb3Rf
cHJpbnRmKGltYXBkX291dCwgIiogTk8gcmVuYW1lICVzICVzOiAlc1xyXG4iLAohIAkJICAgIG5h
bWUsIHRleHQtPm5ld21haWxib3huYW1lLCBlcnJvcl9tZXNzYWdlKHIpKTsKICAJaWYgKFJFTkFN
RV9TVE9QX09OX0VSUk9SKSByZXR1cm4gcjsKICAgICAgfSBlbHNlIHsKICAJLyogSWYgd2UncmUg
cmVuYW1pbmcgYSB1c2VyLCBjaGFuZ2UgcXVvdGFyb290IGFuZCBBQ0wgKi8KICAJaWYgKHRleHQt
PnJlbmFtZV91c2VyKSB7CiEgCSAgICB1c2VyX2NvcHlxdW90YXJvb3Qob2xkaW50bmFtZSwgbmV3
aW50bmFtZSk7CiEgCSAgICB1c2VyX3JlbmFtZWFjbChuZXdpbnRuYW1lLAogIAkJCSAgIHRleHQt
PmFjbF9vbGR1c2VyLCB0ZXh0LT5hY2xfbmV3dXNlcik7CiAgCX0KICAKICAJLyogUmVuYW1lIG1h
aWxib3ggYW5ub3RhdGlvbnMgKi8KISAJYW5ub3RhdGVtb3JlX3JlbmFtZShvbGRpbnRuYW1lLCBu
ZXdpbnRuYW1lLAogIAkJCSAgICB0ZXh0LT5yZW5hbWVfdXNlciA/IHRleHQtPm9sZHVzZXIgOiBO
VUxMLAogIAkJCSAgICB0ZXh0LT5uZXd1c2VyKTsKICAJCiAgCXByb3RfcHJpbnRmKGltYXBkX291
dCwgIiogT0sgcmVuYW1lICVzICVzXHJcbiIsCiEgCQkgICAgbmFtZSwgdGV4dC0+bmV3bWFpbGJv
eG5hbWUpOwogICAgICB9CiAgCiAgICAgIHByb3RfZmx1c2goaW1hcGRfb3V0KTsKKioqKioqKioq
KioqKioqCioqKiAzOTI2LDM5MzUgKioqKgogIAkJY2hhciAqb2xkbmFtZSwgY2hhciAqbmV3bmFt
ZSwgY2hhciAqcGFydGl0aW9uKQogIHsKICAgICAgaW50IHIgPSAwOwohICAgICBjaGFyIG9sZG1h
aWxib3huYW1lW01BWF9NQUlMQk9YX05BTUUrM107CiEgICAgIGNoYXIgbmV3bWFpbGJveG5hbWVb
TUFYX01BSUxCT1hfTkFNRSsyXTsKISAgICAgY2hhciBvbGRleHRuYW1lW01BWF9NQUlMQk9YX05B
TUUrMV07CiEgICAgIGNoYXIgbmV3ZXh0bmFtZVtNQVhfTUFJTEJPWF9OQU1FKzFdOwogICAgICBp
bnQgb21sZW4sIG5tbGVuOwogICAgICBjaGFyICpwOwogICAgICBpbnQgcmVjdXJzaXZlX3JlbmFt
ZSA9IDE7Ci0tLSAzOTUwLDM5NTcgLS0tLQogIAkJY2hhciAqb2xkbmFtZSwgY2hhciAqbmV3bmFt
ZSwgY2hhciAqcGFydGl0aW9uKQogIHsKICAgICAgaW50IHIgPSAwOwohICAgICBjaGFyIG9sZG1h
aWxib3huYW1lW01BWF9NQUlMQk9YX05BTUUrMV07CiEgICAgIGNoYXIgbmV3bWFpbGJveG5hbWVb
TUFYX01BSUxCT1hfTkFNRSsxXTsKICAgICAgaW50IG9tbGVuLCBubWxlbjsKICAgICAgY2hhciAq
cDsKICAgICAgaW50IHJlY3Vyc2l2ZV9yZW5hbWUgPSAxOwoqKioqKioqKioqKioqKioKKioqIDQw
MzcsNDA2MiAqKioqCiAgCiAgICAgIC8qIHJlbmFtZSBhbGwgbWFpbGJveGVzIG1hdGNoaW5nIHRo
aXMgKi8KICAgICAgaWYgKCFyICYmIHJlY3Vyc2l2ZV9yZW5hbWUpIHsKICAJc3RydWN0IHJlbnJv
Y2sgcm9jazsKISAJaW50IG9sID0gb21sZW4gKyAxOwohIAlpbnQgbmwgPSBubWxlbiArIDE7CiEg
CiEgCSgqaW1hcGRfbmFtZXNwYWNlLm1ib3huYW1lX3RvZXh0ZXJuYWwpKCZpbWFwZF9uYW1lc3Bh
Y2UsCiEgCQkJCQkgICAgICAgb2xkbWFpbGJveG5hbWUsCiEgCQkJCQkgICAgICAgaW1hcGRfdXNl
cmlkLCBvbGRleHRuYW1lKTsKISAJKCppbWFwZF9uYW1lc3BhY2UubWJveG5hbWVfdG9leHRlcm5h
bCkoJmltYXBkX25hbWVzcGFjZSwKISAJCQkJCSAgICAgICBuZXdtYWlsYm94bmFtZSwKISAJCQkJ
CSAgICAgICBpbWFwZF91c2VyaWQsIG5ld2V4dG5hbWUpOwogIAogIAlwcm90X3ByaW50ZihpbWFw
ZF9vdXQsICIqIE9LIHJlbmFtZSAlcyAlc1xyXG4iLAohIAkJICAgIG9sZGV4dG5hbWUsIG5ld2V4
dG5hbWUpOwogIAlwcm90X2ZsdXNoKGltYXBkX291dCk7CiAgCiEgCXN0cmNhdChvbGRtYWlsYm94
bmFtZSwgIi4qIik7CiEgCXN0cmNhdChuZXdtYWlsYm94bmFtZSwgIi4iKTsKICAKICAJLyogc2V0
dXAgdGhlIHJvY2sgKi8KISAJcm9jay5uZXdtYWlsYm94bmFtZSA9IG5ld21haWxib3huYW1lOwog
IAlyb2NrLm9sID0gb2w7CiAgCXJvY2submwgPSBubDsKICAJcm9jay5vbGR1c2VyID0gb2xkdXNl
cjsKLS0tIDQwNTksNDA4MiAtLS0tCiAgCiAgICAgIC8qIHJlbmFtZSBhbGwgbWFpbGJveGVzIG1h
dGNoaW5nIHRoaXMgKi8KICAgICAgaWYgKCFyICYmIHJlY3Vyc2l2ZV9yZW5hbWUpIHsKKyAJY2hh
ciBvbGRleHRuYW1lW01BWF9NQUlMQk9YX05BTUUrM107CisgCWNoYXIgbmV3ZXh0bmFtZVtNQVhf
TUFJTEJPWF9OQU1FKzJdOworIAlpbnQgdG1wbGVuOwogIAlzdHJ1Y3QgcmVucm9jayByb2NrOwoh
IAlpbnQgb2w7CiEgCWludCBubDsKICAKKyAJb2wgPSBzdHJsZW4ob2xkbmFtZSkrMTsKKyAJbmwg
PSBzdHJsZW4obmV3bmFtZSkrMTsKICAJcHJvdF9wcmludGYoaW1hcGRfb3V0LCAiKiBPSyByZW5h
bWUgJXMgJXNcclxuIiwKISAJCSAgICBvbGRuYW1lLCBuZXduYW1lKTsKICAJcHJvdF9mbHVzaChp
bWFwZF9vdXQpOwogIAohIAlzbnByaW50ZihvbGRleHRuYW1lLCBNQVhfTUFJTEJPWF9OQU1FKzMs
ICIlcyVjKiIsIG9sZG5hbWUsIGltYXBkX25hbWVzcGFjZS5oaWVyX3NlcCk7CiEgCXNucHJpbnRm
KG5ld2V4dG5hbWUsIE1BWF9NQUlMQk9YX05BTUUrMiwgIiVzJWMiLCBuZXduYW1lLCBpbWFwZF9u
YW1lc3BhY2UuaGllcl9zZXApOwogIAogIAkvKiBzZXR1cCB0aGUgcm9jayAqLwohIAlyb2NrLm5l
d21haWxib3huYW1lID0gbmV3ZXh0bmFtZTsKICAJcm9jay5vbCA9IG9sOwogIAlyb2NrLm5sID0g
bmw7CiAgCXJvY2sub2xkdXNlciA9IG9sZHVzZXI7CioqKioqKioqKioqKioqKgoqKiogNDA2Niw0
MDc0ICoqKioKICAJcm9jay5wYXJ0aXRpb24gPSBwYXJ0aXRpb247CiAgCXJvY2sucmVuYW1lX3Vz
ZXIgPSByZW5hbWVfdXNlcjsKICAJCiEgCS8qIGFkZCBzdWJtYWlsYm94ZXM7IHdlIHByZXRlbmQg
d2UncmUgYW4gYWRtaW4gc2luY2Ugd2Ugc3VjY2Vzc2Z1bGx5CiEgCSAgIHJlbmFtZWQgdGhlIHBh
cmVudCAtIHdlJ3JlIHVzaW5nIGludGVybmFsIG5hbWVzIGhlcmUgKi8KISAJciA9IG1ib3hsaXN0
X2ZpbmRhbGwoTlVMTCwgb2xkbWFpbGJveG5hbWUsIDEsIGltYXBkX3VzZXJpZCwKICAJCQkgICAg
IGltYXBkX2F1dGhzdGF0ZSwgcmVubWJveCwgJnJvY2spOwogICAgICB9CiAgCi0tLSA0MDg2LDQw
OTMgLS0tLQogIAlyb2NrLnBhcnRpdGlvbiA9IHBhcnRpdGlvbjsKICAJcm9jay5yZW5hbWVfdXNl
ciA9IHJlbmFtZV91c2VyOwogIAkKISAJLyogYWRkIHN1Ym1haWxib3hlczsgdXNpbmcgZXh0ZXJu
YWwgbmFtZXNwYWNlIGhlcmUgKi8KISAJciA9IGltYXBkX25hbWVzcGFjZS5tYm94bGlzdF9maW5k
YWxsKCZpbWFwZF9uYW1lc3BhY2UsIG9sZGV4dG5hbWUsIDEsIGltYXBkX3VzZXJpZCwKICAJCQkg
ICAgIGltYXBkX2F1dGhzdGF0ZSwgcmVubWJveCwgJnJvY2spOwogICAgICB9CiAgCioqKioqKioq
KioqKioqKgoqKiogNDMzNCw0MzQ0ICoqKioKICAJICAgIHBhdHRlcm4gPSBidWY7CiAgCX0KICAK
LSAJLyogVHJhbnNsYXRlIGFueSBzZXBhcmF0b3JzIGluIHBhdHRlcm4gKi8KLSAJbWJveG5hbWVf
aGllcnNlcF90b2ludGVybmFsKCZpbWFwZF9uYW1lc3BhY2UsIHBhdHRlcm4sCi0gCQkJCSAgICBj
b25maWdfdmlydGRvbWFpbnMgPwotIAkJCQkgICAgc3RyY3NwbihwYXR0ZXJuLCAiQCIpIDogMCk7
Ci0gCiAgCS8qIENoZWNrIHRvIHNlZSBpZiB3ZSBzaG91bGQgb25seSBsaXN0IHRoZSBwZXJzb25h
bCBuYW1lc3BhY2UgKi8KICAJaWYgKCFzdHJjbXAocGF0dGVybiwgIioiKQogIAkgICAgJiYgY29u
ZmlnX2dldHN3aXRjaChJTUFQT1BUX0ZPT0xTVFVQSURDTElFTlRTKSkgewotLS0gNDM1Myw0MzU4
IC0tLS0KKioqKioqKioqKioqKioqCioqKiA1MTAwLDUxMTQgKioqKgogIAkJCSB2b2lkICpyb2Nr
KQogIHsKICAgICAgaW50KiBzYXdvbmUgPSAoaW50Kikgcm9jazsKICAKICAgICAgaWYgKCFuYW1l
KSB7CiAgCXJldHVybiAwOwogICAgICB9CiAgICAgIAohICAgICBpZiAoIShzdHJuY21wKG5hbWUs
ICJJTkJPWC4iLCA2KSkpIHsKICAJLyogVGhlIHVzZXIgaGFzIGEgInBlcnNvbmFsIiBuYW1lc3Bh
Y2UuICovCiAgCXNhd29uZVtOQU1FU1BBQ0VfSU5CT1hdID0gMTsKISAgICAgfSBlbHNlIGlmICht
Ym94bmFtZV9pc3VzZXJtYWlsYm94KG5hbWUsIDApKSB7CiAgCS8qIFRoZSB1c2VyIGNhbiBzZWUg
dGhlICJvdGhlciB1c2VycyIgbmFtZXNwYWNlLiAqLwogIAlzYXdvbmVbTkFNRVNQQUNFX1VTRVJd
ID0gMTsKICAgICAgfSBlbHNlIHsKLS0tIDUxMTQsNTEzMyAtLS0tCiAgCQkJIHZvaWQgKnJvY2sp
CiAgewogICAgICBpbnQqIHNhd29uZSA9IChpbnQqKSByb2NrOworICAgICBjaGFyIGludG5hbWVb
TUFYX01BSUxCT1hfTkFNRSsxXTsKICAKICAgICAgaWYgKCFuYW1lKSB7CiAgCXJldHVybiAwOwog
ICAgICB9CiAgICAgIAohICAgICBpZigoKmltYXBkX25hbWVzcGFjZS5tYm94bmFtZV90b2ludGVy
bmFsKSgmaW1hcGRfbmFtZXNwYWNlLCBuYW1lLAohIAkJCQkJICAgICAgaW1hcGRfdXNlcmlkLCBp
bnRuYW1lKSkKISAJcmV0dXJuIDA7CiEgCiEgICAgIGlmICghKHN0cm5jbXAoaW50bmFtZSwgIklO
Qk9YLiIsIDYpKSkgewogIAkvKiBUaGUgdXNlciBoYXMgYSAicGVyc29uYWwiIG5hbWVzcGFjZS4g
Ki8KICAJc2F3b25lW05BTUVTUEFDRV9JTkJPWF0gPSAxOwohICAgICB9IGVsc2UgaWYgKG1ib3hu
YW1lX2lzdXNlcm1haWxib3goaW50bmFtZSwgMCkpIHsKICAJLyogVGhlIHVzZXIgY2FuIHNlZSB0
aGUgIm90aGVyIHVzZXJzIiBuYW1lc3BhY2UuICovCiAgCXNhd29uZVtOQU1FU1BBQ0VfVVNFUl0g
PSAxOwogICAgICB9IGVsc2UgewoqKioqKioqKioqKioqKioKKioqIDUxNDUsNTE1MyAqKioqCiAg
ICAgIH0gZWxzZSB7CiAgCXBhdHRlcm4gPSB4c3RyZHVwKCIlIik7CiAgCS8qIG5vdyBmaW5kIGFs
bCB0aGUgZXhjaXRpbmcgdG9wbGV2ZWwgbmFtZXNwYWNlcyAtCiEgCSAqIHdlJ3JlIHVzaW5nIGlu
dGVybmFsIG5hbWVzIGhlcmUKICAJICovCiEgCW1ib3hsaXN0X2ZpbmRhbGwoTlVMTCwgcGF0dGVy
biwgaW1hcGRfdXNlcmlzYWRtaW4sIGltYXBkX3VzZXJpZCwKICAJCQkgaW1hcGRfYXV0aHN0YXRl
LCBuYW1lc3BhY2VkYXRhLCAodm9pZCopIHNhd29uZSk7CiAgCWZyZWUocGF0dGVybik7CiAgICAg
IH0KLS0tIDUxNjQsNTE3MyAtLS0tCiAgICAgIH0gZWxzZSB7CiAgCXBhdHRlcm4gPSB4c3RyZHVw
KCIlIik7CiAgCS8qIG5vdyBmaW5kIGFsbCB0aGUgZXhjaXRpbmcgdG9wbGV2ZWwgbmFtZXNwYWNl
cyAtCiEgCSAqIHdlJ3JlIHVzaW5nIGV4dGVybmFsIG5hbWVzIGhlcmUKICAJICovCiEgCW1ib3hs
aXN0X2ZpbmRhbGwoJmltYXBkX25hbWVzcGFjZSwgcGF0dGVybiwgaW1hcGRfdXNlcmlzYWRtaW4s
CiEgCQkJIGltYXBkX3VzZXJpZCwgCiAgCQkJIGltYXBkX2F1dGhzdGF0ZSwgbmFtZXNwYWNlZGF0
YSwgKHZvaWQqKSBzYXdvbmUpOwogIAlmcmVlKHBhdHRlcm4pOwogICAgICB9CioqKioqKioqKioq
KioqKgoqKiogNjUzMSw2NTM3ICoqKioKICAgICAgc3RydWN0IGJhY2tlbmQgKmJlOwogIH07CiAg
CiEgc3RhdGljIGludCB4ZmVyX3VzZXJfY2IoY2hhciAqbmFtZSwKICAJCQlpbnQgbWF0Y2hsZW4g
X19hdHRyaWJ1dGVfXygodW51c2VkKSksCiAgCQkJaW50IG1heWNyZWF0ZSBfX2F0dHJpYnV0ZV9f
KCh1bnVzZWQpKSwKICAJCQl2b2lkICpyb2NrKSAKLS0tIDY1NTEsNjU1NyAtLS0tCiAgICAgIHN0
cnVjdCBiYWNrZW5kICpiZTsKICB9OwogIAohIHN0YXRpYyBpbnQgeGZlcl91c2VyX2NiKGNoYXIg
KmV4dGVybmFsbmFtZSwKICAJCQlpbnQgbWF0Y2hsZW4gX19hdHRyaWJ1dGVfXygodW51c2VkKSks
CiAgCQkJaW50IG1heWNyZWF0ZSBfX2F0dHJpYnV0ZV9fKCh1bnVzZWQpKSwKICAJCQl2b2lkICpy
b2NrKSAKKioqKioqKioqKioqKioqCioqKiA2NTQwLDY1NTEgKioqKgogICAgICBjaGFyICp0b3Nl
cnZlciA9ICgoc3RydWN0IHhmZXJfdXNlcl9yb2NrICopcm9jayktPnRvc2VydmVyOwogICAgICBj
aGFyICp0b3BhcnQgPSAoKHN0cnVjdCB4ZmVyX3VzZXJfcm9jayAqKXJvY2spLT50b3BhcnQ7CiAg
ICAgIHN0cnVjdCBiYWNrZW5kICpiZSA9ICgoc3RydWN0IHhmZXJfdXNlcl9yb2NrICopcm9jaykt
PmJlOwohICAgICBjaGFyIGV4dGVybmFsbmFtZVtNQVhfTUFJTEJPWF9OQU1FKzFdOwogICAgICBp
bnQgbWJmbGFnczsKICAgICAgaW50IHIgPSAwOwogICAgICBjaGFyICppbnBhdGgsICppbnBhcnQs
ICppbmFjbDsKICAgICAgY2hhciAqcGF0aCA9IE5VTEwsICpwYXJ0ID0gTlVMTCwgKmFjbCA9IE5V
TEw7CiAgCiAgICAgIGlmICghcikgewogIAkvKiBOT1RFOiBOT1QgbWxvb2t1cCgpIGJlY2F1c2Ug
d2UgZG9uJ3Qgd2FudCB0byBpc3N1ZSBhIHJlZmVycmFsICovCiAgCS8qIHh4eCBidXQgd2hhdCBo
YXBwZW5zIGlmIHRoZXkgYXJlIHJlbW90ZQotLS0gNjU2MCw2NTc2IC0tLS0KICAgICAgY2hhciAq
dG9zZXJ2ZXIgPSAoKHN0cnVjdCB4ZmVyX3VzZXJfcm9jayAqKXJvY2spLT50b3NlcnZlcjsKICAg
ICAgY2hhciAqdG9wYXJ0ID0gKChzdHJ1Y3QgeGZlcl91c2VyX3JvY2sgKilyb2NrKS0+dG9wYXJ0
OwogICAgICBzdHJ1Y3QgYmFja2VuZCAqYmUgPSAoKHN0cnVjdCB4ZmVyX3VzZXJfcm9jayAqKXJv
Y2spLT5iZTsKISAgICAgY2hhciBuYW1lW01BWF9NQUlMQk9YX05BTUUrMV07CiAgICAgIGludCBt
YmZsYWdzOwogICAgICBpbnQgciA9IDA7CiAgICAgIGNoYXIgKmlucGF0aCwgKmlucGFydCwgKmlu
YWNsOwogICAgICBjaGFyICpwYXRoID0gTlVMTCwgKnBhcnQgPSBOVUxMLCAqYWNsID0gTlVMTDsK
ICAKKyAgICAgciA9ICgqaW1hcGRfbmFtZXNwYWNlLm1ib3huYW1lX3RvaW50ZXJuYWwpKCZpbWFw
ZF9uYW1lc3BhY2UsCisgCQkJCQkgICAgICAgZXh0ZXJuYWxuYW1lLAorIAkJCQkJICAgICAgIGlt
YXBkX3VzZXJpZCwKKyAJCQkJCSAgICAgICBuYW1lKTsKKyAKICAgICAgaWYgKCFyKSB7CiAgCS8q
IE5PVEU6IE5PVCBtbG9va3VwKCkgYmVjYXVzZSB3ZSBkb24ndCB3YW50IHRvIGlzc3VlIGEgcmVm
ZXJyYWwgKi8KICAJLyogeHh4IGJ1dCB3aGF0IGhhcHBlbnMgaWYgdGhleSBhcmUgcmVtb3RlCioq
KioqKioqKioqKioqKgoqKiogNjU1OCw2NTczICoqKioKICAJcGF0aCA9IHhzdHJkdXAoaW5wYXRo
KTsKICAJcGFydCA9IHhzdHJkdXAoaW5wYXJ0KTsKICAJYWNsID0geHN0cmR1cChpbmFjbCk7Ci0g
ICAgIH0KLSAKLSAgICAgaWYgKCFyKSB7Ci0gCXIgPSAoKmltYXBkX25hbWVzcGFjZS5tYm94bmFt
ZV90b2V4dGVybmFsKSgmaW1hcGRfbmFtZXNwYWNlLAotIAkJCQkJCSAgIG5hbWUsCi0gCQkJCQkJ
ICAgaW1hcGRfdXNlcmlkLAotIAkJCQkJCSAgIGV4dGVybmFsbmFtZSk7Ci0gICAgIH0KLSAKLSAg
ICAgaWYoIXIpIHsKICAJciA9IGRvX3hmZXJfc2luZ2xlKHRvc2VydmVyLCB0b3BhcnQsIGV4dGVy
bmFsbmFtZSwgbmFtZSwgbWJmbGFncywKICAJCQkgICBwYXRoLCBwYXJ0LCBhY2wsIDAsIG11cGRh
dGVfaCwgYmUpOwogICAgICB9Ci0tLSA2NTgzLDY1ODggLS0tLQoqKioqKioqKioqKioqKioKKioq
IDY3MDYsNjcxMiAqKioqCiAgCX0KICAKICAKISAJLyogcmVjdXJzaXZlbHkgbW92ZSBhbGwgc3Vi
LW1haWxib3hlcywgdXNpbmcgaW50ZXJuYWwgbmFtZXMgKi8KICAJaWYoIXIpIHsKICAJICAgIHN0
cnVjdCB4ZmVyX3VzZXJfcm9jayByb2NrOwogIAotLS0gNjcyMSw2NzI3IC0tLS0KICAJfQogIAog
IAohIAkvKiByZWN1cnNpdmVseSBtb3ZlIGFsbCBzdWItbWFpbGJveGVzLCB1c2luZyBleHRlcm5h
bCBuYW1lcyAqLwogIAlpZighcikgewogIAkgICAgc3RydWN0IHhmZXJfdXNlcl9yb2NrIHJvY2s7
CiAgCioqKioqKioqKioqKioqKgoqKiogNjcxNiw2NzIyICoqKioKICAJICAgIHJvY2suYmUgPSBi
ZTsKICAKICAJICAgIHNucHJpbnRmKGJ1Ziwgc2l6ZW9mKGJ1ZiksICIlcy4qIiwgbWFpbGJveG5h
bWUpOwohIAkgICAgciA9IG1ib3hsaXN0X2ZpbmRhbGwoTlVMTCwgYnVmLCAxLCBpbWFwZF91c2Vy
aWQsCiAgCQkJCSBpbWFwZF9hdXRoc3RhdGUsIHhmZXJfdXNlcl9jYiwKICAJCQkJICZyb2NrKTsK
ICAJfQotLS0gNjczMSw2NzM3IC0tLS0KICAJICAgIHJvY2suYmUgPSBiZTsKICAKICAJICAgIHNu
cHJpbnRmKGJ1Ziwgc2l6ZW9mKGJ1ZiksICIlcy4qIiwgbWFpbGJveG5hbWUpOwohIAkgICAgciA9
IG1ib3hsaXN0X2ZpbmRhbGwoJmltYXBkX25hbWVzcGFjZSwgYnVmLCAxLCBpbWFwZF91c2VyaWQs
CiAgCQkJCSBpbWFwZF9hdXRoc3RhdGUsIHhmZXJfdXNlcl9jYiwKICAJCQkJICZyb2NrKTsKICAJ
fQoqKioqKioqKioqKioqKioKKioqIDc0MDgsNzQyNCAqKioqCiAgLyoKICAgKiBJc3N1ZSBhIExJ
U1Qgb3IgTFNVQiB1bnRhZ2dlZCByZXNwb25zZQogICAqLwogIHN0YXRpYyB2b2lkIG1zdHJpbmdk
YXRhKGNoYXIgKmNtZCwgY2hhciAqbmFtZSwgaW50IG1hdGNobGVuLCBpbnQgbWF5Y3JlYXRlLAog
IAkJCWludCBsaXN0b3B0cykKICB7CiEgICAgIHN0YXRpYyBjaGFyIGxhc3RuYW1lW01BWF9NQUlM
Qk9YX1BBVEgrMV07CiAgICAgIHN0YXRpYyBpbnQgbGFzdG5hbWVkZWxheWVkID0gMDsKICAgICAg
c3RhdGljIGludCBsYXN0bmFtZW5vaW5mZXJpb3JzID0gMDsKICAgICAgc3RhdGljIGludCBub25l
eGlzdGVudCA9IDA7CiAgICAgIHN0YXRpYyBpbnQgc2F3dXNlciA9IDA7CiAgICAgIGludCBsYXN0
bmFtZWhhc3N1YiA9IDA7CiAgICAgIGludCBjLCBtYnR5cGU7Ci0gICAgIGNoYXIgbWJveG5hbWVb
TUFYX01BSUxCT1hfUEFUSCsxXTsKICAKICAgICAgLyogV2UgaGF2ZSB0byByZXNldCB0aGUgc2F3
dXNlciBmbGFnIGJlZm9yZSBlYWNoIGxpc3QgY29tbWFuZC4KICAgICAgICogSGFuZGxlIGl0IGFz
IGEgZGlydHkgaGFjay4KLS0tIDc0MjMsNzQ0MCAtLS0tCiAgLyoKICAgKiBJc3N1ZSBhIExJU1Qg
b3IgTFNVQiB1bnRhZ2dlZCByZXNwb25zZQogICAqLworIC8qIFRoZSAnbmFtZScgdmFyaWFibGUg
bm93IGlzIGFuIGV4dGVybmFsIG5hbWUhIC8vIHNvcmNlcmVyICovCiAgc3RhdGljIHZvaWQgbXN0
cmluZ2RhdGEoY2hhciAqY21kLCBjaGFyICpuYW1lLCBpbnQgbWF0Y2hsZW4sIGludCBtYXljcmVh
dGUsCiAgCQkJaW50IGxpc3RvcHRzKQogIHsKISAgICAgc3RhdGljIGNoYXIgbGFzdG5hbWVbTUFY
X01BSUxCT1hfUEFUSCsxXT0iIjsKISAgICAgY2hhciBpbnRuYW1lW01BWF9NQUlMQk9YX1BBVEgr
MV07CiAgICAgIHN0YXRpYyBpbnQgbGFzdG5hbWVkZWxheWVkID0gMDsKICAgICAgc3RhdGljIGlu
dCBsYXN0bmFtZW5vaW5mZXJpb3JzID0gMDsKICAgICAgc3RhdGljIGludCBub25leGlzdGVudCA9
IDA7CiAgICAgIHN0YXRpYyBpbnQgc2F3dXNlciA9IDA7CiAgICAgIGludCBsYXN0bmFtZWhhc3N1
YiA9IDA7CiAgICAgIGludCBjLCBtYnR5cGU7CiAgCiAgICAgIC8qIFdlIGhhdmUgdG8gcmVzZXQg
dGhlIHNhd3VzZXIgZmxhZyBiZWZvcmUgZWFjaCBsaXN0IGNvbW1hbmQuCiAgICAgICAqIEhhbmRs
ZSBpdCBhcyBhIGRpcnR5IGhhY2suCioqKioqKioqKioqKioqKgoqKiogNzQzMCw3NDM5ICoqKioK
ICAgICAgfQogICAgICBtc3RyaW5nZGF0YWNhbGxzKys7CiAgCiAgICAgIGlmIChsYXN0bmFtZWRl
bGF5ZWQpIHsKICAJLyogQ2hlY2sgaWYgbGFzdG5hbWUgaGFzIGNoaWxkcmVuICovCiAgCWlmIChu
YW1lICYmIHN0cm5jbXAobGFzdG5hbWUsIG5hbWUsIHN0cmxlbihsYXN0bmFtZSkpID09IDAgJiYK
ISAJICAgIG5hbWVbc3RybGVuKGxhc3RuYW1lKV0gPT0gJy4nKSB7CiAgCSAgICBsYXN0bmFtZWhh
c3N1YiA9IDE7CiAgCX0KICAJcHJvdF9wcmludGYoaW1hcGRfb3V0LCAiKiAlcyAoIiwgY21kKTsK
LS0tIDc0NDYsNzQ1OSAtLS0tCiAgICAgIH0KICAgICAgbXN0cmluZ2RhdGFjYWxscysrOwogIAor
ICAgICBpZihuYW1lICYmICgqaW1hcGRfbmFtZXNwYWNlLm1ib3huYW1lX3RvaW50ZXJuYWwpKCZp
bWFwZF9uYW1lc3BhY2UsIG5hbWUsCisgCQkJCQkgICAgICBpbWFwZF91c2VyaWQsIGludG5hbWUp
KQorIAlyZXR1cm47CisgCiAgICAgIGlmIChsYXN0bmFtZWRlbGF5ZWQpIHsKICAJLyogQ2hlY2sg
aWYgbGFzdG5hbWUgaGFzIGNoaWxkcmVuICovCiAgCWlmIChuYW1lICYmIHN0cm5jbXAobGFzdG5h
bWUsIG5hbWUsIHN0cmxlbihsYXN0bmFtZSkpID09IDAgJiYKISAJICAgIG5hbWVbc3RybGVuKGxh
c3RuYW1lKV0gPT0gaW1hcGRfbmFtZXNwYWNlLmhpZXJfc2VwKSB7CiAgCSAgICBsYXN0bmFtZWhh
c3N1YiA9IDE7CiAgCX0KICAJcHJvdF9wcmludGYoaW1hcGRfb3V0LCAiKiAlcyAoIiwgY21kKTsK
KioqKioqKioqKioqKioqCioqKiA3NDU4LDc0NjYgKioqKgogIAl9CiAgCXByb3RfcHJpbnRmKGlt
YXBkX291dCwgIikgXCIlY1wiICIsIGltYXBkX25hbWVzcGFjZS5oaWVyX3NlcCk7CiAgCQkgICAg
CiEgCSgqaW1hcGRfbmFtZXNwYWNlLm1ib3huYW1lX3RvZXh0ZXJuYWwpKCZpbWFwZF9uYW1lc3Bh
Y2UsIGxhc3RuYW1lLAohIAkJCQkJICAgICAgIGltYXBkX3VzZXJpZCwgbWJveG5hbWUpOwohIAlw
cmludHN0cmluZyhtYm94bmFtZSk7CiAgCXByb3RfcHJpbnRmKGltYXBkX291dCwgIlxyXG4iKTsK
ICAJbGFzdG5hbWVkZWxheWVkID0gbGFzdG5hbWVub2luZmVyaW9ycyA9IG5vbmV4aXN0ZW50ID0g
MDsKICAgICAgfQotLS0gNzQ3OCw3NDg0IC0tLS0KICAJfQogIAlwcm90X3ByaW50ZihpbWFwZF9v
dXQsICIpIFwiJWNcIiAiLCBpbWFwZF9uYW1lc3BhY2UuaGllcl9zZXApOwogIAkJICAgIAohIAlw
cmludHN0cmluZyhsYXN0bmFtZSk7CiAgCXByb3RfcHJpbnRmKGltYXBkX291dCwgIlxyXG4iKTsK
ICAJbGFzdG5hbWVkZWxheWVkID0gbGFzdG5hbWVub2luZmVyaW9ycyA9IG5vbmV4aXN0ZW50ID0g
MDsKICAgICAgfQoqKioqKioqKioqKioqKioKKioqIDc0NzQsNzQ4MCAqKioqCiAgICAgIC8qIFN1
cHByZXNzIGFueSBvdXRwdXQgb2YgYSBwYXJ0aWFsIG1hdGNoICovCiAgICAgIGlmICgobmFtZVtt
YXRjaGxlbl0KICAJICYmIHN0cm5jbXAobGFzdG5hbWUsIG5hbWUsIG1hdGNobGVuKSA9PSAwCiEg
CSAmJiAobGFzdG5hbWVbbWF0Y2hsZW5dID09ICdcMCcgfHwgbGFzdG5hbWVbbWF0Y2hsZW5dID09
ICcuJykpKSB7CiAgCXJldHVybjsKICAgICAgfQogIAkKLS0tIDc0OTIsNzQ5OCAtLS0tCiAgICAg
IC8qIFN1cHByZXNzIGFueSBvdXRwdXQgb2YgYSBwYXJ0aWFsIG1hdGNoICovCiAgICAgIGlmICgo
bmFtZVttYXRjaGxlbl0KICAJICYmIHN0cm5jbXAobGFzdG5hbWUsIG5hbWUsIG1hdGNobGVuKSA9
PSAwCiEgCSAmJiAobGFzdG5hbWVbbWF0Y2hsZW5dID09ICdcMCcgfHwgbGFzdG5hbWVbbWF0Y2hs
ZW5dID09IGltYXBkX25hbWVzcGFjZS5oaWVyX3NlcCkpKSB7CiAgCXJldHVybjsKICAgICAgfQog
IAkKKioqKioqKioqKioqKioqCioqKiA3NDgyLDc0ODggKioqKgogICAgICAgKiBXZSBjYW4gZ2V0
IGEgcGFydGlhbCBtYXRjaCBmb3IgInVzZXIiIG11bHRpcGxlIHRpbWVzIHdpdGgKICAgICAgICog
b3RoZXIgbWF0Y2hlcyBpbmJldHdlZW4uICBIYW5kbGUgaXQgYXMgYSBzcGVjaWFsIGNhc2UKICAg
ICAgICovCiEgICAgIGlmIChtYXRjaGxlbiA9PSA0ICYmIHN0cm5jYXNlY21wKG5hbWUsICJ1c2Vy
IiwgNCkgPT0gMCkgewogIAlpZiAoc2F3dXNlcikgcmV0dXJuOwogIAlzYXd1c2VyID0gMTsKICAg
ICAgfQotLS0gNzUwMCw3NTA2IC0tLS0KICAgICAgICogV2UgY2FuIGdldCBhIHBhcnRpYWwgbWF0
Y2ggZm9yICJ1c2VyIiBtdWx0aXBsZSB0aW1lcyB3aXRoCiAgICAgICAqIG90aGVyIG1hdGNoZXMg
aW5iZXR3ZWVuLiAgSGFuZGxlIGl0IGFzIGEgc3BlY2lhbCBjYXNlCiAgICAgICAqLwohICAgICBp
ZiAobWF0Y2hsZW4gPT0gNCAmJiBzdHJuY2FzZWNtcChpbnRuYW1lLCAidXNlciIsIDQpID09IDAp
IHsKICAJaWYgKHNhd3VzZXIpIHJldHVybjsKICAJc2F3dXNlciA9IDE7CiAgICAgIH0KKioqKioq
KioqKioqKioqCioqKiA3NDkyLDc1MDggKioqKgogICAgICBub25leGlzdGVudCA9IDA7CiAgCiAg
ICAgIC8qIE5vdyB3ZSBuZWVkIHRvIHNlZSBpZiB0aGlzIG1haWxib3ggZXhpc3RzICovCiEgICAg
IC8qIGZpcnN0IGNvbnZlcnQgIklOQk9YIiB0byAidXNlci48dXNlcmlkPiIgKi8KISAgICAgaWYg
KCFzdHJuY2FzZWNtcChsYXN0bmFtZSwgImluYm94IiwgNSkpIHsKISAJKCppbWFwZF9uYW1lc3Bh
Y2UubWJveG5hbWVfdG9pbnRlcm5hbCkoJmltYXBkX25hbWVzcGFjZSwgIklOQk9YIiwKISAJCQkJ
CSAgICAgICBpbWFwZF91c2VyaWQsIG1ib3huYW1lKTsKISAJc3RybGNhdChtYm94bmFtZSwgbGFz
dG5hbWUrNSwgc2l6ZW9mKG1ib3huYW1lKSk7CiEgICAgIH0KISAgICAgZWxzZQohIAlzdHJsY3B5
KG1ib3huYW1lLCBsYXN0bmFtZSwgc2l6ZW9mKG1ib3huYW1lKSk7CiAgCiAgICAgIC8qIExvb2sg
aXQgdXAgKi8KISAgICAgbm9uZXhpc3RlbnQgPSBtYm94bGlzdF9kZXRhaWwobWJveG5hbWUsICZt
YnR5cGUsCiAgCQkJCSAgTlVMTCwgTlVMTCwgTlVMTCwgTlVMTCk7CiAgICAgIGlmKCFub25leGlz
dGVudCAmJiAobWJ0eXBlICYgTUJUWVBFX1JFU0VSVkUpKQogIAlub25leGlzdGVudCA9IElNQVBf
TUFJTEJPWF9SRVNFUlZFRDsKLS0tIDc1MTAsNzUyMSAtLS0tCiAgICAgIG5vbmV4aXN0ZW50ID0g
MDsKICAKICAgICAgLyogTm93IHdlIG5lZWQgdG8gc2VlIGlmIHRoaXMgbWFpbGJveCBleGlzdHMg
Ki8KISAKISAgICAgLyogVGhlICdpbnRuYW1lJyB2YXJpYWJsZSBjYW5ub3QgYmUgIklOQk9YIiwg
dGhlcmVmb3JlIHdlIGRvbid0CiEgICAgICAgIG5lZWQgdG8gY29udmVydCBpdCB0byAidXNlci48
dXNlcmlkPiIgKi8KICAKICAgICAgLyogTG9vayBpdCB1cCAqLwohICAgICBub25leGlzdGVudCA9
IG1ib3hsaXN0X2RldGFpbChpbnRuYW1lLCAmbWJ0eXBlLAogIAkJCQkgIE5VTEwsIE5VTEwsIE5V
TEwsIE5VTEwpOwogICAgICBpZighbm9uZXhpc3RlbnQgJiYgKG1idHlwZSAmIE1CVFlQRV9SRVNF
UlZFKSkKICAJbm9uZXhpc3RlbnQgPSBJTUFQX01BSUxCT1hfUkVTRVJWRUQ7CioqKioqKioqKioq
KioqKgoqKiogNzUxNyw3NTI1ICoqKioKICAgICAgaWYgKGMpIG5hbWVbbWF0Y2hsZW5dID0gJ1ww
JzsKICAgICAgcHJvdF9wcmludGYoaW1hcGRfb3V0LCAiKiAlcyAoIiwgY21kKTsKICAgICAgaWYg
KGMpIHsKISAJLyogSGFuZGxlIG5hbWVzcGFjZSBwcmVmaXggYXMgYSBzcGVjaWFsIGNhc2UgKi8g
CiEgCWlmICghc3RyY21wKG5hbWUsICJ1c2VyIikgfHwKISAJICAgICFzdHJjbXAobmFtZSwgaW1h
cGRfbmFtZXNwYWNlLnByZWZpeFtOQU1FU1BBQ0VfU0hBUkVEXSkpIHsKICAJICAgIHByb3RfcHJp
bnRmKGltYXBkX291dCwgIlxcTm9zZWxlY3QiKTsKICAJICAgIGlmIChsaXN0b3B0cyAmIExJU1Rf
RVhUKQogIAkJcHJvdF9wcmludGYoaW1hcGRfb3V0LCAiIFxcUGxhY2VIb2xkZXIiKTsKLS0tIDc1
MzAsNzUzOCAtLS0tCiAgICAgIGlmIChjKSBuYW1lW21hdGNobGVuXSA9ICdcMCc7CiAgICAgIHBy
b3RfcHJpbnRmKGltYXBkX291dCwgIiogJXMgKCIsIGNtZCk7CiAgICAgIGlmIChjKSB7CiEgCS8q
IEhhbmRsZSBuYW1lc3BhY2UgcHJlZml4IGFzIGEgc3BlY2lhbCBjYXNlICovCiEgIAlpZiAoIXN0
cmNtcChuYW1lLCBpbWFwZF9uYW1lc3BhY2UucHJlZml4W05BTUVTUEFDRV9VU0VSXSkgfHwKISAg
CSAgICAhc3RyY21wKG5hbWUsIGltYXBkX25hbWVzcGFjZS5wcmVmaXhbTkFNRVNQQUNFX1NIQVJF
RF0pKSB7CiAgCSAgICBwcm90X3ByaW50ZihpbWFwZF9vdXQsICJcXE5vc2VsZWN0Iik7CiAgCSAg
ICBpZiAobGlzdG9wdHMgJiBMSVNUX0VYVCkKICAJCXByb3RfcHJpbnRmKGltYXBkX291dCwgIiBc
XFBsYWNlSG9sZGVyIik7CioqKioqKioqKioqKioqKgoqKiogNzUzOCw3NTQ2ICoqKioKICAgICAg
fQogICAgICBwcm90X3ByaW50ZihpbWFwZF9vdXQsICIpIFwiJWNcIiAiLCBpbWFwZF9uYW1lc3Bh
Y2UuaGllcl9zZXApOwogIAohICAgICAoKmltYXBkX25hbWVzcGFjZS5tYm94bmFtZV90b2V4dGVy
bmFsKSgmaW1hcGRfbmFtZXNwYWNlLCBuYW1lLAohIAkJCQkJICAgaW1hcGRfdXNlcmlkLCBtYm94
bmFtZSk7CiEgICAgIHByaW50c3RyaW5nKG1ib3huYW1lKTsKICAgICAgcHJvdF9wcmludGYoaW1h
cGRfb3V0LCAiXHJcbiIpOwogICAgICBpZiAoYykgbmFtZVttYXRjaGxlbl0gPSBjOwogICAgICBy
ZXR1cm47Ci0tLSA3NTUxLDc1NTcgLS0tLQogICAgICB9CiAgICAgIHByb3RfcHJpbnRmKGltYXBk
X291dCwgIikgXCIlY1wiICIsIGltYXBkX25hbWVzcGFjZS5oaWVyX3NlcCk7CiAgCiEgICAgIHBy
aW50c3RyaW5nKG5hbWUpOwogICAgICBwcm90X3ByaW50ZihpbWFwZF9vdXQsICJcclxuIik7CiAg
ICAgIGlmIChjKSBuYW1lW21hdGNobGVuXSA9IGM7CiAgICAgIHJldHVybjsKZGlmZiAtQyAzIC1y
IGN5cnVzLWltYXBkLTIuMi4xMi5zdXBlcm9sZC9pbWFwL21ib3hsaXN0LmMgY3lydXMtaW1hcGQt
Mi4yLjEyLm9sZC9pbWFwL21ib3hsaXN0LmMKKioqIGN5cnVzLWltYXBkLTIuMi4xMi5zdXBlcm9s
ZC9pbWFwL21ib3hsaXN0LmMJMjAwNS0xMC0zMSAxNTo0MTowNCArMDMwMAotLS0gY3lydXMtaW1h
cGQtMi4yLjEyLm9sZC9pbWFwL21ib3hsaXN0LmMJMjAwNS0xMC0zMSAxNTozODozOCArMDMwMAoq
KioqKioqKioqKioqKioKKioqIDE3NTIsMTc4NiAqKioqCiAgICAgIGxvbmcgbWlubWF0Y2g7CiAg
ICAgIHN0cnVjdCBnbG9iICpnID0gcm9jay0+ZzsKICAgICAgbG9uZyBtYXRjaGxlbjsKICAKICAg
ICAgLyogZG9uJ3QgbGlzdCBtYWlsYm94ZXMgb3V0c2lkZSBvZiB0aGUgZGVmYXVsdCBkb21haW4g
Ki8KICAgICAgaWYgKCFyb2NrLT5kb21haW5sZW4gJiYgIXJvY2stPmlzYWRtaW4gJiYgc3RyY2hy
KGtleSwgJyEnKSkgcmV0dXJuIDA7IAogIAogICAgICBtaW5tYXRjaCA9IDA7Ci0gICAgIGlmIChy
b2NrLT5pbmJveG9mZnNldCkgewotIAljaGFyIG5hbWVidWZbTUFYX01BSUxCT1hfTkFNRSsxXTsK
ICAKISAJaWYoa2V5bGVuID49IHNpemVvZihuYW1lYnVmKSkgewohIAkgICAgc3lzbG9nKExPR19F
UlIsICJvdmVyc2l6ZSBrZXlsZW4gaW4gbWJveGxpc3QuYzpmaW5kX3AoKSIpOwohIAkgICAgcmV0
dXJuIDA7CiEgCX0KISAJbWVtY3B5KG5hbWVidWYsIGtleSwga2V5bGVuKTsKISAJbmFtZWJ1Zltr
ZXlsZW5dID0gJ1wwJzsKISAJCiEgCWlmIChyb2NrLT5pbmJveG9mZnNldCkgewohIAkgICAgbmFt
ZWJ1Zltyb2NrLT5pbmJveG9mZnNldF0gPSByb2NrLT5pbmJveGNhc2VbMF07CiEgCSAgICBuYW1l
YnVmW3JvY2stPmluYm94b2Zmc2V0KzFdID0gcm9jay0+aW5ib3hjYXNlWzFdOwohIAkgICAgbmFt
ZWJ1Zltyb2NrLT5pbmJveG9mZnNldCsyXSA9IHJvY2stPmluYm94Y2FzZVsyXTsKISAJICAgIG5h
bWVidWZbcm9jay0+aW5ib3hvZmZzZXQrM10gPSByb2NrLT5pbmJveGNhc2VbM107CiEgCSAgICBu
YW1lYnVmW3JvY2stPmluYm94b2Zmc2V0KzRdID0gcm9jay0+aW5ib3hjYXNlWzRdOwohIAl9CiEg
CQohIAltYXRjaGxlbiA9IGdsb2JfdGVzdChnLCBuYW1lYnVmK3JvY2stPmluYm94b2Zmc2V0LAoh
IAkJCSAgICAga2V5bGVuLXJvY2stPmluYm94b2Zmc2V0LCAmbWlubWF0Y2gpOwohICAgICB9IGVs
c2UgewohIAltYXRjaGxlbiA9IGdsb2JfdGVzdChnLCBrZXksIGtleWxlbiwgJm1pbm1hdGNoKTsK
ICAgICAgfQogIAogICAgICAvKiBJZiBpdHMgbm90IGEgbWF0Y2gsIHNraXAgaXQgLS0gcGFydGlh
bCBtYXRjaGVzIGFyZSBvay4gKi8KICAgICAgaWYobWF0Y2hsZW4gPT0gLTEpIHJldHVybiAwOwog
IAotLS0gMTc1MiwxNzkwIC0tLS0KICAgICAgbG9uZyBtaW5tYXRjaDsKICAgICAgc3RydWN0IGds
b2IgKmcgPSByb2NrLT5nOwogICAgICBsb25nIG1hdGNobGVuOworICAgICBjaGFyIG5hbWVidWZb
TUFYX01BSUxCT1hfTkFNRSsxXTsKKyAgICAgY2hhciBuYW1lYnVmX291dFtNQVhfTUFJTEJPWF9O
QU1FKzFdOwogIAogICAgICAvKiBkb24ndCBsaXN0IG1haWxib3hlcyBvdXRzaWRlIG9mIHRoZSBk
ZWZhdWx0IGRvbWFpbiAqLwogICAgICBpZiAoIXJvY2stPmRvbWFpbmxlbiAmJiAhcm9jay0+aXNh
ZG1pbiAmJiBzdHJjaHIoa2V5LCAnIScpKSByZXR1cm4gMDsgCiAgCiAgICAgIG1pbm1hdGNoID0g
MDsKICAKISAgICAgbWVtY3B5KG5hbWVidWYsIGtleSwga2V5bGVuKTsKISAgICAgbmFtZWJ1Zltr
ZXlsZW5dID0gJ1wwJzsKISAKISAgICAgLyogcmlnaHQgd29yayB3aXRoIGFuIGFsdGVybmF0ZSAo
bm90IHRoZSBidWlsZC1pbikKISAgICAgICAgbmFtZXNwYWNlIC0tIHNvcmNlcmVyICovCiEgICAg
IGlmKGtleWxlbiA+PSBzaXplb2YobmFtZWJ1ZikpIHsKISAJc3lzbG9nKExPR19FUlIsICJvdmVy
c2l6ZSBrZXlsZW4gaW4gbWJveGxpc3QuYzpmaW5kX3AoKSIpOwohIAlyZXR1cm4gMDsKISAgICAg
fQohICAgICBpZihyb2NrLT5pbmJveG9mZnNldCkgewohIAluYW1lYnVmW3JvY2stPmluYm94b2Zm
c2V0XSA9IHJvY2stPmluYm94Y2FzZVswXTsKISAJbmFtZWJ1Zltyb2NrLT5pbmJveG9mZnNldCsx
XSA9IHJvY2stPmluYm94Y2FzZVsxXTsKISAJbmFtZWJ1Zltyb2NrLT5pbmJveG9mZnNldCsyXSA9
IHJvY2stPmluYm94Y2FzZVsyXTsKISAJbmFtZWJ1Zltyb2NrLT5pbmJveG9mZnNldCszXSA9IHJv
Y2stPmluYm94Y2FzZVszXTsKISAJbmFtZWJ1Zltyb2NrLT5pbmJveG9mZnNldCs0XSA9IHJvY2st
PmluYm94Y2FzZVs0XTsKICAgICAgfQogIAorICAgICAvKiBpZiBjYW50IGdldCB0aGUgZXh0ZXJu
YWwgbmFtZSB0aGVuIHNraXAgdGhlIGN1cnJlbnQKKyAgICAgICAga2V5IC0tIHNvcmNlcmVyICov
CisgICAgIGlmKChyb2NrLT5uYW1lc3BhY2UtPm1ib3huYW1lX3RvZXh0ZXJuYWwpKHJvY2stPm5h
bWVzcGFjZSwgbmFtZWJ1Zityb2NrLT5pbmJveG9mZnNldCwgYXV0aF9jYW5vbnVzZXIocm9jay0+
YXV0aF9zdGF0ZSksIG5hbWVidWZfb3V0KSkKKyAJcmV0dXJuIDA7CisgCisgICAgIG1hdGNobGVu
ID0gZ2xvYl90ZXN0KGcsIG5hbWVidWZfb3V0LAorIAkJCSBzdHJsZW4obmFtZWJ1Zl9vdXQpLCAm
bWlubWF0Y2gpOworIAogICAgICAvKiBJZiBpdHMgbm90IGEgbWF0Y2gsIHNraXAgaXQgLS0gcGFy
dGlhbCBtYXRjaGVzIGFyZSBvay4gKi8KICAgICAgaWYobWF0Y2hsZW4gPT0gLTEpIHJldHVybiAw
OwogIAoqKioqKioqKioqKioqKioKKioqIDE4ODEsMTkwMiAqKioqCiAgCSAgICByID0gMDsJCS8q
IGRvbid0IGJvdGhlciBjaGVja2luZyAqLwogIAl9CiAgCiEgCWlmICghciAmJiByb2NrLT5pbmJv
eG9mZnNldCkgewohIAkgICAgbmFtZWJ1Zltyb2NrLT5pbmJveG9mZnNldF0gPSByb2NrLT5pbmJv
eGNhc2VbMF07CiEgCSAgICBuYW1lYnVmW3JvY2stPmluYm94b2Zmc2V0KzFdID0gcm9jay0+aW5i
b3hjYXNlWzFdOwohIAkgICAgbmFtZWJ1Zltyb2NrLT5pbmJveG9mZnNldCsyXSA9IHJvY2stPmlu
Ym94Y2FzZVsyXTsKISAJICAgIG5hbWVidWZbcm9jay0+aW5ib3hvZmZzZXQrM10gPSByb2NrLT5p
bmJveGNhc2VbM107CiEgCSAgICBuYW1lYnVmW3JvY2stPmluYm94b2Zmc2V0KzRdID0gcm9jay0+
aW5ib3hjYXNlWzRdOwohIAl9CiEgCQohIAltYXRjaGxlbiA9IGdsb2JfdGVzdChnLCBuYW1lYnVm
K3JvY2stPmluYm94b2Zmc2V0LAohIAkJCSAgICAga2V5bGVuLXJvY2stPmluYm94b2Zmc2V0LCAm
bWlubWF0Y2gpOwogIAohIAlpZiAobWF0Y2hsZW4gPT0gLTEpIHsKISAJICAgIHIgPSAwOwohIAkg
ICAgYnJlYWs7CiEgCX0KICAKICAJc3dpdGNoIChyKSB7CiAgCWNhc2UgMDoKICAJICAgIC8qIGZv
dW5kIHRoZSBlbnRyeTsgb3V0cHV0IGl0ICovCi0tLSAxODg1LDE5MTYgLS0tLQogIAkgICAgciA9
IDA7CQkvKiBkb24ndCBib3RoZXIgY2hlY2tpbmcgKi8KICAJfQogIAohIAkvKiByaWdodCB3b3Jr
IHdpdGggYW4gYWx0ZXJuYXRlIChub3QgdGhlIGJ1aWxkLWluKQohIAkgICBuYW1lc3BhY2UgLy8g
c29yY2VyZXIgKi8KISAJewohIAkgICAgY2hhciBuYW1lYnVmX291dFtNQVhfTUFJTEJPWF9OQU1F
KzFdOwohIAkgICAgaWYocm9jay0+aW5ib3hvZmZzZXQpIHsKISAJCW5hbWVidWZbcm9jay0+aW5i
b3hvZmZzZXRdID0gcm9jay0+aW5ib3hjYXNlWzBdOwohIAkJbmFtZWJ1Zltyb2NrLT5pbmJveG9m
ZnNldCsxXSA9IHJvY2stPmluYm94Y2FzZVsxXTsKISAJCW5hbWVidWZbcm9jay0+aW5ib3hvZmZz
ZXQrMl0gPSByb2NrLT5pbmJveGNhc2VbMl07CiEgCQluYW1lYnVmW3JvY2stPmluYm94b2Zmc2V0
KzNdID0gcm9jay0+aW5ib3hjYXNlWzNdOwohIAkJbmFtZWJ1Zltyb2NrLT5pbmJveG9mZnNldCs0
XSA9IHJvY2stPmluYm94Y2FzZVs0XTsKISAJICAgIH0KISAJICAgIGlmKChyb2NrLT5uYW1lc3Bh
Y2UtPm1ib3huYW1lX3RvZXh0ZXJuYWwpKHJvY2stPm5hbWVzcGFjZSwgbmFtZWJ1Zityb2NrLT5p
bmJveG9mZnNldCwgYXV0aF9jYW5vbnVzZXIocm9jay0+YXV0aF9zdGF0ZSksIG5hbWVidWZfb3V0
KSkgewohIAkJciA9IDA7CiEgCQlicmVhazsKISAJICAgIH0KISAJICAgIHN0cmNweShuYW1lYnVm
LCBuYW1lYnVmX291dCk7CiAgCiEgCSAgICBtYXRjaGxlbiA9IGdsb2JfdGVzdChnLCBuYW1lYnVm
LAohIAkJCQkgc3RybGVuKG5hbWVidWYpLCAmbWlubWF0Y2gpOwogIAorIAkgICAgaWYgKG1hdGNo
bGVuID09IC0xKSB7CisgCQlyID0gMDsKKyAJCWJyZWFrOworIAkgICAgfQorIAl9CisgCQogIAlz
d2l0Y2ggKHIpIHsKICAJY2FzZSAwOgogIAkgICAgLyogZm91bmQgdGhlIGVudHJ5OyBvdXRwdXQg
aXQgKi8KKioqKioqKioqKioqKioqCioqKiAxOTE1LDE5MjEgKioqKgogIAkgICAgfQogIAogIAkg
ICAgcm9jay0+Y2hlY2tzaGFyZWQgPSAwOwohIAkgICAgciA9ICgqcm9jay0+cHJvYykobmFtZWJ1
Zityb2NrLT5pbmJveG9mZnNldCwgbWF0Y2hsZW4sIAogIAkJCSAgICAgIDEsIHJvY2stPnByb2Ny
b2NrKTsKICAKICAJICAgIGJyZWFrOwotLS0gMTkyOSwxOTM1IC0tLS0KICAJICAgIH0KICAKICAJ
ICAgIHJvY2stPmNoZWNrc2hhcmVkID0gMDsKISAJICAgIHIgPSAoKnJvY2stPnByb2MpKG5hbWVi
dWYsIG1hdGNobGVuLCAKICAJCQkgICAgICAxLCByb2NrLT5wcm9jcm9jayk7CiAgCiAgCSAgICBi
cmVhazsKKioqKioqKioqKioqKioqCioqKiAyMDAwLDIwMDcgKioqKgogICAgICBpZiAoZG9tYWlu
cGF0WzBdID09ICdcMCcpCiAgCXN0cmxjcHkoZG9tYWlucGF0LCBwYXR0ZXJuLCBzaXplb2YoZG9t
YWlucGF0KSk7CiAgCiEgICAgIGNicm9jay5nID0gZ2xvYl9pbml0KHBhdHRlcm4sIEdMT0JfSElF
UkFSQ0hZfEdMT0JfSU5CT1hDQVNFKTsKISAgICAgY2Jyb2NrLm5hbWVzcGFjZSA9IE5VTEw7CiAg
ICAgIGNicm9jay5kb21haW5sZW4gPSBkb21haW5sZW47CiAgICAgIGNicm9jay5pbmJveGNhc2Ug
PSBnbG9iX2luYm94Y2FzZShjYnJvY2suZyk7CiAgICAgIGNicm9jay5pc2FkbWluID0gaXNhZG1p
bjsKLS0tIDIwMTQsMjAyMSAtLS0tCiAgICAgIGlmIChkb21haW5wYXRbMF0gPT0gJ1wwJykKICAJ
c3RybGNweShkb21haW5wYXQsIHBhdHRlcm4sIHNpemVvZihkb21haW5wYXQpKTsKICAKISAgICAg
Y2Jyb2NrLmcgPSBnbG9iX2luaXQocGF0dGVybiwgbmFtZXNwYWNlLT5oaWVyX3NlcCwgR0xPQl9I
SUVSQVJDSFl8R0xPQl9JTkJPWENBU0UpOwohICAgICBjYnJvY2submFtZXNwYWNlID0gbmFtZXNw
YWNlOwogICAgICBjYnJvY2suZG9tYWlubGVuID0gZG9tYWlubGVuOwogICAgICBjYnJvY2suaW5i
b3hjYXNlID0gZ2xvYl9pbmJveGNhc2UoY2Jyb2NrLmcpOwogICAgICBjYnJvY2suaXNhZG1pbiA9
IGlzYWRtaW47CioqKioqKioqKioqKioqKgoqKiogMjAzNSwyMDUwICoqKioKICAJICAgIH0KICAJ
ICAgIGVsc2UgaWYgKHIgPT0gQ1lSVVNEQl9OT1RGT1VORCkgciA9IDA7CiAgCX0KLSAJZWxzZSBp
ZiAoIXN0cm5jbXAocGF0dGVybiwKLSAJCQkgIHVzZXJtYm94bmFtZStkb21haW5sZW4sIHVzZXJt
Ym94bmFtZWxlbi1kb21haW5sZW4pICYmCi0gCQkgR0xPQl9URVNUKGNicm9jay5nLCB1c2VybWJv
eG5hbWUrZG9tYWlubGVuKSAhPSAtMSkgewotIAkgICAgciA9IERCLT5mZXRjaChtYmRiLCB1c2Vy
bWJveG5hbWUsIHVzZXJtYm94bmFtZWxlbiwKLSAJCQkgICZkYXRhLCAmZGF0YWxlbiwgTlVMTCk7
Ci0gCSAgICBpZiAoIXIgJiYgZGF0YSkgewotIAkJciA9ICgqcHJvYykodXNlcm1ib3huYW1lLCB1
c2VybWJveG5hbWVsZW4sIDEsIHJvY2spOwotIAkgICAgfQotIAkgICAgZWxzZSBpZiAociA9PSBD
WVJVU0RCX05PVEZPVU5EKSByID0gMDsKLSAJfQogIAlzdHJsY2F0KHVzZXJtYm94bmFtZSwgIi4i
LCBzaXplb2YodXNlcm1ib3huYW1lKSk7CiAgCXVzZXJtYm94bmFtZWxlbisrOwogIAotLS0gMjA0
OSwyMDU0IC0tLS0KKioqKioqKioqKioqKioqCioqKiAyMDYyLDIwODkgKioqKgogIAogICAgICAv
KiBGaW5kIGZpeGVkLXN0cmluZyBwYXR0ZXJuIHByZWZpeCAqLwogICAgICBmb3IgKHAgPSBwYXQ7
ICpwOyBwKyspIHsKISAJaWYgKCpwID09ICcqJyB8fCAqcCA9PSAnJScgfHwgKnAgPT0gJz8nIHx8
ICpwID09ICdAJykgYnJlYWs7CiAgICAgIH0KICAgICAgcHJlZml4bGVuID0gcCAtIHBhdHRlcm47
CiAgICAgICpwID0gJ1wwJzsKICAKICAgICAgLyoKISAgICAgICogSWYgdXNlci5YLiogb3IgSU5C
T1guKiBjYW4gbWF0Y2ggcGF0dGVybiwKICAgICAgICogc2VhcmNoIGZvciB0aG9zZSBtYWlsYm94
ZXMgbmV4dAogICAgICAgKi8KICAgICAgaWYgKHVzZXJpZCAmJgohIAkoIXN0cm5jbXAodXNlcm1i
b3huYW1lK2RvbWFpbmxlbiwgcGF0dGVybiwgdXNlcm1ib3huYW1lbGVuLWRvbWFpbmxlbi0xKSB8
fAohIAkgIXN0cm5jYXNlY21wKCJpbmJveC4iLCBwYXR0ZXJuLCBwcmVmaXhsZW4gPCA2ID8gcHJl
Zml4bGVuIDogNikpKSB7CiAgCiEgCWlmICghc3RybmNtcCh1c2VybWJveG5hbWUrZG9tYWlubGVu
LCBwYXR0ZXJuLCB1c2VybWJveG5hbWVsZW4tZG9tYWlubGVuLTEpKSB7CiEgCSAgICAvKiBzd2l0
Y2ggdG8gcGF0dGVybiB3aXRoIGRvbWFpbiBwcmVwZW5kZWQgKi8KISAJICAgIGdsb2JfZnJlZSgm
Y2Jyb2NrLmcpOwohIAkgICAgY2Jyb2NrLmcgPSBnbG9iX2luaXQoZG9tYWlucGF0LCBHTE9CX0hJ
RVJBUkNIWSk7CiEgCSAgICBjYnJvY2suaW5ib3hvZmZzZXQgPSAwOwohIAl9CiEgCWVsc2Ugewoh
IAkgICAgY2Jyb2NrLmluYm94b2Zmc2V0ID0gZG9tYWlubGVuICsgdXNlcmxlbjsKISAJfQogIAog
IAljYnJvY2suZmluZF9uYW1lc3BhY2UgPSBOQU1FU1BBQ0VfSU5CT1g7CiAgCS8qIGl0ZXJhdGUg
dGhyb3VnaCBwcmVmaXhlcyBtYXRjaGluZyB1c2VybWJveG5hbWUgKi8KLS0tIDIwNjYsMjA4NSAt
LS0tCiAgCiAgICAgIC8qIEZpbmQgZml4ZWQtc3RyaW5nIHBhdHRlcm4gcHJlZml4ICovCiAgICAg
IGZvciAocCA9IHBhdDsgKnA7IHArKykgewohIAkvKiBzdG9wIGF0IHRoZSBzZXBhcmF0b3IgdG9v
ICovCiEgCWlmICgqcCA9PSAnKicgfHwgKnAgPT0gJyUnIHx8ICpwID09ICc/JyB8fCAqcCA9PSAn
QCcgfHwgKnAgPT0gbmFtZXNwYWNlLT5oaWVyX3NlcCkgYnJlYWs7CiAgICAgIH0KICAgICAgcHJl
Zml4bGVuID0gcCAtIHBhdHRlcm47CiAgICAgICpwID0gJ1wwJzsKICAKICAgICAgLyoKISAgICAg
ICogSWYgSU5CT1guKiBjYW4gbWF0Y2ggcGF0dGVybiwKICAgICAgICogc2VhcmNoIGZvciB0aG9z
ZSBtYWlsYm94ZXMgbmV4dAogICAgICAgKi8KICAgICAgaWYgKHVzZXJpZCAmJgohIAkgIXN0cm5j
YXNlY21wKCJpbmJveC4iLCBwYXR0ZXJuLCBwcmVmaXhsZW4gPCA2ID8gcHJlZml4bGVuIDogNikp
IHsKICAKISAJY2Jyb2NrLmluYm94b2Zmc2V0ID0gZG9tYWlubGVuICsgdXNlcmxlbjsKICAKICAJ
Y2Jyb2NrLmZpbmRfbmFtZXNwYWNlID0gTkFNRVNQQUNFX0lOQk9YOwogIAkvKiBpdGVyYXRlIHRo
cm91Z2ggcHJlZml4ZXMgbWF0Y2hpbmcgdXNlcm1ib3huYW1lICovCioqKioqKioqKioqKioqKgoq
KiogMjA5NywyMTAzICoqKioKICAJY2Jyb2NrLmZpbmRfbmFtZXNwYWNlID0gTkFNRVNQQUNFX1VT
RVI7CiAgCS8qIHN3aXRjaCB0byBwYXR0ZXJuIHdpdGggZG9tYWluIHByZXBlbmRlZCAqLwogIAln
bG9iX2ZyZWUoJmNicm9jay5nKTsKISAJY2Jyb2NrLmcgPSBnbG9iX2luaXQoZG9tYWlucGF0LCBH
TE9CX0hJRVJBUkNIWSk7CiAgCWNicm9jay5pbmJveG9mZnNldCA9IDA7CiAgCWlmICh1c2VybWJv
eG5hbWVsZW4pIHsKICAJICAgIHVzZXJtYm94bmFtZVstLXVzZXJtYm94bmFtZWxlbl0gPSAnXDAn
OwotLS0gMjA5MywyMDk5IC0tLS0KICAJY2Jyb2NrLmZpbmRfbmFtZXNwYWNlID0gTkFNRVNQQUNF
X1VTRVI7CiAgCS8qIHN3aXRjaCB0byBwYXR0ZXJuIHdpdGggZG9tYWluIHByZXBlbmRlZCAqLwog
IAlnbG9iX2ZyZWUoJmNicm9jay5nKTsKISAJY2Jyb2NrLmcgPSBnbG9iX2luaXQoZG9tYWlucGF0
LCBuYW1lc3BhY2UtPmhpZXJfc2VwLCBHTE9CX0hJRVJBUkNIWSk7CiAgCWNicm9jay5pbmJveG9m
ZnNldCA9IDA7CiAgCWlmICh1c2VybWJveG5hbWVsZW4pIHsKICAJICAgIHVzZXJtYm94bmFtZVst
LXVzZXJtYm94bmFtZWxlbl0gPSAnXDAnOwoqKioqKioqKioqKioqKioKKioqIDIxNDYsMjE1MiAq
KioqCiAgICAgIGVsc2UKICAJZG9tYWlucGF0WzBdID0gJ1wwJzsKICAKISAgICAgY2Jyb2NrLmcg
PSBnbG9iX2luaXQocGF0dGVybiwgR0xPQl9ISUVSQVJDSFl8R0xPQl9JTkJPWENBU0UpOwogICAg
ICBjYnJvY2submFtZXNwYWNlID0gbmFtZXNwYWNlOwogICAgICBjYnJvY2suZG9tYWlubGVuID0g
ZG9tYWlubGVuOwogICAgICBjYnJvY2suaW5ib3hjYXNlID0gZ2xvYl9pbmJveGNhc2UoY2Jyb2Nr
LmcpOwotLS0gMjE0MiwyMTQ4IC0tLS0KICAgICAgZWxzZQogIAlkb21haW5wYXRbMF0gPSAnXDAn
OwogIAohICAgICBjYnJvY2suZyA9IGdsb2JfaW5pdChwYXR0ZXJuLCBuYW1lc3BhY2UtPmhpZXJf
c2VwLCBHTE9CX0hJRVJBUkNIWXxHTE9CX0lOQk9YQ0FTRSk7CiAgICAgIGNicm9jay5uYW1lc3Bh
Y2UgPSBuYW1lc3BhY2U7CiAgICAgIGNicm9jay5kb21haW5sZW4gPSBkb21haW5sZW47CiAgICAg
IGNicm9jay5pbmJveGNhc2UgPSBnbG9iX2luYm94Y2FzZShjYnJvY2suZyk7CioqKioqKioqKioq
KioqKgoqKiogMjIwOCwyMjE5ICoqKioKICAgICAgLyoKICAgICAgICogUGVyc29uYWwgKElOQk9Y
KSBuYW1lc3BhY2UKICAgICAgICoKISAgICAgICogQXBwZW5kIHBhdHRlcm4gdG8gIklOQk9YLiIs
IHNlYXJjaCBmb3IgdGhvc2UgbWFpbGJveGVzIG5leHQKICAgICAgICovCiAgICAgIGlmICh1c2Vy
aWQpIHsKISAJc3RybGNweShwYXRidWYsICJJTkJPWC4iLCBzaXplb2YocGF0YnVmKSk7CiEgCXN0
cmxjYXQocGF0YnVmLCBwYXR0ZXJuLCBzaXplb2YocGF0YnVmKSk7CiEgCWNicm9jay5nID0gZ2xv
Yl9pbml0KHBhdGJ1ZiwgR0xPQl9ISUVSQVJDSFl8R0xPQl9JTkJPWENBU0UpOwogIAljYnJvY2su
aW5ib3hjYXNlID0gZ2xvYl9pbmJveGNhc2UoY2Jyb2NrLmcpOwogIAljYnJvY2suaW5ib3hvZmZz
ZXQgPSBkb21haW5sZW4rdXNlcmxlbjsKICAJY2Jyb2NrLmZpbmRfbmFtZXNwYWNlID0gTkFNRVNQ
QUNFX0lOQk9YOwotLS0gMjIwNCwyMjE0IC0tLS0KICAgICAgLyoKICAgICAgICogUGVyc29uYWwg
KElOQk9YKSBuYW1lc3BhY2UKICAgICAgICoKISAgICAgICogU2VhcmNoIGZvciAiSU5CT1guKiIg
bWFpbGJveGVzIG5leHQKICAgICAgICovCiAgICAgIGlmICh1c2VyaWQpIHsKISAJLyogZG9uJ3Qg
dG91Y2ggdGhlIHBhdHRlcm4hIC8vIHNvcmNlcmVyICovCiEgCWNicm9jay5nID0gZ2xvYl9pbml0
KHBhdHRlcm4sIG5hbWVzcGFjZS0+aGllcl9zZXAsIEdMT0JfSElFUkFSQ0hZfEdMT0JfSU5CT1hD
QVNFKTsKICAJY2Jyb2NrLmluYm94Y2FzZSA9IGdsb2JfaW5ib3hjYXNlKGNicm9jay5nKTsKICAJ
Y2Jyb2NrLmluYm94b2Zmc2V0ID0gZG9tYWlubGVuK3VzZXJsZW47CiAgCWNicm9jay5maW5kX25h
bWVzcGFjZSA9IE5BTUVTUEFDRV9JTkJPWDsKKioqKioqKioqKioqKioqCioqKiAyMjQzLDIyNTkg
KioqKgogIAogICAgICBpZiAoIXN0cm5jbXAobmFtZXNwYWNlLT5wcmVmaXhbTkFNRVNQQUNFX1VT
RVJdLCBwYXR0ZXJuLAogIAkJIHByZWZpeGxlbiA8IGxlbiA/IHByZWZpeGxlbiA6IGxlbikpIHsK
ICAKLSAJaWYgKHByZWZpeGxlbiA8IGxlbikgewotIAkgICAgc3RybGNweShkb21haW5wYXQrZG9t
YWlubGVuLCBwYXR0ZXJuK3ByZWZpeGxlbiwKLSAJCSAgICBzaXplb2YoZG9tYWlucGF0KS1kb21h
aW5sZW4pOwotIAkgICAgY2Jyb2NrLmcgPSBnbG9iX2luaXQoZG9tYWlucGF0LCBHTE9CX0hJRVJB
UkNIWSk7Ci0gCX0KLSAJZWxzZSB7Ci0gCSAgICBzdHJsY3B5KGRvbWFpbnBhdCtkb21haW5sZW4s
ICJ1c2VyIiwgc2l6ZW9mKGRvbWFpbnBhdCktZG9tYWlubGVuKTsKLSAJICAgIHN0cmxjYXQoZG9t
YWlucGF0LCBwYXR0ZXJuK2xlbiwgc2l6ZW9mKGRvbWFpbnBhdCkpOwotIAkgICAgY2Jyb2NrLmcg
PSBnbG9iX2luaXQoZG9tYWlucGF0LCBHTE9CX0hJRVJBUkNIWSk7Ci0gCX0KICAJY2Jyb2NrLmZp
bmRfbmFtZXNwYWNlID0gTkFNRVNQQUNFX1VTRVI7CiAgCWNicm9jay5pbmJveG9mZnNldCA9IDA7
CiAgCQotLS0gMjIzOCwyMjQ3IC0tLS0KICAKICAgICAgaWYgKCFzdHJuY21wKG5hbWVzcGFjZS0+
cHJlZml4W05BTUVTUEFDRV9VU0VSXSwgcGF0dGVybiwKICAJCSBwcmVmaXhsZW4gPCBsZW4gPyBw
cmVmaXhsZW4gOiBsZW4pKSB7CisgCS8qIHdlJ2xsIHNlYXJjaCBmb3IgdGhlIHJlcXVlc3RlZCBw
YXR0ZXJuIGRvbid0IG1ha2luZyBhbnkKKyAJICAgc3R1cGlkIG1vZGlmaWNhdGlvbnMgb2YgaXQg
Ly8gc29yY2VyZXIgKi8KKyAJY2Jyb2NrLmcgPSBnbG9iX2luaXQocGF0dGVybiwgbmFtZXNwYWNl
LT5oaWVyX3NlcCwgR0xPQl9ISUVSQVJDSFkpOwogIAogIAljYnJvY2suZmluZF9uYW1lc3BhY2Ug
PSBOQU1FU1BBQ0VfVVNFUjsKICAJY2Jyb2NrLmluYm94b2Zmc2V0ID0gMDsKICAJCioqKioqKioq
KioqKioqKgoqKiogMjI4NSwyMjk1ICoqKioKICAJICAgIC8qIFNraXAgcGF0dGVybiB3aGljaCBt
YXRjaGVzIHNoYXJlZCBuYW1lc3BhY2UgcHJlZml4ICovCiAgCSAgICBmb3IgKHAgPSBwYXQrcHJl
Zml4bGVuOyAqcDsgcCsrKSB7CiAgCQlpZiAoKnAgPT0gJyUnKSBjb250aW51ZTsKISAJCWVsc2Ug
aWYgKCpwID09ICcuJykgcCsrOwogIAkJYnJlYWs7CiAgCSAgICB9CiAgCiEgCSAgICBpZiAoKnBh
dHRlcm4gJiYgIXN0cmNocihwYXR0ZXJuLCAnLicpICYmCiAgCQlwYXR0ZXJuW3N0cmxlbihwYXR0
ZXJuKS0xXSA9PSAnJScpIHsKICAJCS8qIHNwZWNpYWwgY2FzZTogIExJU1QgIiIgKiUgLS0gb3V0
cHV0IHByZWZpeCAqLwogICAgCQljYnJvY2suY2hlY2tzaGFyZWQgPSAxOwotLS0gMjI3MywyMjgz
IC0tLS0KICAJICAgIC8qIFNraXAgcGF0dGVybiB3aGljaCBtYXRjaGVzIHNoYXJlZCBuYW1lc3Bh
Y2UgcHJlZml4ICovCiAgCSAgICBmb3IgKHAgPSBwYXQrcHJlZml4bGVuOyAqcDsgcCsrKSB7CiAg
CQlpZiAoKnAgPT0gJyUnKSBjb250aW51ZTsKISAJCWVsc2UgaWYgKCpwID09IG5hbWVzcGFjZS0+
aGllcl9zZXApIHArKzsKICAJCWJyZWFrOwogIAkgICAgfQogIAohIAkgICAgaWYgKCpwYXR0ZXJu
ICYmICFzdHJjaHIocGF0dGVybiwgbmFtZXNwYWNlLT5oaWVyX3NlcCkgJiYKICAJCXBhdHRlcm5b
c3RybGVuKHBhdHRlcm4pLTFdID09ICclJykgewogIAkJLyogc3BlY2lhbCBjYXNlOiAgTElTVCAi
IiAqJSAtLSBvdXRwdXQgcHJlZml4ICovCiAgICAJCWNicm9jay5jaGVja3NoYXJlZCA9IDE7Cioq
KioqKioqKioqKioqKgoqKiogMjI5OCwyMzIyICoqKioKICAJICAgIGlmICgoY2Jyb2NrLmNoZWNr
c2hhcmVkIHx8IHByZWZpeGxlbiA9PSBsZW4pICYmICEqcCkgewogIAkJLyogc3BlY2lhbCBjYXNl
OiAgTElTVCAiIiAlIC0tIG91dHB1dCBwcmVmaXgKICAgCQkgICAoaWYgd2UgaGF2ZSBhIHNoYXJl
ZCBtYm94KSBhbmQgcXVpdCAqLwohIAkJc3RybGNweShkb21haW5wYXQrZG9tYWlubGVuLCAiKiIs
IHNpemVvZihkb21haW5wYXQpLWRvbWFpbmxlbik7CiEgCQljYnJvY2suZyA9IGdsb2JfaW5pdChk
b21haW5wYXQsIEdMT0JfSElFUkFSQ0hZKTsKICAJCWNicm9jay5jaGVja3NoYXJlZCA9IDI7CiAg
CSAgICB9CiEgCSAgICBlbHNlIHsKISAJCXN0cmxjcHkoZG9tYWlucGF0K2RvbWFpbmxlbiwgcCwg
c2l6ZW9mKGRvbWFpbnBhdCktZG9tYWlubGVuKTsKISAJCWNicm9jay5nID0gZ2xvYl9pbml0KGRv
bWFpbnBhdCwgR0xPQl9ISUVSQVJDSFkpOwohIAkgICAgfQohIAkJCiAgCSAgICBkb21haW5wYXRb
ZG9tYWlubGVuXSA9ICdcMCc7CiAgCSAgICBEQi0+Zm9yZWFjaChtYmRiLAogIAkJCWRvbWFpbnBh
dCwgZG9tYWlubGVuLAogIAkJCSZmaW5kX3AsICZmaW5kX2NiLCAmY2Jyb2NrLAogIAkJCU5VTEwp
OwogIAl9CiEgCWVsc2UgaWYgKHBhdHRlcm5bbGVuXSA9PSAnLicpIHsKISAJICAgIHN0cmxjcHko
ZG9tYWlucGF0K2RvbWFpbmxlbiwgcGF0dGVybitsZW4rMSwKISAJCSAgICBzaXplb2YoZG9tYWlu
cGF0KS1kb21haW5sZW4pOwohIAkgICAgY2Jyb2NrLmcgPSBnbG9iX2luaXQoZG9tYWlucGF0LCBH
TE9CX0hJRVJBUkNIWSk7CiAgCiAgCSAgICBEQi0+Zm9yZWFjaChtYmRiLAogIAkJCWRvbWFpbnBh
dCwgZG9tYWlubGVuK3ByZWZpeGxlbi0obGVuKzEpLAotLS0gMjI4NiwyMzA2IC0tLS0KICAJICAg
IGlmICgoY2Jyb2NrLmNoZWNrc2hhcmVkIHx8IHByZWZpeGxlbiA9PSBsZW4pICYmICEqcCkgewog
IAkJLyogc3BlY2lhbCBjYXNlOiAgTElTVCAiIiAlIC0tIG91dHB1dCBwcmVmaXgKICAgCQkgICAo
aWYgd2UgaGF2ZSBhIHNoYXJlZCBtYm94KSBhbmQgcXVpdCAqLwohIAkJY2Jyb2NrLmcgPSBnbG9i
X2luaXQoIioiLCBuYW1lc3BhY2UtPmhpZXJfc2VwLCBHTE9CX0hJRVJBUkNIWSk7CiAgCQljYnJv
Y2suY2hlY2tzaGFyZWQgPSAyOwogIAkgICAgfQohIAkgICAgZWxzZQohIAkJY2Jyb2NrLmcgPSBn
bG9iX2luaXQocGF0LCBuYW1lc3BhY2UtPmhpZXJfc2VwLCBHTE9CX0hJRVJBUkNIWSk7CiEgCiAg
CSAgICBkb21haW5wYXRbZG9tYWlubGVuXSA9ICdcMCc7CiAgCSAgICBEQi0+Zm9yZWFjaChtYmRi
LAogIAkJCWRvbWFpbnBhdCwgZG9tYWlubGVuLAogIAkJCSZmaW5kX3AsICZmaW5kX2NiLCAmY2Jy
b2NrLAogIAkJCU5VTEwpOwogIAl9CiEgCWVsc2UgaWYgKHBhdHRlcm5bbGVuXSA9PSBuYW1lc3Bh
Y2UtPmhpZXJfc2VwKSB7CiEgCSAgICBzbnByaW50Zihkb21haW5wYXQrZG9tYWlubGVuLCBzaXpl
b2YoZG9tYWlucGF0KS1kb21haW5sZW4sICIlLipzIiwgcHJlZml4bGVuLShsZW4rMSksIHBhdHRl
cm4rbGVuKzEpOwohIAkgICAgY2Jyb2NrLmcgPSBnbG9iX2luaXQocGF0dGVybiwgbmFtZXNwYWNl
LT5oaWVyX3NlcCwgR0xPQl9ISUVSQVJDSFkpOwogIAogIAkgICAgREItPmZvcmVhY2gobWJkYiwK
ICAJCQlkb21haW5wYXQsIGRvbWFpbmxlbitwcmVmaXhsZW4tKGxlbisxKSwKKioqKioqKioqKioq
KioqCioqKiAyODE2LDI4MjMgKioqKgogICAgICBlbHNlCiAgCXN0cm5jcHkoZG9tYWlucGF0LCBw
YXR0ZXJuLCBzaXplb2YoZG9tYWlucGF0KSk7CiAgCiEgICAgIGNicm9jay5nID0gZ2xvYl9pbml0
KHBhdHRlcm4sIEdMT0JfSElFUkFSQ0hZfEdMT0JfSU5CT1hDQVNFKTsKISAgICAgY2Jyb2NrLm5h
bWVzcGFjZSA9IE5VTEw7CiAgICAgIGNicm9jay5kb21haW5sZW4gPSBkb21haW5sZW47CiAgICAg
IGNicm9jay5pbmJveGNhc2UgPSBnbG9iX2luYm94Y2FzZShjYnJvY2suZyk7CiAgICAgIGNicm9j
ay5pc2FkbWluID0gMTsJCS8qIHVzZXIgY2FuIGFsd2F5cyBzZWUgdGhlaXIgc3VicyAqLwotLS0g
MjgwMCwyODA3IC0tLS0KICAgICAgZWxzZQogIAlzdHJuY3B5KGRvbWFpbnBhdCwgcGF0dGVybiwg
c2l6ZW9mKGRvbWFpbnBhdCkpOwogIAohICAgICBjYnJvY2suZyA9IGdsb2JfaW5pdChwYXR0ZXJu
LCBuYW1lc3BhY2UtPmhpZXJfc2VwLCBHTE9CX0hJRVJBUkNIWXxHTE9CX0lOQk9YQ0FTRSk7CiEg
ICAgIGNicm9jay5uYW1lc3BhY2UgPSBuYW1lc3BhY2U7CiAgICAgIGNicm9jay5kb21haW5sZW4g
PSBkb21haW5sZW47CiAgICAgIGNicm9jay5pbmJveGNhc2UgPSBnbG9iX2luYm94Y2FzZShjYnJv
Y2suZyk7CiAgICAgIGNicm9jay5pc2FkbWluID0gMTsJCS8qIHVzZXIgY2FuIGFsd2F5cyBzZWUg
dGhlaXIgc3VicyAqLwoqKioqKioqKioqKioqKioKKioqIDI4NTcsMjg3MiAqKioqCiAgCSAgICB9
CiAgCSAgICBlbHNlIGlmIChyID09IENZUlVTREJfTk9URk9VTkQpIHIgPSAwOwogIAl9Ci0gCWVs
c2UgaWYgKCFzdHJuY21wKHBhdHRlcm4sCi0gCQkJICB1c2VybWJveG5hbWUrZG9tYWlubGVuLCB1
c2VybWJveG5hbWVsZW4tZG9tYWlubGVuKSAmJgotIAkJIEdMT0JfVEVTVChjYnJvY2suZywgdXNl
cm1ib3huYW1lK2RvbWFpbmxlbikgIT0gLTEpIHsKLSAJICAgIHIgPSBTVUJEQi0+ZmV0Y2goc3Vi
cywgdXNlcm1ib3huYW1lLCB1c2VybWJveG5hbWVsZW4sCi0gCQkJICAgICAmZGF0YSwgJmRhdGFs
ZW4sIE5VTEwpOwotIAkgICAgaWYgKCFyICYmIGRhdGEpIHsKLSAJCXIgPSAoKnByb2MpKHVzZXJt
Ym94bmFtZSwgdXNlcm1ib3huYW1lbGVuLCAxLCByb2NrKTsKLSAJICAgIH0KLSAJICAgIGVsc2Ug
aWYgKHIgPT0gQ1lSVVNEQl9OT1RGT1VORCkgciA9IDA7Ci0gCX0KICAJc3RybGNhdCh1c2VybWJv
eG5hbWUsICIuIiwgc2l6ZW9mKHVzZXJtYm94bmFtZSkpOwogIAl1c2VybWJveG5hbWVsZW4rKzsK
ICAKLS0tIDI4NDEsMjg0NiAtLS0tCioqKioqKioqKioqKioqKgoqKiogMjg4MSwyOTA4ICoqKioK
ICAKICAgICAgLyogRmluZCBmaXhlZC1zdHJpbmcgcGF0dGVybiBwcmVmaXggKi8KICAgICAgZm9y
IChwID0gcGF0OyAqcDsgcCsrKSB7CiEgCWlmICgqcCA9PSAnKicgfHwgKnAgPT0gJyUnIHx8ICpw
ID09ICc/JyB8fCAqcCA9PSAnQCcpIGJyZWFrOwogICAgICB9CiAgICAgIHByZWZpeGxlbiA9IHAg
LSBwYXR0ZXJuOwogICAgICAqcCA9ICdcMCc7CiAgCiAgICAgIC8qCiEgICAgICAqIElmIHVzZXIu
WC4qIG9yIElOQk9YLiogY2FuIG1hdGNoIHBhdHRlcm4sCiAgICAgICAqIHNlYXJjaCBmb3IgdGhv
c2UgbWFpbGJveGVzIG5leHQKICAgICAgICovCiAgICAgIGlmICh1c2VyaWQgJiYKISAJKCFzdHJu
Y21wKHVzZXJtYm94bmFtZStkb21haW5sZW4sIHBhdHRlcm4sIHVzZXJtYm94bmFtZWxlbi1kb21h
aW5sZW4tMSkgfHwKISAJICFzdHJuY2FzZWNtcCgiaW5ib3guIiwgcGF0dGVybiwgcHJlZml4bGVu
IDwgNiA/IHByZWZpeGxlbiA6IDYpKSkgewogIAohIAlpZiAoIXN0cm5jbXAodXNlcm1ib3huYW1l
K2RvbWFpbmxlbiwgcGF0dGVybiwgdXNlcm1ib3huYW1lbGVuLWRvbWFpbmxlbi0xKSkgewohIAkg
ICAgLyogc3dpdGNoIHRvIHBhdHRlcm4gd2l0aCBkb21haW4gcHJlcGVuZGVkICovCiEgCSAgICBn
bG9iX2ZyZWUoJmNicm9jay5nKTsKISAJICAgIGNicm9jay5nID0gZ2xvYl9pbml0KGRvbWFpbnBh
dCwgR0xPQl9ISUVSQVJDSFkpOwohIAkgICAgY2Jyb2NrLmluYm94b2Zmc2V0ID0gMDsKISAJfQoh
IAllbHNlIHsKISAJICAgIGNicm9jay5pbmJveG9mZnNldCA9IHN0cmxlbih1c2VyaWQpOwohIAl9
CiAgCiAgCWNicm9jay5maW5kX25hbWVzcGFjZSA9IE5BTUVTUEFDRV9JTkJPWDsKICAJLyogaXRl
cmF0ZSB0aHJvdWdoIHByZWZpeGVzIG1hdGNoaW5nIHVzZXJtYm94bmFtZSAqLwotLS0gMjg1NSwy
ODc0IC0tLS0KICAKICAgICAgLyogRmluZCBmaXhlZC1zdHJpbmcgcGF0dGVybiBwcmVmaXggKi8K
ICAgICAgZm9yIChwID0gcGF0OyAqcDsgcCsrKSB7CiEgCS8qIHN0b3AgYXQgdGhlIHNlcGFyYXRv
ciB0b28gKi8KISAJaWYgKCpwID09ICcqJyB8fCAqcCA9PSAnJScgfHwgKnAgPT0gJz8nIHx8ICpw
ID09ICdAJyB8fCAqcCA9PSBuYW1lc3BhY2UtPmhpZXJfc2VwKSBicmVhazsKICAgICAgfQogICAg
ICBwcmVmaXhsZW4gPSBwIC0gcGF0dGVybjsKICAgICAgKnAgPSAnXDAnOwogIAogICAgICAvKgoh
ICAgICAgKiBJZiBJTkJPWC4qIGNhbiBtYXRjaCBwYXR0ZXJuLAogICAgICAgKiBzZWFyY2ggZm9y
IHRob3NlIG1haWxib3hlcyBuZXh0CiAgICAgICAqLwogICAgICBpZiAodXNlcmlkICYmCiEgCSAh
c3RybmNhc2VjbXAoImluYm94LiIsIHBhdHRlcm4sIHByZWZpeGxlbiA8IDYgPyBwcmVmaXhsZW4g
OiA2KSkgewogIAohIAljYnJvY2suaW5ib3hvZmZzZXQgPSBkb21haW5sZW4gKyB1c2VybGVuOwog
IAogIAljYnJvY2suZmluZF9uYW1lc3BhY2UgPSBOQU1FU1BBQ0VfSU5CT1g7CiAgCS8qIGl0ZXJh
dGUgdGhyb3VnaCBwcmVmaXhlcyBtYXRjaGluZyB1c2VybWJveG5hbWUgKi8KKioqKioqKioqKioq
KioqCioqKiAyOTIxLDI5MjcgKioqKgogICAgICBjYnJvY2suZmluZF9uYW1lc3BhY2UgPSBOQU1F
U1BBQ0VfVVNFUjsKICAgICAgLyogc3dpdGNoIHRvIHBhdHRlcm4gd2l0aCBkb21haW4gcHJlcGVu
ZGVkICovCiAgICAgIGdsb2JfZnJlZSgmY2Jyb2NrLmcpOwohICAgICBjYnJvY2suZyA9IGdsb2Jf
aW5pdChkb21haW5wYXQsIEdMT0JfSElFUkFSQ0hZKTsKICAgICAgY2Jyb2NrLmluYm94b2Zmc2V0
ID0gMDsKICAgICAgaWYgKHVzZXJtYm94bmFtZWxlbikgewogIAl1c2VybWJveG5hbWVbLS11c2Vy
bWJveG5hbWVsZW5dID0gJ1wwJzsKLS0tIDI4ODcsMjg5MyAtLS0tCiAgICAgIGNicm9jay5maW5k
X25hbWVzcGFjZSA9IE5BTUVTUEFDRV9VU0VSOwogICAgICAvKiBzd2l0Y2ggdG8gcGF0dGVybiB3
aXRoIGRvbWFpbiBwcmVwZW5kZWQgKi8KICAgICAgZ2xvYl9mcmVlKCZjYnJvY2suZyk7CiEgICAg
IGNicm9jay5nID0gZ2xvYl9pbml0KGRvbWFpbnBhdCwgbmFtZXNwYWNlLT5oaWVyX3NlcCwgR0xP
Ql9ISUVSQVJDSFkpOwogICAgICBjYnJvY2suaW5ib3hvZmZzZXQgPSAwOwogICAgICBpZiAodXNl
cm1ib3huYW1lbGVuKSB7CiAgCXVzZXJtYm94bmFtZVstLXVzZXJtYm94bmFtZWxlbl0gPSAnXDAn
OwoqKioqKioqKioqKioqKioKKioqIDI5NjcsMjk3MyAqKioqCiAgICAgIGVsc2UKICAJZG9tYWlu
cGF0WzBdID0gJ1wwJzsKICAKISAgICAgY2Jyb2NrLmcgPSBnbG9iX2luaXQocGF0dGVybiwgR0xP
Ql9ISUVSQVJDSFl8R0xPQl9JTkJPWENBU0UpOwogICAgICBjYnJvY2submFtZXNwYWNlID0gbmFt
ZXNwYWNlOwogICAgICBjYnJvY2suZG9tYWlubGVuID0gZG9tYWlubGVuOwogICAgICBjYnJvY2su
aW5ib3hjYXNlID0gZ2xvYl9pbmJveGNhc2UoY2Jyb2NrLmcpOwotLS0gMjkzMywyOTM5IC0tLS0K
ICAgICAgZWxzZQogIAlkb21haW5wYXRbMF0gPSAnXDAnOwogIAohICAgICBjYnJvY2suZyA9IGds
b2JfaW5pdChwYXR0ZXJuLCBuYW1lc3BhY2UtPmhpZXJfc2VwLCBHTE9CX0hJRVJBUkNIWXxHTE9C
X0lOQk9YQ0FTRSk7CiAgICAgIGNicm9jay5uYW1lc3BhY2UgPSBuYW1lc3BhY2U7CiAgICAgIGNi
cm9jay5kb21haW5sZW4gPSBkb21haW5sZW47CiAgICAgIGNicm9jay5pbmJveGNhc2UgPSBnbG9i
X2luYm94Y2FzZShjYnJvY2suZyk7CioqKioqKioqKioqKioqKgoqKiogMzAzNCwzMDQyICoqKioK
ICAgICAgICogQXBwZW5kIHBhdHRlcm4gdG8gIklOQk9YLiIsIHNlYXJjaCBmb3IgdGhvc2Ugc3Vi
c2NyaXB0aW9ucyBuZXh0CiAgICAgICAqLwogICAgICBpZiAodXNlcmlkKSB7CiEgCXN0cmxjcHko
cGF0YnVmLCAiSU5CT1guIiwgc2l6ZW9mKHBhdGJ1ZikpOwohIAlzdHJsY2F0KHBhdGJ1ZiwgcGF0
dGVybiwgc2l6ZW9mKHBhdGJ1ZikpOwohIAljYnJvY2suZyA9IGdsb2JfaW5pdChwYXRidWYsIEdM
T0JfSElFUkFSQ0hZfEdMT0JfSU5CT1hDQVNFKTsKICAJY2Jyb2NrLmluYm94Y2FzZSA9IGdsb2Jf
aW5ib3hjYXNlKGNicm9jay5nKTsKICAJY2Jyb2NrLmluYm94b2Zmc2V0ID0gZG9tYWlubGVuK3Vz
ZXJsZW47CiAgCWNicm9jay5maW5kX25hbWVzcGFjZSA9IE5BTUVTUEFDRV9JTkJPWDsKLS0tIDMw
MDAsMzAwNyAtLS0tCiAgICAgICAqIEFwcGVuZCBwYXR0ZXJuIHRvICJJTkJPWC4iLCBzZWFyY2gg
Zm9yIHRob3NlIHN1YnNjcmlwdGlvbnMgbmV4dAogICAgICAgKi8KICAgICAgaWYgKHVzZXJpZCkg
ewohIAkvKiBkb24ndCB0b3VjaCB0aGUgcGF0dGVybiEgKi8KISAJY2Jyb2NrLmcgPSBnbG9iX2lu
aXQocGF0dGVybiwgbmFtZXNwYWNlLT5oaWVyX3NlcCwgR0xPQl9ISUVSQVJDSFl8R0xPQl9JTkJP
WENBU0UpOwogIAljYnJvY2suaW5ib3hjYXNlID0gZ2xvYl9pbmJveGNhc2UoY2Jyb2NrLmcpOwog
IAljYnJvY2suaW5ib3hvZmZzZXQgPSBkb21haW5sZW4rdXNlcmxlbjsKICAJY2Jyb2NrLmZpbmRf
bmFtZXNwYWNlID0gTkFNRVNQQUNFX0lOQk9YOwoqKioqKioqKioqKioqKioKKioqIDMwNzIsMzA4
OCAqKioqCiAgICAgIGlmICghc3RybmNtcChuYW1lc3BhY2UtPnByZWZpeFtOQU1FU1BBQ0VfVVNF
Ul0sIHBhdHRlcm4sCiAgCQkgcHJlZml4bGVuIDwgbGVuID8gcHJlZml4bGVuIDogbGVuKSkgewog
IAohIAlpZiAocHJlZml4bGVuIDwgbGVuKSB7CiEgCSAgICBzdHJsY3B5KGRvbWFpbnBhdCtkb21h
aW5sZW4sIHBhdHRlcm4rcHJlZml4bGVuLAohIAkJICAgIHNpemVvZihkb21haW5wYXQpLWRvbWFp
bmxlbik7CiEgCSAgICBjYnJvY2suZyA9IGdsb2JfaW5pdChkb21haW5wYXQsIEdMT0JfSElFUkFS
Q0hZKTsKISAJfQohIAllbHNlIHsKISAJICAgIHN0cmxjcHkoZG9tYWlucGF0K2RvbWFpbmxlbiwg
InVzZXIiLAohIAkJICAgc2l6ZW9mKGRvbWFpbnBhdCktZG9tYWlubGVuKTsKISAJICAgIHN0cmxj
YXQoZG9tYWlucGF0LCBwYXR0ZXJuK2xlbiwgc2l6ZW9mKGRvbWFpbnBhdCkpOwohIAkgICAgY2Jy
b2NrLmcgPSBnbG9iX2luaXQoZG9tYWlucGF0LCBHTE9CX0hJRVJBUkNIWSk7CiEgCX0KICAJY2Jy
b2NrLmZpbmRfbmFtZXNwYWNlID0gTkFNRVNQQUNFX1VTRVI7CiAgCWNicm9jay5pbmJveG9mZnNl
dCA9IDA7CiAgCQotLS0gMzAzNywzMDQ0IC0tLS0KICAgICAgaWYgKCFzdHJuY21wKG5hbWVzcGFj
ZS0+cHJlZml4W05BTUVTUEFDRV9VU0VSXSwgcGF0dGVybiwKICAJCSBwcmVmaXhsZW4gPCBsZW4g
PyBwcmVmaXhsZW4gOiBsZW4pKSB7CiAgCiEgCS8qIGRvbid0IHRvdWNoIHRoZSBwYXR0ZXJuISAq
LwohIAljYnJvY2suZyA9IGdsb2JfaW5pdChwYXR0ZXJuLCBuYW1lc3BhY2UtPmhpZXJfc2VwLCBH
TE9CX0hJRVJBUkNIWSk7CiAgCWNicm9jay5maW5kX25hbWVzcGFjZSA9IE5BTUVTUEFDRV9VU0VS
OwogIAljYnJvY2suaW5ib3hvZmZzZXQgPSAwOwogIAkKKioqKioqKioqKioqKioqCioqKiAzMTE0
LDMxMjQgKioqKgogIAkgICAgLyogU2tpcCBwYXR0ZXJuIHdoaWNoIG1hdGNoZXMgc2hhcmVkIG5h
bWVzcGFjZSBwcmVmaXggKi8KICAJICAgIGZvciAocCA9IHBhdCtwcmVmaXhsZW47ICpwOyBwKysp
IHsKICAJCWlmICgqcCA9PSAnJScpIGNvbnRpbnVlOwohIAkJZWxzZSBpZiAoKnAgPT0gJy4nKSBw
Kys7CiAgCQlicmVhazsKICAJICAgIH0KICAKISAJICAgIGlmICgqcGF0dGVybiAmJiAhc3RyY2hy
KHBhdHRlcm4sICcuJykgJiYKICAJCXBhdHRlcm5bc3RybGVuKHBhdHRlcm4pLTFdID09ICclJykg
ewogIAkJLyogc3BlY2lhbCBjYXNlOiAgTFNVQiAiIiAqJSAtLSBvdXRwdXQgcHJlZml4ICovCiAg
ICAJCWNicm9jay5jaGVja3NoYXJlZCA9IDE7Ci0tLSAzMDcwLDMwODAgLS0tLQogIAkgICAgLyog
U2tpcCBwYXR0ZXJuIHdoaWNoIG1hdGNoZXMgc2hhcmVkIG5hbWVzcGFjZSBwcmVmaXggKi8KICAJ
ICAgIGZvciAocCA9IHBhdCtwcmVmaXhsZW47ICpwOyBwKyspIHsKICAJCWlmICgqcCA9PSAnJScp
IGNvbnRpbnVlOwohIAkJZWxzZSBpZiAoKnAgPT0gbmFtZXNwYWNlLT5oaWVyX3NlcCkgcCsrOwog
IAkJYnJlYWs7CiAgCSAgICB9CiAgCiEgCSAgICBpZiAoKnBhdHRlcm4gJiYgIXN0cmNocihwYXR0
ZXJuLCBuYW1lc3BhY2UtPmhpZXJfc2VwKSAmJgogIAkJcGF0dGVybltzdHJsZW4ocGF0dGVybikt
MV0gPT0gJyUnKSB7CiAgCQkvKiBzcGVjaWFsIGNhc2U6ICBMU1VCICIiIColIC0tIG91dHB1dCBw
cmVmaXggKi8KICAgIAkJY2Jyb2NrLmNoZWNrc2hhcmVkID0gMTsKKioqKioqKioqKioqKioqCioq
KiAzMTI3LDMxNDAgKioqKgogIAkgICAgaWYgKChjYnJvY2suY2hlY2tzaGFyZWQgfHwgcHJlZml4
bGVuID09IGxlbikgJiYgISpwKSB7CiAgCQkvKiBzcGVjaWFsIGNhc2U6ICBMU1VCICIiICUgLS0g
b3V0cHV0IHByZWZpeAogIAkJICAgKGlmIHdlIGhhdmUgYSBzaGFyZWQgbWJveCkgYW5kIHF1aXQg
Ki8KISAJCXN0cmxjcHkoZG9tYWlucGF0K2RvbWFpbmxlbiwgIioiLCBzaXplb2YoZG9tYWlucGF0
KS1kb21haW5sZW4pOwohIAkJY2Jyb2NrLmcgPSBnbG9iX2luaXQoZG9tYWlucGF0LCBHTE9CX0hJ
RVJBUkNIWSk7CiAgCQljYnJvY2suY2hlY2tzaGFyZWQgPSAyOwogIAkgICAgfQohIAkgICAgZWxz
ZSB7CiEgCQlzdHJsY3B5KGRvbWFpbnBhdCtkb21haW5sZW4sIHAsIHNpemVvZihkb21haW5wYXQp
LWRvbWFpbmxlbik7CiEgCQljYnJvY2suZyA9IGdsb2JfaW5pdChkb21haW5wYXQsIEdMT0JfSElF
UkFSQ0hZKTsKISAJICAgIH0KICAKICAJICAgIGRvbWFpbnBhdFtkb21haW5sZW5dID0gJ1wwJzsK
ICAJICAgIFNVQkRCLT5mb3JlYWNoKHN1YnMsCi0tLSAzMDgzLDMwOTMgLS0tLQogIAkgICAgaWYg
KChjYnJvY2suY2hlY2tzaGFyZWQgfHwgcHJlZml4bGVuID09IGxlbikgJiYgISpwKSB7CiAgCQkv
KiBzcGVjaWFsIGNhc2U6ICBMU1VCICIiICUgLS0gb3V0cHV0IHByZWZpeAogIAkJICAgKGlmIHdl
IGhhdmUgYSBzaGFyZWQgbWJveCkgYW5kIHF1aXQgKi8KISAJCWNicm9jay5nID0gZ2xvYl9pbml0
KCIqIiwgbmFtZXNwYWNlLT5oaWVyX3NlcCwgR0xPQl9ISUVSQVJDSFkpOwogIAkJY2Jyb2NrLmNo
ZWNrc2hhcmVkID0gMjsKICAJICAgIH0KISAJICAgIGVsc2UKISAJCWNicm9jay5nID0gZ2xvYl9p
bml0KHBhdCwgbmFtZXNwYWNlLT5oaWVyX3NlcCwgR0xPQl9ISUVSQVJDSFkpOwogIAogIAkgICAg
ZG9tYWlucGF0W2RvbWFpbmxlbl0gPSAnXDAnOwogIAkgICAgU1VCREItPmZvcmVhY2goc3VicywK
KioqKioqKioqKioqKioqCioqKiAzMTQyLDMxNTEgKioqKgogIAkJCSAgICZmaW5kX3AsICZmaW5k
X2NiLCAmY2Jyb2NrLAogIAkJCSAgIE5VTEwpOwogIAl9CiEgCWVsc2UgaWYgKHBhdHRlcm5bbGVu
XSA9PSAnLicpIHsKISAJICAgIHN0cmxjcHkoZG9tYWlucGF0K2RvbWFpbmxlbiwgcGF0dGVybits
ZW4rMSwKISAJCSAgICBzaXplb2YoZG9tYWlucGF0KS1kb21haW5sZW4pOwohIAkgICAgY2Jyb2Nr
LmcgPSBnbG9iX2luaXQoZG9tYWlucGF0LCBHTE9CX0hJRVJBUkNIWSk7CiAgCiAgCSAgICBTVUJE
Qi0+Zm9yZWFjaChzdWJzLAogIAkJCSAgIGRvbWFpbnBhdCwgZG9tYWlubGVuK3ByZWZpeGxlbi0o
bGVuKzEpLAotLS0gMzA5NSwzMTAzIC0tLS0KICAJCQkgICAmZmluZF9wLCAmZmluZF9jYiwgJmNi
cm9jaywKICAJCQkgICBOVUxMKTsKICAJfQohIAllbHNlIGlmIChwYXR0ZXJuW2xlbl0gPT0gbmFt
ZXNwYWNlLT5oaWVyX3NlcCkgewohIAkgICAgc25wcmludGYoZG9tYWlucGF0K2RvbWFpbmxlbiwg
c2l6ZW9mKGRvbWFpbnBhdCktZG9tYWlubGVuLCAiJS4qcyIsIHByZWZpeGxlbi0obGVuKzEpLCBw
YXR0ZXJuK2xlbisxKTsKISAJICAgIGNicm9jay5nID0gZ2xvYl9pbml0KHBhdHRlcm4sIG5hbWVz
cGFjZS0+aGllcl9zZXAsIEdMT0JfSElFUkFSQ0hZKTsKICAKICAJICAgIFNVQkRCLT5mb3JlYWNo
KHN1YnMsCiAgCQkJICAgZG9tYWlucGF0LCBkb21haW5sZW4rcHJlZml4bGVuLShsZW4rMSksCmRp
ZmYgLUMgMyAtciBjeXJ1cy1pbWFwZC0yLjIuMTIuc3VwZXJvbGQvaW1hcC9tYm94bmFtZS5jIGN5
cnVzLWltYXBkLTIuMi4xMi5vbGQvaW1hcC9tYm94bmFtZS5jCioqKiBjeXJ1cy1pbWFwZC0yLjIu
MTIuc3VwZXJvbGQvaW1hcC9tYm94bmFtZS5jCTIwMDUtMDItMTQgMDk6Mzk6NTcgKzAzMDAKLS0t
IGN5cnVzLWltYXBkLTIuMi4xMi5vbGQvaW1hcC9tYm94bmFtZS5jCTIwMDUtMTAtMzEgMTU6Mzg6
MzggKzAzMDAKKioqKioqKioqKioqKioqCioqKiA5NiwxMDEgKioqKgotLS0gOTYsMTA4IC0tLS0K
ICAjZGVmaW5lIENIQVJNT0Q2NChjKSAgKGluZGV4X21vZDY0Wyh1bnNpZ25lZCBjaGFyKShjKV0p
CiAgCiAgCisgc3RhdGljIGludCBtYm94bmFtZV9jaGVja19oaWVyc2VwcyhzdHJ1Y3QgbmFtZXNw
YWNlICpuYW1lc3BhY2UsIGNvbnN0IGNoYXIgKm5hbWUsIGludCBuYW1lbGVuKQorIHsKKyAgICAg
aWYobmFtZXNwYWNlLT5oaWVyX3NlcCA9PSAnLycgJiYgbWVtY2hyKG5hbWUsIERPVENIQVIsIG5h
bWVsZW4pKQorIAlyZXR1cm4gLTE7CisgICAgIHJldHVybiAwOworIH0KKyAKICAvKgogICAqIENv
bnZlcnQgdGhlIGV4dGVybmFsIG1haWxib3ggJ25hbWUnIHRvIGFuIGludGVybmFsIG5hbWUuCiAg
ICogSWYgJ3VzZXJpZCcgaXMgbm9uLW51bGwsIGl0IGlzIHRoZSBuYW1lIG9mIHRoZSBjdXJyZW50
IHVzZXIuCioqKioqKioqKioqKioqKgoqKiogMTE2LDEyMSAqKioqCi0tLSAxMjMsMTMxIC0tLS0K
ICAgICAgdXNlcmxlbiA9IHVzZXJpZCA/IHN0cmxlbih1c2VyaWQpIDogMDsKICAgICAgbmFtZWxl
biA9IHN0cmxlbihuYW1lKTsKICAKKyAgICAgaWYobWJveG5hbWVfY2hlY2tfaGllcnNlcHMobmFt
ZXNwYWNlLCBuYW1lLCBuYW1lbGVuKSkKKyAJcmV0dXJuIElNQVBfTUFJTEJPWF9CQUROQU1FOwor
IAogICAgICBpZiAoY29uZmlnX3ZpcnRkb21haW5zKSB7CiAgCWlmICh1c2VyaWQgJiYgKGNwID0g
c3RycmNocih1c2VyaWQsICdAJykpKSB7CiAgCSAgICAvKiB1c2VyIGxvZ2dlZCBpbiBhcyB1c2Vy
QGRvbWFpbiAqLwoqKioqKioqKioqKioqKioKKioqIDIwNiwyMTEgKioqKgotLS0gMjE2LDIyNCAt
LS0tCiAgICAgIHVzZXJsZW4gPSB1c2VyaWQgPyBzdHJsZW4odXNlcmlkKSA6IDA7CiAgICAgIG5h
bWVsZW4gPSBzdHJsZW4obmFtZSk7CiAgCisgICAgIGlmKG1ib3huYW1lX2NoZWNrX2hpZXJzZXBz
KG5hbWVzcGFjZSwgbmFtZSwgbmFtZWxlbikpCisgCXJldHVybiBJTUFQX01BSUxCT1hfQkFETkFN
RTsKKyAKICAgICAgaWYgKGNvbmZpZ192aXJ0ZG9tYWlucykgewogIAlpZiAodXNlcmlkICYmIChj
cCA9IHN0cmNocih1c2VyaWQsICdAJykpKSB7CiAgCSAgICAvKiB1c2VyIGxvZ2dlZCBpbiBhcyB1
c2VyQGRvbWFpbiAqLwoqKioqKioqKioqKioqKioKKioqIDY2NCw2NzAgKioqKgogIAogICAgICBp
ZiAoc3RybGVuKG5hbWUpID4gTUFYX01BSUxCT1hfTkFNRSkgcmV0dXJuIElNQVBfTUFJTEJPWF9C
QUROQU1FOwogICAgICBmb3IgKGkgPSAwOyBpIDwgTlVNX0JBRE1CT1hQQVRURVJOUzsgaSsrKSB7
CiEgCWcgPSBnbG9iX2luaXQoYmFkbWJveHBhdHRlcm5zW2ldLCAwKTsKICAJaWYgKEdMT0JfVEVT
VChnLCBuYW1lKSAhPSAtMSkgewogIAkgICAgZ2xvYl9mcmVlKCZnKTsKICAJICAgIHJldHVybiBJ
TUFQX01BSUxCT1hfQkFETkFNRTsKLS0tIDY3Nyw2ODMgLS0tLQogIAogICAgICBpZiAoc3RybGVu
KG5hbWUpID4gTUFYX01BSUxCT1hfTkFNRSkgcmV0dXJuIElNQVBfTUFJTEJPWF9CQUROQU1FOwog
ICAgICBmb3IgKGkgPSAwOyBpIDwgTlVNX0JBRE1CT1hQQVRURVJOUzsgaSsrKSB7CiEgCWcgPSBn
bG9iX2luaXQoYmFkbWJveHBhdHRlcm5zW2ldLCB1bml4c2VwPycvJzonLicsIDApOwogIAlpZiAo
R0xPQl9URVNUKGcsIG5hbWUpICE9IC0xKSB7CiAgCSAgICBnbG9iX2ZyZWUoJmcpOwogIAkgICAg
cmV0dXJuIElNQVBfTUFJTEJPWF9CQUROQU1FOwpkaWZmIC1DIDMgLXIgY3lydXMtaW1hcGQtMi4y
LjEyLnN1cGVyb2xkL2xpYi9nbG9iLmMgY3lydXMtaW1hcGQtMi4yLjEyLm9sZC9saWIvZ2xvYi5j
CioqKiBjeXJ1cy1pbWFwZC0yLjIuMTIuc3VwZXJvbGQvbGliL2dsb2IuYwkyMDAzLTEyLTA4IDIz
OjU3OjEzICswMzAwCi0tLSBjeXJ1cy1pbWFwZC0yLjIuMTIub2xkL2xpYi9nbG9iLmMJMjAwNS0x
MC0zMSAxNTozODozOSArMDMwMAoqKioqKioqKioqKioqKioKKioqIDY3LDc0ICoqKioKICAgKiAg
IDQpICcqJyBlYXRzIGFsbCAnKidzIGFuZCAnJSdzIGNvbm5lY3RlZCBieSBhbnkgd2lsZGNhcmQK
ICAgKiAgIDUpICclJyBlYXRzIGFsbCBhZGphY2VudCAnJSdzCiAgICovCiEgZ2xvYiAqZ2xvYl9p
bml0X3N1cHByZXNzIChzdHIsIGZsYWdzLCBzdXBwcmVzcykKICAgICAgY29uc3QgY2hhciAqc3Ry
OwogICAgICBpbnQgZmxhZ3M7CiAgICAgIGNvbnN0IGNoYXIgKnN1cHByZXNzOwogIHsKLS0tIDY3
LDc1IC0tLS0KICAgKiAgIDQpICcqJyBlYXRzIGFsbCAnKidzIGFuZCAnJSdzIGNvbm5lY3RlZCBi
eSBhbnkgd2lsZGNhcmQKICAgKiAgIDUpICclJyBlYXRzIGFsbCBhZGphY2VudCAnJSdzCiAgICov
CiEgZ2xvYiAqZ2xvYl9pbml0X3N1cHByZXNzIChzdHIsIHNlcF9jaGFyLCBmbGFncywgc3VwcHJl
c3MpCiAgICAgIGNvbnN0IGNoYXIgKnN0cjsKKyAgICAgY2hhciBzZXBfY2hhcjsKICAgICAgaW50
IGZsYWdzOwogICAgICBjb25zdCBjaGFyICpzdXBwcmVzczsKICB7CioqKioqKioqKioqKioqKgoq
KiogODEsODcgKioqKgogICAgICBnID0gKGdsb2IgKikgeG1hbGxvYyhzaXplb2YgKGdsb2IpICsg
c2xlbiArIHN0cmxlbihzdHIpICsgMSk7CiAgICAgIGlmIChnICE9IDApIHsKICAgICAgICAgIHN0
cmNweShnLT5pbmJveCwgaW5ib3gpOwohIAlnLT5zZXBfY2hhciA9ICcuJzsKICAJZHN0ID0gZy0+
c3RyOwogIAkvKiBpZiB3ZSdyZSBkb2luZyBhIHN1YnN0cmluZyBtYXRjaCwgcHV0IGEgJyonIHBy
ZWZpeCAoMSkgKi8KICAJaWYgKGZsYWdzICYgR0xPQl9TVUJTVFJJTkcpIHsKLS0tIDgyLDg4IC0t
LS0KICAgICAgZyA9IChnbG9iICopIHhtYWxsb2Moc2l6ZW9mIChnbG9iKSArIHNsZW4gKyBzdHJs
ZW4oc3RyKSArIDEpOwogICAgICBpZiAoZyAhPSAwKSB7CiAgICAgICAgICBzdHJjcHkoZy0+aW5i
b3gsIGluYm94KTsKISAJZy0+c2VwX2NoYXIgPSBzZXBfY2hhcjsKICAJZHN0ID0gZy0+c3RyOwog
IAkvKiBpZiB3ZSdyZSBkb2luZyBhIHN1YnN0cmluZyBtYXRjaCwgcHV0IGEgJyonIHByZWZpeCAo
MSkgKi8KICAJaWYgKGZsYWdzICYgR0xPQl9TVUJTVFJJTkcpIHsKKioqKioqKioqKioqKioqCioq
KiAyODQsMzEyICoqKioKICAJCS8qIGxvb2sgZm9yIGEgbWF0Y2ggd2l0aCBmaXJzdCBjaGFyIGZv
bGxvd2luZyAnJScsCiAgCQkgKiBzdG9wIGF0IGEgc2VwX2NoYXIgdW5sZXNzIHdlJ3JlIGRvaW5n
ICIqJSIKICAJCSAqLwohIAkJcHRyID0gcGhpZXI7CiEgCQl3aGlsZSAocHRyICE9IHBlbmQgJiYg
KmdoaWVyICE9ICpwdHIKISAJCSAgICAgICAmJiAoKnB0ciAhPSBnLT5zZXBfY2hhciB8fAogIAkJ
CSAgICghKmdoaWVyICYmIGdzdGFyICYmICpnc3RhciA9PSAnJScgJiYgbWluCiEgCQkJICAgICYm
IHB0ciAtIHN0YXJ0IDwgKm1pbikpKSB7CiEgCQkgICAgKytwdHI7CiAgCQl9CiEgCQlpZiAocHRy
ID09IHBlbmQpIHsKICAJCSAgICBncHRyID0gZ2hpZXI7CiAgCQkgICAgYnJlYWs7CiAgCQl9CiEg
CQlpZiAoKnB0ciA9PSBnLT5zZXBfY2hhcikgewogIAkJICAgIGlmICghKmdoaWVyICYmIG1pbgoh
IAkJCSYmICptaW4gPCBwdHIgLSBzdGFydCAmJiBwdHIgIT0gcGVuZAohIAkJCSYmICpwdHIgPT0g
Zy0+c2VwX2NoYXIKISAJCQkpIHsKISAJCQkqbWluID0gZ3N0YXIgPyBwdHIgLSBzdGFydCArIDEg
OiAtMTsKISAJCQlyZXR1cm4gKHB0ciAtIHN0YXJ0KTsKICAJCSAgICB9CiAgCQkgICAgZ2hpZXIg
PSBOVUxMOwogIAkJICAgIHNlcGZvdW5kID0gMTsKICAJCX0gZWxzZSB7CiEgCQkgICAgcGhpZXIg
PSArK3B0cjsKICAJCSAgICBncHRyID0gZ2hpZXIgKyAxOwogIAkJfQogIAkgICAgfQotLS0gMjg1
LDMxMSAtLS0tCiAgCQkvKiBsb29rIGZvciBhIG1hdGNoIHdpdGggZmlyc3QgY2hhciBmb2xsb3dp
bmcgJyUnLAogIAkJICogc3RvcCBhdCBhIHNlcF9jaGFyIHVubGVzcyB3ZSdyZSBkb2luZyAiKiUi
CiAgCQkgKi8KISAJCXdoaWxlIChwaGllciAhPSBwZW5kICYmICpnaGllciAhPSAqcGhpZXIKISAJ
CSAgICAgICAmJiAoKnBoaWVyICE9IGctPnNlcF9jaGFyIHx8CiAgCQkJICAgKCEqZ2hpZXIgJiYg
Z3N0YXIgJiYgKmdzdGFyID09ICclJyAmJiBtaW4KISAJCQkgICAgJiYgcGhpZXIgLSBzdGFydCA8
ICptaW4pKSkgewohIAkJICAgICsrcGhpZXI7CiAgCQl9CiEgCQlpZiAocGhpZXIgPT0gcGVuZCkg
ewogIAkJICAgIGdwdHIgPSBnaGllcjsKKyAJCSAgICBwdHIgPSBwaGllcjsKICAJCSAgICBicmVh
azsKICAJCX0KISAJCWlmICgqZ2hpZXIgIT0gKnBoaWVyICYmICpwaGllciA9PSBnLT5zZXBfY2hh
cikgewogIAkJICAgIGlmICghKmdoaWVyICYmIG1pbgohIAkJCSYmICptaW4gPCBwaGllciAtIHN0
YXJ0ICYmIHBoaWVyICE9IHBlbmQpIHsKISAJCQkqbWluID0gZ3N0YXIgPyBwaGllciAtIHN0YXJ0
ICsgMSA6IC0xOwohIAkJCXJldHVybiAocGhpZXIgLSBzdGFydCk7CiAgCQkgICAgfQogIAkJICAg
IGdoaWVyID0gTlVMTDsKICAJCSAgICBzZXBmb3VuZCA9IDE7CiAgCQl9IGVsc2UgewohIAkJICAg
IHB0ciA9ICsrcGhpZXI7CiAgCQkgICAgZ3B0ciA9IGdoaWVyICsgMTsKICAJCX0KICAJICAgIH0K
KioqKioqKioqKioqKioqCioqKiAzNzYsNDA0ICoqKioKICAJCS8qIGxvb2sgZm9yIGEgbWF0Y2gg
d2l0aCBmaXJzdCBjaGFyIGZvbGxvd2luZyAnJScsCiAgCQkgKiBzdG9wIGF0IGEgc2VwX2NoYXIg
dW5sZXNzIHdlJ3JlIGRvaW5nICIqJSIKICAJCSAqLwohIAkJcHRyID0gcGhpZXI7CiEgCQl3aGls
ZSAocHRyICE9IHBlbmQgJiYgKHVuc2lnbmVkIGNoYXIpICpnaGllciAhPSBUT0xPV0VSKCpwdHIp
CiEgCQkgICAgICAgJiYgKCpwdHIgIT0gZy0+c2VwX2NoYXIgfHwKICAJCQkgICAoISpnaGllciAm
JiBnc3RhciAmJiAqZ3N0YXIgPT0gJyUnICYmIG1pbgohIAkJCSAgICAmJiBwdHIgLSBzdGFydCA8
ICptaW4pKSkgewohIAkJICAgICsrcHRyOwogIAkJfQohIAkJaWYgKHB0ciA9PSBwZW5kKSB7CiAg
CQkgICAgZ3B0ciA9IGdoaWVyOwogIAkJICAgIGJyZWFrOwogIAkJfQohIAkJaWYgKCpwdHIgPT0g
Zy0+c2VwX2NoYXIpIHsKICAJCSAgICBpZiAoISpnaGllciAmJiBtaW4KISAJCQkmJiAqbWluIDwg
cHRyIC0gc3RhcnQgJiYgcHRyICE9IHBlbmQKISAJCQkmJiAqcHRyID09IGctPnNlcF9jaGFyCiEg
CQkJKSB7CiEgCQkJKm1pbiA9IGdzdGFyID8gcHRyIC0gc3RhcnQgKyAxIDogLTE7CiEgCQkJcmV0
dXJuIChwdHIgLSBzdGFydCk7CiAgCQkgICAgfQogIAkJICAgIGdoaWVyID0gTlVMTDsKICAJCSAg
ICBzZXBmb3VuZCA9IDE7CiAgCQl9IGVsc2UgewohIAkJICAgIHBoaWVyID0gKytwdHI7CiAgCQkg
ICAgZ3B0ciA9IGdoaWVyICsgMTsKICAJCX0KICAJICAgIH0KLS0tIDM3NSw0MDEgLS0tLQogIAkJ
LyogbG9vayBmb3IgYSBtYXRjaCB3aXRoIGZpcnN0IGNoYXIgZm9sbG93aW5nICclJywKICAJCSAq
IHN0b3AgYXQgYSBzZXBfY2hhciB1bmxlc3Mgd2UncmUgZG9pbmcgIiolIgogIAkJICovCiEgCQl3
aGlsZSAocGhpZXIgIT0gcGVuZCAmJiAodW5zaWduZWQgY2hhcikgKmdoaWVyICE9IFRPTE9XRVIo
KnBoaWVyKQohIAkJICAgICAgICYmICgqcGhpZXIgIT0gZy0+c2VwX2NoYXIgfHwKICAJCQkgICAo
ISpnaGllciAmJiBnc3RhciAmJiAqZ3N0YXIgPT0gJyUnICYmIG1pbgohIAkJCSAgICAmJiBwaGll
ciAtIHN0YXJ0IDwgKm1pbikpKSB7CiEgCQkgICAgKytwaGllcjsKICAJCX0KISAJCWlmIChwaGll
ciA9PSBwZW5kKSB7CiAgCQkgICAgZ3B0ciA9IGdoaWVyOworIAkJICAgIHB0ciA9IHBoaWVyOwog
IAkJICAgIGJyZWFrOwogIAkJfQohIAkJaWYgKCpnaGllciAhPSAqcGhpZXIgJiYgKnBoaWVyID09
IGctPnNlcF9jaGFyKSB7CiAgCQkgICAgaWYgKCEqZ2hpZXIgJiYgbWluCiEgCQkJJiYgKm1pbiA8
IHBoaWVyIC0gc3RhcnQgJiYgcGhpZXIgIT0gcGVuZCkgewohIAkJCSptaW4gPSBnc3RhciA/IHBo
aWVyIC0gc3RhcnQgKyAxIDogLTE7CiEgCQkJcmV0dXJuIChwaGllciAtIHN0YXJ0KTsKICAJCSAg
ICB9CiAgCQkgICAgZ2hpZXIgPSBOVUxMOwogIAkJICAgIHNlcGZvdW5kID0gMTsKICAJCX0gZWxz
ZSB7CiEgCQkgICAgcHRyID0gKytwaGllcjsKICAJCSAgICBncHRyID0gZ2hpZXIgKyAxOwogIAkJ
fQogIAkgICAgfQpkaWZmIC1DIDMgLXIgY3lydXMtaW1hcGQtMi4yLjEyLnN1cGVyb2xkL2xpYi9n
bG9iLmggY3lydXMtaW1hcGQtMi4yLjEyLm9sZC9saWIvZ2xvYi5oCioqKiBjeXJ1cy1pbWFwZC0y
LjIuMTIuc3VwZXJvbGQvbGliL2dsb2IuaAkyMDAzLTAyLTEzIDIzOjE1OjQwICswMzAwCi0tLSBj
eXJ1cy1pbWFwZC0yLjIuMTIub2xkL2xpYi9nbG9iLmgJMjAwNS0xMC0zMSAxNTozODozOSArMDMw
MAoqKioqKioqKioqKioqKioKKioqIDc4LDg0ICoqKioKICAgKiAgZmxhZ3MgICAgLS0gc2VlIGZs
YWcgdmFsdWVzIGFib3ZlCiAgICogIHN1cHByZXNzIC0tIHByZWZpeCB0byBzdXBwcmVzcwogICAq
LwohIGV4dGVybiBnbG9iICpnbG9iX2luaXRfc3VwcHJlc3MgUCgoY29uc3QgY2hhciAqc3RyLCBp
bnQgZmxhZ3MsCiAgCQkJCSAgIGNvbnN0IGNoYXIgKnN1cHByZXNzKSk7CiAgCiAgLyogZnJlZSBh
IGdsb2Igc3RydWN0dXJlCi0tLSA3OCw4NCAtLS0tCiAgICogIGZsYWdzICAgIC0tIHNlZSBmbGFn
IHZhbHVlcyBhYm92ZQogICAqICBzdXBwcmVzcyAtLSBwcmVmaXggdG8gc3VwcHJlc3MKICAgKi8K
ISBleHRlcm4gZ2xvYiAqZ2xvYl9pbml0X3N1cHByZXNzIFAoKGNvbnN0IGNoYXIgKnN0ciwgY2hh
ciBzZXBfY2hhciwgaW50IGZsYWdzLAogIAkJCQkgICBjb25zdCBjaGFyICpzdXBwcmVzcykpOwog
IAogIC8qIGZyZWUgYSBnbG9iIHN0cnVjdHVyZQoqKioqKioqKioqKioqKioKKioqIDk3LDEwMyAq
KioqCiAgZXh0ZXJuIGludCBnbG9iX3Rlc3QgUCgoZ2xvYiAqZywgY29uc3QgY2hhciAqc3RyLCBs
b25nIGxlbiwgbG9uZyAqbWluKSk7CiAgCiAgLyogbWFjcm9zICovCiEgI2RlZmluZSBnbG9iX2lu
aXQoc3RyLCBmbGFncykgZ2xvYl9pbml0X3N1cHByZXNzKChzdHIpLCAoZmxhZ3MpLCBOVUxMKQog
ICNkZWZpbmUgZ2xvYl9pbmJveGNhc2UoZykgKChnKS0+aW5ib3gpCiAgI2RlZmluZSBHTE9CX1RF
U1QoZywgc3RyKSBnbG9iX3Rlc3QoKGcpLCAoc3RyKSwgMCwgTlVMTCkKICAjZGVmaW5lIEdMT0Jf
U0VUX1NFUEFSQVRPUihnLCBjKSAoKGcpLT5zZXBfY2hhciA9IChjKSkKLS0tIDk3LDEwMyAtLS0t
CiAgZXh0ZXJuIGludCBnbG9iX3Rlc3QgUCgoZ2xvYiAqZywgY29uc3QgY2hhciAqc3RyLCBsb25n
IGxlbiwgbG9uZyAqbWluKSk7CiAgCiAgLyogbWFjcm9zICovCiEgI2RlZmluZSBnbG9iX2luaXQo
c3RyLCBzZXBfY2hhciwgZmxhZ3MpIGdsb2JfaW5pdF9zdXBwcmVzcygoc3RyKSwgKHNlcF9jaGFy
KSwgKGZsYWdzKSwgTlVMTCkKICAjZGVmaW5lIGdsb2JfaW5ib3hjYXNlKGcpICgoZyktPmluYm94
KQogICNkZWZpbmUgR0xPQl9URVNUKGcsIHN0cikgZ2xvYl90ZXN0KChnKSwgKHN0ciksIDAsIE5V
TEwpCiAgI2RlZmluZSBHTE9CX1NFVF9TRVBBUkFUT1IoZywgYykgKChnKS0+c2VwX2NoYXIgPSAo
YykpCg==
</data>        

          </attachment>
          <attachment
              isobsolete="1"
              ispatch="1"
              isprivate="0"
          >
            <attachid>398</attachid>
            <date>2005-11-15 04:10 EDT</date>
            <desc>Update</desc>
            <filename>cyrus-imapd-bugs-2.2.12.patch</filename>
            <type>text/plain</type>
            <size>71215</size>
            <attacher>dzal_mail@mtu-net.ru</attacher>
            
              <data encoding="base64">ZGlmZiAtQyAzIC1yIGN5cnVzLWltYXBkLTIuMi4xMi5vcmlnL2ltYXAvYW5ub3RhdGUuYyBjeXJ1
cy1pbWFwZC0yLjIuMTIvaW1hcC9hbm5vdGF0ZS5jCioqKiBjeXJ1cy1pbWFwZC0yLjIuMTIub3Jp
Zy9pbWFwL2Fubm90YXRlLmMJMjAwNS0wMi0xNCAwOTozOTo1NCArMDMwMAotLS0gY3lydXMtaW1h
cGQtMi4yLjEyL2ltYXAvYW5ub3RhdGUuYwkyMDA1LTExLTA3IDE4OjEyOjMyICswMzAwCioqKioq
KioqKioqKioqKgoqKiogMzczLDM4MSAqKioqCiAgICAgIGludCBrZXlsZW4sIHI7CiAgICAgIHN0
cnVjdCBmaW5kX3JvY2sgZnJvY2s7CiAgCiEgICAgIGZyb2NrLm1nbG9iID0gZ2xvYl9pbml0KG1h
aWxib3gsIEdMT0JfSElFUkFSQ0hZKTsKISAgICAgZnJvY2suZWdsb2IgPSBnbG9iX2luaXQoZW50
cnksIEdMT0JfSElFUkFSQ0hZKTsKISAgICAgR0xPQl9TRVRfU0VQQVJBVE9SKGZyb2NrLmVnbG9i
LCAnLycpOwogICAgICBmcm9jay5wcm9jID0gcHJvYzsKICAgICAgZnJvY2sucm9jayA9IHJvY2s7
CiAgCi0tLSAzNzMsMzgxIC0tLS0KICAgICAgaW50IGtleWxlbiwgcjsKICAgICAgc3RydWN0IGZp
bmRfcm9jayBmcm9jazsKICAKISAgICAgLyogY2FuJ3QgdW5kZXJzdGFuZCBpdCB5ZXQgLS0gc29y
Y2VyZXIgKi8KISAgICAgZnJvY2subWdsb2IgPSBnbG9iX2luaXQobWFpbGJveCwgJy4nLCBHTE9C
X0hJRVJBUkNIWSk7CiEgICAgIGZyb2NrLmVnbG9iID0gZ2xvYl9pbml0KGVudHJ5LCAnLycsIEdM
T0JfSElFUkFSQ0hZKTsKICAgICAgZnJvY2sucHJvYyA9IHByb2M7CiAgICAgIGZyb2NrLnJvY2sg
PSByb2NrOwogIAoqKioqKioqKioqKioqKioKKioqIDEwMjIsMTAyOCAqKioqCiAgICAgIHdoaWxl
IChhKSB7CiAgCWludCBhdHRyaWJjb3VudDsKICAKISAJZyA9IGdsb2JfaW5pdChhLT5zLCBHTE9C
X0hJRVJBUkNIWSk7CiAgCQogIAlmb3IgKGF0dHJpYmNvdW50ID0gMDsKICAJICAgICBhbm5vdGF0
aW9uX2F0dHJpYnV0ZXNbYXR0cmliY291bnRdLm5hbWU7Ci0tLSAxMDIyLDEwMjggLS0tLQogICAg
ICB3aGlsZSAoYSkgewogIAlpbnQgYXR0cmliY291bnQ7CiAgCiEgCWcgPSBnbG9iX2luaXQoYS0+
cywgJy4nLCBHTE9CX0hJRVJBUkNIWSk7CiAgCQogIAlmb3IgKGF0dHJpYmNvdW50ID0gMDsKICAJ
ICAgICBhbm5vdGF0aW9uX2F0dHJpYnV0ZXNbYXR0cmliY291bnRdLm5hbWU7CioqKioqKioqKioq
KioqKgoqKiogMTA1NSwxMDYyICoqKioKICAJaW50IGVudHJ5Y291bnQ7CiAgCWludCBjaGVja19k
YiA9IDA7IC8qIHNob3VsZCB3ZSBjaGVjayB0aGUgZGIgZm9yIHRoaXMgZW50cnk/ICovCiAgCiEg
CWcgPSBnbG9iX2luaXQoZS0+cywgR0xPQl9ISUVSQVJDSFkpOwohIAlHTE9CX1NFVF9TRVBBUkFU
T1IoZywgJy8nKTsKICAKICAJZm9yIChlbnRyeWNvdW50ID0gMDsKICAJICAgICBub25fZGJfZW50
cmllc1tlbnRyeWNvdW50XS5uYW1lOwotLS0gMTA1NSwxMDYxIC0tLS0KICAJaW50IGVudHJ5Y291
bnQ7CiAgCWludCBjaGVja19kYiA9IDA7IC8qIHNob3VsZCB3ZSBjaGVjayB0aGUgZGIgZm9yIHRo
aXMgZW50cnk/ICovCiAgCiEgCWcgPSBnbG9iX2luaXQoZS0+cywgJy8nLCBHTE9CX0hJRVJBUkNI
WSk7CiAgCiAgCWZvciAoZW50cnljb3VudCA9IDA7CiAgCSAgICAgbm9uX2RiX2VudHJpZXNbZW50
cnljb3VudF0ubmFtZTsKZGlmZiAtQyAzIC1yIGN5cnVzLWltYXBkLTIuMi4xMi5vcmlnL2ltYXAv
Y2hrX2N5cnVzLmMgY3lydXMtaW1hcGQtMi4yLjEyL2ltYXAvY2hrX2N5cnVzLmMKKioqIGN5cnVz
LWltYXBkLTIuMi4xMi5vcmlnL2ltYXAvY2hrX2N5cnVzLmMJMjAwNC0wOC0wNCAxNzowMzoxMiAr
MDQwMAotLS0gY3lydXMtaW1hcGQtMi4yLjEyL2ltYXAvY2hrX2N5cnVzLmMJMjAwNS0xMS0wNyAx
ODoxMjozMiArMDMwMAoqKioqKioqKioqKioqKioKKioqIDIyMywyMjggKioqKgotLS0gMjIzLDIz
MiAtLS0tCiAgCiAgICAgIGN5cnVzX2luaXQoYWx0X2NvbmZpZywgImNoa19jeXJ1cyIsIDApOwog
IAorICAgICBpZihtYm94bmFtZV9pbml0X25hbWVzcGFjZV9leHQoJmludGVybmFsX25hbWVzcGFj
ZSwKKyAJCQkJICAgMCwgJy4nLCAwKSkKKyAJZnByaW50ZihzdGRlcnIsICJDYW5ub3QgaW5pdGlh
bGl6ZSB0aGUgaW50ZXJuYWwgbmFtZXNwYWNlXG4iKTsKKyAKICAgICAgbWJveGxpc3RfaW5pdCgw
KTsKICAgICAgbWJveGxpc3Rfb3BlbihOVUxMKTsKICAKKioqKioqKioqKioqKioqCioqKiAyMzQs
MjQwICoqKioKICAJCShjaGVja19wYXJ0ID8gY2hlY2tfcGFydCA6ICJBTEwgUEFSVElUSU9OUyIp
KTsKICAJCiAgCS8qIGJ1aWxkIGEgbGlzdCBvZiBtYWlsYm94ZXMgLSB3ZSdyZSB1c2luZyBpbnRl
cm5hbCBuYW1lcyBoZXJlICovCiEgCW1ib3hsaXN0X2ZpbmRhbGwoTlVMTCwgcGF0dGVybiwgMSwg
TlVMTCwKICAJCQkgTlVMTCwgY2hrbWJveCwgTlVMTCk7CiAgICAgIH0KICAgICAgCi0tLSAyMzgs
MjQ0IC0tLS0KICAJCShjaGVja19wYXJ0ID8gY2hlY2tfcGFydCA6ICJBTEwgUEFSVElUSU9OUyIp
KTsKICAJCiAgCS8qIGJ1aWxkIGEgbGlzdCBvZiBtYWlsYm94ZXMgLSB3ZSdyZSB1c2luZyBpbnRl
cm5hbCBuYW1lcyBoZXJlICovCiEgCW1ib3hsaXN0X2ZpbmRhbGwoJmludGVybmFsX25hbWVzcGFj
ZSwgcGF0dGVybiwgMSwgTlVMTCwKICAJCQkgTlVMTCwgY2hrbWJveCwgTlVMTCk7CiAgICAgIH0K
ICAgICAgCmRpZmYgLUMgMyAtciBjeXJ1cy1pbWFwZC0yLjIuMTIub3JpZy9pbWFwL2N0bF9jeXJ1
c2RiLmMgY3lydXMtaW1hcGQtMi4yLjEyL2ltYXAvY3RsX2N5cnVzZGIuYwoqKiogY3lydXMtaW1h
cGQtMi4yLjEyLm9yaWcvaW1hcC9jdGxfY3lydXNkYi5jCTIwMDUtMTEtMDcgMTg6MDU6MzEgKzAz
MDAKLS0tIGN5cnVzLWltYXBkLTIuMi4xMi9pbWFwL2N0bF9jeXJ1c2RiLmMJMjAwNS0xMS0wNyAx
ODoxMjozMiArMDMwMAoqKioqKioqKioqKioqKioKKioqIDE2NCwxNzAgKioqKgogICAgICBhbm5v
dGF0ZW1vcmVfb3BlbihOVUxMKTsKICAKICAgICAgLyogYnVpbGQgYSBsaXN0IG9mIG1haWxib3hl
cyAtIHdlJ3JlIHVzaW5nIGludGVybmFsIG5hbWVzIGhlcmUgKi8KISAgICAgbWJveGxpc3RfZmlu
ZGFsbChOVUxMLCBwYXR0ZXJuLCAxLCBOVUxMLAogIAkJICAgICBOVUxMLCBmaXhtYm94LCBOVUxM
KTsKICAKICAgICAgYW5ub3RhdGVtb3JlX2Nsb3NlKCk7Ci0tLSAxNjQsMTcwIC0tLS0KICAgICAg
YW5ub3RhdGVtb3JlX29wZW4oTlVMTCk7CiAgCiAgICAgIC8qIGJ1aWxkIGEgbGlzdCBvZiBtYWls
Ym94ZXMgLSB3ZSdyZSB1c2luZyBpbnRlcm5hbCBuYW1lcyBoZXJlICovCiEgICAgIG1ib3hsaXN0
X2ZpbmRhbGwoJmludGVybmFsX25hbWVzcGFjZSwgcGF0dGVybiwgMSwgTlVMTCwKICAJCSAgICAg
TlVMTCwgZml4bWJveCwgTlVMTCk7CiAgCiAgICAgIGFubm90YXRlbW9yZV9jbG9zZSgpOwoqKioq
KioqKioqKioqKioKKioqIDIyNiwyMzEgKioqKgotLS0gMjI2LDIzNSAtLS0tCiAgCiAgICAgIGN5
cnVzX2luaXQoYWx0X2NvbmZpZywgImN0bF9jeXJ1c2RiIiwgMCk7CiAgCisgICAgIGlmKG1ib3hu
YW1lX2luaXRfbmFtZXNwYWNlX2V4dCgmaW50ZXJuYWxfbmFtZXNwYWNlLAorIAkJCQkgICAwLCAn
LicsIDApKQorIAlmcHJpbnRmKHN0ZGVyciwgIkNhbm5vdCBpbml0aWFsaXplIHRoZSBpbnRlcm5h
bCBuYW1lc3BhY2VcbiIpOworIAogICAgICAvKiBjcmVhdGUgdGhlIG5hbWUgb2YgdGhlIGRiIGRp
cmVjdG9yeSAqLwogICAgICAvKiAodXNlZCBieSBiYWNrdXAgZGlyZWN0b3J5IG5hbWVzKSAqLwog
ICAgICBzdHJjcHkoZGlybmFtZSwgY29uZmlnX2Rpcik7CmRpZmYgLUMgMyAtciBjeXJ1cy1pbWFw
ZC0yLjIuMTIub3JpZy9pbWFwL2N5cl9leHBpcmUuYyBjeXJ1cy1pbWFwZC0yLjIuMTIvaW1hcC9j
eXJfZXhwaXJlLmMKKioqIGN5cnVzLWltYXBkLTIuMi4xMi5vcmlnL2ltYXAvY3lyX2V4cGlyZS5j
CTIwMDQtMDUtMjIgMDc6NDU6NDggKzA0MDAKLS0tIGN5cnVzLWltYXBkLTIuMi4xMi9pbWFwL2N5
cl9leHBpcmUuYwkyMDA1LTExLTA3IDE4OjEyOjMzICswMzAwCioqKioqKioqKioqKioqKgoqKiog
MjMyLDIzNyAqKioqCi0tLSAyMzIsMjQxIC0tLS0KICAKICAgICAgY3lydXNfaW5pdChhbHRfY29u
ZmlnLCAiY3lyX2V4cGlyZSIsIDApOwogIAorICAgICBpZihtYm94bmFtZV9pbml0X25hbWVzcGFj
ZV9leHQoJmludGVybmFsX25hbWVzcGFjZSwKKyAJCQkJICAgMCwgJy4nLCAwKSkKKyAJZnByaW50
ZihzdGRlcnIsICJDYW5ub3QgaW5pdGlhbGl6ZSB0aGUgaW50ZXJuYWwgbmFtZXNwYWNlXG4iKTsK
KyAKICAgICAgYW5ub3RhdGVtb3JlX2luaXQoMCwgTlVMTCwgTlVMTCk7CiAgICAgIGFubm90YXRl
bW9yZV9vcGVuKE5VTEwpOwogIAoqKioqKioqKioqKioqKioKKioqIDI1MiwyNTggKioqKgogICAg
ICBjb25zdHJ1Y3RfaGFzaF90YWJsZSgmZXhwaXJlX3RhYmxlLCAxMDAwMCwgMSk7CiAgCiAgICAg
IHN0cmxjcHkoYnVmLCAiKiIsIHNpemVvZihidWYpKTsKISAgICAgbWJveGxpc3RfZmluZGFsbChO
VUxMLCBidWYsIDEsIDAsIDAsICZidWlsZF90YWJsZSwgJmV4cGlyZV90YWJsZSk7CiAgCiAgICAg
IHIgPSBkdXBsaWNhdGVfcHJ1bmUoZGF5cywgJmV4cGlyZV90YWJsZSk7CiAgCi0tLSAyNTYsMjYy
IC0tLS0KICAgICAgY29uc3RydWN0X2hhc2hfdGFibGUoJmV4cGlyZV90YWJsZSwgMTAwMDAsIDEp
OwogIAogICAgICBzdHJsY3B5KGJ1ZiwgIioiLCBzaXplb2YoYnVmKSk7CiEgICAgIG1ib3hsaXN0
X2ZpbmRhbGwoJmludGVybmFsX25hbWVzcGFjZSwgYnVmLCAxLCAwLCAwLCAmYnVpbGRfdGFibGUs
ICZleHBpcmVfdGFibGUpOwogIAogICAgICByID0gZHVwbGljYXRlX3BydW5lKGRheXMsICZleHBp
cmVfdGFibGUpOwogIApkaWZmIC1DIDMgLXIgY3lydXMtaW1hcGQtMi4yLjEyLm9yaWcvaW1hcC9p
bWFwZC5jIGN5cnVzLWltYXBkLTIuMi4xMi9pbWFwL2ltYXBkLmMKKioqIGN5cnVzLWltYXBkLTIu
Mi4xMi5vcmlnL2ltYXAvaW1hcGQuYwkyMDA1LTExLTA3IDE4OjA1OjM2ICswMzAwCi0tLSBjeXJ1
cy1pbWFwZC0yLjIuMTIvaW1hcC9pbWFwZC5jCTIwMDUtMTEtMDcgMTg6MTI6MzMgKzAzMDAKKioq
KioqKioqKioqKioqCioqKiA1NDcsNTUyICoqKioKLS0tIDU0Nyw1NTcgLS0tLQogIAkgICAgIEVD
X0NPTkZJRyk7CiAgICAgIH0KICAKKyAgICAgLyogaW5pdGlhbGl6ZSB0aGUgaW50ZXJuYWwgbmFt
ZXNwYWNlIHN0cnVjdHVyZSAqLworICAgICBpZihtYm94bmFtZV9pbml0X25hbWVzcGFjZV9leHQo
JmludGVybmFsX25hbWVzcGFjZSwKKyAJCQkJICAgMCwgJy4nLCAwKSkKKyAJZmF0YWwoImNhbm5v
dCBpbml0aWFsaXplIHRoZSBpbnRlcm5hbCBuYW1lc3BhY2UiLCBFQ19URU1QRkFJTCk7CisgCiAg
ICAgIC8qIG9wZW4gdGhlIG1ib3hsaXN0LCB3ZSdsbCBuZWVkIGl0IGZvciByZWFsIHdvcmsgKi8K
ICAgICAgbWJveGxpc3RfaW5pdCgwKTsKICAgICAgbWJveGxpc3Rfb3BlbihOVUxMKTsKKioqKioq
KioqKioqKioqCioqKiAxNjkzLDE2OTggKioqKgotLS0gMTY5OCwxNzE0IC0tLS0KICAgICAgfQog
IH0KICAKKyBzdGF0aWMgdm9pZCB1c2VyaWRfdG9pbnRlcm5hbChzdHJ1Y3QgbmFtZXNwYWNlICpu
YW1lc3BhY2UsIGNoYXIgKnVzZXJpZCkKKyB7CisgICAgIGNoYXIgaGllcnNlcF9vcmlnID0gbmFt
ZXNwYWNlLT5oaWVyX3NlcDsKKyAKKyAgICAgbmFtZXNwYWNlLT5oaWVyX3NlcD0nLyc7CisgICAg
IG1ib3huYW1lX2hpZXJzZXBfdG9pbnRlcm5hbChuYW1lc3BhY2UsIHVzZXJpZCwKKyAJCQkJY29u
ZmlnX3ZpcnRkb21haW5zID8KKyAJCQkJc3RyY3Nwbih1c2VyaWQsICJAIikgOiAwKTsKKyAgICAg
bmFtZXNwYWNlLT5oaWVyX3NlcD1oaWVyc2VwX29yaWc7CisgfQorIAogIC8qCiAgICogQXV0b2Ny
ZWF0ZSBJbmJveCBhbmQgc3ViZm9sZGVycyB1cG9uIGxvZ2luCiAgICovCioqKioqKioqKioqKioq
KgoqKiogMTg4MCwxODg4ICoqKioKICAgICAgfQogIAogICAgICAvKiBUcmFuc2xhdGUgYW55IHNl
cGFyYXRvcnMgaW4gdXNlcmlkICovCiEgICAgIG1ib3huYW1lX2hpZXJzZXBfdG9pbnRlcm5hbCgm
aW1hcGRfbmFtZXNwYWNlLCBpbWFwZF91c2VyaWQsCiEgCQkJCWNvbmZpZ192aXJ0ZG9tYWlucyA/
CiEgCQkJCXN0cmNzcG4oaW1hcGRfdXNlcmlkLCAiQCIpIDogMCk7CiAgCiAgICAgIGZyZWVidWYo
JnBhc3N3ZGJ1Zik7CiAgCi0tLSAxODk2LDE5MDIgLS0tLQogICAgICB9CiAgCiAgICAgIC8qIFRy
YW5zbGF0ZSBhbnkgc2VwYXJhdG9ycyBpbiB1c2VyaWQgKi8KISAgICAgdXNlcmlkX3RvaW50ZXJu
YWwoJmltYXBkX25hbWVzcGFjZSwgaW1hcGRfdXNlcmlkKTsKICAKICAgICAgZnJlZWJ1ZigmcGFz
c3dkYnVmKTsKICAKKioqKioqKioqKioqKioqCioqKiAyMDI5LDIwMzcgKioqKgogICAgICB9CiAg
CiAgICAgIC8qIFRyYW5zbGF0ZSBhbnkgc2VwYXJhdG9ycyBpbiB1c2VyaWQgKi8KISAgICAgbWJv
eG5hbWVfaGllcnNlcF90b2ludGVybmFsKCZpbWFwZF9uYW1lc3BhY2UsIGltYXBkX3VzZXJpZCwK
ISAJCQkJY29uZmlnX3ZpcnRkb21haW5zID8KISAJCQkJc3RyY3NwbihpbWFwZF91c2VyaWQsICJA
IikgOiAwKTsKICAKICAgICAgYXV0b2NyZWF0ZV9pbmJveCgpOwogIAotLS0gMjA0MywyMDQ5IC0t
LS0KICAgICAgfQogIAogICAgICAvKiBUcmFuc2xhdGUgYW55IHNlcGFyYXRvcnMgaW4gdXNlcmlk
ICovCiEgICAgIHVzZXJpZF90b2ludGVybmFsKCZpbWFwZF9uYW1lc3BhY2UsIGltYXBkX3VzZXJp
ZCk7CiAgCiAgICAgIGF1dG9jcmVhdGVfaW5ib3goKTsKICAKKioqKioqKioqKioqKioqCioqKiAz
NzY0LDM3NzkgKioqKgogIH0JCiAgCiAgLyogQ2FsbGJhY2sgZm9yIHVzZSBieSBjbWRfZGVsZXRl
ICovCiAgc3RhdGljIGludCBkZWxtYm94KGNoYXIgKm5hbWUsCiAgCQkgICBpbnQgbWF0Y2hsZW4g
X19hdHRyaWJ1dGVfXygodW51c2VkKSksCiAgCQkgICBpbnQgbWF5Y3JlYXRlIF9fYXR0cmlidXRl
X18oKHVudXNlZCkpLAogIAkJICAgdm9pZCAqcm9jayBfX2F0dHJpYnV0ZV9fKCh1bnVzZWQpKSkK
ICB7CiAgICAgIGludCByOwogIAohICAgICByID0gbWJveGxpc3RfZGVsZXRlbWFpbGJveChuYW1l
LCBpbWFwZF91c2VyaXNhZG1pbiwKISAJCQkgICAgICAgaW1hcGRfdXNlcmlkLCBpbWFwZF9hdXRo
c3RhdGUsCiEgCQkJICAgICAgIDAsIDAsIDAsIDEpOwogICAgICAKICAgICAgaWYocikgewogIAlw
cm90X3ByaW50ZihpbWFwZF9vdXQsICIqIE5PIGRlbGV0ZSAlczogJXNcclxuIiwKLS0tIDM3NzYs
Mzc5NyAtLS0tCiAgfQkKICAKICAvKiBDYWxsYmFjayBmb3IgdXNlIGJ5IGNtZF9kZWxldGUgKi8K
KyAvKiBuYW1lIGlzIGFuIGV4dGVybmFsIG5hbWUgKi8KICBzdGF0aWMgaW50IGRlbG1ib3goY2hh
ciAqbmFtZSwKICAJCSAgIGludCBtYXRjaGxlbiBfX2F0dHJpYnV0ZV9fKCh1bnVzZWQpKSwKICAJ
CSAgIGludCBtYXljcmVhdGUgX19hdHRyaWJ1dGVfXygodW51c2VkKSksCiAgCQkgICB2b2lkICpy
b2NrIF9fYXR0cmlidXRlX18oKHVudXNlZCkpKQogIHsKICAgICAgaW50IHI7CisgICAgIGNoYXIg
aW50bmFtZVtNQVhfTUFJTEJPWF9OQU1FKzFdOworIAorICAgICByID0gKCppbWFwZF9uYW1lc3Bh
Y2UubWJveG5hbWVfdG9pbnRlcm5hbCkoJmltYXBkX25hbWVzcGFjZSwgbmFtZSwKKyAJCQkJCSAg
ICAgICBpbWFwZF91c2VyaWQsIGludG5hbWUpOwogIAohICAgICBpZighcikKISAJciA9IG1ib3hs
aXN0X2RlbGV0ZW1haWxib3goaW50bmFtZSwgaW1hcGRfdXNlcmlzYWRtaW4sCiEgCQkJCSAgIGlt
YXBkX3VzZXJpZCwgaW1hcGRfYXV0aHN0YXRlLAohIAkJCQkgICAwLCAwLCAwLCAxKTsKICAgICAg
CiAgICAgIGlmKHIpIHsKICAJcHJvdF9wcmludGYoaW1hcGRfb3V0LCAiKiBOTyBkZWxldGUgJXM6
ICVzXHJcbiIsCioqKioqKioqKioqKioqKgoqKiogMzgxNiwzODMxICoqKioKICAgICAgaWYgKCFy
ICYmICFsb2NhbG9ubHkgJiYKICAJIXN0cm5jbXAobWFpbGJveG5hbWUrZG9tYWlubGVuLCAidXNl
ci4iLCA1KSAmJgogIAkhc3RyY2hyKG1haWxib3huYW1lK2RvbWFpbmxlbis1LCAnLicpKSB7CiAg
IAlpbnQgbWFpbGJveG5hbWVfbGVuID0gc3RybGVuKG1haWxib3huYW1lKTsKICAKICAgCS8qIElm
IHdlIGFyZW4ndCB0b28gY2xvc2UgdG8gTUFYX01BSUxCT1hfTkFNRSwgYXBwZW5kIC4qICovCiEg
IAlwID0gbWFpbGJveG5hbWUgKyBtYWlsYm94bmFtZV9sZW47IC8qIGVuZCBvZiBtYWlsYm94bmFt
ZSAqLwohICAJaWYgKG1haWxib3huYW1lX2xlbiA8IHNpemVvZihtYWlsYm94bmFtZSkgLSAzKSB7
CiEgIAkgICAgc3RyY3B5KHAsICIuKiIpOwohICAJfQogIAkKISAJLyogYnVpbGQgYSBsaXN0IG9m
IG1haWxib3hlcyAtIHdlJ3JlIHVzaW5nIGludGVybmFsIG5hbWVzIGhlcmUgKi8KISAJbWJveGxp
c3RfZmluZGFsbChOVUxMLCBtYWlsYm94bmFtZSwgaW1hcGRfdXNlcmlzYWRtaW4sIGltYXBkX3Vz
ZXJpZCwKICAJCQkgaW1hcGRfYXV0aHN0YXRlLCBkZWxtYm94LCBOVUxMKTsKICAKICAJLyogdGFr
ZSBjYXJlIG9mIGRlbGV0aW5nIEFDTHMsIHN1YnNjcmlwdGlvbnMsIHNlZW4gc3RhdGUgYW5kIHF1
b3RhcyAqLwotLS0gMzgzNCwzODU2IC0tLS0KICAgICAgaWYgKCFyICYmICFsb2NhbG9ubHkgJiYK
ICAJIXN0cm5jbXAobWFpbGJveG5hbWUrZG9tYWlubGVuLCAidXNlci4iLCA1KSAmJgogIAkhc3Ry
Y2hyKG1haWxib3huYW1lK2RvbWFpbmxlbis1LCAnLicpKSB7CisgCWNoYXIgbmFtZV9jb3B5W01B
WF9NQUlMQk9YX05BTUUrMV07CisgIAlpbnQgbmFtZV9sZW4gPSBzdHJsZW4obmFtZSk7CiAgIAlp
bnQgbWFpbGJveG5hbWVfbGVuID0gc3RybGVuKG1haWxib3huYW1lKTsKICAKKyAJbWVtY3B5KG5h
bWVfY29weSwgbmFtZSwgbmFtZV9sZW4pOwogICAJLyogSWYgd2UgYXJlbid0IHRvbyBjbG9zZSB0
byBNQVhfTUFJTEJPWF9OQU1FLCBhcHBlbmQgLiogKi8KISAgCXAgPSBuYW1lX2NvcHkgKyBuYW1l
X2xlbjsgLyogZW5kIG9mIG5hbWUgKi8KISAgCWlmIChuYW1lX2xlbiA8IHNpemVvZihuYW1lX2Nv
cHkpIC0gMykgewohIAkgICAgKnA9aW1hcGRfbmFtZXNwYWNlLmhpZXJfc2VwOwohIAkgICAgcFsx
XT0nKic7CiEgCSAgICBwWzJdPTA7CiEgCX0KISAJZWxzZQohIAkgICAgKnA9MDsKICAJCiEgCS8q
IGJ1aWxkIGEgbGlzdCBvZiBtYWlsYm94ZXMgLSB3ZSdyZSB1c2luZyBleHRlcm5hbCBuYW1lcyBo
ZXJlICovCiEgCW1ib3hsaXN0X2ZpbmRhbGwoJmltYXBkX25hbWVzcGFjZSwgbmFtZV9jb3B5LCBp
bWFwZF91c2VyaXNhZG1pbiwgaW1hcGRfdXNlcmlkLAogIAkJCSBpbWFwZF9hdXRoc3RhdGUsIGRl
bG1ib3gsIE5VTEwpOwogIAogIAkvKiB0YWtlIGNhcmUgb2YgZGVsZXRpbmcgQUNMcywgc3Vic2Ny
aXB0aW9ucywgc2VlbiBzdGF0ZSBhbmQgcXVvdGFzICovCioqKioqKioqKioqKioqKgoqKiogMzg2
NywzODc5ICoqKioKICB9OwogIAogIC8qIENhbGxiYWNrIGZvciB1c2UgYnkgY21kX3JlbmFtZSAq
LwogIHN0YXRpYyBpbnQgcmVubWJveChjaGFyICpuYW1lLAogIAkJICAgaW50IG1hdGNobGVuIF9f
YXR0cmlidXRlX18oKHVudXNlZCkpLAogIAkJICAgaW50IG1heWNyZWF0ZSBfX2F0dHJpYnV0ZV9f
KCh1bnVzZWQpKSwKICAJCSAgIHZvaWQgKnJvY2spCiAgewohICAgICBjaGFyIG9sZGV4dG5hbWVb
TUFYX01BSUxCT1hfTkFNRSsxXTsKISAgICAgY2hhciBuZXdleHRuYW1lW01BWF9NQUlMQk9YX05B
TUUrMV07CiAgICAgIHN0cnVjdCByZW5yb2NrICp0ZXh0ID0gKHN0cnVjdCByZW5yb2NrICopcm9j
azsKICAgICAgaW50IHI7CiAgCi0tLSAzODkyLDM5MDUgLS0tLQogIH07CiAgCiAgLyogQ2FsbGJh
Y2sgZm9yIHVzZSBieSBjbWRfcmVuYW1lICovCisgLyogJ25hbWUnIGlzIGFuIGV4dGVybmFsIG1h
aWxib3ggbmFtZSEgKi8KICBzdGF0aWMgaW50IHJlbm1ib3goY2hhciAqbmFtZSwKICAJCSAgIGlu
dCBtYXRjaGxlbiBfX2F0dHJpYnV0ZV9fKCh1bnVzZWQpKSwKICAJCSAgIGludCBtYXljcmVhdGUg
X19hdHRyaWJ1dGVfXygodW51c2VkKSksCiAgCQkgICB2b2lkICpyb2NrKQogIHsKISAgICAgY2hh
ciBvbGRpbnRuYW1lW01BWF9NQUlMQk9YX05BTUUrMV07CiEgICAgIGNoYXIgbmV3aW50bmFtZVtN
QVhfTUFJTEJPWF9OQU1FKzFdOwogICAgICBzdHJ1Y3QgcmVucm9jayAqdGV4dCA9IChzdHJ1Y3Qg
cmVucm9jayAqKXJvY2s7CiAgICAgIGludCByOwogIAoqKioqKioqKioqKioqKioKKioqIDM4ODIs
MzkxNyAqKioqCiAgCiAgICAgIHN0cmNweSh0ZXh0LT5uZXdtYWlsYm94bmFtZSArIHRleHQtPm5s
LCBuYW1lICsgdGV4dC0+b2wpOwogIAohICAgICByID0gbWJveGxpc3RfcmVuYW1lbWFpbGJveChu
YW1lLCB0ZXh0LT5uZXdtYWlsYm94bmFtZSwKICAJCQkgICAgICAgdGV4dC0+cGFydGl0aW9uLAog
IAkJCSAgICAgICAxLCBpbWFwZF91c2VyaWQsIGltYXBkX2F1dGhzdGF0ZSk7CiAgICAgIAotICAg
ICAoKmltYXBkX25hbWVzcGFjZS5tYm94bmFtZV90b2V4dGVybmFsKSgmaW1hcGRfbmFtZXNwYWNl
LAotIAkJCQkJICAgbmFtZSwKLSAJCQkJCSAgIGltYXBkX3VzZXJpZCwgb2xkZXh0bmFtZSk7Ci0g
ICAgICgqaW1hcGRfbmFtZXNwYWNlLm1ib3huYW1lX3RvZXh0ZXJuYWwpKCZpbWFwZF9uYW1lc3Bh
Y2UsCi0gCQkJCQkgICB0ZXh0LT5uZXdtYWlsYm94bmFtZSwKLSAJCQkJCSAgIGltYXBkX3VzZXJp
ZCwgbmV3ZXh0bmFtZSk7Ci0gCiAgICAgIGlmKHIpIHsKICAJcHJvdF9wcmludGYoaW1hcGRfb3V0
LCAiKiBOTyByZW5hbWUgJXMgJXM6ICVzXHJcbiIsCiEgCQkgICAgb2xkZXh0bmFtZSwgbmV3ZXh0
bmFtZSwgZXJyb3JfbWVzc2FnZShyKSk7CiAgCWlmIChSRU5BTUVfU1RPUF9PTl9FUlJPUikgcmV0
dXJuIHI7CiAgICAgIH0gZWxzZSB7CiAgCS8qIElmIHdlJ3JlIHJlbmFtaW5nIGEgdXNlciwgY2hh
bmdlIHF1b3Rhcm9vdCBhbmQgQUNMICovCiAgCWlmICh0ZXh0LT5yZW5hbWVfdXNlcikgewohIAkg
ICAgdXNlcl9jb3B5cXVvdGFyb290KG5hbWUsIHRleHQtPm5ld21haWxib3huYW1lKTsKISAJICAg
IHVzZXJfcmVuYW1lYWNsKHRleHQtPm5ld21haWxib3huYW1lLAogIAkJCSAgIHRleHQtPmFjbF9v
bGR1c2VyLCB0ZXh0LT5hY2xfbmV3dXNlcik7CiAgCX0KICAKICAJLyogUmVuYW1lIG1haWxib3gg
YW5ub3RhdGlvbnMgKi8KISAJYW5ub3RhdGVtb3JlX3JlbmFtZShuYW1lLCB0ZXh0LT5uZXdtYWls
Ym94bmFtZSwKICAJCQkgICAgdGV4dC0+cmVuYW1lX3VzZXIgPyB0ZXh0LT5vbGR1c2VyIDogTlVM
TCwKICAJCQkgICAgdGV4dC0+bmV3dXNlcik7CiAgCQogIAlwcm90X3ByaW50ZihpbWFwZF9vdXQs
ICIqIE9LIHJlbmFtZSAlcyAlc1xyXG4iLAohIAkJICAgIG9sZGV4dG5hbWUsIG5ld2V4dG5hbWUp
OwogICAgICB9CiAgCiAgICAgIHByb3RfZmx1c2goaW1hcGRfb3V0KTsKLS0tIDM5MDgsMzk0NiAt
LS0tCiAgCiAgICAgIHN0cmNweSh0ZXh0LT5uZXdtYWlsYm94bmFtZSArIHRleHQtPm5sLCBuYW1l
ICsgdGV4dC0+b2wpOwogIAohICAgICBpZigoKmltYXBkX25hbWVzcGFjZS5tYm94bmFtZV90b2lu
dGVybmFsKSgmaW1hcGRfbmFtZXNwYWNlLAohIAkJCQkJICAgICAgdGV4dC0+bmV3bWFpbGJveG5h
bWUsCiEgCQkJCQkgICAgICBpbWFwZF91c2VyaWQsIG5ld2ludG5hbWUpKQohIAlyZXR1cm4gMDsK
ISAKISAgICAgaWYoKCppbWFwZF9uYW1lc3BhY2UubWJveG5hbWVfdG9pbnRlcm5hbCkoJmltYXBk
X25hbWVzcGFjZSwKISAJCQkJCSAgICAgIG5hbWUsCiEgCQkJCQkgICAgICBpbWFwZF91c2VyaWQs
IG9sZGludG5hbWUpKQohIAlyZXR1cm4gMDsKISAKISAgICAgciA9IG1ib3hsaXN0X3JlbmFtZW1h
aWxib3gob2xkaW50bmFtZSwgbmV3aW50bmFtZSwKICAJCQkgICAgICAgdGV4dC0+cGFydGl0aW9u
LAogIAkJCSAgICAgICAxLCBpbWFwZF91c2VyaWQsIGltYXBkX2F1dGhzdGF0ZSk7CiAgICAgIAog
ICAgICBpZihyKSB7CiAgCXByb3RfcHJpbnRmKGltYXBkX291dCwgIiogTk8gcmVuYW1lICVzICVz
OiAlc1xyXG4iLAohIAkJICAgIG5hbWUsIHRleHQtPm5ld21haWxib3huYW1lLCBlcnJvcl9tZXNz
YWdlKHIpKTsKICAJaWYgKFJFTkFNRV9TVE9QX09OX0VSUk9SKSByZXR1cm4gcjsKICAgICAgfSBl
bHNlIHsKICAJLyogSWYgd2UncmUgcmVuYW1pbmcgYSB1c2VyLCBjaGFuZ2UgcXVvdGFyb290IGFu
ZCBBQ0wgKi8KICAJaWYgKHRleHQtPnJlbmFtZV91c2VyKSB7CiEgCSAgICB1c2VyX2NvcHlxdW90
YXJvb3Qob2xkaW50bmFtZSwgbmV3aW50bmFtZSk7CiEgCSAgICB1c2VyX3JlbmFtZWFjbChuZXdp
bnRuYW1lLAogIAkJCSAgIHRleHQtPmFjbF9vbGR1c2VyLCB0ZXh0LT5hY2xfbmV3dXNlcik7CiAg
CX0KICAKICAJLyogUmVuYW1lIG1haWxib3ggYW5ub3RhdGlvbnMgKi8KISAJYW5ub3RhdGVtb3Jl
X3JlbmFtZShvbGRpbnRuYW1lLCBuZXdpbnRuYW1lLAogIAkJCSAgICB0ZXh0LT5yZW5hbWVfdXNl
ciA/IHRleHQtPm9sZHVzZXIgOiBOVUxMLAogIAkJCSAgICB0ZXh0LT5uZXd1c2VyKTsKICAJCiAg
CXByb3RfcHJpbnRmKGltYXBkX291dCwgIiogT0sgcmVuYW1lICVzICVzXHJcbiIsCiEgCQkgICAg
bmFtZSwgdGV4dC0+bmV3bWFpbGJveG5hbWUpOwogICAgICB9CiAgCiAgICAgIHByb3RfZmx1c2go
aW1hcGRfb3V0KTsKKioqKioqKioqKioqKioqCioqKiAzOTI2LDM5MzUgKioqKgogIAkJY2hhciAq
b2xkbmFtZSwgY2hhciAqbmV3bmFtZSwgY2hhciAqcGFydGl0aW9uKQogIHsKICAgICAgaW50IHIg
PSAwOwohICAgICBjaGFyIG9sZG1haWxib3huYW1lW01BWF9NQUlMQk9YX05BTUUrM107CiEgICAg
IGNoYXIgbmV3bWFpbGJveG5hbWVbTUFYX01BSUxCT1hfTkFNRSsyXTsKISAgICAgY2hhciBvbGRl
eHRuYW1lW01BWF9NQUlMQk9YX05BTUUrMV07CiEgICAgIGNoYXIgbmV3ZXh0bmFtZVtNQVhfTUFJ
TEJPWF9OQU1FKzFdOwogICAgICBpbnQgb21sZW4sIG5tbGVuOwogICAgICBjaGFyICpwOwogICAg
ICBpbnQgcmVjdXJzaXZlX3JlbmFtZSA9IDE7Ci0tLSAzOTU1LDM5NjIgLS0tLQogIAkJY2hhciAq
b2xkbmFtZSwgY2hhciAqbmV3bmFtZSwgY2hhciAqcGFydGl0aW9uKQogIHsKICAgICAgaW50IHIg
PSAwOwohICAgICBjaGFyIG9sZG1haWxib3huYW1lW01BWF9NQUlMQk9YX05BTUUrMV07CiEgICAg
IGNoYXIgbmV3bWFpbGJveG5hbWVbTUFYX01BSUxCT1hfTkFNRSsxXTsKICAgICAgaW50IG9tbGVu
LCBubWxlbjsKICAgICAgY2hhciAqcDsKICAgICAgaW50IHJlY3Vyc2l2ZV9yZW5hbWUgPSAxOwoq
KioqKioqKioqKioqKioKKioqIDQwMzcsNDA2MiAqKioqCiAgCiAgICAgIC8qIHJlbmFtZSBhbGwg
bWFpbGJveGVzIG1hdGNoaW5nIHRoaXMgKi8KICAgICAgaWYgKCFyICYmIHJlY3Vyc2l2ZV9yZW5h
bWUpIHsKICAJc3RydWN0IHJlbnJvY2sgcm9jazsKISAJaW50IG9sID0gb21sZW4gKyAxOwohIAlp
bnQgbmwgPSBubWxlbiArIDE7CiEgCiEgCSgqaW1hcGRfbmFtZXNwYWNlLm1ib3huYW1lX3RvZXh0
ZXJuYWwpKCZpbWFwZF9uYW1lc3BhY2UsCiEgCQkJCQkgICAgICAgb2xkbWFpbGJveG5hbWUsCiEg
CQkJCQkgICAgICAgaW1hcGRfdXNlcmlkLCBvbGRleHRuYW1lKTsKISAJKCppbWFwZF9uYW1lc3Bh
Y2UubWJveG5hbWVfdG9leHRlcm5hbCkoJmltYXBkX25hbWVzcGFjZSwKISAJCQkJCSAgICAgICBu
ZXdtYWlsYm94bmFtZSwKISAJCQkJCSAgICAgICBpbWFwZF91c2VyaWQsIG5ld2V4dG5hbWUpOwog
IAogIAlwcm90X3ByaW50ZihpbWFwZF9vdXQsICIqIE9LIHJlbmFtZSAlcyAlc1xyXG4iLAohIAkJ
ICAgIG9sZGV4dG5hbWUsIG5ld2V4dG5hbWUpOwogIAlwcm90X2ZsdXNoKGltYXBkX291dCk7CiAg
CiEgCXN0cmNhdChvbGRtYWlsYm94bmFtZSwgIi4qIik7CiEgCXN0cmNhdChuZXdtYWlsYm94bmFt
ZSwgIi4iKTsKICAKICAJLyogc2V0dXAgdGhlIHJvY2sgKi8KISAJcm9jay5uZXdtYWlsYm94bmFt
ZSA9IG5ld21haWxib3huYW1lOwogIAlyb2NrLm9sID0gb2w7CiAgCXJvY2submwgPSBubDsKICAJ
cm9jay5vbGR1c2VyID0gb2xkdXNlcjsKLS0tIDQwNjQsNDA4NyAtLS0tCiAgCiAgICAgIC8qIHJl
bmFtZSBhbGwgbWFpbGJveGVzIG1hdGNoaW5nIHRoaXMgKi8KICAgICAgaWYgKCFyICYmIHJlY3Vy
c2l2ZV9yZW5hbWUpIHsKKyAJY2hhciBvbGRleHRuYW1lW01BWF9NQUlMQk9YX05BTUUrM107Cisg
CWNoYXIgbmV3ZXh0bmFtZVtNQVhfTUFJTEJPWF9OQU1FKzJdOworIAlpbnQgdG1wbGVuOwogIAlz
dHJ1Y3QgcmVucm9jayByb2NrOwohIAlpbnQgb2w7CiEgCWludCBubDsKICAKKyAJb2wgPSBzdHJs
ZW4ob2xkbmFtZSkrMTsKKyAJbmwgPSBzdHJsZW4obmV3bmFtZSkrMTsKICAJcHJvdF9wcmludGYo
aW1hcGRfb3V0LCAiKiBPSyByZW5hbWUgJXMgJXNcclxuIiwKISAJCSAgICBvbGRuYW1lLCBuZXdu
YW1lKTsKICAJcHJvdF9mbHVzaChpbWFwZF9vdXQpOwogIAohIAlzbnByaW50ZihvbGRleHRuYW1l
LCBNQVhfTUFJTEJPWF9OQU1FKzMsICIlcyVjKiIsIG9sZG5hbWUsIGltYXBkX25hbWVzcGFjZS5o
aWVyX3NlcCk7CiEgCXNucHJpbnRmKG5ld2V4dG5hbWUsIE1BWF9NQUlMQk9YX05BTUUrMiwgIiVz
JWMiLCBuZXduYW1lLCBpbWFwZF9uYW1lc3BhY2UuaGllcl9zZXApOwogIAogIAkvKiBzZXR1cCB0
aGUgcm9jayAqLwohIAlyb2NrLm5ld21haWxib3huYW1lID0gbmV3ZXh0bmFtZTsKICAJcm9jay5v
bCA9IG9sOwogIAlyb2NrLm5sID0gbmw7CiAgCXJvY2sub2xkdXNlciA9IG9sZHVzZXI7CioqKioq
KioqKioqKioqKgoqKiogNDA2Niw0MDc0ICoqKioKICAJcm9jay5wYXJ0aXRpb24gPSBwYXJ0aXRp
b247CiAgCXJvY2sucmVuYW1lX3VzZXIgPSByZW5hbWVfdXNlcjsKICAJCiEgCS8qIGFkZCBzdWJt
YWlsYm94ZXM7IHdlIHByZXRlbmQgd2UncmUgYW4gYWRtaW4gc2luY2Ugd2Ugc3VjY2Vzc2Z1bGx5
CiEgCSAgIHJlbmFtZWQgdGhlIHBhcmVudCAtIHdlJ3JlIHVzaW5nIGludGVybmFsIG5hbWVzIGhl
cmUgKi8KISAJciA9IG1ib3hsaXN0X2ZpbmRhbGwoTlVMTCwgb2xkbWFpbGJveG5hbWUsIDEsIGlt
YXBkX3VzZXJpZCwKICAJCQkgICAgIGltYXBkX2F1dGhzdGF0ZSwgcmVubWJveCwgJnJvY2spOwog
ICAgICB9CiAgCi0tLSA0MDkxLDQwOTggLS0tLQogIAlyb2NrLnBhcnRpdGlvbiA9IHBhcnRpdGlv
bjsKICAJcm9jay5yZW5hbWVfdXNlciA9IHJlbmFtZV91c2VyOwogIAkKISAJLyogYWRkIHN1Ym1h
aWxib3hlczsgdXNpbmcgZXh0ZXJuYWwgbmFtZXNwYWNlIGhlcmUgKi8KISAJciA9IGltYXBkX25h
bWVzcGFjZS5tYm94bGlzdF9maW5kYWxsKCZpbWFwZF9uYW1lc3BhY2UsIG9sZGV4dG5hbWUsIDEs
IGltYXBkX3VzZXJpZCwKICAJCQkgICAgIGltYXBkX2F1dGhzdGF0ZSwgcmVubWJveCwgJnJvY2sp
OwogICAgICB9CiAgCioqKioqKioqKioqKioqKgoqKiogNDMzNCw0MzQ0ICoqKioKICAJICAgIHBh
dHRlcm4gPSBidWY7CiAgCX0KICAKLSAJLyogVHJhbnNsYXRlIGFueSBzZXBhcmF0b3JzIGluIHBh
dHRlcm4gKi8KLSAJbWJveG5hbWVfaGllcnNlcF90b2ludGVybmFsKCZpbWFwZF9uYW1lc3BhY2Us
IHBhdHRlcm4sCi0gCQkJCSAgICBjb25maWdfdmlydGRvbWFpbnMgPwotIAkJCQkgICAgc3RyY3Nw
bihwYXR0ZXJuLCAiQCIpIDogMCk7Ci0gCiAgCS8qIENoZWNrIHRvIHNlZSBpZiB3ZSBzaG91bGQg
b25seSBsaXN0IHRoZSBwZXJzb25hbCBuYW1lc3BhY2UgKi8KICAJaWYgKCFzdHJjbXAocGF0dGVy
biwgIioiKQogIAkgICAgJiYgY29uZmlnX2dldHN3aXRjaChJTUFQT1BUX0ZPT0xTVFVQSURDTElF
TlRTKSkgewotLS0gNDM1OCw0MzYzIC0tLS0KKioqKioqKioqKioqKioqCioqKiA1MTAwLDUxMTQg
KioqKgogIAkJCSB2b2lkICpyb2NrKQogIHsKICAgICAgaW50KiBzYXdvbmUgPSAoaW50Kikgcm9j
azsKICAKICAgICAgaWYgKCFuYW1lKSB7CiAgCXJldHVybiAwOwogICAgICB9CiAgICAgIAohICAg
ICBpZiAoIShzdHJuY21wKG5hbWUsICJJTkJPWC4iLCA2KSkpIHsKICAJLyogVGhlIHVzZXIgaGFz
IGEgInBlcnNvbmFsIiBuYW1lc3BhY2UuICovCiAgCXNhd29uZVtOQU1FU1BBQ0VfSU5CT1hdID0g
MTsKISAgICAgfSBlbHNlIGlmIChtYm94bmFtZV9pc3VzZXJtYWlsYm94KG5hbWUsIDApKSB7CiAg
CS8qIFRoZSB1c2VyIGNhbiBzZWUgdGhlICJvdGhlciB1c2VycyIgbmFtZXNwYWNlLiAqLwogIAlz
YXdvbmVbTkFNRVNQQUNFX1VTRVJdID0gMTsKICAgICAgfSBlbHNlIHsKLS0tIDUxMTksNTEzOCAt
LS0tCiAgCQkJIHZvaWQgKnJvY2spCiAgewogICAgICBpbnQqIHNhd29uZSA9IChpbnQqKSByb2Nr
OworICAgICBjaGFyIGludG5hbWVbTUFYX01BSUxCT1hfTkFNRSsxXTsKICAKICAgICAgaWYgKCFu
YW1lKSB7CiAgCXJldHVybiAwOwogICAgICB9CiAgICAgIAohICAgICBpZigoKmltYXBkX25hbWVz
cGFjZS5tYm94bmFtZV90b2ludGVybmFsKSgmaW1hcGRfbmFtZXNwYWNlLCBuYW1lLAohIAkJCQkJ
ICAgICAgaW1hcGRfdXNlcmlkLCBpbnRuYW1lKSkKISAJcmV0dXJuIDA7CiEgCiEgICAgIGlmICgh
KHN0cm5jbXAoaW50bmFtZSwgIklOQk9YLiIsIDYpKSkgewogIAkvKiBUaGUgdXNlciBoYXMgYSAi
cGVyc29uYWwiIG5hbWVzcGFjZS4gKi8KICAJc2F3b25lW05BTUVTUEFDRV9JTkJPWF0gPSAxOwoh
ICAgICB9IGVsc2UgaWYgKG1ib3huYW1lX2lzdXNlcm1haWxib3goaW50bmFtZSwgMCkpIHsKICAJ
LyogVGhlIHVzZXIgY2FuIHNlZSB0aGUgIm90aGVyIHVzZXJzIiBuYW1lc3BhY2UuICovCiAgCXNh
d29uZVtOQU1FU1BBQ0VfVVNFUl0gPSAxOwogICAgICB9IGVsc2UgewoqKioqKioqKioqKioqKioK
KioqIDUxNDUsNTE1MyAqKioqCiAgICAgIH0gZWxzZSB7CiAgCXBhdHRlcm4gPSB4c3RyZHVwKCIl
Iik7CiAgCS8qIG5vdyBmaW5kIGFsbCB0aGUgZXhjaXRpbmcgdG9wbGV2ZWwgbmFtZXNwYWNlcyAt
CiEgCSAqIHdlJ3JlIHVzaW5nIGludGVybmFsIG5hbWVzIGhlcmUKICAJICovCiEgCW1ib3hsaXN0
X2ZpbmRhbGwoTlVMTCwgcGF0dGVybiwgaW1hcGRfdXNlcmlzYWRtaW4sIGltYXBkX3VzZXJpZCwK
ICAJCQkgaW1hcGRfYXV0aHN0YXRlLCBuYW1lc3BhY2VkYXRhLCAodm9pZCopIHNhd29uZSk7CiAg
CWZyZWUocGF0dGVybik7CiAgICAgIH0KLS0tIDUxNjksNTE3OCAtLS0tCiAgICAgIH0gZWxzZSB7
CiAgCXBhdHRlcm4gPSB4c3RyZHVwKCIlIik7CiAgCS8qIG5vdyBmaW5kIGFsbCB0aGUgZXhjaXRp
bmcgdG9wbGV2ZWwgbmFtZXNwYWNlcyAtCiEgCSAqIHdlJ3JlIHVzaW5nIGV4dGVybmFsIG5hbWVz
IGhlcmUKICAJICovCiEgCW1ib3hsaXN0X2ZpbmRhbGwoJmltYXBkX25hbWVzcGFjZSwgcGF0dGVy
biwgaW1hcGRfdXNlcmlzYWRtaW4sCiEgCQkJIGltYXBkX3VzZXJpZCwgCiAgCQkJIGltYXBkX2F1
dGhzdGF0ZSwgbmFtZXNwYWNlZGF0YSwgKHZvaWQqKSBzYXdvbmUpOwogIAlmcmVlKHBhdHRlcm4p
OwogICAgICB9CioqKioqKioqKioqKioqKgoqKiogNjUzMSw2NTM3ICoqKioKICAgICAgc3RydWN0
IGJhY2tlbmQgKmJlOwogIH07CiAgCiEgc3RhdGljIGludCB4ZmVyX3VzZXJfY2IoY2hhciAqbmFt
ZSwKICAJCQlpbnQgbWF0Y2hsZW4gX19hdHRyaWJ1dGVfXygodW51c2VkKSksCiAgCQkJaW50IG1h
eWNyZWF0ZSBfX2F0dHJpYnV0ZV9fKCh1bnVzZWQpKSwKICAJCQl2b2lkICpyb2NrKSAKLS0tIDY1
NTYsNjU2MiAtLS0tCiAgICAgIHN0cnVjdCBiYWNrZW5kICpiZTsKICB9OwogIAohIHN0YXRpYyBp
bnQgeGZlcl91c2VyX2NiKGNoYXIgKmV4dGVybmFsbmFtZSwKICAJCQlpbnQgbWF0Y2hsZW4gX19h
dHRyaWJ1dGVfXygodW51c2VkKSksCiAgCQkJaW50IG1heWNyZWF0ZSBfX2F0dHJpYnV0ZV9fKCh1
bnVzZWQpKSwKICAJCQl2b2lkICpyb2NrKSAKKioqKioqKioqKioqKioqCioqKiA2NTQwLDY1NTEg
KioqKgogICAgICBjaGFyICp0b3NlcnZlciA9ICgoc3RydWN0IHhmZXJfdXNlcl9yb2NrICopcm9j
ayktPnRvc2VydmVyOwogICAgICBjaGFyICp0b3BhcnQgPSAoKHN0cnVjdCB4ZmVyX3VzZXJfcm9j
ayAqKXJvY2spLT50b3BhcnQ7CiAgICAgIHN0cnVjdCBiYWNrZW5kICpiZSA9ICgoc3RydWN0IHhm
ZXJfdXNlcl9yb2NrICopcm9jayktPmJlOwohICAgICBjaGFyIGV4dGVybmFsbmFtZVtNQVhfTUFJ
TEJPWF9OQU1FKzFdOwogICAgICBpbnQgbWJmbGFnczsKICAgICAgaW50IHIgPSAwOwogICAgICBj
aGFyICppbnBhdGgsICppbnBhcnQsICppbmFjbDsKICAgICAgY2hhciAqcGF0aCA9IE5VTEwsICpw
YXJ0ID0gTlVMTCwgKmFjbCA9IE5VTEw7CiAgCiAgICAgIGlmICghcikgewogIAkvKiBOT1RFOiBO
T1QgbWxvb2t1cCgpIGJlY2F1c2Ugd2UgZG9uJ3Qgd2FudCB0byBpc3N1ZSBhIHJlZmVycmFsICov
CiAgCS8qIHh4eCBidXQgd2hhdCBoYXBwZW5zIGlmIHRoZXkgYXJlIHJlbW90ZQotLS0gNjU2NSw2
NTgxIC0tLS0KICAgICAgY2hhciAqdG9zZXJ2ZXIgPSAoKHN0cnVjdCB4ZmVyX3VzZXJfcm9jayAq
KXJvY2spLT50b3NlcnZlcjsKICAgICAgY2hhciAqdG9wYXJ0ID0gKChzdHJ1Y3QgeGZlcl91c2Vy
X3JvY2sgKilyb2NrKS0+dG9wYXJ0OwogICAgICBzdHJ1Y3QgYmFja2VuZCAqYmUgPSAoKHN0cnVj
dCB4ZmVyX3VzZXJfcm9jayAqKXJvY2spLT5iZTsKISAgICAgY2hhciBuYW1lW01BWF9NQUlMQk9Y
X05BTUUrMV07CiAgICAgIGludCBtYmZsYWdzOwogICAgICBpbnQgciA9IDA7CiAgICAgIGNoYXIg
KmlucGF0aCwgKmlucGFydCwgKmluYWNsOwogICAgICBjaGFyICpwYXRoID0gTlVMTCwgKnBhcnQg
PSBOVUxMLCAqYWNsID0gTlVMTDsKICAKKyAgICAgciA9ICgqaW1hcGRfbmFtZXNwYWNlLm1ib3hu
YW1lX3RvaW50ZXJuYWwpKCZpbWFwZF9uYW1lc3BhY2UsCisgCQkJCQkgICAgICAgZXh0ZXJuYWxu
YW1lLAorIAkJCQkJICAgICAgIGltYXBkX3VzZXJpZCwKKyAJCQkJCSAgICAgICBuYW1lKTsKKyAK
ICAgICAgaWYgKCFyKSB7CiAgCS8qIE5PVEU6IE5PVCBtbG9va3VwKCkgYmVjYXVzZSB3ZSBkb24n
dCB3YW50IHRvIGlzc3VlIGEgcmVmZXJyYWwgKi8KICAJLyogeHh4IGJ1dCB3aGF0IGhhcHBlbnMg
aWYgdGhleSBhcmUgcmVtb3RlCioqKioqKioqKioqKioqKgoqKiogNjU1OCw2NTczICoqKioKICAJ
cGF0aCA9IHhzdHJkdXAoaW5wYXRoKTsKICAJcGFydCA9IHhzdHJkdXAoaW5wYXJ0KTsKICAJYWNs
ID0geHN0cmR1cChpbmFjbCk7Ci0gICAgIH0KLSAKLSAgICAgaWYgKCFyKSB7Ci0gCXIgPSAoKmlt
YXBkX25hbWVzcGFjZS5tYm94bmFtZV90b2V4dGVybmFsKSgmaW1hcGRfbmFtZXNwYWNlLAotIAkJ
CQkJCSAgIG5hbWUsCi0gCQkJCQkJICAgaW1hcGRfdXNlcmlkLAotIAkJCQkJCSAgIGV4dGVybmFs
bmFtZSk7Ci0gICAgIH0KLSAKLSAgICAgaWYoIXIpIHsKICAJciA9IGRvX3hmZXJfc2luZ2xlKHRv
c2VydmVyLCB0b3BhcnQsIGV4dGVybmFsbmFtZSwgbmFtZSwgbWJmbGFncywKICAJCQkgICBwYXRo
LCBwYXJ0LCBhY2wsIDAsIG11cGRhdGVfaCwgYmUpOwogICAgICB9Ci0tLSA2NTg4LDY1OTMgLS0t
LQoqKioqKioqKioqKioqKioKKioqIDY3MDYsNjcxMiAqKioqCiAgCX0KICAKICAKISAJLyogcmVj
dXJzaXZlbHkgbW92ZSBhbGwgc3ViLW1haWxib3hlcywgdXNpbmcgaW50ZXJuYWwgbmFtZXMgKi8K
ICAJaWYoIXIpIHsKICAJICAgIHN0cnVjdCB4ZmVyX3VzZXJfcm9jayByb2NrOwogIAotLS0gNjcy
Niw2NzMyIC0tLS0KICAJfQogIAogIAohIAkvKiByZWN1cnNpdmVseSBtb3ZlIGFsbCBzdWItbWFp
bGJveGVzLCB1c2luZyBleHRlcm5hbCBuYW1lcyAqLwogIAlpZighcikgewogIAkgICAgc3RydWN0
IHhmZXJfdXNlcl9yb2NrIHJvY2s7CiAgCioqKioqKioqKioqKioqKgoqKiogNjcxNiw2NzIyICoq
KioKICAJICAgIHJvY2suYmUgPSBiZTsKICAKICAJICAgIHNucHJpbnRmKGJ1Ziwgc2l6ZW9mKGJ1
ZiksICIlcy4qIiwgbWFpbGJveG5hbWUpOwohIAkgICAgciA9IG1ib3hsaXN0X2ZpbmRhbGwoTlVM
TCwgYnVmLCAxLCBpbWFwZF91c2VyaWQsCiAgCQkJCSBpbWFwZF9hdXRoc3RhdGUsIHhmZXJfdXNl
cl9jYiwKICAJCQkJICZyb2NrKTsKICAJfQotLS0gNjczNiw2NzQyIC0tLS0KICAJICAgIHJvY2su
YmUgPSBiZTsKICAKICAJICAgIHNucHJpbnRmKGJ1Ziwgc2l6ZW9mKGJ1ZiksICIlcy4qIiwgbWFp
bGJveG5hbWUpOwohIAkgICAgciA9IG1ib3hsaXN0X2ZpbmRhbGwoJmltYXBkX25hbWVzcGFjZSwg
YnVmLCAxLCBpbWFwZF91c2VyaWQsCiAgCQkJCSBpbWFwZF9hdXRoc3RhdGUsIHhmZXJfdXNlcl9j
YiwKICAJCQkJICZyb2NrKTsKICAJfQoqKioqKioqKioqKioqKioKKioqIDc0MDgsNzQyNCAqKioq
CiAgLyoKICAgKiBJc3N1ZSBhIExJU1Qgb3IgTFNVQiB1bnRhZ2dlZCByZXNwb25zZQogICAqLwog
IHN0YXRpYyB2b2lkIG1zdHJpbmdkYXRhKGNoYXIgKmNtZCwgY2hhciAqbmFtZSwgaW50IG1hdGNo
bGVuLCBpbnQgbWF5Y3JlYXRlLAogIAkJCWludCBsaXN0b3B0cykKICB7CiEgICAgIHN0YXRpYyBj
aGFyIGxhc3RuYW1lW01BWF9NQUlMQk9YX1BBVEgrMV07CiAgICAgIHN0YXRpYyBpbnQgbGFzdG5h
bWVkZWxheWVkID0gMDsKICAgICAgc3RhdGljIGludCBsYXN0bmFtZW5vaW5mZXJpb3JzID0gMDsK
ICAgICAgc3RhdGljIGludCBub25leGlzdGVudCA9IDA7CiAgICAgIHN0YXRpYyBpbnQgc2F3dXNl
ciA9IDA7CiAgICAgIGludCBsYXN0bmFtZWhhc3N1YiA9IDA7CiAgICAgIGludCBjLCBtYnR5cGU7
Ci0gICAgIGNoYXIgbWJveG5hbWVbTUFYX01BSUxCT1hfUEFUSCsxXTsKICAKICAgICAgLyogV2Ug
aGF2ZSB0byByZXNldCB0aGUgc2F3dXNlciBmbGFnIGJlZm9yZSBlYWNoIGxpc3QgY29tbWFuZC4K
ICAgICAgICogSGFuZGxlIGl0IGFzIGEgZGlydHkgaGFjay4KLS0tIDc0MjgsNzQ0NSAtLS0tCiAg
LyoKICAgKiBJc3N1ZSBhIExJU1Qgb3IgTFNVQiB1bnRhZ2dlZCByZXNwb25zZQogICAqLworIC8q
IFRoZSAnbmFtZScgdmFyaWFibGUgbm93IGlzIGFuIGV4dGVybmFsIG5hbWUhIC8vIHNvcmNlcmVy
ICovCiAgc3RhdGljIHZvaWQgbXN0cmluZ2RhdGEoY2hhciAqY21kLCBjaGFyICpuYW1lLCBpbnQg
bWF0Y2hsZW4sIGludCBtYXljcmVhdGUsCiAgCQkJaW50IGxpc3RvcHRzKQogIHsKISAgICAgc3Rh
dGljIGNoYXIgbGFzdG5hbWVbTUFYX01BSUxCT1hfUEFUSCsxXT0iIjsKISAgICAgY2hhciBpbnRu
YW1lW01BWF9NQUlMQk9YX1BBVEgrMV07CiAgICAgIHN0YXRpYyBpbnQgbGFzdG5hbWVkZWxheWVk
ID0gMDsKICAgICAgc3RhdGljIGludCBsYXN0bmFtZW5vaW5mZXJpb3JzID0gMDsKICAgICAgc3Rh
dGljIGludCBub25leGlzdGVudCA9IDA7CiAgICAgIHN0YXRpYyBpbnQgc2F3dXNlciA9IDA7CiAg
ICAgIGludCBsYXN0bmFtZWhhc3N1YiA9IDA7CiAgICAgIGludCBjLCBtYnR5cGU7CiAgCiAgICAg
IC8qIFdlIGhhdmUgdG8gcmVzZXQgdGhlIHNhd3VzZXIgZmxhZyBiZWZvcmUgZWFjaCBsaXN0IGNv
bW1hbmQuCiAgICAgICAqIEhhbmRsZSBpdCBhcyBhIGRpcnR5IGhhY2suCioqKioqKioqKioqKioq
KgoqKiogNzQzMCw3NDM5ICoqKioKICAgICAgfQogICAgICBtc3RyaW5nZGF0YWNhbGxzKys7CiAg
CiAgICAgIGlmIChsYXN0bmFtZWRlbGF5ZWQpIHsKICAJLyogQ2hlY2sgaWYgbGFzdG5hbWUgaGFz
IGNoaWxkcmVuICovCiAgCWlmIChuYW1lICYmIHN0cm5jbXAobGFzdG5hbWUsIG5hbWUsIHN0cmxl
bihsYXN0bmFtZSkpID09IDAgJiYKISAJICAgIG5hbWVbc3RybGVuKGxhc3RuYW1lKV0gPT0gJy4n
KSB7CiAgCSAgICBsYXN0bmFtZWhhc3N1YiA9IDE7CiAgCX0KICAJcHJvdF9wcmludGYoaW1hcGRf
b3V0LCAiKiAlcyAoIiwgY21kKTsKLS0tIDc0NTEsNzQ2NCAtLS0tCiAgICAgIH0KICAgICAgbXN0
cmluZ2RhdGFjYWxscysrOwogIAorICAgICBpZihuYW1lICYmICgqaW1hcGRfbmFtZXNwYWNlLm1i
b3huYW1lX3RvaW50ZXJuYWwpKCZpbWFwZF9uYW1lc3BhY2UsIG5hbWUsCisgCQkJCQkgICAgICBp
bWFwZF91c2VyaWQsIGludG5hbWUpKQorIAlyZXR1cm47CisgCiAgICAgIGlmIChsYXN0bmFtZWRl
bGF5ZWQpIHsKICAJLyogQ2hlY2sgaWYgbGFzdG5hbWUgaGFzIGNoaWxkcmVuICovCiAgCWlmIChu
YW1lICYmIHN0cm5jbXAobGFzdG5hbWUsIG5hbWUsIHN0cmxlbihsYXN0bmFtZSkpID09IDAgJiYK
ISAJICAgIG5hbWVbc3RybGVuKGxhc3RuYW1lKV0gPT0gaW1hcGRfbmFtZXNwYWNlLmhpZXJfc2Vw
KSB7CiAgCSAgICBsYXN0bmFtZWhhc3N1YiA9IDE7CiAgCX0KICAJcHJvdF9wcmludGYoaW1hcGRf
b3V0LCAiKiAlcyAoIiwgY21kKTsKKioqKioqKioqKioqKioqCioqKiA3NDU4LDc0NjYgKioqKgog
IAl9CiAgCXByb3RfcHJpbnRmKGltYXBkX291dCwgIikgXCIlY1wiICIsIGltYXBkX25hbWVzcGFj
ZS5oaWVyX3NlcCk7CiAgCQkgICAgCiEgCSgqaW1hcGRfbmFtZXNwYWNlLm1ib3huYW1lX3RvZXh0
ZXJuYWwpKCZpbWFwZF9uYW1lc3BhY2UsIGxhc3RuYW1lLAohIAkJCQkJICAgICAgIGltYXBkX3Vz
ZXJpZCwgbWJveG5hbWUpOwohIAlwcmludHN0cmluZyhtYm94bmFtZSk7CiAgCXByb3RfcHJpbnRm
KGltYXBkX291dCwgIlxyXG4iKTsKICAJbGFzdG5hbWVkZWxheWVkID0gbGFzdG5hbWVub2luZmVy
aW9ycyA9IG5vbmV4aXN0ZW50ID0gMDsKICAgICAgfQotLS0gNzQ4Myw3NDg5IC0tLS0KICAJfQog
IAlwcm90X3ByaW50ZihpbWFwZF9vdXQsICIpIFwiJWNcIiAiLCBpbWFwZF9uYW1lc3BhY2UuaGll
cl9zZXApOwogIAkJICAgIAohIAlwcmludHN0cmluZyhsYXN0bmFtZSk7CiAgCXByb3RfcHJpbnRm
KGltYXBkX291dCwgIlxyXG4iKTsKICAJbGFzdG5hbWVkZWxheWVkID0gbGFzdG5hbWVub2luZmVy
aW9ycyA9IG5vbmV4aXN0ZW50ID0gMDsKICAgICAgfQoqKioqKioqKioqKioqKioKKioqIDc0NzQs
NzQ4MCAqKioqCiAgICAgIC8qIFN1cHByZXNzIGFueSBvdXRwdXQgb2YgYSBwYXJ0aWFsIG1hdGNo
ICovCiAgICAgIGlmICgobmFtZVttYXRjaGxlbl0KICAJICYmIHN0cm5jbXAobGFzdG5hbWUsIG5h
bWUsIG1hdGNobGVuKSA9PSAwCiEgCSAmJiAobGFzdG5hbWVbbWF0Y2hsZW5dID09ICdcMCcgfHwg
bGFzdG5hbWVbbWF0Y2hsZW5dID09ICcuJykpKSB7CiAgCXJldHVybjsKICAgICAgfQogIAkKLS0t
IDc0OTcsNzUwMyAtLS0tCiAgICAgIC8qIFN1cHByZXNzIGFueSBvdXRwdXQgb2YgYSBwYXJ0aWFs
IG1hdGNoICovCiAgICAgIGlmICgobmFtZVttYXRjaGxlbl0KICAJICYmIHN0cm5jbXAobGFzdG5h
bWUsIG5hbWUsIG1hdGNobGVuKSA9PSAwCiEgCSAmJiAobGFzdG5hbWVbbWF0Y2hsZW5dID09ICdc
MCcgfHwgbGFzdG5hbWVbbWF0Y2hsZW5dID09IGltYXBkX25hbWVzcGFjZS5oaWVyX3NlcCkpKSB7
CiAgCXJldHVybjsKICAgICAgfQogIAkKKioqKioqKioqKioqKioqCioqKiA3NDgyLDc0ODggKioq
KgogICAgICAgKiBXZSBjYW4gZ2V0IGEgcGFydGlhbCBtYXRjaCBmb3IgInVzZXIiIG11bHRpcGxl
IHRpbWVzIHdpdGgKICAgICAgICogb3RoZXIgbWF0Y2hlcyBpbmJldHdlZW4uICBIYW5kbGUgaXQg
YXMgYSBzcGVjaWFsIGNhc2UKICAgICAgICovCiEgICAgIGlmIChtYXRjaGxlbiA9PSA0ICYmIHN0
cm5jYXNlY21wKG5hbWUsICJ1c2VyIiwgNCkgPT0gMCkgewogIAlpZiAoc2F3dXNlcikgcmV0dXJu
OwogIAlzYXd1c2VyID0gMTsKICAgICAgfQotLS0gNzUwNSw3NTExIC0tLS0KICAgICAgICogV2Ug
Y2FuIGdldCBhIHBhcnRpYWwgbWF0Y2ggZm9yICJ1c2VyIiBtdWx0aXBsZSB0aW1lcyB3aXRoCiAg
ICAgICAqIG90aGVyIG1hdGNoZXMgaW5iZXR3ZWVuLiAgSGFuZGxlIGl0IGFzIGEgc3BlY2lhbCBj
YXNlCiAgICAgICAqLwohICAgICBpZiAobWF0Y2hsZW4gPT0gNCAmJiBzdHJuY2FzZWNtcChpbnRu
YW1lLCAidXNlciIsIDQpID09IDApIHsKICAJaWYgKHNhd3VzZXIpIHJldHVybjsKICAJc2F3dXNl
ciA9IDE7CiAgICAgIH0KKioqKioqKioqKioqKioqCioqKiA3NDkyLDc1MDggKioqKgogICAgICBu
b25leGlzdGVudCA9IDA7CiAgCiAgICAgIC8qIE5vdyB3ZSBuZWVkIHRvIHNlZSBpZiB0aGlzIG1h
aWxib3ggZXhpc3RzICovCiEgICAgIC8qIGZpcnN0IGNvbnZlcnQgIklOQk9YIiB0byAidXNlci48
dXNlcmlkPiIgKi8KISAgICAgaWYgKCFzdHJuY2FzZWNtcChsYXN0bmFtZSwgImluYm94IiwgNSkp
IHsKISAJKCppbWFwZF9uYW1lc3BhY2UubWJveG5hbWVfdG9pbnRlcm5hbCkoJmltYXBkX25hbWVz
cGFjZSwgIklOQk9YIiwKISAJCQkJCSAgICAgICBpbWFwZF91c2VyaWQsIG1ib3huYW1lKTsKISAJ
c3RybGNhdChtYm94bmFtZSwgbGFzdG5hbWUrNSwgc2l6ZW9mKG1ib3huYW1lKSk7CiEgICAgIH0K
ISAgICAgZWxzZQohIAlzdHJsY3B5KG1ib3huYW1lLCBsYXN0bmFtZSwgc2l6ZW9mKG1ib3huYW1l
KSk7CiAgCiAgICAgIC8qIExvb2sgaXQgdXAgKi8KISAgICAgbm9uZXhpc3RlbnQgPSBtYm94bGlz
dF9kZXRhaWwobWJveG5hbWUsICZtYnR5cGUsCiAgCQkJCSAgTlVMTCwgTlVMTCwgTlVMTCwgTlVM
TCk7CiAgICAgIGlmKCFub25leGlzdGVudCAmJiAobWJ0eXBlICYgTUJUWVBFX1JFU0VSVkUpKQog
IAlub25leGlzdGVudCA9IElNQVBfTUFJTEJPWF9SRVNFUlZFRDsKLS0tIDc1MTUsNzUyNiAtLS0t
CiAgICAgIG5vbmV4aXN0ZW50ID0gMDsKICAKICAgICAgLyogTm93IHdlIG5lZWQgdG8gc2VlIGlm
IHRoaXMgbWFpbGJveCBleGlzdHMgKi8KISAKISAgICAgLyogVGhlICdpbnRuYW1lJyB2YXJpYWJs
ZSBjYW5ub3QgYmUgIklOQk9YIiwgdGhlcmVmb3JlIHdlIGRvbid0CiEgICAgICAgIG5lZWQgdG8g
Y29udmVydCBpdCB0byAidXNlci48dXNlcmlkPiIgKi8KICAKICAgICAgLyogTG9vayBpdCB1cCAq
LwohICAgICBub25leGlzdGVudCA9IG1ib3hsaXN0X2RldGFpbChpbnRuYW1lLCAmbWJ0eXBlLAog
IAkJCQkgIE5VTEwsIE5VTEwsIE5VTEwsIE5VTEwpOwogICAgICBpZighbm9uZXhpc3RlbnQgJiYg
KG1idHlwZSAmIE1CVFlQRV9SRVNFUlZFKSkKICAJbm9uZXhpc3RlbnQgPSBJTUFQX01BSUxCT1hf
UkVTRVJWRUQ7CioqKioqKioqKioqKioqKgoqKiogNzUxNyw3NTI1ICoqKioKICAgICAgaWYgKGMp
IG5hbWVbbWF0Y2hsZW5dID0gJ1wwJzsKICAgICAgcHJvdF9wcmludGYoaW1hcGRfb3V0LCAiKiAl
cyAoIiwgY21kKTsKICAgICAgaWYgKGMpIHsKISAJLyogSGFuZGxlIG5hbWVzcGFjZSBwcmVmaXgg
YXMgYSBzcGVjaWFsIGNhc2UgKi8gCiEgCWlmICghc3RyY21wKG5hbWUsICJ1c2VyIikgfHwKISAJ
ICAgICFzdHJjbXAobmFtZSwgaW1hcGRfbmFtZXNwYWNlLnByZWZpeFtOQU1FU1BBQ0VfU0hBUkVE
XSkpIHsKICAJICAgIHByb3RfcHJpbnRmKGltYXBkX291dCwgIlxcTm9zZWxlY3QiKTsKICAJICAg
IGlmIChsaXN0b3B0cyAmIExJU1RfRVhUKQogIAkJcHJvdF9wcmludGYoaW1hcGRfb3V0LCAiIFxc
UGxhY2VIb2xkZXIiKTsKLS0tIDc1MzUsNzU0MyAtLS0tCiAgICAgIGlmIChjKSBuYW1lW21hdGNo
bGVuXSA9ICdcMCc7CiAgICAgIHByb3RfcHJpbnRmKGltYXBkX291dCwgIiogJXMgKCIsIGNtZCk7
CiAgICAgIGlmIChjKSB7CiEgCS8qIEhhbmRsZSBuYW1lc3BhY2UgcHJlZml4IGFzIGEgc3BlY2lh
bCBjYXNlICovCiEgIAlpZiAoIXN0cmNtcChuYW1lLCBpbWFwZF9uYW1lc3BhY2UucHJlZml4W05B
TUVTUEFDRV9VU0VSXSkgfHwKISAgCSAgICAhc3RyY21wKG5hbWUsIGltYXBkX25hbWVzcGFjZS5w
cmVmaXhbTkFNRVNQQUNFX1NIQVJFRF0pKSB7CiAgCSAgICBwcm90X3ByaW50ZihpbWFwZF9vdXQs
ICJcXE5vc2VsZWN0Iik7CiAgCSAgICBpZiAobGlzdG9wdHMgJiBMSVNUX0VYVCkKICAJCXByb3Rf
cHJpbnRmKGltYXBkX291dCwgIiBcXFBsYWNlSG9sZGVyIik7CioqKioqKioqKioqKioqKgoqKiog
NzUzOCw3NTQ2ICoqKioKICAgICAgfQogICAgICBwcm90X3ByaW50ZihpbWFwZF9vdXQsICIpIFwi
JWNcIiAiLCBpbWFwZF9uYW1lc3BhY2UuaGllcl9zZXApOwogIAohICAgICAoKmltYXBkX25hbWVz
cGFjZS5tYm94bmFtZV90b2V4dGVybmFsKSgmaW1hcGRfbmFtZXNwYWNlLCBuYW1lLAohIAkJCQkJ
ICAgaW1hcGRfdXNlcmlkLCBtYm94bmFtZSk7CiEgICAgIHByaW50c3RyaW5nKG1ib3huYW1lKTsK
ICAgICAgcHJvdF9wcmludGYoaW1hcGRfb3V0LCAiXHJcbiIpOwogICAgICBpZiAoYykgbmFtZVtt
YXRjaGxlbl0gPSBjOwogICAgICByZXR1cm47Ci0tLSA3NTU2LDc1NjIgLS0tLQogICAgICB9CiAg
ICAgIHByb3RfcHJpbnRmKGltYXBkX291dCwgIikgXCIlY1wiICIsIGltYXBkX25hbWVzcGFjZS5o
aWVyX3NlcCk7CiAgCiEgICAgIHByaW50c3RyaW5nKG5hbWUpOwogICAgICBwcm90X3ByaW50Zihp
bWFwZF9vdXQsICJcclxuIik7CiAgICAgIGlmIChjKSBuYW1lW21hdGNobGVuXSA9IGM7CiAgICAg
IHJldHVybjsKZGlmZiAtQyAzIC1yIGN5cnVzLWltYXBkLTIuMi4xMi5vcmlnL2ltYXAvbWJveGxp
c3QuYyBjeXJ1cy1pbWFwZC0yLjIuMTIvaW1hcC9tYm94bGlzdC5jCioqKiBjeXJ1cy1pbWFwZC0y
LjIuMTIub3JpZy9pbWFwL21ib3hsaXN0LmMJMjAwNS0xMS0wNyAxODowNTozMyArMDMwMAotLS0g
Y3lydXMtaW1hcGQtMi4yLjEyL2ltYXAvbWJveGxpc3QuYwkyMDA1LTExLTA3IDE4OjEyOjMzICsw
MzAwCioqKioqKioqKioqKioqKgoqKiogOTQsOTkgKioqKgotLS0gOTQsMTAwIC0tLS0KICAKICBz
dHJ1Y3QgZGIgKm1iZGI7CiAgCisgc3RydWN0IG5hbWVzcGFjZSBpbnRlcm5hbF9uYW1lc3BhY2U7
CiAgc3RhdGljIGludCBtYm94bGlzdF9kYm9wZW4gPSAwOwogIAogIHN0YXRpYyBpbnQgbWJveGxp
c3Rfb3BlbnN1YnMoKTsKKioqKioqKioqKioqKioqCioqKiAxMDc1LDEwODEgKioqKgogICAgICAg
ICAgICAgIH0KICAJCS8qIGZpbmQgaWYgdGhlcmUgYXJlIHN1YmZvbGRlcnMuIFRoZW4gd2Ugd2Fu
dCB0byAKICAJCSAqIGtlZXAgdGhlIGV4aXN0aW5nIHF1b3RhICovCiEgICAgICAgICAgICAgbWJv
eGxpc3RfZmluZGFsbChOVUxMLCBwYXR0ZXJuLCBpc2FkbWluLCB1c2VyaWQsCiAgICAgICAgICAg
ICAgICAgICAgICBhdXRoX3N0YXRlLCBjaGlsZF9jYiwgKHZvaWQgKikgJmhhc19jaGlsZHJlbik7
CiAgCiAgCSAgICBpZighaGFzX2NoaWxkcmVuKQotLS0gMTA3NiwxMDgyIC0tLS0KICAgICAgICAg
ICAgICB9CiAgCQkvKiBmaW5kIGlmIHRoZXJlIGFyZSBzdWJmb2xkZXJzLiBUaGVuIHdlIHdhbnQg
dG8gCiAgCQkgKiBrZWVwIHRoZSBleGlzdGluZyBxdW90YSAqLwohICAgICAgICAgICAgIG1ib3hs
aXN0X2ZpbmRhbGwoJmludGVybmFsX25hbWVzcGFjZSwgcGF0dGVybiwgaXNhZG1pbiwgdXNlcmlk
LAogICAgICAgICAgICAgICAgICAgICAgYXV0aF9zdGF0ZSwgY2hpbGRfY2IsICh2b2lkICopICZo
YXNfY2hpbGRyZW4pOwogIAogIAkgICAgaWYoIWhhc19jaGlsZHJlbikKKioqKioqKioqKioqKioq
CioqKiAxNzUyLDE3ODYgKioqKgogICAgICBsb25nIG1pbm1hdGNoOwogICAgICBzdHJ1Y3QgZ2xv
YiAqZyA9IHJvY2stPmc7CiAgICAgIGxvbmcgbWF0Y2hsZW47CiAgCiAgICAgIC8qIGRvbid0IGxp
c3QgbWFpbGJveGVzIG91dHNpZGUgb2YgdGhlIGRlZmF1bHQgZG9tYWluICovCiAgICAgIGlmICgh
cm9jay0+ZG9tYWlubGVuICYmICFyb2NrLT5pc2FkbWluICYmIHN0cmNocihrZXksICchJykpIHJl
dHVybiAwOyAKICAKICAgICAgbWlubWF0Y2ggPSAwOwotICAgICBpZiAocm9jay0+aW5ib3hvZmZz
ZXQpIHsKLSAJY2hhciBuYW1lYnVmW01BWF9NQUlMQk9YX05BTUUrMV07CiAgCiEgCWlmKGtleWxl
biA+PSBzaXplb2YobmFtZWJ1ZikpIHsKISAJICAgIHN5c2xvZyhMT0dfRVJSLCAib3ZlcnNpemUg
a2V5bGVuIGluIG1ib3hsaXN0LmM6ZmluZF9wKCkiKTsKISAJICAgIHJldHVybiAwOwohIAl9CiEg
CW1lbWNweShuYW1lYnVmLCBrZXksIGtleWxlbik7CiEgCW5hbWVidWZba2V5bGVuXSA9ICdcMCc7
CiEgCQohIAlpZiAocm9jay0+aW5ib3hvZmZzZXQpIHsKISAJICAgIG5hbWVidWZbcm9jay0+aW5i
b3hvZmZzZXRdID0gcm9jay0+aW5ib3hjYXNlWzBdOwohIAkgICAgbmFtZWJ1Zltyb2NrLT5pbmJv
eG9mZnNldCsxXSA9IHJvY2stPmluYm94Y2FzZVsxXTsKISAJICAgIG5hbWVidWZbcm9jay0+aW5i
b3hvZmZzZXQrMl0gPSByb2NrLT5pbmJveGNhc2VbMl07CiEgCSAgICBuYW1lYnVmW3JvY2stPmlu
Ym94b2Zmc2V0KzNdID0gcm9jay0+aW5ib3hjYXNlWzNdOwohIAkgICAgbmFtZWJ1Zltyb2NrLT5p
bmJveG9mZnNldCs0XSA9IHJvY2stPmluYm94Y2FzZVs0XTsKISAJfQohIAkKISAJbWF0Y2hsZW4g
PSBnbG9iX3Rlc3QoZywgbmFtZWJ1Zityb2NrLT5pbmJveG9mZnNldCwKISAJCQkgICAgIGtleWxl
bi1yb2NrLT5pbmJveG9mZnNldCwgJm1pbm1hdGNoKTsKISAgICAgfSBlbHNlIHsKISAJbWF0Y2hs
ZW4gPSBnbG9iX3Rlc3QoZywga2V5LCBrZXlsZW4sICZtaW5tYXRjaCk7CiAgICAgIH0KICAKICAg
ICAgLyogSWYgaXRzIG5vdCBhIG1hdGNoLCBza2lwIGl0IC0tIHBhcnRpYWwgbWF0Y2hlcyBhcmUg
b2suICovCiAgICAgIGlmKG1hdGNobGVuID09IC0xKSByZXR1cm4gMDsKICAKLS0tIDE3NTMsMTc5
MSAtLS0tCiAgICAgIGxvbmcgbWlubWF0Y2g7CiAgICAgIHN0cnVjdCBnbG9iICpnID0gcm9jay0+
ZzsKICAgICAgbG9uZyBtYXRjaGxlbjsKKyAgICAgY2hhciBuYW1lYnVmW01BWF9NQUlMQk9YX05B
TUUrMV07CisgICAgIGNoYXIgbmFtZWJ1Zl9vdXRbTUFYX01BSUxCT1hfTkFNRSsxXTsKICAKICAg
ICAgLyogZG9uJ3QgbGlzdCBtYWlsYm94ZXMgb3V0c2lkZSBvZiB0aGUgZGVmYXVsdCBkb21haW4g
Ki8KICAgICAgaWYgKCFyb2NrLT5kb21haW5sZW4gJiYgIXJvY2stPmlzYWRtaW4gJiYgc3RyY2hy
KGtleSwgJyEnKSkgcmV0dXJuIDA7IAogIAogICAgICBtaW5tYXRjaCA9IDA7CiAgCiEgICAgIG1l
bWNweShuYW1lYnVmLCBrZXksIGtleWxlbik7CiEgICAgIG5hbWVidWZba2V5bGVuXSA9ICdcMCc7
CiEgCiEgICAgIC8qIHJpZ2h0IHdvcmsgd2l0aCBhbiBhbHRlcm5hdGUgKG5vdCB0aGUgYnVpbGQt
aW4pCiEgICAgICAgIG5hbWVzcGFjZSAtLSBzb3JjZXJlciAqLwohICAgICBpZihrZXlsZW4gPj0g
c2l6ZW9mKG5hbWVidWYpKSB7CiEgCXN5c2xvZyhMT0dfRVJSLCAib3ZlcnNpemUga2V5bGVuIGlu
IG1ib3hsaXN0LmM6ZmluZF9wKCkiKTsKISAJcmV0dXJuIDA7CiEgICAgIH0KISAgICAgaWYocm9j
ay0+aW5ib3hvZmZzZXQpIHsKISAJbmFtZWJ1Zltyb2NrLT5pbmJveG9mZnNldF0gPSByb2NrLT5p
bmJveGNhc2VbMF07CiEgCW5hbWVidWZbcm9jay0+aW5ib3hvZmZzZXQrMV0gPSByb2NrLT5pbmJv
eGNhc2VbMV07CiEgCW5hbWVidWZbcm9jay0+aW5ib3hvZmZzZXQrMl0gPSByb2NrLT5pbmJveGNh
c2VbMl07CiEgCW5hbWVidWZbcm9jay0+aW5ib3hvZmZzZXQrM10gPSByb2NrLT5pbmJveGNhc2Vb
M107CiEgCW5hbWVidWZbcm9jay0+aW5ib3hvZmZzZXQrNF0gPSByb2NrLT5pbmJveGNhc2VbNF07
CiAgICAgIH0KICAKKyAgICAgLyogaWYgY2FudCBnZXQgdGhlIGV4dGVybmFsIG5hbWUgdGhlbiBz
a2lwIHRoZSBjdXJyZW50CisgICAgICAgIGtleSAtLSBzb3JjZXJlciAqLworICAgICBpZigocm9j
ay0+bmFtZXNwYWNlLT5tYm94bmFtZV90b2V4dGVybmFsKShyb2NrLT5uYW1lc3BhY2UsIG5hbWVi
dWYrcm9jay0+aW5ib3hvZmZzZXQsIGF1dGhfY2Fub251c2VyKHJvY2stPmF1dGhfc3RhdGUpLCBu
YW1lYnVmX291dCkpCisgCXJldHVybiAwOworIAorICAgICBtYXRjaGxlbiA9IGdsb2JfdGVzdChn
LCBuYW1lYnVmX291dCwKKyAJCQkgc3RybGVuKG5hbWVidWZfb3V0KSwgJm1pbm1hdGNoKTsKKyAK
ICAgICAgLyogSWYgaXRzIG5vdCBhIG1hdGNoLCBza2lwIGl0IC0tIHBhcnRpYWwgbWF0Y2hlcyBh
cmUgb2suICovCiAgICAgIGlmKG1hdGNobGVuID09IC0xKSByZXR1cm4gMDsKICAKKioqKioqKioq
KioqKioqCioqKiAxODgxLDE5MDIgKioqKgogIAkgICAgciA9IDA7CQkvKiBkb24ndCBib3RoZXIg
Y2hlY2tpbmcgKi8KICAJfQogIAohIAlpZiAoIXIgJiYgcm9jay0+aW5ib3hvZmZzZXQpIHsKISAJ
ICAgIG5hbWVidWZbcm9jay0+aW5ib3hvZmZzZXRdID0gcm9jay0+aW5ib3hjYXNlWzBdOwohIAkg
ICAgbmFtZWJ1Zltyb2NrLT5pbmJveG9mZnNldCsxXSA9IHJvY2stPmluYm94Y2FzZVsxXTsKISAJ
ICAgIG5hbWVidWZbcm9jay0+aW5ib3hvZmZzZXQrMl0gPSByb2NrLT5pbmJveGNhc2VbMl07CiEg
CSAgICBuYW1lYnVmW3JvY2stPmluYm94b2Zmc2V0KzNdID0gcm9jay0+aW5ib3hjYXNlWzNdOwoh
IAkgICAgbmFtZWJ1Zltyb2NrLT5pbmJveG9mZnNldCs0XSA9IHJvY2stPmluYm94Y2FzZVs0XTsK
ISAJfQohIAkKISAJbWF0Y2hsZW4gPSBnbG9iX3Rlc3QoZywgbmFtZWJ1Zityb2NrLT5pbmJveG9m
ZnNldCwKISAJCQkgICAgIGtleWxlbi1yb2NrLT5pbmJveG9mZnNldCwgJm1pbm1hdGNoKTsKICAK
ISAJaWYgKG1hdGNobGVuID09IC0xKSB7CiEgCSAgICByID0gMDsKISAJICAgIGJyZWFrOwohIAl9
CiAgCiAgCXN3aXRjaCAocikgewogIAljYXNlIDA6CiAgCSAgICAvKiBmb3VuZCB0aGUgZW50cnk7
IG91dHB1dCBpdCAqLwotLS0gMTg4NiwxOTE3IC0tLS0KICAJICAgIHIgPSAwOwkJLyogZG9uJ3Qg
Ym90aGVyIGNoZWNraW5nICovCiAgCX0KICAKISAJLyogcmlnaHQgd29yayB3aXRoIGFuIGFsdGVy
bmF0ZSAobm90IHRoZSBidWlsZC1pbikKISAJICAgbmFtZXNwYWNlIC8vIHNvcmNlcmVyICovCiEg
CXsKISAJICAgIGNoYXIgbmFtZWJ1Zl9vdXRbTUFYX01BSUxCT1hfTkFNRSsxXTsKISAJICAgIGlm
KHJvY2stPmluYm94b2Zmc2V0KSB7CiEgCQluYW1lYnVmW3JvY2stPmluYm94b2Zmc2V0XSA9IHJv
Y2stPmluYm94Y2FzZVswXTsKISAJCW5hbWVidWZbcm9jay0+aW5ib3hvZmZzZXQrMV0gPSByb2Nr
LT5pbmJveGNhc2VbMV07CiEgCQluYW1lYnVmW3JvY2stPmluYm94b2Zmc2V0KzJdID0gcm9jay0+
aW5ib3hjYXNlWzJdOwohIAkJbmFtZWJ1Zltyb2NrLT5pbmJveG9mZnNldCszXSA9IHJvY2stPmlu
Ym94Y2FzZVszXTsKISAJCW5hbWVidWZbcm9jay0+aW5ib3hvZmZzZXQrNF0gPSByb2NrLT5pbmJv
eGNhc2VbNF07CiEgCSAgICB9CiEgCSAgICBpZigocm9jay0+bmFtZXNwYWNlLT5tYm94bmFtZV90
b2V4dGVybmFsKShyb2NrLT5uYW1lc3BhY2UsIG5hbWVidWYrcm9jay0+aW5ib3hvZmZzZXQsIGF1
dGhfY2Fub251c2VyKHJvY2stPmF1dGhfc3RhdGUpLCBuYW1lYnVmX291dCkpIHsKISAJCXIgPSAw
OwohIAkJYnJlYWs7CiEgCSAgICB9CiEgCSAgICBzdHJjcHkobmFtZWJ1ZiwgbmFtZWJ1Zl9vdXQp
OwogIAohIAkgICAgbWF0Y2hsZW4gPSBnbG9iX3Rlc3QoZywgbmFtZWJ1ZiwKISAJCQkJIHN0cmxl
bihuYW1lYnVmKSwgJm1pbm1hdGNoKTsKICAKKyAJICAgIGlmIChtYXRjaGxlbiA9PSAtMSkgewor
IAkJciA9IDA7CisgCQlicmVhazsKKyAJICAgIH0KKyAJfQorIAkKICAJc3dpdGNoIChyKSB7CiAg
CWNhc2UgMDoKICAJICAgIC8qIGZvdW5kIHRoZSBlbnRyeTsgb3V0cHV0IGl0ICovCioqKioqKioq
KioqKioqKgoqKiogMTkxNSwxOTIxICoqKioKICAJICAgIH0KICAKICAJICAgIHJvY2stPmNoZWNr
c2hhcmVkID0gMDsKISAJICAgIHIgPSAoKnJvY2stPnByb2MpKG5hbWVidWYrcm9jay0+aW5ib3hv
ZmZzZXQsIG1hdGNobGVuLCAKICAJCQkgICAgICAxLCByb2NrLT5wcm9jcm9jayk7CiAgCiAgCSAg
ICBicmVhazsKLS0tIDE5MzAsMTkzNiAtLS0tCiAgCSAgICB9CiAgCiAgCSAgICByb2NrLT5jaGVj
a3NoYXJlZCA9IDA7CiEgCSAgICByID0gKCpyb2NrLT5wcm9jKShuYW1lYnVmLCBtYXRjaGxlbiwg
CiAgCQkJICAgICAgMSwgcm9jay0+cHJvY3JvY2spOwogIAogIAkgICAgYnJlYWs7CioqKioqKioq
KioqKioqKgoqKiogMTk1OSwxOTY1ICoqKioKICAgICAgaW50IHByZWZpeGxlbjsKICAgICAgaW50
IHVzZXJsZW4gPSB1c2VyaWQgPyBzdHJsZW4odXNlcmlkKSA6IDAsIGRvbWFpbmxlbiA9IDA7CiAg
ICAgIGNoYXIgZG9tYWlucGF0W01BWF9NQUlMQk9YX05BTUUrMV0gPSAiIjsgLyogZG8gaW50cmEt
ZG9tYWluIGZldGNoZXMgb25seSAqLwotICAgICBjaGFyICpwYXQgPSBOVUxMOwogIAogICAgICBp
ZiAoY29uZmlnX3ZpcnRkb21haW5zKSB7CiAgCWNoYXIgKmRvbWFpbjsKLS0tIDE5NzQsMTk3OSAt
LS0tCioqKioqKioqKioqKioqKgoqKiogMjAwMCwyMDA3ICoqKioKICAgICAgaWYgKGRvbWFpbnBh
dFswXSA9PSAnXDAnKQogIAlzdHJsY3B5KGRvbWFpbnBhdCwgcGF0dGVybiwgc2l6ZW9mKGRvbWFp
bnBhdCkpOwogIAohICAgICBjYnJvY2suZyA9IGdsb2JfaW5pdChwYXR0ZXJuLCBHTE9CX0hJRVJB
UkNIWXxHTE9CX0lOQk9YQ0FTRSk7CiEgICAgIGNicm9jay5uYW1lc3BhY2UgPSBOVUxMOwogICAg
ICBjYnJvY2suZG9tYWlubGVuID0gZG9tYWlubGVuOwogICAgICBjYnJvY2suaW5ib3hjYXNlID0g
Z2xvYl9pbmJveGNhc2UoY2Jyb2NrLmcpOwogICAgICBjYnJvY2suaXNhZG1pbiA9IGlzYWRtaW47
Ci0tLSAyMDE0LDIwMjEgLS0tLQogICAgICBpZiAoZG9tYWlucGF0WzBdID09ICdcMCcpCiAgCXN0
cmxjcHkoZG9tYWlucGF0LCBwYXR0ZXJuLCBzaXplb2YoZG9tYWlucGF0KSk7CiAgCiEgICAgIGNi
cm9jay5nID0gZ2xvYl9pbml0KHBhdHRlcm4sIG5hbWVzcGFjZS0+aGllcl9zZXAsIEdMT0JfSElF
UkFSQ0hZfEdMT0JfSU5CT1hDQVNFKTsKISAgICAgY2Jyb2NrLm5hbWVzcGFjZSA9IG5hbWVzcGFj
ZTsKICAgICAgY2Jyb2NrLmRvbWFpbmxlbiA9IGRvbWFpbmxlbjsKICAgICAgY2Jyb2NrLmluYm94
Y2FzZSA9IGdsb2JfaW5ib3hjYXNlKGNicm9jay5nKTsKICAgICAgY2Jyb2NrLmlzYWRtaW4gPSBp
c2FkbWluOwoqKioqKioqKioqKioqKioKKioqIDIwMzUsMjA1MCAqKioqCiAgCSAgICB9CiAgCSAg
ICBlbHNlIGlmIChyID09IENZUlVTREJfTk9URk9VTkQpIHIgPSAwOwogIAl9Ci0gCWVsc2UgaWYg
KCFzdHJuY21wKHBhdHRlcm4sCi0gCQkJICB1c2VybWJveG5hbWUrZG9tYWlubGVuLCB1c2VybWJv
eG5hbWVsZW4tZG9tYWlubGVuKSAmJgotIAkJIEdMT0JfVEVTVChjYnJvY2suZywgdXNlcm1ib3hu
YW1lK2RvbWFpbmxlbikgIT0gLTEpIHsKLSAJICAgIHIgPSBEQi0+ZmV0Y2gobWJkYiwgdXNlcm1i
b3huYW1lLCB1c2VybWJveG5hbWVsZW4sCi0gCQkJICAmZGF0YSwgJmRhdGFsZW4sIE5VTEwpOwot
IAkgICAgaWYgKCFyICYmIGRhdGEpIHsKLSAJCXIgPSAoKnByb2MpKHVzZXJtYm94bmFtZSwgdXNl
cm1ib3huYW1lbGVuLCAxLCByb2NrKTsKLSAJICAgIH0KLSAJICAgIGVsc2UgaWYgKHIgPT0gQ1lS
VVNEQl9OT1RGT1VORCkgciA9IDA7Ci0gCX0KICAJc3RybGNhdCh1c2VybWJveG5hbWUsICIuIiwg
c2l6ZW9mKHVzZXJtYm94bmFtZSkpOwogIAl1c2VybWJveG5hbWVsZW4rKzsKICAKLS0tIDIwNDks
MjA1NCAtLS0tCioqKioqKioqKioqKioqKgoqKiogMjA1NywyMDg5ICoqKioKICAKICAgICAgaWYg
KHIpIGdvdG8gZG9uZTsKICAKLSAgICAgLyogTWFrZSBhIHdvcmtpbmcgY29weSBvZiBwYXR0ZXJu
ICovCi0gICAgIHBhdHRlcm4gPSBwYXQgPSB4c3RyZHVwKHBhdHRlcm4pOwotIAogICAgICAvKiBG
aW5kIGZpeGVkLXN0cmluZyBwYXR0ZXJuIHByZWZpeCAqLwohICAgICBmb3IgKHAgPSBwYXQ7ICpw
OyBwKyspIHsKISAJaWYgKCpwID09ICcqJyB8fCAqcCA9PSAnJScgfHwgKnAgPT0gJz8nIHx8ICpw
ID09ICdAJykgYnJlYWs7CiAgICAgIH0KICAgICAgcHJlZml4bGVuID0gcCAtIHBhdHRlcm47Ci0g
ICAgICpwID0gJ1wwJzsKICAKICAgICAgLyoKISAgICAgICogSWYgdXNlci5YLiogb3IgSU5CT1gu
KiBjYW4gbWF0Y2ggcGF0dGVybiwKICAgICAgICogc2VhcmNoIGZvciB0aG9zZSBtYWlsYm94ZXMg
bmV4dAogICAgICAgKi8KICAgICAgaWYgKHVzZXJpZCAmJgohIAkoIXN0cm5jbXAodXNlcm1ib3hu
YW1lK2RvbWFpbmxlbiwgcGF0dGVybiwgdXNlcm1ib3huYW1lbGVuLWRvbWFpbmxlbi0xKSB8fAoh
IAkgIXN0cm5jYXNlY21wKCJpbmJveC4iLCBwYXR0ZXJuLCBwcmVmaXhsZW4gPCA2ID8gcHJlZml4
bGVuIDogNikpKSB7CiAgCiEgCWlmICghc3RybmNtcCh1c2VybWJveG5hbWUrZG9tYWlubGVuLCBw
YXR0ZXJuLCB1c2VybWJveG5hbWVsZW4tZG9tYWlubGVuLTEpKSB7CiEgCSAgICAvKiBzd2l0Y2gg
dG8gcGF0dGVybiB3aXRoIGRvbWFpbiBwcmVwZW5kZWQgKi8KISAJICAgIGdsb2JfZnJlZSgmY2Jy
b2NrLmcpOwohIAkgICAgY2Jyb2NrLmcgPSBnbG9iX2luaXQoZG9tYWlucGF0LCBHTE9CX0hJRVJB
UkNIWSk7CiEgCSAgICBjYnJvY2suaW5ib3hvZmZzZXQgPSAwOwohIAl9CiEgCWVsc2UgewohIAkg
ICAgY2Jyb2NrLmluYm94b2Zmc2V0ID0gZG9tYWlubGVuICsgdXNlcmxlbjsKISAJfQogIAogIAlj
YnJvY2suZmluZF9uYW1lc3BhY2UgPSBOQU1FU1BBQ0VfSU5CT1g7CiAgCS8qIGl0ZXJhdGUgdGhy
b3VnaCBwcmVmaXhlcyBtYXRjaGluZyB1c2VybWJveG5hbWUgKi8KLS0tIDIwNjEsMjA4MiAtLS0t
CiAgCiAgICAgIGlmIChyKSBnb3RvIGRvbmU7CiAgCiAgICAgIC8qIEZpbmQgZml4ZWQtc3RyaW5n
IHBhdHRlcm4gcHJlZml4ICovCiEgICAgIGZvciAocCA9IChjaGFyICopcGF0dGVybjsgKnA7IHAr
KykgewohIAkvKiBzdG9wIGF0IHRoZSBzZXBhcmF0b3IgdG9vICovCiEgCWlmICgqcCA9PSAnKicg
fHwgKnAgPT0gJyUnIHx8ICpwID09ICc/JyB8fCAqcCA9PSAnQCcgfHwgKnAgPT0gbmFtZXNwYWNl
LT5oaWVyX3NlcCkgYnJlYWs7CiAgICAgIH0KICAgICAgcHJlZml4bGVuID0gcCAtIHBhdHRlcm47
CiAgCiAgICAgIC8qCiEgICAgICAqIElmIElOQk9YPGhpZXJfc2VwPiogY2FuIG1hdGNoIHBhdHRl
cm4sCiAgICAgICAqIHNlYXJjaCBmb3IgdGhvc2UgbWFpbGJveGVzIG5leHQKICAgICAgICovCiAg
ICAgIGlmICh1c2VyaWQgJiYKISAJIXN0cm5jYXNlY21wKCJpbmJveCIsIHBhdHRlcm4sIHByZWZp
eGxlbiA8IDUgPyBwcmVmaXhsZW4gOiA1KSAmJgohIAkocHJlZml4bGVuPDYgfHwgcGF0dGVybls1
XT09bmFtZXNwYWNlLT5oaWVyX3NlcCkpIHsKICAKISAJY2Jyb2NrLmluYm94b2Zmc2V0ID0gZG9t
YWlubGVuICsgdXNlcmxlbjsKICAKICAJY2Jyb2NrLmZpbmRfbmFtZXNwYWNlID0gTkFNRVNQQUNF
X0lOQk9YOwogIAkvKiBpdGVyYXRlIHRocm91Z2ggcHJlZml4ZXMgbWF0Y2hpbmcgdXNlcm1ib3hu
YW1lICovCioqKioqKioqKioqKioqKgoqKiogMjA5NSwyMTAzICoqKioKICAKICAgICAgaWYoIXIp
IHsKICAJY2Jyb2NrLmZpbmRfbmFtZXNwYWNlID0gTkFNRVNQQUNFX1VTRVI7Ci0gCS8qIHN3aXRj
aCB0byBwYXR0ZXJuIHdpdGggZG9tYWluIHByZXBlbmRlZCAqLwogIAlnbG9iX2ZyZWUoJmNicm9j
ay5nKTsKISAJY2Jyb2NrLmcgPSBnbG9iX2luaXQoZG9tYWlucGF0LCBHTE9CX0hJRVJBUkNIWSk7
CiAgCWNicm9jay5pbmJveG9mZnNldCA9IDA7CiAgCWlmICh1c2VybWJveG5hbWVsZW4pIHsKICAJ
ICAgIHVzZXJtYm94bmFtZVstLXVzZXJtYm94bmFtZWxlbl0gPSAnXDAnOwotLS0gMjA4OCwyMDk1
IC0tLS0KICAKICAgICAgaWYoIXIpIHsKICAJY2Jyb2NrLmZpbmRfbmFtZXNwYWNlID0gTkFNRVNQ
QUNFX1VTRVI7CiAgCWdsb2JfZnJlZSgmY2Jyb2NrLmcpOwohIAljYnJvY2suZyA9IGdsb2JfaW5p
dChwYXR0ZXJuLCBuYW1lc3BhY2UtPmhpZXJfc2VwLCBHTE9CX0hJRVJBUkNIWSk7CiAgCWNicm9j
ay5pbmJveG9mZnNldCA9IDA7CiAgCWlmICh1c2VybWJveG5hbWVsZW4pIHsKICAJICAgIHVzZXJt
Ym94bmFtZVstLXVzZXJtYm94bmFtZWxlbl0gPSAnXDAnOwoqKioqKioqKioqKioqKioKKioqIDIx
MTYsMjEyMiAqKioqCiAgCiAgICBkb25lOgogICAgICBnbG9iX2ZyZWUoJmNicm9jay5nKTsKLSAg
ICAgaWYgKHBhdCkgZnJlZShwYXQpOwogIAogICAgICByZXR1cm4gcjsKICB9Ci0tLSAyMTA4LDIx
MTMgLS0tLQoqKioqKioqKioqKioqKioKKioqIDIxNDYsMjE1MiAqKioqCiAgICAgIGVsc2UKICAJ
ZG9tYWlucGF0WzBdID0gJ1wwJzsKICAKISAgICAgY2Jyb2NrLmcgPSBnbG9iX2luaXQocGF0dGVy
biwgR0xPQl9ISUVSQVJDSFl8R0xPQl9JTkJPWENBU0UpOwogICAgICBjYnJvY2submFtZXNwYWNl
ID0gbmFtZXNwYWNlOwogICAgICBjYnJvY2suZG9tYWlubGVuID0gZG9tYWlubGVuOwogICAgICBj
YnJvY2suaW5ib3hjYXNlID0gZ2xvYl9pbmJveGNhc2UoY2Jyb2NrLmcpOwotLS0gMjEzNywyMTQz
IC0tLS0KICAgICAgZWxzZQogIAlkb21haW5wYXRbMF0gPSAnXDAnOwogIAohICAgICBjYnJvY2su
ZyA9IGdsb2JfaW5pdChwYXR0ZXJuLCBuYW1lc3BhY2UtPmhpZXJfc2VwLCBHTE9CX0hJRVJBUkNI
WXxHTE9CX0lOQk9YQ0FTRSk7CiAgICAgIGNicm9jay5uYW1lc3BhY2UgPSBuYW1lc3BhY2U7CiAg
ICAgIGNicm9jay5kb21haW5sZW4gPSBkb21haW5sZW47CiAgICAgIGNicm9jay5pbmJveGNhc2Ug
PSBnbG9iX2luYm94Y2FzZShjYnJvY2suZyk7CioqKioqKioqKioqKioqKgoqKiogMjIwOCwyMjE5
ICoqKioKICAgICAgLyoKICAgICAgICogUGVyc29uYWwgKElOQk9YKSBuYW1lc3BhY2UKICAgICAg
ICoKISAgICAgICogQXBwZW5kIHBhdHRlcm4gdG8gIklOQk9YLiIsIHNlYXJjaCBmb3IgdGhvc2Ug
bWFpbGJveGVzIG5leHQKICAgICAgICovCiAgICAgIGlmICh1c2VyaWQpIHsKISAJc3RybGNweShw
YXRidWYsICJJTkJPWC4iLCBzaXplb2YocGF0YnVmKSk7CiEgCXN0cmxjYXQocGF0YnVmLCBwYXR0
ZXJuLCBzaXplb2YocGF0YnVmKSk7CiEgCWNicm9jay5nID0gZ2xvYl9pbml0KHBhdGJ1ZiwgR0xP
Ql9ISUVSQVJDSFl8R0xPQl9JTkJPWENBU0UpOwogIAljYnJvY2suaW5ib3hjYXNlID0gZ2xvYl9p
bmJveGNhc2UoY2Jyb2NrLmcpOwogIAljYnJvY2suaW5ib3hvZmZzZXQgPSBkb21haW5sZW4rdXNl
cmxlbjsKICAJY2Jyb2NrLmZpbmRfbmFtZXNwYWNlID0gTkFNRVNQQUNFX0lOQk9YOwotLS0gMjE5
OSwyMjA5IC0tLS0KICAgICAgLyoKICAgICAgICogUGVyc29uYWwgKElOQk9YKSBuYW1lc3BhY2UK
ICAgICAgICoKISAgICAgICogU2VhcmNoIGZvciAiSU5CT1guKiIgbWFpbGJveGVzIG5leHQKICAg
ICAgICovCiAgICAgIGlmICh1c2VyaWQpIHsKISAJLyogZG9uJ3QgdG91Y2ggdGhlIHBhdHRlcm4h
IC8vIHNvcmNlcmVyICovCiEgCWNicm9jay5nID0gZ2xvYl9pbml0KHBhdHRlcm4sIG5hbWVzcGFj
ZS0+aGllcl9zZXAsIEdMT0JfSElFUkFSQ0hZfEdMT0JfSU5CT1hDQVNFKTsKICAJY2Jyb2NrLmlu
Ym94Y2FzZSA9IGdsb2JfaW5ib3hjYXNlKGNicm9jay5nKTsKICAJY2Jyb2NrLmluYm94b2Zmc2V0
ID0gZG9tYWlubGVuK3VzZXJsZW47CiAgCWNicm9jay5maW5kX25hbWVzcGFjZSA9IE5BTUVTUEFD
RV9JTkJPWDsKKioqKioqKioqKioqKioqCioqKiAyMjQzLDIyNTkgKioqKgogIAogICAgICBpZiAo
IXN0cm5jbXAobmFtZXNwYWNlLT5wcmVmaXhbTkFNRVNQQUNFX1VTRVJdLCBwYXR0ZXJuLAogIAkJ
IHByZWZpeGxlbiA8IGxlbiA/IHByZWZpeGxlbiA6IGxlbikpIHsKICAKLSAJaWYgKHByZWZpeGxl
biA8IGxlbikgewotIAkgICAgc3RybGNweShkb21haW5wYXQrZG9tYWlubGVuLCBwYXR0ZXJuK3By
ZWZpeGxlbiwKLSAJCSAgICBzaXplb2YoZG9tYWlucGF0KS1kb21haW5sZW4pOwotIAkgICAgY2Jy
b2NrLmcgPSBnbG9iX2luaXQoZG9tYWlucGF0LCBHTE9CX0hJRVJBUkNIWSk7Ci0gCX0KLSAJZWxz
ZSB7Ci0gCSAgICBzdHJsY3B5KGRvbWFpbnBhdCtkb21haW5sZW4sICJ1c2VyIiwgc2l6ZW9mKGRv
bWFpbnBhdCktZG9tYWlubGVuKTsKLSAJICAgIHN0cmxjYXQoZG9tYWlucGF0LCBwYXR0ZXJuK2xl
biwgc2l6ZW9mKGRvbWFpbnBhdCkpOwotIAkgICAgY2Jyb2NrLmcgPSBnbG9iX2luaXQoZG9tYWlu
cGF0LCBHTE9CX0hJRVJBUkNIWSk7Ci0gCX0KICAJY2Jyb2NrLmZpbmRfbmFtZXNwYWNlID0gTkFN
RVNQQUNFX1VTRVI7CiAgCWNicm9jay5pbmJveG9mZnNldCA9IDA7CiAgCQotLS0gMjIzMywyMjQy
IC0tLS0KICAKICAgICAgaWYgKCFzdHJuY21wKG5hbWVzcGFjZS0+cHJlZml4W05BTUVTUEFDRV9V
U0VSXSwgcGF0dGVybiwKICAJCSBwcmVmaXhsZW4gPCBsZW4gPyBwcmVmaXhsZW4gOiBsZW4pKSB7
CisgCS8qIHdlJ2xsIHNlYXJjaCBmb3IgdGhlIHJlcXVlc3RlZCBwYXR0ZXJuIGRvbid0IG1ha2lu
ZyBhbnkKKyAJICAgc3R1cGlkIG1vZGlmaWNhdGlvbnMgb2YgaXQgLy8gc29yY2VyZXIgKi8KKyAJ
Y2Jyb2NrLmcgPSBnbG9iX2luaXQocGF0dGVybiwgbmFtZXNwYWNlLT5oaWVyX3NlcCwgR0xPQl9I
SUVSQVJDSFkpOwogIAogIAljYnJvY2suZmluZF9uYW1lc3BhY2UgPSBOQU1FU1BBQ0VfVVNFUjsK
ICAJY2Jyb2NrLmluYm94b2Zmc2V0ID0gMDsKICAJCioqKioqKioqKioqKioqKgoqKiogMjI4NSwy
Mjk1ICoqKioKICAJICAgIC8qIFNraXAgcGF0dGVybiB3aGljaCBtYXRjaGVzIHNoYXJlZCBuYW1l
c3BhY2UgcHJlZml4ICovCiAgCSAgICBmb3IgKHAgPSBwYXQrcHJlZml4bGVuOyAqcDsgcCsrKSB7
CiAgCQlpZiAoKnAgPT0gJyUnKSBjb250aW51ZTsKISAJCWVsc2UgaWYgKCpwID09ICcuJykgcCsr
OwogIAkJYnJlYWs7CiAgCSAgICB9CiAgCiEgCSAgICBpZiAoKnBhdHRlcm4gJiYgIXN0cmNocihw
YXR0ZXJuLCAnLicpICYmCiAgCQlwYXR0ZXJuW3N0cmxlbihwYXR0ZXJuKS0xXSA9PSAnJScpIHsK
ICAJCS8qIHNwZWNpYWwgY2FzZTogIExJU1QgIiIgKiUgLS0gb3V0cHV0IHByZWZpeCAqLwogICAg
CQljYnJvY2suY2hlY2tzaGFyZWQgPSAxOwotLS0gMjI2OCwyMjc4IC0tLS0KICAJICAgIC8qIFNr
aXAgcGF0dGVybiB3aGljaCBtYXRjaGVzIHNoYXJlZCBuYW1lc3BhY2UgcHJlZml4ICovCiAgCSAg
ICBmb3IgKHAgPSBwYXQrcHJlZml4bGVuOyAqcDsgcCsrKSB7CiAgCQlpZiAoKnAgPT0gJyUnKSBj
b250aW51ZTsKISAJCWVsc2UgaWYgKCpwID09IG5hbWVzcGFjZS0+aGllcl9zZXApIHArKzsKICAJ
CWJyZWFrOwogIAkgICAgfQogIAohIAkgICAgaWYgKCpwYXR0ZXJuICYmICFzdHJjaHIocGF0dGVy
biwgbmFtZXNwYWNlLT5oaWVyX3NlcCkgJiYKICAJCXBhdHRlcm5bc3RybGVuKHBhdHRlcm4pLTFd
ID09ICclJykgewogIAkJLyogc3BlY2lhbCBjYXNlOiAgTElTVCAiIiAqJSAtLSBvdXRwdXQgcHJl
Zml4ICovCiAgICAJCWNicm9jay5jaGVja3NoYXJlZCA9IDE7CioqKioqKioqKioqKioqKgoqKiog
MjI5OCwyMzIyICoqKioKICAJICAgIGlmICgoY2Jyb2NrLmNoZWNrc2hhcmVkIHx8IHByZWZpeGxl
biA9PSBsZW4pICYmICEqcCkgewogIAkJLyogc3BlY2lhbCBjYXNlOiAgTElTVCAiIiAlIC0tIG91
dHB1dCBwcmVmaXgKICAgCQkgICAoaWYgd2UgaGF2ZSBhIHNoYXJlZCBtYm94KSBhbmQgcXVpdCAq
LwohIAkJc3RybGNweShkb21haW5wYXQrZG9tYWlubGVuLCAiKiIsIHNpemVvZihkb21haW5wYXQp
LWRvbWFpbmxlbik7CiEgCQljYnJvY2suZyA9IGdsb2JfaW5pdChkb21haW5wYXQsIEdMT0JfSElF
UkFSQ0hZKTsKICAJCWNicm9jay5jaGVja3NoYXJlZCA9IDI7CiAgCSAgICB9CiEgCSAgICBlbHNl
IHsKISAJCXN0cmxjcHkoZG9tYWlucGF0K2RvbWFpbmxlbiwgcCwgc2l6ZW9mKGRvbWFpbnBhdCkt
ZG9tYWlubGVuKTsKISAJCWNicm9jay5nID0gZ2xvYl9pbml0KGRvbWFpbnBhdCwgR0xPQl9ISUVS
QVJDSFkpOwohIAkgICAgfQohIAkJCiAgCSAgICBkb21haW5wYXRbZG9tYWlubGVuXSA9ICdcMCc7
CiAgCSAgICBEQi0+Zm9yZWFjaChtYmRiLAogIAkJCWRvbWFpbnBhdCwgZG9tYWlubGVuLAogIAkJ
CSZmaW5kX3AsICZmaW5kX2NiLCAmY2Jyb2NrLAogIAkJCU5VTEwpOwogIAl9CiEgCWVsc2UgaWYg
KHBhdHRlcm5bbGVuXSA9PSAnLicpIHsKISAJICAgIHN0cmxjcHkoZG9tYWlucGF0K2RvbWFpbmxl
biwgcGF0dGVybitsZW4rMSwKISAJCSAgICBzaXplb2YoZG9tYWlucGF0KS1kb21haW5sZW4pOwoh
IAkgICAgY2Jyb2NrLmcgPSBnbG9iX2luaXQoZG9tYWlucGF0LCBHTE9CX0hJRVJBUkNIWSk7CiAg
CiAgCSAgICBEQi0+Zm9yZWFjaChtYmRiLAogIAkJCWRvbWFpbnBhdCwgZG9tYWlubGVuK3ByZWZp
eGxlbi0obGVuKzEpLAotLS0gMjI4MSwyMzAxIC0tLS0KICAJICAgIGlmICgoY2Jyb2NrLmNoZWNr
c2hhcmVkIHx8IHByZWZpeGxlbiA9PSBsZW4pICYmICEqcCkgewogIAkJLyogc3BlY2lhbCBjYXNl
OiAgTElTVCAiIiAlIC0tIG91dHB1dCBwcmVmaXgKICAgCQkgICAoaWYgd2UgaGF2ZSBhIHNoYXJl
ZCBtYm94KSBhbmQgcXVpdCAqLwohIAkJY2Jyb2NrLmcgPSBnbG9iX2luaXQoIioiLCBuYW1lc3Bh
Y2UtPmhpZXJfc2VwLCBHTE9CX0hJRVJBUkNIWSk7CiAgCQljYnJvY2suY2hlY2tzaGFyZWQgPSAy
OwogIAkgICAgfQohIAkgICAgZWxzZQohIAkJY2Jyb2NrLmcgPSBnbG9iX2luaXQocGF0LCBuYW1l
c3BhY2UtPmhpZXJfc2VwLCBHTE9CX0hJRVJBUkNIWSk7CiEgCiAgCSAgICBkb21haW5wYXRbZG9t
YWlubGVuXSA9ICdcMCc7CiAgCSAgICBEQi0+Zm9yZWFjaChtYmRiLAogIAkJCWRvbWFpbnBhdCwg
ZG9tYWlubGVuLAogIAkJCSZmaW5kX3AsICZmaW5kX2NiLCAmY2Jyb2NrLAogIAkJCU5VTEwpOwog
IAl9CiEgCWVsc2UgaWYgKHBhdHRlcm5bbGVuXSA9PSBuYW1lc3BhY2UtPmhpZXJfc2VwKSB7CiEg
CSAgICBzbnByaW50Zihkb21haW5wYXQrZG9tYWlubGVuLCBzaXplb2YoZG9tYWlucGF0KS1kb21h
aW5sZW4sICIlLipzIiwgcHJlZml4bGVuLShsZW4rMSksIHBhdHRlcm4rbGVuKzEpOwohIAkgICAg
Y2Jyb2NrLmcgPSBnbG9iX2luaXQocGF0dGVybiwgbmFtZXNwYWNlLT5oaWVyX3NlcCwgR0xPQl9I
SUVSQVJDSFkpOwogIAogIAkgICAgREItPmZvcmVhY2gobWJkYiwKICAJCQlkb21haW5wYXQsIGRv
bWFpbmxlbitwcmVmaXhsZW4tKGxlbisxKSwKKioqKioqKioqKioqKioqCioqKiAyMzk0LDI0MDAg
KioqKgogIAlpZiAocikgewogIAkgICAgaWYgKCFmb3JjZSAmJiByID09IElNQVBfTUFJTEJPWF9O
T05FWElTVEVOVCkgewogIAkJLyogbG9vayBmb3IgYSBjaGlsZCBtYWlsYm94IGluIHRoZSBwcm9w
b3NlZCBxdW90YXJvb3QgKi8KISAJCW1ib3hsaXN0X2ZpbmRhbGwoTlVMTCwgcGF0dGVybiwgMSwg
TlVMTCwgTlVMTCwKICAJCQkJIGNoaWxkX2NiLCAodm9pZCAqKSAmZm9yY2UpOwogIAkgICAgfQog
IAotLS0gMjM3MywyMzc5IC0tLS0KICAJaWYgKHIpIHsKICAJICAgIGlmICghZm9yY2UgJiYgciA9
PSBJTUFQX01BSUxCT1hfTk9ORVhJU1RFTlQpIHsKICAJCS8qIGxvb2sgZm9yIGEgY2hpbGQgbWFp
bGJveCBpbiB0aGUgcHJvcG9zZWQgcXVvdGFyb290ICovCiEgCQltYm94bGlzdF9maW5kYWxsKCZp
bnRlcm5hbF9uYW1lc3BhY2UsIHBhdHRlcm4sIDEsIE5VTEwsIE5VTEwsCiAgCQkJCSBjaGlsZF9j
YiwgKHZvaWQgKikgJmZvcmNlKTsKICAJICAgIH0KICAKKioqKioqKioqKioqKioqCioqKiAyNDI1
LDI0MzEgKioqKgogICAgICBpZihoYXZlX21haWxib3gpCiAgCW1ib3hsaXN0X2NoYW5nZXF1b3Rh
KHF1b3RhLnJvb3QsIDAsIDAsICZjcm9jayk7CiAgICAgIC8qIHN1Ym1haWxib3hlcyAtIHdlJ3Jl
IHVzaW5nIGludGVybmFsIG5hbWVzIGhlcmUgKi8KISAgICAgbWJveGxpc3RfZmluZGFsbChOVUxM
LCBwYXR0ZXJuLCAxLCAwLCAwLCBtYm94bGlzdF9jaGFuZ2VxdW90YSwgJmNyb2NrKTsKICAgICAg
CiAgICAgIHIgPSBxdW90YV93cml0ZSgmcXVvdGEsICZ0aWQpOwogICAgICBpZiAoIXIpIHF1b3Rh
X2NvbW1pdCgmdGlkKTsKLS0tIDI0MDQsMjQxMCAtLS0tCiAgICAgIGlmKGhhdmVfbWFpbGJveCkK
ICAJbWJveGxpc3RfY2hhbmdlcXVvdGEocXVvdGEucm9vdCwgMCwgMCwgJmNyb2NrKTsKICAgICAg
Lyogc3VibWFpbGJveGVzIC0gd2UncmUgdXNpbmcgaW50ZXJuYWwgbmFtZXMgaGVyZSAqLwohICAg
ICBtYm94bGlzdF9maW5kYWxsKCZpbnRlcm5hbF9uYW1lc3BhY2UsIHBhdHRlcm4sIDEsIDAsIDAs
IG1ib3hsaXN0X2NoYW5nZXF1b3RhLCAmY3JvY2spOwogICAgICAKICAgICAgciA9IHF1b3RhX3dy
aXRlKCZxdW90YSwgJnRpZCk7CiAgICAgIGlmICghcikgcXVvdGFfY29tbWl0KCZ0aWQpOwoqKioq
KioqKioqKioqKioKKioqIDI0OTEsMjQ5NyAqKioqCiAgICAgICAgICAgICAgfQogICAgICAgICAg
ICAgIC8qIHN1Ym1haWxib3hlcyAtIHdlJ3JlIHVzaW5nIGludGVybmFsIG5hbWVzIGhlcmUgKi8K
ICAgICAgICAgICAgICBpZiAoIWspCiEgICAgICAgICAgICAgICAgIGsgPSBtYm94bGlzdF9maW5k
YWxsKE5VTEwsIHBhdHRlcm4sIDEsIDAsIDAsIG1ib3hsaXN0X2NoYW5nZXF1b3RhLCAmY3JvY2sp
OwogICAgICAgICAgICAgIGlmKCFrKQogICAgICAgICAgICAgICAgICBrID0gcXVvdGFfd3JpdGUo
JnJvb3RxdW90YSwgY3JvY2sudGlkKTsKICAKLS0tIDI0NzAsMjQ3NiAtLS0tCiAgICAgICAgICAg
ICAgfQogICAgICAgICAgICAgIC8qIHN1Ym1haWxib3hlcyAtIHdlJ3JlIHVzaW5nIGludGVybmFs
IG5hbWVzIGhlcmUgKi8KICAgICAgICAgICAgICBpZiAoIWspCiEgICAgICAgICAgICAgICAgIGsg
PSBtYm94bGlzdF9maW5kYWxsKCZpbnRlcm5hbF9uYW1lc3BhY2UsIHBhdHRlcm4sIDEsIDAsIDAs
IG1ib3hsaXN0X2NoYW5nZXF1b3RhLCAmY3JvY2spOwogICAgICAgICAgICAgIGlmKCFrKQogICAg
ICAgICAgICAgICAgICBrID0gcXVvdGFfd3JpdGUoJnJvb3RxdW90YSwgY3JvY2sudGlkKTsKICAK
KioqKioqKioqKioqKioqCioqKiAyNTAwLDI1MDYgKioqKgogICAgICAgICAgICAgLyogdG9wIGxl
dmVsIG1haWxib3ggKi8KICAgICAgICAgICAgIG1ib3hsaXN0X3JtcXVvdGEocm9vdCwgMCwgMCwg
KHZvaWQgKilyb290KTsKICAgICAgICAgICAgIC8qIHN1Ym1haWxib3hlcyAtIHdlJ3JlIHVzaW5n
IGludGVybmFsIG5hbWVzIGhlcmUgKi8KISAgICAgICAgICAgIG1ib3hsaXN0X2ZpbmRhbGwoTlVM
TCwgcGF0dGVybiwgMSwgMCwgMCwgbWJveGxpc3Rfcm1xdW90YSwgKHZvaWQgKilyb290KTsKICAg
ICAgICAgfQogICAgICB9CiAgCi0tLSAyNDc5LDI0ODUgLS0tLQogICAgICAgICAgICAgLyogdG9w
IGxldmVsIG1haWxib3ggKi8KICAgICAgICAgICAgIG1ib3hsaXN0X3JtcXVvdGEocm9vdCwgMCwg
MCwgKHZvaWQgKilyb290KTsKICAgICAgICAgICAgIC8qIHN1Ym1haWxib3hlcyAtIHdlJ3JlIHVz
aW5nIGludGVybmFsIG5hbWVzIGhlcmUgKi8KISAgICAgICAgICAgIG1ib3hsaXN0X2ZpbmRhbGwo
JmludGVybmFsX25hbWVzcGFjZSwgcGF0dGVybiwgMSwgMCwgMCwgbWJveGxpc3Rfcm1xdW90YSwg
KHZvaWQgKilyb290KTsKICAgICAgICAgfQogICAgICB9CiAgCioqKioqKioqKioqKioqKgoqKiog
MjgwNiwyODEyICoqKioKICAgICAgaW50IHByZWZpeGxlbjsKICAgICAgaW50IHVzZXJsZW4gPSB1
c2VyaWQgPyBzdHJsZW4odXNlcmlkKSA6IDAsIGRvbWFpbmxlbiA9IDA7CiAgICAgIGNoYXIgZG9t
YWlucGF0W01BWF9NQUlMQk9YX05BTUUrMV07IC8qIGRvIGludHJhLWRvbWFpbiBmZXRjaGVzIG9u
bHkgKi8KLSAgICAgY2hhciAqcGF0ID0gTlVMTDsKICAKICAgICAgaWYgKGNvbmZpZ192aXJ0ZG9t
YWlucyAmJiB1c2VyaWQgJiYgKHAgPSBzdHJjaHIodXNlcmlkLCAnQCcpKSkgewogIAl1c2VybGVu
ID0gcCAtIHVzZXJpZDsKLS0tIDI3ODUsMjc5MCAtLS0tCioqKioqKioqKioqKioqKgoqKiogMjgx
NiwyODIzICoqKioKICAgICAgZWxzZQogIAlzdHJuY3B5KGRvbWFpbnBhdCwgcGF0dGVybiwgc2l6
ZW9mKGRvbWFpbnBhdCkpOwogIAohICAgICBjYnJvY2suZyA9IGdsb2JfaW5pdChwYXR0ZXJuLCBH
TE9CX0hJRVJBUkNIWXxHTE9CX0lOQk9YQ0FTRSk7CiEgICAgIGNicm9jay5uYW1lc3BhY2UgPSBO
VUxMOwogICAgICBjYnJvY2suZG9tYWlubGVuID0gZG9tYWlubGVuOwogICAgICBjYnJvY2suaW5i
b3hjYXNlID0gZ2xvYl9pbmJveGNhc2UoY2Jyb2NrLmcpOwogICAgICBjYnJvY2suaXNhZG1pbiA9
IDE7CQkvKiB1c2VyIGNhbiBhbHdheXMgc2VlIHRoZWlyIHN1YnMgKi8KLS0tIDI3OTQsMjgwMSAt
LS0tCiAgICAgIGVsc2UKICAJc3RybmNweShkb21haW5wYXQsIHBhdHRlcm4sIHNpemVvZihkb21h
aW5wYXQpKTsKICAKISAgICAgY2Jyb2NrLmcgPSBnbG9iX2luaXQocGF0dGVybiwgbmFtZXNwYWNl
LT5oaWVyX3NlcCwgR0xPQl9ISUVSQVJDSFl8R0xPQl9JTkJPWENBU0UpOwohICAgICBjYnJvY2su
bmFtZXNwYWNlID0gbmFtZXNwYWNlOwogICAgICBjYnJvY2suZG9tYWlubGVuID0gZG9tYWlubGVu
OwogICAgICBjYnJvY2suaW5ib3hjYXNlID0gZ2xvYl9pbmJveGNhc2UoY2Jyb2NrLmcpOwogICAg
ICBjYnJvY2suaXNhZG1pbiA9IDE7CQkvKiB1c2VyIGNhbiBhbHdheXMgc2VlIHRoZWlyIHN1YnMg
Ki8KKioqKioqKioqKioqKioqCioqKiAyODU3LDI4NzIgKioqKgogIAkgICAgfQogIAkgICAgZWxz
ZSBpZiAociA9PSBDWVJVU0RCX05PVEZPVU5EKSByID0gMDsKICAJfQotIAllbHNlIGlmICghc3Ry
bmNtcChwYXR0ZXJuLAotIAkJCSAgdXNlcm1ib3huYW1lK2RvbWFpbmxlbiwgdXNlcm1ib3huYW1l
bGVuLWRvbWFpbmxlbikgJiYKLSAJCSBHTE9CX1RFU1QoY2Jyb2NrLmcsIHVzZXJtYm94bmFtZStk
b21haW5sZW4pICE9IC0xKSB7Ci0gCSAgICByID0gU1VCREItPmZldGNoKHN1YnMsIHVzZXJtYm94
bmFtZSwgdXNlcm1ib3huYW1lbGVuLAotIAkJCSAgICAgJmRhdGEsICZkYXRhbGVuLCBOVUxMKTsK
LSAJICAgIGlmICghciAmJiBkYXRhKSB7Ci0gCQlyID0gKCpwcm9jKSh1c2VybWJveG5hbWUsIHVz
ZXJtYm94bmFtZWxlbiwgMSwgcm9jayk7Ci0gCSAgICB9Ci0gCSAgICBlbHNlIGlmIChyID09IENZ
UlVTREJfTk9URk9VTkQpIHIgPSAwOwotIAl9CiAgCXN0cmxjYXQodXNlcm1ib3huYW1lLCAiLiIs
IHNpemVvZih1c2VybWJveG5hbWUpKTsKICAJdXNlcm1ib3huYW1lbGVuKys7CiAgCi0tLSAyODM1
LDI4NDAgLS0tLQoqKioqKioqKioqKioqKioKKioqIDI4NzYsMjkwOCAqKioqCiAgCiAgICAgIGlm
IChyKSBnb3RvIGRvbmU7CiAgCi0gICAgIC8qIE1ha2UgYSB3b3JraW5nIGNvcHkgb2YgcGF0dGVy
biAqLwotICAgICBwYXR0ZXJuID0gcGF0ID0geHN0cmR1cChwYXR0ZXJuKTsKLSAKICAgICAgLyog
RmluZCBmaXhlZC1zdHJpbmcgcGF0dGVybiBwcmVmaXggKi8KISAgICAgZm9yIChwID0gcGF0OyAq
cDsgcCsrKSB7CiEgCWlmICgqcCA9PSAnKicgfHwgKnAgPT0gJyUnIHx8ICpwID09ICc/JyB8fCAq
cCA9PSAnQCcpIGJyZWFrOwogICAgICB9CiAgICAgIHByZWZpeGxlbiA9IHAgLSBwYXR0ZXJuOwot
ICAgICAqcCA9ICdcMCc7CiAgCiAgICAgIC8qCiEgICAgICAqIElmIHVzZXIuWC4qIG9yIElOQk9Y
LiogY2FuIG1hdGNoIHBhdHRlcm4sCiAgICAgICAqIHNlYXJjaCBmb3IgdGhvc2UgbWFpbGJveGVz
IG5leHQKICAgICAgICovCiAgICAgIGlmICh1c2VyaWQgJiYKISAJKCFzdHJuY21wKHVzZXJtYm94
bmFtZStkb21haW5sZW4sIHBhdHRlcm4sIHVzZXJtYm94bmFtZWxlbi1kb21haW5sZW4tMSkgfHwK
ISAJICFzdHJuY2FzZWNtcCgiaW5ib3guIiwgcGF0dGVybiwgcHJlZml4bGVuIDwgNiA/IHByZWZp
eGxlbiA6IDYpKSkgewogIAohIAlpZiAoIXN0cm5jbXAodXNlcm1ib3huYW1lK2RvbWFpbmxlbiwg
cGF0dGVybiwgdXNlcm1ib3huYW1lbGVuLWRvbWFpbmxlbi0xKSkgewohIAkgICAgLyogc3dpdGNo
IHRvIHBhdHRlcm4gd2l0aCBkb21haW4gcHJlcGVuZGVkICovCiEgCSAgICBnbG9iX2ZyZWUoJmNi
cm9jay5nKTsKISAJICAgIGNicm9jay5nID0gZ2xvYl9pbml0KGRvbWFpbnBhdCwgR0xPQl9ISUVS
QVJDSFkpOwohIAkgICAgY2Jyb2NrLmluYm94b2Zmc2V0ID0gMDsKISAJfQohIAllbHNlIHsKISAJ
ICAgIGNicm9jay5pbmJveG9mZnNldCA9IHN0cmxlbih1c2VyaWQpOwohIAl9CiAgCiAgCWNicm9j
ay5maW5kX25hbWVzcGFjZSA9IE5BTUVTUEFDRV9JTkJPWDsKICAJLyogaXRlcmF0ZSB0aHJvdWdo
IHByZWZpeGVzIG1hdGNoaW5nIHVzZXJtYm94bmFtZSAqLwotLS0gMjg0NCwyODY1IC0tLS0KICAK
ICAgICAgaWYgKHIpIGdvdG8gZG9uZTsKICAKICAgICAgLyogRmluZCBmaXhlZC1zdHJpbmcgcGF0
dGVybiBwcmVmaXggKi8KISAgICAgZm9yIChwID0gKGNoYXIgKilwYXR0ZXJuOyAqcDsgcCsrKSB7
CiEgCS8qIHN0b3AgYXQgdGhlIHNlcGFyYXRvciB0b28gKi8KISAJaWYgKCpwID09ICcqJyB8fCAq
cCA9PSAnJScgfHwgKnAgPT0gJz8nIHx8ICpwID09ICdAJyB8fCAqcCA9PSBuYW1lc3BhY2UtPmhp
ZXJfc2VwKSBicmVhazsKICAgICAgfQogICAgICBwcmVmaXhsZW4gPSBwIC0gcGF0dGVybjsKICAK
ICAgICAgLyoKISAgICAgICogSWYgSU5CT1g8aGllcl9zZXA+KiBjYW4gbWF0Y2ggcGF0dGVybiwK
ICAgICAgICogc2VhcmNoIGZvciB0aG9zZSBtYWlsYm94ZXMgbmV4dAogICAgICAgKi8KICAgICAg
aWYgKHVzZXJpZCAmJgohIAkhc3RybmNhc2VjbXAoImluYm94IiwgcGF0dGVybiwgcHJlZml4bGVu
IDwgNSA/IHByZWZpeGxlbiA6IDUpICYmCiEgCShwcmVmaXhsZW4gPCA2IHx8IHBhdHRlcm5bNV09
PW5hbWVzcGFjZS0+aGllcl9zZXApKSB7CiAgCiEgCWNicm9jay5pbmJveG9mZnNldCA9IGRvbWFp
bmxlbiArIHVzZXJsZW47CiAgCiAgCWNicm9jay5maW5kX25hbWVzcGFjZSA9IE5BTUVTUEFDRV9J
TkJPWDsKICAJLyogaXRlcmF0ZSB0aHJvdWdoIHByZWZpeGVzIG1hdGNoaW5nIHVzZXJtYm94bmFt
ZSAqLwoqKioqKioqKioqKioqKioKKioqIDI5MTksMjkyNyAqKioqCiAgICAgIH0KICAKICAgICAg
Y2Jyb2NrLmZpbmRfbmFtZXNwYWNlID0gTkFNRVNQQUNFX1VTRVI7Ci0gICAgIC8qIHN3aXRjaCB0
byBwYXR0ZXJuIHdpdGggZG9tYWluIHByZXBlbmRlZCAqLwogICAgICBnbG9iX2ZyZWUoJmNicm9j
ay5nKTsKISAgICAgY2Jyb2NrLmcgPSBnbG9iX2luaXQoZG9tYWlucGF0LCBHTE9CX0hJRVJBUkNI
WSk7CiAgICAgIGNicm9jay5pbmJveG9mZnNldCA9IDA7CiAgICAgIGlmICh1c2VybWJveG5hbWVs
ZW4pIHsKICAJdXNlcm1ib3huYW1lWy0tdXNlcm1ib3huYW1lbGVuXSA9ICdcMCc7Ci0tLSAyODc2
LDI4ODMgLS0tLQogICAgICB9CiAgCiAgICAgIGNicm9jay5maW5kX25hbWVzcGFjZSA9IE5BTUVT
UEFDRV9VU0VSOwogICAgICBnbG9iX2ZyZWUoJmNicm9jay5nKTsKISAgICAgY2Jyb2NrLmcgPSBn
bG9iX2luaXQocGF0dGVybiwgbmFtZXNwYWNlLT5oaWVyX3NlcCwgR0xPQl9ISUVSQVJDSFkpOwog
ICAgICBjYnJvY2suaW5ib3hvZmZzZXQgPSAwOwogICAgICBpZiAodXNlcm1ib3huYW1lbGVuKSB7
CiAgCXVzZXJtYm94bmFtZVstLXVzZXJtYm94bmFtZWxlbl0gPSAnXDAnOwoqKioqKioqKioqKioq
KioKKioqIDI5MzYsMjk0MiAqKioqCiAgICBkb25lOgogICAgICBpZiAoc3VicykgbWJveGxpc3Rf
Y2xvc2VzdWJzKHN1YnMpOwogICAgICBnbG9iX2ZyZWUoJmNicm9jay5nKTsKLSAgICAgaWYgKHBh
dCkgZnJlZShwYXQpOwogIAogICAgICByZXR1cm4gcjsKICB9Ci0tLSAyODkyLDI4OTcgLS0tLQoq
KioqKioqKioqKioqKioKKioqIDI5NjcsMjk3MyAqKioqCiAgICAgIGVsc2UKICAJZG9tYWlucGF0
WzBdID0gJ1wwJzsKICAKISAgICAgY2Jyb2NrLmcgPSBnbG9iX2luaXQocGF0dGVybiwgR0xPQl9I
SUVSQVJDSFl8R0xPQl9JTkJPWENBU0UpOwogICAgICBjYnJvY2submFtZXNwYWNlID0gbmFtZXNw
YWNlOwogICAgICBjYnJvY2suZG9tYWlubGVuID0gZG9tYWlubGVuOwogICAgICBjYnJvY2suaW5i
b3hjYXNlID0gZ2xvYl9pbmJveGNhc2UoY2Jyb2NrLmcpOwotLS0gMjkyMiwyOTI4IC0tLS0KICAg
ICAgZWxzZQogIAlkb21haW5wYXRbMF0gPSAnXDAnOwogIAohICAgICBjYnJvY2suZyA9IGdsb2Jf
aW5pdChwYXR0ZXJuLCBuYW1lc3BhY2UtPmhpZXJfc2VwLCBHTE9CX0hJRVJBUkNIWXxHTE9CX0lO
Qk9YQ0FTRSk7CiAgICAgIGNicm9jay5uYW1lc3BhY2UgPSBuYW1lc3BhY2U7CiAgICAgIGNicm9j
ay5kb21haW5sZW4gPSBkb21haW5sZW47CiAgICAgIGNicm9jay5pbmJveGNhc2UgPSBnbG9iX2lu
Ym94Y2FzZShjYnJvY2suZyk7CioqKioqKioqKioqKioqKgoqKiogMzAzNCwzMDQyICoqKioKICAg
ICAgICogQXBwZW5kIHBhdHRlcm4gdG8gIklOQk9YLiIsIHNlYXJjaCBmb3IgdGhvc2Ugc3Vic2Ny
aXB0aW9ucyBuZXh0CiAgICAgICAqLwogICAgICBpZiAodXNlcmlkKSB7CiEgCXN0cmxjcHkocGF0
YnVmLCAiSU5CT1guIiwgc2l6ZW9mKHBhdGJ1ZikpOwohIAlzdHJsY2F0KHBhdGJ1ZiwgcGF0dGVy
biwgc2l6ZW9mKHBhdGJ1ZikpOwohIAljYnJvY2suZyA9IGdsb2JfaW5pdChwYXRidWYsIEdMT0Jf
SElFUkFSQ0hZfEdMT0JfSU5CT1hDQVNFKTsKICAJY2Jyb2NrLmluYm94Y2FzZSA9IGdsb2JfaW5i
b3hjYXNlKGNicm9jay5nKTsKICAJY2Jyb2NrLmluYm94b2Zmc2V0ID0gZG9tYWlubGVuK3VzZXJs
ZW47CiAgCWNicm9jay5maW5kX25hbWVzcGFjZSA9IE5BTUVTUEFDRV9JTkJPWDsKLS0tIDI5ODks
Mjk5NiAtLS0tCiAgICAgICAqIEFwcGVuZCBwYXR0ZXJuIHRvICJJTkJPWC4iLCBzZWFyY2ggZm9y
IHRob3NlIHN1YnNjcmlwdGlvbnMgbmV4dAogICAgICAgKi8KICAgICAgaWYgKHVzZXJpZCkgewoh
IAkvKiBkb24ndCB0b3VjaCB0aGUgcGF0dGVybiEgKi8KISAJY2Jyb2NrLmcgPSBnbG9iX2luaXQo
cGF0dGVybiwgbmFtZXNwYWNlLT5oaWVyX3NlcCwgR0xPQl9ISUVSQVJDSFl8R0xPQl9JTkJPWENB
U0UpOwogIAljYnJvY2suaW5ib3hjYXNlID0gZ2xvYl9pbmJveGNhc2UoY2Jyb2NrLmcpOwogIAlj
YnJvY2suaW5ib3hvZmZzZXQgPSBkb21haW5sZW4rdXNlcmxlbjsKICAJY2Jyb2NrLmZpbmRfbmFt
ZXNwYWNlID0gTkFNRVNQQUNFX0lOQk9YOwoqKioqKioqKioqKioqKioKKioqIDMwNzIsMzA4OCAq
KioqCiAgICAgIGlmICghc3RybmNtcChuYW1lc3BhY2UtPnByZWZpeFtOQU1FU1BBQ0VfVVNFUl0s
IHBhdHRlcm4sCiAgCQkgcHJlZml4bGVuIDwgbGVuID8gcHJlZml4bGVuIDogbGVuKSkgewogIAoh
IAlpZiAocHJlZml4bGVuIDwgbGVuKSB7CiEgCSAgICBzdHJsY3B5KGRvbWFpbnBhdCtkb21haW5s
ZW4sIHBhdHRlcm4rcHJlZml4bGVuLAohIAkJICAgIHNpemVvZihkb21haW5wYXQpLWRvbWFpbmxl
bik7CiEgCSAgICBjYnJvY2suZyA9IGdsb2JfaW5pdChkb21haW5wYXQsIEdMT0JfSElFUkFSQ0hZ
KTsKISAJfQohIAllbHNlIHsKISAJICAgIHN0cmxjcHkoZG9tYWlucGF0K2RvbWFpbmxlbiwgInVz
ZXIiLAohIAkJICAgc2l6ZW9mKGRvbWFpbnBhdCktZG9tYWlubGVuKTsKISAJICAgIHN0cmxjYXQo
ZG9tYWlucGF0LCBwYXR0ZXJuK2xlbiwgc2l6ZW9mKGRvbWFpbnBhdCkpOwohIAkgICAgY2Jyb2Nr
LmcgPSBnbG9iX2luaXQoZG9tYWlucGF0LCBHTE9CX0hJRVJBUkNIWSk7CiEgCX0KICAJY2Jyb2Nr
LmZpbmRfbmFtZXNwYWNlID0gTkFNRVNQQUNFX1VTRVI7CiAgCWNicm9jay5pbmJveG9mZnNldCA9
IDA7CiAgCQotLS0gMzAyNiwzMDMzIC0tLS0KICAgICAgaWYgKCFzdHJuY21wKG5hbWVzcGFjZS0+
cHJlZml4W05BTUVTUEFDRV9VU0VSXSwgcGF0dGVybiwKICAJCSBwcmVmaXhsZW4gPCBsZW4gPyBw
cmVmaXhsZW4gOiBsZW4pKSB7CiAgCiEgCS8qIGRvbid0IHRvdWNoIHRoZSBwYXR0ZXJuISAqLwoh
IAljYnJvY2suZyA9IGdsb2JfaW5pdChwYXR0ZXJuLCBuYW1lc3BhY2UtPmhpZXJfc2VwLCBHTE9C
X0hJRVJBUkNIWSk7CiAgCWNicm9jay5maW5kX25hbWVzcGFjZSA9IE5BTUVTUEFDRV9VU0VSOwog
IAljYnJvY2suaW5ib3hvZmZzZXQgPSAwOwogIAkKKioqKioqKioqKioqKioqCioqKiAzMTE0LDMx
MjQgKioqKgogIAkgICAgLyogU2tpcCBwYXR0ZXJuIHdoaWNoIG1hdGNoZXMgc2hhcmVkIG5hbWVz
cGFjZSBwcmVmaXggKi8KICAJICAgIGZvciAocCA9IHBhdCtwcmVmaXhsZW47ICpwOyBwKyspIHsK
ICAJCWlmICgqcCA9PSAnJScpIGNvbnRpbnVlOwohIAkJZWxzZSBpZiAoKnAgPT0gJy4nKSBwKys7
CiAgCQlicmVhazsKICAJICAgIH0KICAKISAJICAgIGlmICgqcGF0dGVybiAmJiAhc3RyY2hyKHBh
dHRlcm4sICcuJykgJiYKICAJCXBhdHRlcm5bc3RybGVuKHBhdHRlcm4pLTFdID09ICclJykgewog
IAkJLyogc3BlY2lhbCBjYXNlOiAgTFNVQiAiIiAqJSAtLSBvdXRwdXQgcHJlZml4ICovCiAgICAJ
CWNicm9jay5jaGVja3NoYXJlZCA9IDE7Ci0tLSAzMDU5LDMwNjkgLS0tLQogIAkgICAgLyogU2tp
cCBwYXR0ZXJuIHdoaWNoIG1hdGNoZXMgc2hhcmVkIG5hbWVzcGFjZSBwcmVmaXggKi8KICAJICAg
IGZvciAocCA9IHBhdCtwcmVmaXhsZW47ICpwOyBwKyspIHsKICAJCWlmICgqcCA9PSAnJScpIGNv
bnRpbnVlOwohIAkJZWxzZSBpZiAoKnAgPT0gbmFtZXNwYWNlLT5oaWVyX3NlcCkgcCsrOwogIAkJ
YnJlYWs7CiAgCSAgICB9CiAgCiEgCSAgICBpZiAoKnBhdHRlcm4gJiYgIXN0cmNocihwYXR0ZXJu
LCBuYW1lc3BhY2UtPmhpZXJfc2VwKSAmJgogIAkJcGF0dGVybltzdHJsZW4ocGF0dGVybiktMV0g
PT0gJyUnKSB7CiAgCQkvKiBzcGVjaWFsIGNhc2U6ICBMU1VCICIiIColIC0tIG91dHB1dCBwcmVm
aXggKi8KICAgIAkJY2Jyb2NrLmNoZWNrc2hhcmVkID0gMTsKKioqKioqKioqKioqKioqCioqKiAz
MTI3LDMxNDAgKioqKgogIAkgICAgaWYgKChjYnJvY2suY2hlY2tzaGFyZWQgfHwgcHJlZml4bGVu
ID09IGxlbikgJiYgISpwKSB7CiAgCQkvKiBzcGVjaWFsIGNhc2U6ICBMU1VCICIiICUgLS0gb3V0
cHV0IHByZWZpeAogIAkJICAgKGlmIHdlIGhhdmUgYSBzaGFyZWQgbWJveCkgYW5kIHF1aXQgKi8K
ISAJCXN0cmxjcHkoZG9tYWlucGF0K2RvbWFpbmxlbiwgIioiLCBzaXplb2YoZG9tYWlucGF0KS1k
b21haW5sZW4pOwohIAkJY2Jyb2NrLmcgPSBnbG9iX2luaXQoZG9tYWlucGF0LCBHTE9CX0hJRVJB
UkNIWSk7CiAgCQljYnJvY2suY2hlY2tzaGFyZWQgPSAyOwogIAkgICAgfQohIAkgICAgZWxzZSB7
CiEgCQlzdHJsY3B5KGRvbWFpbnBhdCtkb21haW5sZW4sIHAsIHNpemVvZihkb21haW5wYXQpLWRv
bWFpbmxlbik7CiEgCQljYnJvY2suZyA9IGdsb2JfaW5pdChkb21haW5wYXQsIEdMT0JfSElFUkFS
Q0hZKTsKISAJICAgIH0KICAKICAJICAgIGRvbWFpbnBhdFtkb21haW5sZW5dID0gJ1wwJzsKICAJ
ICAgIFNVQkRCLT5mb3JlYWNoKHN1YnMsCi0tLSAzMDcyLDMwODIgLS0tLQogIAkgICAgaWYgKChj
YnJvY2suY2hlY2tzaGFyZWQgfHwgcHJlZml4bGVuID09IGxlbikgJiYgISpwKSB7CiAgCQkvKiBz
cGVjaWFsIGNhc2U6ICBMU1VCICIiICUgLS0gb3V0cHV0IHByZWZpeAogIAkJICAgKGlmIHdlIGhh
dmUgYSBzaGFyZWQgbWJveCkgYW5kIHF1aXQgKi8KISAJCWNicm9jay5nID0gZ2xvYl9pbml0KCIq
IiwgbmFtZXNwYWNlLT5oaWVyX3NlcCwgR0xPQl9ISUVSQVJDSFkpOwogIAkJY2Jyb2NrLmNoZWNr
c2hhcmVkID0gMjsKICAJICAgIH0KISAJICAgIGVsc2UKISAJCWNicm9jay5nID0gZ2xvYl9pbml0
KHBhdCwgbmFtZXNwYWNlLT5oaWVyX3NlcCwgR0xPQl9ISUVSQVJDSFkpOwogIAogIAkgICAgZG9t
YWlucGF0W2RvbWFpbmxlbl0gPSAnXDAnOwogIAkgICAgU1VCREItPmZvcmVhY2goc3VicywKKioq
KioqKioqKioqKioqCioqKiAzMTQyLDMxNTEgKioqKgogIAkJCSAgICZmaW5kX3AsICZmaW5kX2Ni
LCAmY2Jyb2NrLAogIAkJCSAgIE5VTEwpOwogIAl9CiEgCWVsc2UgaWYgKHBhdHRlcm5bbGVuXSA9
PSAnLicpIHsKISAJICAgIHN0cmxjcHkoZG9tYWlucGF0K2RvbWFpbmxlbiwgcGF0dGVybitsZW4r
MSwKISAJCSAgICBzaXplb2YoZG9tYWlucGF0KS1kb21haW5sZW4pOwohIAkgICAgY2Jyb2NrLmcg
PSBnbG9iX2luaXQoZG9tYWlucGF0LCBHTE9CX0hJRVJBUkNIWSk7CiAgCiAgCSAgICBTVUJEQi0+
Zm9yZWFjaChzdWJzLAogIAkJCSAgIGRvbWFpbnBhdCwgZG9tYWlubGVuK3ByZWZpeGxlbi0obGVu
KzEpLAotLS0gMzA4NCwzMDkyIC0tLS0KICAJCQkgICAmZmluZF9wLCAmZmluZF9jYiwgJmNicm9j
aywKICAJCQkgICBOVUxMKTsKICAJfQohIAllbHNlIGlmIChwYXR0ZXJuW2xlbl0gPT0gbmFtZXNw
YWNlLT5oaWVyX3NlcCkgewohIAkgICAgc25wcmludGYoZG9tYWlucGF0K2RvbWFpbmxlbiwgc2l6
ZW9mKGRvbWFpbnBhdCktZG9tYWlubGVuLCAiJS4qcyIsIHByZWZpeGxlbi0obGVuKzEpLCBwYXR0
ZXJuK2xlbisxKTsKISAJICAgIGNicm9jay5nID0gZ2xvYl9pbml0KHBhdHRlcm4sIG5hbWVzcGFj
ZS0+aGllcl9zZXAsIEdMT0JfSElFUkFSQ0hZKTsKICAKICAJICAgIFNVQkRCLT5mb3JlYWNoKHN1
YnMsCiAgCQkJICAgZG9tYWlucGF0LCBkb21haW5sZW4rcHJlZml4bGVuLShsZW4rMSksCmRpZmYg
LUMgMyAtciBjeXJ1cy1pbWFwZC0yLjIuMTIub3JpZy9pbWFwL21ib3hsaXN0LmggY3lydXMtaW1h
cGQtMi4yLjEyL2ltYXAvbWJveGxpc3QuaAoqKiogY3lydXMtaW1hcGQtMi4yLjEyLm9yaWcvaW1h
cC9tYm94bGlzdC5oCTIwMDUtMTEtMDcgMTg6MDU6MzMgKzAzMDAKLS0tIGN5cnVzLWltYXBkLTIu
Mi4xMi9pbWFwL21ib3hsaXN0LmgJMjAwNS0xMS0wNyAxODoxMjozMyArMDMwMAoqKioqKioqKioq
KioqKioKKioqIDUxLDU2ICoqKioKLS0tIDUxLDU4IC0tLS0KICAjaW5jbHVkZSAibWJveG5hbWUu
aCIKICAKICBleHRlcm4gc3RydWN0IGRiICptYmRiOworIC8qIGludGVybmFsIG5hbWVzcGFjZSAo
Y29uc3RhbnQpICovCisgZXh0ZXJuIHN0cnVjdCBuYW1lc3BhY2UgaW50ZXJuYWxfbmFtZXNwYWNl
OwogIAogIC8qCiAgICogTWF4aW11bSBsZW5ndGggb2YgcGFydGl0aW9uIG5hbWUuIFtjb25maWcu
YyBoYXMgYSBsaW1pdCBvZiA3MF0KZGlmZiAtQyAzIC1yIGN5cnVzLWltYXBkLTIuMi4xMi5vcmln
L2ltYXAvbWJveG5hbWUuYyBjeXJ1cy1pbWFwZC0yLjIuMTIvaW1hcC9tYm94bmFtZS5jCioqKiBj
eXJ1cy1pbWFwZC0yLjIuMTIub3JpZy9pbWFwL21ib3huYW1lLmMJMjAwNS0wMi0xNCAwOTozOTo1
NyArMDMwMAotLS0gY3lydXMtaW1hcGQtMi4yLjEyL2ltYXAvbWJveG5hbWUuYwkyMDA1LTExLTA3
IDE4OjEyOjM0ICswMzAwCioqKioqKioqKioqKioqKgoqKiogOTYsMTAxICoqKioKLS0tIDk2LDEw
OCAtLS0tCiAgI2RlZmluZSBDSEFSTU9ENjQoYykgIChpbmRleF9tb2Q2NFsodW5zaWduZWQgY2hh
cikoYyldKQogIAogIAorIHN0YXRpYyBpbnQgbWJveG5hbWVfY2hlY2tfaGllcnNlcHMoc3RydWN0
IG5hbWVzcGFjZSAqbmFtZXNwYWNlLCBjb25zdCBjaGFyICpuYW1lLCBpbnQgbmFtZWxlbikKKyB7
CisgICAgIGlmKG5hbWVzcGFjZS0+aGllcl9zZXAgPT0gJy8nICYmIG1lbWNocihuYW1lLCBET1RD
SEFSLCBuYW1lbGVuKSkKKyAJcmV0dXJuIC0xOworICAgICByZXR1cm4gMDsKKyB9CisgCiAgLyoK
ICAgKiBDb252ZXJ0IHRoZSBleHRlcm5hbCBtYWlsYm94ICduYW1lJyB0byBhbiBpbnRlcm5hbCBu
YW1lLgogICAqIElmICd1c2VyaWQnIGlzIG5vbi1udWxsLCBpdCBpcyB0aGUgbmFtZSBvZiB0aGUg
Y3VycmVudCB1c2VyLgoqKioqKioqKioqKioqKioKKioqIDExNiwxMjEgKioqKgotLS0gMTIzLDEz
MSAtLS0tCiAgICAgIHVzZXJsZW4gPSB1c2VyaWQgPyBzdHJsZW4odXNlcmlkKSA6IDA7CiAgICAg
IG5hbWVsZW4gPSBzdHJsZW4obmFtZSk7CiAgCisgICAgIGlmKG1ib3huYW1lX2NoZWNrX2hpZXJz
ZXBzKG5hbWVzcGFjZSwgbmFtZSwgbmFtZWxlbikpCisgCXJldHVybiBJTUFQX01BSUxCT1hfQkFE
TkFNRTsKKyAKICAgICAgaWYgKGNvbmZpZ192aXJ0ZG9tYWlucykgewogIAlpZiAodXNlcmlkICYm
IChjcCA9IHN0cnJjaHIodXNlcmlkLCAnQCcpKSkgewogIAkgICAgLyogdXNlciBsb2dnZWQgaW4g
YXMgdXNlckBkb21haW4gKi8KKioqKioqKioqKioqKioqCioqKiAyMDYsMjExICoqKioKLS0tIDIx
NiwyMjQgLS0tLQogICAgICB1c2VybGVuID0gdXNlcmlkID8gc3RybGVuKHVzZXJpZCkgOiAwOwog
ICAgICBuYW1lbGVuID0gc3RybGVuKG5hbWUpOwogIAorICAgICBpZihtYm94bmFtZV9jaGVja19o
aWVyc2VwcyhuYW1lc3BhY2UsIG5hbWUsIG5hbWVsZW4pKQorIAlyZXR1cm4gSU1BUF9NQUlMQk9Y
X0JBRE5BTUU7CisgCiAgICAgIGlmIChjb25maWdfdmlydGRvbWFpbnMpIHsKICAJaWYgKHVzZXJp
ZCAmJiAoY3AgPSBzdHJjaHIodXNlcmlkLCAnQCcpKSkgewogIAkgICAgLyogdXNlciBsb2dnZWQg
aW4gYXMgdXNlckBkb21haW4gKi8KKioqKioqKioqKioqKioqCioqKiA0NjQsNTE3ICoqKioKICAg
ICAgcmV0dXJuIDA7CiAgfQogIAohIC8qCiEgICogQ3JlYXRlIG5hbWVzcGFjZSBiYXNlZCBvbiBj
b25maWcgb3B0aW9ucy4KISAgKi8KISBpbnQgbWJveG5hbWVfaW5pdF9uYW1lc3BhY2Uoc3RydWN0
IG5hbWVzcGFjZSAqbmFtZXNwYWNlLCBpbnQgaXNhZG1pbikKICB7Ci0gICAgIGNvbnN0IGNoYXIg
KnByZWZpeDsKLSAKICAgICAgYXNzZXJ0KG5hbWVzcGFjZSAhPSBOVUxMKTsKICAKICAgICAgbmFt
ZXNwYWNlLT5pc2FkbWluID0gaXNhZG1pbjsKICAKLSAgICAgbmFtZXNwYWNlLT5oaWVyX3NlcCA9
Ci0gCWNvbmZpZ19nZXRzd2l0Y2goSU1BUE9QVF9VTklYSElFUkFSQ0hZU0VQKSA/ICcvJyA6ICcu
JzsKLSAgICAgbmFtZXNwYWNlLT5pc2FsdCA9ICFpc2FkbWluICYmIGNvbmZpZ19nZXRzd2l0Y2go
SU1BUE9QVF9BTFROQU1FU1BBQ0UpOwotIAotICAgICBpZiAobmFtZXNwYWNlLT5pc2FsdCkgewog
IAkvKiBhbHRlcm5hdGUgbmFtZXNwYWNlICovCiAgCXN0cmNweShuYW1lc3BhY2UtPnByZWZpeFtO
QU1FU1BBQ0VfSU5CT1hdLCAiIik7CiAgCiAgCXByZWZpeCA9IGNvbmZpZ19nZXRzdHJpbmcoSU1B
UE9QVF9VU0VSUFJFRklYKTsKICAJaWYgKCFwcmVmaXggfHwgc3RybGVuKHByZWZpeCkgPT0gMCB8
fAogIAkgICAgc3RybGVuKHByZWZpeCkgPj0gTUFYX05BTUVTUEFDRV9QUkVGSVggfHwKISAJICAg
IHN0cmNocihwcmVmaXgsbmFtZXNwYWNlLT5oaWVyX3NlcCkgIT0gTlVMTCkKICAJICAgIHJldHVy
biBJTUFQX05BTUVTUEFDRV9CQURQUkVGSVg7CiAgCXNwcmludGYobmFtZXNwYWNlLT5wcmVmaXhb
TkFNRVNQQUNFX1VTRVJdLCAiJS4qcyVjIiwKISAJCU1BWF9OQU1FU1BBQ0VfUFJFRklYLTEsIHBy
ZWZpeCwgbmFtZXNwYWNlLT5oaWVyX3NlcCk7CiAgCiAgCXByZWZpeCA9IGNvbmZpZ19nZXRzdHJp
bmcoSU1BUE9QVF9TSEFSRURQUkVGSVgpOwogIAlpZiAoIXByZWZpeCB8fCBzdHJsZW4ocHJlZml4
KSA9PSAwIHx8CiAgCSAgICBzdHJsZW4ocHJlZml4KSA+PSBNQVhfTkFNRVNQQUNFX1BSRUZJWCB8
fAohIAkgICAgc3RyY2hyKHByZWZpeCwgbmFtZXNwYWNlLT5oaWVyX3NlcCkgIT0gTlVMTCB8fAog
IAkgICAgIXN0cm5jbXAobmFtZXNwYWNlLT5wcmVmaXhbTkFNRVNQQUNFX1VTRVJdLCBwcmVmaXgs
IHN0cmxlbihwcmVmaXgpKSkKICAJICAgIHJldHVybiBJTUFQX05BTUVTUEFDRV9CQURQUkVGSVg7
CiAgCXNwcmludGYobmFtZXNwYWNlLT5wcmVmaXhbTkFNRVNQQUNFX1NIQVJFRF0sICIlLipzJWMi
LAohIAkJTUFYX05BTUVTUEFDRV9QUkVGSVgtMSwgcHJlZml4LCBuYW1lc3BhY2UtPmhpZXJfc2Vw
KTsgCiAgCiAgCW5hbWVzcGFjZS0+bWJveG5hbWVfdG9pbnRlcm5hbCA9IG1ib3huYW1lX3RvaW50
ZXJuYWxfYWx0OwogIAluYW1lc3BhY2UtPm1ib3huYW1lX3RvZXh0ZXJuYWwgPSBtYm94bmFtZV90
b2V4dGVybmFsX2FsdDsKICAJbmFtZXNwYWNlLT5tYm94bGlzdF9maW5kYWxsID0gbWJveGxpc3Rf
ZmluZGFsbF9hbHQ7CiAgCW5hbWVzcGFjZS0+bWJveGxpc3RfZmluZHN1YiA9IG1ib3hsaXN0X2Zp
bmRzdWJfYWx0OwogICAgICB9Ci0gCiAgICAgIGVsc2UgewogIAkvKiBzdGFuZGFyZCBuYW1lc3Bh
Y2UgKi8KICAJc3ByaW50ZihuYW1lc3BhY2UtPnByZWZpeFtOQU1FU1BBQ0VfSU5CT1hdLCAiJXMl
YyIsCiEgCQkiSU5CT1giLCBuYW1lc3BhY2UtPmhpZXJfc2VwKTsKICAJc3ByaW50ZihuYW1lc3Bh
Y2UtPnByZWZpeFtOQU1FU1BBQ0VfVVNFUl0sICIlcyVjIiwKISAJCSJ1c2VyIiwgbmFtZXNwYWNl
LT5oaWVyX3NlcCk7CiAgCXN0cmNweShuYW1lc3BhY2UtPnByZWZpeFtOQU1FU1BBQ0VfU0hBUkVE
XSwgIiIpOwogIAogIAluYW1lc3BhY2UtPm1ib3huYW1lX3RvaW50ZXJuYWwgPSBtYm94bmFtZV90
b2ludGVybmFsOwotLS0gNDc3LDUyNSAtLS0tCiAgICAgIHJldHVybiAwOwogIH0KICAKISAvKiBj
cmVhdGUgbmFtZXNwYWNlIGJhc2VkIG9uIGdpdmVuIG9wdGlvbnMgKi8KISBpbnQgbWJveG5hbWVf
aW5pdF9uYW1lc3BhY2VfZXh0KHN0cnVjdCBuYW1lc3BhY2UgKm5hbWVzcGFjZSwgaW50IGlzYWRt
aW4sIGNoYXIgaGllcl9zZXAsIGludCBpc2FsdCkKICB7CiAgICAgIGFzc2VydChuYW1lc3BhY2Ug
IT0gTlVMTCk7CiAgCiAgICAgIG5hbWVzcGFjZS0+aXNhZG1pbiA9IGlzYWRtaW47CisgICAgIG5h
bWVzcGFjZS0+aGllcl9zZXAgPSBoaWVyX3NlcDsKKyAgICAgbmFtZXNwYWNlLT5pc2FsdCA9IGlz
YWx0OworICAgICAKKyAgICAgaWYgKGlzYWx0KSB7CisgCWNvbnN0IGNoYXIgKnByZWZpeDsKICAK
ICAJLyogYWx0ZXJuYXRlIG5hbWVzcGFjZSAqLwogIAlzdHJjcHkobmFtZXNwYWNlLT5wcmVmaXhb
TkFNRVNQQUNFX0lOQk9YXSwgIiIpOwogIAogIAlwcmVmaXggPSBjb25maWdfZ2V0c3RyaW5nKElN
QVBPUFRfVVNFUlBSRUZJWCk7CiAgCWlmICghcHJlZml4IHx8IHN0cmxlbihwcmVmaXgpID09IDAg
fHwKICAJICAgIHN0cmxlbihwcmVmaXgpID49IE1BWF9OQU1FU1BBQ0VfUFJFRklYIHx8CiEgCSAg
ICBzdHJjaHIocHJlZml4LGhpZXJfc2VwKSAhPSBOVUxMKQogIAkgICAgcmV0dXJuIElNQVBfTkFN
RVNQQUNFX0JBRFBSRUZJWDsKICAJc3ByaW50ZihuYW1lc3BhY2UtPnByZWZpeFtOQU1FU1BBQ0Vf
VVNFUl0sICIlLipzJWMiLAohIAkJTUFYX05BTUVTUEFDRV9QUkVGSVgtMSwgcHJlZml4LCBoaWVy
X3NlcCk7CiAgCiAgCXByZWZpeCA9IGNvbmZpZ19nZXRzdHJpbmcoSU1BUE9QVF9TSEFSRURQUkVG
SVgpOwogIAlpZiAoIXByZWZpeCB8fCBzdHJsZW4ocHJlZml4KSA9PSAwIHx8CiAgCSAgICBzdHJs
ZW4ocHJlZml4KSA+PSBNQVhfTkFNRVNQQUNFX1BSRUZJWCB8fAohIAkgICAgc3RyY2hyKHByZWZp
eCwgaGllcl9zZXApICE9IE5VTEwgfHwKICAJICAgICFzdHJuY21wKG5hbWVzcGFjZS0+cHJlZml4
W05BTUVTUEFDRV9VU0VSXSwgcHJlZml4LCBzdHJsZW4ocHJlZml4KSkpCiAgCSAgICByZXR1cm4g
SU1BUF9OQU1FU1BBQ0VfQkFEUFJFRklYOwogIAlzcHJpbnRmKG5hbWVzcGFjZS0+cHJlZml4W05B
TUVTUEFDRV9TSEFSRURdLCAiJS4qcyVjIiwKISAJCU1BWF9OQU1FU1BBQ0VfUFJFRklYLTEsIHBy
ZWZpeCwgaGllcl9zZXApOyAKICAKICAJbmFtZXNwYWNlLT5tYm94bmFtZV90b2ludGVybmFsID0g
bWJveG5hbWVfdG9pbnRlcm5hbF9hbHQ7CiAgCW5hbWVzcGFjZS0+bWJveG5hbWVfdG9leHRlcm5h
bCA9IG1ib3huYW1lX3RvZXh0ZXJuYWxfYWx0OwogIAluYW1lc3BhY2UtPm1ib3hsaXN0X2ZpbmRh
bGwgPSBtYm94bGlzdF9maW5kYWxsX2FsdDsKICAJbmFtZXNwYWNlLT5tYm94bGlzdF9maW5kc3Vi
ID0gbWJveGxpc3RfZmluZHN1Yl9hbHQ7CiAgICAgIH0KICAgICAgZWxzZSB7CiAgCS8qIHN0YW5k
YXJkIG5hbWVzcGFjZSAqLwogIAlzcHJpbnRmKG5hbWVzcGFjZS0+cHJlZml4W05BTUVTUEFDRV9J
TkJPWF0sICIlcyVjIiwKISAJCSJJTkJPWCIsIGhpZXJfc2VwKTsKICAJc3ByaW50ZihuYW1lc3Bh
Y2UtPnByZWZpeFtOQU1FU1BBQ0VfVVNFUl0sICIlcyVjIiwKISAJCSJ1c2VyIiwgaGllcl9zZXAp
OwogIAlzdHJjcHkobmFtZXNwYWNlLT5wcmVmaXhbTkFNRVNQQUNFX1NIQVJFRF0sICIiKTsKICAK
ICAJbmFtZXNwYWNlLT5tYm94bmFtZV90b2ludGVybmFsID0gbWJveG5hbWVfdG9pbnRlcm5hbDsK
KioqKioqKioqKioqKioqCioqKiA1MjQsNTI5ICoqKioKLS0tIDUzMiw1NDggLS0tLQogIH0KICAK
ICAvKgorICAqIENyZWF0ZSBuYW1lc3BhY2UgYmFzZWQgb24gY29uZmlnIG9wdGlvbnMuCisgICov
CisgaW50IG1ib3huYW1lX2luaXRfbmFtZXNwYWNlKHN0cnVjdCBuYW1lc3BhY2UgKm5hbWVzcGFj
ZSwgaW50IGlzYWRtaW4pCisgeworICAgICByZXR1cm4gbWJveG5hbWVfaW5pdF9uYW1lc3BhY2Vf
ZXh0KG5hbWVzcGFjZSwKKyAJCQkJICAgICAgIGlzYWRtaW4sCisgCQkJCSAgICAgICBjb25maWdf
Z2V0c3dpdGNoKElNQVBPUFRfVU5JWEhJRVJBUkNIWVNFUCkgPyAnLycgOiAnLicsCisgCQkJCSAg
ICAgICAhaXNhZG1pbiAmJiBjb25maWdfZ2V0c3dpdGNoKElNQVBPUFRfQUxUTkFNRVNQQUNFKSk7
CisgfQorIAorIC8qCiAgICogVHJhbnNsYXRlIHNlcGFyYXRvciBjaGFyYWN0b3JzIGluIGEgbWFp
bGJveG5hbWUgZnJvbSBpdHMgZXh0ZXJuYWwKICAgKiByZXByZXNlbnRhdGlvbiB0byBpdHMgaW50
ZXJuYWwgcmVwcmVzZW50YXRpb24gJy4nLgogICAqIElmIHVzaW5nIHRoZSB1bml4aGllcmFyY2h5
c2VwICcvJywgYWxsICcuJ3MgZ2V0IHRyYW5zbGF0ZWQgdG8gRE9UQ0hBUi4KKioqKioqKioqKioq
KioqCioqKiA2NjQsNjcwICoqKioKICAKICAgICAgaWYgKHN0cmxlbihuYW1lKSA+IE1BWF9NQUlM
Qk9YX05BTUUpIHJldHVybiBJTUFQX01BSUxCT1hfQkFETkFNRTsKICAgICAgZm9yIChpID0gMDsg
aSA8IE5VTV9CQURNQk9YUEFUVEVSTlM7IGkrKykgewohIAlnID0gZ2xvYl9pbml0KGJhZG1ib3hw
YXR0ZXJuc1tpXSwgMCk7CiAgCWlmIChHTE9CX1RFU1QoZywgbmFtZSkgIT0gLTEpIHsKICAJICAg
IGdsb2JfZnJlZSgmZyk7CiAgCSAgICByZXR1cm4gSU1BUF9NQUlMQk9YX0JBRE5BTUU7Ci0tLSA2
ODMsNjg5IC0tLS0KICAKICAgICAgaWYgKHN0cmxlbihuYW1lKSA+IE1BWF9NQUlMQk9YX05BTUUp
IHJldHVybiBJTUFQX01BSUxCT1hfQkFETkFNRTsKICAgICAgZm9yIChpID0gMDsgaSA8IE5VTV9C
QURNQk9YUEFUVEVSTlM7IGkrKykgewohIAlnID0gZ2xvYl9pbml0KGJhZG1ib3hwYXR0ZXJuc1tp
XSwgdW5peHNlcD8nLyc6Jy4nLCAwKTsKICAJaWYgKEdMT0JfVEVTVChnLCBuYW1lKSAhPSAtMSkg
ewogIAkgICAgZ2xvYl9mcmVlKCZnKTsKICAJICAgIHJldHVybiBJTUFQX01BSUxCT1hfQkFETkFN
RTsKZGlmZiAtQyAzIC1yIGN5cnVzLWltYXBkLTIuMi4xMi5vcmlnL2ltYXAvbWJveG5hbWUuaCBj
eXJ1cy1pbWFwZC0yLjIuMTIvaW1hcC9tYm94bmFtZS5oCioqKiBjeXJ1cy1pbWFwZC0yLjIuMTIu
b3JpZy9pbWFwL21ib3huYW1lLmgJMjAwNC0wMy0xOSAxNzo0OToxNyArMDMwMAotLS0gY3lydXMt
aW1hcGQtMi4yLjEyL2ltYXAvbWJveG5hbWUuaAkyMDA1LTExLTA3IDE4OjEyOjM0ICswMzAwCioq
KioqKioqKioqKioqKgoqKiogNzgsODMgKioqKgotLS0gNzgsODUgLS0tLQogIAkJCSAgICB2b2lk
ICpyb2NrLCBpbnQgZm9yY2UpOwogIH07CiAgCisgLyogY3JlYXRlIG5hbWVzcGFjZSBiYXNlZCBv
biBnaXZlbiBvcHRpb25zICovCisgaW50IG1ib3huYW1lX2luaXRfbmFtZXNwYWNlX2V4dChzdHJ1
Y3QgbmFtZXNwYWNlICpuYW1lc3BhY2UsIGludCBpc2FkbWluLCBjaGFyIGhpZXJfc2VwLCBpbnQg
aXNhbHQpOwogIC8qIENyZWF0ZSBuYW1lc3BhY2UgYmFzZWQgb24gY29uZmlnIG9wdGlvbnMuICov
CiAgaW50IG1ib3huYW1lX2luaXRfbmFtZXNwYWNlKHN0cnVjdCBuYW1lc3BhY2UgKm5hbWVzcGFj
ZSwgaW50IGlzYWRtaW4pOwogIApkaWZmIC1DIDMgLXIgY3lydXMtaW1hcGQtMi4yLjEyLm9yaWcv
aW1hcC9tdXBkYXRlLmMgY3lydXMtaW1hcGQtMi4yLjEyL2ltYXAvbXVwZGF0ZS5jCioqKiBjeXJ1
cy1pbWFwZC0yLjIuMTIub3JpZy9pbWFwL211cGRhdGUuYwkyMDA1LTExLTA3IDE4OjA1OjMzICsw
MzAwCi0tLSBjeXJ1cy1pbWFwZC0yLjIuMTIvaW1hcC9tdXBkYXRlLmMJMjAwNS0xMS0wNyAxODox
MjozNCArMDMwMAoqKioqKioqKioqKioqKioKKioqIDUyOSw1MzQgKioqKgotLS0gNTI5LDU0MCAt
LS0tCiAgCXJldHVybiBFQ19PU0VSUjsKICAgICAgfQogIAorICAgICBpZihtYm94bmFtZV9pbml0
X25hbWVzcGFjZV9leHQoJmludGVybmFsX25hbWVzcGFjZSwKKyAJCQkJICAgMCwgJy4nLCAwKSkg
eworIAlzeXNsb2coTE9HX0VSUiwgIkNhbm5vdCBpbml0aWFsaXplIHRoZSBpbnRlcm5hbCBuYW1l
c3BhY2UiKTsKKyAJcmV0dXJuIEVDX1RFTVBGQUlMOworICAgICB9CisgCiAgICAgIGRhdGFiYXNl
X2luaXQoKTsKICAKICAgICAgaWYgKCFtYXN0ZXJwKSB7CioqKioqKioqKioqKioqKgoqKiogMTY4
OCwxNjk0ICoqKioKICAgICAgaWYoQy0+bGlzdF9wcmVmaXgpIEMtPmxpc3RfcHJlZml4X2xlbiA9
IHN0cmxlbihDLT5saXN0X3ByZWZpeCk7CiAgICAgIGVsc2UgQy0+bGlzdF9wcmVmaXhfbGVuID0g
MDsKICAgICAgCiEgICAgIG1ib3hsaXN0X2ZpbmRhbGwoTlVMTCwgcGF0dGVybiwgMSwgTlVMTCwK
ICAJCSAgICAgTlVMTCwgc2VuZHVwZGF0ZSwgKHZvaWQqKUMpOwogIAogICAgICBDLT5zdHJlYW1p
bmcgPSBOVUxMOwotLS0gMTY5NCwxNzAwIC0tLS0KICAgICAgaWYoQy0+bGlzdF9wcmVmaXgpIEMt
Pmxpc3RfcHJlZml4X2xlbiA9IHN0cmxlbihDLT5saXN0X3ByZWZpeCk7CiAgICAgIGVsc2UgQy0+
bGlzdF9wcmVmaXhfbGVuID0gMDsKICAgICAgCiEgICAgIG1ib3hsaXN0X2ZpbmRhbGwoJmludGVy
bmFsX25hbWVzcGFjZSwgcGF0dGVybiwgMSwgTlVMTCwKICAJCSAgICAgTlVMTCwgc2VuZHVwZGF0
ZSwgKHZvaWQqKUMpOwogIAogICAgICBDLT5zdHJlYW1pbmcgPSBOVUxMOwoqKioqKioqKioqKioq
KioKKioqIDE3MzksMTc0NSAqKioqCiAgICAgIEMtPnN0cmVhbWluZ19ob3N0cyA9IHBhcnRpYWw7
CiAgCiAgICAgIC8qIGR1bXAgaW5pdGlhbCBsaXN0ICovCiEgICAgIG1ib3hsaXN0X2ZpbmRhbGwo
TlVMTCwgcGF0dGVybiwgMSwgTlVMTCwKICAJCSAgICAgTlVMTCwgc2VuZHVwZGF0ZSwgKHZvaWQq
KUMpOwogIAogICAgICBwdGhyZWFkX211dGV4X3VubG9jaygmbWFpbGJveGVzX211dGV4KTsgLyog
VU5MT0NLICovCi0tLSAxNzQ1LDE3NTEgLS0tLQogICAgICBDLT5zdHJlYW1pbmdfaG9zdHMgPSBw
YXJ0aWFsOwogIAogICAgICAvKiBkdW1wIGluaXRpYWwgbGlzdCAqLwohICAgICBtYm94bGlzdF9m
aW5kYWxsKCZpbnRlcm5hbF9uYW1lc3BhY2UsIHBhdHRlcm4sIDEsIE5VTEwsCiAgCQkgICAgIE5V
TEwsIHNlbmR1cGRhdGUsICh2b2lkKilDKTsKICAKICAgICAgcHRocmVhZF9tdXRleF91bmxvY2so
Jm1haWxib3hlc19tdXRleCk7IC8qIFVOTE9DSyAqLwoqKioqKioqKioqKioqKioKKioqIDIxNjIs
MjE2OCAqKioqCiAgCiAgICAgIHJvY2suYm94ZXMgPSAmbG9jYWxfYm94ZXM7CiAgCiEgICAgIG1i
b3hsaXN0X2ZpbmRhbGwoTlVMTCwgcGF0dGVybiwgMSwgTlVMTCwKICAJCSAgICAgTlVMTCwgc3lu
Y19maW5kYWxsX2NiLCAodm9pZCopJnJvY2spOwogIAogICAgICAvKiBUcmF2ZXJzZSBib3RoIGxp
c3RzLCBjb21wYXJlIHRoZSBuYW1lcyAqLwotLS0gMjE2OCwyMTc0IC0tLS0KICAKICAgICAgcm9j
ay5ib3hlcyA9ICZsb2NhbF9ib3hlczsKICAKISAgICAgbWJveGxpc3RfZmluZGFsbCgmaW50ZXJu
YWxfbmFtZXNwYWNlLCBwYXR0ZXJuLCAxLCBOVUxMLAogIAkJICAgICBOVUxMLCBzeW5jX2ZpbmRh
bGxfY2IsICh2b2lkKikmcm9jayk7CiAgCiAgICAgIC8qIFRyYXZlcnNlIGJvdGggbGlzdHMsIGNv
bXBhcmUgdGhlIG5hbWVzICovCmRpZmYgLUMgMyAtciBjeXJ1cy1pbWFwZC0yLjIuMTIub3JpZy9p
bWFwL25udHBkLmMgY3lydXMtaW1hcGQtMi4yLjEyL2ltYXAvbm50cGQuYwoqKiogY3lydXMtaW1h
cGQtMi4yLjEyLm9yaWcvaW1hcC9ubnRwZC5jCTIwMDUtMTEtMDcgMTg6MDU6MzMgKzAzMDAKLS0t
IGN5cnVzLWltYXBkLTIuMi4xMi9pbWFwL25udHBkLmMJMjAwNS0xMS0wNyAxODoxMjozNSArMDMw
MAoqKioqKioqKioqKioqKioKKioqIDUzMCw1MzUgKioqKgotLS0gNTMwLDU0MCAtLS0tCiAgCWZh
dGFsKCJ1bmFibGUgdG8gaW5pdCBkdXBsaWNhdGUgZGVsaXZlcnkgZGF0YWJhc2UiLCBFQ19TT0ZU
V0FSRSk7CiAgICAgIH0KICAKKyAgICAgLyogaW5pdGlhbGl6ZSB0aGUgaW50ZXJuYWwgbmFtZXNw
YWNlIHN0cnVjdHVyZSAqLworICAgICBpZihtYm94bmFtZV9pbml0X25hbWVzcGFjZV9leHQoJmlu
dGVybmFsX25hbWVzcGFjZSwKKyAJCQkJICAgMCwgJy4nLCAwKSkKKyAJZmF0YWwoImNhbm5vdCBp
bml0aWFsaXplIHRoZSBpbnRlcm5hbCBuYW1lc3BhY2UiLCBFQ19URU1QRkFJTCk7CisgICAgIAog
ICAgICAvKiBvcGVuIHRoZSBtYm94bGlzdCwgd2UnbGwgbmVlZCBpdCBmb3IgcmVhbCB3b3JrICov
CiAgICAgIG1ib3hsaXN0X2luaXQoMCk7CiAgICAgIG1ib3hsaXN0X29wZW4oTlVMTCk7CioqKioq
KioqKioqKioqKgoqKiogMjU0NCwyNTUwICoqKioKICAJc3RyY3B5KHBhdHRlcm4sIG5ld3NwcmVm
aXgpOwogIAlzdHJjYXQocGF0dGVybiwgIioiKTsKICAJbGlzdF9jYihOVUxMLCAwLCAwLCBOVUxM
KTsKISAJbWJveGxpc3RfZmluZGFsbChOVUxMLCBwYXR0ZXJuLCAwLCBubnRwX3VzZXJpZCwgbm50
cF9hdXRoc3RhdGUsCiAgCQkJIGxpc3RfY2IsICZscm9jayk7CiAgCiAgCS8qIHByb3h5IHRvIHRo
ZSBiYWNrZW5kcyAqLwotLS0gMjU0OSwyNTU1IC0tLS0KICAJc3RyY3B5KHBhdHRlcm4sIG5ld3Nw
cmVmaXgpOwogIAlzdHJjYXQocGF0dGVybiwgIioiKTsKICAJbGlzdF9jYihOVUxMLCAwLCAwLCBO
VUxMKTsKISAJbWJveGxpc3RfZmluZGFsbCgmaW50ZXJuYWxfbmFtZXNwYWNlLCBwYXR0ZXJuLCAw
LCBubnRwX3VzZXJpZCwgbm50cF9hdXRoc3RhdGUsCiAgCQkJIGxpc3RfY2IsICZscm9jayk7CiAg
CiAgCS8qIHByb3h5IHRvIHRoZSBiYWNrZW5kcyAqLwoqKioqKioqKioqKioqKioKKioqIDI2MDUs
MjYxMSAqKioqCiAgCXN0cmNweShwYXR0ZXJuLCBuZXdzcHJlZml4KTsKICAJc3RyY2F0KHBhdHRl
cm4sICIqIik7CiAgCWxpc3RfY2IoTlVMTCwgMCwgMCwgTlVMTCk7CiEgCW1ib3hsaXN0X2ZpbmRh
bGwoTlVMTCwgcGF0dGVybiwgMCwgbm50cF91c2VyaWQsIG5udHBfYXV0aHN0YXRlLAogIAkJCSBs
aXN0X2NiLCAmbHJvY2spOwogIAogIAkvKiBwcm94eSB0byB0aGUgYmFja2VuZHMgKi8KLS0tIDI2
MTAsMjYxNiAtLS0tCiAgCXN0cmNweShwYXR0ZXJuLCBuZXdzcHJlZml4KTsKICAJc3RyY2F0KHBh
dHRlcm4sICIqIik7CiAgCWxpc3RfY2IoTlVMTCwgMCwgMCwgTlVMTCk7CiEgCW1ib3hsaXN0X2Zp
bmRhbGwoJmludGVybmFsX25hbWVzcGFjZSwgcGF0dGVybiwgMCwgbm50cF91c2VyaWQsIG5udHBf
YXV0aHN0YXRlLAogIAkJCSBsaXN0X2NiLCAmbHJvY2spOwogIAogIAkvKiBwcm94eSB0byB0aGUg
YmFja2VuZHMgKi8KZGlmZiAtQyAzIC1yIGN5cnVzLWltYXBkLTIuMi4xMi5vcmlnL2ltYXAvcHJv
eHlkLmMgY3lydXMtaW1hcGQtMi4yLjEyL2ltYXAvcHJveHlkLmMKKioqIGN5cnVzLWltYXBkLTIu
Mi4xMi5vcmlnL2ltYXAvcHJveHlkLmMJMjAwNC0xMi0xNyAxOTozMjoyMCArMDMwMAotLS0gY3ly
dXMtaW1hcGQtMi4yLjEyL2ltYXAvcHJveHlkLmMJMjAwNS0xMS0wNyAxODoxMjozNSArMDMwMAoq
KioqKioqKioqKioqKioKKioqIDExNDgsMTE1MyAqKioqCi0tLSAxMTQ4LDExNTggLS0tLQogICAg
ICAvKiBsb2FkIHRoZSBTQVNMIHBsdWdpbnMgKi8KICAgICAgZ2xvYmFsX3Nhc2xfaW5pdCgxLCAx
LCBteXNhc2xfY2IpOwogIAorICAgICAvKiBpbml0aWFsaXplIHRoZSBpbnRlcm5hbCBuYW1lc3Bh
Y2Ugc3RydWN0dXJlICovCisgICAgIGlmKG1ib3huYW1lX2luaXRfbmFtZXNwYWNlX2V4dCgmaW50
ZXJuYWxfbmFtZXNwYWNlLAorIAkJCQkgICAwLCAnLicsIDApKQorIAlmYXRhbCgiY2Fubm90IGlu
aXRpYWxpemUgdGhlIGludGVybmFsIG5hbWVzcGFjZSIsIEVDX1RFTVBGQUlMKTsKKyAKICAgICAg
Lyogb3BlbiB0aGUgbWJveGxpc3QsIHdlJ2xsIG5lZWQgaXQgZm9yIHJlYWwgd29yayAqLwogICAg
ICBtYm94bGlzdF9pbml0KDApOwogICAgICBtYm94bGlzdF9vcGVuKE5VTEwpOwoqKioqKioqKioq
KioqKioKKioqIDQ2MDUsNDYxMSAqKioqCiAgICAgIC8qIG5vdyBmaW5kIGFsbCB0aGUgZXhjaXRp
bmcgdG9wbGV2ZWwgbmFtZXNwYWNlcyAtCiAgICAgICAqIHdlJ3JlIHVzaW5nIGludGVybmFsIG5h
bWVzIGhlcmUKICAgICAgICovCiEgICAgIG1ib3hsaXN0X2ZpbmRhbGwoTlVMTCwgcGF0dGVybiwg
cHJveHlkX3VzZXJpc2FkbWluLCBwcm94eWRfdXNlcmlkLAogIAkJICAgICBwcm94eWRfYXV0aHN0
YXRlLCBuYW1lc3BhY2VkYXRhLCAodm9pZCopIHNhd29uZSk7CiAgCiAgICAgIHByb3RfcHJpbnRm
KHByb3h5ZF9vdXQsICIqIE5BTUVTUEFDRSIpOwotLS0gNDYxMCw0NjE2IC0tLS0KICAgICAgLyog
bm93IGZpbmQgYWxsIHRoZSBleGNpdGluZyB0b3BsZXZlbCBuYW1lc3BhY2VzIC0KICAgICAgICog
d2UncmUgdXNpbmcgaW50ZXJuYWwgbmFtZXMgaGVyZQogICAgICAgKi8KISAgICAgbWJveGxpc3Rf
ZmluZGFsbCgmaW50ZXJuYWxfbmFtZXNwYWNlLCBwYXR0ZXJuLCBwcm94eWRfdXNlcmlzYWRtaW4s
IHByb3h5ZF91c2VyaWQsCiAgCQkgICAgIHByb3h5ZF9hdXRoc3RhdGUsIG5hbWVzcGFjZWRhdGEs
ICh2b2lkKikgc2F3b25lKTsKICAKICAgICAgcHJvdF9wcmludGYocHJveHlkX291dCwgIiogTkFN
RVNQQUNFIik7CmRpZmYgLUMgMyAtciBjeXJ1cy1pbWFwZC0yLjIuMTIub3JpZy9pbWFwL3VzZXIu
YyBjeXJ1cy1pbWFwZC0yLjIuMTIvaW1hcC91c2VyLmMKKioqIGN5cnVzLWltYXBkLTIuMi4xMi5v
cmlnL2ltYXAvdXNlci5jCTIwMDQtMDYtMjIgMjA6NTk6MTcgKzA0MDAKLS0tIGN5cnVzLWltYXBk
LTIuMi4xMi9pbWFwL3VzZXIuYwkyMDA1LTExLTA3IDE4OjEyOjM2ICswMzAwCioqKioqKioqKioq
KioqKgoqKiogMzUwLDM1NiAqKioqCiAgICAgIGlmICghcikgewogIAkvKiBjb3B5L3JlbmFtZSBz
dWJzY3JpcHRpb25zIC0gd2UncmUgdXNpbmcgdGhlIGludGVybmFsIG5hbWVzIGhlcmUgKi8KICAJ
c3RyY3B5KHBhdCwgIioiKTsKISAJbWJveGxpc3RfZmluZHN1YihOVUxMLCBwYXQsIDEsIG9sZHVz
ZXIsIGF1dGhzdGF0ZSwgdXNlcl9yZW5hbWVzdWIsCiAgCQkJICZycm9jaywgMSk7CiAgICAgIH0K
ICAKLS0tIDM1MCwzNTYgLS0tLQogICAgICBpZiAoIXIpIHsKICAJLyogY29weS9yZW5hbWUgc3Vi
c2NyaXB0aW9ucyAtIHdlJ3JlIHVzaW5nIHRoZSBpbnRlcm5hbCBuYW1lcyBoZXJlICovCiAgCXN0
cmNweShwYXQsICIqIik7CiEgCW1ib3hsaXN0X2ZpbmRzdWIoJmludGVybmFsX25hbWVzcGFjZSwg
cGF0LCAxLCBvbGR1c2VyLCBhdXRoc3RhdGUsIHVzZXJfcmVuYW1lc3ViLAogIAkJCSAmcnJvY2ss
IDEpOwogICAgICB9CiAgCmRpZmYgLUMgMyAtciBjeXJ1cy1pbWFwZC0yLjIuMTIub3JpZy9saWIv
Z2xvYi5jIGN5cnVzLWltYXBkLTIuMi4xMi9saWIvZ2xvYi5jCioqKiBjeXJ1cy1pbWFwZC0yLjIu
MTIub3JpZy9saWIvZ2xvYi5jCTIwMDMtMTItMDggMjM6NTc6MTMgKzAzMDAKLS0tIGN5cnVzLWlt
YXBkLTIuMi4xMi9saWIvZ2xvYi5jCTIwMDUtMTEtMDcgMTg6MTI6MzYgKzAzMDAKKioqKioqKioq
KioqKioqCioqKiA2Nyw3NCAqKioqCiAgICogICA0KSAnKicgZWF0cyBhbGwgJyoncyBhbmQgJyUn
cyBjb25uZWN0ZWQgYnkgYW55IHdpbGRjYXJkCiAgICogICA1KSAnJScgZWF0cyBhbGwgYWRqYWNl
bnQgJyUncwogICAqLwohIGdsb2IgKmdsb2JfaW5pdF9zdXBwcmVzcyAoc3RyLCBmbGFncywgc3Vw
cHJlc3MpCiAgICAgIGNvbnN0IGNoYXIgKnN0cjsKICAgICAgaW50IGZsYWdzOwogICAgICBjb25z
dCBjaGFyICpzdXBwcmVzczsKICB7Ci0tLSA2Nyw3NSAtLS0tCiAgICogICA0KSAnKicgZWF0cyBh
bGwgJyoncyBhbmQgJyUncyBjb25uZWN0ZWQgYnkgYW55IHdpbGRjYXJkCiAgICogICA1KSAnJScg
ZWF0cyBhbGwgYWRqYWNlbnQgJyUncwogICAqLwohIGdsb2IgKmdsb2JfaW5pdF9zdXBwcmVzcyAo
c3RyLCBzZXBfY2hhciwgZmxhZ3MsIHN1cHByZXNzKQogICAgICBjb25zdCBjaGFyICpzdHI7Cisg
ICAgIGNoYXIgc2VwX2NoYXI7CiAgICAgIGludCBmbGFnczsKICAgICAgY29uc3QgY2hhciAqc3Vw
cHJlc3M7CiAgewoqKioqKioqKioqKioqKioKKioqIDgxLDg3ICoqKioKICAgICAgZyA9IChnbG9i
ICopIHhtYWxsb2Moc2l6ZW9mIChnbG9iKSArIHNsZW4gKyBzdHJsZW4oc3RyKSArIDEpOwogICAg
ICBpZiAoZyAhPSAwKSB7CiAgICAgICAgICBzdHJjcHkoZy0+aW5ib3gsIGluYm94KTsKISAJZy0+
c2VwX2NoYXIgPSAnLic7CiAgCWRzdCA9IGctPnN0cjsKICAJLyogaWYgd2UncmUgZG9pbmcgYSBz
dWJzdHJpbmcgbWF0Y2gsIHB1dCBhICcqJyBwcmVmaXggKDEpICovCiAgCWlmIChmbGFncyAmIEdM
T0JfU1VCU1RSSU5HKSB7Ci0tLSA4Miw4OCAtLS0tCiAgICAgIGcgPSAoZ2xvYiAqKSB4bWFsbG9j
KHNpemVvZiAoZ2xvYikgKyBzbGVuICsgc3RybGVuKHN0cikgKyAxKTsKICAgICAgaWYgKGcgIT0g
MCkgewogICAgICAgICAgc3RyY3B5KGctPmluYm94LCBpbmJveCk7CiEgCWctPnNlcF9jaGFyID0g
c2VwX2NoYXI7CiAgCWRzdCA9IGctPnN0cjsKICAJLyogaWYgd2UncmUgZG9pbmcgYSBzdWJzdHJp
bmcgbWF0Y2gsIHB1dCBhICcqJyBwcmVmaXggKDEpICovCiAgCWlmIChmbGFncyAmIEdMT0JfU1VC
U1RSSU5HKSB7CioqKioqKioqKioqKioqKgoqKiogMjg0LDMxMiAqKioqCiAgCQkvKiBsb29rIGZv
ciBhIG1hdGNoIHdpdGggZmlyc3QgY2hhciBmb2xsb3dpbmcgJyUnLAogIAkJICogc3RvcCBhdCBh
IHNlcF9jaGFyIHVubGVzcyB3ZSdyZSBkb2luZyAiKiUiCiAgCQkgKi8KISAJCXB0ciA9IHBoaWVy
OwohIAkJd2hpbGUgKHB0ciAhPSBwZW5kICYmICpnaGllciAhPSAqcHRyCiEgCQkgICAgICAgJiYg
KCpwdHIgIT0gZy0+c2VwX2NoYXIgfHwKICAJCQkgICAoISpnaGllciAmJiBnc3RhciAmJiAqZ3N0
YXIgPT0gJyUnICYmIG1pbgohIAkJCSAgICAmJiBwdHIgLSBzdGFydCA8ICptaW4pKSkgewohIAkJ
ICAgICsrcHRyOwogIAkJfQohIAkJaWYgKHB0ciA9PSBwZW5kKSB7CiAgCQkgICAgZ3B0ciA9IGdo
aWVyOwogIAkJICAgIGJyZWFrOwogIAkJfQohIAkJaWYgKCpwdHIgPT0gZy0+c2VwX2NoYXIpIHsK
ICAJCSAgICBpZiAoISpnaGllciAmJiBtaW4KISAJCQkmJiAqbWluIDwgcHRyIC0gc3RhcnQgJiYg
cHRyICE9IHBlbmQKISAJCQkmJiAqcHRyID09IGctPnNlcF9jaGFyCiEgCQkJKSB7CiEgCQkJKm1p
biA9IGdzdGFyID8gcHRyIC0gc3RhcnQgKyAxIDogLTE7CiEgCQkJcmV0dXJuIChwdHIgLSBzdGFy
dCk7CiAgCQkgICAgfQogIAkJICAgIGdoaWVyID0gTlVMTDsKICAJCSAgICBzZXBmb3VuZCA9IDE7
CiAgCQl9IGVsc2UgewohIAkJICAgIHBoaWVyID0gKytwdHI7CiAgCQkgICAgZ3B0ciA9IGdoaWVy
ICsgMTsKICAJCX0KICAJICAgIH0KLS0tIDI4NSwzMTEgLS0tLQogIAkJLyogbG9vayBmb3IgYSBt
YXRjaCB3aXRoIGZpcnN0IGNoYXIgZm9sbG93aW5nICclJywKICAJCSAqIHN0b3AgYXQgYSBzZXBf
Y2hhciB1bmxlc3Mgd2UncmUgZG9pbmcgIiolIgogIAkJICovCiEgCQl3aGlsZSAocGhpZXIgIT0g
cGVuZCAmJiAqZ2hpZXIgIT0gKnBoaWVyCiEgCQkgICAgICAgJiYgKCpwaGllciAhPSBnLT5zZXBf
Y2hhciB8fAogIAkJCSAgICghKmdoaWVyICYmIGdzdGFyICYmICpnc3RhciA9PSAnJScgJiYgbWlu
CiEgCQkJICAgICYmIHBoaWVyIC0gc3RhcnQgPCAqbWluKSkpIHsKISAJCSAgICArK3BoaWVyOwog
IAkJfQohIAkJaWYgKHBoaWVyID09IHBlbmQpIHsKICAJCSAgICBncHRyID0gZ2hpZXI7CisgCQkg
ICAgcHRyID0gcGhpZXI7CiAgCQkgICAgYnJlYWs7CiAgCQl9CiEgCQlpZiAoKmdoaWVyICE9ICpw
aGllciAmJiAqcGhpZXIgPT0gZy0+c2VwX2NoYXIpIHsKICAJCSAgICBpZiAoISpnaGllciAmJiBt
aW4KISAJCQkmJiAqbWluIDwgcGhpZXIgLSBzdGFydCAmJiBwaGllciAhPSBwZW5kKSB7CiEgCQkJ
Km1pbiA9IGdzdGFyID8gcGhpZXIgLSBzdGFydCArIDEgOiAtMTsKISAJCQlyZXR1cm4gKHBoaWVy
IC0gc3RhcnQpOwogIAkJICAgIH0KICAJCSAgICBnaGllciA9IE5VTEw7CiAgCQkgICAgc2VwZm91
bmQgPSAxOwogIAkJfSBlbHNlIHsKISAJCSAgICBwdHIgPSArK3BoaWVyOwogIAkJICAgIGdwdHIg
PSBnaGllciArIDE7CiAgCQl9CiAgCSAgICB9CioqKioqKioqKioqKioqKgoqKiogMzc2LDQwNCAq
KioqCiAgCQkvKiBsb29rIGZvciBhIG1hdGNoIHdpdGggZmlyc3QgY2hhciBmb2xsb3dpbmcgJyUn
LAogIAkJICogc3RvcCBhdCBhIHNlcF9jaGFyIHVubGVzcyB3ZSdyZSBkb2luZyAiKiUiCiAgCQkg
Ki8KISAJCXB0ciA9IHBoaWVyOwohIAkJd2hpbGUgKHB0ciAhPSBwZW5kICYmICh1bnNpZ25lZCBj
aGFyKSAqZ2hpZXIgIT0gVE9MT1dFUigqcHRyKQohIAkJICAgICAgICYmICgqcHRyICE9IGctPnNl
cF9jaGFyIHx8CiAgCQkJICAgKCEqZ2hpZXIgJiYgZ3N0YXIgJiYgKmdzdGFyID09ICclJyAmJiBt
aW4KISAJCQkgICAgJiYgcHRyIC0gc3RhcnQgPCAqbWluKSkpIHsKISAJCSAgICArK3B0cjsKICAJ
CX0KISAJCWlmIChwdHIgPT0gcGVuZCkgewogIAkJICAgIGdwdHIgPSBnaGllcjsKICAJCSAgICBi
cmVhazsKICAJCX0KISAJCWlmICgqcHRyID09IGctPnNlcF9jaGFyKSB7CiAgCQkgICAgaWYgKCEq
Z2hpZXIgJiYgbWluCiEgCQkJJiYgKm1pbiA8IHB0ciAtIHN0YXJ0ICYmIHB0ciAhPSBwZW5kCiEg
CQkJJiYgKnB0ciA9PSBnLT5zZXBfY2hhcgohIAkJCSkgewohIAkJCSptaW4gPSBnc3RhciA/IHB0
ciAtIHN0YXJ0ICsgMSA6IC0xOwohIAkJCXJldHVybiAocHRyIC0gc3RhcnQpOwogIAkJICAgIH0K
ICAJCSAgICBnaGllciA9IE5VTEw7CiAgCQkgICAgc2VwZm91bmQgPSAxOwogIAkJfSBlbHNlIHsK
ISAJCSAgICBwaGllciA9ICsrcHRyOwogIAkJICAgIGdwdHIgPSBnaGllciArIDE7CiAgCQl9CiAg
CSAgICB9Ci0tLSAzNzUsNDAxIC0tLS0KICAJCS8qIGxvb2sgZm9yIGEgbWF0Y2ggd2l0aCBmaXJz
dCBjaGFyIGZvbGxvd2luZyAnJScsCiAgCQkgKiBzdG9wIGF0IGEgc2VwX2NoYXIgdW5sZXNzIHdl
J3JlIGRvaW5nICIqJSIKICAJCSAqLwohIAkJd2hpbGUgKHBoaWVyICE9IHBlbmQgJiYgKHVuc2ln
bmVkIGNoYXIpICpnaGllciAhPSBUT0xPV0VSKCpwaGllcikKISAJCSAgICAgICAmJiAoKnBoaWVy
ICE9IGctPnNlcF9jaGFyIHx8CiAgCQkJICAgKCEqZ2hpZXIgJiYgZ3N0YXIgJiYgKmdzdGFyID09
ICclJyAmJiBtaW4KISAJCQkgICAgJiYgcGhpZXIgLSBzdGFydCA8ICptaW4pKSkgewohIAkJICAg
ICsrcGhpZXI7CiAgCQl9CiEgCQlpZiAocGhpZXIgPT0gcGVuZCkgewogIAkJICAgIGdwdHIgPSBn
aGllcjsKKyAJCSAgICBwdHIgPSBwaGllcjsKICAJCSAgICBicmVhazsKICAJCX0KISAJCWlmICgq
Z2hpZXIgIT0gKnBoaWVyICYmICpwaGllciA9PSBnLT5zZXBfY2hhcikgewogIAkJICAgIGlmICgh
KmdoaWVyICYmIG1pbgohIAkJCSYmICptaW4gPCBwaGllciAtIHN0YXJ0ICYmIHBoaWVyICE9IHBl
bmQpIHsKISAJCQkqbWluID0gZ3N0YXIgPyBwaGllciAtIHN0YXJ0ICsgMSA6IC0xOwohIAkJCXJl
dHVybiAocGhpZXIgLSBzdGFydCk7CiAgCQkgICAgfQogIAkJICAgIGdoaWVyID0gTlVMTDsKICAJ
CSAgICBzZXBmb3VuZCA9IDE7CiAgCQl9IGVsc2UgewohIAkJICAgIHB0ciA9ICsrcGhpZXI7CiAg
CQkgICAgZ3B0ciA9IGdoaWVyICsgMTsKICAJCX0KICAJICAgIH0KKioqKioqKioqKioqKioqCioq
KiA0NDYsNDUyICoqKioKICAgICAgaW50IGFyZ2M7CiAgICAgIGNoYXIqIGFyZ3ZbXTsKICB7CiEg
ICAgIGdsb2IgKmcgPSBnbG9iX2luaXRfc3VwcHJlc3MoYXJndlsxXSwgR0xPQl9JTkJPWENBU0V8
R0xPQl9ISUVSQVJDSFksCiAgCQkJCSAidXNlci5uaWZ0eSIpOwogICAgICBjaGFyIHRleHRbMTAy
NF07CiAgICAgIGludCBsZW47Ci0tLSA0NDMsNDQ5IC0tLS0KICAgICAgaW50IGFyZ2M7CiAgICAg
IGNoYXIqIGFyZ3ZbXTsKICB7CiEgICAgIGdsb2IgKmcgPSBnbG9iX2luaXRfc3VwcHJlc3MoYXJn
dlsxXSwgJy4nLCBHTE9CX0lOQk9YQ0FTRXxHTE9CX0hJRVJBUkNIWSwKICAJCQkJICJ1c2VyLm5p
ZnR5Iik7CiAgICAgIGNoYXIgdGV4dFsxMDI0XTsKICAgICAgaW50IGxlbjsKZGlmZiAtQyAzIC1y
IGN5cnVzLWltYXBkLTIuMi4xMi5vcmlnL2xpYi9nbG9iLmggY3lydXMtaW1hcGQtMi4yLjEyL2xp
Yi9nbG9iLmgKKioqIGN5cnVzLWltYXBkLTIuMi4xMi5vcmlnL2xpYi9nbG9iLmgJMjAwMy0wMi0x
MyAyMzoxNTo0MCArMDMwMAotLS0gY3lydXMtaW1hcGQtMi4yLjEyL2xpYi9nbG9iLmgJMjAwNS0x
MS0wNyAxODoxMjozNiArMDMwMAoqKioqKioqKioqKioqKioKKioqIDc4LDg0ICoqKioKICAgKiAg
ZmxhZ3MgICAgLS0gc2VlIGZsYWcgdmFsdWVzIGFib3ZlCiAgICogIHN1cHByZXNzIC0tIHByZWZp
eCB0byBzdXBwcmVzcwogICAqLwohIGV4dGVybiBnbG9iICpnbG9iX2luaXRfc3VwcHJlc3MgUCgo
Y29uc3QgY2hhciAqc3RyLCBpbnQgZmxhZ3MsCiAgCQkJCSAgIGNvbnN0IGNoYXIgKnN1cHByZXNz
KSk7CiAgCiAgLyogZnJlZSBhIGdsb2Igc3RydWN0dXJlCi0tLSA3OCw4NCAtLS0tCiAgICogIGZs
YWdzICAgIC0tIHNlZSBmbGFnIHZhbHVlcyBhYm92ZQogICAqICBzdXBwcmVzcyAtLSBwcmVmaXgg
dG8gc3VwcHJlc3MKICAgKi8KISBleHRlcm4gZ2xvYiAqZ2xvYl9pbml0X3N1cHByZXNzIFAoKGNv
bnN0IGNoYXIgKnN0ciwgY2hhciBzZXBfY2hhciwgaW50IGZsYWdzLAogIAkJCQkgICBjb25zdCBj
aGFyICpzdXBwcmVzcykpOwogIAogIC8qIGZyZWUgYSBnbG9iIHN0cnVjdHVyZQoqKioqKioqKioq
KioqKioKKioqIDk3LDEwMyAqKioqCiAgZXh0ZXJuIGludCBnbG9iX3Rlc3QgUCgoZ2xvYiAqZywg
Y29uc3QgY2hhciAqc3RyLCBsb25nIGxlbiwgbG9uZyAqbWluKSk7CiAgCiAgLyogbWFjcm9zICov
CiEgI2RlZmluZSBnbG9iX2luaXQoc3RyLCBmbGFncykgZ2xvYl9pbml0X3N1cHByZXNzKChzdHIp
LCAoZmxhZ3MpLCBOVUxMKQogICNkZWZpbmUgZ2xvYl9pbmJveGNhc2UoZykgKChnKS0+aW5ib3gp
CiAgI2RlZmluZSBHTE9CX1RFU1QoZywgc3RyKSBnbG9iX3Rlc3QoKGcpLCAoc3RyKSwgMCwgTlVM
TCkKICAjZGVmaW5lIEdMT0JfU0VUX1NFUEFSQVRPUihnLCBjKSAoKGcpLT5zZXBfY2hhciA9IChj
KSkKLS0tIDk3LDEwMyAtLS0tCiAgZXh0ZXJuIGludCBnbG9iX3Rlc3QgUCgoZ2xvYiAqZywgY29u
c3QgY2hhciAqc3RyLCBsb25nIGxlbiwgbG9uZyAqbWluKSk7CiAgCiAgLyogbWFjcm9zICovCiEg
I2RlZmluZSBnbG9iX2luaXQoc3RyLCBzZXBfY2hhciwgZmxhZ3MpIGdsb2JfaW5pdF9zdXBwcmVz
cygoc3RyKSwgKHNlcF9jaGFyKSwgKGZsYWdzKSwgTlVMTCkKICAjZGVmaW5lIGdsb2JfaW5ib3hj
YXNlKGcpICgoZyktPmluYm94KQogICNkZWZpbmUgR0xPQl9URVNUKGcsIHN0cikgZ2xvYl90ZXN0
KChnKSwgKHN0ciksIDAsIE5VTEwpCiAgI2RlZmluZSBHTE9CX1NFVF9TRVBBUkFUT1IoZywgYykg
KChnKS0+c2VwX2NoYXIgPSAoYykpCg==
</data>        

          </attachment>
          <attachment
              isobsolete="1"
              ispatch="1"
              isprivate="0"
          >
            <attachid>408</attachid>
            <date>2005-12-30 07:27 EDT</date>
            <desc>Update</desc>
            <filename>cyrus-imapd-bugs-2.2.12_6.patch</filename>
            <type>text/plain</type>
            <size>73294</size>
            <attacher>dzal_mail@mtu-net.ru</attacher>
            
              <data encoding="base64">ZGlmZiAtdXJOIGN5cnVzLWltYXBkLTIuMi4xMi5zdXBlcm9sZC9pbWFwL2Fubm90YXRlLmMgY3ly
dXMtaW1hcGQtMi4yLjEyL2ltYXAvYW5ub3RhdGUuYwotLS0gY3lydXMtaW1hcGQtMi4yLjEyLnN1
cGVyb2xkL2ltYXAvYW5ub3RhdGUuYwkyMDA1LTAyLTE0IDA5OjM5OjU0ICswMzAwCisrKyBjeXJ1
cy1pbWFwZC0yLjIuMTIvaW1hcC9hbm5vdGF0ZS5jCTIwMDUtMTItMjYgMTk6MTk6MTMgKzAzMDAK
QEAgLTM3Myw5ICszNzMsOSBAQAogICAgIGludCBrZXlsZW4sIHI7CiAgICAgc3RydWN0IGZpbmRf
cm9jayBmcm9jazsKIAotICAgIGZyb2NrLm1nbG9iID0gZ2xvYl9pbml0KG1haWxib3gsIEdMT0Jf
SElFUkFSQ0hZKTsKLSAgICBmcm9jay5lZ2xvYiA9IGdsb2JfaW5pdChlbnRyeSwgR0xPQl9ISUVS
QVJDSFkpOwotICAgIEdMT0JfU0VUX1NFUEFSQVRPUihmcm9jay5lZ2xvYiwgJy8nKTsKKyAgICAv
KiBjYW4ndCB1bmRlcnN0YW5kIGl0IHlldCAtLSBzb3JjZXJlciAqLworICAgIGZyb2NrLm1nbG9i
ID0gZ2xvYl9pbml0KG1haWxib3gsICcuJywgR0xPQl9ISUVSQVJDSFkpOworICAgIGZyb2NrLmVn
bG9iID0gZ2xvYl9pbml0KGVudHJ5LCAnLycsIEdMT0JfSElFUkFSQ0hZKTsKICAgICBmcm9jay5w
cm9jID0gcHJvYzsKICAgICBmcm9jay5yb2NrID0gcm9jazsKIApAQCAtOTIyLDkgKzkyMiw5IEBA
CiAgICAgc3RydWN0IGFubm90YXRlX2ZfZW50cnlfbGlzdCAqZW50cmllc19wdHI7CiAgICAgc3Rh
dGljIGNoYXIgbGFzdG5hbWVbTUFYX01BSUxCT1hfUEFUSCsxXTsKICAgICBzdGF0aWMgaW50IHNh
d3VzZXIgPSAwOwotICAgIGludCBjOwotICAgIGNoYXIgaW50X21ib3huYW1lW01BWF9NQUlMQk9Y
X1BBVEgrMV0sIGV4dF9tYm94bmFtZVtNQVhfTUFJTEJPWF9QQVRIKzFdOworICAgIGNoYXIgaW50
X21ib3huYW1lW01BWF9NQUlMQk9YX1BBVEgrMV0sIGludG5hbWVbTUFYX01BSUxCT1hfUEFUSCsx
XTsKICAgICBzdHJ1Y3QgbWFpbGJveF9hbm5vdGF0aW9uX3JvY2sgbWJyb2NrOworICAgIGludCB1
c2VycHJlZml4bGVuOwogCiAgICAgLyogV2UgaGF2ZSB0byByZXNldCB0aGUgc2F3dXNlciBmbGFn
IGJlZm9yZSBlYWNoIGZldGNoIGNvbW1hbmQuCiAgICAgICogSGFuZGxlIGl0IGFzIGEgZGlydHkg
aGFjay4KQEAgLTkzOSwxMSArOTM5LDEyIEBACiAJcmV0dXJuIDA7CiAgICAgfQogCisgICAgdXNl
cnByZWZpeGxlbiA9IHN0cmxlbihmZGF0YS0+bmFtZXNwYWNlLT5wcmVmaXhbTkFNRVNQQUNFX1VT
RVJdKSAtIDE7CiAgICAgLyoKICAgICAgKiBXZSBjYW4gZ2V0IGEgcGFydGlhbCBtYXRjaCBmb3Ig
InVzZXIiIG11bHRpcGxlIHRpbWVzIHdpdGgKICAgICAgKiBvdGhlciBtYXRjaGVzIGluYmV0d2Vl
bi4gIEhhbmRsZSBpdCBhcyBhIHNwZWNpYWwgY2FzZQogICAgICAqLwotICAgIGlmIChtYXRjaGxl
biA9PSA0ICYmIHN0cm5jYXNlY21wKG5hbWUsICJ1c2VyIiwgNCkgPT0gMCkgeworICAgIGlmICht
YXRjaGxlbiA9PSB1c2VycHJlZml4bGVuICYmIHN0cm5jYXNlY21wKG5hbWUsIGZkYXRhLT5uYW1l
c3BhY2UtPnByZWZpeFtOQU1FU1BBQ0VfVVNFUl0sIHVzZXJwcmVmaXhsZW4pID09IDApIHsKIAlp
ZiAoc2F3dXNlcikgcmV0dXJuIDA7CiAJc2F3dXNlciA9IDE7CiAgICAgfQpAQCAtOTUxLDE5ICs5
NTIsOCBAQAogICAgIHN0cmxjcHkobGFzdG5hbWUsIG5hbWUsIHNpemVvZihsYXN0bmFtZSkpOwog
ICAgIGxhc3RuYW1lW21hdGNobGVuXSA9ICdcMCc7CiAKLSAgICBpZiAoIXN0cm5jYXNlY21wKGxh
c3RuYW1lLCAiSU5CT1giLCA1KSkgewotCSgqZmRhdGEtPm5hbWVzcGFjZS0+bWJveG5hbWVfdG9p
bnRlcm5hbCkoZmRhdGEtPm5hbWVzcGFjZSwgIklOQk9YIiwKLQkJCQkJCSBmZGF0YS0+dXNlcmlk
LCBpbnRfbWJveG5hbWUpOwotCXN0cmxjYXQoaW50X21ib3huYW1lLCBsYXN0bmFtZSs1LCBzaXpl
b2YoaW50X21ib3huYW1lKSk7Ci0gICAgfQotICAgIGVsc2UKLQlzdHJsY3B5KGludF9tYm94bmFt
ZSwgbGFzdG5hbWUsIHNpemVvZihpbnRfbWJveG5hbWUpKTsKLQotICAgIGMgPSBuYW1lW21hdGNo
bGVuXTsKLSAgICBpZiAoYykgbmFtZVttYXRjaGxlbl0gPSAnXDAnOwotICAgICgqZmRhdGEtPm5h
bWVzcGFjZS0+bWJveG5hbWVfdG9leHRlcm5hbCkoZmRhdGEtPm5hbWVzcGFjZSwgbmFtZSwKLQkJ
CQkJICAgICBmZGF0YS0+dXNlcmlkLCBleHRfbWJveG5hbWUpOwotICAgIGlmIChjKSBuYW1lW21h
dGNobGVuXSA9IGM7CisgICAgKCpmZGF0YS0+bmFtZXNwYWNlLT5tYm94bmFtZV90b2ludGVybmFs
KShmZGF0YS0+bmFtZXNwYWNlLCBsYXN0bmFtZSwKKwkJCQkJICAgICBmZGF0YS0+dXNlcmlkLCBp
bnRfbWJveG5hbWUpOwogCiAgICAgbWVtc2V0KCZtYnJvY2ssIDAsIHNpemVvZihzdHJ1Y3QgbWFp
bGJveF9hbm5vdGF0aW9uX3JvY2spKTsKIApAQCAtOTc2LDcgKzk2Niw3IEBACiAJIGVudHJpZXNf
cHRyOwogCSBlbnRyaWVzX3B0ciA9IGVudHJpZXNfcHRyLT5uZXh0KSB7CiAJCi0JZW50cmllc19w
dHItPmVudHJ5LT5nZXQoaW50X21ib3huYW1lLCBleHRfbWJveG5hbWUsCisJZW50cmllc19wdHIt
PmVudHJ5LT5nZXQoaW50X21ib3huYW1lLCBuYW1lLAogCQkJCWVudHJpZXNfcHRyLT5lbnRyeS0+
bmFtZSwgZmRhdGEsCiAJCQkJJm1icm9jaywgKGVudHJpZXNfcHRyLT5lbnRyeS0+cm9jayA/CiAJ
CQkJCSAgZW50cmllc19wdHItPmVudHJ5LT5yb2NrIDoKQEAgLTEwMjIsNyArMTAxMiw3IEBACiAg
ICAgd2hpbGUgKGEpIHsKIAlpbnQgYXR0cmliY291bnQ7CiAKLQlnID0gZ2xvYl9pbml0KGEtPnMs
IEdMT0JfSElFUkFSQ0hZKTsKKwlnID0gZ2xvYl9pbml0KGEtPnMsICcuJywgR0xPQl9ISUVSQVJD
SFkpOwogCQogCWZvciAoYXR0cmliY291bnQgPSAwOwogCSAgICAgYW5ub3RhdGlvbl9hdHRyaWJ1
dGVzW2F0dHJpYmNvdW50XS5uYW1lOwpAQCAtMTA1NSw4ICsxMDQ1LDcgQEAKIAlpbnQgZW50cnlj
b3VudDsKIAlpbnQgY2hlY2tfZGIgPSAwOyAvKiBzaG91bGQgd2UgY2hlY2sgdGhlIGRiIGZvciB0
aGlzIGVudHJ5PyAqLwogCi0JZyA9IGdsb2JfaW5pdChlLT5zLCBHTE9CX0hJRVJBUkNIWSk7Ci0J
R0xPQl9TRVRfU0VQQVJBVE9SKGcsICcvJyk7CisJZyA9IGdsb2JfaW5pdChlLT5zLCAnLycsIEdM
T0JfSElFUkFSQ0hZKTsKIAogCWZvciAoZW50cnljb3VudCA9IDA7CiAJICAgICBub25fZGJfZW50
cmllc1tlbnRyeWNvdW50XS5uYW1lOwpAQCAtMTM4Miw2ICsxMzcxLDcgQEAKICAgICBjaGFyIGlu
dF9tYm94bmFtZVtNQVhfTUFJTEJPWF9QQVRIKzFdOwogICAgIHN0cnVjdCBtYWlsYm94X2Fubm90
YXRpb25fcm9jayBtYnJvY2s7CiAgICAgaW50IHIgPSAwOworICAgIGludCB1c2VycHJlZml4bGVu
OwogCiAgICAgLyogV2UgaGF2ZSB0byByZXNldCB0aGUgc2F3dXNlciBmbGFnIGJlZm9yZSBlYWNo
IGZldGNoIGNvbW1hbmQuCiAgICAgICogSGFuZGxlIGl0IGFzIGEgZGlydHkgaGFjay4KQEAgLTEz
OTYsMTEgKzEzODYsMTIgQEAKIAlyZXR1cm4gMDsKICAgICB9CiAKKyAgICB1c2VycHJlZml4bGVu
ID0gc3RybGVuKHNkYXRhLT5uYW1lc3BhY2UtPnByZWZpeFtOQU1FU1BBQ0VfVVNFUl0pIC0gMTsK
ICAgICAvKgogICAgICAqIFdlIGNhbiBnZXQgYSBwYXJ0aWFsIG1hdGNoIGZvciAidXNlciIgbXVs
dGlwbGUgdGltZXMgd2l0aAogICAgICAqIG90aGVyIG1hdGNoZXMgaW5iZXR3ZWVuLiAgSGFuZGxl
IGl0IGFzIGEgc3BlY2lhbCBjYXNlCiAgICAgICovCi0gICAgaWYgKG1hdGNobGVuID09IDQgJiYg
c3RybmNhc2VjbXAobmFtZSwgInVzZXIiLCA0KSA9PSAwKSB7CisgICAgaWYgKG1hdGNobGVuID09
IHVzZXJwcmVmaXhsZW4gJiYgc3RybmNhc2VjbXAobmFtZSwgc2RhdGEtPm5hbWVzcGFjZS0+cHJl
Zml4W05BTUVTUEFDRV9VU0VSXSwgdXNlcnByZWZpeGxlbikgPT0gMCkgewogCWlmIChzYXd1c2Vy
KSByZXR1cm4gMDsKIAlzYXd1c2VyID0gMTsKICAgICB9CkBAIC0xNDA4LDEzICsxMzk5LDggQEAK
ICAgICBzdHJsY3B5KGxhc3RuYW1lLCBuYW1lLCBzaXplb2YobGFzdG5hbWUpKTsKICAgICBsYXN0
bmFtZVttYXRjaGxlbl0gPSAnXDAnOwogCi0gICAgaWYgKCFzdHJuY2FzZWNtcChsYXN0bmFtZSwg
IklOQk9YIiwgNSkpIHsKLQkoKnNkYXRhLT5uYW1lc3BhY2UtPm1ib3huYW1lX3RvaW50ZXJuYWwp
KHNkYXRhLT5uYW1lc3BhY2UsICJJTkJPWCIsCi0JCQkJCQkgc2RhdGEtPnVzZXJpZCwgaW50X21i
b3huYW1lKTsKLQlzdHJsY2F0KGludF9tYm94bmFtZSwgbGFzdG5hbWUrNSwgc2l6ZW9mKGludF9t
Ym94bmFtZSkpOwotICAgIH0KLSAgICBlbHNlCi0Jc3RybGNweShpbnRfbWJveG5hbWUsIGxhc3Ru
YW1lLCBzaXplb2YoaW50X21ib3huYW1lKSk7CisgICAgKCpzZGF0YS0+bmFtZXNwYWNlLT5tYm94
bmFtZV90b2ludGVybmFsKShzZGF0YS0+bmFtZXNwYWNlLCBsYXN0bmFtZSwKKwkJCQkJICAgICBz
ZGF0YS0+dXNlcmlkLCBpbnRfbWJveG5hbWUpOwogCiAgICAgbWVtc2V0KCZtYnJvY2ssIDAsIHNp
emVvZihzdHJ1Y3QgbWFpbGJveF9hbm5vdGF0aW9uX3JvY2spKTsKICAgICBnZXRfbWJfZGF0YShp
bnRfbWJveG5hbWUsICZtYnJvY2spOwpkaWZmIC11ck4gY3lydXMtaW1hcGQtMi4yLjEyLnN1cGVy
b2xkL2ltYXAvYXJiaXRyb24uYyBjeXJ1cy1pbWFwZC0yLjIuMTIvaW1hcC9hcmJpdHJvbi5jCi0t
LSBjeXJ1cy1pbWFwZC0yLjIuMTIuc3VwZXJvbGQvaW1hcC9hcmJpdHJvbi5jCTIwMDQtMDUtMjIg
MDc6NDU6NDggKzA0MDAKKysrIGN5cnVzLWltYXBkLTIuMi4xMi9pbWFwL2FyYml0cm9uLmMJMjAw
NS0xMi0yNiAxOToxOToxMyArMDMwMApAQCAtMTY0LDkgKzE2NCw2IEBACiAgICAgY29uc3RydWN0
X2hhc2hfdGFibGUoJm1haWxib3hfdGFibGUsIDIwNDcsIDEpOwogICAgIGNvbnN0cnVjdF9oYXNo
X3RhYmxlKCZtYm94bmFtZV90YWJsZSwgMjA0NywgMSk7CiAKLSAgICAvKiBUcmFuc2xhdGUgYW55
IHNlcGFyYXRvcnMgaW4gbWFpbGJveG5hbWUgKi8KLSAgICBtYm94bmFtZV9oaWVyc2VwX3RvaW50
ZXJuYWwoJmFyYl9uYW1lc3BhY2UsIHBhdHRlcm4sIDApOwotICAgIAogICAgIC8qIEdldCB0aGUg
bWFpbGJveCBsaXN0ICovCiAgICAgZnByaW50ZihzdGRlcnIsICJMb2FkaW5nIE1haWxib3hlcy4u
LiIpOwogICAgICgqYXJiX25hbWVzcGFjZS5tYm94bGlzdF9maW5kYWxsKSgmYXJiX25hbWVzcGFj
ZSwgcGF0dGVybiwgMSwgMCwgMCwKQEAgLTIwOCw4ICsyMDUsMTMgQEAKIHsKICAgICBpbnQgcjsK
ICAgICBzdHJ1Y3QgbWFpbGJveCBtYm94OworICAgIGNoYXIgaW50bmFtZVtNQVhfTUFJTEJPWF9Q
QVRIKzFdOworCisgICAgaWYoKCphcmJfbmFtZXNwYWNlLm1ib3huYW1lX3RvaW50ZXJuYWwpKCZh
cmJfbmFtZXNwYWNlLCBuYW1lLAorCQkJCQkgICAgTlVMTCwgaW50bmFtZSkpCisJcmV0dXJuIDA7
CiAKLSAgICByID0gbWFpbGJveF9vcGVuX2hlYWRlcihuYW1lLCBOVUxMLCAmbWJveCk7CisgICAg
ciA9IG1haWxib3hfb3Blbl9oZWFkZXIoaW50bmFtZSwgTlVMTCwgJm1ib3gpOwogICAgIGlmKCFy
KSB7CiAJc3RydWN0IGFyYl9tYWlsYm94X2RhdGEgKmQgPSBtcG9vbF9tYWxsb2MoYXJiX3Bvb2ws
CiAJCQkJCQkgIHNpemVvZihzdHJ1Y3QgYXJiX21haWxib3hfZGF0YSkpOwpAQCAtMjIwLDcgKzIy
Miw3IEBACiAvKglwcmludGYoImluc2VydGluZyAlcyAoa2V5ICVzKVxuIiwgbmFtZSwgbWJveC51
bmlxdWVpZCk7ICovCiAKIAloYXNoX2luc2VydChtYm94LnVuaXF1ZWlkLCBkLCAmbWFpbGJveF90
YWJsZSk7Ci0JaGFzaF9pbnNlcnQobmFtZSwgZCwgJm1ib3huYW1lX3RhYmxlKTsKKwloYXNoX2lu
c2VydChpbnRuYW1lLCBkLCAmbWJveG5hbWVfdGFibGUpOwogCiAJbWFpbGJveF9jbG9zZSgmbWJv
eCk7CiAgICAgfQpkaWZmIC11ck4gY3lydXMtaW1hcGQtMi4yLjEyLnN1cGVyb2xkL2ltYXAvY2hr
X2N5cnVzLmMgY3lydXMtaW1hcGQtMi4yLjEyL2ltYXAvY2hrX2N5cnVzLmMKLS0tIGN5cnVzLWlt
YXBkLTIuMi4xMi5zdXBlcm9sZC9pbWFwL2Noa19jeXJ1cy5jCTIwMDQtMDgtMDQgMTc6MDM6MTIg
KzA0MDAKKysrIGN5cnVzLWltYXBkLTIuMi4xMi9pbWFwL2Noa19jeXJ1cy5jCTIwMDUtMTItMjYg
MTk6MTk6MTMgKzAzMDAKQEAgLTIyMyw2ICsyMjMsMTAgQEAKIAogICAgIGN5cnVzX2luaXQoYWx0
X2NvbmZpZywgImNoa19jeXJ1cyIsIDApOwogCisgICAgaWYobWJveG5hbWVfaW5pdF9uYW1lc3Bh
Y2VfZXh0KCZpbnRlcm5hbF9uYW1lc3BhY2UsCisJCQkJICAgMSwgJy4nLCAtMSkpCisJZnByaW50
ZihzdGRlcnIsICJDYW5ub3QgaW5pdGlhbGl6ZSB0aGUgaW50ZXJuYWwgbmFtZXNwYWNlXG4iKTsK
KwogICAgIG1ib3hsaXN0X2luaXQoMCk7CiAgICAgbWJveGxpc3Rfb3BlbihOVUxMKTsKIApAQCAt
MjM0LDcgKzIzOCw3IEBACiAJCShjaGVja19wYXJ0ID8gY2hlY2tfcGFydCA6ICJBTEwgUEFSVElU
SU9OUyIpKTsKIAkKIAkvKiBidWlsZCBhIGxpc3Qgb2YgbWFpbGJveGVzIC0gd2UncmUgdXNpbmcg
aW50ZXJuYWwgbmFtZXMgaGVyZSAqLwotCW1ib3hsaXN0X2ZpbmRhbGwoTlVMTCwgcGF0dGVybiwg
MSwgTlVMTCwKKwltYm94bGlzdF9maW5kYWxsKCZpbnRlcm5hbF9uYW1lc3BhY2UsIHBhdHRlcm4s
IDEsIE5VTEwsCiAJCQkgTlVMTCwgY2hrbWJveCwgTlVMTCk7CiAgICAgfQogICAgIApkaWZmIC11
ck4gY3lydXMtaW1hcGQtMi4yLjEyLnN1cGVyb2xkL2ltYXAvY3RsX2N5cnVzZGIuYyBjeXJ1cy1p
bWFwZC0yLjIuMTIvaW1hcC9jdGxfY3lydXNkYi5jCi0tLSBjeXJ1cy1pbWFwZC0yLjIuMTIuc3Vw
ZXJvbGQvaW1hcC9jdGxfY3lydXNkYi5jCTIwMDUtMTItMjYgMTk6MTc6MTMgKzAzMDAKKysrIGN5
cnVzLWltYXBkLTIuMi4xMi9pbWFwL2N0bF9jeXJ1c2RiLmMJMjAwNS0xMi0yNiAxOToxOToxMyAr
MDMwMApAQCAtMTY0LDcgKzE2NCw3IEBACiAgICAgYW5ub3RhdGVtb3JlX29wZW4oTlVMTCk7CiAK
ICAgICAvKiBidWlsZCBhIGxpc3Qgb2YgbWFpbGJveGVzIC0gd2UncmUgdXNpbmcgaW50ZXJuYWwg
bmFtZXMgaGVyZSAqLwotICAgIG1ib3hsaXN0X2ZpbmRhbGwoTlVMTCwgcGF0dGVybiwgMSwgTlVM
TCwKKyAgICBtYm94bGlzdF9maW5kYWxsKCZpbnRlcm5hbF9uYW1lc3BhY2UsIHBhdHRlcm4sIDEs
IE5VTEwsCiAJCSAgICAgTlVMTCwgZml4bWJveCwgTlVMTCk7CiAKICAgICBhbm5vdGF0ZW1vcmVf
Y2xvc2UoKTsKQEAgLTIyNiw2ICsyMjYsMTAgQEAKIAogICAgIGN5cnVzX2luaXQoYWx0X2NvbmZp
ZywgImN0bF9jeXJ1c2RiIiwgMCk7CiAKKyAgICBpZihtYm94bmFtZV9pbml0X25hbWVzcGFjZV9l
eHQoJmludGVybmFsX25hbWVzcGFjZSwKKwkJCQkgICAxLCAnLicsIC0xKSkKKwlmcHJpbnRmKHN0
ZGVyciwgIkNhbm5vdCBpbml0aWFsaXplIHRoZSBpbnRlcm5hbCBuYW1lc3BhY2VcbiIpOworCiAg
ICAgLyogY3JlYXRlIHRoZSBuYW1lIG9mIHRoZSBkYiBkaXJlY3RvcnkgKi8KICAgICAvKiAodXNl
ZCBieSBiYWNrdXAgZGlyZWN0b3J5IG5hbWVzKSAqLwogICAgIHN0cmNweShkaXJuYW1lLCBjb25m
aWdfZGlyKTsKZGlmZiAtdXJOIGN5cnVzLWltYXBkLTIuMi4xMi5zdXBlcm9sZC9pbWFwL2N5cmR1
bXAuYyBjeXJ1cy1pbWFwZC0yLjIuMTIvaW1hcC9jeXJkdW1wLmMKLS0tIGN5cnVzLWltYXBkLTIu
Mi4xMi5zdXBlcm9sZC9pbWFwL2N5cmR1bXAuYwkyMDA0LTA1LTIyIDA3OjQ1OjQ4ICswNDAwCisr
KyBjeXJ1cy1pbWFwZC0yLjIuMTIvaW1hcC9jeXJkdW1wLmMJMjAwNS0xMi0yNiAxOToxOToxNCAr
MDMwMApAQCAtOTMsNyArOTMsNiBAQAogaW50IG1haW4oaW50IGFyZ2MsIGNoYXIgKmFyZ3ZbXSkK
IHsKICAgICBpbnQgb3B0aW9uOwotICAgIGNoYXIgYnVmW01BWF9NQUlMQk9YX1BBVEgrMV07CiAg
ICAgaW50IGksIHI7CiAgICAgY2hhciAqYWx0X2NvbmZpZyA9IE5VTEw7CiAgICAgc3RydWN0IGlu
Y3JlbWVudGFsX3JlY29yZCBpcmVjOwpAQCAtMTMyLDEyICsxMzEsNyBAQAogCiAgICAgaXJlYy5p
bmNydWlkID0gMDsKICAgICBmb3IgKGkgPSBvcHRpbmQ7IGkgPCBhcmdjOyBpKyspIHsKLQlzdHJs
Y3B5KGJ1ZiwgYXJndltpXSwgc2l6ZW9mKGJ1ZikpOwotCS8qIFRyYW5zbGF0ZSBhbnkgc2VwYXJh
dG9ycyBpbiBtYWlsYm94bmFtZSAqLwotCW1ib3huYW1lX2hpZXJzZXBfdG9pbnRlcm5hbCgmZHVt
cF9uYW1lc3BhY2UsIGJ1ZiwKLQkJCQkgICAgY29uZmlnX3ZpcnRkb21haW5zID8KLQkJCQkgICAg
c3RyY3NwbihidWYsICJAIikgOiAwKTsKLQkoKmR1bXBfbmFtZXNwYWNlLm1ib3hsaXN0X2ZpbmRh
bGwpKCZkdW1wX25hbWVzcGFjZSwgYnVmLCAxLCAwLCAwLAorCSgqZHVtcF9uYW1lc3BhY2UubWJv
eGxpc3RfZmluZGFsbCkoJmR1bXBfbmFtZXNwYWNlLCBhcmd2W2ldLCAxLCAwLCAwLAogCQkJCQkg
ICBkdW1wX21lLCAmaXJlYyk7CiAgICAgfQogCkBAIC0xNzAsNyArMTY0LDggQEAKICAgICBpbnQg
cjsKICAgICBzdHJ1Y3QgbWFpbGJveCBtOwogICAgIGNoYXIgYm91bmRhcnlbMTI4XTsKLSAgICBj
aGFyIGltYXB1cmxbTUFYX01BSUxCT1hfUEFUSF07CisgICAgY2hhciBpbWFwdXJsW01BWF9NQUlM
Qk9YX1BBVEgrMV07CisgICAgY2hhciBpbnRuYW1lW01BWF9NQUlMQk9YX1BBVEgrMV07CiAgICAg
c3RydWN0IGluY3JlbWVudGFsX3JlY29yZCAqaXJlYyA9IChzdHJ1Y3QgaW5jcmVtZW50YWxfcmVj
b3JkICopIHJvY2s7CiAgICAgc3RydWN0IHNlYXJjaGFyZ3Mgc2VhcmNoYXJnczsKICAgICB1bnNp
Z25lZCAqdWlkczsKQEAgLTE3OCwxMCArMTczLDE3IEBACiAgICAgaW50IGksIG4sIG51bXVpZHM7
CiAKICAgICBtZW1zZXQoJm0sIDAsIHNpemVvZihzdHJ1Y3QgbWFpbGJveCkpOwotICAgIHIgPSBt
YWlsYm94X29wZW5faGVhZGVyKG5hbWUsIDAsICZtKTsKKyAgICBpZigocj0oKmR1bXBfbmFtZXNw
YWNlLm1ib3huYW1lX3RvaW50ZXJuYWwpKCZkdW1wX25hbWVzcGFjZSwgbmFtZSwKKwkJCQkJICAg
ICBOVUxMLCBpbnRuYW1lKSkpIHsKKwlpZiAodmVyYm9zZSkgeworCSAgICBwcmludGYoImVycm9y
IGNvbnZlcnRpbmcgJXM6ICVzXG4iLCBuYW1lLCBlcnJvcl9tZXNzYWdlKHIpKTsKKwl9CisJcmV0
dXJuIDA7CisgICAgfQorICAgIHIgPSBtYWlsYm94X29wZW5faGVhZGVyKGludG5hbWUsIDAsICZt
KTsKICAgICBpZiAocikgewogCWlmICh2ZXJib3NlKSB7Ci0JICAgIHByaW50ZigiZXJyb3Igb3Bl
bmluZyAlczogJXNcbiIsIG5hbWUsIGVycm9yX21lc3NhZ2UocikpOworCSAgICBwcmludGYoImVy
cm9yIG9wZW5pbmcgJXM6ICVzXG4iLCBpbnRuYW1lLCBlcnJvcl9tZXNzYWdlKHIpKTsKIAl9CiAJ
cmV0dXJuIDA7CiAgICAgfQpAQCAtMTkwLDcgKzE5Miw3IEBACiAgICAgaWYgKCFyKSByID0gbWFp
bGJveF9sb2NrX3BvcCgmbSk7CiAgICAgaWYgKHIpIHsKIAlpZiAodmVyYm9zZSkgewotCSAgICBw
cmludGYoImVycm9yIGxvY2tpbmcgaW5kZXggJXM6ICVzXG4iLCBuYW1lLCBlcnJvcl9tZXNzYWdl
KHIpKTsKKwkgICAgcHJpbnRmKCJlcnJvciBsb2NraW5nIGluZGV4ICVzOiAlc1xuIiwgaW50bmFt
ZSwgZXJyb3JfbWVzc2FnZShyKSk7CiAJfQogCW1haWxib3hfY2xvc2UoJm0pOwogCXJldHVybiAw
OwpkaWZmIC11ck4gY3lydXMtaW1hcGQtMi4yLjEyLnN1cGVyb2xkL2ltYXAvY3lyX2V4cGlyZS5j
IGN5cnVzLWltYXBkLTIuMi4xMi9pbWFwL2N5cl9leHBpcmUuYwotLS0gY3lydXMtaW1hcGQtMi4y
LjEyLnN1cGVyb2xkL2ltYXAvY3lyX2V4cGlyZS5jCTIwMDQtMDUtMjIgMDc6NDU6NDggKzA0MDAK
KysrIGN5cnVzLWltYXBkLTIuMi4xMi9pbWFwL2N5cl9leHBpcmUuYwkyMDA1LTEyLTI2IDE5OjE5
OjE0ICswMzAwCkBAIC0yMzIsNiArMjMyLDEwIEBACiAKICAgICBjeXJ1c19pbml0KGFsdF9jb25m
aWcsICJjeXJfZXhwaXJlIiwgMCk7CiAKKyAgICBpZihtYm94bmFtZV9pbml0X25hbWVzcGFjZV9l
eHQoJmludGVybmFsX25hbWVzcGFjZSwKKwkJCQkgICAxLCAnLicsIC0xKSkKKwlmcHJpbnRmKHN0
ZGVyciwgIkNhbm5vdCBpbml0aWFsaXplIHRoZSBpbnRlcm5hbCBuYW1lc3BhY2VcbiIpOworCiAg
ICAgYW5ub3RhdGVtb3JlX2luaXQoMCwgTlVMTCwgTlVMTCk7CiAgICAgYW5ub3RhdGVtb3JlX29w
ZW4oTlVMTCk7CiAKQEAgLTI1Miw3ICsyNTYsNyBAQAogICAgIGNvbnN0cnVjdF9oYXNoX3RhYmxl
KCZleHBpcmVfdGFibGUsIDEwMDAwLCAxKTsKIAogICAgIHN0cmxjcHkoYnVmLCAiKiIsIHNpemVv
ZihidWYpKTsKLSAgICBtYm94bGlzdF9maW5kYWxsKE5VTEwsIGJ1ZiwgMSwgMCwgMCwgJmJ1aWxk
X3RhYmxlLCAmZXhwaXJlX3RhYmxlKTsKKyAgICBtYm94bGlzdF9maW5kYWxsKCZpbnRlcm5hbF9u
YW1lc3BhY2UsIGJ1ZiwgMSwgMCwgMCwgJmJ1aWxkX3RhYmxlLCAmZXhwaXJlX3RhYmxlKTsKIAog
ICAgIHIgPSBkdXBsaWNhdGVfcHJ1bmUoZGF5cywgJmV4cGlyZV90YWJsZSk7CiAKZGlmZiAtdXJO
IGN5cnVzLWltYXBkLTIuMi4xMi5zdXBlcm9sZC9pbWFwL2ltYXBkLmMgY3lydXMtaW1hcGQtMi4y
LjEyL2ltYXAvaW1hcGQuYwotLS0gY3lydXMtaW1hcGQtMi4yLjEyLnN1cGVyb2xkL2ltYXAvaW1h
cGQuYwkyMDA1LTEyLTI2IDE5OjE3OjIzICswMzAwCisrKyBjeXJ1cy1pbWFwZC0yLjIuMTIvaW1h
cC9pbWFwZC5jCTIwMDUtMTItMjYgMTk6MTk6MTQgKzAzMDAKQEAgLTU0OCw2ICs1NDgsMTEgQEAK
IAkgICAgIEVDX0NPTkZJRyk7CiAgICAgfQogCisgICAgLyogaW5pdGlhbGl6ZSB0aGUgaW50ZXJu
YWwgbmFtZXNwYWNlIHN0cnVjdHVyZSAqLworICAgIGlmKG1ib3huYW1lX2luaXRfbmFtZXNwYWNl
X2V4dCgmaW50ZXJuYWxfbmFtZXNwYWNlLAorCQkJCSAgIDEsICcuJywgLTEpKQorCWZhdGFsKCJj
YW5ub3QgaW5pdGlhbGl6ZSB0aGUgaW50ZXJuYWwgbmFtZXNwYWNlIiwgRUNfVEVNUEZBSUwpOwor
CiAgICAgLyogb3BlbiB0aGUgbWJveGxpc3QsIHdlJ2xsIG5lZWQgaXQgZm9yIHJlYWwgd29yayAq
LwogICAgIG1ib3hsaXN0X2luaXQoMCk7CiAgICAgbWJveGxpc3Rfb3BlbihOVUxMKTsKQEAgLTE2
OTQsNiArMTY5OSwxNyBAQAogICAgIH0KIH0KIAorc3RhdGljIHZvaWQgdXNlcmlkX3RvaW50ZXJu
YWwoc3RydWN0IG5hbWVzcGFjZSAqbmFtZXNwYWNlLCBjaGFyICp1c2VyaWQpCit7CisgICAgY2hh
ciBoaWVyc2VwX29yaWcgPSBuYW1lc3BhY2UtPmhpZXJfc2VwOworCisgICAgbmFtZXNwYWNlLT5o
aWVyX3NlcD0nLyc7CisgICAgbWJveG5hbWVfaGllcnNlcF90b2ludGVybmFsKG5hbWVzcGFjZSwg
dXNlcmlkLAorCQkJCWNvbmZpZ192aXJ0ZG9tYWlucyA/CisJCQkJc3RyY3Nwbih1c2VyaWQsICJA
IikgOiAwKTsKKyAgICBuYW1lc3BhY2UtPmhpZXJfc2VwPWhpZXJzZXBfb3JpZzsKK30KKwogLyoK
ICAqIEF1dG9jcmVhdGUgSW5ib3ggYW5kIHN1YmZvbGRlcnMgdXBvbiBsb2dpbgogICovCkBAIC0x
ODgxLDkgKzE4OTcsNyBAQAogICAgIH0KIAogICAgIC8qIFRyYW5zbGF0ZSBhbnkgc2VwYXJhdG9y
cyBpbiB1c2VyaWQgKi8KLSAgICBtYm94bmFtZV9oaWVyc2VwX3RvaW50ZXJuYWwoJmltYXBkX25h
bWVzcGFjZSwgaW1hcGRfdXNlcmlkLAotCQkJCWNvbmZpZ192aXJ0ZG9tYWlucyA/Ci0JCQkJc3Ry
Y3NwbihpbWFwZF91c2VyaWQsICJAIikgOiAwKTsKKyAgICB1c2VyaWRfdG9pbnRlcm5hbCgmaW1h
cGRfbmFtZXNwYWNlLCBpbWFwZF91c2VyaWQpOwogCiAgICAgZnJlZWJ1ZigmcGFzc3dkYnVmKTsK
IApAQCAtMjAzMCw5ICsyMDQ0LDcgQEAKICAgICB9CiAKICAgICAvKiBUcmFuc2xhdGUgYW55IHNl
cGFyYXRvcnMgaW4gdXNlcmlkICovCi0gICAgbWJveG5hbWVfaGllcnNlcF90b2ludGVybmFsKCZp
bWFwZF9uYW1lc3BhY2UsIGltYXBkX3VzZXJpZCwKLQkJCQljb25maWdfdmlydGRvbWFpbnMgPwot
CQkJCXN0cmNzcG4oaW1hcGRfdXNlcmlkLCAiQCIpIDogMCk7CisgICAgdXNlcmlkX3RvaW50ZXJu
YWwoJmltYXBkX25hbWVzcGFjZSwgaW1hcGRfdXNlcmlkKTsKIAogICAgIGF1dG9jcmVhdGVfaW5i
b3goKTsKIApAQCAtMzc3NiwxNiArMzc4OCwyMiBAQAogfQkKIAogLyogQ2FsbGJhY2sgZm9yIHVz
ZSBieSBjbWRfZGVsZXRlICovCisvKiBuYW1lIGlzIGFuIGV4dGVybmFsIG5hbWUgKi8KIHN0YXRp
YyBpbnQgZGVsbWJveChjaGFyICpuYW1lLAogCQkgICBpbnQgbWF0Y2hsZW4gX19hdHRyaWJ1dGVf
XygodW51c2VkKSksCiAJCSAgIGludCBtYXljcmVhdGUgX19hdHRyaWJ1dGVfXygodW51c2VkKSks
CiAJCSAgIHZvaWQgKnJvY2sgX19hdHRyaWJ1dGVfXygodW51c2VkKSkpCiB7CiAgICAgaW50IHI7
CisgICAgY2hhciBpbnRuYW1lW01BWF9NQUlMQk9YX05BTUUrMV07CisKKyAgICByID0gKCppbWFw
ZF9uYW1lc3BhY2UubWJveG5hbWVfdG9pbnRlcm5hbCkoJmltYXBkX25hbWVzcGFjZSwgbmFtZSwK
KwkJCQkJICAgICAgIGltYXBkX3VzZXJpZCwgaW50bmFtZSk7CiAKLSAgICByID0gbWJveGxpc3Rf
ZGVsZXRlbWFpbGJveChuYW1lLCBpbWFwZF91c2VyaXNhZG1pbiwKLQkJCSAgICAgICBpbWFwZF91
c2VyaWQsIGltYXBkX2F1dGhzdGF0ZSwKLQkJCSAgICAgICAwLCAwLCAwLCAxKTsKKyAgICBpZigh
cikKKwlyID0gbWJveGxpc3RfZGVsZXRlbWFpbGJveChpbnRuYW1lLCBpbWFwZF91c2VyaXNhZG1p
biwKKwkJCQkgICBpbWFwZF91c2VyaWQsIGltYXBkX2F1dGhzdGF0ZSwKKwkJCQkgICAwLCAwLCAw
LCAxKTsKICAgICAKICAgICBpZihyKSB7CiAJcHJvdF9wcmludGYoaW1hcGRfb3V0LCAiKiBOTyBk
ZWxldGUgJXM6ICVzXHJcbiIsCkBAIC0zODI4LDE2ICszODQ2LDIzIEBACiAgICAgaWYgKCFyICYm
ICFsb2NhbG9ubHkgJiYKIAkhc3RybmNtcChtYWlsYm94bmFtZStkb21haW5sZW4sICJ1c2VyLiIs
IDUpICYmCiAJIXN0cmNocihtYWlsYm94bmFtZStkb21haW5sZW4rNSwgJy4nKSkgeworCWNoYXIg
bmFtZV9jb3B5W01BWF9NQUlMQk9YX05BTUUrMV07CisgCWludCBuYW1lX2xlbiA9IHN0cmxlbihu
YW1lKTsKICAJaW50IG1haWxib3huYW1lX2xlbiA9IHN0cmxlbihtYWlsYm94bmFtZSk7CiAKKwlt
ZW1jcHkobmFtZV9jb3B5LCBuYW1lLCBuYW1lX2xlbik7CiAgCS8qIElmIHdlIGFyZW4ndCB0b28g
Y2xvc2UgdG8gTUFYX01BSUxCT1hfTkFNRSwgYXBwZW5kIC4qICovCi0gCXAgPSBtYWlsYm94bmFt
ZSArIG1haWxib3huYW1lX2xlbjsgLyogZW5kIG9mIG1haWxib3huYW1lICovCi0gCWlmIChtYWls
Ym94bmFtZV9sZW4gPCBzaXplb2YobWFpbGJveG5hbWUpIC0gMykgewotIAkgICAgc3RyY3B5KHAs
ICIuKiIpOwotIAl9CisgCXAgPSBuYW1lX2NvcHkgKyBuYW1lX2xlbjsgLyogZW5kIG9mIG5hbWUg
Ki8KKyAJaWYgKG5hbWVfbGVuIDwgc2l6ZW9mKG5hbWVfY29weSkgLSAzKSB7CisJICAgICpwPWlt
YXBkX25hbWVzcGFjZS5oaWVyX3NlcDsKKwkgICAgcFsxXT0nKic7CisJICAgIHBbMl09MDsKKwl9
CisJZWxzZQorCSAgICAqcD0wOwogCQotCS8qIGJ1aWxkIGEgbGlzdCBvZiBtYWlsYm94ZXMgLSB3
ZSdyZSB1c2luZyBpbnRlcm5hbCBuYW1lcyBoZXJlICovCi0JbWJveGxpc3RfZmluZGFsbChOVUxM
LCBtYWlsYm94bmFtZSwgaW1hcGRfdXNlcmlzYWRtaW4sIGltYXBkX3VzZXJpZCwKKwkvKiBidWls
ZCBhIGxpc3Qgb2YgbWFpbGJveGVzIC0gd2UncmUgdXNpbmcgZXh0ZXJuYWwgbmFtZXMgaGVyZSAq
LworCW1ib3hsaXN0X2ZpbmRhbGwoJmltYXBkX25hbWVzcGFjZSwgbmFtZV9jb3B5LCBpbWFwZF91
c2VyaXNhZG1pbiwgaW1hcGRfdXNlcmlkLAogCQkJIGltYXBkX2F1dGhzdGF0ZSwgZGVsbWJveCwg
TlVMTCk7CiAKIAkvKiB0YWtlIGNhcmUgb2YgZGVsZXRpbmcgQUNMcywgc3Vic2NyaXB0aW9ucywg
c2VlbiBzdGF0ZSBhbmQgcXVvdGFzICovCkBAIC0zODc5LDEzICszOTA0LDE0IEBACiB9OwogCiAv
KiBDYWxsYmFjayBmb3IgdXNlIGJ5IGNtZF9yZW5hbWUgKi8KKy8qICduYW1lJyBpcyBhbiBleHRl
cm5hbCBtYWlsYm94IG5hbWUhICovCiBzdGF0aWMgaW50IHJlbm1ib3goY2hhciAqbmFtZSwKIAkJ
ICAgaW50IG1hdGNobGVuIF9fYXR0cmlidXRlX18oKHVudXNlZCkpLAogCQkgICBpbnQgbWF5Y3Jl
YXRlIF9fYXR0cmlidXRlX18oKHVudXNlZCkpLAogCQkgICB2b2lkICpyb2NrKQogewotICAgIGNo
YXIgb2xkZXh0bmFtZVtNQVhfTUFJTEJPWF9OQU1FKzFdOwotICAgIGNoYXIgbmV3ZXh0bmFtZVtN
QVhfTUFJTEJPWF9OQU1FKzFdOworICAgIGNoYXIgb2xkaW50bmFtZVtNQVhfTUFJTEJPWF9OQU1F
KzFdOworICAgIGNoYXIgbmV3aW50bmFtZVtNQVhfTUFJTEJPWF9OQU1FKzFdOwogICAgIHN0cnVj
dCByZW5yb2NrICp0ZXh0ID0gKHN0cnVjdCByZW5yb2NrICopcm9jazsKICAgICBpbnQgcjsKIApA
QCAtMzg5NCwzNiArMzkyMCwzOSBAQAogCiAgICAgc3RyY3B5KHRleHQtPm5ld21haWxib3huYW1l
ICsgdGV4dC0+bmwsIG5hbWUgKyB0ZXh0LT5vbCk7CiAKLSAgICByID0gbWJveGxpc3RfcmVuYW1l
bWFpbGJveChuYW1lLCB0ZXh0LT5uZXdtYWlsYm94bmFtZSwKKyAgICBpZigoKmltYXBkX25hbWVz
cGFjZS5tYm94bmFtZV90b2ludGVybmFsKSgmaW1hcGRfbmFtZXNwYWNlLAorCQkJCQkgICAgICB0
ZXh0LT5uZXdtYWlsYm94bmFtZSwKKwkJCQkJICAgICAgaW1hcGRfdXNlcmlkLCBuZXdpbnRuYW1l
KSkKKwlyZXR1cm4gMDsKKworICAgIGlmKCgqaW1hcGRfbmFtZXNwYWNlLm1ib3huYW1lX3RvaW50
ZXJuYWwpKCZpbWFwZF9uYW1lc3BhY2UsCisJCQkJCSAgICAgIG5hbWUsCisJCQkJCSAgICAgIGlt
YXBkX3VzZXJpZCwgb2xkaW50bmFtZSkpCisJcmV0dXJuIDA7CisKKyAgICByID0gbWJveGxpc3Rf
cmVuYW1lbWFpbGJveChvbGRpbnRuYW1lLCBuZXdpbnRuYW1lLAogCQkJICAgICAgIHRleHQtPnBh
cnRpdGlvbiwKIAkJCSAgICAgICAxLCBpbWFwZF91c2VyaWQsIGltYXBkX2F1dGhzdGF0ZSk7CiAg
ICAgCi0gICAgKCppbWFwZF9uYW1lc3BhY2UubWJveG5hbWVfdG9leHRlcm5hbCkoJmltYXBkX25h
bWVzcGFjZSwKLQkJCQkJICAgbmFtZSwKLQkJCQkJICAgaW1hcGRfdXNlcmlkLCBvbGRleHRuYW1l
KTsKLSAgICAoKmltYXBkX25hbWVzcGFjZS5tYm94bmFtZV90b2V4dGVybmFsKSgmaW1hcGRfbmFt
ZXNwYWNlLAotCQkJCQkgICB0ZXh0LT5uZXdtYWlsYm94bmFtZSwKLQkJCQkJICAgaW1hcGRfdXNl
cmlkLCBuZXdleHRuYW1lKTsKLQogICAgIGlmKHIpIHsKIAlwcm90X3ByaW50ZihpbWFwZF9vdXQs
ICIqIE5PIHJlbmFtZSAlcyAlczogJXNcclxuIiwKLQkJICAgIG9sZGV4dG5hbWUsIG5ld2V4dG5h
bWUsIGVycm9yX21lc3NhZ2UocikpOworCQkgICAgbmFtZSwgdGV4dC0+bmV3bWFpbGJveG5hbWUs
IGVycm9yX21lc3NhZ2UocikpOwogCWlmIChSRU5BTUVfU1RPUF9PTl9FUlJPUikgcmV0dXJuIHI7
CiAgICAgfSBlbHNlIHsKIAkvKiBJZiB3ZSdyZSByZW5hbWluZyBhIHVzZXIsIGNoYW5nZSBxdW90
YXJvb3QgYW5kIEFDTCAqLwogCWlmICh0ZXh0LT5yZW5hbWVfdXNlcikgewotCSAgICB1c2VyX2Nv
cHlxdW90YXJvb3QobmFtZSwgdGV4dC0+bmV3bWFpbGJveG5hbWUpOwotCSAgICB1c2VyX3JlbmFt
ZWFjbCh0ZXh0LT5uZXdtYWlsYm94bmFtZSwKKwkgICAgdXNlcl9jb3B5cXVvdGFyb290KG9sZGlu
dG5hbWUsIG5ld2ludG5hbWUpOworCSAgICB1c2VyX3JlbmFtZWFjbChuZXdpbnRuYW1lLAogCQkJ
ICAgdGV4dC0+YWNsX29sZHVzZXIsIHRleHQtPmFjbF9uZXd1c2VyKTsKIAl9CiAKIAkvKiBSZW5h
bWUgbWFpbGJveCBhbm5vdGF0aW9ucyAqLwotCWFubm90YXRlbW9yZV9yZW5hbWUobmFtZSwgdGV4
dC0+bmV3bWFpbGJveG5hbWUsCisJYW5ub3RhdGVtb3JlX3JlbmFtZShvbGRpbnRuYW1lLCBuZXdp
bnRuYW1lLAogCQkJICAgIHRleHQtPnJlbmFtZV91c2VyID8gdGV4dC0+b2xkdXNlciA6IE5VTEws
CiAJCQkgICAgdGV4dC0+bmV3dXNlcik7CiAJCiAJcHJvdF9wcmludGYoaW1hcGRfb3V0LCAiKiBP
SyByZW5hbWUgJXMgJXNcclxuIiwKLQkJICAgIG9sZGV4dG5hbWUsIG5ld2V4dG5hbWUpOworCQkg
ICAgbmFtZSwgdGV4dC0+bmV3bWFpbGJveG5hbWUpOwogICAgIH0KIAogICAgIHByb3RfZmx1c2go
aW1hcGRfb3V0KTsKQEAgLTM5MzgsMTAgKzM5NjcsOCBAQAogCQljaGFyICpvbGRuYW1lLCBjaGFy
ICpuZXduYW1lLCBjaGFyICpwYXJ0aXRpb24pCiB7CiAgICAgaW50IHIgPSAwOwotICAgIGNoYXIg
b2xkbWFpbGJveG5hbWVbTUFYX01BSUxCT1hfTkFNRSszXTsKLSAgICBjaGFyIG5ld21haWxib3hu
YW1lW01BWF9NQUlMQk9YX05BTUUrMl07Ci0gICAgY2hhciBvbGRleHRuYW1lW01BWF9NQUlMQk9Y
X05BTUUrMV07Ci0gICAgY2hhciBuZXdleHRuYW1lW01BWF9NQUlMQk9YX05BTUUrMV07CisgICAg
Y2hhciBvbGRtYWlsYm94bmFtZVtNQVhfTUFJTEJPWF9OQU1FKzFdOworICAgIGNoYXIgbmV3bWFp
bGJveG5hbWVbTUFYX01BSUxCT1hfTkFNRSsxXTsKICAgICBpbnQgb21sZW4sIG5tbGVuOwogICAg
IGNoYXIgKnA7CiAgICAgaW50IHJlY3Vyc2l2ZV9yZW5hbWUgPSAxOwpAQCAtNDA0OSwyNiArNDA3
NiwyNCBAQAogCiAgICAgLyogcmVuYW1lIGFsbCBtYWlsYm94ZXMgbWF0Y2hpbmcgdGhpcyAqLwog
ICAgIGlmICghciAmJiByZWN1cnNpdmVfcmVuYW1lKSB7CisJY2hhciBvbGRleHRuYW1lW01BWF9N
QUlMQk9YX05BTUUrM107CisJY2hhciBuZXdleHRuYW1lW01BWF9NQUlMQk9YX05BTUUrMl07CisJ
aW50IHRtcGxlbjsKIAlzdHJ1Y3QgcmVucm9jayByb2NrOwotCWludCBvbCA9IG9tbGVuICsgMTsK
LQlpbnQgbmwgPSBubWxlbiArIDE7Ci0KLQkoKmltYXBkX25hbWVzcGFjZS5tYm94bmFtZV90b2V4
dGVybmFsKSgmaW1hcGRfbmFtZXNwYWNlLAotCQkJCQkgICAgICAgb2xkbWFpbGJveG5hbWUsCi0J
CQkJCSAgICAgICBpbWFwZF91c2VyaWQsIG9sZGV4dG5hbWUpOwotCSgqaW1hcGRfbmFtZXNwYWNl
Lm1ib3huYW1lX3RvZXh0ZXJuYWwpKCZpbWFwZF9uYW1lc3BhY2UsCi0JCQkJCSAgICAgICBuZXdt
YWlsYm94bmFtZSwKLQkJCQkJICAgICAgIGltYXBkX3VzZXJpZCwgbmV3ZXh0bmFtZSk7CisJaW50
IG9sOworCWludCBubDsKIAorCW9sID0gc3RybGVuKG9sZG5hbWUpKzE7CisJbmwgPSBzdHJsZW4o
bmV3bmFtZSkrMTsKIAlwcm90X3ByaW50ZihpbWFwZF9vdXQsICIqIE9LIHJlbmFtZSAlcyAlc1xy
XG4iLAotCQkgICAgb2xkZXh0bmFtZSwgbmV3ZXh0bmFtZSk7CisJCSAgICBvbGRuYW1lLCBuZXdu
YW1lKTsKIAlwcm90X2ZsdXNoKGltYXBkX291dCk7CiAKLQlzdHJjYXQob2xkbWFpbGJveG5hbWUs
ICIuKiIpOwotCXN0cmNhdChuZXdtYWlsYm94bmFtZSwgIi4iKTsKKwlzbnByaW50ZihvbGRleHRu
YW1lLCBNQVhfTUFJTEJPWF9OQU1FKzMsICIlcyVjKiIsIG9sZG5hbWUsIGltYXBkX25hbWVzcGFj
ZS5oaWVyX3NlcCk7CisJc25wcmludGYobmV3ZXh0bmFtZSwgTUFYX01BSUxCT1hfTkFNRSsyLCAi
JXMlYyIsIG5ld25hbWUsIGltYXBkX25hbWVzcGFjZS5oaWVyX3NlcCk7CiAKIAkvKiBzZXR1cCB0
aGUgcm9jayAqLwotCXJvY2submV3bWFpbGJveG5hbWUgPSBuZXdtYWlsYm94bmFtZTsKKwlyb2Nr
Lm5ld21haWxib3huYW1lID0gbmV3ZXh0bmFtZTsKIAlyb2NrLm9sID0gb2w7CiAJcm9jay5ubCA9
IG5sOwogCXJvY2sub2xkdXNlciA9IG9sZHVzZXI7CkBAIC00MDc4LDkgKzQxMDMsOCBAQAogCXJv
Y2sucGFydGl0aW9uID0gcGFydGl0aW9uOwogCXJvY2sucmVuYW1lX3VzZXIgPSByZW5hbWVfdXNl
cjsKIAkKLQkvKiBhZGQgc3VibWFpbGJveGVzOyB3ZSBwcmV0ZW5kIHdlJ3JlIGFuIGFkbWluIHNp
bmNlIHdlIHN1Y2Nlc3NmdWxseQotCSAgIHJlbmFtZWQgdGhlIHBhcmVudCAtIHdlJ3JlIHVzaW5n
IGludGVybmFsIG5hbWVzIGhlcmUgKi8KLQlyID0gbWJveGxpc3RfZmluZGFsbChOVUxMLCBvbGRt
YWlsYm94bmFtZSwgMSwgaW1hcGRfdXNlcmlkLAorCS8qIGFkZCBzdWJtYWlsYm94ZXM7IHVzaW5n
IGV4dGVybmFsIG5hbWVzcGFjZSBoZXJlICovCisJciA9IGltYXBkX25hbWVzcGFjZS5tYm94bGlz
dF9maW5kYWxsKCZpbWFwZF9uYW1lc3BhY2UsIG9sZGV4dG5hbWUsIDEsIGltYXBkX3VzZXJpZCwK
IAkJCSAgICAgaW1hcGRfYXV0aHN0YXRlLCByZW5tYm94LCAmcm9jayk7CiAgICAgfQogCkBAIC00
MzQ2LDExICs0MzcwLDYgQEAKIAkgICAgcGF0dGVybiA9IGJ1ZjsKIAl9CiAKLQkvKiBUcmFuc2xh
dGUgYW55IHNlcGFyYXRvcnMgaW4gcGF0dGVybiAqLwotCW1ib3huYW1lX2hpZXJzZXBfdG9pbnRl
cm5hbCgmaW1hcGRfbmFtZXNwYWNlLCBwYXR0ZXJuLAotCQkJCSAgICBjb25maWdfdmlydGRvbWFp
bnMgPwotCQkJCSAgICBzdHJjc3BuKHBhdHRlcm4sICJAIikgOiAwKTsKLQogCS8qIENoZWNrIHRv
IHNlZSBpZiB3ZSBzaG91bGQgb25seSBsaXN0IHRoZSBwZXJzb25hbCBuYW1lc3BhY2UgKi8KIAlp
ZiAoIXN0cmNtcChwYXR0ZXJuLCAiKiIpCiAJICAgICYmIGNvbmZpZ19nZXRzd2l0Y2goSU1BUE9Q
VF9GT09MU1RVUElEQ0xJRU5UUykpIHsKQEAgLTUxMTIsMTUgKzUxMzEsMjAgQEAKIAkJCSB2b2lk
ICpyb2NrKQogewogICAgIGludCogc2F3b25lID0gKGludCopIHJvY2s7CisgICAgY2hhciBpbnRu
YW1lW01BWF9NQUlMQk9YX05BTUUrMV07CiAKICAgICBpZiAoIW5hbWUpIHsKIAlyZXR1cm4gMDsK
ICAgICB9CiAgICAgCi0gICAgaWYgKCEoc3RybmNtcChuYW1lLCAiSU5CT1guIiwgNikpKSB7Cisg
ICAgaWYoKCppbWFwZF9uYW1lc3BhY2UubWJveG5hbWVfdG9pbnRlcm5hbCkoJmltYXBkX25hbWVz
cGFjZSwgbmFtZSwKKwkJCQkJICAgICAgaW1hcGRfdXNlcmlkLCBpbnRuYW1lKSkKKwlyZXR1cm4g
MDsKKworICAgIGlmICghKHN0cm5jbXAoaW50bmFtZSwgIklOQk9YLiIsIDYpKSkgewogCS8qIFRo
ZSB1c2VyIGhhcyBhICJwZXJzb25hbCIgbmFtZXNwYWNlLiAqLwogCXNhd29uZVtOQU1FU1BBQ0Vf
SU5CT1hdID0gMTsKLSAgICB9IGVsc2UgaWYgKG1ib3huYW1lX2lzdXNlcm1haWxib3gobmFtZSwg
MCkpIHsKKyAgICB9IGVsc2UgaWYgKG1ib3huYW1lX2lzdXNlcm1haWxib3goaW50bmFtZSwgMCkp
IHsKIAkvKiBUaGUgdXNlciBjYW4gc2VlIHRoZSAib3RoZXIgdXNlcnMiIG5hbWVzcGFjZS4gKi8K
IAlzYXdvbmVbTkFNRVNQQUNFX1VTRVJdID0gMTsKICAgICB9IGVsc2UgewpAQCAtNTE1Nyw5ICs1
MTgxLDEwIEBACiAgICAgfSBlbHNlIHsKIAlwYXR0ZXJuID0geHN0cmR1cCgiJSIpOwogCS8qIG5v
dyBmaW5kIGFsbCB0aGUgZXhjaXRpbmcgdG9wbGV2ZWwgbmFtZXNwYWNlcyAtCi0JICogd2UncmUg
dXNpbmcgaW50ZXJuYWwgbmFtZXMgaGVyZQorCSAqIHdlJ3JlIHVzaW5nIGV4dGVybmFsIG5hbWVz
IGhlcmUKIAkgKi8KLQltYm94bGlzdF9maW5kYWxsKE5VTEwsIHBhdHRlcm4sIGltYXBkX3VzZXJp
c2FkbWluLCBpbWFwZF91c2VyaWQsCisJbWJveGxpc3RfZmluZGFsbCgmaW1hcGRfbmFtZXNwYWNl
LCBwYXR0ZXJuLCBpbWFwZF91c2VyaXNhZG1pbiwKKwkJCSBpbWFwZF91c2VyaWQsIAogCQkJIGlt
YXBkX2F1dGhzdGF0ZSwgbmFtZXNwYWNlZGF0YSwgKHZvaWQqKSBzYXdvbmUpOwogCWZyZWUocGF0
dGVybik7CiAgICAgfQpAQCAtNjU0Myw3ICs2NTY4LDcgQEAKICAgICBzdHJ1Y3QgYmFja2VuZCAq
YmU7CiB9OwogCi1zdGF0aWMgaW50IHhmZXJfdXNlcl9jYihjaGFyICpuYW1lLAorc3RhdGljIGlu
dCB4ZmVyX3VzZXJfY2IoY2hhciAqZXh0ZXJuYWxuYW1lLAogCQkJaW50IG1hdGNobGVuIF9fYXR0
cmlidXRlX18oKHVudXNlZCkpLAogCQkJaW50IG1heWNyZWF0ZSBfX2F0dHJpYnV0ZV9fKCh1bnVz
ZWQpKSwKIAkJCXZvaWQgKnJvY2spIApAQCAtNjU1MiwxMiArNjU3NywxNyBAQAogICAgIGNoYXIg
KnRvc2VydmVyID0gKChzdHJ1Y3QgeGZlcl91c2VyX3JvY2sgKilyb2NrKS0+dG9zZXJ2ZXI7CiAg
ICAgY2hhciAqdG9wYXJ0ID0gKChzdHJ1Y3QgeGZlcl91c2VyX3JvY2sgKilyb2NrKS0+dG9wYXJ0
OwogICAgIHN0cnVjdCBiYWNrZW5kICpiZSA9ICgoc3RydWN0IHhmZXJfdXNlcl9yb2NrICopcm9j
ayktPmJlOwotICAgIGNoYXIgZXh0ZXJuYWxuYW1lW01BWF9NQUlMQk9YX05BTUUrMV07CisgICAg
Y2hhciBuYW1lW01BWF9NQUlMQk9YX05BTUUrMV07CiAgICAgaW50IG1iZmxhZ3M7CiAgICAgaW50
IHIgPSAwOwogICAgIGNoYXIgKmlucGF0aCwgKmlucGFydCwgKmluYWNsOwogICAgIGNoYXIgKnBh
dGggPSBOVUxMLCAqcGFydCA9IE5VTEwsICphY2wgPSBOVUxMOwogCisgICAgciA9ICgqaW1hcGRf
bmFtZXNwYWNlLm1ib3huYW1lX3RvaW50ZXJuYWwpKCZpbWFwZF9uYW1lc3BhY2UsCisJCQkJCSAg
ICAgICBleHRlcm5hbG5hbWUsCisJCQkJCSAgICAgICBpbWFwZF91c2VyaWQsCisJCQkJCSAgICAg
ICBuYW1lKTsKKwogICAgIGlmICghcikgewogCS8qIE5PVEU6IE5PVCBtbG9va3VwKCkgYmVjYXVz
ZSB3ZSBkb24ndCB3YW50IHRvIGlzc3VlIGEgcmVmZXJyYWwgKi8KIAkvKiB4eHggYnV0IHdoYXQg
aGFwcGVucyBpZiB0aGV5IGFyZSByZW1vdGUKQEAgLTY1NzAsMTYgKzY2MDAsNiBAQAogCXBhdGgg
PSB4c3RyZHVwKGlucGF0aCk7CiAJcGFydCA9IHhzdHJkdXAoaW5wYXJ0KTsKIAlhY2wgPSB4c3Ry
ZHVwKGluYWNsKTsKLSAgICB9Ci0KLSAgICBpZiAoIXIpIHsKLQlyID0gKCppbWFwZF9uYW1lc3Bh
Y2UubWJveG5hbWVfdG9leHRlcm5hbCkoJmltYXBkX25hbWVzcGFjZSwKLQkJCQkJCSAgIG5hbWUs
Ci0JCQkJCQkgICBpbWFwZF91c2VyaWQsCi0JCQkJCQkgICBleHRlcm5hbG5hbWUpOwotICAgIH0K
LQotICAgIGlmKCFyKSB7CiAJciA9IGRvX3hmZXJfc2luZ2xlKHRvc2VydmVyLCB0b3BhcnQsIGV4
dGVybmFsbmFtZSwgbmFtZSwgbWJmbGFncywKIAkJCSAgIHBhdGgsIHBhcnQsIGFjbCwgMCwgbXVw
ZGF0ZV9oLCBiZSk7CiAgICAgfQpAQCAtNjcxOCw3ICs2NzM4LDcgQEAKIAl9CiAKIAotCS8qIHJl
Y3Vyc2l2ZWx5IG1vdmUgYWxsIHN1Yi1tYWlsYm94ZXMsIHVzaW5nIGludGVybmFsIG5hbWVzICov
CisJLyogcmVjdXJzaXZlbHkgbW92ZSBhbGwgc3ViLW1haWxib3hlcywgdXNpbmcgZXh0ZXJuYWwg
bmFtZXMgKi8KIAlpZighcikgewogCSAgICBzdHJ1Y3QgeGZlcl91c2VyX3JvY2sgcm9jazsKIApA
QCAtNjcyOCw3ICs2NzQ4LDcgQEAKIAkgICAgcm9jay5iZSA9IGJlOwogCiAJICAgIHNucHJpbnRm
KGJ1Ziwgc2l6ZW9mKGJ1ZiksICIlcy4qIiwgbWFpbGJveG5hbWUpOwotCSAgICByID0gbWJveGxp
c3RfZmluZGFsbChOVUxMLCBidWYsIDEsIGltYXBkX3VzZXJpZCwKKwkgICAgciA9IG1ib3hsaXN0
X2ZpbmRhbGwoJmltYXBkX25hbWVzcGFjZSwgYnVmLCAxLCBpbWFwZF91c2VyaWQsCiAJCQkJIGlt
YXBkX2F1dGhzdGF0ZSwgeGZlcl91c2VyX2NiLAogCQkJCSAmcm9jayk7CiAJfQpAQCAtNzQyMCwx
NyArNzQ0MCwxOSBAQAogLyoKICAqIElzc3VlIGEgTElTVCBvciBMU1VCIHVudGFnZ2VkIHJlc3Bv
bnNlCiAgKi8KKy8qIFRoZSAnbmFtZScgdmFyaWFibGUgbm93IGlzIGFuIGV4dGVybmFsIG5hbWUh
IC8vIHNvcmNlcmVyICovCiBzdGF0aWMgdm9pZCBtc3RyaW5nZGF0YShjaGFyICpjbWQsIGNoYXIg
Km5hbWUsIGludCBtYXRjaGxlbiwgaW50IG1heWNyZWF0ZSwKIAkJCWludCBsaXN0b3B0cykKIHsK
LSAgICBzdGF0aWMgY2hhciBsYXN0bmFtZVtNQVhfTUFJTEJPWF9QQVRIKzFdOworICAgIHN0YXRp
YyBjaGFyIGxhc3RuYW1lW01BWF9NQUlMQk9YX1BBVEgrMV09IiI7CisgICAgY2hhciBpbnRuYW1l
W01BWF9NQUlMQk9YX1BBVEgrMV07CiAgICAgc3RhdGljIGludCBsYXN0bmFtZWRlbGF5ZWQgPSAw
OwogICAgIHN0YXRpYyBpbnQgbGFzdG5hbWVub2luZmVyaW9ycyA9IDA7CiAgICAgc3RhdGljIGlu
dCBub25leGlzdGVudCA9IDA7CiAgICAgc3RhdGljIGludCBzYXd1c2VyID0gMDsKICAgICBpbnQg
bGFzdG5hbWVoYXNzdWIgPSAwOwogICAgIGludCBjLCBtYnR5cGU7Ci0gICAgY2hhciBtYm94bmFt
ZVtNQVhfTUFJTEJPWF9QQVRIKzFdOworICAgIGludCB1c2VycHJlZml4bGVuOwogCiAgICAgLyog
V2UgaGF2ZSB0byByZXNldCB0aGUgc2F3dXNlciBmbGFnIGJlZm9yZSBlYWNoIGxpc3QgY29tbWFu
ZC4KICAgICAgKiBIYW5kbGUgaXQgYXMgYSBkaXJ0eSBoYWNrLgpAQCAtNzQ0MiwxMCArNzQ2NCwx
NCBAQAogICAgIH0KICAgICBtc3RyaW5nZGF0YWNhbGxzKys7CiAKKyAgICBpZihuYW1lICYmICgq
aW1hcGRfbmFtZXNwYWNlLm1ib3huYW1lX3RvaW50ZXJuYWwpKCZpbWFwZF9uYW1lc3BhY2UsIG5h
bWUsCisJCQkJCSAgICAgIGltYXBkX3VzZXJpZCwgaW50bmFtZSkpCisJcmV0dXJuOworCiAgICAg
aWYgKGxhc3RuYW1lZGVsYXllZCkgewogCS8qIENoZWNrIGlmIGxhc3RuYW1lIGhhcyBjaGlsZHJl
biAqLwogCWlmIChuYW1lICYmIHN0cm5jbXAobGFzdG5hbWUsIG5hbWUsIHN0cmxlbihsYXN0bmFt
ZSkpID09IDAgJiYKLQkgICAgbmFtZVtzdHJsZW4obGFzdG5hbWUpXSA9PSAnLicpIHsKKwkgICAg
bmFtZVtzdHJsZW4obGFzdG5hbWUpXSA9PSBpbWFwZF9uYW1lc3BhY2UuaGllcl9zZXApIHsKIAkg
ICAgbGFzdG5hbWVoYXNzdWIgPSAxOwogCX0KIAlwcm90X3ByaW50ZihpbWFwZF9vdXQsICIqICVz
ICgiLCBjbWQpOwpAQCAtNzQ3MCw5ICs3NDk2LDcgQEAKIAl9CiAJcHJvdF9wcmludGYoaW1hcGRf
b3V0LCAiKSBcIiVjXCIgIiwgaW1hcGRfbmFtZXNwYWNlLmhpZXJfc2VwKTsKIAkJICAgIAotCSgq
aW1hcGRfbmFtZXNwYWNlLm1ib3huYW1lX3RvZXh0ZXJuYWwpKCZpbWFwZF9uYW1lc3BhY2UsIGxh
c3RuYW1lLAotCQkJCQkgICAgICAgaW1hcGRfdXNlcmlkLCBtYm94bmFtZSk7Ci0JcHJpbnRzdHJp
bmcobWJveG5hbWUpOworCXByaW50c3RyaW5nKGxhc3RuYW1lKTsKIAlwcm90X3ByaW50ZihpbWFw
ZF9vdXQsICJcclxuIik7CiAJbGFzdG5hbWVkZWxheWVkID0gbGFzdG5hbWVub2luZmVyaW9ycyA9
IG5vbmV4aXN0ZW50ID0gMDsKICAgICB9CkBAIC03NDg2LDcgKzc1MTAsNyBAQAogICAgIC8qIFN1
cHByZXNzIGFueSBvdXRwdXQgb2YgYSBwYXJ0aWFsIG1hdGNoICovCiAgICAgaWYgKChuYW1lW21h
dGNobGVuXQogCSAmJiBzdHJuY21wKGxhc3RuYW1lLCBuYW1lLCBtYXRjaGxlbikgPT0gMAotCSAm
JiAobGFzdG5hbWVbbWF0Y2hsZW5dID09ICdcMCcgfHwgbGFzdG5hbWVbbWF0Y2hsZW5dID09ICcu
JykpKSB7CisJICYmIChsYXN0bmFtZVttYXRjaGxlbl0gPT0gJ1wwJyB8fCBsYXN0bmFtZVttYXRj
aGxlbl0gPT0gaW1hcGRfbmFtZXNwYWNlLmhpZXJfc2VwKSkpIHsKIAlyZXR1cm47CiAgICAgfQog
CQpAQCAtNzQ5NCw3ICs3NTE4LDggQEAKICAgICAgKiBXZSBjYW4gZ2V0IGEgcGFydGlhbCBtYXRj
aCBmb3IgInVzZXIiIG11bHRpcGxlIHRpbWVzIHdpdGgKICAgICAgKiBvdGhlciBtYXRjaGVzIGlu
YmV0d2Vlbi4gIEhhbmRsZSBpdCBhcyBhIHNwZWNpYWwgY2FzZQogICAgICAqLwotICAgIGlmICht
YXRjaGxlbiA9PSA0ICYmIHN0cm5jYXNlY21wKG5hbWUsICJ1c2VyIiwgNCkgPT0gMCkgeworICAg
IHVzZXJwcmVmaXhsZW4gPSBzdHJsZW4oaW1hcGRfbmFtZXNwYWNlLnByZWZpeFtOQU1FU1BBQ0Vf
VVNFUl0pIC0gMTsKKyAgICBpZiAobWF0Y2hsZW4gPT0gdXNlcnByZWZpeGxlbiAmJiBzdHJuY2Fz
ZWNtcChuYW1lLCBpbWFwZF9uYW1lc3BhY2UucHJlZml4W05BTUVTUEFDRV9VU0VSXSwgdXNlcnBy
ZWZpeGxlbikgPT0gMCkgewogCWlmIChzYXd1c2VyKSByZXR1cm47CiAJc2F3dXNlciA9IDE7CiAg
ICAgfQpAQCAtNzUwNCwxNyArNzUyOSwxMiBAQAogICAgIG5vbmV4aXN0ZW50ID0gMDsKIAogICAg
IC8qIE5vdyB3ZSBuZWVkIHRvIHNlZSBpZiB0aGlzIG1haWxib3ggZXhpc3RzICovCi0gICAgLyog
Zmlyc3QgY29udmVydCAiSU5CT1giIHRvICJ1c2VyLjx1c2VyaWQ+IiAqLwotICAgIGlmICghc3Ry
bmNhc2VjbXAobGFzdG5hbWUsICJpbmJveCIsIDUpKSB7Ci0JKCppbWFwZF9uYW1lc3BhY2UubWJv
eG5hbWVfdG9pbnRlcm5hbCkoJmltYXBkX25hbWVzcGFjZSwgIklOQk9YIiwKLQkJCQkJICAgICAg
IGltYXBkX3VzZXJpZCwgbWJveG5hbWUpOwotCXN0cmxjYXQobWJveG5hbWUsIGxhc3RuYW1lKzUs
IHNpemVvZihtYm94bmFtZSkpOwotICAgIH0KLSAgICBlbHNlCi0Jc3RybGNweShtYm94bmFtZSwg
bGFzdG5hbWUsIHNpemVvZihtYm94bmFtZSkpOworCisgICAgLyogVGhlICdpbnRuYW1lJyB2YXJp
YWJsZSBjYW5ub3QgYmUgIklOQk9YIiwgdGhlcmVmb3JlIHdlIGRvbid0CisgICAgICAgbmVlZCB0
byBjb252ZXJ0IGl0IHRvICJ1c2VyLjx1c2VyaWQ+IiAqLwogCiAgICAgLyogTG9vayBpdCB1cCAq
LwotICAgIG5vbmV4aXN0ZW50ID0gbWJveGxpc3RfZGV0YWlsKG1ib3huYW1lLCAmbWJ0eXBlLAor
ICAgIG5vbmV4aXN0ZW50ID0gbWJveGxpc3RfZGV0YWlsKGludG5hbWUsICZtYnR5cGUsCiAJCQkJ
ICBOVUxMLCBOVUxMLCBOVUxMLCBOVUxMKTsKICAgICBpZighbm9uZXhpc3RlbnQgJiYgKG1idHlw
ZSAmIE1CVFlQRV9SRVNFUlZFKSkKIAlub25leGlzdGVudCA9IElNQVBfTUFJTEJPWF9SRVNFUlZF
RDsKQEAgLTc1MjksOSArNzU0OSw5IEBACiAgICAgaWYgKGMpIG5hbWVbbWF0Y2hsZW5dID0gJ1ww
JzsKICAgICBwcm90X3ByaW50ZihpbWFwZF9vdXQsICIqICVzICgiLCBjbWQpOwogICAgIGlmIChj
KSB7Ci0JLyogSGFuZGxlIG5hbWVzcGFjZSBwcmVmaXggYXMgYSBzcGVjaWFsIGNhc2UgKi8gCi0J
aWYgKCFzdHJjbXAobmFtZSwgInVzZXIiKSB8fAotCSAgICAhc3RyY21wKG5hbWUsIGltYXBkX25h
bWVzcGFjZS5wcmVmaXhbTkFNRVNQQUNFX1NIQVJFRF0pKSB7CisJLyogSGFuZGxlIG5hbWVzcGFj
ZSBwcmVmaXggYXMgYSBzcGVjaWFsIGNhc2UgKi8KKyAJaWYgKCFzdHJjbXAobmFtZSwgaW1hcGRf
bmFtZXNwYWNlLnByZWZpeFtOQU1FU1BBQ0VfVVNFUl0pIHx8CisgCSAgICAhc3RyY21wKG5hbWUs
IGltYXBkX25hbWVzcGFjZS5wcmVmaXhbTkFNRVNQQUNFX1NIQVJFRF0pKSB7CiAJICAgIHByb3Rf
cHJpbnRmKGltYXBkX291dCwgIlxcTm9zZWxlY3QiKTsKIAkgICAgaWYgKGxpc3RvcHRzICYgTElT
VF9FWFQpCiAJCXByb3RfcHJpbnRmKGltYXBkX291dCwgIiBcXFBsYWNlSG9sZGVyIik7CkBAIC03
NTUwLDkgKzc1NzAsNyBAQAogICAgIH0KICAgICBwcm90X3ByaW50ZihpbWFwZF9vdXQsICIpIFwi
JWNcIiAiLCBpbWFwZF9uYW1lc3BhY2UuaGllcl9zZXApOwogCi0gICAgKCppbWFwZF9uYW1lc3Bh
Y2UubWJveG5hbWVfdG9leHRlcm5hbCkoJmltYXBkX25hbWVzcGFjZSwgbmFtZSwKLQkJCQkJICAg
aW1hcGRfdXNlcmlkLCBtYm94bmFtZSk7Ci0gICAgcHJpbnRzdHJpbmcobWJveG5hbWUpOworICAg
IHByaW50c3RyaW5nKG5hbWUpOwogICAgIHByb3RfcHJpbnRmKGltYXBkX291dCwgIlxyXG4iKTsK
ICAgICBpZiAoYykgbmFtZVttYXRjaGxlbl0gPSBjOwogICAgIHJldHVybjsKZGlmZiAtdXJOIGN5
cnVzLWltYXBkLTIuMi4xMi5zdXBlcm9sZC9pbWFwL2lwdXJnZS5jIGN5cnVzLWltYXBkLTIuMi4x
Mi9pbWFwL2lwdXJnZS5jCi0tLSBjeXJ1cy1pbWFwZC0yLjIuMTIuc3VwZXJvbGQvaW1hcC9pcHVy
Z2UuYwkyMDA0LTA1LTI2IDE5OjMyOjEwICswNDAwCisrKyBjeXJ1cy1pbWFwZC0yLjIuMTIvaW1h
cC9pcHVyZ2UuYwkyMDA1LTEyLTI2IDE5OjE5OjE1ICswMzAwCkBAIC0xMDksNyArMTA5LDYgQEAK
IAogaW50IG1haW4gKGludCBhcmdjLCBjaGFyICphcmd2W10pIHsKICAgaW50IG9wdGlvbjsJCS8q
IGdldG9wdCgpIHJldHVybnMgYW4gaW50ICovCi0gIGNoYXIgYnVmW01BWF9NQUlMQk9YX1BBVEgr
MV07CiAgIGNoYXIgKmFsdF9jb25maWcgPSBOVUxMOwogICBpbnQgcjsKIApAQCAtMTg0LDE3ICsx
ODMsMTIgQEAKICAgcXVvdGFkYl9vcGVuKE5VTEwpOwogCiAgIGlmIChvcHRpbmQgPT0gYXJnYykg
eyAvKiBkbyB0aGUgd2hvbGUgcGFydGl0aW9uICovCi0gICAgc3RyY3B5KGJ1ZiwgIioiKTsKKyAg
ICBjaGFyICpidWY9IioiOwogICAgICgqcHVyZ2VfbmFtZXNwYWNlLm1ib3hsaXN0X2ZpbmRhbGwp
KCZwdXJnZV9uYW1lc3BhY2UsIGJ1ZiwgMSwgMCwgMCwKIAkJCQkJcHVyZ2VfbWUsIE5VTEwpOwog
ICB9IGVsc2UgewogICAgIGZvciAoOyBvcHRpbmQgPCBhcmdjOyBvcHRpbmQrKykgewotICAgICAg
c3RybmNweShidWYsIGFyZ3Zbb3B0aW5kXSwgTUFYX01BSUxCT1hfTkFNRSk7Ci0gICAgICAvKiBU
cmFuc2xhdGUgYW55IHNlcGFyYXRvcnMgaW4gbWFpbGJveG5hbWUgKi8KLSAgICAgIG1ib3huYW1l
X2hpZXJzZXBfdG9pbnRlcm5hbCgmcHVyZ2VfbmFtZXNwYWNlLCBidWYsCi0JCQkJICBjb25maWdf
dmlydGRvbWFpbnMgPwotCQkJCSAgc3RyY3NwbihidWYsICJAIikgOiAwKTsKLSAgICAgICgqcHVy
Z2VfbmFtZXNwYWNlLm1ib3hsaXN0X2ZpbmRhbGwpKCZwdXJnZV9uYW1lc3BhY2UsIGJ1ZiwgMSwg
MCwgMCwKKyAgICAgICgqcHVyZ2VfbmFtZXNwYWNlLm1ib3hsaXN0X2ZpbmRhbGwpKCZwdXJnZV9u
YW1lc3BhY2UsIGFyZ3Zbb3B0aW5kXSwgMSwgMCwgMCwKIAkJCQkJICBwdXJnZV9tZSwgTlVMTCk7
CiAgICAgfQogICB9CkBAIC0yMjgsMjcgKzIyMiwyNyBAQAogICBzdHJ1Y3QgbWFpbGJveCB0aGVf
Ym94OwogICBpbnQgICAgICAgICAgICBlcnJvcjsKICAgbWJveF9zdGF0c190ICAgc3RhdHM7Cisg
IGNoYXIgaW50bmFtZVtNQVhfTUFJTEJPWF9QQVRIKzFdOworCisgIGlmKCgqcHVyZ2VfbmFtZXNw
YWNlLm1ib3huYW1lX3RvaW50ZXJuYWwpKCZwdXJnZV9uYW1lc3BhY2UsIG5hbWUsCisJCQkJCSAg
IE5VTEwsIGludG5hbWUpKQorICAgICAgcmV0dXJuIDA7CiAKICAgaWYoICEgZm9yY2VhbGwgKSB7
CiAgICAgICAvKiBET04nVCBwdXJnZSBJTkJPWCogYW5kIHVzZXIuKiAqLwotICAgICAgaWYgKCFz
dHJuY2FzZWNtcChuYW1lLCJJTkJPWCIsNSkgfHwgbWJveG5hbWVfaXN1c2VybWFpbGJveChuYW1l
LCAwKSkKKyAgICAgIGlmICghc3RybmNhc2VjbXAobmFtZSwiSU5CT1giLDUpIHx8IG1ib3huYW1l
X2lzdXNlcm1haWxib3goaW50bmFtZSwgMCkpCiAJICByZXR1cm4gMDsKICAgfQogCiAgIG1lbXNl
dCgmc3RhdHMsICdcMCcsIHNpemVvZihtYm94X3N0YXRzX3QpKTsKIAogICBpZiAodmVyYm9zZSkg
ewotICAgICAgY2hhciBtYm94bmFtZVtNQVhfTUFJTEJPWF9OQU1FKzFdOwotCi0gICAgICAvKiBD
b252ZXJ0IGludGVybmFsIG5hbWUgdG8gZXh0ZXJuYWwgKi8KLSAgICAgICgqcHVyZ2VfbmFtZXNw
YWNlLm1ib3huYW1lX3RvZXh0ZXJuYWwpKCZwdXJnZV9uYW1lc3BhY2UsIG5hbWUsCi0JCQkJCSAg
ICAgImN5cnVzIiwgbWJveG5hbWUpOwotICAgICAgcHJpbnRmKCJXb3JraW5nIG9uICVzLi4uXG4i
LCBtYm94bmFtZSk7CisgICAgICBwcmludGYoIldvcmtpbmcgb24gJXMuLi5cbiIsIG5hbWUpOwog
ICB9CiAKLSAgZXJyb3IgPSBtYWlsYm94X29wZW5faGVhZGVyKG5hbWUsIDAsICZ0aGVfYm94KTsK
KyAgZXJyb3IgPSBtYWlsYm94X29wZW5faGVhZGVyKGludG5hbWUsIDAsICZ0aGVfYm94KTsKICAg
aWYgKGVycm9yICE9IDApIHsgLyogZGlkIHdlIGZpbmQgaXQ/ICovCi0gICAgc3lzbG9nKExPR19F
UlIsICJDb3VsZG4ndCBmaW5kICVzLCBjaGVjayBzcGVsbGluZyIsIG5hbWUpOworICAgIHN5c2xv
ZyhMT0dfRVJSLCAiQ291bGRuJ3QgZmluZCAlcywgY2hlY2sgc3BlbGxpbmciLCBpbnRuYW1lKTsK
ICAgICByZXR1cm4gZXJyb3I7CiAgIH0KICAgaWYgKHRoZV9ib3guaGVhZGVyX2ZkICE9IC0xKSB7
CkBAIC0yNjQsNyArMjU4LDcgQEAKICAgZXJyb3IgPSBtYWlsYm94X29wZW5faW5kZXgoJnRoZV9i
b3gpOwogICBpZiAoZXJyb3IgIT0gMCkgewogICAgIG1haWxib3hfY2xvc2UoJnRoZV9ib3gpOwot
ICAgIHN5c2xvZyhMT0dfRVJSLCAiQ291bGRuJ3Qgb3BlbiBtYWlsYm94IGluZGV4IGZvciAlcyIs
IG5hbWUpOworICAgIHN5c2xvZyhMT0dfRVJSLCAiQ291bGRuJ3Qgb3BlbiBtYWlsYm94IGluZGV4
IGZvciAlcyIsIGludG5hbWUpOwogICAgIHJldHVybiBlcnJvcjsKICAgfQogICAodm9pZCkgbWFp
bGJveF9sb2NrX2luZGV4KCZ0aGVfYm94KTsKZGlmZiAtdXJOIGN5cnVzLWltYXBkLTIuMi4xMi5z
dXBlcm9sZC9pbWFwL21iZXhhbWluZS5jIGN5cnVzLWltYXBkLTIuMi4xMi9pbWFwL21iZXhhbWlu
ZS5jCi0tLSBjeXJ1cy1pbWFwZC0yLjIuMTIuc3VwZXJvbGQvaW1hcC9tYmV4YW1pbmUuYwkyMDA0
LTEyLTE3IDE5OjMyOjE2ICswMzAwCisrKyBjeXJ1cy1pbWFwZC0yLjIuMTIvaW1hcC9tYmV4YW1p
bmUuYwkyMDA1LTEyLTI2IDE5OjE5OjE1ICswMzAwCkBAIC0xMTUsNyArMTE1LDYgQEAKIGludCBt
YWluKGludCBhcmdjLCBjaGFyICoqYXJndikKIHsKICAgICBpbnQgb3B0LCBpLCByOwotICAgIGNo
YXIgYnVmW01BWF9NQUlMQk9YX1BBVEgrMV07CiAgICAgY2hhciAqYWx0X2NvbmZpZyA9IE5VTEw7
CiAKIC8qICAgIGlmIChnZXRldWlkKCkgPT0gMCkgZmF0YWwoIm11c3QgcnVuIGFzIHRoZSBDeXJ1
cyB1c2VyIiwgRUNfVVNBR0UpOyAqLwpAQCAtMTYxLDE2ICsxNjAsMTMgQEAKICAgICBzaWduYWxz
X2FkZF9oYW5kbGVycygwKTsKIAogICAgIGlmIChvcHRpbmQgPT0gYXJnYykgewotCXN0cmxjcHko
YnVmLCAiKiIsIHNpemVvZihidWYpKTsKKwljaGFyICpidWY9IioiOwogCSgqcmVjb25fbmFtZXNw
YWNlLm1ib3hsaXN0X2ZpbmRhbGwpKCZyZWNvbl9uYW1lc3BhY2UsIGJ1ZiwgMSwgMCwgMCwKIAkJ
CQkJICAgIGRvX2V4YW1pbmUsIE5VTEwpOwogICAgIH0KIAogICAgIGZvciAoaSA9IG9wdGluZDsg
aSA8IGFyZ2M7IGkrKykgewotCS8qIEhhbmRsZSB2aXJ0ZG9tYWlucyBhbmQgc2VwYXJhdG9ycyBp
biBtYWlsYm94bmFtZSAqLwotCSgqcmVjb25fbmFtZXNwYWNlLm1ib3huYW1lX3RvaW50ZXJuYWwp
KCZyZWNvbl9uYW1lc3BhY2UsIGFyZ3ZbaV0sCi0JCQkJCSAgICAgICBOVUxMLCBidWYpOwotCSgq
cmVjb25fbmFtZXNwYWNlLm1ib3hsaXN0X2ZpbmRhbGwpKCZyZWNvbl9uYW1lc3BhY2UsIGJ1Ziwg
MSwgMCwKKwkoKnJlY29uX25hbWVzcGFjZS5tYm94bGlzdF9maW5kYWxsKSgmcmVjb25fbmFtZXNw
YWNlLCBhcmd2W2ldLCAxLCAwLAogCQkJCQkgICAgMCwgZG9fZXhhbWluZSwgTlVMTCk7CiAgICAg
fQogCkBAIC0xOTgsNyArMTk0LDcgQEAKIHsKICAgICBpbnQgaSxyID0gMDsKICAgICBpbnQgZmxh
ZyA9IDA7Ci0gICAgY2hhciBleHRfbmFtZV9idWZbTUFYX01BSUxCT1hfUEFUSCsxXTsKKyAgICBj
aGFyIGludF9uYW1lX2J1ZltNQVhfTUFJTEJPWF9QQVRIKzFdOwogICAgIHN0cnVjdCBtYWlsYm94
IG1haWxib3g7CiAgICAgY29uc3QgY2hhciAqaW5kZXhfYmFzZTsKICAgICBsb25nIGludCBzdGFy
dF9vZmZzZXQsIHJlY29yZF9zaXplOwpAQCAtMjA2LDEyICsyMDIsMTQgQEAKICAgICBzaWduYWxz
X3BvbGwoKTsKIAogICAgIC8qIENvbnZlcnQgaW50ZXJuYWwgbmFtZSB0byBleHRlcm5hbCAqLwot
ICAgICgqcmVjb25fbmFtZXNwYWNlLm1ib3huYW1lX3RvZXh0ZXJuYWwpKCZyZWNvbl9uYW1lc3Bh
Y2UsIG5hbWUsCi0JCQkJCSAgICJjeXJ1cyIsIGV4dF9uYW1lX2J1Zik7Ci0gICAgcHJpbnRmKCJF
eGFtaW5pbmcgJXMuLi5cbiIsIGV4dF9uYW1lX2J1Zik7CisgICAgaWYoKHIgPSAoKnJlY29uX25h
bWVzcGFjZS5tYm94bmFtZV90b2ludGVybmFsKSgmcmVjb25fbmFtZXNwYWNlLCBuYW1lLAorCQkJ
CQkJICAgTlVMTCwgaW50X25hbWVfYnVmKSkpCisJcmV0dXJuIHI7CisKKyAgICBwcmludGYoIkV4
YW1pbmluZyAlcy4uLlxuIiwgbmFtZSk7CiAKICAgICAvKiBPcGVuL2xvY2sgaGVhZGVyICovCi0g
ICAgciA9IG1haWxib3hfb3Blbl9oZWFkZXIobmFtZSwgMCwgJm1haWxib3gpOworICAgIHIgPSBt
YWlsYm94X29wZW5faGVhZGVyKGludF9uYW1lX2J1ZiwgMCwgJm1haWxib3gpOwogICAgIGlmIChy
KSB7CiAJcmV0dXJuIHI7CiAgICAgfQpkaWZmIC11ck4gY3lydXMtaW1hcGQtMi4yLjEyLnN1cGVy
b2xkL2ltYXAvbWJveGxpc3QuYyBjeXJ1cy1pbWFwZC0yLjIuMTIvaW1hcC9tYm94bGlzdC5jCi0t
LSBjeXJ1cy1pbWFwZC0yLjIuMTIuc3VwZXJvbGQvaW1hcC9tYm94bGlzdC5jCTIwMDUtMTItMjYg
MTk6MTc6MTUgKzAzMDAKKysrIGN5cnVzLWltYXBkLTIuMi4xMi9pbWFwL21ib3hsaXN0LmMJMjAw
NS0xMi0yNiAxOToyMToxNCArMDMwMApAQCAtOTQsNiArOTQsNyBAQAogCiBzdHJ1Y3QgZGIgKm1i
ZGI7CiAKK3N0cnVjdCBuYW1lc3BhY2UgaW50ZXJuYWxfbmFtZXNwYWNlOwogc3RhdGljIGludCBt
Ym94bGlzdF9kYm9wZW4gPSAwOwogCiBzdGF0aWMgaW50IG1ib3hsaXN0X29wZW5zdWJzKCk7CkBA
IC0xMDc1LDggKzEwNzYsOCBAQAogICAgICAgICAgICAgfQogCQkvKiBmaW5kIGlmIHRoZXJlIGFy
ZSBzdWJmb2xkZXJzLiBUaGVuIHdlIHdhbnQgdG8gCiAJCSAqIGtlZXAgdGhlIGV4aXN0aW5nIHF1
b3RhICovCi0gICAgICAgICAgICBtYm94bGlzdF9maW5kYWxsKE5VTEwsIHBhdHRlcm4sIGlzYWRt
aW4sIHVzZXJpZCwKLSAgICAgICAgICAgICAgICAgICAgYXV0aF9zdGF0ZSwgY2hpbGRfY2IsICh2
b2lkICopICZoYXNfY2hpbGRyZW4pOworICAgICAgICAgICAgbWJveGxpc3RfZmluZGFsbCgmaW50
ZXJuYWxfbmFtZXNwYWNlLCBwYXR0ZXJuLCAxLCBOVUxMLAorICAgICAgICAgICAgICAgICAgICBO
VUxMLCBjaGlsZF9jYiwgKHZvaWQgKikgJmhhc19jaGlsZHJlbik7CiAKIAkgICAgaWYoIWhhc19j
aGlsZHJlbikKICAgICAgICAgICAgICAgICBpZighbWJveGxpc3RfbXlsb29rdXAocXVvdGFyb290
LCBOVUxMLCBOVUxMLCBOVUxMLCBOVUxMLCBOVUxMLCAwICkpCkBAIC0xNzUyLDM1ICsxNzUzLDM5
IEBACiAgICAgbG9uZyBtaW5tYXRjaDsKICAgICBzdHJ1Y3QgZ2xvYiAqZyA9IHJvY2stPmc7CiAg
ICAgbG9uZyBtYXRjaGxlbjsKKyAgICBjaGFyIG5hbWVidWZbTUFYX01BSUxCT1hfTkFNRSsxXTsK
KyAgICBjaGFyIG5hbWVidWZfb3V0W01BWF9NQUlMQk9YX05BTUUrMV07CiAKICAgICAvKiBkb24n
dCBsaXN0IG1haWxib3hlcyBvdXRzaWRlIG9mIHRoZSBkZWZhdWx0IGRvbWFpbiAqLwogICAgIGlm
ICghcm9jay0+ZG9tYWlubGVuICYmICFyb2NrLT5pc2FkbWluICYmIHN0cmNocihrZXksICchJykp
IHJldHVybiAwOyAKIAogICAgIG1pbm1hdGNoID0gMDsKLSAgICBpZiAocm9jay0+aW5ib3hvZmZz
ZXQpIHsKLQljaGFyIG5hbWVidWZbTUFYX01BSUxCT1hfTkFNRSsxXTsKIAotCWlmKGtleWxlbiA+
PSBzaXplb2YobmFtZWJ1ZikpIHsKLQkgICAgc3lzbG9nKExPR19FUlIsICJvdmVyc2l6ZSBrZXls
ZW4gaW4gbWJveGxpc3QuYzpmaW5kX3AoKSIpOwotCSAgICByZXR1cm4gMDsKLQl9Ci0JbWVtY3B5
KG5hbWVidWYsIGtleSwga2V5bGVuKTsKLQluYW1lYnVmW2tleWxlbl0gPSAnXDAnOwotCQotCWlm
IChyb2NrLT5pbmJveG9mZnNldCkgewotCSAgICBuYW1lYnVmW3JvY2stPmluYm94b2Zmc2V0XSA9
IHJvY2stPmluYm94Y2FzZVswXTsKLQkgICAgbmFtZWJ1Zltyb2NrLT5pbmJveG9mZnNldCsxXSA9
IHJvY2stPmluYm94Y2FzZVsxXTsKLQkgICAgbmFtZWJ1Zltyb2NrLT5pbmJveG9mZnNldCsyXSA9
IHJvY2stPmluYm94Y2FzZVsyXTsKLQkgICAgbmFtZWJ1Zltyb2NrLT5pbmJveG9mZnNldCszXSA9
IHJvY2stPmluYm94Y2FzZVszXTsKLQkgICAgbmFtZWJ1Zltyb2NrLT5pbmJveG9mZnNldCs0XSA9
IHJvY2stPmluYm94Y2FzZVs0XTsKLQl9Ci0JCi0JbWF0Y2hsZW4gPSBnbG9iX3Rlc3QoZywgbmFt
ZWJ1Zityb2NrLT5pbmJveG9mZnNldCwKLQkJCSAgICAga2V5bGVuLXJvY2stPmluYm94b2Zmc2V0
LCAmbWlubWF0Y2gpOwotICAgIH0gZWxzZSB7Ci0JbWF0Y2hsZW4gPSBnbG9iX3Rlc3QoZywga2V5
LCBrZXlsZW4sICZtaW5tYXRjaCk7CisgICAgbWVtY3B5KG5hbWVidWYsIGtleSwga2V5bGVuKTsK
KyAgICBuYW1lYnVmW2tleWxlbl0gPSAnXDAnOworCisgICAgLyogcmlnaHQgd29yayB3aXRoIGFu
IGFsdGVybmF0ZSAobm90IHRoZSBidWlsZC1pbikKKyAgICAgICBuYW1lc3BhY2UgLS0gc29yY2Vy
ZXIgKi8KKyAgICBpZihrZXlsZW4gPj0gc2l6ZW9mKG5hbWVidWYpKSB7CisJc3lzbG9nKExPR19F
UlIsICJvdmVyc2l6ZSBrZXlsZW4gaW4gbWJveGxpc3QuYzpmaW5kX3AoKSIpOworCXJldHVybiAw
OworICAgIH0KKyAgICBpZihyb2NrLT5pbmJveG9mZnNldCkgeworCW5hbWVidWZbcm9jay0+aW5i
b3hvZmZzZXRdID0gcm9jay0+aW5ib3hjYXNlWzBdOworCW5hbWVidWZbcm9jay0+aW5ib3hvZmZz
ZXQrMV0gPSByb2NrLT5pbmJveGNhc2VbMV07CisJbmFtZWJ1Zltyb2NrLT5pbmJveG9mZnNldCsy
XSA9IHJvY2stPmluYm94Y2FzZVsyXTsKKwluYW1lYnVmW3JvY2stPmluYm94b2Zmc2V0KzNdID0g
cm9jay0+aW5ib3hjYXNlWzNdOworCW5hbWVidWZbcm9jay0+aW5ib3hvZmZzZXQrNF0gPSByb2Nr
LT5pbmJveGNhc2VbNF07CiAgICAgfQogCisgICAgLyogaWYgY2FudCBnZXQgdGhlIGV4dGVybmFs
IG5hbWUgdGhlbiBza2lwIHRoZSBjdXJyZW50CisgICAgICAga2V5IC0tIHNvcmNlcmVyICovCisg
ICAgaWYoKHJvY2stPm5hbWVzcGFjZS0+bWJveG5hbWVfdG9leHRlcm5hbCkocm9jay0+bmFtZXNw
YWNlLCBuYW1lYnVmK3JvY2stPmluYm94b2Zmc2V0LCBhdXRoX2Nhbm9udXNlcihyb2NrLT5hdXRo
X3N0YXRlKSwgbmFtZWJ1Zl9vdXQpKQorCXJldHVybiAwOworCisgICAgbWF0Y2hsZW4gPSBnbG9i
X3Rlc3QoZywgbmFtZWJ1Zl9vdXQsCisJCQkgc3RybGVuKG5hbWVidWZfb3V0KSwgJm1pbm1hdGNo
KTsKKwogICAgIC8qIElmIGl0cyBub3QgYSBtYXRjaCwgc2tpcCBpdCAtLSBwYXJ0aWFsIG1hdGNo
ZXMgYXJlIG9rLiAqLwogICAgIGlmKG1hdGNobGVuID09IC0xKSByZXR1cm4gMDsKIApAQCAtMTg4
MSwyMiArMTg4NiwzMiBAQAogCSAgICByID0gMDsJCS8qIGRvbid0IGJvdGhlciBjaGVja2luZyAq
LwogCX0KIAotCWlmICghciAmJiByb2NrLT5pbmJveG9mZnNldCkgewotCSAgICBuYW1lYnVmW3Jv
Y2stPmluYm94b2Zmc2V0XSA9IHJvY2stPmluYm94Y2FzZVswXTsKLQkgICAgbmFtZWJ1Zltyb2Nr
LT5pbmJveG9mZnNldCsxXSA9IHJvY2stPmluYm94Y2FzZVsxXTsKLQkgICAgbmFtZWJ1Zltyb2Nr
LT5pbmJveG9mZnNldCsyXSA9IHJvY2stPmluYm94Y2FzZVsyXTsKLQkgICAgbmFtZWJ1Zltyb2Nr
LT5pbmJveG9mZnNldCszXSA9IHJvY2stPmluYm94Y2FzZVszXTsKLQkgICAgbmFtZWJ1Zltyb2Nr
LT5pbmJveG9mZnNldCs0XSA9IHJvY2stPmluYm94Y2FzZVs0XTsKLQl9Ci0JCi0JbWF0Y2hsZW4g
PSBnbG9iX3Rlc3QoZywgbmFtZWJ1Zityb2NrLT5pbmJveG9mZnNldCwKLQkJCSAgICAga2V5bGVu
LXJvY2stPmluYm94b2Zmc2V0LCAmbWlubWF0Y2gpOworCS8qIHJpZ2h0IHdvcmsgd2l0aCBhbiBh
bHRlcm5hdGUgKG5vdCB0aGUgYnVpbGQtaW4pCisJICAgbmFtZXNwYWNlIC8vIHNvcmNlcmVyICov
CisJeworCSAgICBjaGFyIG5hbWVidWZfb3V0W01BWF9NQUlMQk9YX05BTUUrMV07CisJICAgIGlm
KHJvY2stPmluYm94b2Zmc2V0KSB7CisJCW5hbWVidWZbcm9jay0+aW5ib3hvZmZzZXRdID0gcm9j
ay0+aW5ib3hjYXNlWzBdOworCQluYW1lYnVmW3JvY2stPmluYm94b2Zmc2V0KzFdID0gcm9jay0+
aW5ib3hjYXNlWzFdOworCQluYW1lYnVmW3JvY2stPmluYm94b2Zmc2V0KzJdID0gcm9jay0+aW5i
b3hjYXNlWzJdOworCQluYW1lYnVmW3JvY2stPmluYm94b2Zmc2V0KzNdID0gcm9jay0+aW5ib3hj
YXNlWzNdOworCQluYW1lYnVmW3JvY2stPmluYm94b2Zmc2V0KzRdID0gcm9jay0+aW5ib3hjYXNl
WzRdOworCSAgICB9CisJICAgIGlmKChyb2NrLT5uYW1lc3BhY2UtPm1ib3huYW1lX3RvZXh0ZXJu
YWwpKHJvY2stPm5hbWVzcGFjZSwgbmFtZWJ1Zityb2NrLT5pbmJveG9mZnNldCwgYXV0aF9jYW5v
bnVzZXIocm9jay0+YXV0aF9zdGF0ZSksIG5hbWVidWZfb3V0KSkgeworCQlyID0gMDsKKwkJYnJl
YWs7CisJICAgIH0KKwkgICAgc3RyY3B5KG5hbWVidWYsIG5hbWVidWZfb3V0KTsKIAotCWlmICht
YXRjaGxlbiA9PSAtMSkgewotCSAgICByID0gMDsKLQkgICAgYnJlYWs7Ci0JfQorCSAgICBtYXRj
aGxlbiA9IGdsb2JfdGVzdChnLCBuYW1lYnVmLAorCQkJCSBzdHJsZW4obmFtZWJ1ZiksICZtaW5t
YXRjaCk7CiAKKwkgICAgaWYgKG1hdGNobGVuID09IC0xKSB7CisJCXIgPSAwOworCQlicmVhazsK
KwkgICAgfQorCX0KKwkKIAlzd2l0Y2ggKHIpIHsKIAljYXNlIDA6CiAJICAgIC8qIGZvdW5kIHRo
ZSBlbnRyeTsgb3V0cHV0IGl0ICovCkBAIC0xOTE1LDcgKzE5MzAsNyBAQAogCSAgICB9CiAKIAkg
ICAgcm9jay0+Y2hlY2tzaGFyZWQgPSAwOwotCSAgICByID0gKCpyb2NrLT5wcm9jKShuYW1lYnVm
K3JvY2stPmluYm94b2Zmc2V0LCBtYXRjaGxlbiwgCisJICAgIHIgPSAoKnJvY2stPnByb2MpKG5h
bWVidWYsIG1hdGNobGVuLCAKIAkJCSAgICAgIDEsIHJvY2stPnByb2Nyb2NrKTsKIAogCSAgICBi
cmVhazsKQEAgLTE5NTksNyArMTk3NCw2IEBACiAgICAgaW50IHByZWZpeGxlbjsKICAgICBpbnQg
dXNlcmxlbiA9IHVzZXJpZCA/IHN0cmxlbih1c2VyaWQpIDogMCwgZG9tYWlubGVuID0gMDsKICAg
ICBjaGFyIGRvbWFpbnBhdFtNQVhfTUFJTEJPWF9OQU1FKzFdID0gIiI7IC8qIGRvIGludHJhLWRv
bWFpbiBmZXRjaGVzIG9ubHkgKi8KLSAgICBjaGFyICpwYXQgPSBOVUxMOwogCiAgICAgaWYgKGNv
bmZpZ192aXJ0ZG9tYWlucykgewogCWNoYXIgKmRvbWFpbjsKQEAgLTIwMDAsOCArMjAxNCwxMCBA
QAogICAgIGlmIChkb21haW5wYXRbMF0gPT0gJ1wwJykKIAlzdHJsY3B5KGRvbWFpbnBhdCwgcGF0
dGVybiwgc2l6ZW9mKGRvbWFpbnBhdCkpOwogCi0gICAgY2Jyb2NrLmcgPSBnbG9iX2luaXQocGF0
dGVybiwgR0xPQl9ISUVSQVJDSFl8R0xPQl9JTkJPWENBU0UpOwotICAgIGNicm9jay5uYW1lc3Bh
Y2UgPSBOVUxMOworICAgIG1ib3huYW1lX2hpZXJzZXBfdG9pbnRlcm5hbChuYW1lc3BhY2UsIGRv
bWFpbnBhdCwgMCk7CisKKyAgICBjYnJvY2suZyA9IGdsb2JfaW5pdChwYXR0ZXJuLCBuYW1lc3Bh
Y2UtPmhpZXJfc2VwLCBHTE9CX0hJRVJBUkNIWXxHTE9CX0lOQk9YQ0FTRSk7CisgICAgY2Jyb2Nr
Lm5hbWVzcGFjZSA9IG5hbWVzcGFjZTsKICAgICBjYnJvY2suZG9tYWlubGVuID0gZG9tYWlubGVu
OwogICAgIGNicm9jay5pbmJveGNhc2UgPSBnbG9iX2luYm94Y2FzZShjYnJvY2suZyk7CiAgICAg
Y2Jyb2NrLmlzYWRtaW4gPSBpc2FkbWluOwpAQCAtMjAzNSwxNiArMjA1MSw2IEBACiAJICAgIH0K
IAkgICAgZWxzZSBpZiAociA9PSBDWVJVU0RCX05PVEZPVU5EKSByID0gMDsKIAl9Ci0JZWxzZSBp
ZiAoIXN0cm5jbXAocGF0dGVybiwKLQkJCSAgdXNlcm1ib3huYW1lK2RvbWFpbmxlbiwgdXNlcm1i
b3huYW1lbGVuLWRvbWFpbmxlbikgJiYKLQkJIEdMT0JfVEVTVChjYnJvY2suZywgdXNlcm1ib3hu
YW1lK2RvbWFpbmxlbikgIT0gLTEpIHsKLQkgICAgciA9IERCLT5mZXRjaChtYmRiLCB1c2VybWJv
eG5hbWUsIHVzZXJtYm94bmFtZWxlbiwKLQkJCSAgJmRhdGEsICZkYXRhbGVuLCBOVUxMKTsKLQkg
ICAgaWYgKCFyICYmIGRhdGEpIHsKLQkJciA9ICgqcHJvYykodXNlcm1ib3huYW1lLCB1c2VybWJv
eG5hbWVsZW4sIDEsIHJvY2spOwotCSAgICB9Ci0JICAgIGVsc2UgaWYgKHIgPT0gQ1lSVVNEQl9O
T1RGT1VORCkgciA9IDA7Ci0JfQogCXN0cmxjYXQodXNlcm1ib3huYW1lLCAiLiIsIHNpemVvZih1
c2VybWJveG5hbWUpKTsKIAl1c2VybWJveG5hbWVsZW4rKzsKIApAQCAtMjA1NywzMyArMjA2Mywx
OCBAQAogCiAgICAgaWYgKHIpIGdvdG8gZG9uZTsKIAotICAgIC8qIE1ha2UgYSB3b3JraW5nIGNv
cHkgb2YgcGF0dGVybiAqLwotICAgIHBhdHRlcm4gPSBwYXQgPSB4c3RyZHVwKHBhdHRlcm4pOwot
CiAgICAgLyogRmluZCBmaXhlZC1zdHJpbmcgcGF0dGVybiBwcmVmaXggKi8KLSAgICBmb3IgKHAg
PSBwYXQ7ICpwOyBwKyspIHsKKyAgICBmb3IgKHAgPSAoY2hhciAqKXBhdHRlcm47ICpwOyBwKysp
IHsKIAlpZiAoKnAgPT0gJyonIHx8ICpwID09ICclJyB8fCAqcCA9PSAnPycgfHwgKnAgPT0gJ0An
KSBicmVhazsKICAgICB9CiAgICAgcHJlZml4bGVuID0gcCAtIHBhdHRlcm47Ci0gICAgKnAgPSAn
XDAnOwogCiAgICAgLyoKICAgICAgKiBJZiB1c2VyLlguKiBvciBJTkJPWC4qIGNhbiBtYXRjaCBw
YXR0ZXJuLAogICAgICAqIHNlYXJjaCBmb3IgdGhvc2UgbWFpbGJveGVzIG5leHQKICAgICAgKi8K
LSAgICBpZiAodXNlcmlkICYmCi0JKCFzdHJuY21wKHVzZXJtYm94bmFtZStkb21haW5sZW4sIHBh
dHRlcm4sIHVzZXJtYm94bmFtZWxlbi1kb21haW5sZW4tMSkgfHwKLQkgIXN0cm5jYXNlY21wKCJp
bmJveC4iLCBwYXR0ZXJuLCBwcmVmaXhsZW4gPCA2ID8gcHJlZml4bGVuIDogNikpKSB7Ci0KLQlp
ZiAoIXN0cm5jbXAodXNlcm1ib3huYW1lK2RvbWFpbmxlbiwgcGF0dGVybiwgdXNlcm1ib3huYW1l
bGVuLWRvbWFpbmxlbi0xKSkgewotCSAgICAvKiBzd2l0Y2ggdG8gcGF0dGVybiB3aXRoIGRvbWFp
biBwcmVwZW5kZWQgKi8KLQkgICAgZ2xvYl9mcmVlKCZjYnJvY2suZyk7Ci0JICAgIGNicm9jay5n
ID0gZ2xvYl9pbml0KGRvbWFpbnBhdCwgR0xPQl9ISUVSQVJDSFkpOwotCSAgICBjYnJvY2suaW5i
b3hvZmZzZXQgPSAwOwotCX0KLQllbHNlIHsKLQkgICAgY2Jyb2NrLmluYm94b2Zmc2V0ID0gZG9t
YWlubGVuICsgdXNlcmxlbjsKLQl9CisgICAgaWYgKHVzZXJpZCkgeworCWNicm9jay5pbmJveG9m
ZnNldCA9IGRvbWFpbmxlbiArIHVzZXJsZW47CiAKIAljYnJvY2suZmluZF9uYW1lc3BhY2UgPSBO
QU1FU1BBQ0VfSU5CT1g7CiAJLyogaXRlcmF0ZSB0aHJvdWdoIHByZWZpeGVzIG1hdGNoaW5nIHVz
ZXJtYm94bmFtZSAqLwpAQCAtMjA5NSw5ICsyMDg2LDggQEAKIAogICAgIGlmKCFyKSB7CiAJY2Jy
b2NrLmZpbmRfbmFtZXNwYWNlID0gTkFNRVNQQUNFX1VTRVI7Ci0JLyogc3dpdGNoIHRvIHBhdHRl
cm4gd2l0aCBkb21haW4gcHJlcGVuZGVkICovCiAJZ2xvYl9mcmVlKCZjYnJvY2suZyk7Ci0JY2Jy
b2NrLmcgPSBnbG9iX2luaXQoZG9tYWlucGF0LCBHTE9CX0hJRVJBUkNIWSk7CisJY2Jyb2NrLmcg
PSBnbG9iX2luaXQocGF0dGVybiwgbmFtZXNwYWNlLT5oaWVyX3NlcCwgR0xPQl9ISUVSQVJDSFkp
OwogCWNicm9jay5pbmJveG9mZnNldCA9IDA7CiAJaWYgKHVzZXJtYm94bmFtZWxlbikgewogCSAg
ICB1c2VybWJveG5hbWVbLS11c2VybWJveG5hbWVsZW5dID0gJ1wwJzsKQEAgLTIxMTYsNyArMjEw
Niw2IEBACiAKICAgZG9uZToKICAgICBnbG9iX2ZyZWUoJmNicm9jay5nKTsKLSAgICBpZiAocGF0
KSBmcmVlKHBhdCk7CiAKICAgICByZXR1cm4gcjsKIH0KQEAgLTIxNDYsNyArMjEzNSw3IEBACiAg
ICAgZWxzZQogCWRvbWFpbnBhdFswXSA9ICdcMCc7CiAKLSAgICBjYnJvY2suZyA9IGdsb2JfaW5p
dChwYXR0ZXJuLCBHTE9CX0hJRVJBUkNIWXxHTE9CX0lOQk9YQ0FTRSk7CisgICAgY2Jyb2NrLmcg
PSBnbG9iX2luaXQocGF0dGVybiwgbmFtZXNwYWNlLT5oaWVyX3NlcCwgR0xPQl9ISUVSQVJDSFl8
R0xPQl9JTkJPWENBU0UpOwogICAgIGNicm9jay5uYW1lc3BhY2UgPSBuYW1lc3BhY2U7CiAgICAg
Y2Jyb2NrLmRvbWFpbmxlbiA9IGRvbWFpbmxlbjsKICAgICBjYnJvY2suaW5ib3hjYXNlID0gZ2xv
Yl9pbmJveGNhc2UoY2Jyb2NrLmcpOwpAQCAtMjIwOCwxMiArMjE5NywxMSBAQAogICAgIC8qCiAg
ICAgICogUGVyc29uYWwgKElOQk9YKSBuYW1lc3BhY2UKICAgICAgKgotICAgICAqIEFwcGVuZCBw
YXR0ZXJuIHRvICJJTkJPWC4iLCBzZWFyY2ggZm9yIHRob3NlIG1haWxib3hlcyBuZXh0CisgICAg
ICogU2VhcmNoIGZvciAiSU5CT1guKiIgbWFpbGJveGVzIG5leHQKICAgICAgKi8KICAgICBpZiAo
dXNlcmlkKSB7Ci0Jc3RybGNweShwYXRidWYsICJJTkJPWC4iLCBzaXplb2YocGF0YnVmKSk7Ci0J
c3RybGNhdChwYXRidWYsIHBhdHRlcm4sIHNpemVvZihwYXRidWYpKTsKLQljYnJvY2suZyA9IGds
b2JfaW5pdChwYXRidWYsIEdMT0JfSElFUkFSQ0hZfEdMT0JfSU5CT1hDQVNFKTsKKwkvKiBkb24n
dCB0b3VjaCB0aGUgcGF0dGVybiEgLy8gc29yY2VyZXIgKi8KKwljYnJvY2suZyA9IGdsb2JfaW5p
dChwYXR0ZXJuLCBuYW1lc3BhY2UtPmhpZXJfc2VwLCBHTE9CX0hJRVJBUkNIWXxHTE9CX0lOQk9Y
Q0FTRSk7CiAJY2Jyb2NrLmluYm94Y2FzZSA9IGdsb2JfaW5ib3hjYXNlKGNicm9jay5nKTsKIAlj
YnJvY2suaW5ib3hvZmZzZXQgPSBkb21haW5sZW4rdXNlcmxlbjsKIAljYnJvY2suZmluZF9uYW1l
c3BhY2UgPSBOQU1FU1BBQ0VfSU5CT1g7CkBAIC0yMjQzLDE3ICsyMjMxLDEwIEBACiAKICAgICBp
ZiAoIXN0cm5jbXAobmFtZXNwYWNlLT5wcmVmaXhbTkFNRVNQQUNFX1VTRVJdLCBwYXR0ZXJuLAog
CQkgcHJlZml4bGVuIDwgbGVuID8gcHJlZml4bGVuIDogbGVuKSkgeworCS8qIHdlJ2xsIHNlYXJj
aCBmb3IgdGhlIHJlcXVlc3RlZCBwYXR0ZXJuIGRvbid0IG1ha2luZyBhbnkKKwkgICBzdHVwaWQg
bW9kaWZpY2F0aW9ucyBvZiBpdCAvLyBzb3JjZXJlciAqLworCWNicm9jay5nID0gZ2xvYl9pbml0
KHBhdHRlcm4sIG5hbWVzcGFjZS0+aGllcl9zZXAsIEdMT0JfSElFUkFSQ0hZKTsKIAotCWlmIChw
cmVmaXhsZW4gPCBsZW4pIHsKLQkgICAgc3RybGNweShkb21haW5wYXQrZG9tYWlubGVuLCBwYXR0
ZXJuK3ByZWZpeGxlbiwKLQkJICAgIHNpemVvZihkb21haW5wYXQpLWRvbWFpbmxlbik7Ci0JICAg
IGNicm9jay5nID0gZ2xvYl9pbml0KGRvbWFpbnBhdCwgR0xPQl9ISUVSQVJDSFkpOwotCX0KLQll
bHNlIHsKLQkgICAgc3RybGNweShkb21haW5wYXQrZG9tYWlubGVuLCAidXNlciIsIHNpemVvZihk
b21haW5wYXQpLWRvbWFpbmxlbik7Ci0JICAgIHN0cmxjYXQoZG9tYWlucGF0LCBwYXR0ZXJuK2xl
biwgc2l6ZW9mKGRvbWFpbnBhdCkpOwotCSAgICBjYnJvY2suZyA9IGdsb2JfaW5pdChkb21haW5w
YXQsIEdMT0JfSElFUkFSQ0hZKTsKLQl9CiAJY2Jyb2NrLmZpbmRfbmFtZXNwYWNlID0gTkFNRVNQ
QUNFX1VTRVI7CiAJY2Jyb2NrLmluYm94b2Zmc2V0ID0gMDsKIAkKQEAgLTIyODUsMTEgKzIyNjYs
MTEgQEAKIAkgICAgLyogU2tpcCBwYXR0ZXJuIHdoaWNoIG1hdGNoZXMgc2hhcmVkIG5hbWVzcGFj
ZSBwcmVmaXggKi8KIAkgICAgZm9yIChwID0gcGF0K3ByZWZpeGxlbjsgKnA7IHArKykgewogCQlp
ZiAoKnAgPT0gJyUnKSBjb250aW51ZTsKLQkJZWxzZSBpZiAoKnAgPT0gJy4nKSBwKys7CisJCWVs
c2UgaWYgKCpwID09IG5hbWVzcGFjZS0+aGllcl9zZXApIHArKzsKIAkJYnJlYWs7CiAJICAgIH0K
IAotCSAgICBpZiAoKnBhdHRlcm4gJiYgIXN0cmNocihwYXR0ZXJuLCAnLicpICYmCisJICAgIGlm
ICgqcGF0dGVybiAmJiAhc3RyY2hyKHBhdHRlcm4sIG5hbWVzcGFjZS0+aGllcl9zZXApICYmCiAJ
CXBhdHRlcm5bc3RybGVuKHBhdHRlcm4pLTFdID09ICclJykgewogCQkvKiBzcGVjaWFsIGNhc2U6
ICBMSVNUICIiIColIC0tIG91dHB1dCBwcmVmaXggKi8KICAgCQljYnJvY2suY2hlY2tzaGFyZWQg
PSAxOwpAQCAtMjI5OCwyNSArMjI3OSwyMSBAQAogCSAgICBpZiAoKGNicm9jay5jaGVja3NoYXJl
ZCB8fCBwcmVmaXhsZW4gPT0gbGVuKSAmJiAhKnApIHsKIAkJLyogc3BlY2lhbCBjYXNlOiAgTElT
VCAiIiAlIC0tIG91dHB1dCBwcmVmaXgKICAJCSAgIChpZiB3ZSBoYXZlIGEgc2hhcmVkIG1ib3gp
IGFuZCBxdWl0ICovCi0JCXN0cmxjcHkoZG9tYWlucGF0K2RvbWFpbmxlbiwgIioiLCBzaXplb2Yo
ZG9tYWlucGF0KS1kb21haW5sZW4pOwotCQljYnJvY2suZyA9IGdsb2JfaW5pdChkb21haW5wYXQs
IEdMT0JfSElFUkFSQ0hZKTsKKwkJY2Jyb2NrLmcgPSBnbG9iX2luaXQoIioiLCBuYW1lc3BhY2Ut
PmhpZXJfc2VwLCBHTE9CX0hJRVJBUkNIWSk7CiAJCWNicm9jay5jaGVja3NoYXJlZCA9IDI7CiAJ
ICAgIH0KLQkgICAgZWxzZSB7Ci0JCXN0cmxjcHkoZG9tYWlucGF0K2RvbWFpbmxlbiwgcCwgc2l6
ZW9mKGRvbWFpbnBhdCktZG9tYWlubGVuKTsKLQkJY2Jyb2NrLmcgPSBnbG9iX2luaXQoZG9tYWlu
cGF0LCBHTE9CX0hJRVJBUkNIWSk7Ci0JICAgIH0KLQkJCisJICAgIGVsc2UKKwkJY2Jyb2NrLmcg
PSBnbG9iX2luaXQocGF0LCBuYW1lc3BhY2UtPmhpZXJfc2VwLCBHTE9CX0hJRVJBUkNIWSk7CisK
IAkgICAgZG9tYWlucGF0W2RvbWFpbmxlbl0gPSAnXDAnOwogCSAgICBEQi0+Zm9yZWFjaChtYmRi
LAogCQkJZG9tYWlucGF0LCBkb21haW5sZW4sCiAJCQkmZmluZF9wLCAmZmluZF9jYiwgJmNicm9j
aywKIAkJCU5VTEwpOwogCX0KLQllbHNlIGlmIChwYXR0ZXJuW2xlbl0gPT0gJy4nKSB7Ci0JICAg
IHN0cmxjcHkoZG9tYWlucGF0K2RvbWFpbmxlbiwgcGF0dGVybitsZW4rMSwKLQkJICAgIHNpemVv
Zihkb21haW5wYXQpLWRvbWFpbmxlbik7Ci0JICAgIGNicm9jay5nID0gZ2xvYl9pbml0KGRvbWFp
bnBhdCwgR0xPQl9ISUVSQVJDSFkpOworCWVsc2UgaWYgKHBhdHRlcm5bbGVuXSA9PSBuYW1lc3Bh
Y2UtPmhpZXJfc2VwKSB7CisJICAgIHNucHJpbnRmKGRvbWFpbnBhdCtkb21haW5sZW4sIHNpemVv
Zihkb21haW5wYXQpLWRvbWFpbmxlbiwgIiUuKnMiLCBwcmVmaXhsZW4tKGxlbisxKSwgcGF0dGVy
bitsZW4rMSk7CisJICAgIGNicm9jay5nID0gZ2xvYl9pbml0KHBhdHRlcm4sIG5hbWVzcGFjZS0+
aGllcl9zZXAsIEdMT0JfSElFUkFSQ0hZKTsKIAogCSAgICBEQi0+Zm9yZWFjaChtYmRiLAogCQkJ
ZG9tYWlucGF0LCBkb21haW5sZW4rcHJlZml4bGVuLShsZW4rMSksCkBAIC0yMzk0LDcgKzIzNzEs
NyBAQAogCWlmIChyKSB7CiAJICAgIGlmICghZm9yY2UgJiYgciA9PSBJTUFQX01BSUxCT1hfTk9O
RVhJU1RFTlQpIHsKIAkJLyogbG9vayBmb3IgYSBjaGlsZCBtYWlsYm94IGluIHRoZSBwcm9wb3Nl
ZCBxdW90YXJvb3QgKi8KLQkJbWJveGxpc3RfZmluZGFsbChOVUxMLCBwYXR0ZXJuLCAxLCBOVUxM
LCBOVUxMLAorCQltYm94bGlzdF9maW5kYWxsKCZpbnRlcm5hbF9uYW1lc3BhY2UsIHBhdHRlcm4s
IDEsIE5VTEwsIE5VTEwsCiAJCQkJIGNoaWxkX2NiLCAodm9pZCAqKSAmZm9yY2UpOwogCSAgICB9
CiAKQEAgLTI0MjUsNyArMjQwMiw3IEBACiAgICAgaWYoaGF2ZV9tYWlsYm94KQogCW1ib3hsaXN0
X2NoYW5nZXF1b3RhKHF1b3RhLnJvb3QsIDAsIDAsICZjcm9jayk7CiAgICAgLyogc3VibWFpbGJv
eGVzIC0gd2UncmUgdXNpbmcgaW50ZXJuYWwgbmFtZXMgaGVyZSAqLwotICAgIG1ib3hsaXN0X2Zp
bmRhbGwoTlVMTCwgcGF0dGVybiwgMSwgMCwgMCwgbWJveGxpc3RfY2hhbmdlcXVvdGEsICZjcm9j
ayk7CisgICAgbWJveGxpc3RfZmluZGFsbCgmaW50ZXJuYWxfbmFtZXNwYWNlLCBwYXR0ZXJuLCAx
LCAwLCAwLCBtYm94bGlzdF9jaGFuZ2VxdW90YSwgJmNyb2NrKTsKICAgICAKICAgICByID0gcXVv
dGFfd3JpdGUoJnF1b3RhLCAmdGlkKTsKICAgICBpZiAoIXIpIHF1b3RhX2NvbW1pdCgmdGlkKTsK
QEAgLTI0OTEsNyArMjQ2OCw3IEBACiAgICAgICAgICAgICB9CiAgICAgICAgICAgICAvKiBzdWJt
YWlsYm94ZXMgLSB3ZSdyZSB1c2luZyBpbnRlcm5hbCBuYW1lcyBoZXJlICovCiAgICAgICAgICAg
ICBpZiAoIWspCi0gICAgICAgICAgICAgICAgayA9IG1ib3hsaXN0X2ZpbmRhbGwoTlVMTCwgcGF0
dGVybiwgMSwgMCwgMCwgbWJveGxpc3RfY2hhbmdlcXVvdGEsICZjcm9jayk7CisgICAgICAgICAg
ICAgICAgayA9IG1ib3hsaXN0X2ZpbmRhbGwoJmludGVybmFsX25hbWVzcGFjZSwgcGF0dGVybiwg
MSwgMCwgMCwgbWJveGxpc3RfY2hhbmdlcXVvdGEsICZjcm9jayk7CiAgICAgICAgICAgICBpZigh
aykKICAgICAgICAgICAgICAgICBrID0gcXVvdGFfd3JpdGUoJnJvb3RxdW90YSwgY3JvY2sudGlk
KTsKIApAQCAtMjUwMCw3ICsyNDc3LDcgQEAKICAgICAgICAgICAgLyogdG9wIGxldmVsIG1haWxi
b3ggKi8KICAgICAgICAgICAgbWJveGxpc3Rfcm1xdW90YShyb290LCAwLCAwLCAodm9pZCAqKXJv
b3QpOwogICAgICAgICAgICAvKiBzdWJtYWlsYm94ZXMgLSB3ZSdyZSB1c2luZyBpbnRlcm5hbCBu
YW1lcyBoZXJlICovCi0gICAgICAgICAgIG1ib3hsaXN0X2ZpbmRhbGwoTlVMTCwgcGF0dGVybiwg
MSwgMCwgMCwgbWJveGxpc3Rfcm1xdW90YSwgKHZvaWQgKilyb290KTsKKyAgICAgICAgICAgbWJv
eGxpc3RfZmluZGFsbCgmaW50ZXJuYWxfbmFtZXNwYWNlLCBwYXR0ZXJuLCAxLCAwLCAwLCBtYm94
bGlzdF9ybXF1b3RhLCAodm9pZCAqKXJvb3QpOwogICAgICAgIH0KICAgICB9CiAKQEAgLTI4MDYs
NyArMjc4Myw2IEBACiAgICAgaW50IHByZWZpeGxlbjsKICAgICBpbnQgdXNlcmxlbiA9IHVzZXJp
ZCA/IHN0cmxlbih1c2VyaWQpIDogMCwgZG9tYWlubGVuID0gMDsKICAgICBjaGFyIGRvbWFpbnBh
dFtNQVhfTUFJTEJPWF9OQU1FKzFdOyAvKiBkbyBpbnRyYS1kb21haW4gZmV0Y2hlcyBvbmx5ICov
Ci0gICAgY2hhciAqcGF0ID0gTlVMTDsKIAogICAgIGlmIChjb25maWdfdmlydGRvbWFpbnMgJiYg
dXNlcmlkICYmIChwID0gc3RyY2hyKHVzZXJpZCwgJ0AnKSkpIHsKIAl1c2VybGVuID0gcCAtIHVz
ZXJpZDsKQEAgLTI4MTYsOCArMjc5MiwxMCBAQAogICAgIGVsc2UKIAlzdHJuY3B5KGRvbWFpbnBh
dCwgcGF0dGVybiwgc2l6ZW9mKGRvbWFpbnBhdCkpOwogCi0gICAgY2Jyb2NrLmcgPSBnbG9iX2lu
aXQocGF0dGVybiwgR0xPQl9ISUVSQVJDSFl8R0xPQl9JTkJPWENBU0UpOwotICAgIGNicm9jay5u
YW1lc3BhY2UgPSBOVUxMOworICAgIG1ib3huYW1lX2hpZXJzZXBfdG9pbnRlcm5hbChuYW1lc3Bh
Y2UsIGRvbWFpbnBhdCwgMCk7CisKKyAgICBjYnJvY2suZyA9IGdsb2JfaW5pdChwYXR0ZXJuLCBu
YW1lc3BhY2UtPmhpZXJfc2VwLCBHTE9CX0hJRVJBUkNIWXxHTE9CX0lOQk9YQ0FTRSk7CisgICAg
Y2Jyb2NrLm5hbWVzcGFjZSA9IG5hbWVzcGFjZTsKICAgICBjYnJvY2suZG9tYWlubGVuID0gZG9t
YWlubGVuOwogICAgIGNicm9jay5pbmJveGNhc2UgPSBnbG9iX2luYm94Y2FzZShjYnJvY2suZyk7
CiAgICAgY2Jyb2NrLmlzYWRtaW4gPSAxOwkJLyogdXNlciBjYW4gYWx3YXlzIHNlZSB0aGVpciBz
dWJzICovCkBAIC0yODU3LDE2ICsyODM1LDYgQEAKIAkgICAgfQogCSAgICBlbHNlIGlmIChyID09
IENZUlVTREJfTk9URk9VTkQpIHIgPSAwOwogCX0KLQllbHNlIGlmICghc3RybmNtcChwYXR0ZXJu
LAotCQkJICB1c2VybWJveG5hbWUrZG9tYWlubGVuLCB1c2VybWJveG5hbWVsZW4tZG9tYWlubGVu
KSAmJgotCQkgR0xPQl9URVNUKGNicm9jay5nLCB1c2VybWJveG5hbWUrZG9tYWlubGVuKSAhPSAt
MSkgewotCSAgICByID0gU1VCREItPmZldGNoKHN1YnMsIHVzZXJtYm94bmFtZSwgdXNlcm1ib3hu
YW1lbGVuLAotCQkJICAgICAmZGF0YSwgJmRhdGFsZW4sIE5VTEwpOwotCSAgICBpZiAoIXIgJiYg
ZGF0YSkgewotCQlyID0gKCpwcm9jKSh1c2VybWJveG5hbWUsIHVzZXJtYm94bmFtZWxlbiwgMSwg
cm9jayk7Ci0JICAgIH0KLQkgICAgZWxzZSBpZiAociA9PSBDWVJVU0RCX05PVEZPVU5EKSByID0g
MDsKLQl9CiAJc3RybGNhdCh1c2VybWJveG5hbWUsICIuIiwgc2l6ZW9mKHVzZXJtYm94bmFtZSkp
OwogCXVzZXJtYm94bmFtZWxlbisrOwogCkBAIC0yODc2LDMzICsyODQ0LDE4IEBACiAKICAgICBp
ZiAocikgZ290byBkb25lOwogCi0gICAgLyogTWFrZSBhIHdvcmtpbmcgY29weSBvZiBwYXR0ZXJu
ICovCi0gICAgcGF0dGVybiA9IHBhdCA9IHhzdHJkdXAocGF0dGVybik7Ci0KICAgICAvKiBGaW5k
IGZpeGVkLXN0cmluZyBwYXR0ZXJuIHByZWZpeCAqLwotICAgIGZvciAocCA9IHBhdDsgKnA7IHAr
KykgeworICAgIGZvciAocCA9IChjaGFyICopcGF0dGVybjsgKnA7IHArKykgewogCWlmICgqcCA9
PSAnKicgfHwgKnAgPT0gJyUnIHx8ICpwID09ICc/JyB8fCAqcCA9PSAnQCcpIGJyZWFrOwogICAg
IH0KICAgICBwcmVmaXhsZW4gPSBwIC0gcGF0dGVybjsKLSAgICAqcCA9ICdcMCc7CiAKICAgICAv
KgogICAgICAqIElmIHVzZXIuWC4qIG9yIElOQk9YLiogY2FuIG1hdGNoIHBhdHRlcm4sCiAgICAg
ICogc2VhcmNoIGZvciB0aG9zZSBtYWlsYm94ZXMgbmV4dAogICAgICAqLwotICAgIGlmICh1c2Vy
aWQgJiYKLQkoIXN0cm5jbXAodXNlcm1ib3huYW1lK2RvbWFpbmxlbiwgcGF0dGVybiwgdXNlcm1i
b3huYW1lbGVuLWRvbWFpbmxlbi0xKSB8fAotCSAhc3RybmNhc2VjbXAoImluYm94LiIsIHBhdHRl
cm4sIHByZWZpeGxlbiA8IDYgPyBwcmVmaXhsZW4gOiA2KSkpIHsKLQotCWlmICghc3RybmNtcCh1
c2VybWJveG5hbWUrZG9tYWlubGVuLCBwYXR0ZXJuLCB1c2VybWJveG5hbWVsZW4tZG9tYWlubGVu
LTEpKSB7Ci0JICAgIC8qIHN3aXRjaCB0byBwYXR0ZXJuIHdpdGggZG9tYWluIHByZXBlbmRlZCAq
LwotCSAgICBnbG9iX2ZyZWUoJmNicm9jay5nKTsKLQkgICAgY2Jyb2NrLmcgPSBnbG9iX2luaXQo
ZG9tYWlucGF0LCBHTE9CX0hJRVJBUkNIWSk7Ci0JICAgIGNicm9jay5pbmJveG9mZnNldCA9IDA7
Ci0JfQotCWVsc2UgewotCSAgICBjYnJvY2suaW5ib3hvZmZzZXQgPSBzdHJsZW4odXNlcmlkKTsK
LQl9CisgICAgaWYgKHVzZXJpZCkgeworCWNicm9jay5pbmJveG9mZnNldCA9IGRvbWFpbmxlbiAr
IHVzZXJsZW47CiAKIAljYnJvY2suZmluZF9uYW1lc3BhY2UgPSBOQU1FU1BBQ0VfSU5CT1g7CiAJ
LyogaXRlcmF0ZSB0aHJvdWdoIHByZWZpeGVzIG1hdGNoaW5nIHVzZXJtYm94bmFtZSAqLwpAQCAt
MjkxOSw5ICsyODcyLDggQEAKICAgICB9CiAKICAgICBjYnJvY2suZmluZF9uYW1lc3BhY2UgPSBO
QU1FU1BBQ0VfVVNFUjsKLSAgICAvKiBzd2l0Y2ggdG8gcGF0dGVybiB3aXRoIGRvbWFpbiBwcmVw
ZW5kZWQgKi8KICAgICBnbG9iX2ZyZWUoJmNicm9jay5nKTsKLSAgICBjYnJvY2suZyA9IGdsb2Jf
aW5pdChkb21haW5wYXQsIEdMT0JfSElFUkFSQ0hZKTsKKyAgICBjYnJvY2suZyA9IGdsb2JfaW5p
dChwYXR0ZXJuLCBuYW1lc3BhY2UtPmhpZXJfc2VwLCBHTE9CX0hJRVJBUkNIWSk7CiAgICAgY2Jy
b2NrLmluYm94b2Zmc2V0ID0gMDsKICAgICBpZiAodXNlcm1ib3huYW1lbGVuKSB7CiAJdXNlcm1i
b3huYW1lWy0tdXNlcm1ib3huYW1lbGVuXSA9ICdcMCc7CkBAIC0yOTM2LDcgKzI4ODgsNiBAQAog
ICBkb25lOgogICAgIGlmIChzdWJzKSBtYm94bGlzdF9jbG9zZXN1YnMoc3Vicyk7CiAgICAgZ2xv
Yl9mcmVlKCZjYnJvY2suZyk7Ci0gICAgaWYgKHBhdCkgZnJlZShwYXQpOwogCiAgICAgcmV0dXJu
IHI7CiB9CkBAIC0yOTY3LDcgKzI5MTgsNyBAQAogICAgIGVsc2UKIAlkb21haW5wYXRbMF0gPSAn
XDAnOwogCi0gICAgY2Jyb2NrLmcgPSBnbG9iX2luaXQocGF0dGVybiwgR0xPQl9ISUVSQVJDSFl8
R0xPQl9JTkJPWENBU0UpOworICAgIGNicm9jay5nID0gZ2xvYl9pbml0KHBhdHRlcm4sIG5hbWVz
cGFjZS0+aGllcl9zZXAsIEdMT0JfSElFUkFSQ0hZfEdMT0JfSU5CT1hDQVNFKTsKICAgICBjYnJv
Y2submFtZXNwYWNlID0gbmFtZXNwYWNlOwogICAgIGNicm9jay5kb21haW5sZW4gPSBkb21haW5s
ZW47CiAgICAgY2Jyb2NrLmluYm94Y2FzZSA9IGdsb2JfaW5ib3hjYXNlKGNicm9jay5nKTsKQEAg
LTMwMzQsOSArMjk4NSw4IEBACiAgICAgICogQXBwZW5kIHBhdHRlcm4gdG8gIklOQk9YLiIsIHNl
YXJjaCBmb3IgdGhvc2Ugc3Vic2NyaXB0aW9ucyBuZXh0CiAgICAgICovCiAgICAgaWYgKHVzZXJp
ZCkgewotCXN0cmxjcHkocGF0YnVmLCAiSU5CT1guIiwgc2l6ZW9mKHBhdGJ1ZikpOwotCXN0cmxj
YXQocGF0YnVmLCBwYXR0ZXJuLCBzaXplb2YocGF0YnVmKSk7Ci0JY2Jyb2NrLmcgPSBnbG9iX2lu
aXQocGF0YnVmLCBHTE9CX0hJRVJBUkNIWXxHTE9CX0lOQk9YQ0FTRSk7CisJLyogZG9uJ3QgdG91
Y2ggdGhlIHBhdHRlcm4hICovCisJY2Jyb2NrLmcgPSBnbG9iX2luaXQocGF0dGVybiwgbmFtZXNw
YWNlLT5oaWVyX3NlcCwgR0xPQl9ISUVSQVJDSFl8R0xPQl9JTkJPWENBU0UpOwogCWNicm9jay5p
bmJveGNhc2UgPSBnbG9iX2luYm94Y2FzZShjYnJvY2suZyk7CiAJY2Jyb2NrLmluYm94b2Zmc2V0
ID0gZG9tYWlubGVuK3VzZXJsZW47CiAJY2Jyb2NrLmZpbmRfbmFtZXNwYWNlID0gTkFNRVNQQUNF
X0lOQk9YOwpAQCAtMzA3MiwxNyArMzAyMiw4IEBACiAgICAgaWYgKCFzdHJuY21wKG5hbWVzcGFj
ZS0+cHJlZml4W05BTUVTUEFDRV9VU0VSXSwgcGF0dGVybiwKIAkJIHByZWZpeGxlbiA8IGxlbiA/
IHByZWZpeGxlbiA6IGxlbikpIHsKIAotCWlmIChwcmVmaXhsZW4gPCBsZW4pIHsKLQkgICAgc3Ry
bGNweShkb21haW5wYXQrZG9tYWlubGVuLCBwYXR0ZXJuK3ByZWZpeGxlbiwKLQkJICAgIHNpemVv
Zihkb21haW5wYXQpLWRvbWFpbmxlbik7Ci0JICAgIGNicm9jay5nID0gZ2xvYl9pbml0KGRvbWFp
bnBhdCwgR0xPQl9ISUVSQVJDSFkpOwotCX0KLQllbHNlIHsKLQkgICAgc3RybGNweShkb21haW5w
YXQrZG9tYWlubGVuLCAidXNlciIsCi0JCSAgIHNpemVvZihkb21haW5wYXQpLWRvbWFpbmxlbik7
Ci0JICAgIHN0cmxjYXQoZG9tYWlucGF0LCBwYXR0ZXJuK2xlbiwgc2l6ZW9mKGRvbWFpbnBhdCkp
OwotCSAgICBjYnJvY2suZyA9IGdsb2JfaW5pdChkb21haW5wYXQsIEdMT0JfSElFUkFSQ0hZKTsK
LQl9CisJLyogZG9uJ3QgdG91Y2ggdGhlIHBhdHRlcm4hICovCisJY2Jyb2NrLmcgPSBnbG9iX2lu
aXQocGF0dGVybiwgbmFtZXNwYWNlLT5oaWVyX3NlcCwgR0xPQl9ISUVSQVJDSFkpOwogCWNicm9j
ay5maW5kX25hbWVzcGFjZSA9IE5BTUVTUEFDRV9VU0VSOwogCWNicm9jay5pbmJveG9mZnNldCA9
IDA7CiAJCkBAIC0zMTE0LDExICszMDU1LDExIEBACiAJICAgIC8qIFNraXAgcGF0dGVybiB3aGlj
aCBtYXRjaGVzIHNoYXJlZCBuYW1lc3BhY2UgcHJlZml4ICovCiAJICAgIGZvciAocCA9IHBhdCtw
cmVmaXhsZW47ICpwOyBwKyspIHsKIAkJaWYgKCpwID09ICclJykgY29udGludWU7Ci0JCWVsc2Ug
aWYgKCpwID09ICcuJykgcCsrOworCQllbHNlIGlmICgqcCA9PSBuYW1lc3BhY2UtPmhpZXJfc2Vw
KSBwKys7CiAJCWJyZWFrOwogCSAgICB9CiAKLQkgICAgaWYgKCpwYXR0ZXJuICYmICFzdHJjaHIo
cGF0dGVybiwgJy4nKSAmJgorCSAgICBpZiAoKnBhdHRlcm4gJiYgIXN0cmNocihwYXR0ZXJuLCBu
YW1lc3BhY2UtPmhpZXJfc2VwKSAmJgogCQlwYXR0ZXJuW3N0cmxlbihwYXR0ZXJuKS0xXSA9PSAn
JScpIHsKIAkJLyogc3BlY2lhbCBjYXNlOiAgTFNVQiAiIiAqJSAtLSBvdXRwdXQgcHJlZml4ICov
CiAgIAkJY2Jyb2NrLmNoZWNrc2hhcmVkID0gMTsKQEAgLTMxMjcsMTQgKzMwNjgsMTEgQEAKIAkg
ICAgaWYgKChjYnJvY2suY2hlY2tzaGFyZWQgfHwgcHJlZml4bGVuID09IGxlbikgJiYgISpwKSB7
CiAJCS8qIHNwZWNpYWwgY2FzZTogIExTVUIgIiIgJSAtLSBvdXRwdXQgcHJlZml4CiAJCSAgIChp
ZiB3ZSBoYXZlIGEgc2hhcmVkIG1ib3gpIGFuZCBxdWl0ICovCi0JCXN0cmxjcHkoZG9tYWlucGF0
K2RvbWFpbmxlbiwgIioiLCBzaXplb2YoZG9tYWlucGF0KS1kb21haW5sZW4pOwotCQljYnJvY2su
ZyA9IGdsb2JfaW5pdChkb21haW5wYXQsIEdMT0JfSElFUkFSQ0hZKTsKKwkJY2Jyb2NrLmcgPSBn
bG9iX2luaXQoIioiLCBuYW1lc3BhY2UtPmhpZXJfc2VwLCBHTE9CX0hJRVJBUkNIWSk7CiAJCWNi
cm9jay5jaGVja3NoYXJlZCA9IDI7CiAJICAgIH0KLQkgICAgZWxzZSB7Ci0JCXN0cmxjcHkoZG9t
YWlucGF0K2RvbWFpbmxlbiwgcCwgc2l6ZW9mKGRvbWFpbnBhdCktZG9tYWlubGVuKTsKLQkJY2Jy
b2NrLmcgPSBnbG9iX2luaXQoZG9tYWlucGF0LCBHTE9CX0hJRVJBUkNIWSk7Ci0JICAgIH0KKwkg
ICAgZWxzZQorCQljYnJvY2suZyA9IGdsb2JfaW5pdChwYXQsIG5hbWVzcGFjZS0+aGllcl9zZXAs
IEdMT0JfSElFUkFSQ0hZKTsKIAogCSAgICBkb21haW5wYXRbZG9tYWlubGVuXSA9ICdcMCc7CiAJ
ICAgIFNVQkRCLT5mb3JlYWNoKHN1YnMsCkBAIC0zMTQyLDEwICszMDgwLDkgQEAKIAkJCSAgICZm
aW5kX3AsICZmaW5kX2NiLCAmY2Jyb2NrLAogCQkJICAgTlVMTCk7CiAJfQotCWVsc2UgaWYgKHBh
dHRlcm5bbGVuXSA9PSAnLicpIHsKLQkgICAgc3RybGNweShkb21haW5wYXQrZG9tYWlubGVuLCBw
YXR0ZXJuK2xlbisxLAotCQkgICAgc2l6ZW9mKGRvbWFpbnBhdCktZG9tYWlubGVuKTsKLQkgICAg
Y2Jyb2NrLmcgPSBnbG9iX2luaXQoZG9tYWlucGF0LCBHTE9CX0hJRVJBUkNIWSk7CisJZWxzZSBp
ZiAocGF0dGVybltsZW5dID09IG5hbWVzcGFjZS0+aGllcl9zZXApIHsKKwkgICAgc25wcmludGYo
ZG9tYWlucGF0K2RvbWFpbmxlbiwgc2l6ZW9mKGRvbWFpbnBhdCktZG9tYWlubGVuLCAiJS4qcyIs
IHByZWZpeGxlbi0obGVuKzEpLCBwYXR0ZXJuK2xlbisxKTsKKwkgICAgY2Jyb2NrLmcgPSBnbG9i
X2luaXQocGF0dGVybiwgbmFtZXNwYWNlLT5oaWVyX3NlcCwgR0xPQl9ISUVSQVJDSFkpOwogCiAJ
ICAgIFNVQkRCLT5mb3JlYWNoKHN1YnMsCiAJCQkgICBkb21haW5wYXQsIGRvbWFpbmxlbitwcmVm
aXhsZW4tKGxlbisxKSwKZGlmZiAtdXJOIGN5cnVzLWltYXBkLTIuMi4xMi5zdXBlcm9sZC9pbWFw
L21ib3hsaXN0LmggY3lydXMtaW1hcGQtMi4yLjEyL2ltYXAvbWJveGxpc3QuaAotLS0gY3lydXMt
aW1hcGQtMi4yLjEyLnN1cGVyb2xkL2ltYXAvbWJveGxpc3QuaAkyMDA1LTEyLTI2IDE5OjE3OjE2
ICswMzAwCisrKyBjeXJ1cy1pbWFwZC0yLjIuMTIvaW1hcC9tYm94bGlzdC5oCTIwMDUtMTItMjYg
MTk6MTk6MTYgKzAzMDAKQEAgLTUxLDYgKzUxLDggQEAKICNpbmNsdWRlICJtYm94bmFtZS5oIgog
CiBleHRlcm4gc3RydWN0IGRiICptYmRiOworLyogaW50ZXJuYWwgbmFtZXNwYWNlIChjb25zdGFu
dCkgKi8KK2V4dGVybiBzdHJ1Y3QgbmFtZXNwYWNlIGludGVybmFsX25hbWVzcGFjZTsKIAogLyoK
ICAqIE1heGltdW0gbGVuZ3RoIG9mIHBhcnRpdGlvbiBuYW1lLiBbY29uZmlnLmMgaGFzIGEgbGlt
aXQgb2YgNzBdCmRpZmYgLXVyTiBjeXJ1cy1pbWFwZC0yLjIuMTIuc3VwZXJvbGQvaW1hcC9tYm94
bmFtZS5jIGN5cnVzLWltYXBkLTIuMi4xMi9pbWFwL21ib3huYW1lLmMKLS0tIGN5cnVzLWltYXBk
LTIuMi4xMi5zdXBlcm9sZC9pbWFwL21ib3huYW1lLmMJMjAwNS0wMi0xNCAwOTozOTo1NyArMDMw
MAorKysgY3lydXMtaW1hcGQtMi4yLjEyL2ltYXAvbWJveG5hbWUuYwkyMDA1LTEyLTI2IDE5OjE5
OjE2ICswMzAwCkBAIC05NSw2ICs5NSwxNCBAQAogfTsKICNkZWZpbmUgQ0hBUk1PRDY0KGMpICAo
aW5kZXhfbW9kNjRbKHVuc2lnbmVkIGNoYXIpKGMpXSkKIAorLyogQ2hlY2sgbWFpbGJveCBuYW1l
IGZvciBjb3JyZWN0IGhpZXJzZXBzIHN5bWJvbHMgZGVwZW5kaW5nIG9uCisgICBuYW1lc3BhY2Ug
Ki8KK3N0YXRpYyBpbnQgbWJveG5hbWVfY2hlY2tfaGllcnNlcHMoc3RydWN0IG5hbWVzcGFjZSAq
bmFtZXNwYWNlLCBjb25zdCBjaGFyICpuYW1lLCBpbnQgbmFtZWxlbikKK3sKKyAgICBpZihuYW1l
c3BhY2UtPmhpZXJfc2VwID09ICcvJyAmJiBtZW1jaHIobmFtZSwgRE9UQ0hBUiwgbmFtZWxlbikp
CisJcmV0dXJuIC0xOworICAgIHJldHVybiAwOworfQogCiAvKgogICogQ29udmVydCB0aGUgZXh0
ZXJuYWwgbWFpbGJveCAnbmFtZScgdG8gYW4gaW50ZXJuYWwgbmFtZS4KQEAgLTExNiw2ICsxMjQs
OSBAQAogICAgIHVzZXJsZW4gPSB1c2VyaWQgPyBzdHJsZW4odXNlcmlkKSA6IDA7CiAgICAgbmFt
ZWxlbiA9IHN0cmxlbihuYW1lKTsKIAorICAgIGlmKG1ib3huYW1lX2NoZWNrX2hpZXJzZXBzKG5h
bWVzcGFjZSwgbmFtZSwgbmFtZWxlbikpCisJcmV0dXJuIElNQVBfTUFJTEJPWF9CQUROQU1FOwor
CiAgICAgaWYgKGNvbmZpZ192aXJ0ZG9tYWlucykgewogCWlmICh1c2VyaWQgJiYgKGNwID0gc3Ry
cmNocih1c2VyaWQsICdAJykpKSB7CiAJICAgIC8qIHVzZXIgbG9nZ2VkIGluIGFzIHVzZXJAZG9t
YWluICovCkBAIC0yMDYsNiArMjE3LDkgQEAKICAgICB1c2VybGVuID0gdXNlcmlkID8gc3RybGVu
KHVzZXJpZCkgOiAwOwogICAgIG5hbWVsZW4gPSBzdHJsZW4obmFtZSk7CiAKKyAgICBpZihtYm94
bmFtZV9jaGVja19oaWVyc2VwcyhuYW1lc3BhY2UsIG5hbWUsIG5hbWVsZW4pKQorCXJldHVybiBJ
TUFQX01BSUxCT1hfQkFETkFNRTsKKwogICAgIGlmIChjb25maWdfdmlydGRvbWFpbnMpIHsKIAlp
ZiAodXNlcmlkICYmIChjcCA9IHN0cmNocih1c2VyaWQsICdAJykpKSB7CiAJICAgIC8qIHVzZXIg
bG9nZ2VkIGluIGFzIHVzZXJAZG9tYWluICovCkBAIC00NjQsNTQgKzQ3OCw2OCBAQAogICAgIHJl
dHVybiAwOwogfQogCi0vKgotICogQ3JlYXRlIG5hbWVzcGFjZSBiYXNlZCBvbiBjb25maWcgb3B0
aW9ucy4KLSAqLwotaW50IG1ib3huYW1lX2luaXRfbmFtZXNwYWNlKHN0cnVjdCBuYW1lc3BhY2Ug
Km5hbWVzcGFjZSwgaW50IGlzYWRtaW4pCisvKiBKdXN0IGxlYXZlIHRoZSBpbnB1dCBuYW1lIHVu
dG91Y2hlZC4gVGhpcyBpcyBuZWVkZWQgZm9yIGludGVybmFsCisgICBuYW1lc3BhY2Ugb3BlcmF0
aW9ucy4gKi8KK3N0YXRpYyBpbnQgbWJveG5hbWVfdHJhbnNmb3JtX2NvcHkoc3RydWN0IG5hbWVz
cGFjZSAqbmFtZXNwYWNlLAorCQkJCSAgIGNvbnN0IGNoYXIgKm5hbWUsCisJCQkJICAgIGNvbnN0
IGNoYXIgKnVzZXJpZCwgY2hhciAqcmVzdWx0KQogewotICAgIGNvbnN0IGNoYXIgKnByZWZpeDsK
KyAgICBzdHJjcHkocmVzdWx0LCBuYW1lKTsKKyAgICByZXR1cm4gMDsKK30KIAorLyogY3JlYXRl
IG5hbWVzcGFjZSBiYXNlZCBvbiBnaXZlbiBvcHRpb25zICovCitpbnQgbWJveG5hbWVfaW5pdF9u
YW1lc3BhY2VfZXh0KHN0cnVjdCBuYW1lc3BhY2UgKm5hbWVzcGFjZSwgaW50IGlzYWRtaW4sIGNo
YXIgaGllcl9zZXAsIGludCBpc2FsdCkKK3sKICAgICBhc3NlcnQobmFtZXNwYWNlICE9IE5VTEwp
OwogCiAgICAgbmFtZXNwYWNlLT5pc2FkbWluID0gaXNhZG1pbjsKKyAgICBpZihpc2FsdDwwKSB7
CisJbmFtZXNwYWNlLT5oaWVyX3NlcCA9ICcuJzsKKwluYW1lc3BhY2UtPmlzYWx0ID0gMDsKKwlu
YW1lc3BhY2UtPm1ib3huYW1lX3RvaW50ZXJuYWwgPSBtYm94bmFtZV90cmFuc2Zvcm1fY29weTsK
KwluYW1lc3BhY2UtPm1ib3huYW1lX3RvZXh0ZXJuYWwgPSBtYm94bmFtZV90cmFuc2Zvcm1fY29w
eTsKKwluYW1lc3BhY2UtPm1ib3hsaXN0X2ZpbmRhbGwgPSBtYm94bGlzdF9maW5kYWxsOworCW5h
bWVzcGFjZS0+bWJveGxpc3RfZmluZHN1YiA9IG1ib3hsaXN0X2ZpbmRzdWI7CisJcmV0dXJuIDA7
CisgICAgfQorICAgIG5hbWVzcGFjZS0+aGllcl9zZXAgPSBoaWVyX3NlcDsKKyAgICBuYW1lc3Bh
Y2UtPmlzYWx0ID0gaXNhbHQ7CisgICAgCisgICAgaWYgKGlzYWx0PjApIHsKKwljb25zdCBjaGFy
ICpwcmVmaXg7CiAKLSAgICBuYW1lc3BhY2UtPmhpZXJfc2VwID0KLQljb25maWdfZ2V0c3dpdGNo
KElNQVBPUFRfVU5JWEhJRVJBUkNIWVNFUCkgPyAnLycgOiAnLic7Ci0gICAgbmFtZXNwYWNlLT5p
c2FsdCA9ICFpc2FkbWluICYmIGNvbmZpZ19nZXRzd2l0Y2goSU1BUE9QVF9BTFROQU1FU1BBQ0Up
OwotCi0gICAgaWYgKG5hbWVzcGFjZS0+aXNhbHQpIHsKIAkvKiBhbHRlcm5hdGUgbmFtZXNwYWNl
ICovCiAJc3RyY3B5KG5hbWVzcGFjZS0+cHJlZml4W05BTUVTUEFDRV9JTkJPWF0sICIiKTsKIAog
CXByZWZpeCA9IGNvbmZpZ19nZXRzdHJpbmcoSU1BUE9QVF9VU0VSUFJFRklYKTsKIAlpZiAoIXBy
ZWZpeCB8fCBzdHJsZW4ocHJlZml4KSA9PSAwIHx8CiAJICAgIHN0cmxlbihwcmVmaXgpID49IE1B
WF9OQU1FU1BBQ0VfUFJFRklYIHx8Ci0JICAgIHN0cmNocihwcmVmaXgsbmFtZXNwYWNlLT5oaWVy
X3NlcCkgIT0gTlVMTCkKKwkgICAgc3RyY2hyKHByZWZpeCxoaWVyX3NlcCkgIT0gTlVMTCkKIAkg
ICAgcmV0dXJuIElNQVBfTkFNRVNQQUNFX0JBRFBSRUZJWDsKIAlzcHJpbnRmKG5hbWVzcGFjZS0+
cHJlZml4W05BTUVTUEFDRV9VU0VSXSwgIiUuKnMlYyIsCi0JCU1BWF9OQU1FU1BBQ0VfUFJFRklY
LTEsIHByZWZpeCwgbmFtZXNwYWNlLT5oaWVyX3NlcCk7CisJCU1BWF9OQU1FU1BBQ0VfUFJFRklY
LTEsIHByZWZpeCwgaGllcl9zZXApOwogCiAJcHJlZml4ID0gY29uZmlnX2dldHN0cmluZyhJTUFQ
T1BUX1NIQVJFRFBSRUZJWCk7CiAJaWYgKCFwcmVmaXggfHwgc3RybGVuKHByZWZpeCkgPT0gMCB8
fAogCSAgICBzdHJsZW4ocHJlZml4KSA+PSBNQVhfTkFNRVNQQUNFX1BSRUZJWCB8fAotCSAgICBz
dHJjaHIocHJlZml4LCBuYW1lc3BhY2UtPmhpZXJfc2VwKSAhPSBOVUxMIHx8CisJICAgIHN0cmNo
cihwcmVmaXgsIGhpZXJfc2VwKSAhPSBOVUxMIHx8CiAJICAgICFzdHJuY21wKG5hbWVzcGFjZS0+
cHJlZml4W05BTUVTUEFDRV9VU0VSXSwgcHJlZml4LCBzdHJsZW4ocHJlZml4KSkpCiAJICAgIHJl
dHVybiBJTUFQX05BTUVTUEFDRV9CQURQUkVGSVg7CiAJc3ByaW50ZihuYW1lc3BhY2UtPnByZWZp
eFtOQU1FU1BBQ0VfU0hBUkVEXSwgIiUuKnMlYyIsCi0JCU1BWF9OQU1FU1BBQ0VfUFJFRklYLTEs
IHByZWZpeCwgbmFtZXNwYWNlLT5oaWVyX3NlcCk7IAorCQlNQVhfTkFNRVNQQUNFX1BSRUZJWC0x
LCBwcmVmaXgsIGhpZXJfc2VwKTsgCiAKIAluYW1lc3BhY2UtPm1ib3huYW1lX3RvaW50ZXJuYWwg
PSBtYm94bmFtZV90b2ludGVybmFsX2FsdDsKIAluYW1lc3BhY2UtPm1ib3huYW1lX3RvZXh0ZXJu
YWwgPSBtYm94bmFtZV90b2V4dGVybmFsX2FsdDsKIAluYW1lc3BhY2UtPm1ib3hsaXN0X2ZpbmRh
bGwgPSBtYm94bGlzdF9maW5kYWxsX2FsdDsKIAluYW1lc3BhY2UtPm1ib3hsaXN0X2ZpbmRzdWIg
PSBtYm94bGlzdF9maW5kc3ViX2FsdDsKICAgICB9Ci0KICAgICBlbHNlIHsKIAkvKiBzdGFuZGFy
ZCBuYW1lc3BhY2UgKi8KIAlzcHJpbnRmKG5hbWVzcGFjZS0+cHJlZml4W05BTUVTUEFDRV9JTkJP
WF0sICIlcyVjIiwKLQkJIklOQk9YIiwgbmFtZXNwYWNlLT5oaWVyX3NlcCk7CisJCSJJTkJPWCIs
IGhpZXJfc2VwKTsKIAlzcHJpbnRmKG5hbWVzcGFjZS0+cHJlZml4W05BTUVTUEFDRV9VU0VSXSwg
IiVzJWMiLAotCQkidXNlciIsIG5hbWVzcGFjZS0+aGllcl9zZXApOworCQkidXNlciIsIGhpZXJf
c2VwKTsKIAlzdHJjcHkobmFtZXNwYWNlLT5wcmVmaXhbTkFNRVNQQUNFX1NIQVJFRF0sICIiKTsK
IAogCW5hbWVzcGFjZS0+bWJveG5hbWVfdG9pbnRlcm5hbCA9IG1ib3huYW1lX3RvaW50ZXJuYWw7
CkBAIC01MjQsNiArNTUyLDE3IEBACiB9CiAKIC8qCisgKiBDcmVhdGUgbmFtZXNwYWNlIGJhc2Vk
IG9uIGNvbmZpZyBvcHRpb25zLgorICovCitpbnQgbWJveG5hbWVfaW5pdF9uYW1lc3BhY2Uoc3Ry
dWN0IG5hbWVzcGFjZSAqbmFtZXNwYWNlLCBpbnQgaXNhZG1pbikKK3sKKyAgICByZXR1cm4gbWJv
eG5hbWVfaW5pdF9uYW1lc3BhY2VfZXh0KG5hbWVzcGFjZSwKKwkJCQkgICAgICAgaXNhZG1pbiwK
KwkJCQkgICAgICAgY29uZmlnX2dldHN3aXRjaChJTUFQT1BUX1VOSVhISUVSQVJDSFlTRVApID8g
Jy8nIDogJy4nLAorCQkJCSAgICAgICAhaXNhZG1pbiAmJiBjb25maWdfZ2V0c3dpdGNoKElNQVBP
UFRfQUxUTkFNRVNQQUNFKSk7Cit9CisKKy8qCiAgKiBUcmFuc2xhdGUgc2VwYXJhdG9yIGNoYXJh
Y3RvcnMgaW4gYSBtYWlsYm94bmFtZSBmcm9tIGl0cyBleHRlcm5hbAogICogcmVwcmVzZW50YXRp
b24gdG8gaXRzIGludGVybmFsIHJlcHJlc2VudGF0aW9uICcuJy4KICAqIElmIHVzaW5nIHRoZSB1
bml4aGllcmFyY2h5c2VwICcvJywgYWxsICcuJ3MgZ2V0IHRyYW5zbGF0ZWQgdG8gRE9UQ0hBUi4K
QEAgLTY2NCw3ICs3MDMsNyBAQAogCiAgICAgaWYgKHN0cmxlbihuYW1lKSA+IE1BWF9NQUlMQk9Y
X05BTUUpIHJldHVybiBJTUFQX01BSUxCT1hfQkFETkFNRTsKICAgICBmb3IgKGkgPSAwOyBpIDwg
TlVNX0JBRE1CT1hQQVRURVJOUzsgaSsrKSB7Ci0JZyA9IGdsb2JfaW5pdChiYWRtYm94cGF0dGVy
bnNbaV0sIDApOworCWcgPSBnbG9iX2luaXQoYmFkbWJveHBhdHRlcm5zW2ldLCB1bml4c2VwPycv
JzonLicsIDApOwogCWlmIChHTE9CX1RFU1QoZywgbmFtZSkgIT0gLTEpIHsKIAkgICAgZ2xvYl9m
cmVlKCZnKTsKIAkgICAgcmV0dXJuIElNQVBfTUFJTEJPWF9CQUROQU1FOwpkaWZmIC11ck4gY3ly
dXMtaW1hcGQtMi4yLjEyLnN1cGVyb2xkL2ltYXAvbWJveG5hbWUuaCBjeXJ1cy1pbWFwZC0yLjIu
MTIvaW1hcC9tYm94bmFtZS5oCi0tLSBjeXJ1cy1pbWFwZC0yLjIuMTIuc3VwZXJvbGQvaW1hcC9t
Ym94bmFtZS5oCTIwMDQtMDMtMTkgMTc6NDk6MTcgKzAzMDAKKysrIGN5cnVzLWltYXBkLTIuMi4x
Mi9pbWFwL21ib3huYW1lLmgJMjAwNS0xMi0yNiAxOToxOToxNyArMDMwMApAQCAtNzgsNiArNzgs
OCBAQAogCQkJICAgIHZvaWQgKnJvY2ssIGludCBmb3JjZSk7CiB9OwogCisvKiBjcmVhdGUgbmFt
ZXNwYWNlIGJhc2VkIG9uIGdpdmVuIG9wdGlvbnMgKi8KK2ludCBtYm94bmFtZV9pbml0X25hbWVz
cGFjZV9leHQoc3RydWN0IG5hbWVzcGFjZSAqbmFtZXNwYWNlLCBpbnQgaXNhZG1pbiwgY2hhciBo
aWVyX3NlcCwgaW50IGlzYWx0KTsKIC8qIENyZWF0ZSBuYW1lc3BhY2UgYmFzZWQgb24gY29uZmln
IG9wdGlvbnMuICovCiBpbnQgbWJveG5hbWVfaW5pdF9uYW1lc3BhY2Uoc3RydWN0IG5hbWVzcGFj
ZSAqbmFtZXNwYWNlLCBpbnQgaXNhZG1pbik7CiAKZGlmZiAtdXJOIGN5cnVzLWltYXBkLTIuMi4x
Mi5zdXBlcm9sZC9pbWFwL211cGRhdGUuYyBjeXJ1cy1pbWFwZC0yLjIuMTIvaW1hcC9tdXBkYXRl
LmMKLS0tIGN5cnVzLWltYXBkLTIuMi4xMi5zdXBlcm9sZC9pbWFwL211cGRhdGUuYwkyMDA1LTEy
LTI2IDE5OjE3OjE2ICswMzAwCisrKyBjeXJ1cy1pbWFwZC0yLjIuMTIvaW1hcC9tdXBkYXRlLmMJ
MjAwNS0xMi0yNiAxOToxOToxNyArMDMwMApAQCAtNTI5LDYgKzUyOSwxMiBAQAogCXJldHVybiBF
Q19PU0VSUjsKICAgICB9CiAKKyAgICBpZihtYm94bmFtZV9pbml0X25hbWVzcGFjZV9leHQoJmlu
dGVybmFsX25hbWVzcGFjZSwKKwkJCQkgICAxLCAnLicsIC0xKSkgeworCXN5c2xvZyhMT0dfRVJS
LCAiQ2Fubm90IGluaXRpYWxpemUgdGhlIGludGVybmFsIG5hbWVzcGFjZSIpOworCXJldHVybiBF
Q19URU1QRkFJTDsKKyAgICB9CisKICAgICBkYXRhYmFzZV9pbml0KCk7CiAKICAgICBpZiAoIW1h
c3RlcnApIHsKQEAgLTE2ODgsNyArMTY5NCw3IEBACiAgICAgaWYoQy0+bGlzdF9wcmVmaXgpIEMt
Pmxpc3RfcHJlZml4X2xlbiA9IHN0cmxlbihDLT5saXN0X3ByZWZpeCk7CiAgICAgZWxzZSBDLT5s
aXN0X3ByZWZpeF9sZW4gPSAwOwogICAgIAotICAgIG1ib3hsaXN0X2ZpbmRhbGwoTlVMTCwgcGF0
dGVybiwgMSwgTlVMTCwKKyAgICBtYm94bGlzdF9maW5kYWxsKCZpbnRlcm5hbF9uYW1lc3BhY2Us
IHBhdHRlcm4sIDEsIE5VTEwsCiAJCSAgICAgTlVMTCwgc2VuZHVwZGF0ZSwgKHZvaWQqKUMpOwog
CiAgICAgQy0+c3RyZWFtaW5nID0gTlVMTDsKQEAgLTE3MzksNyArMTc0NSw3IEBACiAgICAgQy0+
c3RyZWFtaW5nX2hvc3RzID0gcGFydGlhbDsKIAogICAgIC8qIGR1bXAgaW5pdGlhbCBsaXN0ICov
Ci0gICAgbWJveGxpc3RfZmluZGFsbChOVUxMLCBwYXR0ZXJuLCAxLCBOVUxMLAorICAgIG1ib3hs
aXN0X2ZpbmRhbGwoJmludGVybmFsX25hbWVzcGFjZSwgcGF0dGVybiwgMSwgTlVMTCwKIAkJICAg
ICBOVUxMLCBzZW5kdXBkYXRlLCAodm9pZCopQyk7CiAKICAgICBwdGhyZWFkX211dGV4X3VubG9j
aygmbWFpbGJveGVzX211dGV4KTsgLyogVU5MT0NLICovCkBAIC0yMTYyLDcgKzIxNjgsNyBAQAog
CiAgICAgcm9jay5ib3hlcyA9ICZsb2NhbF9ib3hlczsKIAotICAgIG1ib3hsaXN0X2ZpbmRhbGwo
TlVMTCwgcGF0dGVybiwgMSwgTlVMTCwKKyAgICBtYm94bGlzdF9maW5kYWxsKCZpbnRlcm5hbF9u
YW1lc3BhY2UsIHBhdHRlcm4sIDEsIE5VTEwsCiAJCSAgICAgTlVMTCwgc3luY19maW5kYWxsX2Ni
LCAodm9pZCopJnJvY2spOwogCiAgICAgLyogVHJhdmVyc2UgYm90aCBsaXN0cywgY29tcGFyZSB0
aGUgbmFtZXMgKi8KZGlmZiAtdXJOIGN5cnVzLWltYXBkLTIuMi4xMi5zdXBlcm9sZC9pbWFwL25u
dHBkLmMgY3lydXMtaW1hcGQtMi4yLjEyL2ltYXAvbm50cGQuYwotLS0gY3lydXMtaW1hcGQtMi4y
LjEyLnN1cGVyb2xkL2ltYXAvbm50cGQuYwkyMDA1LTEyLTI2IDE5OjE3OjE3ICswMzAwCisrKyBj
eXJ1cy1pbWFwZC0yLjIuMTIvaW1hcC9ubnRwZC5jCTIwMDUtMTItMjYgMTk6MTk6MTcgKzAzMDAK
QEAgLTUzMCw2ICs1MzAsMTEgQEAKIAlmYXRhbCgidW5hYmxlIHRvIGluaXQgZHVwbGljYXRlIGRl
bGl2ZXJ5IGRhdGFiYXNlIiwgRUNfU09GVFdBUkUpOwogICAgIH0KIAorICAgIC8qIGluaXRpYWxp
emUgdGhlIGludGVybmFsIG5hbWVzcGFjZSBzdHJ1Y3R1cmUgKi8KKyAgICBpZihtYm94bmFtZV9p
bml0X25hbWVzcGFjZV9leHQoJmludGVybmFsX25hbWVzcGFjZSwKKwkJCQkgICAxLCAnLicsIC0x
KSkKKwlmYXRhbCgiY2Fubm90IGluaXRpYWxpemUgdGhlIGludGVybmFsIG5hbWVzcGFjZSIsIEVD
X1RFTVBGQUlMKTsKKyAgICAKICAgICAvKiBvcGVuIHRoZSBtYm94bGlzdCwgd2UnbGwgbmVlZCBp
dCBmb3IgcmVhbCB3b3JrICovCiAgICAgbWJveGxpc3RfaW5pdCgwKTsKICAgICBtYm94bGlzdF9v
cGVuKE5VTEwpOwpAQCAtMjU0NCw3ICsyNTQ5LDcgQEAKIAlzdHJjcHkocGF0dGVybiwgbmV3c3By
ZWZpeCk7CiAJc3RyY2F0KHBhdHRlcm4sICIqIik7CiAJbGlzdF9jYihOVUxMLCAwLCAwLCBOVUxM
KTsKLQltYm94bGlzdF9maW5kYWxsKE5VTEwsIHBhdHRlcm4sIDAsIG5udHBfdXNlcmlkLCBubnRw
X2F1dGhzdGF0ZSwKKwltYm94bGlzdF9maW5kYWxsKCZpbnRlcm5hbF9uYW1lc3BhY2UsIHBhdHRl
cm4sIDAsIG5udHBfdXNlcmlkLCBubnRwX2F1dGhzdGF0ZSwKIAkJCSBsaXN0X2NiLCAmbHJvY2sp
OwogCiAJLyogcHJveHkgdG8gdGhlIGJhY2tlbmRzICovCkBAIC0yNjA1LDcgKzI2MTAsNyBAQAog
CXN0cmNweShwYXR0ZXJuLCBuZXdzcHJlZml4KTsKIAlzdHJjYXQocGF0dGVybiwgIioiKTsKIAls
aXN0X2NiKE5VTEwsIDAsIDAsIE5VTEwpOwotCW1ib3hsaXN0X2ZpbmRhbGwoTlVMTCwgcGF0dGVy
biwgMCwgbm50cF91c2VyaWQsIG5udHBfYXV0aHN0YXRlLAorCW1ib3hsaXN0X2ZpbmRhbGwoJmlu
dGVybmFsX25hbWVzcGFjZSwgcGF0dGVybiwgMCwgbm50cF91c2VyaWQsIG5udHBfYXV0aHN0YXRl
LAogCQkJIGxpc3RfY2IsICZscm9jayk7CiAKIAkvKiBwcm94eSB0byB0aGUgYmFja2VuZHMgKi8K
ZGlmZiAtdXJOIGN5cnVzLWltYXBkLTIuMi4xMi5zdXBlcm9sZC9pbWFwL3Byb3h5ZC5jIGN5cnVz
LWltYXBkLTIuMi4xMi9pbWFwL3Byb3h5ZC5jCi0tLSBjeXJ1cy1pbWFwZC0yLjIuMTIuc3VwZXJv
bGQvaW1hcC9wcm94eWQuYwkyMDA0LTEyLTE3IDE5OjMyOjIwICswMzAwCisrKyBjeXJ1cy1pbWFw
ZC0yLjIuMTIvaW1hcC9wcm94eWQuYwkyMDA1LTEyLTI2IDE5OjE5OjE4ICswMzAwCkBAIC0xMTQ4
LDYgKzExNDgsMTEgQEAKICAgICAvKiBsb2FkIHRoZSBTQVNMIHBsdWdpbnMgKi8KICAgICBnbG9i
YWxfc2FzbF9pbml0KDEsIDEsIG15c2FzbF9jYik7CiAKKyAgICAvKiBpbml0aWFsaXplIHRoZSBp
bnRlcm5hbCBuYW1lc3BhY2Ugc3RydWN0dXJlICovCisgICAgaWYobWJveG5hbWVfaW5pdF9uYW1l
c3BhY2VfZXh0KCZpbnRlcm5hbF9uYW1lc3BhY2UsCisJCQkJICAgMSwgJy4nLCAtMSkpCisJZmF0
YWwoImNhbm5vdCBpbml0aWFsaXplIHRoZSBpbnRlcm5hbCBuYW1lc3BhY2UiLCBFQ19URU1QRkFJ
TCk7CisKICAgICAvKiBvcGVuIHRoZSBtYm94bGlzdCwgd2UnbGwgbmVlZCBpdCBmb3IgcmVhbCB3
b3JrICovCiAgICAgbWJveGxpc3RfaW5pdCgwKTsKICAgICBtYm94bGlzdF9vcGVuKE5VTEwpOwpA
QCAtMzc4NiwxMSArMzc5MSw2IEBACiAJICAgIC8qIG5vb3AgKi8KIAl9CiAgICAgfSBlbHNlIGlm
ICghc3RyY2FzZWNtcChuYW1lc3BhY2UsICJhbGwubWFpbGJveGVzIikpIHsKLQkvKiBUcmFuc2xh
dGUgYW55IHNlcGFyYXRvcnMgaW4gcGF0dGVybiAqLwotCW1ib3huYW1lX2hpZXJzZXBfdG9pbnRl
cm5hbCgmcHJveHlkX25hbWVzcGFjZSwgcGF0dGVybiwKLQkJCQkgICAgY29uZmlnX3ZpcnRkb21h
aW5zID8KLQkJCQkgICAgc3RyY3NwbihwYXR0ZXJuLCAiQCIpIDogMCk7Ci0KIAkoKnByb3h5ZF9u
YW1lc3BhY2UubWJveGxpc3RfZmluZGFsbCkoJnByb3h5ZF9uYW1lc3BhY2UsIHBhdHRlcm4sCiAJ
CQkJCSAgICAgcHJveHlkX3VzZXJpc2FkbWluLCBwcm94eWRfdXNlcmlkLAogCQkJCQkgICAgIHBy
b3h5ZF9hdXRoc3RhdGUsIG1haWxib3hkYXRhLApAQCAtMzg4MywxMSArMzg4Myw2IEBACiAJICAg
IHBhdHRlcm4gPSBidWY7CiAJfQogCi0JLyogVHJhbnNsYXRlIGFueSBzZXBhcmF0b3JzIGluIHBh
dHRlcm4gKi8KLQltYm94bmFtZV9oaWVyc2VwX3RvaW50ZXJuYWwoJnByb3h5ZF9uYW1lc3BhY2Us
IHBhdHRlcm4sCi0gCQkJCSAgICBjb25maWdfdmlydGRvbWFpbnMgPwotIAkJCQkgICAgc3RyY3Nw
bihwYXR0ZXJuLCAiQCIpIDogMCk7Ci0KIAkoKnByb3h5ZF9uYW1lc3BhY2UubWJveGxpc3RfZmlu
ZGFsbCkoJnByb3h5ZF9uYW1lc3BhY2UsIHBhdHRlcm4sCiAJCQkJCSAgICAgcHJveHlkX3VzZXJp
c2FkbWluLCBwcm94eWRfdXNlcmlkLAogCQkJCQkgICAgIHByb3h5ZF9hdXRoc3RhdGUsIGxpc3Rk
YXRhLCBOVUxMKTsKQEAgLTQyMTEsOCArNDIwNiwxNiBAQAogICAgIGludCByOwogICAgIGNoYXIg
KnRoaXNfc2VydmVyOwogICAgIGNvbnN0IGNoYXIgKnNlcnZlcm5hbWUgPSAoY29uc3QgY2hhciAq
KXJvY2s7CisgICAgY2hhciBpbnRuYW1lW01BWF9NQUlMQk9YX05BTUUrMV07CisKKyAgICBpZigo
ciA9ICgqcHJveHlkX25hbWVzcGFjZS5tYm94bmFtZV90b2ludGVybmFsKSgmcHJveHlkX25hbWVz
cGFjZSwKKwkJCQkJCSAgICBuYW1lLAorCQkJCQkJICAgIHByb3h5ZF91c2VyaWQsCisJCQkJCQkg
ICAgaW50bmFtZSkpKQorCXJldHVybiByOwogICAgIAotICAgIHIgPSBtbG9va3VwKG5hbWUsICZ0
aGlzX3NlcnZlciwgTlVMTCwgTlVMTCk7CisgICAgCisgICAgciA9IG1sb29rdXAoaW50bmFtZSwg
JnRoaXNfc2VydmVyLCBOVUxMLCBOVUxMKTsKICAgICBpZihyKSByZXR1cm4gcjsKIAogICAgIGlm
KHN0cmNtcChzZXJ2ZXJuYW1lLCB0aGlzX3NlcnZlcikpIHsKQEAgLTQyNDcsNyArNDI1MCw3IEBA
CiAgICAgaWYoIXIpIHsKIAlzZXJ2ZXJfcm9jayA9IHhzdHJkdXAoc2VydmVyX3JvY2tfdG1wKTsK
IAotCXNucHJpbnRmKHF1b3Rhcm9vdGJ1Ziwgc2l6ZW9mKHF1b3Rhcm9vdGJ1ZiksICIlcy4qIiwg
bWFpbGJveG5hbWUpOworCXNucHJpbnRmKHF1b3Rhcm9vdGJ1Ziwgc2l6ZW9mKHF1b3Rhcm9vdGJ1
ZiksICIlcyVjKiIsIG5hbWUsIHByb3h5ZF9uYW1lc3BhY2UuaGllcl9zZXApOwogCiAJciA9IG1i
b3hsaXN0X2ZpbmRhbGwoJnByb3h5ZF9uYW1lc3BhY2UsIHF1b3Rhcm9vdGJ1ZiwKIAkJCSAgICAg
cHJveHlkX3VzZXJpc2FkbWluLCBwcm94eWRfdXNlcmlkLApAQCAtNDM2Miw3ICs0MzY1LDcgQEAK
ICAgICBpZighcikgewogCXNlcnZlcl9yb2NrID0geHN0cmR1cChzZXJ2ZXJfcm9ja190bXApOwog
Ci0Jc25wcmludGYocXVvdGFyb290YnVmLCBzaXplb2YocXVvdGFyb290YnVmKSwgIiVzLioiLCBt
YWlsYm94bmFtZSk7CisJc25wcmludGYocXVvdGFyb290YnVmLCBzaXplb2YocXVvdGFyb290YnVm
KSwgIiVzJWMqIiwgcXVvdGFyb290LCBwcm94eWRfbmFtZXNwYWNlLmhpZXJfc2VwKTsKIAogCXIg
PSBtYm94bGlzdF9maW5kYWxsKCZwcm94eWRfbmFtZXNwYWNlLCBxdW90YXJvb3RidWYsCiAJCQkg
ICAgIHByb3h5ZF91c2VyaXNhZG1pbiwgcHJveHlkX3VzZXJpZCwKQEAgLTQ2MDUsNyArNDYwOCw3
IEBACiAgICAgLyogbm93IGZpbmQgYWxsIHRoZSBleGNpdGluZyB0b3BsZXZlbCBuYW1lc3BhY2Vz
IC0KICAgICAgKiB3ZSdyZSB1c2luZyBpbnRlcm5hbCBuYW1lcyBoZXJlCiAgICAgICovCi0gICAg
bWJveGxpc3RfZmluZGFsbChOVUxMLCBwYXR0ZXJuLCBwcm94eWRfdXNlcmlzYWRtaW4sIHByb3h5
ZF91c2VyaWQsCisgICAgbWJveGxpc3RfZmluZGFsbCgmaW50ZXJuYWxfbmFtZXNwYWNlLCBwYXR0
ZXJuLCBwcm94eWRfdXNlcmlzYWRtaW4sIHByb3h5ZF91c2VyaWQsCiAJCSAgICAgcHJveHlkX2F1
dGhzdGF0ZSwgbmFtZXNwYWNlZGF0YSwgKHZvaWQqKSBzYXdvbmUpOwogCiAgICAgcHJvdF9wcmlu
dGYocHJveHlkX291dCwgIiogTkFNRVNQQUNFIik7CkBAIC00Njk3LDExICs0NzAwLDcgQEAKIAkJ
ICAgICAgIGludCBtYXljcmVhdGUgX19hdHRyaWJ1dGVfXygodW51c2VkKSksIAogCQkgICAgICAg
dm9pZCogcm9jayBfX2F0dHJpYnV0ZV9fKCh1bnVzZWQpKSkKIHsKLSAgICBjaGFyIG1ib3huYW1l
W01BWF9NQUlMQk9YX1BBVEgrMV07Ci0KLSAgICAoKnByb3h5ZF9uYW1lc3BhY2UubWJveG5hbWVf
dG9leHRlcm5hbCkoJnByb3h5ZF9uYW1lc3BhY2UsIG5hbWUsCi0JCQkJCSAgICBwcm94eWRfdXNl
cmlkLCBtYm94bmFtZSk7Ci0gICAgcHJvdF9wcmludGYocHJveHlkX291dCwgIiogTUFJTEJPWCAl
c1xyXG4iLCBtYm94bmFtZSk7CisgICAgcHJvdF9wcmludGYocHJveHlkX291dCwgIiogTUFJTEJP
WCAlc1xyXG4iLCBuYW1lKTsKICAgICByZXR1cm4gMDsKIH0KIApkaWZmIC11ck4gY3lydXMtaW1h
cGQtMi4yLjEyLnN1cGVyb2xkL2ltYXAvcXVvdGEuYyBjeXJ1cy1pbWFwZC0yLjIuMTIvaW1hcC9x
dW90YS5jCi0tLSBjeXJ1cy1pbWFwZC0yLjIuMTIuc3VwZXJvbGQvaW1hcC9xdW90YS5jCTIwMDQt
MDYtMzAgMjM6MjM6MjYgKzA0MDAKKysrIGN5cnVzLWltYXBkLTIuMi4xMi9pbWFwL3F1b3RhLmMJ
MjAwNS0xMi0yNiAxOToxOToxOCArMDMwMApAQCAtMjk3LDcgKzI5Nyw3IEBACiAvKgogICogQWNj
b3VudCBmb3IgbWFpbGJveCAnbmFtZScgd2hlbiBmaXhpbmcgdGhlIHF1b3RhIHJvb3RzCiAgKi8K
LWludCBmaXhxdW90YV9tYWlsYm94KGNoYXIgKm5hbWUsCitpbnQgZml4cXVvdGFfbWFpbGJveChj
aGFyICpleHRuYW1lLAogCQkgICAgIGludCBtYXRjaGxlbiBfX2F0dHJpYnV0ZV9fKCh1bnVzZWQp
KSwKIAkJICAgICBpbnQgbWF5Y3JlYXRlIF9fYXR0cmlidXRlX18oKHVudXNlZCkpLAogCQkgICAg
IHZvaWQqIHJvY2spCkBAIC0zMDcsNyArMzA3LDEwIEBACiAgICAgaW50IGksIGxlbiwgdGhpc3F1
b3RhLCB0aGlzcXVvdGFsZW47CiAgICAgc3RydWN0IGZpeF9yb2NrICpmcm9jayA9IChzdHJ1Y3Qg
Zml4X3JvY2sgKikgcm9jazsKICAgICBjaGFyICpwLCAqZG9tYWluID0gZnJvY2stPmRvbWFpbjsK
KyAgICBjaGFyIG5hbWVbTUFYX01BSUxCT1hfUEFUSCsxXTsKIAorICAgIGlmKCgqcXVvdGFfbmFt
ZXNwYWNlLm1ib3huYW1lX3RvaW50ZXJuYWwpKCZxdW90YV9uYW1lc3BhY2UsIGV4dG5hbWUsCisJ
CQkJCSAgICAgTlVMTCwgbmFtZSkpOwogICAgIC8qIG1ha2Ugc3VyZSB0aGUgZG9tYWlucyBtYXRj
aCAqLwogICAgIGlmIChkb21haW4gJiYKIAkoIShwID0gc3RyY2hyKG5hbWUsICchJykpIHx8IChw
IC0gbmFtZSkgIT0gc3RybGVuKGRvbWFpbikgfHwKZGlmZiAtdXJOIGN5cnVzLWltYXBkLTIuMi4x
Mi5zdXBlcm9sZC9pbWFwL3JlY29uc3RydWN0LmMgY3lydXMtaW1hcGQtMi4yLjEyL2ltYXAvcmVj
b25zdHJ1Y3QuYwotLS0gY3lydXMtaW1hcGQtMi4yLjEyLnN1cGVyb2xkL2ltYXAvcmVjb25zdHJ1
Y3QuYwkyMDA0LTEwLTExIDE4OjAxOjI0ICswNDAwCisrKyBjeXJ1cy1pbWFwZC0yLjIuMTIvaW1h
cC9yZWNvbnN0cnVjdC5jCTIwMDUtMTItMjYgMTk6MTk6MTkgKzAzMDAKQEAgLTEyNSw3ICsxMjUs
NyBAQAogICAgIGludCBtZmxhZyA9IDA7CiAgICAgaW50IGZmbGFnID0gMDsKICAgICBpbnQgeGZs
YWcgPSAwOwotICAgIGNoYXIgYnVmW01BWF9NQUlMQk9YX1BBVEgrMV07CisgICAgY2hhciBidWZb
TUFYX01BSUxCT1hfUEFUSCsxXT0iIjsKICAgICBjaGFyIG1iYnVmW01BWF9NQUlMQk9YX1BBVEgr
MV07CiAgICAgc3RydWN0IGRpc2NvdmVyZWQgaGVhZDsKICAgICBjaGFyICphbHRfY29uZmlnID0g
TlVMTDsKQEAgLTI3OSwyMyArMjc5LDI4IEBACiAgICAgZm9yIChpID0gb3B0aW5kOyBpIDwgYXJn
YzsgaSsrKSB7CiAJY2hhciAqZG9tYWluID0gTlVMTDsKIAorCWlmKHN0cmxlbihhcmd2W2ldKT5N
QVhfTUFJTEJPWF9QQVRIKQorCSAgICBjb250aW51ZTsKKwogCS8qIHNhdmUgZG9tYWluICovCiAJ
aWYgKGNvbmZpZ192aXJ0ZG9tYWlucykgZG9tYWluID0gc3RyY2hyKGFyZ3ZbaV0sICdAJyk7Ci0K
LQlzdHJsY3B5KGJ1ZiwgYXJndltpXSwgc2l6ZW9mKGJ1ZikpOwotCS8qIFRyYW5zbGF0ZSBhbnkg
c2VwYXJhdG9ycyBpbiBtYWlsYm94bmFtZSAqLwotCW1ib3huYW1lX2hpZXJzZXBfdG9pbnRlcm5h
bCgmcmVjb25fbmFtZXNwYWNlLCBidWYsCi0JCQkJICAgIGNvbmZpZ192aXJ0ZG9tYWlucyA/Ci0J
CQkJICAgIHN0cmNzcG4oYnVmLCAiQCIpIDogMCk7Ci0KKwkKIAkvKiByZWNvbnN0cnVjdCB0aGUg
Zmlyc3QgbWFpbGJveC9wYXR0ZXJuICovCi0JKCpyZWNvbl9uYW1lc3BhY2UubWJveGxpc3RfZmlu
ZGFsbCkoJnJlY29uX25hbWVzcGFjZSwgYnVmLCAxLCAwLAorCSgqcmVjb25fbmFtZXNwYWNlLm1i
b3hsaXN0X2ZpbmRhbGwpKCZyZWNvbl9uYW1lc3BhY2UsIGFyZ3ZbaV0sIDEsIDAsCiAJCQkJCSAg
ICAwLCBkb19yZWNvbnN0cnVjdCwgCiAJCQkJCSAgICBmZmxhZyA/ICZoZWFkIDogTlVMTCk7CiAJ
aWYgKHJmbGFnKSB7Ci0JICAgIC8qIGJ1aWxkIGEgcGF0dGVybiBmb3Igc3VibWFpbGJveGVzICov
Ci0JICAgIC8qIFhYWCBtYm94bGlzdF9maW5kYWxsKCkgaXMgZGVzdHJ1Y3RpdmUgYW5kIHJlbW92
ZXMgZG9tYWluICovCi0JICAgIHN0cmxjYXQoYnVmLCAiLioiLCBzaXplb2YoYnVmKSk7CisJICAg
IGludCBidWZsZW47CisKKwkgICAgaWYoZG9tYWluKSB7CisJCW1lbWNweShidWYsIGFyZ3ZbaV0s
IGRvbWFpbiAtIGFyZ3ZbaV0pOworCQlidWZbZG9tYWluIC0gYXJndltpXV09MDsKKwkgICAgfQor
CSAgICBlbHNlCisJCXN0cmNweShidWYsIGFyZ3ZbaV0pOworCisJICAgIGJ1Zmxlbj1zdHJsZW4o
YnVmKTsKKwkgICAgc25wcmludGYoYnVmK2J1Zmxlbiwgc2l6ZW9mKGJ1ZiktYnVmbGVuLCAiJWMq
QCIsIHJlY29uX25hbWVzcGFjZS5oaWVyX3NlcCk7CiAKIAkgICAgLyogYXBwZW5kIHRoZSBkb21h
aW4gKi8KIAkgICAgaWYgKGRvbWFpbikgc3RybGNhdChidWYsIGRvbWFpbiwgc2l6ZW9mKGJ1Zikp
OwpAQCAtMzExLDE5ICszMTYsMjIgQEAKICAgICB3aGlsZSAoaGVhZC5uZXh0KSB7CiAJc3RydWN0
IGRpc2NvdmVyZWQgKnA7CiAJaW50IHIgPSAwOworCWludCBzYXZlZF9yOwogCiAJcCA9IGhlYWQu
bmV4dDsKIAloZWFkLm5leHQgPSBwLT5uZXh0OwogCiAJLyogY3JlYXRlIHAgKGRhdGFiYXNlIG9u
bHkpIGFuZCByZWNvbnN0cnVjdCBpdCAqLwogCS8qIHBhcnRpdGlvbiBpcyBkZWZpbmVkIGJ5IHRo
ZSBwYXJlbnQgbWFpbGJveCAqLwotCXIgPSBtYm94bGlzdF9jcmVhdGVtYWlsYm94KHAtPm5hbWUs
IDAsIE5VTEwsIDEsCisJc2F2ZWRfciA9IG1ib3hsaXN0X2NyZWF0ZW1haWxib3gocC0+bmFtZSwg
MCwgTlVMTCwgMSwKIAkJCQkgICAiY3lydXMiLCBOVUxMLCAwLCAwLCAheGZsYWcpOwotCWlmICgh
cikgewotCSAgICBkb19yZWNvbnN0cnVjdChwLT5uYW1lLCBzdHJsZW4ocC0+bmFtZSksIDAsICZo
ZWFkKTsKKwlyID0gKCpyZWNvbl9uYW1lc3BhY2UubWJveG5hbWVfdG9leHRlcm5hbCkoJnJlY29u
X25hbWVzcGFjZSwgcC0+bmFtZSwKKwkJCQkJCSAgICJjeXJ1cyIsIGJ1Zik7CisJaWYgKCFzYXZl
ZF9yKSB7CisJICAgIGRvX3JlY29uc3RydWN0KGJ1Ziwgc3RybGVuKHAtPm5hbWUpLCAwLCAmaGVh
ZCk7CiAJfSBlbHNlIHsKIAkgICAgZnByaW50ZihzdGRlcnIsICJjcmVhdGVtYWlsYm94ICVzOiAl
c1xuIiwKLQkJICAgIHAtPm5hbWUsIGVycm9yX21lc3NhZ2UocikpOworCQkgICAgcj9wLT5uYW1l
OmJ1ZiwgZXJyb3JfbWVzc2FnZShzYXZlZF9yKSk7CiAJfQogCS8qIG1heSBoYXZlIGFkZGVkIG1v
cmUgdGhpbmdzIGludG8gb3VyIGxpc3QgKi8KIApAQCAtMzcxLDYgKzM3OSwxNCBAQAogICAgIGNo
YXIgYnVmW01BWF9NQUlMQk9YX1BBVEgrMV07CiAgICAgc3RhdGljIGNoYXIgbGFzdG5hbWVbTUFY
X01BSUxCT1hfUEFUSCsxXSA9ICIiOwogCisgICAgciA9ICgqcmVjb25fbmFtZXNwYWNlLm1ib3hu
YW1lX3RvaW50ZXJuYWwpKCZyZWNvbl9uYW1lc3BhY2UsIG5hbWUsCisJCQkJCSAgICAgICBOVUxM
LCBidWYpOworICAgIGlmIChyKSB7CisJY29tX2VycihuYW1lLCByLCBOVUxMKTsKKwljb2RlID0g
Y29udmVydF9jb2RlKHIpOworCXJldHVybiAwOworICAgIH0KKwogICAgIHNpZ25hbHNfcG9sbCgp
OwogCiAgICAgLyogZG9uJ3QgcmVwZWF0ICovCkBAIC0zODMsMTUgKzM5OSwxMiBAQAogICAgIHN0
cm5jcHkobGFzdG5hbWUsIG5hbWUsIG1hdGNobGVuKTsKICAgICBsYXN0bmFtZVttYXRjaGxlbl0g
PSAnXDAnOwogCi0gICAgciA9IHJlY29uc3RydWN0KGxhc3RuYW1lLCByb2NrKTsKKyAgICByID0g
cmVjb25zdHJ1Y3QoYnVmLCByb2NrKTsKICAgICBpZiAocikgewogCWNvbV9lcnIobmFtZSwgciwg
KHIgPT0gSU1BUF9JT0VSUk9SKSA/IGVycm9yX21lc3NhZ2UoZXJybm8pIDogTlVMTCk7CiAJY29k
ZSA9IGNvbnZlcnRfY29kZShyKTsKICAgICB9IGVsc2UgewotCS8qIENvbnZlcnQgaW50ZXJuYWwg
bmFtZSB0byBleHRlcm5hbCAqLwotCSgqcmVjb25fbmFtZXNwYWNlLm1ib3huYW1lX3RvZXh0ZXJu
YWwpKCZyZWNvbl9uYW1lc3BhY2UsIGxhc3RuYW1lLAotCQkJCQkgICAgICAgTlVMTCwgYnVmKTsK
LQlwcmludGYoIiVzXG4iLCBidWYpOworCXByaW50ZigiJXNcbiIsIG5hbWUpOwogICAgIH0KIAog
ICAgIHJldHVybiAwOwpkaWZmIC11ck4gY3lydXMtaW1hcGQtMi4yLjEyLnN1cGVyb2xkL2ltYXAv
c3F1YXR0ZXIuYyBjeXJ1cy1pbWFwZC0yLjIuMTIvaW1hcC9zcXVhdHRlci5jCi0tLSBjeXJ1cy1p
bWFwZC0yLjIuMTIuc3VwZXJvbGQvaW1hcC9zcXVhdHRlci5jCTIwMDQtMDUtMjIgMDc6NDU6NTIg
KzA0MDAKKysrIGN5cnVzLWltYXBkLTIuMi4xMi9pbWFwL3NxdWF0dGVyLmMJMjAwNS0xMi0yNiAx
OToxOToxOSArMDMwMApAQCAtMjk4LDkgKzI5OCwxMyBAQAogICAgIHN0cnVjdCBzdGF0IGluZGV4
X2ZpbGVfaW5mbzsKICAgICBzdHJ1Y3Qgc3RhdCB0bXBfZmlsZV9pbmZvOwogICAgIGNoYXIgdWlk
X3ZhbGlkaXR5X2J1ZlszMF07Ci0gICAgY2hhciBleHRuYW1lW01BWF9NQUlMQk9YX05BTUUrMV07
CisgICAgY2hhciBpbnRuYW1lW01BWF9NQUlMQk9YX05BTUUrMV07CiAgICAgaW50IHVzZV9hbm5v
dCA9ICooKGludCAqKSByb2NrKTsKIAorICAgIGlmKCgqc3F1YXRfbmFtZXNwYWNlLm1ib3huYW1l
X3RvaW50ZXJuYWwpKCZzcXVhdF9uYW1lc3BhY2UsIG5hbWUsCisJCQkJCSAgICAgTlVMTCwgaW50
bmFtZSkpCisJcmV0dXJuIDE7CisKICAgICAvKiBtYWtlIHN1cmUgdGhlIG1haWxib3ggKG9yIGFu
IGFuY2VzdG9yKSBoYXMKICAgICAgICAvdmVuZG9yL2NtdS9jeXJ1cy1pbWFwZC9zcXVhdCBzZXQg
dG8gInRydWUiICovCiAgICAgaWYgKHVzZV9hbm5vdCkgewpAQCAtMzExLDcgKzMxNSw3IEBACiAJ
aWYgKGNvbmZpZ192aXJ0ZG9tYWlucyAmJiAocCA9IHN0cmNocihuYW1lLCAnIScpKSkKIAkgICAg
ZG9tYWlubGVuID0gcCAtIG5hbWUgKyAxOwogCi0Jc3RybGNweShidWYsIG5hbWUsIHNpemVvZihi
dWYpKTsKKwlzdHJsY3B5KGJ1ZiwgaW50bmFtZSwgc2l6ZW9mKGJ1ZikpOwogCiAJLyogc2luY2Ug
bWFpbGJveGVzIGluaGVyaXQgL3ZlbmRvci9jbXUvY3lydXMtaW1hcGQvc3F1YXQsCiAJICAgd2Ug
bmVlZCB0byBpdGVyYXRlIGFsbCB0aGUgd2F5IHVwIHRvICIiIChzZXJ2ZXIgZW50cnkpICovCkBA
IC0zMzksMjAgKzM0MywxNiBAQAogCSAgICByZXR1cm4gMDsKICAgICB9CiAKLSAgICAvKiBDb252
ZXJ0IGludGVybmFsIG5hbWUgdG8gZXh0ZXJuYWwgKi8KLSAgICAoKnNxdWF0X25hbWVzcGFjZS5t
Ym94bmFtZV90b2V4dGVybmFsKSgmc3F1YXRfbmFtZXNwYWNlLCBuYW1lLAotCQkJCQkgICBOVUxM
LCBleHRuYW1lKTsKLQogICAgIGRhdGEubWFpbGJveF9zdGF0cyA9ICZzdGF0czsKICAgICBkYXRh
Lm1haWxib3ggPSAmbTsKIAogICAgIC8qIEZpcnN0IHdlIGhhdmUgdG8ganVtcCB0aHJvdWdoIGhv
b3BzIHRvIG9wZW4gdGhlIG1haWxib3ggYW5kIGl0cwogICAgICAgIEN5cnVzIGluZGV4LiAqLwog
ICAgIG1lbXNldCgmbSwgMCwgc2l6ZW9mKHN0cnVjdCBtYWlsYm94KSk7Ci0gICAgciA9IG1haWxi
b3hfb3Blbl9oZWFkZXIobmFtZSwgMCwgJm0pOworICAgIHIgPSBtYWlsYm94X29wZW5faGVhZGVy
KGludG5hbWUsIDAsICZtKTsKICAgICBpZiAocikgewogICAgICAgICBpZiAodmVyYm9zZSkgewot
ICAgICAgICAgICAgcHJpbnRmKCJlcnJvciBvcGVuaW5nICVzOiAlc1xuIiwgZXh0bmFtZSwgZXJy
b3JfbWVzc2FnZShyKSk7CisgICAgICAgICAgICBwcmludGYoImVycm9yIG9wZW5pbmcgJXM6ICVz
XG4iLCBuYW1lLCBlcnJvcl9tZXNzYWdlKHIpKTsKICAgICAgICAgfQogICAgICAgICByZXR1cm4g
MTsKICAgICB9CkBAIC0zNjEsNyArMzYxLDcgQEAKICAgICBpZiAoIXIpIHIgPSBtYWlsYm94X2xv
Y2tfcG9wKCZtKTsKICAgICBpZiAocikgewogICAgICAgICBpZiAodmVyYm9zZSkgewotICAgICAg
ICAgICAgcHJpbnRmKCJlcnJvciBsb2NraW5nIGluZGV4ICVzOiAlc1xuIiwgZXh0bmFtZSwgZXJy
b3JfbWVzc2FnZShyKSk7CisgICAgICAgICAgICBwcmludGYoImVycm9yIGxvY2tpbmcgaW5kZXgg
JXM6ICVzXG4iLCBuYW1lLCBlcnJvcl9tZXNzYWdlKHIpKTsKICAgICAgICAgfQogICAgICAgICBt
YWlsYm94X2Nsb3NlKCZtKTsKICAgICAgICAgcmV0dXJuIDE7CkBAIC0zNzgsOSArMzc4LDkgQEAK
ICAgICAgICAgIXN0YXQoaW5kZXhfZmlsZV9uYW1lLCAmaW5kZXhfZmlsZV9pbmZvKSkgewogICAg
ICAgICBpZiAoU0tJUF9GVVpaICsgdG1wX2ZpbGVfaW5mby5zdF9tdGltZSA8CiAgICAgICAgICAg
ICBpbmRleF9maWxlX2luZm8uc3RfbXRpbWUpIHsKLSAgICAgICAgICAgIHN5c2xvZyhMT0dfREVC
VUcsICJza2lwcGluZyBtYWlsYm94ICVzIiwgZXh0bmFtZSk7CisgICAgICAgICAgICBzeXNsb2co
TE9HX0RFQlVHLCAic2tpcHBpbmcgbWFpbGJveCAlcyIsIG5hbWUpOwogICAgICAgICAgICAgaWYg
KHZlcmJvc2UgPiAwKSB7Ci0gICAgICAgICAgICAgICAgcHJpbnRmKCJTa2lwcGluZyBtYWlsYm94
ICVzXG4iLCBleHRuYW1lKTsKKyAgICAgICAgICAgICAgICBwcmludGYoIlNraXBwaW5nIG1haWxi
b3ggJXNcbiIsIG5hbWUpOwogICAgICAgICAgICAgfQogICAgICAgICAgICAgbWFpbGJveF9jbG9z
ZSgmbSk7CiAgICAgICAgICAgICByZXR1cm4gMDsKQEAgLTM5MCw5ICszOTAsOSBAQAogICAgIHNu
cHJpbnRmKHRtcF9maWxlX25hbWUsIHNpemVvZih0bXBfZmlsZV9uYW1lKSwKICAgICAgICAgICAg
ICAiJXMlcy50bXAiLCBtLnBhdGgsIEZOQU1FX1NRVUFUX0lOREVYKTsKIAotICAgIHN5c2xvZyhM
T0dfSU5GTywgImluZGV4aW5nIG1haWxib3ggJXMuLi4gIiwgZXh0bmFtZSk7CisgICAgc3lzbG9n
KExPR19JTkZPLCAiaW5kZXhpbmcgbWFpbGJveCAlcy4uLiAiLCBuYW1lKTsKICAgICBpZiAodmVy
Ym9zZSA+IDApIHsKLSAgICAgIHByaW50ZigiSW5kZXhpbmcgbWFpbGJveCAlcy4uLiAiLCBleHRu
YW1lKTsKKyAgICAgIHByaW50ZigiSW5kZXhpbmcgbWFpbGJveCAlcy4uLiAiLCBuYW1lKTsKICAg
ICB9CiAKICAgICBpZiAoKGZkID0gb3Blbih0bXBfZmlsZV9uYW1lLApAQCAtNTMxLDEyICs1MzEs
OSBAQAogICAgIH0KIAogICAgIGZvciAoaSA9IG9wdGluZDsgaSA8IGFyZ2M7IGkrKykgewotCS8q
IFRyYW5zbGF0ZSBhbnkgc2VwYXJhdG9ycyBpbiBtYWlsYm94bmFtZSAqLwotCSgqc3F1YXRfbmFt
ZXNwYWNlLm1ib3huYW1lX3RvaW50ZXJuYWwpKCZzcXVhdF9uYW1lc3BhY2UsIGFyZ3ZbaV0sCi0J
CQkJCSAgICAgICBOVUxMLCBidWYpOwotCWluZGV4X21lKGJ1ZiwgMCwgMCwgJnVzZV9hbm5vdCk7
CisJaW5kZXhfbWUoYXJndltpXSwgMCwgMCwgJnVzZV9hbm5vdCk7CiAJaWYgKHJmbGFnKSB7Ci0J
ICAgIHN0cmxjYXQoYnVmLCAiLioiLCBzaXplb2YoYnVmKSk7CisJICAgIHNucHJpbnRmKGJ1Ziwg
c2l6ZW9mKGJ1ZiksICIlcyVjKiIsIGFyZ3ZbaV0sIHNxdWF0X25hbWVzcGFjZS5oaWVyX3NlcCk7
CiAJICAgICgqc3F1YXRfbmFtZXNwYWNlLm1ib3hsaXN0X2ZpbmRhbGwpKCZzcXVhdF9uYW1lc3Bh
Y2UsIGJ1ZiwgMSwKIAkJCQkJCTAsIDAsIGluZGV4X21lLCAmdXNlX2Fubm90KTsKIAl9CmRpZmYg
LXVyTiBjeXJ1cy1pbWFwZC0yLjIuMTIuc3VwZXJvbGQvaW1hcC91c2VyLmMgY3lydXMtaW1hcGQt
Mi4yLjEyL2ltYXAvdXNlci5jCi0tLSBjeXJ1cy1pbWFwZC0yLjIuMTIuc3VwZXJvbGQvaW1hcC91
c2VyLmMJMjAwNC0wNi0yMiAyMDo1OToxNyArMDQwMAorKysgY3lydXMtaW1hcGQtMi4yLjEyL2lt
YXAvdXNlci5jCTIwMDUtMTItMjYgMTk6MTk6MTkgKzAzMDAKQEAgLTE4Nyw3ICsxODcsNyBAQAog
ICAgIC8qIHh4eCBubyByZWFzb24gdG8gZG8gdGhpcyBpZiB1c2VyX2RlbGV0ZWFjbCBpcyBhIHN0
dWIgYW55d2F5LiAqLwogICAgIGlmKHdpcGVfdXNlcikgewogCWNvbnN0IGNoYXIgcGF0W10gPSAi
KiI7Ci0JbWJveGxpc3RfZmluZGFsbChOVUxMLCBwYXQsIHNpemVvZihwYXQpLCB1c2VyaWQsCisJ
bWJveGxpc3RfZmluZGFsbCgmaW50ZXJuYWxfbmFtZXNwYWNlLCBwYXQsIHNpemVvZihwYXQpLCB1
c2VyaWQsCiAJCQkgYXV0aHN0YXRlLCB1c2VyX2RlbGV0ZWFjbCwKIAkJCSB1c2VyKTsKICAgICB9
CkBAIC0zNTAsNyArMzUwLDcgQEAKICAgICBpZiAoIXIpIHsKIAkvKiBjb3B5L3JlbmFtZSBzdWJz
Y3JpcHRpb25zIC0gd2UncmUgdXNpbmcgdGhlIGludGVybmFsIG5hbWVzIGhlcmUgKi8KIAlzdHJj
cHkocGF0LCAiKiIpOwotCW1ib3hsaXN0X2ZpbmRzdWIoTlVMTCwgcGF0LCAxLCBvbGR1c2VyLCBh
dXRoc3RhdGUsIHVzZXJfcmVuYW1lc3ViLAorCW1ib3hsaXN0X2ZpbmRzdWIoJmludGVybmFsX25h
bWVzcGFjZSwgcGF0LCAxLCBvbGR1c2VyLCBhdXRoc3RhdGUsIHVzZXJfcmVuYW1lc3ViLAogCQkJ
ICZycm9jaywgMSk7CiAgICAgfQogCmRpZmYgLXVyTiBjeXJ1cy1pbWFwZC0yLjIuMTIuc3VwZXJv
bGQvbGliL2dsb2IuYyBjeXJ1cy1pbWFwZC0yLjIuMTIvbGliL2dsb2IuYwotLS0gY3lydXMtaW1h
cGQtMi4yLjEyLnN1cGVyb2xkL2xpYi9nbG9iLmMJMjAwMy0xMi0wOCAyMzo1NzoxMyArMDMwMAor
KysgY3lydXMtaW1hcGQtMi4yLjEyL2xpYi9nbG9iLmMJMjAwNS0xMi0yNiAxOToxOToyMCArMDMw
MApAQCAtNjcsOCArNjcsOSBAQAogICogICA0KSAnKicgZWF0cyBhbGwgJyoncyBhbmQgJyUncyBj
b25uZWN0ZWQgYnkgYW55IHdpbGRjYXJkCiAgKiAgIDUpICclJyBlYXRzIGFsbCBhZGphY2VudCAn
JSdzCiAgKi8KLWdsb2IgKmdsb2JfaW5pdF9zdXBwcmVzcyAoc3RyLCBmbGFncywgc3VwcHJlc3Mp
CitnbG9iICpnbG9iX2luaXRfc3VwcHJlc3MgKHN0ciwgc2VwX2NoYXIsIGZsYWdzLCBzdXBwcmVz
cykKICAgICBjb25zdCBjaGFyICpzdHI7CisgICAgY2hhciBzZXBfY2hhcjsKICAgICBpbnQgZmxh
Z3M7CiAgICAgY29uc3QgY2hhciAqc3VwcHJlc3M7CiB7CkBAIC04MSw3ICs4Miw3IEBACiAgICAg
ZyA9IChnbG9iICopIHhtYWxsb2Moc2l6ZW9mIChnbG9iKSArIHNsZW4gKyBzdHJsZW4oc3RyKSAr
IDEpOwogICAgIGlmIChnICE9IDApIHsKICAgICAgICAgc3RyY3B5KGctPmluYm94LCBpbmJveCk7
Ci0JZy0+c2VwX2NoYXIgPSAnLic7CisJZy0+c2VwX2NoYXIgPSBzZXBfY2hhcjsKIAlkc3QgPSBn
LT5zdHI7CiAJLyogaWYgd2UncmUgZG9pbmcgYSBzdWJzdHJpbmcgbWF0Y2gsIHB1dCBhICcqJyBw
cmVmaXggKDEpICovCiAJaWYgKGZsYWdzICYgR0xPQl9TVUJTVFJJTkcpIHsKQEAgLTI4NCwyOSAr
Mjg1LDI3IEBACiAJCS8qIGxvb2sgZm9yIGEgbWF0Y2ggd2l0aCBmaXJzdCBjaGFyIGZvbGxvd2lu
ZyAnJScsCiAJCSAqIHN0b3AgYXQgYSBzZXBfY2hhciB1bmxlc3Mgd2UncmUgZG9pbmcgIiolIgog
CQkgKi8KLQkJcHRyID0gcGhpZXI7Ci0JCXdoaWxlIChwdHIgIT0gcGVuZCAmJiAqZ2hpZXIgIT0g
KnB0cgotCQkgICAgICAgJiYgKCpwdHIgIT0gZy0+c2VwX2NoYXIgfHwKKwkJd2hpbGUgKHBoaWVy
ICE9IHBlbmQgJiYgKmdoaWVyICE9ICpwaGllcgorCQkgICAgICAgJiYgKCpwaGllciAhPSBnLT5z
ZXBfY2hhciB8fAogCQkJICAgKCEqZ2hpZXIgJiYgZ3N0YXIgJiYgKmdzdGFyID09ICclJyAmJiBt
aW4KLQkJCSAgICAmJiBwdHIgLSBzdGFydCA8ICptaW4pKSkgewotCQkgICAgKytwdHI7CisJCQkg
ICAgJiYgcGhpZXIgLSBzdGFydCA8ICptaW4pKSkgeworCQkgICAgKytwaGllcjsKIAkJfQotCQlp
ZiAocHRyID09IHBlbmQpIHsKKwkJaWYgKHBoaWVyID09IHBlbmQpIHsKIAkJICAgIGdwdHIgPSBn
aGllcjsKKwkJICAgIHB0ciA9IHBoaWVyOwogCQkgICAgYnJlYWs7CiAJCX0KLQkJaWYgKCpwdHIg
PT0gZy0+c2VwX2NoYXIpIHsKKwkJaWYgKCpnaGllciAhPSAqcGhpZXIgJiYgKnBoaWVyID09IGct
PnNlcF9jaGFyKSB7CiAJCSAgICBpZiAoISpnaGllciAmJiBtaW4KLQkJCSYmICptaW4gPCBwdHIg
LSBzdGFydCAmJiBwdHIgIT0gcGVuZAotCQkJJiYgKnB0ciA9PSBnLT5zZXBfY2hhcgotCQkJKSB7
Ci0JCQkqbWluID0gZ3N0YXIgPyBwdHIgLSBzdGFydCArIDEgOiAtMTsKLQkJCXJldHVybiAocHRy
IC0gc3RhcnQpOworCQkJJiYgKm1pbiA8IHBoaWVyIC0gc3RhcnQgJiYgcGhpZXIgIT0gcGVuZCkg
eworCQkJKm1pbiA9IGdzdGFyID8gcGhpZXIgLSBzdGFydCArIDEgOiAtMTsKKwkJCXJldHVybiAo
cGhpZXIgLSBzdGFydCk7CiAJCSAgICB9CiAJCSAgICBnaGllciA9IE5VTEw7CiAJCSAgICBzZXBm
b3VuZCA9IDE7CiAJCX0gZWxzZSB7Ci0JCSAgICBwaGllciA9ICsrcHRyOworCQkgICAgcHRyID0g
KytwaGllcjsKIAkJICAgIGdwdHIgPSBnaGllciArIDE7CiAJCX0KIAkgICAgfQpAQCAtMzc2LDI5
ICszNzUsMjcgQEAKIAkJLyogbG9vayBmb3IgYSBtYXRjaCB3aXRoIGZpcnN0IGNoYXIgZm9sbG93
aW5nICclJywKIAkJICogc3RvcCBhdCBhIHNlcF9jaGFyIHVubGVzcyB3ZSdyZSBkb2luZyAiKiUi
CiAJCSAqLwotCQlwdHIgPSBwaGllcjsKLQkJd2hpbGUgKHB0ciAhPSBwZW5kICYmICh1bnNpZ25l
ZCBjaGFyKSAqZ2hpZXIgIT0gVE9MT1dFUigqcHRyKQotCQkgICAgICAgJiYgKCpwdHIgIT0gZy0+
c2VwX2NoYXIgfHwKKwkJd2hpbGUgKHBoaWVyICE9IHBlbmQgJiYgKHVuc2lnbmVkIGNoYXIpICpn
aGllciAhPSBUT0xPV0VSKCpwaGllcikKKwkJICAgICAgICYmICgqcGhpZXIgIT0gZy0+c2VwX2No
YXIgfHwKIAkJCSAgICghKmdoaWVyICYmIGdzdGFyICYmICpnc3RhciA9PSAnJScgJiYgbWluCi0J
CQkgICAgJiYgcHRyIC0gc3RhcnQgPCAqbWluKSkpIHsKLQkJICAgICsrcHRyOworCQkJICAgICYm
IHBoaWVyIC0gc3RhcnQgPCAqbWluKSkpIHsKKwkJICAgICsrcGhpZXI7CiAJCX0KLQkJaWYgKHB0
ciA9PSBwZW5kKSB7CisJCWlmIChwaGllciA9PSBwZW5kKSB7CiAJCSAgICBncHRyID0gZ2hpZXI7
CisJCSAgICBwdHIgPSBwaGllcjsKIAkJICAgIGJyZWFrOwogCQl9Ci0JCWlmICgqcHRyID09IGct
PnNlcF9jaGFyKSB7CisJCWlmICgqZ2hpZXIgIT0gKnBoaWVyICYmICpwaGllciA9PSBnLT5zZXBf
Y2hhcikgewogCQkgICAgaWYgKCEqZ2hpZXIgJiYgbWluCi0JCQkmJiAqbWluIDwgcHRyIC0gc3Rh
cnQgJiYgcHRyICE9IHBlbmQKLQkJCSYmICpwdHIgPT0gZy0+c2VwX2NoYXIKLQkJCSkgewotCQkJ
Km1pbiA9IGdzdGFyID8gcHRyIC0gc3RhcnQgKyAxIDogLTE7Ci0JCQlyZXR1cm4gKHB0ciAtIHN0
YXJ0KTsKKwkJCSYmICptaW4gPCBwaGllciAtIHN0YXJ0ICYmIHBoaWVyICE9IHBlbmQpIHsKKwkJ
CSptaW4gPSBnc3RhciA/IHBoaWVyIC0gc3RhcnQgKyAxIDogLTE7CisJCQlyZXR1cm4gKHBoaWVy
IC0gc3RhcnQpOwogCQkgICAgfQogCQkgICAgZ2hpZXIgPSBOVUxMOwogCQkgICAgc2VwZm91bmQg
PSAxOwogCQl9IGVsc2UgewotCQkgICAgcGhpZXIgPSArK3B0cjsKKwkJICAgIHB0ciA9ICsrcGhp
ZXI7CiAJCSAgICBncHRyID0gZ2hpZXIgKyAxOwogCQl9CiAJICAgIH0KQEAgLTQ0Niw3ICs0NDMs
NyBAQAogICAgIGludCBhcmdjOwogICAgIGNoYXIqIGFyZ3ZbXTsKIHsKLSAgICBnbG9iICpnID0g
Z2xvYl9pbml0X3N1cHByZXNzKGFyZ3ZbMV0sIEdMT0JfSU5CT1hDQVNFfEdMT0JfSElFUkFSQ0hZ
LAorICAgIGdsb2IgKmcgPSBnbG9iX2luaXRfc3VwcHJlc3MoYXJndlsxXSwgJy4nLCBHTE9CX0lO
Qk9YQ0FTRXxHTE9CX0hJRVJBUkNIWSwKIAkJCQkgInVzZXIubmlmdHkiKTsKICAgICBjaGFyIHRl
eHRbMTAyNF07CiAgICAgaW50IGxlbjsKZGlmZiAtdXJOIGN5cnVzLWltYXBkLTIuMi4xMi5zdXBl
cm9sZC9saWIvZ2xvYi5oIGN5cnVzLWltYXBkLTIuMi4xMi9saWIvZ2xvYi5oCi0tLSBjeXJ1cy1p
bWFwZC0yLjIuMTIuc3VwZXJvbGQvbGliL2dsb2IuaAkyMDAzLTAyLTEzIDIzOjE1OjQwICswMzAw
CisrKyBjeXJ1cy1pbWFwZC0yLjIuMTIvbGliL2dsb2IuaAkyMDA1LTEyLTI2IDE5OjE5OjIwICsw
MzAwCkBAIC03OCw3ICs3OCw3IEBACiAgKiAgZmxhZ3MgICAgLS0gc2VlIGZsYWcgdmFsdWVzIGFi
b3ZlCiAgKiAgc3VwcHJlc3MgLS0gcHJlZml4IHRvIHN1cHByZXNzCiAgKi8KLWV4dGVybiBnbG9i
ICpnbG9iX2luaXRfc3VwcHJlc3MgUCgoY29uc3QgY2hhciAqc3RyLCBpbnQgZmxhZ3MsCitleHRl
cm4gZ2xvYiAqZ2xvYl9pbml0X3N1cHByZXNzIFAoKGNvbnN0IGNoYXIgKnN0ciwgY2hhciBzZXBf
Y2hhciwgaW50IGZsYWdzLAogCQkJCSAgIGNvbnN0IGNoYXIgKnN1cHByZXNzKSk7CiAKIC8qIGZy
ZWUgYSBnbG9iIHN0cnVjdHVyZQpAQCAtOTcsNyArOTcsNyBAQAogZXh0ZXJuIGludCBnbG9iX3Rl
c3QgUCgoZ2xvYiAqZywgY29uc3QgY2hhciAqc3RyLCBsb25nIGxlbiwgbG9uZyAqbWluKSk7CiAK
IC8qIG1hY3JvcyAqLwotI2RlZmluZSBnbG9iX2luaXQoc3RyLCBmbGFncykgZ2xvYl9pbml0X3N1
cHByZXNzKChzdHIpLCAoZmxhZ3MpLCBOVUxMKQorI2RlZmluZSBnbG9iX2luaXQoc3RyLCBzZXBf
Y2hhciwgZmxhZ3MpIGdsb2JfaW5pdF9zdXBwcmVzcygoc3RyKSwgKHNlcF9jaGFyKSwgKGZsYWdz
KSwgTlVMTCkKICNkZWZpbmUgZ2xvYl9pbmJveGNhc2UoZykgKChnKS0+aW5ib3gpCiAjZGVmaW5l
IEdMT0JfVEVTVChnLCBzdHIpIGdsb2JfdGVzdCgoZyksIChzdHIpLCAwLCBOVUxMKQogI2RlZmlu
ZSBHTE9CX1NFVF9TRVBBUkFUT1IoZywgYykgKChnKS0+c2VwX2NoYXIgPSAoYykpCg==
</data>        

          </attachment>
          <attachment
              isobsolete="0"
              ispatch="1"
              isprivate="0"
          >
            <attachid>423</attachid>
            <date>2006-02-21 05:49 EDT</date>
            <desc>Update</desc>
            <filename>cyrus-imapd-bugs-2.2.12_7.patch</filename>
            <type>text/plain</type>
            <size>73960</size>
            <attacher>dzal_mail@mtu-net.ru</attacher>
            
              <data encoding="base64">ZGlmZiAtdXIgY3lydXMtaW1hcGQtMi4yLjEyLnN1cGVyb2xkL2ltYXAvYW5ub3RhdGUuYyBjeXJ1
cy1pbWFwZC0yLjIuMTIvaW1hcC9hbm5vdGF0ZS5jCi0tLSBjeXJ1cy1pbWFwZC0yLjIuMTIuc3Vw
ZXJvbGQvaW1hcC9hbm5vdGF0ZS5jCTIwMDUtMDItMTQgMDk6Mzk6NTQuMDAwMDAwMDAwICswMzAw
CisrKyBjeXJ1cy1pbWFwZC0yLjIuMTIvaW1hcC9hbm5vdGF0ZS5jCTIwMDYtMDItMjAgMTk6MDQ6
NDMuNjUxNjE2MDAwICswMzAwCkBAIC0zNzMsOSArMzczLDkgQEAKICAgICBpbnQga2V5bGVuLCBy
OwogICAgIHN0cnVjdCBmaW5kX3JvY2sgZnJvY2s7CiAKLSAgICBmcm9jay5tZ2xvYiA9IGdsb2Jf
aW5pdChtYWlsYm94LCBHTE9CX0hJRVJBUkNIWSk7Ci0gICAgZnJvY2suZWdsb2IgPSBnbG9iX2lu
aXQoZW50cnksIEdMT0JfSElFUkFSQ0hZKTsKLSAgICBHTE9CX1NFVF9TRVBBUkFUT1IoZnJvY2su
ZWdsb2IsICcvJyk7CisgICAgLyogY2FuJ3QgdW5kZXJzdGFuZCBpdCB5ZXQgLS0gc29yY2VyZXIg
Ki8KKyAgICBmcm9jay5tZ2xvYiA9IGdsb2JfaW5pdChtYWlsYm94LCAnLicsIEdMT0JfSElFUkFS
Q0hZKTsKKyAgICBmcm9jay5lZ2xvYiA9IGdsb2JfaW5pdChlbnRyeSwgJy8nLCBHTE9CX0hJRVJB
UkNIWSk7CiAgICAgZnJvY2sucHJvYyA9IHByb2M7CiAgICAgZnJvY2sucm9jayA9IHJvY2s7CiAK
QEAgLTkyMiw5ICs5MjIsOSBAQAogICAgIHN0cnVjdCBhbm5vdGF0ZV9mX2VudHJ5X2xpc3QgKmVu
dHJpZXNfcHRyOwogICAgIHN0YXRpYyBjaGFyIGxhc3RuYW1lW01BWF9NQUlMQk9YX1BBVEgrMV07
CiAgICAgc3RhdGljIGludCBzYXd1c2VyID0gMDsKLSAgICBpbnQgYzsKLSAgICBjaGFyIGludF9t
Ym94bmFtZVtNQVhfTUFJTEJPWF9QQVRIKzFdLCBleHRfbWJveG5hbWVbTUFYX01BSUxCT1hfUEFU
SCsxXTsKKyAgICBjaGFyIGludF9tYm94bmFtZVtNQVhfTUFJTEJPWF9QQVRIKzFdLCBpbnRuYW1l
W01BWF9NQUlMQk9YX1BBVEgrMV07CiAgICAgc3RydWN0IG1haWxib3hfYW5ub3RhdGlvbl9yb2Nr
IG1icm9jazsKKyAgICBpbnQgdXNlcnByZWZpeGxlbjsKIAogICAgIC8qIFdlIGhhdmUgdG8gcmVz
ZXQgdGhlIHNhd3VzZXIgZmxhZyBiZWZvcmUgZWFjaCBmZXRjaCBjb21tYW5kLgogICAgICAqIEhh
bmRsZSBpdCBhcyBhIGRpcnR5IGhhY2suCkBAIC05MzksMTEgKzkzOSwxMiBAQAogCXJldHVybiAw
OwogICAgIH0KIAorICAgIHVzZXJwcmVmaXhsZW4gPSBzdHJsZW4oZmRhdGEtPm5hbWVzcGFjZS0+
cHJlZml4W05BTUVTUEFDRV9VU0VSXSkgLSAxOwogICAgIC8qCiAgICAgICogV2UgY2FuIGdldCBh
IHBhcnRpYWwgbWF0Y2ggZm9yICJ1c2VyIiBtdWx0aXBsZSB0aW1lcyB3aXRoCiAgICAgICogb3Ro
ZXIgbWF0Y2hlcyBpbmJldHdlZW4uICBIYW5kbGUgaXQgYXMgYSBzcGVjaWFsIGNhc2UKICAgICAg
Ki8KLSAgICBpZiAobWF0Y2hsZW4gPT0gNCAmJiBzdHJuY2FzZWNtcChuYW1lLCAidXNlciIsIDQp
ID09IDApIHsKKyAgICBpZiAobWF0Y2hsZW4gPT0gdXNlcnByZWZpeGxlbiAmJiBzdHJuY2FzZWNt
cChuYW1lLCBmZGF0YS0+bmFtZXNwYWNlLT5wcmVmaXhbTkFNRVNQQUNFX1VTRVJdLCB1c2VycHJl
Zml4bGVuKSA9PSAwKSB7CiAJaWYgKHNhd3VzZXIpIHJldHVybiAwOwogCXNhd3VzZXIgPSAxOwog
ICAgIH0KQEAgLTk1MSwxOSArOTUyLDggQEAKICAgICBzdHJsY3B5KGxhc3RuYW1lLCBuYW1lLCBz
aXplb2YobGFzdG5hbWUpKTsKICAgICBsYXN0bmFtZVttYXRjaGxlbl0gPSAnXDAnOwogCi0gICAg
aWYgKCFzdHJuY2FzZWNtcChsYXN0bmFtZSwgIklOQk9YIiwgNSkpIHsKLQkoKmZkYXRhLT5uYW1l
c3BhY2UtPm1ib3huYW1lX3RvaW50ZXJuYWwpKGZkYXRhLT5uYW1lc3BhY2UsICJJTkJPWCIsCi0J
CQkJCQkgZmRhdGEtPnVzZXJpZCwgaW50X21ib3huYW1lKTsKLQlzdHJsY2F0KGludF9tYm94bmFt
ZSwgbGFzdG5hbWUrNSwgc2l6ZW9mKGludF9tYm94bmFtZSkpOwotICAgIH0KLSAgICBlbHNlCi0J
c3RybGNweShpbnRfbWJveG5hbWUsIGxhc3RuYW1lLCBzaXplb2YoaW50X21ib3huYW1lKSk7Ci0K
LSAgICBjID0gbmFtZVttYXRjaGxlbl07Ci0gICAgaWYgKGMpIG5hbWVbbWF0Y2hsZW5dID0gJ1ww
JzsKLSAgICAoKmZkYXRhLT5uYW1lc3BhY2UtPm1ib3huYW1lX3RvZXh0ZXJuYWwpKGZkYXRhLT5u
YW1lc3BhY2UsIG5hbWUsCi0JCQkJCSAgICAgZmRhdGEtPnVzZXJpZCwgZXh0X21ib3huYW1lKTsK
LSAgICBpZiAoYykgbmFtZVttYXRjaGxlbl0gPSBjOworICAgICgqZmRhdGEtPm5hbWVzcGFjZS0+
bWJveG5hbWVfdG9pbnRlcm5hbCkoZmRhdGEtPm5hbWVzcGFjZSwgbGFzdG5hbWUsCisJCQkJCSAg
ICAgZmRhdGEtPnVzZXJpZCwgaW50X21ib3huYW1lKTsKIAogICAgIG1lbXNldCgmbWJyb2NrLCAw
LCBzaXplb2Yoc3RydWN0IG1haWxib3hfYW5ub3RhdGlvbl9yb2NrKSk7CiAKQEAgLTk3Niw3ICs5
NjYsNyBAQAogCSBlbnRyaWVzX3B0cjsKIAkgZW50cmllc19wdHIgPSBlbnRyaWVzX3B0ci0+bmV4
dCkgewogCQotCWVudHJpZXNfcHRyLT5lbnRyeS0+Z2V0KGludF9tYm94bmFtZSwgZXh0X21ib3hu
YW1lLAorCWVudHJpZXNfcHRyLT5lbnRyeS0+Z2V0KGludF9tYm94bmFtZSwgbmFtZSwKIAkJCQll
bnRyaWVzX3B0ci0+ZW50cnktPm5hbWUsIGZkYXRhLAogCQkJCSZtYnJvY2ssIChlbnRyaWVzX3B0
ci0+ZW50cnktPnJvY2sgPwogCQkJCQkgIGVudHJpZXNfcHRyLT5lbnRyeS0+cm9jayA6CkBAIC0x
MDIyLDcgKzEwMTIsNyBAQAogICAgIHdoaWxlIChhKSB7CiAJaW50IGF0dHJpYmNvdW50OwogCi0J
ZyA9IGdsb2JfaW5pdChhLT5zLCBHTE9CX0hJRVJBUkNIWSk7CisJZyA9IGdsb2JfaW5pdChhLT5z
LCAnLicsIEdMT0JfSElFUkFSQ0hZKTsKIAkKIAlmb3IgKGF0dHJpYmNvdW50ID0gMDsKIAkgICAg
IGFubm90YXRpb25fYXR0cmlidXRlc1thdHRyaWJjb3VudF0ubmFtZTsKQEAgLTEwNTUsOCArMTA0
NSw3IEBACiAJaW50IGVudHJ5Y291bnQ7CiAJaW50IGNoZWNrX2RiID0gMDsgLyogc2hvdWxkIHdl
IGNoZWNrIHRoZSBkYiBmb3IgdGhpcyBlbnRyeT8gKi8KIAotCWcgPSBnbG9iX2luaXQoZS0+cywg
R0xPQl9ISUVSQVJDSFkpOwotCUdMT0JfU0VUX1NFUEFSQVRPUihnLCAnLycpOworCWcgPSBnbG9i
X2luaXQoZS0+cywgJy8nLCBHTE9CX0hJRVJBUkNIWSk7CiAKIAlmb3IgKGVudHJ5Y291bnQgPSAw
OwogCSAgICAgbm9uX2RiX2VudHJpZXNbZW50cnljb3VudF0ubmFtZTsKQEAgLTEzODIsNiArMTM3
MSw3IEBACiAgICAgY2hhciBpbnRfbWJveG5hbWVbTUFYX01BSUxCT1hfUEFUSCsxXTsKICAgICBz
dHJ1Y3QgbWFpbGJveF9hbm5vdGF0aW9uX3JvY2sgbWJyb2NrOwogICAgIGludCByID0gMDsKKyAg
ICBpbnQgdXNlcnByZWZpeGxlbjsKIAogICAgIC8qIFdlIGhhdmUgdG8gcmVzZXQgdGhlIHNhd3Vz
ZXIgZmxhZyBiZWZvcmUgZWFjaCBmZXRjaCBjb21tYW5kLgogICAgICAqIEhhbmRsZSBpdCBhcyBh
IGRpcnR5IGhhY2suCkBAIC0xMzk2LDExICsxMzg2LDEyIEBACiAJcmV0dXJuIDA7CiAgICAgfQog
CisgICAgdXNlcnByZWZpeGxlbiA9IHN0cmxlbihzZGF0YS0+bmFtZXNwYWNlLT5wcmVmaXhbTkFN
RVNQQUNFX1VTRVJdKSAtIDE7CiAgICAgLyoKICAgICAgKiBXZSBjYW4gZ2V0IGEgcGFydGlhbCBt
YXRjaCBmb3IgInVzZXIiIG11bHRpcGxlIHRpbWVzIHdpdGgKICAgICAgKiBvdGhlciBtYXRjaGVz
IGluYmV0d2Vlbi4gIEhhbmRsZSBpdCBhcyBhIHNwZWNpYWwgY2FzZQogICAgICAqLwotICAgIGlm
IChtYXRjaGxlbiA9PSA0ICYmIHN0cm5jYXNlY21wKG5hbWUsICJ1c2VyIiwgNCkgPT0gMCkgewor
ICAgIGlmIChtYXRjaGxlbiA9PSB1c2VycHJlZml4bGVuICYmIHN0cm5jYXNlY21wKG5hbWUsIHNk
YXRhLT5uYW1lc3BhY2UtPnByZWZpeFtOQU1FU1BBQ0VfVVNFUl0sIHVzZXJwcmVmaXhsZW4pID09
IDApIHsKIAlpZiAoc2F3dXNlcikgcmV0dXJuIDA7CiAJc2F3dXNlciA9IDE7CiAgICAgfQpAQCAt
MTQwOCwxMyArMTM5OSw4IEBACiAgICAgc3RybGNweShsYXN0bmFtZSwgbmFtZSwgc2l6ZW9mKGxh
c3RuYW1lKSk7CiAgICAgbGFzdG5hbWVbbWF0Y2hsZW5dID0gJ1wwJzsKIAotICAgIGlmICghc3Ry
bmNhc2VjbXAobGFzdG5hbWUsICJJTkJPWCIsIDUpKSB7Ci0JKCpzZGF0YS0+bmFtZXNwYWNlLT5t
Ym94bmFtZV90b2ludGVybmFsKShzZGF0YS0+bmFtZXNwYWNlLCAiSU5CT1giLAotCQkJCQkJIHNk
YXRhLT51c2VyaWQsIGludF9tYm94bmFtZSk7Ci0Jc3RybGNhdChpbnRfbWJveG5hbWUsIGxhc3Ru
YW1lKzUsIHNpemVvZihpbnRfbWJveG5hbWUpKTsKLSAgICB9Ci0gICAgZWxzZQotCXN0cmxjcHko
aW50X21ib3huYW1lLCBsYXN0bmFtZSwgc2l6ZW9mKGludF9tYm94bmFtZSkpOworICAgICgqc2Rh
dGEtPm5hbWVzcGFjZS0+bWJveG5hbWVfdG9pbnRlcm5hbCkoc2RhdGEtPm5hbWVzcGFjZSwgbGFz
dG5hbWUsCisJCQkJCSAgICAgc2RhdGEtPnVzZXJpZCwgaW50X21ib3huYW1lKTsKIAogICAgIG1l
bXNldCgmbWJyb2NrLCAwLCBzaXplb2Yoc3RydWN0IG1haWxib3hfYW5ub3RhdGlvbl9yb2NrKSk7
CiAgICAgZ2V0X21iX2RhdGEoaW50X21ib3huYW1lLCAmbWJyb2NrKTsKZGlmZiAtdXIgY3lydXMt
aW1hcGQtMi4yLjEyLnN1cGVyb2xkL2ltYXAvYXJiaXRyb24uYyBjeXJ1cy1pbWFwZC0yLjIuMTIv
aW1hcC9hcmJpdHJvbi5jCi0tLSBjeXJ1cy1pbWFwZC0yLjIuMTIuc3VwZXJvbGQvaW1hcC9hcmJp
dHJvbi5jCTIwMDQtMDUtMjIgMDc6NDU6NDguMDAwMDAwMDAwICswNDAwCisrKyBjeXJ1cy1pbWFw
ZC0yLjIuMTIvaW1hcC9hcmJpdHJvbi5jCTIwMDYtMDItMjAgMTk6MDQ6NDMuNzY5NTI0MDAwICsw
MzAwCkBAIC0xNjQsOSArMTY0LDYgQEAKICAgICBjb25zdHJ1Y3RfaGFzaF90YWJsZSgmbWFpbGJv
eF90YWJsZSwgMjA0NywgMSk7CiAgICAgY29uc3RydWN0X2hhc2hfdGFibGUoJm1ib3huYW1lX3Rh
YmxlLCAyMDQ3LCAxKTsKIAotICAgIC8qIFRyYW5zbGF0ZSBhbnkgc2VwYXJhdG9ycyBpbiBtYWls
Ym94bmFtZSAqLwotICAgIG1ib3huYW1lX2hpZXJzZXBfdG9pbnRlcm5hbCgmYXJiX25hbWVzcGFj
ZSwgcGF0dGVybiwgMCk7Ci0gICAgCiAgICAgLyogR2V0IHRoZSBtYWlsYm94IGxpc3QgKi8KICAg
ICBmcHJpbnRmKHN0ZGVyciwgIkxvYWRpbmcgTWFpbGJveGVzLi4uIik7CiAgICAgKCphcmJfbmFt
ZXNwYWNlLm1ib3hsaXN0X2ZpbmRhbGwpKCZhcmJfbmFtZXNwYWNlLCBwYXR0ZXJuLCAxLCAwLCAw
LApAQCAtMjA4LDggKzIwNSwxMyBAQAogewogICAgIGludCByOwogICAgIHN0cnVjdCBtYWlsYm94
IG1ib3g7CisgICAgY2hhciBpbnRuYW1lW01BWF9NQUlMQk9YX1BBVEgrMV07CisKKyAgICBpZigo
KmFyYl9uYW1lc3BhY2UubWJveG5hbWVfdG9pbnRlcm5hbCkoJmFyYl9uYW1lc3BhY2UsIG5hbWUs
CisJCQkJCSAgICBOVUxMLCBpbnRuYW1lKSkKKwlyZXR1cm4gMDsKIAotICAgIHIgPSBtYWlsYm94
X29wZW5faGVhZGVyKG5hbWUsIE5VTEwsICZtYm94KTsKKyAgICByID0gbWFpbGJveF9vcGVuX2hl
YWRlcihpbnRuYW1lLCBOVUxMLCAmbWJveCk7CiAgICAgaWYoIXIpIHsKIAlzdHJ1Y3QgYXJiX21h
aWxib3hfZGF0YSAqZCA9IG1wb29sX21hbGxvYyhhcmJfcG9vbCwKIAkJCQkJCSAgc2l6ZW9mKHN0
cnVjdCBhcmJfbWFpbGJveF9kYXRhKSk7CkBAIC0yMjAsNyArMjIyLDcgQEAKIC8qCXByaW50Zigi
aW5zZXJ0aW5nICVzIChrZXkgJXMpXG4iLCBuYW1lLCBtYm94LnVuaXF1ZWlkKTsgKi8KIAogCWhh
c2hfaW5zZXJ0KG1ib3gudW5pcXVlaWQsIGQsICZtYWlsYm94X3RhYmxlKTsKLQloYXNoX2luc2Vy
dChuYW1lLCBkLCAmbWJveG5hbWVfdGFibGUpOworCWhhc2hfaW5zZXJ0KGludG5hbWUsIGQsICZt
Ym94bmFtZV90YWJsZSk7CiAKIAltYWlsYm94X2Nsb3NlKCZtYm94KTsKICAgICB9CmRpZmYgLXVy
IGN5cnVzLWltYXBkLTIuMi4xMi5zdXBlcm9sZC9pbWFwL2Noa19jeXJ1cy5jIGN5cnVzLWltYXBk
LTIuMi4xMi9pbWFwL2Noa19jeXJ1cy5jCi0tLSBjeXJ1cy1pbWFwZC0yLjIuMTIuc3VwZXJvbGQv
aW1hcC9jaGtfY3lydXMuYwkyMDA0LTA4LTA0IDE3OjAzOjEyLjAwMDAwMDAwMCArMDQwMAorKysg
Y3lydXMtaW1hcGQtMi4yLjEyL2ltYXAvY2hrX2N5cnVzLmMJMjAwNi0wMi0yMCAxOTowNDo0My44
NjY1NTIwMDAgKzAzMDAKQEAgLTIyMyw2ICsyMjMsMTAgQEAKIAogICAgIGN5cnVzX2luaXQoYWx0
X2NvbmZpZywgImNoa19jeXJ1cyIsIDApOwogCisgICAgaWYobWJveG5hbWVfaW5pdF9uYW1lc3Bh
Y2VfZXh0KCZpbnRlcm5hbF9uYW1lc3BhY2UsCisJCQkJICAgMSwgJy4nLCAtMSkpCisJZnByaW50
ZihzdGRlcnIsICJDYW5ub3QgaW5pdGlhbGl6ZSB0aGUgaW50ZXJuYWwgbmFtZXNwYWNlXG4iKTsK
KwogICAgIG1ib3hsaXN0X2luaXQoMCk7CiAgICAgbWJveGxpc3Rfb3BlbihOVUxMKTsKIApAQCAt
MjM0LDcgKzIzOCw3IEBACiAJCShjaGVja19wYXJ0ID8gY2hlY2tfcGFydCA6ICJBTEwgUEFSVElU
SU9OUyIpKTsKIAkKIAkvKiBidWlsZCBhIGxpc3Qgb2YgbWFpbGJveGVzIC0gd2UncmUgdXNpbmcg
aW50ZXJuYWwgbmFtZXMgaGVyZSAqLwotCW1ib3hsaXN0X2ZpbmRhbGwoTlVMTCwgcGF0dGVybiwg
MSwgTlVMTCwKKwltYm94bGlzdF9maW5kYWxsKCZpbnRlcm5hbF9uYW1lc3BhY2UsIHBhdHRlcm4s
IDEsIE5VTEwsCiAJCQkgTlVMTCwgY2hrbWJveCwgTlVMTCk7CiAgICAgfQogICAgIApkaWZmIC11
ciBjeXJ1cy1pbWFwZC0yLjIuMTIuc3VwZXJvbGQvaW1hcC9jdGxfY3lydXNkYi5jIGN5cnVzLWlt
YXBkLTIuMi4xMi9pbWFwL2N0bF9jeXJ1c2RiLmMKLS0tIGN5cnVzLWltYXBkLTIuMi4xMi5zdXBl
cm9sZC9pbWFwL2N0bF9jeXJ1c2RiLmMJMjAwNi0wMi0yMCAxODozNjoxMy42NjAzOTMwMDAgKzAz
MDAKKysrIGN5cnVzLWltYXBkLTIuMi4xMi9pbWFwL2N0bF9jeXJ1c2RiLmMJMjAwNi0wMi0yMCAx
OTowNDo0My45MzQ3MjUwMDAgKzAzMDAKQEAgLTE2NCw3ICsxNjQsNyBAQAogICAgIGFubm90YXRl
bW9yZV9vcGVuKE5VTEwpOwogCiAgICAgLyogYnVpbGQgYSBsaXN0IG9mIG1haWxib3hlcyAtIHdl
J3JlIHVzaW5nIGludGVybmFsIG5hbWVzIGhlcmUgKi8KLSAgICBtYm94bGlzdF9maW5kYWxsKE5V
TEwsIHBhdHRlcm4sIDEsIE5VTEwsCisgICAgbWJveGxpc3RfZmluZGFsbCgmaW50ZXJuYWxfbmFt
ZXNwYWNlLCBwYXR0ZXJuLCAxLCBOVUxMLAogCQkgICAgIE5VTEwsIGZpeG1ib3gsIE5VTEwpOwog
CiAgICAgYW5ub3RhdGVtb3JlX2Nsb3NlKCk7CkBAIC0yMjYsNiArMjI2LDEwIEBACiAKICAgICBj
eXJ1c19pbml0KGFsdF9jb25maWcsICJjdGxfY3lydXNkYiIsIDApOwogCisgICAgaWYobWJveG5h
bWVfaW5pdF9uYW1lc3BhY2VfZXh0KCZpbnRlcm5hbF9uYW1lc3BhY2UsCisJCQkJICAgMSwgJy4n
LCAtMSkpCisJZnByaW50ZihzdGRlcnIsICJDYW5ub3QgaW5pdGlhbGl6ZSB0aGUgaW50ZXJuYWwg
bmFtZXNwYWNlXG4iKTsKKwogICAgIC8qIGNyZWF0ZSB0aGUgbmFtZSBvZiB0aGUgZGIgZGlyZWN0
b3J5ICovCiAgICAgLyogKHVzZWQgYnkgYmFja3VwIGRpcmVjdG9yeSBuYW1lcykgKi8KICAgICBz
dHJjcHkoZGlybmFtZSwgY29uZmlnX2Rpcik7CmRpZmYgLXVyIGN5cnVzLWltYXBkLTIuMi4xMi5z
dXBlcm9sZC9pbWFwL2N5cmR1bXAuYyBjeXJ1cy1pbWFwZC0yLjIuMTIvaW1hcC9jeXJkdW1wLmMK
LS0tIGN5cnVzLWltYXBkLTIuMi4xMi5zdXBlcm9sZC9pbWFwL2N5cmR1bXAuYwkyMDA0LTA1LTIy
IDA3OjQ1OjQ4LjAwMDAwMDAwMCArMDQwMAorKysgY3lydXMtaW1hcGQtMi4yLjEyL2ltYXAvY3ly
ZHVtcC5jCTIwMDYtMDItMjAgMTk6MDQ6NDQuMTQ1MTQ3MDAwICswMzAwCkBAIC05Myw3ICs5Myw2
IEBACiBpbnQgbWFpbihpbnQgYXJnYywgY2hhciAqYXJndltdKQogewogICAgIGludCBvcHRpb247
Ci0gICAgY2hhciBidWZbTUFYX01BSUxCT1hfUEFUSCsxXTsKICAgICBpbnQgaSwgcjsKICAgICBj
aGFyICphbHRfY29uZmlnID0gTlVMTDsKICAgICBzdHJ1Y3QgaW5jcmVtZW50YWxfcmVjb3JkIGly
ZWM7CkBAIC0xMzIsMTIgKzEzMSw3IEBACiAKICAgICBpcmVjLmluY3J1aWQgPSAwOwogICAgIGZv
ciAoaSA9IG9wdGluZDsgaSA8IGFyZ2M7IGkrKykgewotCXN0cmxjcHkoYnVmLCBhcmd2W2ldLCBz
aXplb2YoYnVmKSk7Ci0JLyogVHJhbnNsYXRlIGFueSBzZXBhcmF0b3JzIGluIG1haWxib3huYW1l
ICovCi0JbWJveG5hbWVfaGllcnNlcF90b2ludGVybmFsKCZkdW1wX25hbWVzcGFjZSwgYnVmLAot
CQkJCSAgICBjb25maWdfdmlydGRvbWFpbnMgPwotCQkJCSAgICBzdHJjc3BuKGJ1ZiwgIkAiKSA6
IDApOwotCSgqZHVtcF9uYW1lc3BhY2UubWJveGxpc3RfZmluZGFsbCkoJmR1bXBfbmFtZXNwYWNl
LCBidWYsIDEsIDAsIDAsCisJKCpkdW1wX25hbWVzcGFjZS5tYm94bGlzdF9maW5kYWxsKSgmZHVt
cF9uYW1lc3BhY2UsIGFyZ3ZbaV0sIDEsIDAsIDAsCiAJCQkJCSAgIGR1bXBfbWUsICZpcmVjKTsK
ICAgICB9CiAKQEAgLTE3MCw3ICsxNjQsOCBAQAogICAgIGludCByOwogICAgIHN0cnVjdCBtYWls
Ym94IG07CiAgICAgY2hhciBib3VuZGFyeVsxMjhdOwotICAgIGNoYXIgaW1hcHVybFtNQVhfTUFJ
TEJPWF9QQVRIXTsKKyAgICBjaGFyIGltYXB1cmxbTUFYX01BSUxCT1hfUEFUSCsxXTsKKyAgICBj
aGFyIGludG5hbWVbTUFYX01BSUxCT1hfUEFUSCsxXTsKICAgICBzdHJ1Y3QgaW5jcmVtZW50YWxf
cmVjb3JkICppcmVjID0gKHN0cnVjdCBpbmNyZW1lbnRhbF9yZWNvcmQgKikgcm9jazsKICAgICBz
dHJ1Y3Qgc2VhcmNoYXJncyBzZWFyY2hhcmdzOwogICAgIHVuc2lnbmVkICp1aWRzOwpAQCAtMTc4
LDEwICsxNzMsMTcgQEAKICAgICBpbnQgaSwgbiwgbnVtdWlkczsKIAogICAgIG1lbXNldCgmbSwg
MCwgc2l6ZW9mKHN0cnVjdCBtYWlsYm94KSk7Ci0gICAgciA9IG1haWxib3hfb3Blbl9oZWFkZXIo
bmFtZSwgMCwgJm0pOworICAgIGlmKChyPSgqZHVtcF9uYW1lc3BhY2UubWJveG5hbWVfdG9pbnRl
cm5hbCkoJmR1bXBfbmFtZXNwYWNlLCBuYW1lLAorCQkJCQkgICAgIE5VTEwsIGludG5hbWUpKSkg
eworCWlmICh2ZXJib3NlKSB7CisJICAgIHByaW50ZigiZXJyb3IgY29udmVydGluZyAlczogJXNc
biIsIG5hbWUsIGVycm9yX21lc3NhZ2UocikpOworCX0KKwlyZXR1cm4gMDsKKyAgICB9CisgICAg
ciA9IG1haWxib3hfb3Blbl9oZWFkZXIoaW50bmFtZSwgMCwgJm0pOwogICAgIGlmIChyKSB7CiAJ
aWYgKHZlcmJvc2UpIHsKLQkgICAgcHJpbnRmKCJlcnJvciBvcGVuaW5nICVzOiAlc1xuIiwgbmFt
ZSwgZXJyb3JfbWVzc2FnZShyKSk7CisJICAgIHByaW50ZigiZXJyb3Igb3BlbmluZyAlczogJXNc
biIsIGludG5hbWUsIGVycm9yX21lc3NhZ2UocikpOwogCX0KIAlyZXR1cm4gMDsKICAgICB9CkBA
IC0xOTAsNyArMTkyLDcgQEAKICAgICBpZiAoIXIpIHIgPSBtYWlsYm94X2xvY2tfcG9wKCZtKTsK
ICAgICBpZiAocikgewogCWlmICh2ZXJib3NlKSB7Ci0JICAgIHByaW50ZigiZXJyb3IgbG9ja2lu
ZyBpbmRleCAlczogJXNcbiIsIG5hbWUsIGVycm9yX21lc3NhZ2UocikpOworCSAgICBwcmludGYo
ImVycm9yIGxvY2tpbmcgaW5kZXggJXM6ICVzXG4iLCBpbnRuYW1lLCBlcnJvcl9tZXNzYWdlKHIp
KTsKIAl9CiAJbWFpbGJveF9jbG9zZSgmbSk7CiAJcmV0dXJuIDA7CmRpZmYgLXVyIGN5cnVzLWlt
YXBkLTIuMi4xMi5zdXBlcm9sZC9pbWFwL2N5cl9leHBpcmUuYyBjeXJ1cy1pbWFwZC0yLjIuMTIv
aW1hcC9jeXJfZXhwaXJlLmMKLS0tIGN5cnVzLWltYXBkLTIuMi4xMi5zdXBlcm9sZC9pbWFwL2N5
cl9leHBpcmUuYwkyMDA0LTA1LTIyIDA3OjQ1OjQ4LjAwMDAwMDAwMCArMDQwMAorKysgY3lydXMt
aW1hcGQtMi4yLjEyL2ltYXAvY3lyX2V4cGlyZS5jCTIwMDYtMDItMjAgMTk6MDQ6NDQuNDU0NzUx
MDAwICswMzAwCkBAIC0yMzIsNiArMjMyLDEwIEBACiAKICAgICBjeXJ1c19pbml0KGFsdF9jb25m
aWcsICJjeXJfZXhwaXJlIiwgMCk7CiAKKyAgICBpZihtYm94bmFtZV9pbml0X25hbWVzcGFjZV9l
eHQoJmludGVybmFsX25hbWVzcGFjZSwKKwkJCQkgICAxLCAnLicsIC0xKSkKKwlmcHJpbnRmKHN0
ZGVyciwgIkNhbm5vdCBpbml0aWFsaXplIHRoZSBpbnRlcm5hbCBuYW1lc3BhY2VcbiIpOworCiAg
ICAgYW5ub3RhdGVtb3JlX2luaXQoMCwgTlVMTCwgTlVMTCk7CiAgICAgYW5ub3RhdGVtb3JlX29w
ZW4oTlVMTCk7CiAKQEAgLTI1Miw3ICsyNTYsNyBAQAogICAgIGNvbnN0cnVjdF9oYXNoX3RhYmxl
KCZleHBpcmVfdGFibGUsIDEwMDAwLCAxKTsKIAogICAgIHN0cmxjcHkoYnVmLCAiKiIsIHNpemVv
ZihidWYpKTsKLSAgICBtYm94bGlzdF9maW5kYWxsKE5VTEwsIGJ1ZiwgMSwgMCwgMCwgJmJ1aWxk
X3RhYmxlLCAmZXhwaXJlX3RhYmxlKTsKKyAgICBtYm94bGlzdF9maW5kYWxsKCZpbnRlcm5hbF9u
YW1lc3BhY2UsIGJ1ZiwgMSwgMCwgMCwgJmJ1aWxkX3RhYmxlLCAmZXhwaXJlX3RhYmxlKTsKIAog
ICAgIHIgPSBkdXBsaWNhdGVfcHJ1bmUoZGF5cywgJmV4cGlyZV90YWJsZSk7CiAKZGlmZiAtdXIg
Y3lydXMtaW1hcGQtMi4yLjEyLnN1cGVyb2xkL2ltYXAvaW1hcGQuYyBjeXJ1cy1pbWFwZC0yLjIu
MTIvaW1hcC9pbWFwZC5jCi0tLSBjeXJ1cy1pbWFwZC0yLjIuMTIuc3VwZXJvbGQvaW1hcC9pbWFw
ZC5jCTIwMDYtMDItMjAgMTg6MzY6MTkuODYzNTUyMDAwICswMzAwCisrKyBjeXJ1cy1pbWFwZC0y
LjIuMTIvaW1hcC9pbWFwZC5jCTIwMDYtMDItMjAgMTk6MDQ6NDQuNzA1NjI1MDAwICswMzAwCkBA
IC01NDgsNiArNTQ4LDExIEBACiAJICAgICBFQ19DT05GSUcpOwogICAgIH0KIAorICAgIC8qIGlu
aXRpYWxpemUgdGhlIGludGVybmFsIG5hbWVzcGFjZSBzdHJ1Y3R1cmUgKi8KKyAgICBpZihtYm94
bmFtZV9pbml0X25hbWVzcGFjZV9leHQoJmludGVybmFsX25hbWVzcGFjZSwKKwkJCQkgICAxLCAn
LicsIC0xKSkKKwlmYXRhbCgiY2Fubm90IGluaXRpYWxpemUgdGhlIGludGVybmFsIG5hbWVzcGFj
ZSIsIEVDX1RFTVBGQUlMKTsKKwogICAgIC8qIG9wZW4gdGhlIG1ib3hsaXN0LCB3ZSdsbCBuZWVk
IGl0IGZvciByZWFsIHdvcmsgKi8KICAgICBtYm94bGlzdF9pbml0KDApOwogICAgIG1ib3hsaXN0
X29wZW4oTlVMTCk7CkBAIC0xNjk0LDYgKzE2OTksMTcgQEAKICAgICB9CiB9CiAKK3N0YXRpYyB2
b2lkIHVzZXJpZF90b2ludGVybmFsKHN0cnVjdCBuYW1lc3BhY2UgKm5hbWVzcGFjZSwgY2hhciAq
dXNlcmlkKQoreworICAgIGNoYXIgaGllcnNlcF9vcmlnID0gbmFtZXNwYWNlLT5oaWVyX3NlcDsK
KworICAgIG5hbWVzcGFjZS0+aGllcl9zZXA9Jy8nOworICAgIG1ib3huYW1lX2hpZXJzZXBfdG9p
bnRlcm5hbChuYW1lc3BhY2UsIHVzZXJpZCwKKwkJCQljb25maWdfdmlydGRvbWFpbnMgPworCQkJ
CXN0cmNzcG4odXNlcmlkLCAiQCIpIDogMCk7CisgICAgbmFtZXNwYWNlLT5oaWVyX3NlcD1oaWVy
c2VwX29yaWc7Cit9CisKIC8qCiAgKiBBdXRvY3JlYXRlIEluYm94IGFuZCBzdWJmb2xkZXJzIHVw
b24gbG9naW4KICAqLwpAQCAtMTg4MSw5ICsxODk3LDcgQEAKICAgICB9CiAKICAgICAvKiBUcmFu
c2xhdGUgYW55IHNlcGFyYXRvcnMgaW4gdXNlcmlkICovCi0gICAgbWJveG5hbWVfaGllcnNlcF90
b2ludGVybmFsKCZpbWFwZF9uYW1lc3BhY2UsIGltYXBkX3VzZXJpZCwKLQkJCQljb25maWdfdmly
dGRvbWFpbnMgPwotCQkJCXN0cmNzcG4oaW1hcGRfdXNlcmlkLCAiQCIpIDogMCk7CisgICAgdXNl
cmlkX3RvaW50ZXJuYWwoJmltYXBkX25hbWVzcGFjZSwgaW1hcGRfdXNlcmlkKTsKIAogICAgIGZy
ZWVidWYoJnBhc3N3ZGJ1Zik7CiAKQEAgLTIwMzAsOSArMjA0NCw3IEBACiAgICAgfQogCiAgICAg
LyogVHJhbnNsYXRlIGFueSBzZXBhcmF0b3JzIGluIHVzZXJpZCAqLwotICAgIG1ib3huYW1lX2hp
ZXJzZXBfdG9pbnRlcm5hbCgmaW1hcGRfbmFtZXNwYWNlLCBpbWFwZF91c2VyaWQsCi0JCQkJY29u
ZmlnX3ZpcnRkb21haW5zID8KLQkJCQlzdHJjc3BuKGltYXBkX3VzZXJpZCwgIkAiKSA6IDApOwor
ICAgIHVzZXJpZF90b2ludGVybmFsKCZpbWFwZF9uYW1lc3BhY2UsIGltYXBkX3VzZXJpZCk7CiAK
ICAgICBhdXRvY3JlYXRlX2luYm94KCk7CiAKQEAgLTM3NzYsMTYgKzM3ODgsMjIgQEAKIH0JCiAK
IC8qIENhbGxiYWNrIGZvciB1c2UgYnkgY21kX2RlbGV0ZSAqLworLyogbmFtZSBpcyBhbiBleHRl
cm5hbCBuYW1lICovCiBzdGF0aWMgaW50IGRlbG1ib3goY2hhciAqbmFtZSwKIAkJICAgaW50IG1h
dGNobGVuIF9fYXR0cmlidXRlX18oKHVudXNlZCkpLAogCQkgICBpbnQgbWF5Y3JlYXRlIF9fYXR0
cmlidXRlX18oKHVudXNlZCkpLAogCQkgICB2b2lkICpyb2NrIF9fYXR0cmlidXRlX18oKHVudXNl
ZCkpKQogewogICAgIGludCByOworICAgIGNoYXIgaW50bmFtZVtNQVhfTUFJTEJPWF9OQU1FKzFd
OworCisgICAgciA9ICgqaW1hcGRfbmFtZXNwYWNlLm1ib3huYW1lX3RvaW50ZXJuYWwpKCZpbWFw
ZF9uYW1lc3BhY2UsIG5hbWUsCisJCQkJCSAgICAgICBpbWFwZF91c2VyaWQsIGludG5hbWUpOwog
Ci0gICAgciA9IG1ib3hsaXN0X2RlbGV0ZW1haWxib3gobmFtZSwgaW1hcGRfdXNlcmlzYWRtaW4s
Ci0JCQkgICAgICAgaW1hcGRfdXNlcmlkLCBpbWFwZF9hdXRoc3RhdGUsCi0JCQkgICAgICAgMCwg
MCwgMCwgMSk7CisgICAgaWYoIXIpCisJciA9IG1ib3hsaXN0X2RlbGV0ZW1haWxib3goaW50bmFt
ZSwgaW1hcGRfdXNlcmlzYWRtaW4sCisJCQkJICAgaW1hcGRfdXNlcmlkLCBpbWFwZF9hdXRoc3Rh
dGUsCisJCQkJICAgMCwgMCwgMCwgMSk7CiAgICAgCiAgICAgaWYocikgewogCXByb3RfcHJpbnRm
KGltYXBkX291dCwgIiogTk8gZGVsZXRlICVzOiAlc1xyXG4iLApAQCAtMzgyOCwxNiArMzg0Niwy
MyBAQAogICAgIGlmICghciAmJiAhbG9jYWxvbmx5ICYmCiAJIXN0cm5jbXAobWFpbGJveG5hbWUr
ZG9tYWlubGVuLCAidXNlci4iLCA1KSAmJgogCSFzdHJjaHIobWFpbGJveG5hbWUrZG9tYWlubGVu
KzUsICcuJykpIHsKKwljaGFyIG5hbWVfY29weVtNQVhfTUFJTEJPWF9OQU1FKzFdOworIAlpbnQg
bmFtZV9sZW4gPSBzdHJsZW4obmFtZSk7CiAgCWludCBtYWlsYm94bmFtZV9sZW4gPSBzdHJsZW4o
bWFpbGJveG5hbWUpOwogCisJbWVtY3B5KG5hbWVfY29weSwgbmFtZSwgbmFtZV9sZW4pOwogIAkv
KiBJZiB3ZSBhcmVuJ3QgdG9vIGNsb3NlIHRvIE1BWF9NQUlMQk9YX05BTUUsIGFwcGVuZCAuKiAq
LwotIAlwID0gbWFpbGJveG5hbWUgKyBtYWlsYm94bmFtZV9sZW47IC8qIGVuZCBvZiBtYWlsYm94
bmFtZSAqLwotIAlpZiAobWFpbGJveG5hbWVfbGVuIDwgc2l6ZW9mKG1haWxib3huYW1lKSAtIDMp
IHsKLSAJICAgIHN0cmNweShwLCAiLioiKTsKLSAJfQorIAlwID0gbmFtZV9jb3B5ICsgbmFtZV9s
ZW47IC8qIGVuZCBvZiBuYW1lICovCisgCWlmIChuYW1lX2xlbiA8IHNpemVvZihuYW1lX2NvcHkp
IC0gMykgeworCSAgICAqcD1pbWFwZF9uYW1lc3BhY2UuaGllcl9zZXA7CisJICAgIHBbMV09Jyon
OworCSAgICBwWzJdPTA7CisJfQorCWVsc2UKKwkgICAgKnA9MDsKIAkKLQkvKiBidWlsZCBhIGxp
c3Qgb2YgbWFpbGJveGVzIC0gd2UncmUgdXNpbmcgaW50ZXJuYWwgbmFtZXMgaGVyZSAqLwotCW1i
b3hsaXN0X2ZpbmRhbGwoTlVMTCwgbWFpbGJveG5hbWUsIGltYXBkX3VzZXJpc2FkbWluLCBpbWFw
ZF91c2VyaWQsCisJLyogYnVpbGQgYSBsaXN0IG9mIG1haWxib3hlcyAtIHdlJ3JlIHVzaW5nIGV4
dGVybmFsIG5hbWVzIGhlcmUgKi8KKwltYm94bGlzdF9maW5kYWxsKCZpbWFwZF9uYW1lc3BhY2Us
IG5hbWVfY29weSwgaW1hcGRfdXNlcmlzYWRtaW4sIGltYXBkX3VzZXJpZCwKIAkJCSBpbWFwZF9h
dXRoc3RhdGUsIGRlbG1ib3gsIE5VTEwpOwogCiAJLyogdGFrZSBjYXJlIG9mIGRlbGV0aW5nIEFD
THMsIHN1YnNjcmlwdGlvbnMsIHNlZW4gc3RhdGUgYW5kIHF1b3RhcyAqLwpAQCAtMzg3OSwxMyAr
MzkwNCwxNCBAQAogfTsKIAogLyogQ2FsbGJhY2sgZm9yIHVzZSBieSBjbWRfcmVuYW1lICovCisv
KiAnbmFtZScgaXMgYW4gZXh0ZXJuYWwgbWFpbGJveCBuYW1lISAqLwogc3RhdGljIGludCByZW5t
Ym94KGNoYXIgKm5hbWUsCiAJCSAgIGludCBtYXRjaGxlbiBfX2F0dHJpYnV0ZV9fKCh1bnVzZWQp
KSwKIAkJICAgaW50IG1heWNyZWF0ZSBfX2F0dHJpYnV0ZV9fKCh1bnVzZWQpKSwKIAkJICAgdm9p
ZCAqcm9jaykKIHsKLSAgICBjaGFyIG9sZGV4dG5hbWVbTUFYX01BSUxCT1hfTkFNRSsxXTsKLSAg
ICBjaGFyIG5ld2V4dG5hbWVbTUFYX01BSUxCT1hfTkFNRSsxXTsKKyAgICBjaGFyIG9sZGludG5h
bWVbTUFYX01BSUxCT1hfTkFNRSsxXTsKKyAgICBjaGFyIG5ld2ludG5hbWVbTUFYX01BSUxCT1hf
TkFNRSsxXTsKICAgICBzdHJ1Y3QgcmVucm9jayAqdGV4dCA9IChzdHJ1Y3QgcmVucm9jayAqKXJv
Y2s7CiAgICAgaW50IHI7CiAKQEAgLTM4OTQsMzYgKzM5MjAsMzkgQEAKIAogICAgIHN0cmNweSh0
ZXh0LT5uZXdtYWlsYm94bmFtZSArIHRleHQtPm5sLCBuYW1lICsgdGV4dC0+b2wpOwogCi0gICAg
ciA9IG1ib3hsaXN0X3JlbmFtZW1haWxib3gobmFtZSwgdGV4dC0+bmV3bWFpbGJveG5hbWUsCisg
ICAgaWYoKCppbWFwZF9uYW1lc3BhY2UubWJveG5hbWVfdG9pbnRlcm5hbCkoJmltYXBkX25hbWVz
cGFjZSwKKwkJCQkJICAgICAgdGV4dC0+bmV3bWFpbGJveG5hbWUsCisJCQkJCSAgICAgIGltYXBk
X3VzZXJpZCwgbmV3aW50bmFtZSkpCisJcmV0dXJuIDA7CisKKyAgICBpZigoKmltYXBkX25hbWVz
cGFjZS5tYm94bmFtZV90b2ludGVybmFsKSgmaW1hcGRfbmFtZXNwYWNlLAorCQkJCQkgICAgICBu
YW1lLAorCQkJCQkgICAgICBpbWFwZF91c2VyaWQsIG9sZGludG5hbWUpKQorCXJldHVybiAwOwor
CisgICAgciA9IG1ib3hsaXN0X3JlbmFtZW1haWxib3gob2xkaW50bmFtZSwgbmV3aW50bmFtZSwK
IAkJCSAgICAgICB0ZXh0LT5wYXJ0aXRpb24sCiAJCQkgICAgICAgMSwgaW1hcGRfdXNlcmlkLCBp
bWFwZF9hdXRoc3RhdGUpOwogICAgIAotICAgICgqaW1hcGRfbmFtZXNwYWNlLm1ib3huYW1lX3Rv
ZXh0ZXJuYWwpKCZpbWFwZF9uYW1lc3BhY2UsCi0JCQkJCSAgIG5hbWUsCi0JCQkJCSAgIGltYXBk
X3VzZXJpZCwgb2xkZXh0bmFtZSk7Ci0gICAgKCppbWFwZF9uYW1lc3BhY2UubWJveG5hbWVfdG9l
eHRlcm5hbCkoJmltYXBkX25hbWVzcGFjZSwKLQkJCQkJICAgdGV4dC0+bmV3bWFpbGJveG5hbWUs
Ci0JCQkJCSAgIGltYXBkX3VzZXJpZCwgbmV3ZXh0bmFtZSk7Ci0KICAgICBpZihyKSB7CiAJcHJv
dF9wcmludGYoaW1hcGRfb3V0LCAiKiBOTyByZW5hbWUgJXMgJXM6ICVzXHJcbiIsCi0JCSAgICBv
bGRleHRuYW1lLCBuZXdleHRuYW1lLCBlcnJvcl9tZXNzYWdlKHIpKTsKKwkJICAgIG5hbWUsIHRl
eHQtPm5ld21haWxib3huYW1lLCBlcnJvcl9tZXNzYWdlKHIpKTsKIAlpZiAoUkVOQU1FX1NUT1Bf
T05fRVJST1IpIHJldHVybiByOwogICAgIH0gZWxzZSB7CiAJLyogSWYgd2UncmUgcmVuYW1pbmcg
YSB1c2VyLCBjaGFuZ2UgcXVvdGFyb290IGFuZCBBQ0wgKi8KIAlpZiAodGV4dC0+cmVuYW1lX3Vz
ZXIpIHsKLQkgICAgdXNlcl9jb3B5cXVvdGFyb290KG5hbWUsIHRleHQtPm5ld21haWxib3huYW1l
KTsKLQkgICAgdXNlcl9yZW5hbWVhY2wodGV4dC0+bmV3bWFpbGJveG5hbWUsCisJICAgIHVzZXJf
Y29weXF1b3Rhcm9vdChvbGRpbnRuYW1lLCBuZXdpbnRuYW1lKTsKKwkgICAgdXNlcl9yZW5hbWVh
Y2wobmV3aW50bmFtZSwKIAkJCSAgIHRleHQtPmFjbF9vbGR1c2VyLCB0ZXh0LT5hY2xfbmV3dXNl
cik7CiAJfQogCiAJLyogUmVuYW1lIG1haWxib3ggYW5ub3RhdGlvbnMgKi8KLQlhbm5vdGF0ZW1v
cmVfcmVuYW1lKG5hbWUsIHRleHQtPm5ld21haWxib3huYW1lLAorCWFubm90YXRlbW9yZV9yZW5h
bWUob2xkaW50bmFtZSwgbmV3aW50bmFtZSwKIAkJCSAgICB0ZXh0LT5yZW5hbWVfdXNlciA/IHRl
eHQtPm9sZHVzZXIgOiBOVUxMLAogCQkJICAgIHRleHQtPm5ld3VzZXIpOwogCQogCXByb3RfcHJp
bnRmKGltYXBkX291dCwgIiogT0sgcmVuYW1lICVzICVzXHJcbiIsCi0JCSAgICBvbGRleHRuYW1l
LCBuZXdleHRuYW1lKTsKKwkJICAgIG5hbWUsIHRleHQtPm5ld21haWxib3huYW1lKTsKICAgICB9
CiAKICAgICBwcm90X2ZsdXNoKGltYXBkX291dCk7CkBAIC0zOTM4LDEwICszOTY3LDggQEAKIAkJ
Y2hhciAqb2xkbmFtZSwgY2hhciAqbmV3bmFtZSwgY2hhciAqcGFydGl0aW9uKQogewogICAgIGlu
dCByID0gMDsKLSAgICBjaGFyIG9sZG1haWxib3huYW1lW01BWF9NQUlMQk9YX05BTUUrM107Ci0g
ICAgY2hhciBuZXdtYWlsYm94bmFtZVtNQVhfTUFJTEJPWF9OQU1FKzJdOwotICAgIGNoYXIgb2xk
ZXh0bmFtZVtNQVhfTUFJTEJPWF9OQU1FKzFdOwotICAgIGNoYXIgbmV3ZXh0bmFtZVtNQVhfTUFJ
TEJPWF9OQU1FKzFdOworICAgIGNoYXIgb2xkbWFpbGJveG5hbWVbTUFYX01BSUxCT1hfTkFNRSsx
XTsKKyAgICBjaGFyIG5ld21haWxib3huYW1lW01BWF9NQUlMQk9YX05BTUUrMV07CiAgICAgaW50
IG9tbGVuLCBubWxlbjsKICAgICBjaGFyICpwOwogICAgIGludCByZWN1cnNpdmVfcmVuYW1lID0g
MTsKQEAgLTQwNDksMjYgKzQwNzYsMjQgQEAKIAogICAgIC8qIHJlbmFtZSBhbGwgbWFpbGJveGVz
IG1hdGNoaW5nIHRoaXMgKi8KICAgICBpZiAoIXIgJiYgcmVjdXJzaXZlX3JlbmFtZSkgeworCWNo
YXIgb2xkZXh0bmFtZVtNQVhfTUFJTEJPWF9OQU1FKzNdOworCWNoYXIgbmV3ZXh0bmFtZVtNQVhf
TUFJTEJPWF9OQU1FKzJdOworCWludCB0bXBsZW47CiAJc3RydWN0IHJlbnJvY2sgcm9jazsKLQlp
bnQgb2wgPSBvbWxlbiArIDE7Ci0JaW50IG5sID0gbm1sZW4gKyAxOwotCi0JKCppbWFwZF9uYW1l
c3BhY2UubWJveG5hbWVfdG9leHRlcm5hbCkoJmltYXBkX25hbWVzcGFjZSwKLQkJCQkJICAgICAg
IG9sZG1haWxib3huYW1lLAotCQkJCQkgICAgICAgaW1hcGRfdXNlcmlkLCBvbGRleHRuYW1lKTsK
LQkoKmltYXBkX25hbWVzcGFjZS5tYm94bmFtZV90b2V4dGVybmFsKSgmaW1hcGRfbmFtZXNwYWNl
LAotCQkJCQkgICAgICAgbmV3bWFpbGJveG5hbWUsCi0JCQkJCSAgICAgICBpbWFwZF91c2VyaWQs
IG5ld2V4dG5hbWUpOworCWludCBvbDsKKwlpbnQgbmw7CiAKKwlvbCA9IHN0cmxlbihvbGRuYW1l
KSsxOworCW5sID0gc3RybGVuKG5ld25hbWUpKzE7CiAJcHJvdF9wcmludGYoaW1hcGRfb3V0LCAi
KiBPSyByZW5hbWUgJXMgJXNcclxuIiwKLQkJICAgIG9sZGV4dG5hbWUsIG5ld2V4dG5hbWUpOwor
CQkgICAgb2xkbmFtZSwgbmV3bmFtZSk7CiAJcHJvdF9mbHVzaChpbWFwZF9vdXQpOwogCi0Jc3Ry
Y2F0KG9sZG1haWxib3huYW1lLCAiLioiKTsKLQlzdHJjYXQobmV3bWFpbGJveG5hbWUsICIuIik7
CisJc25wcmludGYob2xkZXh0bmFtZSwgTUFYX01BSUxCT1hfTkFNRSszLCAiJXMlYyoiLCBvbGRu
YW1lLCBpbWFwZF9uYW1lc3BhY2UuaGllcl9zZXApOworCXNucHJpbnRmKG5ld2V4dG5hbWUsIE1B
WF9NQUlMQk9YX05BTUUrMiwgIiVzJWMiLCBuZXduYW1lLCBpbWFwZF9uYW1lc3BhY2UuaGllcl9z
ZXApOwogCiAJLyogc2V0dXAgdGhlIHJvY2sgKi8KLQlyb2NrLm5ld21haWxib3huYW1lID0gbmV3
bWFpbGJveG5hbWU7CisJcm9jay5uZXdtYWlsYm94bmFtZSA9IG5ld2V4dG5hbWU7CiAJcm9jay5v
bCA9IG9sOwogCXJvY2submwgPSBubDsKIAlyb2NrLm9sZHVzZXIgPSBvbGR1c2VyOwpAQCAtNDA3
OCw5ICs0MTAzLDggQEAKIAlyb2NrLnBhcnRpdGlvbiA9IHBhcnRpdGlvbjsKIAlyb2NrLnJlbmFt
ZV91c2VyID0gcmVuYW1lX3VzZXI7CiAJCi0JLyogYWRkIHN1Ym1haWxib3hlczsgd2UgcHJldGVu
ZCB3ZSdyZSBhbiBhZG1pbiBzaW5jZSB3ZSBzdWNjZXNzZnVsbHkKLQkgICByZW5hbWVkIHRoZSBw
YXJlbnQgLSB3ZSdyZSB1c2luZyBpbnRlcm5hbCBuYW1lcyBoZXJlICovCi0JciA9IG1ib3hsaXN0
X2ZpbmRhbGwoTlVMTCwgb2xkbWFpbGJveG5hbWUsIDEsIGltYXBkX3VzZXJpZCwKKwkvKiBhZGQg
c3VibWFpbGJveGVzOyB1c2luZyBleHRlcm5hbCBuYW1lc3BhY2UgaGVyZSAqLworCXIgPSBpbWFw
ZF9uYW1lc3BhY2UubWJveGxpc3RfZmluZGFsbCgmaW1hcGRfbmFtZXNwYWNlLCBvbGRleHRuYW1l
LCAxLCBpbWFwZF91c2VyaWQsCiAJCQkgICAgIGltYXBkX2F1dGhzdGF0ZSwgcmVubWJveCwgJnJv
Y2spOwogICAgIH0KIApAQCAtNDM0NiwxMSArNDM3MCw2IEBACiAJICAgIHBhdHRlcm4gPSBidWY7
CiAJfQogCi0JLyogVHJhbnNsYXRlIGFueSBzZXBhcmF0b3JzIGluIHBhdHRlcm4gKi8KLQltYm94
bmFtZV9oaWVyc2VwX3RvaW50ZXJuYWwoJmltYXBkX25hbWVzcGFjZSwgcGF0dGVybiwKLQkJCQkg
ICAgY29uZmlnX3ZpcnRkb21haW5zID8KLQkJCQkgICAgc3RyY3NwbihwYXR0ZXJuLCAiQCIpIDog
MCk7Ci0KIAkvKiBDaGVjayB0byBzZWUgaWYgd2Ugc2hvdWxkIG9ubHkgbGlzdCB0aGUgcGVyc29u
YWwgbmFtZXNwYWNlICovCiAJaWYgKCFzdHJjbXAocGF0dGVybiwgIioiKQogCSAgICAmJiBjb25m
aWdfZ2V0c3dpdGNoKElNQVBPUFRfRk9PTFNUVVBJRENMSUVOVFMpKSB7CkBAIC01MTEyLDE1ICs1
MTMxLDIwIEBACiAJCQkgdm9pZCAqcm9jaykKIHsKICAgICBpbnQqIHNhd29uZSA9IChpbnQqKSBy
b2NrOworICAgIGNoYXIgaW50bmFtZVtNQVhfTUFJTEJPWF9OQU1FKzFdOwogCiAgICAgaWYgKCFu
YW1lKSB7CiAJcmV0dXJuIDA7CiAgICAgfQogICAgIAotICAgIGlmICghKHN0cm5jbXAobmFtZSwg
IklOQk9YLiIsIDYpKSkgeworICAgIGlmKCgqaW1hcGRfbmFtZXNwYWNlLm1ib3huYW1lX3RvaW50
ZXJuYWwpKCZpbWFwZF9uYW1lc3BhY2UsIG5hbWUsCisJCQkJCSAgICAgIGltYXBkX3VzZXJpZCwg
aW50bmFtZSkpCisJcmV0dXJuIDA7CisKKyAgICBpZiAoIShzdHJuY21wKGludG5hbWUsICJJTkJP
WC4iLCA2KSkpIHsKIAkvKiBUaGUgdXNlciBoYXMgYSAicGVyc29uYWwiIG5hbWVzcGFjZS4gKi8K
IAlzYXdvbmVbTkFNRVNQQUNFX0lOQk9YXSA9IDE7Ci0gICAgfSBlbHNlIGlmIChtYm94bmFtZV9p
c3VzZXJtYWlsYm94KG5hbWUsIDApKSB7CisgICAgfSBlbHNlIGlmIChtYm94bmFtZV9pc3VzZXJt
YWlsYm94KGludG5hbWUsIDApKSB7CiAJLyogVGhlIHVzZXIgY2FuIHNlZSB0aGUgIm90aGVyIHVz
ZXJzIiBuYW1lc3BhY2UuICovCiAJc2F3b25lW05BTUVTUEFDRV9VU0VSXSA9IDE7CiAgICAgfSBl
bHNlIHsKQEAgLTUxNTcsOSArNTE4MSwxMCBAQAogICAgIH0gZWxzZSB7CiAJcGF0dGVybiA9IHhz
dHJkdXAoIiUiKTsKIAkvKiBub3cgZmluZCBhbGwgdGhlIGV4Y2l0aW5nIHRvcGxldmVsIG5hbWVz
cGFjZXMgLQotCSAqIHdlJ3JlIHVzaW5nIGludGVybmFsIG5hbWVzIGhlcmUKKwkgKiB3ZSdyZSB1
c2luZyBleHRlcm5hbCBuYW1lcyBoZXJlCiAJICovCi0JbWJveGxpc3RfZmluZGFsbChOVUxMLCBw
YXR0ZXJuLCBpbWFwZF91c2VyaXNhZG1pbiwgaW1hcGRfdXNlcmlkLAorCW1ib3hsaXN0X2ZpbmRh
bGwoJmltYXBkX25hbWVzcGFjZSwgcGF0dGVybiwgaW1hcGRfdXNlcmlzYWRtaW4sCisJCQkgaW1h
cGRfdXNlcmlkLCAKIAkJCSBpbWFwZF9hdXRoc3RhdGUsIG5hbWVzcGFjZWRhdGEsICh2b2lkKikg
c2F3b25lKTsKIAlmcmVlKHBhdHRlcm4pOwogICAgIH0KQEAgLTY1NDMsNyArNjU2OCw3IEBACiAg
ICAgc3RydWN0IGJhY2tlbmQgKmJlOwogfTsKIAotc3RhdGljIGludCB4ZmVyX3VzZXJfY2IoY2hh
ciAqbmFtZSwKK3N0YXRpYyBpbnQgeGZlcl91c2VyX2NiKGNoYXIgKmV4dGVybmFsbmFtZSwKIAkJ
CWludCBtYXRjaGxlbiBfX2F0dHJpYnV0ZV9fKCh1bnVzZWQpKSwKIAkJCWludCBtYXljcmVhdGUg
X19hdHRyaWJ1dGVfXygodW51c2VkKSksCiAJCQl2b2lkICpyb2NrKSAKQEAgLTY1NTIsMTIgKzY1
NzcsMTcgQEAKICAgICBjaGFyICp0b3NlcnZlciA9ICgoc3RydWN0IHhmZXJfdXNlcl9yb2NrICop
cm9jayktPnRvc2VydmVyOwogICAgIGNoYXIgKnRvcGFydCA9ICgoc3RydWN0IHhmZXJfdXNlcl9y
b2NrICopcm9jayktPnRvcGFydDsKICAgICBzdHJ1Y3QgYmFja2VuZCAqYmUgPSAoKHN0cnVjdCB4
ZmVyX3VzZXJfcm9jayAqKXJvY2spLT5iZTsKLSAgICBjaGFyIGV4dGVybmFsbmFtZVtNQVhfTUFJ
TEJPWF9OQU1FKzFdOworICAgIGNoYXIgbmFtZVtNQVhfTUFJTEJPWF9OQU1FKzFdOwogICAgIGlu
dCBtYmZsYWdzOwogICAgIGludCByID0gMDsKICAgICBjaGFyICppbnBhdGgsICppbnBhcnQsICpp
bmFjbDsKICAgICBjaGFyICpwYXRoID0gTlVMTCwgKnBhcnQgPSBOVUxMLCAqYWNsID0gTlVMTDsK
IAorICAgIHIgPSAoKmltYXBkX25hbWVzcGFjZS5tYm94bmFtZV90b2ludGVybmFsKSgmaW1hcGRf
bmFtZXNwYWNlLAorCQkJCQkgICAgICAgZXh0ZXJuYWxuYW1lLAorCQkJCQkgICAgICAgaW1hcGRf
dXNlcmlkLAorCQkJCQkgICAgICAgbmFtZSk7CisKICAgICBpZiAoIXIpIHsKIAkvKiBOT1RFOiBO
T1QgbWxvb2t1cCgpIGJlY2F1c2Ugd2UgZG9uJ3Qgd2FudCB0byBpc3N1ZSBhIHJlZmVycmFsICov
CiAJLyogeHh4IGJ1dCB3aGF0IGhhcHBlbnMgaWYgdGhleSBhcmUgcmVtb3RlCkBAIC02NTcwLDE2
ICs2NjAwLDYgQEAKIAlwYXRoID0geHN0cmR1cChpbnBhdGgpOwogCXBhcnQgPSB4c3RyZHVwKGlu
cGFydCk7CiAJYWNsID0geHN0cmR1cChpbmFjbCk7Ci0gICAgfQotCi0gICAgaWYgKCFyKSB7Ci0J
ciA9ICgqaW1hcGRfbmFtZXNwYWNlLm1ib3huYW1lX3RvZXh0ZXJuYWwpKCZpbWFwZF9uYW1lc3Bh
Y2UsCi0JCQkJCQkgICBuYW1lLAotCQkJCQkJICAgaW1hcGRfdXNlcmlkLAotCQkJCQkJICAgZXh0
ZXJuYWxuYW1lKTsKLSAgICB9Ci0KLSAgICBpZighcikgewogCXIgPSBkb194ZmVyX3NpbmdsZSh0
b3NlcnZlciwgdG9wYXJ0LCBleHRlcm5hbG5hbWUsIG5hbWUsIG1iZmxhZ3MsCiAJCQkgICBwYXRo
LCBwYXJ0LCBhY2wsIDAsIG11cGRhdGVfaCwgYmUpOwogICAgIH0KQEAgLTY3MTgsNyArNjczOCw3
IEBACiAJfQogCiAKLQkvKiByZWN1cnNpdmVseSBtb3ZlIGFsbCBzdWItbWFpbGJveGVzLCB1c2lu
ZyBpbnRlcm5hbCBuYW1lcyAqLworCS8qIHJlY3Vyc2l2ZWx5IG1vdmUgYWxsIHN1Yi1tYWlsYm94
ZXMsIHVzaW5nIGV4dGVybmFsIG5hbWVzICovCiAJaWYoIXIpIHsKIAkgICAgc3RydWN0IHhmZXJf
dXNlcl9yb2NrIHJvY2s7CiAKQEAgLTY3MjgsNyArNjc0OCw3IEBACiAJICAgIHJvY2suYmUgPSBi
ZTsKIAogCSAgICBzbnByaW50ZihidWYsIHNpemVvZihidWYpLCAiJXMuKiIsIG1haWxib3huYW1l
KTsKLQkgICAgciA9IG1ib3hsaXN0X2ZpbmRhbGwoTlVMTCwgYnVmLCAxLCBpbWFwZF91c2VyaWQs
CisJICAgIHIgPSBtYm94bGlzdF9maW5kYWxsKCZpbWFwZF9uYW1lc3BhY2UsIGJ1ZiwgMSwgaW1h
cGRfdXNlcmlkLAogCQkJCSBpbWFwZF9hdXRoc3RhdGUsIHhmZXJfdXNlcl9jYiwKIAkJCQkgJnJv
Y2spOwogCX0KQEAgLTc0MjAsMTcgKzc0NDAsMTkgQEAKIC8qCiAgKiBJc3N1ZSBhIExJU1Qgb3Ig
TFNVQiB1bnRhZ2dlZCByZXNwb25zZQogICovCisvKiBUaGUgJ25hbWUnIHZhcmlhYmxlIG5vdyBp
cyBhbiBleHRlcm5hbCBuYW1lISAvLyBzb3JjZXJlciAqLwogc3RhdGljIHZvaWQgbXN0cmluZ2Rh
dGEoY2hhciAqY21kLCBjaGFyICpuYW1lLCBpbnQgbWF0Y2hsZW4sIGludCBtYXljcmVhdGUsCiAJ
CQlpbnQgbGlzdG9wdHMpCiB7Ci0gICAgc3RhdGljIGNoYXIgbGFzdG5hbWVbTUFYX01BSUxCT1hf
UEFUSCsxXTsKKyAgICBzdGF0aWMgY2hhciBsYXN0bmFtZVtNQVhfTUFJTEJPWF9QQVRIKzFdPSIi
OworICAgIGNoYXIgaW50bmFtZVtNQVhfTUFJTEJPWF9QQVRIKzFdOwogICAgIHN0YXRpYyBpbnQg
bGFzdG5hbWVkZWxheWVkID0gMDsKICAgICBzdGF0aWMgaW50IGxhc3RuYW1lbm9pbmZlcmlvcnMg
PSAwOwogICAgIHN0YXRpYyBpbnQgbm9uZXhpc3RlbnQgPSAwOwogICAgIHN0YXRpYyBpbnQgc2F3
dXNlciA9IDA7CiAgICAgaW50IGxhc3RuYW1laGFzc3ViID0gMDsKLSAgICBpbnQgYywgbWJ0eXBl
OwotICAgIGNoYXIgbWJveG5hbWVbTUFYX01BSUxCT1hfUEFUSCsxXTsKKyAgICBpbnQgbWJ0eXBl
OworICAgIGludCB1c2VycHJlZml4bGVuOwogCiAgICAgLyogV2UgaGF2ZSB0byByZXNldCB0aGUg
c2F3dXNlciBmbGFnIGJlZm9yZSBlYWNoIGxpc3QgY29tbWFuZC4KICAgICAgKiBIYW5kbGUgaXQg
YXMgYSBkaXJ0eSBoYWNrLgpAQCAtNzQ0NSw3ICs3NDY3LDcgQEAKICAgICBpZiAobGFzdG5hbWVk
ZWxheWVkKSB7CiAJLyogQ2hlY2sgaWYgbGFzdG5hbWUgaGFzIGNoaWxkcmVuICovCiAJaWYgKG5h
bWUgJiYgc3RybmNtcChsYXN0bmFtZSwgbmFtZSwgc3RybGVuKGxhc3RuYW1lKSkgPT0gMCAmJgot
CSAgICBuYW1lW3N0cmxlbihsYXN0bmFtZSldID09ICcuJykgeworCSAgICBuYW1lW3N0cmxlbihs
YXN0bmFtZSldID09IGltYXBkX25hbWVzcGFjZS5oaWVyX3NlcCkgewogCSAgICBsYXN0bmFtZWhh
c3N1YiA9IDE7CiAJfQogCXByb3RfcHJpbnRmKGltYXBkX291dCwgIiogJXMgKCIsIGNtZCk7CkBA
IC03NDcwLDkgKzc0OTIsNyBAQAogCX0KIAlwcm90X3ByaW50ZihpbWFwZF9vdXQsICIpIFwiJWNc
IiAiLCBpbWFwZF9uYW1lc3BhY2UuaGllcl9zZXApOwogCQkgICAgCi0JKCppbWFwZF9uYW1lc3Bh
Y2UubWJveG5hbWVfdG9leHRlcm5hbCkoJmltYXBkX25hbWVzcGFjZSwgbGFzdG5hbWUsCi0JCQkJ
CSAgICAgICBpbWFwZF91c2VyaWQsIG1ib3huYW1lKTsKLQlwcmludHN0cmluZyhtYm94bmFtZSk7
CisJcHJpbnRzdHJpbmcobGFzdG5hbWUpOwogCXByb3RfcHJpbnRmKGltYXBkX291dCwgIlxyXG4i
KTsKIAlsYXN0bmFtZWRlbGF5ZWQgPSBsYXN0bmFtZW5vaW5mZXJpb3JzID0gbm9uZXhpc3RlbnQg
PSAwOwogICAgIH0KQEAgLTc0ODYsNyArNzUwNiw3IEBACiAgICAgLyogU3VwcHJlc3MgYW55IG91
dHB1dCBvZiBhIHBhcnRpYWwgbWF0Y2ggKi8KICAgICBpZiAoKG5hbWVbbWF0Y2hsZW5dCiAJICYm
IHN0cm5jbXAobGFzdG5hbWUsIG5hbWUsIG1hdGNobGVuKSA9PSAwCi0JICYmIChsYXN0bmFtZVtt
YXRjaGxlbl0gPT0gJ1wwJyB8fCBsYXN0bmFtZVttYXRjaGxlbl0gPT0gJy4nKSkpIHsKKwkgJiYg
KGxhc3RuYW1lW21hdGNobGVuXSA9PSAnXDAnIHx8IGxhc3RuYW1lW21hdGNobGVuXSA9PSBpbWFw
ZF9uYW1lc3BhY2UuaGllcl9zZXApKSkgewogCXJldHVybjsKICAgICB9CiAJCkBAIC03NDk0LDI4
ICs3NTE0LDI1IEBACiAgICAgICogV2UgY2FuIGdldCBhIHBhcnRpYWwgbWF0Y2ggZm9yICJ1c2Vy
IiBtdWx0aXBsZSB0aW1lcyB3aXRoCiAgICAgICogb3RoZXIgbWF0Y2hlcyBpbmJldHdlZW4uICBI
YW5kbGUgaXQgYXMgYSBzcGVjaWFsIGNhc2UKICAgICAgKi8KLSAgICBpZiAobWF0Y2hsZW4gPT0g
NCAmJiBzdHJuY2FzZWNtcChuYW1lLCAidXNlciIsIDQpID09IDApIHsKKyAgICB1c2VycHJlZml4
bGVuID0gc3RybGVuKGltYXBkX25hbWVzcGFjZS5wcmVmaXhbTkFNRVNQQUNFX1VTRVJdKSAtIDE7
CisgICAgaWYgKG1hdGNobGVuID09IHVzZXJwcmVmaXhsZW4gJiYgc3RybmNtcChuYW1lLCBpbWFw
ZF9uYW1lc3BhY2UucHJlZml4W05BTUVTUEFDRV9VU0VSXSwgdXNlcnByZWZpeGxlbikgPT0gMCkg
ewogCWlmIChzYXd1c2VyKSByZXR1cm47CiAJc2F3dXNlciA9IDE7CiAgICAgfQogCiAgICAgc3Ry
bGNweShsYXN0bmFtZSwgbmFtZSwgc2l6ZW9mKGxhc3RuYW1lKSk7CiAgICAgbGFzdG5hbWVbbWF0
Y2hsZW5dID0gJ1wwJzsKLSAgICBub25leGlzdGVudCA9IDA7CiAKICAgICAvKiBOb3cgd2UgbmVl
ZCB0byBzZWUgaWYgdGhpcyBtYWlsYm94IGV4aXN0cyAqLwotICAgIC8qIGZpcnN0IGNvbnZlcnQg
IklOQk9YIiB0byAidXNlci48dXNlcmlkPiIgKi8KLSAgICBpZiAoIXN0cm5jYXNlY21wKGxhc3Ru
YW1lLCAiaW5ib3giLCA1KSkgewotCSgqaW1hcGRfbmFtZXNwYWNlLm1ib3huYW1lX3RvaW50ZXJu
YWwpKCZpbWFwZF9uYW1lc3BhY2UsICJJTkJPWCIsCi0JCQkJCSAgICAgICBpbWFwZF91c2VyaWQs
IG1ib3huYW1lKTsKLQlzdHJsY2F0KG1ib3huYW1lLCBsYXN0bmFtZSs1LCBzaXplb2YobWJveG5h
bWUpKTsKLSAgICB9CisKKyAgICBpZigoKmltYXBkX25hbWVzcGFjZS5tYm94bmFtZV90b2ludGVy
bmFsKSgmaW1hcGRfbmFtZXNwYWNlLCBsYXN0bmFtZSwKKwkJCQkJICAgICAgaW1hcGRfdXNlcmlk
LCBpbnRuYW1lKSkKKwlub25leGlzdGVudCA9IDE7CiAgICAgZWxzZQotCXN0cmxjcHkobWJveG5h
bWUsIGxhc3RuYW1lLCBzaXplb2YobWJveG5hbWUpKTsKKwkvKiBMb29rIGl0IHVwICovCisJbm9u
ZXhpc3RlbnQgPSBtYm94bGlzdF9kZXRhaWwoaW50bmFtZSwgJm1idHlwZSwKKwkJCQkgICAgICBO
VUxMLCBOVUxMLCBOVUxMLCBOVUxMKTsKIAotICAgIC8qIExvb2sgaXQgdXAgKi8KLSAgICBub25l
eGlzdGVudCA9IG1ib3hsaXN0X2RldGFpbChtYm94bmFtZSwgJm1idHlwZSwKLQkJCQkgIE5VTEws
IE5VTEwsIE5VTEwsIE5VTEwpOwogICAgIGlmKCFub25leGlzdGVudCAmJiAobWJ0eXBlICYgTUJU
WVBFX1JFU0VSVkUpKQogCW5vbmV4aXN0ZW50ID0gSU1BUF9NQUlMQk9YX1JFU0VSVkVEOwogCkBA
IC03NTI1LDEzICs3NTQyLDEzIEBACiAJcmV0dXJuOwogICAgIH0KIAotICAgIGMgPSBuYW1lW21h
dGNobGVuXTsKLSAgICBpZiAoYykgbmFtZVttYXRjaGxlbl0gPSAnXDAnOwogICAgIHByb3RfcHJp
bnRmKGltYXBkX291dCwgIiogJXMgKCIsIGNtZCk7Ci0gICAgaWYgKGMpIHsKLQkvKiBIYW5kbGUg
bmFtZXNwYWNlIHByZWZpeCBhcyBhIHNwZWNpYWwgY2FzZSAqLyAKLQlpZiAoIXN0cmNtcChuYW1l
LCAidXNlciIpIHx8Ci0JICAgICFzdHJjbXAobmFtZSwgaW1hcGRfbmFtZXNwYWNlLnByZWZpeFtO
QU1FU1BBQ0VfU0hBUkVEXSkpIHsKKyAgICBpZihuYW1lW21hdGNobGVuXSkgeworCWludCBzaGFy
ZWRwcmVmaXhsZW4gPSBzdHJsZW4oaW1hcGRfbmFtZXNwYWNlLnByZWZpeFtOQU1FU1BBQ0VfU0hB
UkVEXSkgLSAxOworCisJLyogSGFuZGxlIG5hbWVzcGFjZSBwcmVmaXggYXMgYSBzcGVjaWFsIGNh
c2UgKi8KKyAJaWYgKCgobWF0Y2hsZW4gPT0gdXNlcnByZWZpeGxlbikgJiYgIXN0cm5jbXAobGFz
dG5hbWUsIGltYXBkX25hbWVzcGFjZS5wcmVmaXhbTkFNRVNQQUNFX1VTRVJdLCB1c2VycHJlZml4
bGVuKSkgfHwKKyAJICAgICgobWF0Y2hsZW4gPT0gc2hhcmVkcHJlZml4bGVuKSAmJiAhc3RybmNt
cChsYXN0bmFtZSwgaW1hcGRfbmFtZXNwYWNlLnByZWZpeFtOQU1FU1BBQ0VfU0hBUkVEXSwgc2hh
cmVkcHJlZml4bGVuKSkpIHsKIAkgICAgcHJvdF9wcmludGYoaW1hcGRfb3V0LCAiXFxOb3NlbGVj
dCIpOwogCSAgICBpZiAobGlzdG9wdHMgJiBMSVNUX0VYVCkKIAkJcHJvdF9wcmludGYoaW1hcGRf
b3V0LCAiIFxcUGxhY2VIb2xkZXIiKTsKQEAgLTc1NTAsMTEgKzc1NjcsOCBAQAogICAgIH0KICAg
ICBwcm90X3ByaW50ZihpbWFwZF9vdXQsICIpIFwiJWNcIiAiLCBpbWFwZF9uYW1lc3BhY2UuaGll
cl9zZXApOwogCi0gICAgKCppbWFwZF9uYW1lc3BhY2UubWJveG5hbWVfdG9leHRlcm5hbCkoJmlt
YXBkX25hbWVzcGFjZSwgbmFtZSwKLQkJCQkJICAgaW1hcGRfdXNlcmlkLCBtYm94bmFtZSk7Ci0g
ICAgcHJpbnRzdHJpbmcobWJveG5hbWUpOworICAgIHByaW50c3RyaW5nKGxhc3RuYW1lKTsKICAg
ICBwcm90X3ByaW50ZihpbWFwZF9vdXQsICJcclxuIik7Ci0gICAgaWYgKGMpIG5hbWVbbWF0Y2hs
ZW5dID0gYzsKICAgICByZXR1cm47CiB9CiAKZGlmZiAtdXIgY3lydXMtaW1hcGQtMi4yLjEyLnN1
cGVyb2xkL2ltYXAvaXB1cmdlLmMgY3lydXMtaW1hcGQtMi4yLjEyL2ltYXAvaXB1cmdlLmMKLS0t
IGN5cnVzLWltYXBkLTIuMi4xMi5zdXBlcm9sZC9pbWFwL2lwdXJnZS5jCTIwMDQtMDUtMjYgMTk6
MzI6MTAuMDAwMDAwMDAwICswNDAwCisrKyBjeXJ1cy1pbWFwZC0yLjIuMTIvaW1hcC9pcHVyZ2Uu
YwkyMDA2LTAyLTIwIDE5OjA0OjQ0Ljg5Mzk5MzAwMCArMDMwMApAQCAtMTA5LDcgKzEwOSw2IEBA
CiAKIGludCBtYWluIChpbnQgYXJnYywgY2hhciAqYXJndltdKSB7CiAgIGludCBvcHRpb247CQkv
KiBnZXRvcHQoKSByZXR1cm5zIGFuIGludCAqLwotICBjaGFyIGJ1ZltNQVhfTUFJTEJPWF9QQVRI
KzFdOwogICBjaGFyICphbHRfY29uZmlnID0gTlVMTDsKICAgaW50IHI7CiAKQEAgLTE4NCwxNyAr
MTgzLDEyIEBACiAgIHF1b3RhZGJfb3BlbihOVUxMKTsKIAogICBpZiAob3B0aW5kID09IGFyZ2Mp
IHsgLyogZG8gdGhlIHdob2xlIHBhcnRpdGlvbiAqLwotICAgIHN0cmNweShidWYsICIqIik7Cisg
ICAgY2hhciAqYnVmPSIqIjsKICAgICAoKnB1cmdlX25hbWVzcGFjZS5tYm94bGlzdF9maW5kYWxs
KSgmcHVyZ2VfbmFtZXNwYWNlLCBidWYsIDEsIDAsIDAsCiAJCQkJCXB1cmdlX21lLCBOVUxMKTsK
ICAgfSBlbHNlIHsKICAgICBmb3IgKDsgb3B0aW5kIDwgYXJnYzsgb3B0aW5kKyspIHsKLSAgICAg
IHN0cm5jcHkoYnVmLCBhcmd2W29wdGluZF0sIE1BWF9NQUlMQk9YX05BTUUpOwotICAgICAgLyog
VHJhbnNsYXRlIGFueSBzZXBhcmF0b3JzIGluIG1haWxib3huYW1lICovCi0gICAgICBtYm94bmFt
ZV9oaWVyc2VwX3RvaW50ZXJuYWwoJnB1cmdlX25hbWVzcGFjZSwgYnVmLAotCQkJCSAgY29uZmln
X3ZpcnRkb21haW5zID8KLQkJCQkgIHN0cmNzcG4oYnVmLCAiQCIpIDogMCk7Ci0gICAgICAoKnB1
cmdlX25hbWVzcGFjZS5tYm94bGlzdF9maW5kYWxsKSgmcHVyZ2VfbmFtZXNwYWNlLCBidWYsIDEs
IDAsIDAsCisgICAgICAoKnB1cmdlX25hbWVzcGFjZS5tYm94bGlzdF9maW5kYWxsKSgmcHVyZ2Vf
bmFtZXNwYWNlLCBhcmd2W29wdGluZF0sIDEsIDAsIDAsCiAJCQkJCSAgcHVyZ2VfbWUsIE5VTEwp
OwogICAgIH0KICAgfQpAQCAtMjI4LDI3ICsyMjIsMjcgQEAKICAgc3RydWN0IG1haWxib3ggdGhl
X2JveDsKICAgaW50ICAgICAgICAgICAgZXJyb3I7CiAgIG1ib3hfc3RhdHNfdCAgIHN0YXRzOwor
ICBjaGFyIGludG5hbWVbTUFYX01BSUxCT1hfUEFUSCsxXTsKKworICBpZigoKnB1cmdlX25hbWVz
cGFjZS5tYm94bmFtZV90b2ludGVybmFsKSgmcHVyZ2VfbmFtZXNwYWNlLCBuYW1lLAorCQkJCQkg
ICBOVUxMLCBpbnRuYW1lKSkKKyAgICAgIHJldHVybiAwOwogCiAgIGlmKCAhIGZvcmNlYWxsICkg
ewogICAgICAgLyogRE9OJ1QgcHVyZ2UgSU5CT1gqIGFuZCB1c2VyLiogKi8KLSAgICAgIGlmICgh
c3RybmNhc2VjbXAobmFtZSwiSU5CT1giLDUpIHx8IG1ib3huYW1lX2lzdXNlcm1haWxib3gobmFt
ZSwgMCkpCisgICAgICBpZiAoIXN0cm5jYXNlY21wKG5hbWUsIklOQk9YIiw1KSB8fCBtYm94bmFt
ZV9pc3VzZXJtYWlsYm94KGludG5hbWUsIDApKQogCSAgcmV0dXJuIDA7CiAgIH0KIAogICBtZW1z
ZXQoJnN0YXRzLCAnXDAnLCBzaXplb2YobWJveF9zdGF0c190KSk7CiAKICAgaWYgKHZlcmJvc2Up
IHsKLSAgICAgIGNoYXIgbWJveG5hbWVbTUFYX01BSUxCT1hfTkFNRSsxXTsKLQotICAgICAgLyog
Q29udmVydCBpbnRlcm5hbCBuYW1lIHRvIGV4dGVybmFsICovCi0gICAgICAoKnB1cmdlX25hbWVz
cGFjZS5tYm94bmFtZV90b2V4dGVybmFsKSgmcHVyZ2VfbmFtZXNwYWNlLCBuYW1lLAotCQkJCQkg
ICAgICJjeXJ1cyIsIG1ib3huYW1lKTsKLSAgICAgIHByaW50ZigiV29ya2luZyBvbiAlcy4uLlxu
IiwgbWJveG5hbWUpOworICAgICAgcHJpbnRmKCJXb3JraW5nIG9uICVzLi4uXG4iLCBuYW1lKTsK
ICAgfQogCi0gIGVycm9yID0gbWFpbGJveF9vcGVuX2hlYWRlcihuYW1lLCAwLCAmdGhlX2JveCk7
CisgIGVycm9yID0gbWFpbGJveF9vcGVuX2hlYWRlcihpbnRuYW1lLCAwLCAmdGhlX2JveCk7CiAg
IGlmIChlcnJvciAhPSAwKSB7IC8qIGRpZCB3ZSBmaW5kIGl0PyAqLwotICAgIHN5c2xvZyhMT0df
RVJSLCAiQ291bGRuJ3QgZmluZCAlcywgY2hlY2sgc3BlbGxpbmciLCBuYW1lKTsKKyAgICBzeXNs
b2coTE9HX0VSUiwgIkNvdWxkbid0IGZpbmQgJXMsIGNoZWNrIHNwZWxsaW5nIiwgaW50bmFtZSk7
CiAgICAgcmV0dXJuIGVycm9yOwogICB9CiAgIGlmICh0aGVfYm94LmhlYWRlcl9mZCAhPSAtMSkg
ewpAQCAtMjY0LDcgKzI1OCw3IEBACiAgIGVycm9yID0gbWFpbGJveF9vcGVuX2luZGV4KCZ0aGVf
Ym94KTsKICAgaWYgKGVycm9yICE9IDApIHsKICAgICBtYWlsYm94X2Nsb3NlKCZ0aGVfYm94KTsK
LSAgICBzeXNsb2coTE9HX0VSUiwgIkNvdWxkbid0IG9wZW4gbWFpbGJveCBpbmRleCBmb3IgJXMi
LCBuYW1lKTsKKyAgICBzeXNsb2coTE9HX0VSUiwgIkNvdWxkbid0IG9wZW4gbWFpbGJveCBpbmRl
eCBmb3IgJXMiLCBpbnRuYW1lKTsKICAgICByZXR1cm4gZXJyb3I7CiAgIH0KICAgKHZvaWQpIG1h
aWxib3hfbG9ja19pbmRleCgmdGhlX2JveCk7CmRpZmYgLXVyIGN5cnVzLWltYXBkLTIuMi4xMi5z
dXBlcm9sZC9pbWFwL21iZXhhbWluZS5jIGN5cnVzLWltYXBkLTIuMi4xMi9pbWFwL21iZXhhbWlu
ZS5jCi0tLSBjeXJ1cy1pbWFwZC0yLjIuMTIuc3VwZXJvbGQvaW1hcC9tYmV4YW1pbmUuYwkyMDA0
LTEyLTE3IDE5OjMyOjE2LjAwMDAwMDAwMCArMDMwMAorKysgY3lydXMtaW1hcGQtMi4yLjEyL2lt
YXAvbWJleGFtaW5lLmMJMjAwNi0wMi0yMCAxOTowNDo0NS4wMTA4NzQwMDAgKzAzMDAKQEAgLTEx
NSw3ICsxMTUsNiBAQAogaW50IG1haW4oaW50IGFyZ2MsIGNoYXIgKiphcmd2KQogewogICAgIGlu
dCBvcHQsIGksIHI7Ci0gICAgY2hhciBidWZbTUFYX01BSUxCT1hfUEFUSCsxXTsKICAgICBjaGFy
ICphbHRfY29uZmlnID0gTlVMTDsKIAogLyogICAgaWYgKGdldGV1aWQoKSA9PSAwKSBmYXRhbCgi
bXVzdCBydW4gYXMgdGhlIEN5cnVzIHVzZXIiLCBFQ19VU0FHRSk7ICovCkBAIC0xNjEsMTYgKzE2
MCwxMyBAQAogICAgIHNpZ25hbHNfYWRkX2hhbmRsZXJzKDApOwogCiAgICAgaWYgKG9wdGluZCA9
PSBhcmdjKSB7Ci0Jc3RybGNweShidWYsICIqIiwgc2l6ZW9mKGJ1ZikpOworCWNoYXIgKmJ1Zj0i
KiI7CiAJKCpyZWNvbl9uYW1lc3BhY2UubWJveGxpc3RfZmluZGFsbCkoJnJlY29uX25hbWVzcGFj
ZSwgYnVmLCAxLCAwLCAwLAogCQkJCQkgICAgZG9fZXhhbWluZSwgTlVMTCk7CiAgICAgfQogCiAg
ICAgZm9yIChpID0gb3B0aW5kOyBpIDwgYXJnYzsgaSsrKSB7Ci0JLyogSGFuZGxlIHZpcnRkb21h
aW5zIGFuZCBzZXBhcmF0b3JzIGluIG1haWxib3huYW1lICovCi0JKCpyZWNvbl9uYW1lc3BhY2Uu
bWJveG5hbWVfdG9pbnRlcm5hbCkoJnJlY29uX25hbWVzcGFjZSwgYXJndltpXSwKLQkJCQkJICAg
ICAgIE5VTEwsIGJ1Zik7Ci0JKCpyZWNvbl9uYW1lc3BhY2UubWJveGxpc3RfZmluZGFsbCkoJnJl
Y29uX25hbWVzcGFjZSwgYnVmLCAxLCAwLAorCSgqcmVjb25fbmFtZXNwYWNlLm1ib3hsaXN0X2Zp
bmRhbGwpKCZyZWNvbl9uYW1lc3BhY2UsIGFyZ3ZbaV0sIDEsIDAsCiAJCQkJCSAgICAwLCBkb19l
eGFtaW5lLCBOVUxMKTsKICAgICB9CiAKQEAgLTE5OCw3ICsxOTQsNyBAQAogewogICAgIGludCBp
LHIgPSAwOwogICAgIGludCBmbGFnID0gMDsKLSAgICBjaGFyIGV4dF9uYW1lX2J1ZltNQVhfTUFJ
TEJPWF9QQVRIKzFdOworICAgIGNoYXIgaW50X25hbWVfYnVmW01BWF9NQUlMQk9YX1BBVEgrMV07
CiAgICAgc3RydWN0IG1haWxib3ggbWFpbGJveDsKICAgICBjb25zdCBjaGFyICppbmRleF9iYXNl
OwogICAgIGxvbmcgaW50IHN0YXJ0X29mZnNldCwgcmVjb3JkX3NpemU7CkBAIC0yMDYsMTIgKzIw
MiwxNCBAQAogICAgIHNpZ25hbHNfcG9sbCgpOwogCiAgICAgLyogQ29udmVydCBpbnRlcm5hbCBu
YW1lIHRvIGV4dGVybmFsICovCi0gICAgKCpyZWNvbl9uYW1lc3BhY2UubWJveG5hbWVfdG9leHRl
cm5hbCkoJnJlY29uX25hbWVzcGFjZSwgbmFtZSwKLQkJCQkJICAgImN5cnVzIiwgZXh0X25hbWVf
YnVmKTsKLSAgICBwcmludGYoIkV4YW1pbmluZyAlcy4uLlxuIiwgZXh0X25hbWVfYnVmKTsKKyAg
ICBpZigociA9ICgqcmVjb25fbmFtZXNwYWNlLm1ib3huYW1lX3RvaW50ZXJuYWwpKCZyZWNvbl9u
YW1lc3BhY2UsIG5hbWUsCisJCQkJCQkgICBOVUxMLCBpbnRfbmFtZV9idWYpKSkKKwlyZXR1cm4g
cjsKKworICAgIHByaW50ZigiRXhhbWluaW5nICVzLi4uXG4iLCBuYW1lKTsKIAogICAgIC8qIE9w
ZW4vbG9jayBoZWFkZXIgKi8KLSAgICByID0gbWFpbGJveF9vcGVuX2hlYWRlcihuYW1lLCAwLCAm
bWFpbGJveCk7CisgICAgciA9IG1haWxib3hfb3Blbl9oZWFkZXIoaW50X25hbWVfYnVmLCAwLCAm
bWFpbGJveCk7CiAgICAgaWYgKHIpIHsKIAlyZXR1cm4gcjsKICAgICB9CmRpZmYgLXVyIGN5cnVz
LWltYXBkLTIuMi4xMi5zdXBlcm9sZC9pbWFwL21ib3hsaXN0LmMgY3lydXMtaW1hcGQtMi4yLjEy
L2ltYXAvbWJveGxpc3QuYwotLS0gY3lydXMtaW1hcGQtMi4yLjEyLnN1cGVyb2xkL2ltYXAvbWJv
eGxpc3QuYwkyMDA2LTAyLTIwIDE4OjM2OjE1LjE1MDE5NDAwMCArMDMwMAorKysgY3lydXMtaW1h
cGQtMi4yLjEyL2ltYXAvbWJveGxpc3QuYwkyMDA2LTAyLTIwIDE5OjA0OjQ1LjE2NTc1MzAwMCAr
MDMwMApAQCAtOTQsNiArOTQsNyBAQAogCiBzdHJ1Y3QgZGIgKm1iZGI7CiAKK3N0cnVjdCBuYW1l
c3BhY2UgaW50ZXJuYWxfbmFtZXNwYWNlOwogc3RhdGljIGludCBtYm94bGlzdF9kYm9wZW4gPSAw
OwogCiBzdGF0aWMgaW50IG1ib3hsaXN0X29wZW5zdWJzKCk7CkBAIC0xMDc1LDggKzEwNzYsOCBA
QAogICAgICAgICAgICAgfQogCQkvKiBmaW5kIGlmIHRoZXJlIGFyZSBzdWJmb2xkZXJzLiBUaGVu
IHdlIHdhbnQgdG8gCiAJCSAqIGtlZXAgdGhlIGV4aXN0aW5nIHF1b3RhICovCi0gICAgICAgICAg
ICBtYm94bGlzdF9maW5kYWxsKE5VTEwsIHBhdHRlcm4sIGlzYWRtaW4sIHVzZXJpZCwKLSAgICAg
ICAgICAgICAgICAgICAgYXV0aF9zdGF0ZSwgY2hpbGRfY2IsICh2b2lkICopICZoYXNfY2hpbGRy
ZW4pOworICAgICAgICAgICAgbWJveGxpc3RfZmluZGFsbCgmaW50ZXJuYWxfbmFtZXNwYWNlLCBw
YXR0ZXJuLCAxLCBOVUxMLAorICAgICAgICAgICAgICAgICAgICBOVUxMLCBjaGlsZF9jYiwgKHZv
aWQgKikgJmhhc19jaGlsZHJlbik7CiAKIAkgICAgaWYoIWhhc19jaGlsZHJlbikKICAgICAgICAg
ICAgICAgICBpZighbWJveGxpc3RfbXlsb29rdXAocXVvdGFyb290LCBOVUxMLCBOVUxMLCBOVUxM
LCBOVUxMLCBOVUxMLCAwICkpCkBAIC0xNzUyLDM1ICsxNzUzLDM5IEBACiAgICAgbG9uZyBtaW5t
YXRjaDsKICAgICBzdHJ1Y3QgZ2xvYiAqZyA9IHJvY2stPmc7CiAgICAgbG9uZyBtYXRjaGxlbjsK
KyAgICBjaGFyIG5hbWVidWZbTUFYX01BSUxCT1hfTkFNRSsxXTsKKyAgICBjaGFyIG5hbWVidWZf
b3V0W01BWF9NQUlMQk9YX05BTUUrMV07CiAKICAgICAvKiBkb24ndCBsaXN0IG1haWxib3hlcyBv
dXRzaWRlIG9mIHRoZSBkZWZhdWx0IGRvbWFpbiAqLwogICAgIGlmICghcm9jay0+ZG9tYWlubGVu
ICYmICFyb2NrLT5pc2FkbWluICYmIHN0cmNocihrZXksICchJykpIHJldHVybiAwOyAKIAogICAg
IG1pbm1hdGNoID0gMDsKLSAgICBpZiAocm9jay0+aW5ib3hvZmZzZXQpIHsKLQljaGFyIG5hbWVi
dWZbTUFYX01BSUxCT1hfTkFNRSsxXTsKIAotCWlmKGtleWxlbiA+PSBzaXplb2YobmFtZWJ1Zikp
IHsKLQkgICAgc3lzbG9nKExPR19FUlIsICJvdmVyc2l6ZSBrZXlsZW4gaW4gbWJveGxpc3QuYzpm
aW5kX3AoKSIpOwotCSAgICByZXR1cm4gMDsKLQl9Ci0JbWVtY3B5KG5hbWVidWYsIGtleSwga2V5
bGVuKTsKLQluYW1lYnVmW2tleWxlbl0gPSAnXDAnOwotCQotCWlmIChyb2NrLT5pbmJveG9mZnNl
dCkgewotCSAgICBuYW1lYnVmW3JvY2stPmluYm94b2Zmc2V0XSA9IHJvY2stPmluYm94Y2FzZVsw
XTsKLQkgICAgbmFtZWJ1Zltyb2NrLT5pbmJveG9mZnNldCsxXSA9IHJvY2stPmluYm94Y2FzZVsx
XTsKLQkgICAgbmFtZWJ1Zltyb2NrLT5pbmJveG9mZnNldCsyXSA9IHJvY2stPmluYm94Y2FzZVsy
XTsKLQkgICAgbmFtZWJ1Zltyb2NrLT5pbmJveG9mZnNldCszXSA9IHJvY2stPmluYm94Y2FzZVsz
XTsKLQkgICAgbmFtZWJ1Zltyb2NrLT5pbmJveG9mZnNldCs0XSA9IHJvY2stPmluYm94Y2FzZVs0
XTsKLQl9Ci0JCi0JbWF0Y2hsZW4gPSBnbG9iX3Rlc3QoZywgbmFtZWJ1Zityb2NrLT5pbmJveG9m
ZnNldCwKLQkJCSAgICAga2V5bGVuLXJvY2stPmluYm94b2Zmc2V0LCAmbWlubWF0Y2gpOwotICAg
IH0gZWxzZSB7Ci0JbWF0Y2hsZW4gPSBnbG9iX3Rlc3QoZywga2V5LCBrZXlsZW4sICZtaW5tYXRj
aCk7CisgICAgbWVtY3B5KG5hbWVidWYsIGtleSwga2V5bGVuKTsKKyAgICBuYW1lYnVmW2tleWxl
bl0gPSAnXDAnOworCisgICAgLyogcmlnaHQgd29yayB3aXRoIGFuIGFsdGVybmF0ZSAobm90IHRo
ZSBidWlsZC1pbikKKyAgICAgICBuYW1lc3BhY2UgLS0gc29yY2VyZXIgKi8KKyAgICBpZihrZXls
ZW4gPj0gc2l6ZW9mKG5hbWVidWYpKSB7CisJc3lzbG9nKExPR19FUlIsICJvdmVyc2l6ZSBrZXls
ZW4gaW4gbWJveGxpc3QuYzpmaW5kX3AoKSIpOworCXJldHVybiAwOworICAgIH0KKyAgICBpZihy
b2NrLT5pbmJveG9mZnNldCkgeworCW5hbWVidWZbcm9jay0+aW5ib3hvZmZzZXRdID0gcm9jay0+
aW5ib3hjYXNlWzBdOworCW5hbWVidWZbcm9jay0+aW5ib3hvZmZzZXQrMV0gPSByb2NrLT5pbmJv
eGNhc2VbMV07CisJbmFtZWJ1Zltyb2NrLT5pbmJveG9mZnNldCsyXSA9IHJvY2stPmluYm94Y2Fz
ZVsyXTsKKwluYW1lYnVmW3JvY2stPmluYm94b2Zmc2V0KzNdID0gcm9jay0+aW5ib3hjYXNlWzNd
OworCW5hbWVidWZbcm9jay0+aW5ib3hvZmZzZXQrNF0gPSByb2NrLT5pbmJveGNhc2VbNF07CiAg
ICAgfQogCisgICAgLyogaWYgY2FudCBnZXQgdGhlIGV4dGVybmFsIG5hbWUgdGhlbiBza2lwIHRo
ZSBjdXJyZW50CisgICAgICAga2V5IC0tIHNvcmNlcmVyICovCisgICAgaWYoKHJvY2stPm5hbWVz
cGFjZS0+bWJveG5hbWVfdG9leHRlcm5hbCkocm9jay0+bmFtZXNwYWNlLCBuYW1lYnVmK3JvY2st
PmluYm94b2Zmc2V0LCBhdXRoX2Nhbm9udXNlcihyb2NrLT5hdXRoX3N0YXRlKSwgbmFtZWJ1Zl9v
dXQpKQorCXJldHVybiAwOworCisgICAgbWF0Y2hsZW4gPSBnbG9iX3Rlc3QoZywgbmFtZWJ1Zl9v
dXQsCisJCQkgc3RybGVuKG5hbWVidWZfb3V0KSwgJm1pbm1hdGNoKTsKKwogICAgIC8qIElmIGl0
cyBub3QgYSBtYXRjaCwgc2tpcCBpdCAtLSBwYXJ0aWFsIG1hdGNoZXMgYXJlIG9rLiAqLwogICAg
IGlmKG1hdGNobGVuID09IC0xKSByZXR1cm4gMDsKIApAQCAtMTg4MSwyMiArMTg4NiwzMiBAQAog
CSAgICByID0gMDsJCS8qIGRvbid0IGJvdGhlciBjaGVja2luZyAqLwogCX0KIAotCWlmICghciAm
JiByb2NrLT5pbmJveG9mZnNldCkgewotCSAgICBuYW1lYnVmW3JvY2stPmluYm94b2Zmc2V0XSA9
IHJvY2stPmluYm94Y2FzZVswXTsKLQkgICAgbmFtZWJ1Zltyb2NrLT5pbmJveG9mZnNldCsxXSA9
IHJvY2stPmluYm94Y2FzZVsxXTsKLQkgICAgbmFtZWJ1Zltyb2NrLT5pbmJveG9mZnNldCsyXSA9
IHJvY2stPmluYm94Y2FzZVsyXTsKLQkgICAgbmFtZWJ1Zltyb2NrLT5pbmJveG9mZnNldCszXSA9
IHJvY2stPmluYm94Y2FzZVszXTsKLQkgICAgbmFtZWJ1Zltyb2NrLT5pbmJveG9mZnNldCs0XSA9
IHJvY2stPmluYm94Y2FzZVs0XTsKLQl9Ci0JCi0JbWF0Y2hsZW4gPSBnbG9iX3Rlc3QoZywgbmFt
ZWJ1Zityb2NrLT5pbmJveG9mZnNldCwKLQkJCSAgICAga2V5bGVuLXJvY2stPmluYm94b2Zmc2V0
LCAmbWlubWF0Y2gpOworCS8qIHJpZ2h0IHdvcmsgd2l0aCBhbiBhbHRlcm5hdGUgKG5vdCB0aGUg
YnVpbGQtaW4pCisJICAgbmFtZXNwYWNlIC8vIHNvcmNlcmVyICovCisJeworCSAgICBjaGFyIG5h
bWVidWZfb3V0W01BWF9NQUlMQk9YX05BTUUrMV07CisJICAgIGlmKHJvY2stPmluYm94b2Zmc2V0
KSB7CisJCW5hbWVidWZbcm9jay0+aW5ib3hvZmZzZXRdID0gcm9jay0+aW5ib3hjYXNlWzBdOwor
CQluYW1lYnVmW3JvY2stPmluYm94b2Zmc2V0KzFdID0gcm9jay0+aW5ib3hjYXNlWzFdOworCQlu
YW1lYnVmW3JvY2stPmluYm94b2Zmc2V0KzJdID0gcm9jay0+aW5ib3hjYXNlWzJdOworCQluYW1l
YnVmW3JvY2stPmluYm94b2Zmc2V0KzNdID0gcm9jay0+aW5ib3hjYXNlWzNdOworCQluYW1lYnVm
W3JvY2stPmluYm94b2Zmc2V0KzRdID0gcm9jay0+aW5ib3hjYXNlWzRdOworCSAgICB9CisJICAg
IGlmKChyb2NrLT5uYW1lc3BhY2UtPm1ib3huYW1lX3RvZXh0ZXJuYWwpKHJvY2stPm5hbWVzcGFj
ZSwgbmFtZWJ1Zityb2NrLT5pbmJveG9mZnNldCwgYXV0aF9jYW5vbnVzZXIocm9jay0+YXV0aF9z
dGF0ZSksIG5hbWVidWZfb3V0KSkgeworCQlyID0gMDsKKwkJYnJlYWs7CisJICAgIH0KKwkgICAg
c3RyY3B5KG5hbWVidWYsIG5hbWVidWZfb3V0KTsKIAotCWlmIChtYXRjaGxlbiA9PSAtMSkgewot
CSAgICByID0gMDsKLQkgICAgYnJlYWs7Ci0JfQorCSAgICBtYXRjaGxlbiA9IGdsb2JfdGVzdChn
LCBuYW1lYnVmLAorCQkJCSBzdHJsZW4obmFtZWJ1ZiksICZtaW5tYXRjaCk7CiAKKwkgICAgaWYg
KG1hdGNobGVuID09IC0xKSB7CisJCXIgPSAwOworCQlicmVhazsKKwkgICAgfQorCX0KKwkKIAlz
d2l0Y2ggKHIpIHsKIAljYXNlIDA6CiAJICAgIC8qIGZvdW5kIHRoZSBlbnRyeTsgb3V0cHV0IGl0
ICovCkBAIC0xOTE1LDcgKzE5MzAsNyBAQAogCSAgICB9CiAKIAkgICAgcm9jay0+Y2hlY2tzaGFy
ZWQgPSAwOwotCSAgICByID0gKCpyb2NrLT5wcm9jKShuYW1lYnVmK3JvY2stPmluYm94b2Zmc2V0
LCBtYXRjaGxlbiwgCisJICAgIHIgPSAoKnJvY2stPnByb2MpKG5hbWVidWYsIG1hdGNobGVuLCAK
IAkJCSAgICAgIDEsIHJvY2stPnByb2Nyb2NrKTsKIAogCSAgICBicmVhazsKQEAgLTE5NTksNyAr
MTk3NCw2IEBACiAgICAgaW50IHByZWZpeGxlbjsKICAgICBpbnQgdXNlcmxlbiA9IHVzZXJpZCA/
IHN0cmxlbih1c2VyaWQpIDogMCwgZG9tYWlubGVuID0gMDsKICAgICBjaGFyIGRvbWFpbnBhdFtN
QVhfTUFJTEJPWF9OQU1FKzFdID0gIiI7IC8qIGRvIGludHJhLWRvbWFpbiBmZXRjaGVzIG9ubHkg
Ki8KLSAgICBjaGFyICpwYXQgPSBOVUxMOwogCiAgICAgaWYgKGNvbmZpZ192aXJ0ZG9tYWlucykg
ewogCWNoYXIgKmRvbWFpbjsKQEAgLTIwMDAsOCArMjAxNCwxMCBAQAogICAgIGlmIChkb21haW5w
YXRbMF0gPT0gJ1wwJykKIAlzdHJsY3B5KGRvbWFpbnBhdCwgcGF0dGVybiwgc2l6ZW9mKGRvbWFp
bnBhdCkpOwogCi0gICAgY2Jyb2NrLmcgPSBnbG9iX2luaXQocGF0dGVybiwgR0xPQl9ISUVSQVJD
SFl8R0xPQl9JTkJPWENBU0UpOwotICAgIGNicm9jay5uYW1lc3BhY2UgPSBOVUxMOworICAgIG1i
b3huYW1lX2hpZXJzZXBfdG9pbnRlcm5hbChuYW1lc3BhY2UsIGRvbWFpbnBhdCwgMCk7CisKKyAg
ICBjYnJvY2suZyA9IGdsb2JfaW5pdChwYXR0ZXJuLCBuYW1lc3BhY2UtPmhpZXJfc2VwLCBHTE9C
X0hJRVJBUkNIWXxHTE9CX0lOQk9YQ0FTRSk7CisgICAgY2Jyb2NrLm5hbWVzcGFjZSA9IG5hbWVz
cGFjZTsKICAgICBjYnJvY2suZG9tYWlubGVuID0gZG9tYWlubGVuOwogICAgIGNicm9jay5pbmJv
eGNhc2UgPSBnbG9iX2luYm94Y2FzZShjYnJvY2suZyk7CiAgICAgY2Jyb2NrLmlzYWRtaW4gPSBp
c2FkbWluOwpAQCAtMjAzNSwxNiArMjA1MSw2IEBACiAJICAgIH0KIAkgICAgZWxzZSBpZiAociA9
PSBDWVJVU0RCX05PVEZPVU5EKSByID0gMDsKIAl9Ci0JZWxzZSBpZiAoIXN0cm5jbXAocGF0dGVy
biwKLQkJCSAgdXNlcm1ib3huYW1lK2RvbWFpbmxlbiwgdXNlcm1ib3huYW1lbGVuLWRvbWFpbmxl
bikgJiYKLQkJIEdMT0JfVEVTVChjYnJvY2suZywgdXNlcm1ib3huYW1lK2RvbWFpbmxlbikgIT0g
LTEpIHsKLQkgICAgciA9IERCLT5mZXRjaChtYmRiLCB1c2VybWJveG5hbWUsIHVzZXJtYm94bmFt
ZWxlbiwKLQkJCSAgJmRhdGEsICZkYXRhbGVuLCBOVUxMKTsKLQkgICAgaWYgKCFyICYmIGRhdGEp
IHsKLQkJciA9ICgqcHJvYykodXNlcm1ib3huYW1lLCB1c2VybWJveG5hbWVsZW4sIDEsIHJvY2sp
OwotCSAgICB9Ci0JICAgIGVsc2UgaWYgKHIgPT0gQ1lSVVNEQl9OT1RGT1VORCkgciA9IDA7Ci0J
fQogCXN0cmxjYXQodXNlcm1ib3huYW1lLCAiLiIsIHNpemVvZih1c2VybWJveG5hbWUpKTsKIAl1
c2VybWJveG5hbWVsZW4rKzsKIApAQCAtMjA1NywzMyArMjA2MywxOCBAQAogCiAgICAgaWYgKHIp
IGdvdG8gZG9uZTsKIAotICAgIC8qIE1ha2UgYSB3b3JraW5nIGNvcHkgb2YgcGF0dGVybiAqLwot
ICAgIHBhdHRlcm4gPSBwYXQgPSB4c3RyZHVwKHBhdHRlcm4pOwotCiAgICAgLyogRmluZCBmaXhl
ZC1zdHJpbmcgcGF0dGVybiBwcmVmaXggKi8KLSAgICBmb3IgKHAgPSBwYXQ7ICpwOyBwKyspIHsK
KyAgICBmb3IgKHAgPSAoY2hhciAqKXBhdHRlcm47ICpwOyBwKyspIHsKIAlpZiAoKnAgPT0gJyon
IHx8ICpwID09ICclJyB8fCAqcCA9PSAnPycgfHwgKnAgPT0gJ0AnKSBicmVhazsKICAgICB9CiAg
ICAgcHJlZml4bGVuID0gcCAtIHBhdHRlcm47Ci0gICAgKnAgPSAnXDAnOwogCiAgICAgLyoKICAg
ICAgKiBJZiB1c2VyLlguKiBvciBJTkJPWC4qIGNhbiBtYXRjaCBwYXR0ZXJuLAogICAgICAqIHNl
YXJjaCBmb3IgdGhvc2UgbWFpbGJveGVzIG5leHQKICAgICAgKi8KLSAgICBpZiAodXNlcmlkICYm
Ci0JKCFzdHJuY21wKHVzZXJtYm94bmFtZStkb21haW5sZW4sIHBhdHRlcm4sIHVzZXJtYm94bmFt
ZWxlbi1kb21haW5sZW4tMSkgfHwKLQkgIXN0cm5jYXNlY21wKCJpbmJveC4iLCBwYXR0ZXJuLCBw
cmVmaXhsZW4gPCA2ID8gcHJlZml4bGVuIDogNikpKSB7Ci0KLQlpZiAoIXN0cm5jbXAodXNlcm1i
b3huYW1lK2RvbWFpbmxlbiwgcGF0dGVybiwgdXNlcm1ib3huYW1lbGVuLWRvbWFpbmxlbi0xKSkg
ewotCSAgICAvKiBzd2l0Y2ggdG8gcGF0dGVybiB3aXRoIGRvbWFpbiBwcmVwZW5kZWQgKi8KLQkg
ICAgZ2xvYl9mcmVlKCZjYnJvY2suZyk7Ci0JICAgIGNicm9jay5nID0gZ2xvYl9pbml0KGRvbWFp
bnBhdCwgR0xPQl9ISUVSQVJDSFkpOwotCSAgICBjYnJvY2suaW5ib3hvZmZzZXQgPSAwOwotCX0K
LQllbHNlIHsKLQkgICAgY2Jyb2NrLmluYm94b2Zmc2V0ID0gZG9tYWlubGVuICsgdXNlcmxlbjsK
LQl9CisgICAgaWYgKHVzZXJpZCkgeworCWNicm9jay5pbmJveG9mZnNldCA9IGRvbWFpbmxlbiAr
IHVzZXJsZW47CiAKIAljYnJvY2suZmluZF9uYW1lc3BhY2UgPSBOQU1FU1BBQ0VfSU5CT1g7CiAJ
LyogaXRlcmF0ZSB0aHJvdWdoIHByZWZpeGVzIG1hdGNoaW5nIHVzZXJtYm94bmFtZSAqLwpAQCAt
MjA5NSw5ICsyMDg2LDggQEAKIAogICAgIGlmKCFyKSB7CiAJY2Jyb2NrLmZpbmRfbmFtZXNwYWNl
ID0gTkFNRVNQQUNFX1VTRVI7Ci0JLyogc3dpdGNoIHRvIHBhdHRlcm4gd2l0aCBkb21haW4gcHJl
cGVuZGVkICovCiAJZ2xvYl9mcmVlKCZjYnJvY2suZyk7Ci0JY2Jyb2NrLmcgPSBnbG9iX2luaXQo
ZG9tYWlucGF0LCBHTE9CX0hJRVJBUkNIWSk7CisJY2Jyb2NrLmcgPSBnbG9iX2luaXQocGF0dGVy
biwgbmFtZXNwYWNlLT5oaWVyX3NlcCwgR0xPQl9ISUVSQVJDSFkpOwogCWNicm9jay5pbmJveG9m
ZnNldCA9IDA7CiAJaWYgKHVzZXJtYm94bmFtZWxlbikgewogCSAgICB1c2VybWJveG5hbWVbLS11
c2VybWJveG5hbWVsZW5dID0gJ1wwJzsKQEAgLTIxMTYsNyArMjEwNiw2IEBACiAKICAgZG9uZToK
ICAgICBnbG9iX2ZyZWUoJmNicm9jay5nKTsKLSAgICBpZiAocGF0KSBmcmVlKHBhdCk7CiAKICAg
ICByZXR1cm4gcjsKIH0KQEAgLTIxNDYsNyArMjEzNSw3IEBACiAgICAgZWxzZQogCWRvbWFpbnBh
dFswXSA9ICdcMCc7CiAKLSAgICBjYnJvY2suZyA9IGdsb2JfaW5pdChwYXR0ZXJuLCBHTE9CX0hJ
RVJBUkNIWXxHTE9CX0lOQk9YQ0FTRSk7CisgICAgY2Jyb2NrLmcgPSBnbG9iX2luaXQocGF0dGVy
biwgbmFtZXNwYWNlLT5oaWVyX3NlcCwgR0xPQl9ISUVSQVJDSFl8R0xPQl9JTkJPWENBU0UpOwog
ICAgIGNicm9jay5uYW1lc3BhY2UgPSBuYW1lc3BhY2U7CiAgICAgY2Jyb2NrLmRvbWFpbmxlbiA9
IGRvbWFpbmxlbjsKICAgICBjYnJvY2suaW5ib3hjYXNlID0gZ2xvYl9pbmJveGNhc2UoY2Jyb2Nr
LmcpOwpAQCAtMjIwOCwxMiArMjE5NywxMSBAQAogICAgIC8qCiAgICAgICogUGVyc29uYWwgKElO
Qk9YKSBuYW1lc3BhY2UKICAgICAgKgotICAgICAqIEFwcGVuZCBwYXR0ZXJuIHRvICJJTkJPWC4i
LCBzZWFyY2ggZm9yIHRob3NlIG1haWxib3hlcyBuZXh0CisgICAgICogU2VhcmNoIGZvciAiSU5C
T1guKiIgbWFpbGJveGVzIG5leHQKICAgICAgKi8KICAgICBpZiAodXNlcmlkKSB7Ci0Jc3RybGNw
eShwYXRidWYsICJJTkJPWC4iLCBzaXplb2YocGF0YnVmKSk7Ci0Jc3RybGNhdChwYXRidWYsIHBh
dHRlcm4sIHNpemVvZihwYXRidWYpKTsKLQljYnJvY2suZyA9IGdsb2JfaW5pdChwYXRidWYsIEdM
T0JfSElFUkFSQ0hZfEdMT0JfSU5CT1hDQVNFKTsKKwkvKiBkb24ndCB0b3VjaCB0aGUgcGF0dGVy
biEgLy8gc29yY2VyZXIgKi8KKwljYnJvY2suZyA9IGdsb2JfaW5pdChwYXR0ZXJuLCBuYW1lc3Bh
Y2UtPmhpZXJfc2VwLCBHTE9CX0hJRVJBUkNIWXxHTE9CX0lOQk9YQ0FTRSk7CiAJY2Jyb2NrLmlu
Ym94Y2FzZSA9IGdsb2JfaW5ib3hjYXNlKGNicm9jay5nKTsKIAljYnJvY2suaW5ib3hvZmZzZXQg
PSBkb21haW5sZW4rdXNlcmxlbjsKIAljYnJvY2suZmluZF9uYW1lc3BhY2UgPSBOQU1FU1BBQ0Vf
SU5CT1g7CkBAIC0yMjQzLDE3ICsyMjMxLDEwIEBACiAKICAgICBpZiAoIXN0cm5jbXAobmFtZXNw
YWNlLT5wcmVmaXhbTkFNRVNQQUNFX1VTRVJdLCBwYXR0ZXJuLAogCQkgcHJlZml4bGVuIDwgbGVu
ID8gcHJlZml4bGVuIDogbGVuKSkgeworCS8qIHdlJ2xsIHNlYXJjaCBmb3IgdGhlIHJlcXVlc3Rl
ZCBwYXR0ZXJuIGRvbid0IG1ha2luZyBhbnkKKwkgICBzdHVwaWQgbW9kaWZpY2F0aW9ucyBvZiBp
dCAvLyBzb3JjZXJlciAqLworCWNicm9jay5nID0gZ2xvYl9pbml0KHBhdHRlcm4sIG5hbWVzcGFj
ZS0+aGllcl9zZXAsIEdMT0JfSElFUkFSQ0hZKTsKIAotCWlmIChwcmVmaXhsZW4gPCBsZW4pIHsK
LQkgICAgc3RybGNweShkb21haW5wYXQrZG9tYWlubGVuLCBwYXR0ZXJuK3ByZWZpeGxlbiwKLQkJ
ICAgIHNpemVvZihkb21haW5wYXQpLWRvbWFpbmxlbik7Ci0JICAgIGNicm9jay5nID0gZ2xvYl9p
bml0KGRvbWFpbnBhdCwgR0xPQl9ISUVSQVJDSFkpOwotCX0KLQllbHNlIHsKLQkgICAgc3RybGNw
eShkb21haW5wYXQrZG9tYWlubGVuLCAidXNlciIsIHNpemVvZihkb21haW5wYXQpLWRvbWFpbmxl
bik7Ci0JICAgIHN0cmxjYXQoZG9tYWlucGF0LCBwYXR0ZXJuK2xlbiwgc2l6ZW9mKGRvbWFpbnBh
dCkpOwotCSAgICBjYnJvY2suZyA9IGdsb2JfaW5pdChkb21haW5wYXQsIEdMT0JfSElFUkFSQ0hZ
KTsKLQl9CiAJY2Jyb2NrLmZpbmRfbmFtZXNwYWNlID0gTkFNRVNQQUNFX1VTRVI7CiAJY2Jyb2Nr
LmluYm94b2Zmc2V0ID0gMDsKIAkKQEAgLTIyODUsMTEgKzIyNjYsMTEgQEAKIAkgICAgLyogU2tp
cCBwYXR0ZXJuIHdoaWNoIG1hdGNoZXMgc2hhcmVkIG5hbWVzcGFjZSBwcmVmaXggKi8KIAkgICAg
Zm9yIChwID0gcGF0K3ByZWZpeGxlbjsgKnA7IHArKykgewogCQlpZiAoKnAgPT0gJyUnKSBjb250
aW51ZTsKLQkJZWxzZSBpZiAoKnAgPT0gJy4nKSBwKys7CisJCWVsc2UgaWYgKCpwID09IG5hbWVz
cGFjZS0+aGllcl9zZXApIHArKzsKIAkJYnJlYWs7CiAJICAgIH0KIAotCSAgICBpZiAoKnBhdHRl
cm4gJiYgIXN0cmNocihwYXR0ZXJuLCAnLicpICYmCisJICAgIGlmICgqcGF0dGVybiAmJiAhc3Ry
Y2hyKHBhdHRlcm4sIG5hbWVzcGFjZS0+aGllcl9zZXApICYmCiAJCXBhdHRlcm5bc3RybGVuKHBh
dHRlcm4pLTFdID09ICclJykgewogCQkvKiBzcGVjaWFsIGNhc2U6ICBMSVNUICIiIColIC0tIG91
dHB1dCBwcmVmaXggKi8KICAgCQljYnJvY2suY2hlY2tzaGFyZWQgPSAxOwpAQCAtMjI5OCwyNSAr
MjI3OSwyMSBAQAogCSAgICBpZiAoKGNicm9jay5jaGVja3NoYXJlZCB8fCBwcmVmaXhsZW4gPT0g
bGVuKSAmJiAhKnApIHsKIAkJLyogc3BlY2lhbCBjYXNlOiAgTElTVCAiIiAlIC0tIG91dHB1dCBw
cmVmaXgKICAJCSAgIChpZiB3ZSBoYXZlIGEgc2hhcmVkIG1ib3gpIGFuZCBxdWl0ICovCi0JCXN0
cmxjcHkoZG9tYWlucGF0K2RvbWFpbmxlbiwgIioiLCBzaXplb2YoZG9tYWlucGF0KS1kb21haW5s
ZW4pOwotCQljYnJvY2suZyA9IGdsb2JfaW5pdChkb21haW5wYXQsIEdMT0JfSElFUkFSQ0hZKTsK
KwkJY2Jyb2NrLmcgPSBnbG9iX2luaXQoIioiLCBuYW1lc3BhY2UtPmhpZXJfc2VwLCBHTE9CX0hJ
RVJBUkNIWSk7CiAJCWNicm9jay5jaGVja3NoYXJlZCA9IDI7CiAJICAgIH0KLQkgICAgZWxzZSB7
Ci0JCXN0cmxjcHkoZG9tYWlucGF0K2RvbWFpbmxlbiwgcCwgc2l6ZW9mKGRvbWFpbnBhdCktZG9t
YWlubGVuKTsKLQkJY2Jyb2NrLmcgPSBnbG9iX2luaXQoZG9tYWlucGF0LCBHTE9CX0hJRVJBUkNI
WSk7Ci0JICAgIH0KLQkJCisJICAgIGVsc2UKKwkJY2Jyb2NrLmcgPSBnbG9iX2luaXQocGF0LCBu
YW1lc3BhY2UtPmhpZXJfc2VwLCBHTE9CX0hJRVJBUkNIWSk7CisKIAkgICAgZG9tYWlucGF0W2Rv
bWFpbmxlbl0gPSAnXDAnOwogCSAgICBEQi0+Zm9yZWFjaChtYmRiLAogCQkJZG9tYWlucGF0LCBk
b21haW5sZW4sCiAJCQkmZmluZF9wLCAmZmluZF9jYiwgJmNicm9jaywKIAkJCU5VTEwpOwogCX0K
LQllbHNlIGlmIChwYXR0ZXJuW2xlbl0gPT0gJy4nKSB7Ci0JICAgIHN0cmxjcHkoZG9tYWlucGF0
K2RvbWFpbmxlbiwgcGF0dGVybitsZW4rMSwKLQkJICAgIHNpemVvZihkb21haW5wYXQpLWRvbWFp
bmxlbik7Ci0JICAgIGNicm9jay5nID0gZ2xvYl9pbml0KGRvbWFpbnBhdCwgR0xPQl9ISUVSQVJD
SFkpOworCWVsc2UgaWYgKHBhdHRlcm5bbGVuXSA9PSBuYW1lc3BhY2UtPmhpZXJfc2VwKSB7CisJ
ICAgIHNucHJpbnRmKGRvbWFpbnBhdCtkb21haW5sZW4sIHNpemVvZihkb21haW5wYXQpLWRvbWFp
bmxlbiwgIiUuKnMiLCBwcmVmaXhsZW4tKGxlbisxKSwgcGF0dGVybitsZW4rMSk7CisJICAgIGNi
cm9jay5nID0gZ2xvYl9pbml0KHBhdHRlcm4sIG5hbWVzcGFjZS0+aGllcl9zZXAsIEdMT0JfSElF
UkFSQ0hZKTsKIAogCSAgICBEQi0+Zm9yZWFjaChtYmRiLAogCQkJZG9tYWlucGF0LCBkb21haW5s
ZW4rcHJlZml4bGVuLShsZW4rMSksCkBAIC0yMzk0LDcgKzIzNzEsNyBAQAogCWlmIChyKSB7CiAJ
ICAgIGlmICghZm9yY2UgJiYgciA9PSBJTUFQX01BSUxCT1hfTk9ORVhJU1RFTlQpIHsKIAkJLyog
bG9vayBmb3IgYSBjaGlsZCBtYWlsYm94IGluIHRoZSBwcm9wb3NlZCBxdW90YXJvb3QgKi8KLQkJ
bWJveGxpc3RfZmluZGFsbChOVUxMLCBwYXR0ZXJuLCAxLCBOVUxMLCBOVUxMLAorCQltYm94bGlz
dF9maW5kYWxsKCZpbnRlcm5hbF9uYW1lc3BhY2UsIHBhdHRlcm4sIDEsIE5VTEwsIE5VTEwsCiAJ
CQkJIGNoaWxkX2NiLCAodm9pZCAqKSAmZm9yY2UpOwogCSAgICB9CiAKQEAgLTI0MjUsNyArMjQw
Miw3IEBACiAgICAgaWYoaGF2ZV9tYWlsYm94KQogCW1ib3hsaXN0X2NoYW5nZXF1b3RhKHF1b3Rh
LnJvb3QsIDAsIDAsICZjcm9jayk7CiAgICAgLyogc3VibWFpbGJveGVzIC0gd2UncmUgdXNpbmcg
aW50ZXJuYWwgbmFtZXMgaGVyZSAqLwotICAgIG1ib3hsaXN0X2ZpbmRhbGwoTlVMTCwgcGF0dGVy
biwgMSwgMCwgMCwgbWJveGxpc3RfY2hhbmdlcXVvdGEsICZjcm9jayk7CisgICAgbWJveGxpc3Rf
ZmluZGFsbCgmaW50ZXJuYWxfbmFtZXNwYWNlLCBwYXR0ZXJuLCAxLCAwLCAwLCBtYm94bGlzdF9j
aGFuZ2VxdW90YSwgJmNyb2NrKTsKICAgICAKICAgICByID0gcXVvdGFfd3JpdGUoJnF1b3RhLCAm
dGlkKTsKICAgICBpZiAoIXIpIHF1b3RhX2NvbW1pdCgmdGlkKTsKQEAgLTI0OTEsNyArMjQ2OCw3
IEBACiAgICAgICAgICAgICB9CiAgICAgICAgICAgICAvKiBzdWJtYWlsYm94ZXMgLSB3ZSdyZSB1
c2luZyBpbnRlcm5hbCBuYW1lcyBoZXJlICovCiAgICAgICAgICAgICBpZiAoIWspCi0gICAgICAg
ICAgICAgICAgayA9IG1ib3hsaXN0X2ZpbmRhbGwoTlVMTCwgcGF0dGVybiwgMSwgMCwgMCwgbWJv
eGxpc3RfY2hhbmdlcXVvdGEsICZjcm9jayk7CisgICAgICAgICAgICAgICAgayA9IG1ib3hsaXN0
X2ZpbmRhbGwoJmludGVybmFsX25hbWVzcGFjZSwgcGF0dGVybiwgMSwgMCwgMCwgbWJveGxpc3Rf
Y2hhbmdlcXVvdGEsICZjcm9jayk7CiAgICAgICAgICAgICBpZighaykKICAgICAgICAgICAgICAg
ICBrID0gcXVvdGFfd3JpdGUoJnJvb3RxdW90YSwgY3JvY2sudGlkKTsKIApAQCAtMjUwMCw3ICsy
NDc3LDcgQEAKICAgICAgICAgICAgLyogdG9wIGxldmVsIG1haWxib3ggKi8KICAgICAgICAgICAg
bWJveGxpc3Rfcm1xdW90YShyb290LCAwLCAwLCAodm9pZCAqKXJvb3QpOwogICAgICAgICAgICAv
KiBzdWJtYWlsYm94ZXMgLSB3ZSdyZSB1c2luZyBpbnRlcm5hbCBuYW1lcyBoZXJlICovCi0gICAg
ICAgICAgIG1ib3hsaXN0X2ZpbmRhbGwoTlVMTCwgcGF0dGVybiwgMSwgMCwgMCwgbWJveGxpc3Rf
cm1xdW90YSwgKHZvaWQgKilyb290KTsKKyAgICAgICAgICAgbWJveGxpc3RfZmluZGFsbCgmaW50
ZXJuYWxfbmFtZXNwYWNlLCBwYXR0ZXJuLCAxLCAwLCAwLCBtYm94bGlzdF9ybXF1b3RhLCAodm9p
ZCAqKXJvb3QpOwogICAgICAgIH0KICAgICB9CiAKQEAgLTI4MDYsNyArMjc4Myw2IEBACiAgICAg
aW50IHByZWZpeGxlbjsKICAgICBpbnQgdXNlcmxlbiA9IHVzZXJpZCA/IHN0cmxlbih1c2VyaWQp
IDogMCwgZG9tYWlubGVuID0gMDsKICAgICBjaGFyIGRvbWFpbnBhdFtNQVhfTUFJTEJPWF9OQU1F
KzFdOyAvKiBkbyBpbnRyYS1kb21haW4gZmV0Y2hlcyBvbmx5ICovCi0gICAgY2hhciAqcGF0ID0g
TlVMTDsKIAogICAgIGlmIChjb25maWdfdmlydGRvbWFpbnMgJiYgdXNlcmlkICYmIChwID0gc3Ry
Y2hyKHVzZXJpZCwgJ0AnKSkpIHsKIAl1c2VybGVuID0gcCAtIHVzZXJpZDsKQEAgLTI4MTYsOCAr
Mjc5MiwxMCBAQAogICAgIGVsc2UKIAlzdHJuY3B5KGRvbWFpbnBhdCwgcGF0dGVybiwgc2l6ZW9m
KGRvbWFpbnBhdCkpOwogCi0gICAgY2Jyb2NrLmcgPSBnbG9iX2luaXQocGF0dGVybiwgR0xPQl9I
SUVSQVJDSFl8R0xPQl9JTkJPWENBU0UpOwotICAgIGNicm9jay5uYW1lc3BhY2UgPSBOVUxMOwor
ICAgIG1ib3huYW1lX2hpZXJzZXBfdG9pbnRlcm5hbChuYW1lc3BhY2UsIGRvbWFpbnBhdCwgMCk7
CisKKyAgICBjYnJvY2suZyA9IGdsb2JfaW5pdChwYXR0ZXJuLCBuYW1lc3BhY2UtPmhpZXJfc2Vw
LCBHTE9CX0hJRVJBUkNIWXxHTE9CX0lOQk9YQ0FTRSk7CisgICAgY2Jyb2NrLm5hbWVzcGFjZSA9
IG5hbWVzcGFjZTsKICAgICBjYnJvY2suZG9tYWlubGVuID0gZG9tYWlubGVuOwogICAgIGNicm9j
ay5pbmJveGNhc2UgPSBnbG9iX2luYm94Y2FzZShjYnJvY2suZyk7CiAgICAgY2Jyb2NrLmlzYWRt
aW4gPSAxOwkJLyogdXNlciBjYW4gYWx3YXlzIHNlZSB0aGVpciBzdWJzICovCkBAIC0yODU3LDE2
ICsyODM1LDYgQEAKIAkgICAgfQogCSAgICBlbHNlIGlmIChyID09IENZUlVTREJfTk9URk9VTkQp
IHIgPSAwOwogCX0KLQllbHNlIGlmICghc3RybmNtcChwYXR0ZXJuLAotCQkJICB1c2VybWJveG5h
bWUrZG9tYWlubGVuLCB1c2VybWJveG5hbWVsZW4tZG9tYWlubGVuKSAmJgotCQkgR0xPQl9URVNU
KGNicm9jay5nLCB1c2VybWJveG5hbWUrZG9tYWlubGVuKSAhPSAtMSkgewotCSAgICByID0gU1VC
REItPmZldGNoKHN1YnMsIHVzZXJtYm94bmFtZSwgdXNlcm1ib3huYW1lbGVuLAotCQkJICAgICAm
ZGF0YSwgJmRhdGFsZW4sIE5VTEwpOwotCSAgICBpZiAoIXIgJiYgZGF0YSkgewotCQlyID0gKCpw
cm9jKSh1c2VybWJveG5hbWUsIHVzZXJtYm94bmFtZWxlbiwgMSwgcm9jayk7Ci0JICAgIH0KLQkg
ICAgZWxzZSBpZiAociA9PSBDWVJVU0RCX05PVEZPVU5EKSByID0gMDsKLQl9CiAJc3RybGNhdCh1
c2VybWJveG5hbWUsICIuIiwgc2l6ZW9mKHVzZXJtYm94bmFtZSkpOwogCXVzZXJtYm94bmFtZWxl
bisrOwogCkBAIC0yODc2LDMzICsyODQ0LDE4IEBACiAKICAgICBpZiAocikgZ290byBkb25lOwog
Ci0gICAgLyogTWFrZSBhIHdvcmtpbmcgY29weSBvZiBwYXR0ZXJuICovCi0gICAgcGF0dGVybiA9
IHBhdCA9IHhzdHJkdXAocGF0dGVybik7Ci0KICAgICAvKiBGaW5kIGZpeGVkLXN0cmluZyBwYXR0
ZXJuIHByZWZpeCAqLwotICAgIGZvciAocCA9IHBhdDsgKnA7IHArKykgeworICAgIGZvciAocCA9
IChjaGFyICopcGF0dGVybjsgKnA7IHArKykgewogCWlmICgqcCA9PSAnKicgfHwgKnAgPT0gJyUn
IHx8ICpwID09ICc/JyB8fCAqcCA9PSAnQCcpIGJyZWFrOwogICAgIH0KICAgICBwcmVmaXhsZW4g
PSBwIC0gcGF0dGVybjsKLSAgICAqcCA9ICdcMCc7CiAKICAgICAvKgogICAgICAqIElmIHVzZXIu
WC4qIG9yIElOQk9YLiogY2FuIG1hdGNoIHBhdHRlcm4sCiAgICAgICogc2VhcmNoIGZvciB0aG9z
ZSBtYWlsYm94ZXMgbmV4dAogICAgICAqLwotICAgIGlmICh1c2VyaWQgJiYKLQkoIXN0cm5jbXAo
dXNlcm1ib3huYW1lK2RvbWFpbmxlbiwgcGF0dGVybiwgdXNlcm1ib3huYW1lbGVuLWRvbWFpbmxl
bi0xKSB8fAotCSAhc3RybmNhc2VjbXAoImluYm94LiIsIHBhdHRlcm4sIHByZWZpeGxlbiA8IDYg
PyBwcmVmaXhsZW4gOiA2KSkpIHsKLQotCWlmICghc3RybmNtcCh1c2VybWJveG5hbWUrZG9tYWlu
bGVuLCBwYXR0ZXJuLCB1c2VybWJveG5hbWVsZW4tZG9tYWlubGVuLTEpKSB7Ci0JICAgIC8qIHN3
aXRjaCB0byBwYXR0ZXJuIHdpdGggZG9tYWluIHByZXBlbmRlZCAqLwotCSAgICBnbG9iX2ZyZWUo
JmNicm9jay5nKTsKLQkgICAgY2Jyb2NrLmcgPSBnbG9iX2luaXQoZG9tYWlucGF0LCBHTE9CX0hJ
RVJBUkNIWSk7Ci0JICAgIGNicm9jay5pbmJveG9mZnNldCA9IDA7Ci0JfQotCWVsc2UgewotCSAg
ICBjYnJvY2suaW5ib3hvZmZzZXQgPSBzdHJsZW4odXNlcmlkKTsKLQl9CisgICAgaWYgKHVzZXJp
ZCkgeworCWNicm9jay5pbmJveG9mZnNldCA9IGRvbWFpbmxlbiArIHVzZXJsZW47CiAKIAljYnJv
Y2suZmluZF9uYW1lc3BhY2UgPSBOQU1FU1BBQ0VfSU5CT1g7CiAJLyogaXRlcmF0ZSB0aHJvdWdo
IHByZWZpeGVzIG1hdGNoaW5nIHVzZXJtYm94bmFtZSAqLwpAQCAtMjkxOSw5ICsyODcyLDggQEAK
ICAgICB9CiAKICAgICBjYnJvY2suZmluZF9uYW1lc3BhY2UgPSBOQU1FU1BBQ0VfVVNFUjsKLSAg
ICAvKiBzd2l0Y2ggdG8gcGF0dGVybiB3aXRoIGRvbWFpbiBwcmVwZW5kZWQgKi8KICAgICBnbG9i
X2ZyZWUoJmNicm9jay5nKTsKLSAgICBjYnJvY2suZyA9IGdsb2JfaW5pdChkb21haW5wYXQsIEdM
T0JfSElFUkFSQ0hZKTsKKyAgICBjYnJvY2suZyA9IGdsb2JfaW5pdChwYXR0ZXJuLCBuYW1lc3Bh
Y2UtPmhpZXJfc2VwLCBHTE9CX0hJRVJBUkNIWSk7CiAgICAgY2Jyb2NrLmluYm94b2Zmc2V0ID0g
MDsKICAgICBpZiAodXNlcm1ib3huYW1lbGVuKSB7CiAJdXNlcm1ib3huYW1lWy0tdXNlcm1ib3hu
YW1lbGVuXSA9ICdcMCc7CkBAIC0yOTM2LDcgKzI4ODgsNiBAQAogICBkb25lOgogICAgIGlmIChz
dWJzKSBtYm94bGlzdF9jbG9zZXN1YnMoc3Vicyk7CiAgICAgZ2xvYl9mcmVlKCZjYnJvY2suZyk7
Ci0gICAgaWYgKHBhdCkgZnJlZShwYXQpOwogCiAgICAgcmV0dXJuIHI7CiB9CkBAIC0yOTY3LDcg
KzI5MTgsNyBAQAogICAgIGVsc2UKIAlkb21haW5wYXRbMF0gPSAnXDAnOwogCi0gICAgY2Jyb2Nr
LmcgPSBnbG9iX2luaXQocGF0dGVybiwgR0xPQl9ISUVSQVJDSFl8R0xPQl9JTkJPWENBU0UpOwor
ICAgIGNicm9jay5nID0gZ2xvYl9pbml0KHBhdHRlcm4sIG5hbWVzcGFjZS0+aGllcl9zZXAsIEdM
T0JfSElFUkFSQ0hZfEdMT0JfSU5CT1hDQVNFKTsKICAgICBjYnJvY2submFtZXNwYWNlID0gbmFt
ZXNwYWNlOwogICAgIGNicm9jay5kb21haW5sZW4gPSBkb21haW5sZW47CiAgICAgY2Jyb2NrLmlu
Ym94Y2FzZSA9IGdsb2JfaW5ib3hjYXNlKGNicm9jay5nKTsKQEAgLTMwMzQsOSArMjk4NSw4IEBA
CiAgICAgICogQXBwZW5kIHBhdHRlcm4gdG8gIklOQk9YLiIsIHNlYXJjaCBmb3IgdGhvc2Ugc3Vi
c2NyaXB0aW9ucyBuZXh0CiAgICAgICovCiAgICAgaWYgKHVzZXJpZCkgewotCXN0cmxjcHkocGF0
YnVmLCAiSU5CT1guIiwgc2l6ZW9mKHBhdGJ1ZikpOwotCXN0cmxjYXQocGF0YnVmLCBwYXR0ZXJu
LCBzaXplb2YocGF0YnVmKSk7Ci0JY2Jyb2NrLmcgPSBnbG9iX2luaXQocGF0YnVmLCBHTE9CX0hJ
RVJBUkNIWXxHTE9CX0lOQk9YQ0FTRSk7CisJLyogZG9uJ3QgdG91Y2ggdGhlIHBhdHRlcm4hICov
CisJY2Jyb2NrLmcgPSBnbG9iX2luaXQocGF0dGVybiwgbmFtZXNwYWNlLT5oaWVyX3NlcCwgR0xP
Ql9ISUVSQVJDSFl8R0xPQl9JTkJPWENBU0UpOwogCWNicm9jay5pbmJveGNhc2UgPSBnbG9iX2lu
Ym94Y2FzZShjYnJvY2suZyk7CiAJY2Jyb2NrLmluYm94b2Zmc2V0ID0gZG9tYWlubGVuK3VzZXJs
ZW47CiAJY2Jyb2NrLmZpbmRfbmFtZXNwYWNlID0gTkFNRVNQQUNFX0lOQk9YOwpAQCAtMzA3Miwx
NyArMzAyMiw4IEBACiAgICAgaWYgKCFzdHJuY21wKG5hbWVzcGFjZS0+cHJlZml4W05BTUVTUEFD
RV9VU0VSXSwgcGF0dGVybiwKIAkJIHByZWZpeGxlbiA8IGxlbiA/IHByZWZpeGxlbiA6IGxlbikp
IHsKIAotCWlmIChwcmVmaXhsZW4gPCBsZW4pIHsKLQkgICAgc3RybGNweShkb21haW5wYXQrZG9t
YWlubGVuLCBwYXR0ZXJuK3ByZWZpeGxlbiwKLQkJICAgIHNpemVvZihkb21haW5wYXQpLWRvbWFp
bmxlbik7Ci0JICAgIGNicm9jay5nID0gZ2xvYl9pbml0KGRvbWFpbnBhdCwgR0xPQl9ISUVSQVJD
SFkpOwotCX0KLQllbHNlIHsKLQkgICAgc3RybGNweShkb21haW5wYXQrZG9tYWlubGVuLCAidXNl
ciIsCi0JCSAgIHNpemVvZihkb21haW5wYXQpLWRvbWFpbmxlbik7Ci0JICAgIHN0cmxjYXQoZG9t
YWlucGF0LCBwYXR0ZXJuK2xlbiwgc2l6ZW9mKGRvbWFpbnBhdCkpOwotCSAgICBjYnJvY2suZyA9
IGdsb2JfaW5pdChkb21haW5wYXQsIEdMT0JfSElFUkFSQ0hZKTsKLQl9CisJLyogZG9uJ3QgdG91
Y2ggdGhlIHBhdHRlcm4hICovCisJY2Jyb2NrLmcgPSBnbG9iX2luaXQocGF0dGVybiwgbmFtZXNw
YWNlLT5oaWVyX3NlcCwgR0xPQl9ISUVSQVJDSFkpOwogCWNicm9jay5maW5kX25hbWVzcGFjZSA9
IE5BTUVTUEFDRV9VU0VSOwogCWNicm9jay5pbmJveG9mZnNldCA9IDA7CiAJCkBAIC0zMTE0LDEx
ICszMDU1LDExIEBACiAJICAgIC8qIFNraXAgcGF0dGVybiB3aGljaCBtYXRjaGVzIHNoYXJlZCBu
YW1lc3BhY2UgcHJlZml4ICovCiAJICAgIGZvciAocCA9IHBhdCtwcmVmaXhsZW47ICpwOyBwKysp
IHsKIAkJaWYgKCpwID09ICclJykgY29udGludWU7Ci0JCWVsc2UgaWYgKCpwID09ICcuJykgcCsr
OworCQllbHNlIGlmICgqcCA9PSBuYW1lc3BhY2UtPmhpZXJfc2VwKSBwKys7CiAJCWJyZWFrOwog
CSAgICB9CiAKLQkgICAgaWYgKCpwYXR0ZXJuICYmICFzdHJjaHIocGF0dGVybiwgJy4nKSAmJgor
CSAgICBpZiAoKnBhdHRlcm4gJiYgIXN0cmNocihwYXR0ZXJuLCBuYW1lc3BhY2UtPmhpZXJfc2Vw
KSAmJgogCQlwYXR0ZXJuW3N0cmxlbihwYXR0ZXJuKS0xXSA9PSAnJScpIHsKIAkJLyogc3BlY2lh
bCBjYXNlOiAgTFNVQiAiIiAqJSAtLSBvdXRwdXQgcHJlZml4ICovCiAgIAkJY2Jyb2NrLmNoZWNr
c2hhcmVkID0gMTsKQEAgLTMxMjcsMTQgKzMwNjgsMTEgQEAKIAkgICAgaWYgKChjYnJvY2suY2hl
Y2tzaGFyZWQgfHwgcHJlZml4bGVuID09IGxlbikgJiYgISpwKSB7CiAJCS8qIHNwZWNpYWwgY2Fz
ZTogIExTVUIgIiIgJSAtLSBvdXRwdXQgcHJlZml4CiAJCSAgIChpZiB3ZSBoYXZlIGEgc2hhcmVk
IG1ib3gpIGFuZCBxdWl0ICovCi0JCXN0cmxjcHkoZG9tYWlucGF0K2RvbWFpbmxlbiwgIioiLCBz
aXplb2YoZG9tYWlucGF0KS1kb21haW5sZW4pOwotCQljYnJvY2suZyA9IGdsb2JfaW5pdChkb21h
aW5wYXQsIEdMT0JfSElFUkFSQ0hZKTsKKwkJY2Jyb2NrLmcgPSBnbG9iX2luaXQoIioiLCBuYW1l
c3BhY2UtPmhpZXJfc2VwLCBHTE9CX0hJRVJBUkNIWSk7CiAJCWNicm9jay5jaGVja3NoYXJlZCA9
IDI7CiAJICAgIH0KLQkgICAgZWxzZSB7Ci0JCXN0cmxjcHkoZG9tYWlucGF0K2RvbWFpbmxlbiwg
cCwgc2l6ZW9mKGRvbWFpbnBhdCktZG9tYWlubGVuKTsKLQkJY2Jyb2NrLmcgPSBnbG9iX2luaXQo
ZG9tYWlucGF0LCBHTE9CX0hJRVJBUkNIWSk7Ci0JICAgIH0KKwkgICAgZWxzZQorCQljYnJvY2su
ZyA9IGdsb2JfaW5pdChwYXQsIG5hbWVzcGFjZS0+aGllcl9zZXAsIEdMT0JfSElFUkFSQ0hZKTsK
IAogCSAgICBkb21haW5wYXRbZG9tYWlubGVuXSA9ICdcMCc7CiAJICAgIFNVQkRCLT5mb3JlYWNo
KHN1YnMsCkBAIC0zMTQyLDEwICszMDgwLDkgQEAKIAkJCSAgICZmaW5kX3AsICZmaW5kX2NiLCAm
Y2Jyb2NrLAogCQkJICAgTlVMTCk7CiAJfQotCWVsc2UgaWYgKHBhdHRlcm5bbGVuXSA9PSAnLicp
IHsKLQkgICAgc3RybGNweShkb21haW5wYXQrZG9tYWlubGVuLCBwYXR0ZXJuK2xlbisxLAotCQkg
ICAgc2l6ZW9mKGRvbWFpbnBhdCktZG9tYWlubGVuKTsKLQkgICAgY2Jyb2NrLmcgPSBnbG9iX2lu
aXQoZG9tYWlucGF0LCBHTE9CX0hJRVJBUkNIWSk7CisJZWxzZSBpZiAocGF0dGVybltsZW5dID09
IG5hbWVzcGFjZS0+aGllcl9zZXApIHsKKwkgICAgc25wcmludGYoZG9tYWlucGF0K2RvbWFpbmxl
biwgc2l6ZW9mKGRvbWFpbnBhdCktZG9tYWlubGVuLCAiJS4qcyIsIHByZWZpeGxlbi0obGVuKzEp
LCBwYXR0ZXJuK2xlbisxKTsKKwkgICAgY2Jyb2NrLmcgPSBnbG9iX2luaXQocGF0dGVybiwgbmFt
ZXNwYWNlLT5oaWVyX3NlcCwgR0xPQl9ISUVSQVJDSFkpOwogCiAJICAgIFNVQkRCLT5mb3JlYWNo
KHN1YnMsCiAJCQkgICBkb21haW5wYXQsIGRvbWFpbmxlbitwcmVmaXhsZW4tKGxlbisxKSwKZGlm
ZiAtdXIgY3lydXMtaW1hcGQtMi4yLjEyLnN1cGVyb2xkL2ltYXAvbWJveGxpc3QuaCBjeXJ1cy1p
bWFwZC0yLjIuMTIvaW1hcC9tYm94bGlzdC5oCi0tLSBjeXJ1cy1pbWFwZC0yLjIuMTIuc3VwZXJv
bGQvaW1hcC9tYm94bGlzdC5oCTIwMDYtMDItMjAgMTg6MzY6MTUuMjI1MDg4MDAwICswMzAwCisr
KyBjeXJ1cy1pbWFwZC0yLjIuMTIvaW1hcC9tYm94bGlzdC5oCTIwMDYtMDItMjAgMTk6MDQ6NDUu
MjU5MTQwMDAwICswMzAwCkBAIC01MSw2ICs1MSw4IEBACiAjaW5jbHVkZSAibWJveG5hbWUuaCIK
IAogZXh0ZXJuIHN0cnVjdCBkYiAqbWJkYjsKKy8qIGludGVybmFsIG5hbWVzcGFjZSAoY29uc3Rh
bnQpICovCitleHRlcm4gc3RydWN0IG5hbWVzcGFjZSBpbnRlcm5hbF9uYW1lc3BhY2U7CiAKIC8q
CiAgKiBNYXhpbXVtIGxlbmd0aCBvZiBwYXJ0aXRpb24gbmFtZS4gW2NvbmZpZy5jIGhhcyBhIGxp
bWl0IG9mIDcwXQpkaWZmIC11ciBjeXJ1cy1pbWFwZC0yLjIuMTIuc3VwZXJvbGQvaW1hcC9tYm94
bmFtZS5jIGN5cnVzLWltYXBkLTIuMi4xMi9pbWFwL21ib3huYW1lLmMKLS0tIGN5cnVzLWltYXBk
LTIuMi4xMi5zdXBlcm9sZC9pbWFwL21ib3huYW1lLmMJMjAwNS0wMi0xNCAwOTozOTo1Ny4wMDAw
MDAwMDAgKzAzMDAKKysrIGN5cnVzLWltYXBkLTIuMi4xMi9pbWFwL21ib3huYW1lLmMJMjAwNi0w
Mi0yMCAxOTowNDo0NS4zODIyMDcwMDAgKzAzMDAKQEAgLTk1LDYgKzk1LDE0IEBACiB9OwogI2Rl
ZmluZSBDSEFSTU9ENjQoYykgIChpbmRleF9tb2Q2NFsodW5zaWduZWQgY2hhcikoYyldKQogCisv
KiBDaGVjayBtYWlsYm94IG5hbWUgZm9yIGNvcnJlY3QgaGllcnNlcHMgc3ltYm9scyBkZXBlbmRp
bmcgb24KKyAgIG5hbWVzcGFjZSAqLworc3RhdGljIGludCBtYm94bmFtZV9jaGVja19oaWVyc2Vw
cyhzdHJ1Y3QgbmFtZXNwYWNlICpuYW1lc3BhY2UsIGNvbnN0IGNoYXIgKm5hbWUsIGludCBuYW1l
bGVuKQoreworICAgIGlmKG5hbWVzcGFjZS0+aGllcl9zZXAgPT0gJy8nICYmIG1lbWNocihuYW1l
LCBET1RDSEFSLCBuYW1lbGVuKSkKKwlyZXR1cm4gLTE7CisgICAgcmV0dXJuIDA7Cit9CiAKIC8q
CiAgKiBDb252ZXJ0IHRoZSBleHRlcm5hbCBtYWlsYm94ICduYW1lJyB0byBhbiBpbnRlcm5hbCBu
YW1lLgpAQCAtMTE2LDYgKzEyNCw5IEBACiAgICAgdXNlcmxlbiA9IHVzZXJpZCA/IHN0cmxlbih1
c2VyaWQpIDogMDsKICAgICBuYW1lbGVuID0gc3RybGVuKG5hbWUpOwogCisgICAgaWYobWJveG5h
bWVfY2hlY2tfaGllcnNlcHMobmFtZXNwYWNlLCBuYW1lLCBuYW1lbGVuKSkKKwlyZXR1cm4gSU1B
UF9NQUlMQk9YX0JBRE5BTUU7CisKICAgICBpZiAoY29uZmlnX3ZpcnRkb21haW5zKSB7CiAJaWYg
KHVzZXJpZCAmJiAoY3AgPSBzdHJyY2hyKHVzZXJpZCwgJ0AnKSkpIHsKIAkgICAgLyogdXNlciBs
b2dnZWQgaW4gYXMgdXNlckBkb21haW4gKi8KQEAgLTIwNiw2ICsyMTcsOSBAQAogICAgIHVzZXJs
ZW4gPSB1c2VyaWQgPyBzdHJsZW4odXNlcmlkKSA6IDA7CiAgICAgbmFtZWxlbiA9IHN0cmxlbihu
YW1lKTsKIAorICAgIGlmKG1ib3huYW1lX2NoZWNrX2hpZXJzZXBzKG5hbWVzcGFjZSwgbmFtZSwg
bmFtZWxlbikpCisJcmV0dXJuIElNQVBfTUFJTEJPWF9CQUROQU1FOworCiAgICAgaWYgKGNvbmZp
Z192aXJ0ZG9tYWlucykgewogCWlmICh1c2VyaWQgJiYgKGNwID0gc3RyY2hyKHVzZXJpZCwgJ0An
KSkpIHsKIAkgICAgLyogdXNlciBsb2dnZWQgaW4gYXMgdXNlckBkb21haW4gKi8KQEAgLTQ2NCw1
NCArNDc4LDY4IEBACiAgICAgcmV0dXJuIDA7CiB9CiAKLS8qCi0gKiBDcmVhdGUgbmFtZXNwYWNl
IGJhc2VkIG9uIGNvbmZpZyBvcHRpb25zLgotICovCi1pbnQgbWJveG5hbWVfaW5pdF9uYW1lc3Bh
Y2Uoc3RydWN0IG5hbWVzcGFjZSAqbmFtZXNwYWNlLCBpbnQgaXNhZG1pbikKKy8qIEp1c3QgbGVh
dmUgdGhlIGlucHV0IG5hbWUgdW50b3VjaGVkLiBUaGlzIGlzIG5lZWRlZCBmb3IgaW50ZXJuYWwK
KyAgIG5hbWVzcGFjZSBvcGVyYXRpb25zLiAqLworc3RhdGljIGludCBtYm94bmFtZV90cmFuc2Zv
cm1fY29weShzdHJ1Y3QgbmFtZXNwYWNlICpuYW1lc3BhY2UsCisJCQkJICAgY29uc3QgY2hhciAq
bmFtZSwKKwkJCQkgICAgY29uc3QgY2hhciAqdXNlcmlkLCBjaGFyICpyZXN1bHQpCiB7Ci0gICAg
Y29uc3QgY2hhciAqcHJlZml4OworICAgIHN0cmNweShyZXN1bHQsIG5hbWUpOworICAgIHJldHVy
biAwOworfQogCisvKiBjcmVhdGUgbmFtZXNwYWNlIGJhc2VkIG9uIGdpdmVuIG9wdGlvbnMgKi8K
K2ludCBtYm94bmFtZV9pbml0X25hbWVzcGFjZV9leHQoc3RydWN0IG5hbWVzcGFjZSAqbmFtZXNw
YWNlLCBpbnQgaXNhZG1pbiwgY2hhciBoaWVyX3NlcCwgaW50IGlzYWx0KQorewogICAgIGFzc2Vy
dChuYW1lc3BhY2UgIT0gTlVMTCk7CiAKICAgICBuYW1lc3BhY2UtPmlzYWRtaW4gPSBpc2FkbWlu
OworICAgIGlmKGlzYWx0PDApIHsKKwluYW1lc3BhY2UtPmhpZXJfc2VwID0gJy4nOworCW5hbWVz
cGFjZS0+aXNhbHQgPSAwOworCW5hbWVzcGFjZS0+bWJveG5hbWVfdG9pbnRlcm5hbCA9IG1ib3hu
YW1lX3RyYW5zZm9ybV9jb3B5OworCW5hbWVzcGFjZS0+bWJveG5hbWVfdG9leHRlcm5hbCA9IG1i
b3huYW1lX3RyYW5zZm9ybV9jb3B5OworCW5hbWVzcGFjZS0+bWJveGxpc3RfZmluZGFsbCA9IG1i
b3hsaXN0X2ZpbmRhbGw7CisJbmFtZXNwYWNlLT5tYm94bGlzdF9maW5kc3ViID0gbWJveGxpc3Rf
ZmluZHN1YjsKKwlyZXR1cm4gMDsKKyAgICB9CisgICAgbmFtZXNwYWNlLT5oaWVyX3NlcCA9IGhp
ZXJfc2VwOworICAgIG5hbWVzcGFjZS0+aXNhbHQgPSBpc2FsdDsKKyAgICAKKyAgICBpZiAoaXNh
bHQ+MCkgeworCWNvbnN0IGNoYXIgKnByZWZpeDsKIAotICAgIG5hbWVzcGFjZS0+aGllcl9zZXAg
PQotCWNvbmZpZ19nZXRzd2l0Y2goSU1BUE9QVF9VTklYSElFUkFSQ0hZU0VQKSA/ICcvJyA6ICcu
JzsKLSAgICBuYW1lc3BhY2UtPmlzYWx0ID0gIWlzYWRtaW4gJiYgY29uZmlnX2dldHN3aXRjaChJ
TUFQT1BUX0FMVE5BTUVTUEFDRSk7Ci0KLSAgICBpZiAobmFtZXNwYWNlLT5pc2FsdCkgewogCS8q
IGFsdGVybmF0ZSBuYW1lc3BhY2UgKi8KIAlzdHJjcHkobmFtZXNwYWNlLT5wcmVmaXhbTkFNRVNQ
QUNFX0lOQk9YXSwgIiIpOwogCiAJcHJlZml4ID0gY29uZmlnX2dldHN0cmluZyhJTUFQT1BUX1VT
RVJQUkVGSVgpOwogCWlmICghcHJlZml4IHx8IHN0cmxlbihwcmVmaXgpID09IDAgfHwKIAkgICAg
c3RybGVuKHByZWZpeCkgPj0gTUFYX05BTUVTUEFDRV9QUkVGSVggfHwKLQkgICAgc3RyY2hyKHBy
ZWZpeCxuYW1lc3BhY2UtPmhpZXJfc2VwKSAhPSBOVUxMKQorCSAgICBzdHJjaHIocHJlZml4LGhp
ZXJfc2VwKSAhPSBOVUxMKQogCSAgICByZXR1cm4gSU1BUF9OQU1FU1BBQ0VfQkFEUFJFRklYOwog
CXNwcmludGYobmFtZXNwYWNlLT5wcmVmaXhbTkFNRVNQQUNFX1VTRVJdLCAiJS4qcyVjIiwKLQkJ
TUFYX05BTUVTUEFDRV9QUkVGSVgtMSwgcHJlZml4LCBuYW1lc3BhY2UtPmhpZXJfc2VwKTsKKwkJ
TUFYX05BTUVTUEFDRV9QUkVGSVgtMSwgcHJlZml4LCBoaWVyX3NlcCk7CiAKIAlwcmVmaXggPSBj
b25maWdfZ2V0c3RyaW5nKElNQVBPUFRfU0hBUkVEUFJFRklYKTsKIAlpZiAoIXByZWZpeCB8fCBz
dHJsZW4ocHJlZml4KSA9PSAwIHx8CiAJICAgIHN0cmxlbihwcmVmaXgpID49IE1BWF9OQU1FU1BB
Q0VfUFJFRklYIHx8Ci0JICAgIHN0cmNocihwcmVmaXgsIG5hbWVzcGFjZS0+aGllcl9zZXApICE9
IE5VTEwgfHwKKwkgICAgc3RyY2hyKHByZWZpeCwgaGllcl9zZXApICE9IE5VTEwgfHwKIAkgICAg
IXN0cm5jbXAobmFtZXNwYWNlLT5wcmVmaXhbTkFNRVNQQUNFX1VTRVJdLCBwcmVmaXgsIHN0cmxl
bihwcmVmaXgpKSkKIAkgICAgcmV0dXJuIElNQVBfTkFNRVNQQUNFX0JBRFBSRUZJWDsKIAlzcHJp
bnRmKG5hbWVzcGFjZS0+cHJlZml4W05BTUVTUEFDRV9TSEFSRURdLCAiJS4qcyVjIiwKLQkJTUFY
X05BTUVTUEFDRV9QUkVGSVgtMSwgcHJlZml4LCBuYW1lc3BhY2UtPmhpZXJfc2VwKTsgCisJCU1B
WF9OQU1FU1BBQ0VfUFJFRklYLTEsIHByZWZpeCwgaGllcl9zZXApOyAKIAogCW5hbWVzcGFjZS0+
bWJveG5hbWVfdG9pbnRlcm5hbCA9IG1ib3huYW1lX3RvaW50ZXJuYWxfYWx0OwogCW5hbWVzcGFj
ZS0+bWJveG5hbWVfdG9leHRlcm5hbCA9IG1ib3huYW1lX3RvZXh0ZXJuYWxfYWx0OwogCW5hbWVz
cGFjZS0+bWJveGxpc3RfZmluZGFsbCA9IG1ib3hsaXN0X2ZpbmRhbGxfYWx0OwogCW5hbWVzcGFj
ZS0+bWJveGxpc3RfZmluZHN1YiA9IG1ib3hsaXN0X2ZpbmRzdWJfYWx0OwogICAgIH0KLQogICAg
IGVsc2UgewogCS8qIHN0YW5kYXJkIG5hbWVzcGFjZSAqLwogCXNwcmludGYobmFtZXNwYWNlLT5w
cmVmaXhbTkFNRVNQQUNFX0lOQk9YXSwgIiVzJWMiLAotCQkiSU5CT1giLCBuYW1lc3BhY2UtPmhp
ZXJfc2VwKTsKKwkJIklOQk9YIiwgaGllcl9zZXApOwogCXNwcmludGYobmFtZXNwYWNlLT5wcmVm
aXhbTkFNRVNQQUNFX1VTRVJdLCAiJXMlYyIsCi0JCSJ1c2VyIiwgbmFtZXNwYWNlLT5oaWVyX3Nl
cCk7CisJCSJ1c2VyIiwgaGllcl9zZXApOwogCXN0cmNweShuYW1lc3BhY2UtPnByZWZpeFtOQU1F
U1BBQ0VfU0hBUkVEXSwgIiIpOwogCiAJbmFtZXNwYWNlLT5tYm94bmFtZV90b2ludGVybmFsID0g
bWJveG5hbWVfdG9pbnRlcm5hbDsKQEAgLTUyNCw2ICs1NTIsMTcgQEAKIH0KIAogLyoKKyAqIENy
ZWF0ZSBuYW1lc3BhY2UgYmFzZWQgb24gY29uZmlnIG9wdGlvbnMuCisgKi8KK2ludCBtYm94bmFt
ZV9pbml0X25hbWVzcGFjZShzdHJ1Y3QgbmFtZXNwYWNlICpuYW1lc3BhY2UsIGludCBpc2FkbWlu
KQoreworICAgIHJldHVybiBtYm94bmFtZV9pbml0X25hbWVzcGFjZV9leHQobmFtZXNwYWNlLAor
CQkJCSAgICAgICBpc2FkbWluLAorCQkJCSAgICAgICBjb25maWdfZ2V0c3dpdGNoKElNQVBPUFRf
VU5JWEhJRVJBUkNIWVNFUCkgPyAnLycgOiAnLicsCisJCQkJICAgICAgICFpc2FkbWluICYmIGNv
bmZpZ19nZXRzd2l0Y2goSU1BUE9QVF9BTFROQU1FU1BBQ0UpKTsKK30KKworLyoKICAqIFRyYW5z
bGF0ZSBzZXBhcmF0b3IgY2hhcmFjdG9ycyBpbiBhIG1haWxib3huYW1lIGZyb20gaXRzIGV4dGVy
bmFsCiAgKiByZXByZXNlbnRhdGlvbiB0byBpdHMgaW50ZXJuYWwgcmVwcmVzZW50YXRpb24gJy4n
LgogICogSWYgdXNpbmcgdGhlIHVuaXhoaWVyYXJjaHlzZXAgJy8nLCBhbGwgJy4ncyBnZXQgdHJh
bnNsYXRlZCB0byBET1RDSEFSLgpAQCAtNjY0LDcgKzcwMyw3IEBACiAKICAgICBpZiAoc3RybGVu
KG5hbWUpID4gTUFYX01BSUxCT1hfTkFNRSkgcmV0dXJuIElNQVBfTUFJTEJPWF9CQUROQU1FOwog
ICAgIGZvciAoaSA9IDA7IGkgPCBOVU1fQkFETUJPWFBBVFRFUk5TOyBpKyspIHsKLQlnID0gZ2xv
Yl9pbml0KGJhZG1ib3hwYXR0ZXJuc1tpXSwgMCk7CisJZyA9IGdsb2JfaW5pdChiYWRtYm94cGF0
dGVybnNbaV0sIHVuaXhzZXA/Jy8nOicuJywgMCk7CiAJaWYgKEdMT0JfVEVTVChnLCBuYW1lKSAh
PSAtMSkgewogCSAgICBnbG9iX2ZyZWUoJmcpOwogCSAgICByZXR1cm4gSU1BUF9NQUlMQk9YX0JB
RE5BTUU7CmRpZmYgLXVyIGN5cnVzLWltYXBkLTIuMi4xMi5zdXBlcm9sZC9pbWFwL21ib3huYW1l
LmggY3lydXMtaW1hcGQtMi4yLjEyL2ltYXAvbWJveG5hbWUuaAotLS0gY3lydXMtaW1hcGQtMi4y
LjEyLnN1cGVyb2xkL2ltYXAvbWJveG5hbWUuaAkyMDA0LTAzLTE5IDE3OjQ5OjE3LjAwMDAwMDAw
MCArMDMwMAorKysgY3lydXMtaW1hcGQtMi4yLjEyL2ltYXAvbWJveG5hbWUuaAkyMDA2LTAyLTIw
IDE5OjA0OjQ1LjQ1NjMzMTAwMCArMDMwMApAQCAtNzgsNiArNzgsOCBAQAogCQkJICAgIHZvaWQg
KnJvY2ssIGludCBmb3JjZSk7CiB9OwogCisvKiBjcmVhdGUgbmFtZXNwYWNlIGJhc2VkIG9uIGdp
dmVuIG9wdGlvbnMgKi8KK2ludCBtYm94bmFtZV9pbml0X25hbWVzcGFjZV9leHQoc3RydWN0IG5h
bWVzcGFjZSAqbmFtZXNwYWNlLCBpbnQgaXNhZG1pbiwgY2hhciBoaWVyX3NlcCwgaW50IGlzYWx0
KTsKIC8qIENyZWF0ZSBuYW1lc3BhY2UgYmFzZWQgb24gY29uZmlnIG9wdGlvbnMuICovCiBpbnQg
bWJveG5hbWVfaW5pdF9uYW1lc3BhY2Uoc3RydWN0IG5hbWVzcGFjZSAqbmFtZXNwYWNlLCBpbnQg
aXNhZG1pbik7CiAKZGlmZiAtdXIgY3lydXMtaW1hcGQtMi4yLjEyLnN1cGVyb2xkL2ltYXAvbXVw
ZGF0ZS5jIGN5cnVzLWltYXBkLTIuMi4xMi9pbWFwL211cGRhdGUuYwotLS0gY3lydXMtaW1hcGQt
Mi4yLjEyLnN1cGVyb2xkL2ltYXAvbXVwZGF0ZS5jCTIwMDYtMDItMjAgMTg6MzY6MTUuNDU5MjEz
MDAwICswMzAwCisrKyBjeXJ1cy1pbWFwZC0yLjIuMTIvaW1hcC9tdXBkYXRlLmMJMjAwNi0wMi0y
MCAxOTowNDo0NS41OTIwNjQwMDAgKzAzMDAKQEAgLTUyOSw2ICs1MjksMTIgQEAKIAlyZXR1cm4g
RUNfT1NFUlI7CiAgICAgfQogCisgICAgaWYobWJveG5hbWVfaW5pdF9uYW1lc3BhY2VfZXh0KCZp
bnRlcm5hbF9uYW1lc3BhY2UsCisJCQkJICAgMSwgJy4nLCAtMSkpIHsKKwlzeXNsb2coTE9HX0VS
UiwgIkNhbm5vdCBpbml0aWFsaXplIHRoZSBpbnRlcm5hbCBuYW1lc3BhY2UiKTsKKwlyZXR1cm4g
RUNfVEVNUEZBSUw7CisgICAgfQorCiAgICAgZGF0YWJhc2VfaW5pdCgpOwogCiAgICAgaWYgKCFt
YXN0ZXJwKSB7CkBAIC0xNjg4LDcgKzE2OTQsNyBAQAogICAgIGlmKEMtPmxpc3RfcHJlZml4KSBD
LT5saXN0X3ByZWZpeF9sZW4gPSBzdHJsZW4oQy0+bGlzdF9wcmVmaXgpOwogICAgIGVsc2UgQy0+
bGlzdF9wcmVmaXhfbGVuID0gMDsKICAgICAKLSAgICBtYm94bGlzdF9maW5kYWxsKE5VTEwsIHBh
dHRlcm4sIDEsIE5VTEwsCisgICAgbWJveGxpc3RfZmluZGFsbCgmaW50ZXJuYWxfbmFtZXNwYWNl
LCBwYXR0ZXJuLCAxLCBOVUxMLAogCQkgICAgIE5VTEwsIHNlbmR1cGRhdGUsICh2b2lkKilDKTsK
IAogICAgIEMtPnN0cmVhbWluZyA9IE5VTEw7CkBAIC0xNzM5LDcgKzE3NDUsNyBAQAogICAgIEMt
PnN0cmVhbWluZ19ob3N0cyA9IHBhcnRpYWw7CiAKICAgICAvKiBkdW1wIGluaXRpYWwgbGlzdCAq
LwotICAgIG1ib3hsaXN0X2ZpbmRhbGwoTlVMTCwgcGF0dGVybiwgMSwgTlVMTCwKKyAgICBtYm94
bGlzdF9maW5kYWxsKCZpbnRlcm5hbF9uYW1lc3BhY2UsIHBhdHRlcm4sIDEsIE5VTEwsCiAJCSAg
ICAgTlVMTCwgc2VuZHVwZGF0ZSwgKHZvaWQqKUMpOwogCiAgICAgcHRocmVhZF9tdXRleF91bmxv
Y2soJm1haWxib3hlc19tdXRleCk7IC8qIFVOTE9DSyAqLwpAQCAtMjE2Miw3ICsyMTY4LDcgQEAK
IAogICAgIHJvY2suYm94ZXMgPSAmbG9jYWxfYm94ZXM7CiAKLSAgICBtYm94bGlzdF9maW5kYWxs
KE5VTEwsIHBhdHRlcm4sIDEsIE5VTEwsCisgICAgbWJveGxpc3RfZmluZGFsbCgmaW50ZXJuYWxf
bmFtZXNwYWNlLCBwYXR0ZXJuLCAxLCBOVUxMLAogCQkgICAgIE5VTEwsIHN5bmNfZmluZGFsbF9j
YiwgKHZvaWQqKSZyb2NrKTsKIAogICAgIC8qIFRyYXZlcnNlIGJvdGggbGlzdHMsIGNvbXBhcmUg
dGhlIG5hbWVzICovCmRpZmYgLXVyIGN5cnVzLWltYXBkLTIuMi4xMi5zdXBlcm9sZC9pbWFwL25u
dHBkLmMgY3lydXMtaW1hcGQtMi4yLjEyL2ltYXAvbm50cGQuYwotLS0gY3lydXMtaW1hcGQtMi4y
LjEyLnN1cGVyb2xkL2ltYXAvbm50cGQuYwkyMDA2LTAyLTIwIDE4OjM2OjE1Ljc2ODIwMTAwMCAr
MDMwMAorKysgY3lydXMtaW1hcGQtMi4yLjEyL2ltYXAvbm50cGQuYwkyMDA2LTAyLTIwIDE5OjA0
OjQ1Ljc3NzYzNTAwMCArMDMwMApAQCAtNTMwLDYgKzUzMCwxMSBAQAogCWZhdGFsKCJ1bmFibGUg
dG8gaW5pdCBkdXBsaWNhdGUgZGVsaXZlcnkgZGF0YWJhc2UiLCBFQ19TT0ZUV0FSRSk7CiAgICAg
fQogCisgICAgLyogaW5pdGlhbGl6ZSB0aGUgaW50ZXJuYWwgbmFtZXNwYWNlIHN0cnVjdHVyZSAq
LworICAgIGlmKG1ib3huYW1lX2luaXRfbmFtZXNwYWNlX2V4dCgmaW50ZXJuYWxfbmFtZXNwYWNl
LAorCQkJCSAgIDEsICcuJywgLTEpKQorCWZhdGFsKCJjYW5ub3QgaW5pdGlhbGl6ZSB0aGUgaW50
ZXJuYWwgbmFtZXNwYWNlIiwgRUNfVEVNUEZBSUwpOworICAgIAogICAgIC8qIG9wZW4gdGhlIG1i
b3hsaXN0LCB3ZSdsbCBuZWVkIGl0IGZvciByZWFsIHdvcmsgKi8KICAgICBtYm94bGlzdF9pbml0
KDApOwogICAgIG1ib3hsaXN0X29wZW4oTlVMTCk7CkBAIC0yNTQ0LDcgKzI1NDksNyBAQAogCXN0
cmNweShwYXR0ZXJuLCBuZXdzcHJlZml4KTsKIAlzdHJjYXQocGF0dGVybiwgIioiKTsKIAlsaXN0
X2NiKE5VTEwsIDAsIDAsIE5VTEwpOwotCW1ib3hsaXN0X2ZpbmRhbGwoTlVMTCwgcGF0dGVybiwg
MCwgbm50cF91c2VyaWQsIG5udHBfYXV0aHN0YXRlLAorCW1ib3hsaXN0X2ZpbmRhbGwoJmludGVy
bmFsX25hbWVzcGFjZSwgcGF0dGVybiwgMCwgbm50cF91c2VyaWQsIG5udHBfYXV0aHN0YXRlLAog
CQkJIGxpc3RfY2IsICZscm9jayk7CiAKIAkvKiBwcm94eSB0byB0aGUgYmFja2VuZHMgKi8KQEAg
LTI2MDUsNyArMjYxMCw3IEBACiAJc3RyY3B5KHBhdHRlcm4sIG5ld3NwcmVmaXgpOwogCXN0cmNh
dChwYXR0ZXJuLCAiKiIpOwogCWxpc3RfY2IoTlVMTCwgMCwgMCwgTlVMTCk7Ci0JbWJveGxpc3Rf
ZmluZGFsbChOVUxMLCBwYXR0ZXJuLCAwLCBubnRwX3VzZXJpZCwgbm50cF9hdXRoc3RhdGUsCisJ
bWJveGxpc3RfZmluZGFsbCgmaW50ZXJuYWxfbmFtZXNwYWNlLCBwYXR0ZXJuLCAwLCBubnRwX3Vz
ZXJpZCwgbm50cF9hdXRoc3RhdGUsCiAJCQkgbGlzdF9jYiwgJmxyb2NrKTsKIAogCS8qIHByb3h5
IHRvIHRoZSBiYWNrZW5kcyAqLwpkaWZmIC11ciBjeXJ1cy1pbWFwZC0yLjIuMTIuc3VwZXJvbGQv
aW1hcC9wcm94eWQuYyBjeXJ1cy1pbWFwZC0yLjIuMTIvaW1hcC9wcm94eWQuYwotLS0gY3lydXMt
aW1hcGQtMi4yLjEyLnN1cGVyb2xkL2ltYXAvcHJveHlkLmMJMjAwNC0xMi0xNyAxOTozMjoyMC4w
MDAwMDAwMDAgKzAzMDAKKysrIGN5cnVzLWltYXBkLTIuMi4xMi9pbWFwL3Byb3h5ZC5jCTIwMDYt
MDItMjAgMTk6MDQ6NDYuMjE3MDU5MDAwICswMzAwCkBAIC0xMTQ4LDYgKzExNDgsMTEgQEAKICAg
ICAvKiBsb2FkIHRoZSBTQVNMIHBsdWdpbnMgKi8KICAgICBnbG9iYWxfc2FzbF9pbml0KDEsIDEs
IG15c2FzbF9jYik7CiAKKyAgICAvKiBpbml0aWFsaXplIHRoZSBpbnRlcm5hbCBuYW1lc3BhY2Ug
c3RydWN0dXJlICovCisgICAgaWYobWJveG5hbWVfaW5pdF9uYW1lc3BhY2VfZXh0KCZpbnRlcm5h
bF9uYW1lc3BhY2UsCisJCQkJICAgMSwgJy4nLCAtMSkpCisJZmF0YWwoImNhbm5vdCBpbml0aWFs
aXplIHRoZSBpbnRlcm5hbCBuYW1lc3BhY2UiLCBFQ19URU1QRkFJTCk7CisKICAgICAvKiBvcGVu
IHRoZSBtYm94bGlzdCwgd2UnbGwgbmVlZCBpdCBmb3IgcmVhbCB3b3JrICovCiAgICAgbWJveGxp
c3RfaW5pdCgwKTsKICAgICBtYm94bGlzdF9vcGVuKE5VTEwpOwpAQCAtMzc4NiwxMSArMzc5MSw2
IEBACiAJICAgIC8qIG5vb3AgKi8KIAl9CiAgICAgfSBlbHNlIGlmICghc3RyY2FzZWNtcChuYW1l
c3BhY2UsICJhbGwubWFpbGJveGVzIikpIHsKLQkvKiBUcmFuc2xhdGUgYW55IHNlcGFyYXRvcnMg
aW4gcGF0dGVybiAqLwotCW1ib3huYW1lX2hpZXJzZXBfdG9pbnRlcm5hbCgmcHJveHlkX25hbWVz
cGFjZSwgcGF0dGVybiwKLQkJCQkgICAgY29uZmlnX3ZpcnRkb21haW5zID8KLQkJCQkgICAgc3Ry
Y3NwbihwYXR0ZXJuLCAiQCIpIDogMCk7Ci0KIAkoKnByb3h5ZF9uYW1lc3BhY2UubWJveGxpc3Rf
ZmluZGFsbCkoJnByb3h5ZF9uYW1lc3BhY2UsIHBhdHRlcm4sCiAJCQkJCSAgICAgcHJveHlkX3Vz
ZXJpc2FkbWluLCBwcm94eWRfdXNlcmlkLAogCQkJCQkgICAgIHByb3h5ZF9hdXRoc3RhdGUsIG1h
aWxib3hkYXRhLApAQCAtMzg4MywxMSArMzg4Myw2IEBACiAJICAgIHBhdHRlcm4gPSBidWY7CiAJ
fQogCi0JLyogVHJhbnNsYXRlIGFueSBzZXBhcmF0b3JzIGluIHBhdHRlcm4gKi8KLQltYm94bmFt
ZV9oaWVyc2VwX3RvaW50ZXJuYWwoJnByb3h5ZF9uYW1lc3BhY2UsIHBhdHRlcm4sCi0gCQkJCSAg
ICBjb25maWdfdmlydGRvbWFpbnMgPwotIAkJCQkgICAgc3RyY3NwbihwYXR0ZXJuLCAiQCIpIDog
MCk7Ci0KIAkoKnByb3h5ZF9uYW1lc3BhY2UubWJveGxpc3RfZmluZGFsbCkoJnByb3h5ZF9uYW1l
c3BhY2UsIHBhdHRlcm4sCiAJCQkJCSAgICAgcHJveHlkX3VzZXJpc2FkbWluLCBwcm94eWRfdXNl
cmlkLAogCQkJCQkgICAgIHByb3h5ZF9hdXRoc3RhdGUsIGxpc3RkYXRhLCBOVUxMKTsKQEAgLTQy
MTEsOCArNDIwNiwxNiBAQAogICAgIGludCByOwogICAgIGNoYXIgKnRoaXNfc2VydmVyOwogICAg
IGNvbnN0IGNoYXIgKnNlcnZlcm5hbWUgPSAoY29uc3QgY2hhciAqKXJvY2s7CisgICAgY2hhciBp
bnRuYW1lW01BWF9NQUlMQk9YX05BTUUrMV07CisKKyAgICBpZigociA9ICgqcHJveHlkX25hbWVz
cGFjZS5tYm94bmFtZV90b2ludGVybmFsKSgmcHJveHlkX25hbWVzcGFjZSwKKwkJCQkJCSAgICBu
YW1lLAorCQkJCQkJICAgIHByb3h5ZF91c2VyaWQsCisJCQkJCQkgICAgaW50bmFtZSkpKQorCXJl
dHVybiByOwogICAgIAotICAgIHIgPSBtbG9va3VwKG5hbWUsICZ0aGlzX3NlcnZlciwgTlVMTCwg
TlVMTCk7CisgICAgCisgICAgciA9IG1sb29rdXAoaW50bmFtZSwgJnRoaXNfc2VydmVyLCBOVUxM
LCBOVUxMKTsKICAgICBpZihyKSByZXR1cm4gcjsKIAogICAgIGlmKHN0cmNtcChzZXJ2ZXJuYW1l
LCB0aGlzX3NlcnZlcikpIHsKQEAgLTQyNDcsNyArNDI1MCw3IEBACiAgICAgaWYoIXIpIHsKIAlz
ZXJ2ZXJfcm9jayA9IHhzdHJkdXAoc2VydmVyX3JvY2tfdG1wKTsKIAotCXNucHJpbnRmKHF1b3Rh
cm9vdGJ1Ziwgc2l6ZW9mKHF1b3Rhcm9vdGJ1ZiksICIlcy4qIiwgbWFpbGJveG5hbWUpOworCXNu
cHJpbnRmKHF1b3Rhcm9vdGJ1Ziwgc2l6ZW9mKHF1b3Rhcm9vdGJ1ZiksICIlcyVjKiIsIG5hbWUs
IHByb3h5ZF9uYW1lc3BhY2UuaGllcl9zZXApOwogCiAJciA9IG1ib3hsaXN0X2ZpbmRhbGwoJnBy
b3h5ZF9uYW1lc3BhY2UsIHF1b3Rhcm9vdGJ1ZiwKIAkJCSAgICAgcHJveHlkX3VzZXJpc2FkbWlu
LCBwcm94eWRfdXNlcmlkLApAQCAtNDM2Miw3ICs0MzY1LDcgQEAKICAgICBpZighcikgewogCXNl
cnZlcl9yb2NrID0geHN0cmR1cChzZXJ2ZXJfcm9ja190bXApOwogCi0Jc25wcmludGYocXVvdGFy
b290YnVmLCBzaXplb2YocXVvdGFyb290YnVmKSwgIiVzLioiLCBtYWlsYm94bmFtZSk7CisJc25w
cmludGYocXVvdGFyb290YnVmLCBzaXplb2YocXVvdGFyb290YnVmKSwgIiVzJWMqIiwgcXVvdGFy
b290LCBwcm94eWRfbmFtZXNwYWNlLmhpZXJfc2VwKTsKIAogCXIgPSBtYm94bGlzdF9maW5kYWxs
KCZwcm94eWRfbmFtZXNwYWNlLCBxdW90YXJvb3RidWYsCiAJCQkgICAgIHByb3h5ZF91c2VyaXNh
ZG1pbiwgcHJveHlkX3VzZXJpZCwKQEAgLTQ2MDUsNyArNDYwOCw3IEBACiAgICAgLyogbm93IGZp
bmQgYWxsIHRoZSBleGNpdGluZyB0b3BsZXZlbCBuYW1lc3BhY2VzIC0KICAgICAgKiB3ZSdyZSB1
c2luZyBpbnRlcm5hbCBuYW1lcyBoZXJlCiAgICAgICovCi0gICAgbWJveGxpc3RfZmluZGFsbChO
VUxMLCBwYXR0ZXJuLCBwcm94eWRfdXNlcmlzYWRtaW4sIHByb3h5ZF91c2VyaWQsCisgICAgbWJv
eGxpc3RfZmluZGFsbCgmaW50ZXJuYWxfbmFtZXNwYWNlLCBwYXR0ZXJuLCBwcm94eWRfdXNlcmlz
YWRtaW4sIHByb3h5ZF91c2VyaWQsCiAJCSAgICAgcHJveHlkX2F1dGhzdGF0ZSwgbmFtZXNwYWNl
ZGF0YSwgKHZvaWQqKSBzYXdvbmUpOwogCiAgICAgcHJvdF9wcmludGYocHJveHlkX291dCwgIiog
TkFNRVNQQUNFIik7CkBAIC00Njk3LDExICs0NzAwLDcgQEAKIAkJICAgICAgIGludCBtYXljcmVh
dGUgX19hdHRyaWJ1dGVfXygodW51c2VkKSksIAogCQkgICAgICAgdm9pZCogcm9jayBfX2F0dHJp
YnV0ZV9fKCh1bnVzZWQpKSkKIHsKLSAgICBjaGFyIG1ib3huYW1lW01BWF9NQUlMQk9YX1BBVEgr
MV07Ci0KLSAgICAoKnByb3h5ZF9uYW1lc3BhY2UubWJveG5hbWVfdG9leHRlcm5hbCkoJnByb3h5
ZF9uYW1lc3BhY2UsIG5hbWUsCi0JCQkJCSAgICBwcm94eWRfdXNlcmlkLCBtYm94bmFtZSk7Ci0g
ICAgcHJvdF9wcmludGYocHJveHlkX291dCwgIiogTUFJTEJPWCAlc1xyXG4iLCBtYm94bmFtZSk7
CisgICAgcHJvdF9wcmludGYocHJveHlkX291dCwgIiogTUFJTEJPWCAlc1xyXG4iLCBuYW1lKTsK
ICAgICByZXR1cm4gMDsKIH0KIApkaWZmIC11ciBjeXJ1cy1pbWFwZC0yLjIuMTIuc3VwZXJvbGQv
aW1hcC9xdW90YS5jIGN5cnVzLWltYXBkLTIuMi4xMi9pbWFwL3F1b3RhLmMKLS0tIGN5cnVzLWlt
YXBkLTIuMi4xMi5zdXBlcm9sZC9pbWFwL3F1b3RhLmMJMjAwNC0wNi0zMCAyMzoyMzoyNi4wMDAw
MDAwMDAgKzA0MDAKKysrIGN5cnVzLWltYXBkLTIuMi4xMi9pbWFwL3F1b3RhLmMJMjAwNi0wMi0y
MCAxOTowNDo0Ni4zOTY5ODEwMDAgKzAzMDAKQEAgLTI5Nyw3ICsyOTcsNyBAQAogLyoKICAqIEFj
Y291bnQgZm9yIG1haWxib3ggJ25hbWUnIHdoZW4gZml4aW5nIHRoZSBxdW90YSByb290cwogICov
Ci1pbnQgZml4cXVvdGFfbWFpbGJveChjaGFyICpuYW1lLAoraW50IGZpeHF1b3RhX21haWxib3go
Y2hhciAqZXh0bmFtZSwKIAkJICAgICBpbnQgbWF0Y2hsZW4gX19hdHRyaWJ1dGVfXygodW51c2Vk
KSksCiAJCSAgICAgaW50IG1heWNyZWF0ZSBfX2F0dHJpYnV0ZV9fKCh1bnVzZWQpKSwKIAkJICAg
ICB2b2lkKiByb2NrKQpAQCAtMzA3LDcgKzMwNywxMCBAQAogICAgIGludCBpLCBsZW4sIHRoaXNx
dW90YSwgdGhpc3F1b3RhbGVuOwogICAgIHN0cnVjdCBmaXhfcm9jayAqZnJvY2sgPSAoc3RydWN0
IGZpeF9yb2NrICopIHJvY2s7CiAgICAgY2hhciAqcCwgKmRvbWFpbiA9IGZyb2NrLT5kb21haW47
CisgICAgY2hhciBuYW1lW01BWF9NQUlMQk9YX1BBVEgrMV07CiAKKyAgICBpZigoKnF1b3RhX25h
bWVzcGFjZS5tYm94bmFtZV90b2ludGVybmFsKSgmcXVvdGFfbmFtZXNwYWNlLCBleHRuYW1lLAor
CQkJCQkgICAgIE5VTEwsIG5hbWUpKTsKICAgICAvKiBtYWtlIHN1cmUgdGhlIGRvbWFpbnMgbWF0
Y2ggKi8KICAgICBpZiAoZG9tYWluICYmCiAJKCEocCA9IHN0cmNocihuYW1lLCAnIScpKSB8fCAo
cCAtIG5hbWUpICE9IHN0cmxlbihkb21haW4pIHx8CmRpZmYgLXVyIGN5cnVzLWltYXBkLTIuMi4x
Mi5zdXBlcm9sZC9pbWFwL3JlY29uc3RydWN0LmMgY3lydXMtaW1hcGQtMi4yLjEyL2ltYXAvcmVj
b25zdHJ1Y3QuYwotLS0gY3lydXMtaW1hcGQtMi4yLjEyLnN1cGVyb2xkL2ltYXAvcmVjb25zdHJ1
Y3QuYwkyMDA0LTEwLTExIDE4OjAxOjI0LjAwMDAwMDAwMCArMDQwMAorKysgY3lydXMtaW1hcGQt
Mi4yLjEyL2ltYXAvcmVjb25zdHJ1Y3QuYwkyMDA2LTAyLTIwIDE5OjA0OjQ2LjUzMzk1MTAwMCAr
MDMwMApAQCAtMTI1LDcgKzEyNSw3IEBACiAgICAgaW50IG1mbGFnID0gMDsKICAgICBpbnQgZmZs
YWcgPSAwOwogICAgIGludCB4ZmxhZyA9IDA7Ci0gICAgY2hhciBidWZbTUFYX01BSUxCT1hfUEFU
SCsxXTsKKyAgICBjaGFyIGJ1ZltNQVhfTUFJTEJPWF9QQVRIKzFdPSIiOwogICAgIGNoYXIgbWJi
dWZbTUFYX01BSUxCT1hfUEFUSCsxXTsKICAgICBzdHJ1Y3QgZGlzY292ZXJlZCBoZWFkOwogICAg
IGNoYXIgKmFsdF9jb25maWcgPSBOVUxMOwpAQCAtMjc5LDIzICsyNzksMjggQEAKICAgICBmb3Ig
KGkgPSBvcHRpbmQ7IGkgPCBhcmdjOyBpKyspIHsKIAljaGFyICpkb21haW4gPSBOVUxMOwogCisJ
aWYoc3RybGVuKGFyZ3ZbaV0pPk1BWF9NQUlMQk9YX1BBVEgpCisJICAgIGNvbnRpbnVlOworCiAJ
Lyogc2F2ZSBkb21haW4gKi8KIAlpZiAoY29uZmlnX3ZpcnRkb21haW5zKSBkb21haW4gPSBzdHJj
aHIoYXJndltpXSwgJ0AnKTsKLQotCXN0cmxjcHkoYnVmLCBhcmd2W2ldLCBzaXplb2YoYnVmKSk7
Ci0JLyogVHJhbnNsYXRlIGFueSBzZXBhcmF0b3JzIGluIG1haWxib3huYW1lICovCi0JbWJveG5h
bWVfaGllcnNlcF90b2ludGVybmFsKCZyZWNvbl9uYW1lc3BhY2UsIGJ1ZiwKLQkJCQkgICAgY29u
ZmlnX3ZpcnRkb21haW5zID8KLQkJCQkgICAgc3RyY3NwbihidWYsICJAIikgOiAwKTsKLQorCQog
CS8qIHJlY29uc3RydWN0IHRoZSBmaXJzdCBtYWlsYm94L3BhdHRlcm4gKi8KLQkoKnJlY29uX25h
bWVzcGFjZS5tYm94bGlzdF9maW5kYWxsKSgmcmVjb25fbmFtZXNwYWNlLCBidWYsIDEsIDAsCisJ
KCpyZWNvbl9uYW1lc3BhY2UubWJveGxpc3RfZmluZGFsbCkoJnJlY29uX25hbWVzcGFjZSwgYXJn
dltpXSwgMSwgMCwKIAkJCQkJICAgIDAsIGRvX3JlY29uc3RydWN0LCAKIAkJCQkJICAgIGZmbGFn
ID8gJmhlYWQgOiBOVUxMKTsKIAlpZiAocmZsYWcpIHsKLQkgICAgLyogYnVpbGQgYSBwYXR0ZXJu
IGZvciBzdWJtYWlsYm94ZXMgKi8KLQkgICAgLyogWFhYIG1ib3hsaXN0X2ZpbmRhbGwoKSBpcyBk
ZXN0cnVjdGl2ZSBhbmQgcmVtb3ZlcyBkb21haW4gKi8KLQkgICAgc3RybGNhdChidWYsICIuKiIs
IHNpemVvZihidWYpKTsKKwkgICAgaW50IGJ1ZmxlbjsKKworCSAgICBpZihkb21haW4pIHsKKwkJ
bWVtY3B5KGJ1ZiwgYXJndltpXSwgZG9tYWluIC0gYXJndltpXSk7CisJCWJ1Zltkb21haW4gLSBh
cmd2W2ldXT0wOworCSAgICB9CisJICAgIGVsc2UKKwkJc3RyY3B5KGJ1ZiwgYXJndltpXSk7CisK
KwkgICAgYnVmbGVuPXN0cmxlbihidWYpOworCSAgICBzbnByaW50ZihidWYrYnVmbGVuLCBzaXpl
b2YoYnVmKS1idWZsZW4sICIlYypAIiwgcmVjb25fbmFtZXNwYWNlLmhpZXJfc2VwKTsKIAogCSAg
ICAvKiBhcHBlbmQgdGhlIGRvbWFpbiAqLwogCSAgICBpZiAoZG9tYWluKSBzdHJsY2F0KGJ1Ziwg
ZG9tYWluLCBzaXplb2YoYnVmKSk7CkBAIC0zMTEsMTkgKzMxNiwyMiBAQAogICAgIHdoaWxlICho
ZWFkLm5leHQpIHsKIAlzdHJ1Y3QgZGlzY292ZXJlZCAqcDsKIAlpbnQgciA9IDA7CisJaW50IHNh
dmVkX3I7CiAKIAlwID0gaGVhZC5uZXh0OwogCWhlYWQubmV4dCA9IHAtPm5leHQ7CiAKIAkvKiBj
cmVhdGUgcCAoZGF0YWJhc2Ugb25seSkgYW5kIHJlY29uc3RydWN0IGl0ICovCiAJLyogcGFydGl0
aW9uIGlzIGRlZmluZWQgYnkgdGhlIHBhcmVudCBtYWlsYm94ICovCi0JciA9IG1ib3hsaXN0X2Ny
ZWF0ZW1haWxib3gocC0+bmFtZSwgMCwgTlVMTCwgMSwKKwlzYXZlZF9yID0gbWJveGxpc3RfY3Jl
YXRlbWFpbGJveChwLT5uYW1lLCAwLCBOVUxMLCAxLAogCQkJCSAgICJjeXJ1cyIsIE5VTEwsIDAs
IDAsICF4ZmxhZyk7Ci0JaWYgKCFyKSB7Ci0JICAgIGRvX3JlY29uc3RydWN0KHAtPm5hbWUsIHN0
cmxlbihwLT5uYW1lKSwgMCwgJmhlYWQpOworCXIgPSAoKnJlY29uX25hbWVzcGFjZS5tYm94bmFt
ZV90b2V4dGVybmFsKSgmcmVjb25fbmFtZXNwYWNlLCBwLT5uYW1lLAorCQkJCQkJICAgImN5cnVz
IiwgYnVmKTsKKwlpZiAoIXNhdmVkX3IpIHsKKwkgICAgZG9fcmVjb25zdHJ1Y3QoYnVmLCBzdHJs
ZW4ocC0+bmFtZSksIDAsICZoZWFkKTsKIAl9IGVsc2UgewogCSAgICBmcHJpbnRmKHN0ZGVyciwg
ImNyZWF0ZW1haWxib3ggJXM6ICVzXG4iLAotCQkgICAgcC0+bmFtZSwgZXJyb3JfbWVzc2FnZShy
KSk7CisJCSAgICByP3AtPm5hbWU6YnVmLCBlcnJvcl9tZXNzYWdlKHNhdmVkX3IpKTsKIAl9CiAJ
LyogbWF5IGhhdmUgYWRkZWQgbW9yZSB0aGluZ3MgaW50byBvdXIgbGlzdCAqLwogCkBAIC0zNzEs
NiArMzc5LDE0IEBACiAgICAgY2hhciBidWZbTUFYX01BSUxCT1hfUEFUSCsxXTsKICAgICBzdGF0
aWMgY2hhciBsYXN0bmFtZVtNQVhfTUFJTEJPWF9QQVRIKzFdID0gIiI7CiAKKyAgICByID0gKCpy
ZWNvbl9uYW1lc3BhY2UubWJveG5hbWVfdG9pbnRlcm5hbCkoJnJlY29uX25hbWVzcGFjZSwgbmFt
ZSwKKwkJCQkJICAgICAgIE5VTEwsIGJ1Zik7CisgICAgaWYgKHIpIHsKKwljb21fZXJyKG5hbWUs
IHIsIE5VTEwpOworCWNvZGUgPSBjb252ZXJ0X2NvZGUocik7CisJcmV0dXJuIDA7CisgICAgfQor
CiAgICAgc2lnbmFsc19wb2xsKCk7CiAKICAgICAvKiBkb24ndCByZXBlYXQgKi8KQEAgLTM4Mywx
NSArMzk5LDEyIEBACiAgICAgc3RybmNweShsYXN0bmFtZSwgbmFtZSwgbWF0Y2hsZW4pOwogICAg
IGxhc3RuYW1lW21hdGNobGVuXSA9ICdcMCc7CiAKLSAgICByID0gcmVjb25zdHJ1Y3QobGFzdG5h
bWUsIHJvY2spOworICAgIHIgPSByZWNvbnN0cnVjdChidWYsIHJvY2spOwogICAgIGlmIChyKSB7
CiAJY29tX2VycihuYW1lLCByLCAociA9PSBJTUFQX0lPRVJST1IpID8gZXJyb3JfbWVzc2FnZShl
cnJubykgOiBOVUxMKTsKIAljb2RlID0gY29udmVydF9jb2RlKHIpOwogICAgIH0gZWxzZSB7Ci0J
LyogQ29udmVydCBpbnRlcm5hbCBuYW1lIHRvIGV4dGVybmFsICovCi0JKCpyZWNvbl9uYW1lc3Bh
Y2UubWJveG5hbWVfdG9leHRlcm5hbCkoJnJlY29uX25hbWVzcGFjZSwgbGFzdG5hbWUsCi0JCQkJ
CSAgICAgICBOVUxMLCBidWYpOwotCXByaW50ZigiJXNcbiIsIGJ1Zik7CisJcHJpbnRmKCIlc1xu
IiwgbmFtZSk7CiAgICAgfQogCiAgICAgcmV0dXJuIDA7CmRpZmYgLXVyIGN5cnVzLWltYXBkLTIu
Mi4xMi5zdXBlcm9sZC9pbWFwL3NxdWF0dGVyLmMgY3lydXMtaW1hcGQtMi4yLjEyL2ltYXAvc3F1
YXR0ZXIuYwotLS0gY3lydXMtaW1hcGQtMi4yLjEyLnN1cGVyb2xkL2ltYXAvc3F1YXR0ZXIuYwky
MDA0LTA1LTIyIDA3OjQ1OjUyLjAwMDAwMDAwMCArMDQwMAorKysgY3lydXMtaW1hcGQtMi4yLjEy
L2ltYXAvc3F1YXR0ZXIuYwkyMDA2LTAyLTIwIDE5OjA0OjQ2LjY1MTEyOTAwMCArMDMwMApAQCAt
Mjk4LDkgKzI5OCwxMyBAQAogICAgIHN0cnVjdCBzdGF0IGluZGV4X2ZpbGVfaW5mbzsKICAgICBz
dHJ1Y3Qgc3RhdCB0bXBfZmlsZV9pbmZvOwogICAgIGNoYXIgdWlkX3ZhbGlkaXR5X2J1ZlszMF07
Ci0gICAgY2hhciBleHRuYW1lW01BWF9NQUlMQk9YX05BTUUrMV07CisgICAgY2hhciBpbnRuYW1l
W01BWF9NQUlMQk9YX05BTUUrMV07CiAgICAgaW50IHVzZV9hbm5vdCA9ICooKGludCAqKSByb2Nr
KTsKIAorICAgIGlmKCgqc3F1YXRfbmFtZXNwYWNlLm1ib3huYW1lX3RvaW50ZXJuYWwpKCZzcXVh
dF9uYW1lc3BhY2UsIG5hbWUsCisJCQkJCSAgICAgTlVMTCwgaW50bmFtZSkpCisJcmV0dXJuIDE7
CisKICAgICAvKiBtYWtlIHN1cmUgdGhlIG1haWxib3ggKG9yIGFuIGFuY2VzdG9yKSBoYXMKICAg
ICAgICAvdmVuZG9yL2NtdS9jeXJ1cy1pbWFwZC9zcXVhdCBzZXQgdG8gInRydWUiICovCiAgICAg
aWYgKHVzZV9hbm5vdCkgewpAQCAtMzExLDcgKzMxNSw3IEBACiAJaWYgKGNvbmZpZ192aXJ0ZG9t
YWlucyAmJiAocCA9IHN0cmNocihuYW1lLCAnIScpKSkKIAkgICAgZG9tYWlubGVuID0gcCAtIG5h
bWUgKyAxOwogCi0Jc3RybGNweShidWYsIG5hbWUsIHNpemVvZihidWYpKTsKKwlzdHJsY3B5KGJ1
ZiwgaW50bmFtZSwgc2l6ZW9mKGJ1ZikpOwogCiAJLyogc2luY2UgbWFpbGJveGVzIGluaGVyaXQg
L3ZlbmRvci9jbXUvY3lydXMtaW1hcGQvc3F1YXQsCiAJICAgd2UgbmVlZCB0byBpdGVyYXRlIGFs
bCB0aGUgd2F5IHVwIHRvICIiIChzZXJ2ZXIgZW50cnkpICovCkBAIC0zMzksMjAgKzM0MywxNiBA
QAogCSAgICByZXR1cm4gMDsKICAgICB9CiAKLSAgICAvKiBDb252ZXJ0IGludGVybmFsIG5hbWUg
dG8gZXh0ZXJuYWwgKi8KLSAgICAoKnNxdWF0X25hbWVzcGFjZS5tYm94bmFtZV90b2V4dGVybmFs
KSgmc3F1YXRfbmFtZXNwYWNlLCBuYW1lLAotCQkJCQkgICBOVUxMLCBleHRuYW1lKTsKLQogICAg
IGRhdGEubWFpbGJveF9zdGF0cyA9ICZzdGF0czsKICAgICBkYXRhLm1haWxib3ggPSAmbTsKIAog
ICAgIC8qIEZpcnN0IHdlIGhhdmUgdG8ganVtcCB0aHJvdWdoIGhvb3BzIHRvIG9wZW4gdGhlIG1h
aWxib3ggYW5kIGl0cwogICAgICAgIEN5cnVzIGluZGV4LiAqLwogICAgIG1lbXNldCgmbSwgMCwg
c2l6ZW9mKHN0cnVjdCBtYWlsYm94KSk7Ci0gICAgciA9IG1haWxib3hfb3Blbl9oZWFkZXIobmFt
ZSwgMCwgJm0pOworICAgIHIgPSBtYWlsYm94X29wZW5faGVhZGVyKGludG5hbWUsIDAsICZtKTsK
ICAgICBpZiAocikgewogICAgICAgICBpZiAodmVyYm9zZSkgewotICAgICAgICAgICAgcHJpbnRm
KCJlcnJvciBvcGVuaW5nICVzOiAlc1xuIiwgZXh0bmFtZSwgZXJyb3JfbWVzc2FnZShyKSk7Cisg
ICAgICAgICAgICBwcmludGYoImVycm9yIG9wZW5pbmcgJXM6ICVzXG4iLCBuYW1lLCBlcnJvcl9t
ZXNzYWdlKHIpKTsKICAgICAgICAgfQogICAgICAgICByZXR1cm4gMTsKICAgICB9CkBAIC0zNjEs
NyArMzYxLDcgQEAKICAgICBpZiAoIXIpIHIgPSBtYWlsYm94X2xvY2tfcG9wKCZtKTsKICAgICBp
ZiAocikgewogICAgICAgICBpZiAodmVyYm9zZSkgewotICAgICAgICAgICAgcHJpbnRmKCJlcnJv
ciBsb2NraW5nIGluZGV4ICVzOiAlc1xuIiwgZXh0bmFtZSwgZXJyb3JfbWVzc2FnZShyKSk7Cisg
ICAgICAgICAgICBwcmludGYoImVycm9yIGxvY2tpbmcgaW5kZXggJXM6ICVzXG4iLCBuYW1lLCBl
cnJvcl9tZXNzYWdlKHIpKTsKICAgICAgICAgfQogICAgICAgICBtYWlsYm94X2Nsb3NlKCZtKTsK
ICAgICAgICAgcmV0dXJuIDE7CkBAIC0zNzgsOSArMzc4LDkgQEAKICAgICAgICAgIXN0YXQoaW5k
ZXhfZmlsZV9uYW1lLCAmaW5kZXhfZmlsZV9pbmZvKSkgewogICAgICAgICBpZiAoU0tJUF9GVVpa
ICsgdG1wX2ZpbGVfaW5mby5zdF9tdGltZSA8CiAgICAgICAgICAgICBpbmRleF9maWxlX2luZm8u
c3RfbXRpbWUpIHsKLSAgICAgICAgICAgIHN5c2xvZyhMT0dfREVCVUcsICJza2lwcGluZyBtYWls
Ym94ICVzIiwgZXh0bmFtZSk7CisgICAgICAgICAgICBzeXNsb2coTE9HX0RFQlVHLCAic2tpcHBp
bmcgbWFpbGJveCAlcyIsIG5hbWUpOwogICAgICAgICAgICAgaWYgKHZlcmJvc2UgPiAwKSB7Ci0g
ICAgICAgICAgICAgICAgcHJpbnRmKCJTa2lwcGluZyBtYWlsYm94ICVzXG4iLCBleHRuYW1lKTsK
KyAgICAgICAgICAgICAgICBwcmludGYoIlNraXBwaW5nIG1haWxib3ggJXNcbiIsIG5hbWUpOwog
ICAgICAgICAgICAgfQogICAgICAgICAgICAgbWFpbGJveF9jbG9zZSgmbSk7CiAgICAgICAgICAg
ICByZXR1cm4gMDsKQEAgLTM5MCw5ICszOTAsOSBAQAogICAgIHNucHJpbnRmKHRtcF9maWxlX25h
bWUsIHNpemVvZih0bXBfZmlsZV9uYW1lKSwKICAgICAgICAgICAgICAiJXMlcy50bXAiLCBtLnBh
dGgsIEZOQU1FX1NRVUFUX0lOREVYKTsKIAotICAgIHN5c2xvZyhMT0dfSU5GTywgImluZGV4aW5n
IG1haWxib3ggJXMuLi4gIiwgZXh0bmFtZSk7CisgICAgc3lzbG9nKExPR19JTkZPLCAiaW5kZXhp
bmcgbWFpbGJveCAlcy4uLiAiLCBuYW1lKTsKICAgICBpZiAodmVyYm9zZSA+IDApIHsKLSAgICAg
IHByaW50ZigiSW5kZXhpbmcgbWFpbGJveCAlcy4uLiAiLCBleHRuYW1lKTsKKyAgICAgIHByaW50
ZigiSW5kZXhpbmcgbWFpbGJveCAlcy4uLiAiLCBuYW1lKTsKICAgICB9CiAKICAgICBpZiAoKGZk
ID0gb3Blbih0bXBfZmlsZV9uYW1lLApAQCAtNTMxLDEyICs1MzEsOSBAQAogICAgIH0KIAogICAg
IGZvciAoaSA9IG9wdGluZDsgaSA8IGFyZ2M7IGkrKykgewotCS8qIFRyYW5zbGF0ZSBhbnkgc2Vw
YXJhdG9ycyBpbiBtYWlsYm94bmFtZSAqLwotCSgqc3F1YXRfbmFtZXNwYWNlLm1ib3huYW1lX3Rv
aW50ZXJuYWwpKCZzcXVhdF9uYW1lc3BhY2UsIGFyZ3ZbaV0sCi0JCQkJCSAgICAgICBOVUxMLCBi
dWYpOwotCWluZGV4X21lKGJ1ZiwgMCwgMCwgJnVzZV9hbm5vdCk7CisJaW5kZXhfbWUoYXJndltp
XSwgMCwgMCwgJnVzZV9hbm5vdCk7CiAJaWYgKHJmbGFnKSB7Ci0JICAgIHN0cmxjYXQoYnVmLCAi
LioiLCBzaXplb2YoYnVmKSk7CisJICAgIHNucHJpbnRmKGJ1Ziwgc2l6ZW9mKGJ1ZiksICIlcyVj
KiIsIGFyZ3ZbaV0sIHNxdWF0X25hbWVzcGFjZS5oaWVyX3NlcCk7CiAJICAgICgqc3F1YXRfbmFt
ZXNwYWNlLm1ib3hsaXN0X2ZpbmRhbGwpKCZzcXVhdF9uYW1lc3BhY2UsIGJ1ZiwgMSwKIAkJCQkJ
CTAsIDAsIGluZGV4X21lLCAmdXNlX2Fubm90KTsKIAl9CmRpZmYgLXVyIGN5cnVzLWltYXBkLTIu
Mi4xMi5zdXBlcm9sZC9pbWFwL3VzZXIuYyBjeXJ1cy1pbWFwZC0yLjIuMTIvaW1hcC91c2VyLmMK
LS0tIGN5cnVzLWltYXBkLTIuMi4xMi5zdXBlcm9sZC9pbWFwL3VzZXIuYwkyMDA0LTA2LTIyIDIw
OjU5OjE3LjAwMDAwMDAwMCArMDQwMAorKysgY3lydXMtaW1hcGQtMi4yLjEyL2ltYXAvdXNlci5j
CTIwMDYtMDItMjAgMTk6MDQ6NDYuNzQ2Mzc4MDAwICswMzAwCkBAIC0xODcsNyArMTg3LDcgQEAK
ICAgICAvKiB4eHggbm8gcmVhc29uIHRvIGRvIHRoaXMgaWYgdXNlcl9kZWxldGVhY2wgaXMgYSBz
dHViIGFueXdheS4gKi8KICAgICBpZih3aXBlX3VzZXIpIHsKIAljb25zdCBjaGFyIHBhdFtdID0g
IioiOwotCW1ib3hsaXN0X2ZpbmRhbGwoTlVMTCwgcGF0LCBzaXplb2YocGF0KSwgdXNlcmlkLAor
CW1ib3hsaXN0X2ZpbmRhbGwoJmludGVybmFsX25hbWVzcGFjZSwgcGF0LCBzaXplb2YocGF0KSwg
dXNlcmlkLAogCQkJIGF1dGhzdGF0ZSwgdXNlcl9kZWxldGVhY2wsCiAJCQkgdXNlcik7CiAgICAg
fQpAQCAtMzUwLDcgKzM1MCw3IEBACiAgICAgaWYgKCFyKSB7CiAJLyogY29weS9yZW5hbWUgc3Vi
c2NyaXB0aW9ucyAtIHdlJ3JlIHVzaW5nIHRoZSBpbnRlcm5hbCBuYW1lcyBoZXJlICovCiAJc3Ry
Y3B5KHBhdCwgIioiKTsKLQltYm94bGlzdF9maW5kc3ViKE5VTEwsIHBhdCwgMSwgb2xkdXNlciwg
YXV0aHN0YXRlLCB1c2VyX3JlbmFtZXN1YiwKKwltYm94bGlzdF9maW5kc3ViKCZpbnRlcm5hbF9u
YW1lc3BhY2UsIHBhdCwgMSwgb2xkdXNlciwgYXV0aHN0YXRlLCB1c2VyX3JlbmFtZXN1YiwKIAkJ
CSAmcnJvY2ssIDEpOwogICAgIH0KIApkaWZmIC11ciBjeXJ1cy1pbWFwZC0yLjIuMTIuc3VwZXJv
bGQvbGliL2dsb2IuYyBjeXJ1cy1pbWFwZC0yLjIuMTIvbGliL2dsb2IuYwotLS0gY3lydXMtaW1h
cGQtMi4yLjEyLnN1cGVyb2xkL2xpYi9nbG9iLmMJMjAwMy0xMi0wOCAyMzo1NzoxMy4wMDAwMDAw
MDAgKzAzMDAKKysrIGN5cnVzLWltYXBkLTIuMi4xMi9saWIvZ2xvYi5jCTIwMDYtMDItMjAgMTk6
MDQ6NDYuODQ0NTkxMDAwICswMzAwCkBAIC02Nyw4ICs2Nyw5IEBACiAgKiAgIDQpICcqJyBlYXRz
IGFsbCAnKidzIGFuZCAnJSdzIGNvbm5lY3RlZCBieSBhbnkgd2lsZGNhcmQKICAqICAgNSkgJyUn
IGVhdHMgYWxsIGFkamFjZW50ICclJ3MKICAqLwotZ2xvYiAqZ2xvYl9pbml0X3N1cHByZXNzIChz
dHIsIGZsYWdzLCBzdXBwcmVzcykKK2dsb2IgKmdsb2JfaW5pdF9zdXBwcmVzcyAoc3RyLCBzZXBf
Y2hhciwgZmxhZ3MsIHN1cHByZXNzKQogICAgIGNvbnN0IGNoYXIgKnN0cjsKKyAgICBjaGFyIHNl
cF9jaGFyOwogICAgIGludCBmbGFnczsKICAgICBjb25zdCBjaGFyICpzdXBwcmVzczsKIHsKQEAg
LTgxLDcgKzgyLDcgQEAKICAgICBnID0gKGdsb2IgKikgeG1hbGxvYyhzaXplb2YgKGdsb2IpICsg
c2xlbiArIHN0cmxlbihzdHIpICsgMSk7CiAgICAgaWYgKGcgIT0gMCkgewogICAgICAgICBzdHJj
cHkoZy0+aW5ib3gsIGluYm94KTsKLQlnLT5zZXBfY2hhciA9ICcuJzsKKwlnLT5zZXBfY2hhciA9
IHNlcF9jaGFyOwogCWRzdCA9IGctPnN0cjsKIAkvKiBpZiB3ZSdyZSBkb2luZyBhIHN1YnN0cmlu
ZyBtYXRjaCwgcHV0IGEgJyonIHByZWZpeCAoMSkgKi8KIAlpZiAoZmxhZ3MgJiBHTE9CX1NVQlNU
UklORykgewpAQCAtMjg0LDI5ICsyODUsMjcgQEAKIAkJLyogbG9vayBmb3IgYSBtYXRjaCB3aXRo
IGZpcnN0IGNoYXIgZm9sbG93aW5nICclJywKIAkJICogc3RvcCBhdCBhIHNlcF9jaGFyIHVubGVz
cyB3ZSdyZSBkb2luZyAiKiUiCiAJCSAqLwotCQlwdHIgPSBwaGllcjsKLQkJd2hpbGUgKHB0ciAh
PSBwZW5kICYmICpnaGllciAhPSAqcHRyCi0JCSAgICAgICAmJiAoKnB0ciAhPSBnLT5zZXBfY2hh
ciB8fAorCQl3aGlsZSAocGhpZXIgIT0gcGVuZCAmJiAqZ2hpZXIgIT0gKnBoaWVyCisJCSAgICAg
ICAmJiAoKnBoaWVyICE9IGctPnNlcF9jaGFyIHx8CiAJCQkgICAoISpnaGllciAmJiBnc3RhciAm
JiAqZ3N0YXIgPT0gJyUnICYmIG1pbgotCQkJICAgICYmIHB0ciAtIHN0YXJ0IDwgKm1pbikpKSB7
Ci0JCSAgICArK3B0cjsKKwkJCSAgICAmJiBwaGllciAtIHN0YXJ0IDwgKm1pbikpKSB7CisJCSAg
ICArK3BoaWVyOwogCQl9Ci0JCWlmIChwdHIgPT0gcGVuZCkgeworCQlpZiAocGhpZXIgPT0gcGVu
ZCkgewogCQkgICAgZ3B0ciA9IGdoaWVyOworCQkgICAgcHRyID0gcGhpZXI7CiAJCSAgICBicmVh
azsKIAkJfQotCQlpZiAoKnB0ciA9PSBnLT5zZXBfY2hhcikgeworCQlpZiAoKmdoaWVyICE9ICpw
aGllciAmJiAqcGhpZXIgPT0gZy0+c2VwX2NoYXIpIHsKIAkJICAgIGlmICghKmdoaWVyICYmIG1p
bgotCQkJJiYgKm1pbiA8IHB0ciAtIHN0YXJ0ICYmIHB0ciAhPSBwZW5kCi0JCQkmJiAqcHRyID09
IGctPnNlcF9jaGFyCi0JCQkpIHsKLQkJCSptaW4gPSBnc3RhciA/IHB0ciAtIHN0YXJ0ICsgMSA6
IC0xOwotCQkJcmV0dXJuIChwdHIgLSBzdGFydCk7CisJCQkmJiAqbWluIDwgcGhpZXIgLSBzdGFy
dCAmJiBwaGllciAhPSBwZW5kKSB7CisJCQkqbWluID0gZ3N0YXIgPyBwaGllciAtIHN0YXJ0ICsg
MSA6IC0xOworCQkJcmV0dXJuIChwaGllciAtIHN0YXJ0KTsKIAkJICAgIH0KIAkJICAgIGdoaWVy
ID0gTlVMTDsKIAkJICAgIHNlcGZvdW5kID0gMTsKIAkJfSBlbHNlIHsKLQkJICAgIHBoaWVyID0g
KytwdHI7CisJCSAgICBwdHIgPSArK3BoaWVyOwogCQkgICAgZ3B0ciA9IGdoaWVyICsgMTsKIAkJ
fQogCSAgICB9CkBAIC0zNzYsMjkgKzM3NSwyNyBAQAogCQkvKiBsb29rIGZvciBhIG1hdGNoIHdp
dGggZmlyc3QgY2hhciBmb2xsb3dpbmcgJyUnLAogCQkgKiBzdG9wIGF0IGEgc2VwX2NoYXIgdW5s
ZXNzIHdlJ3JlIGRvaW5nICIqJSIKIAkJICovCi0JCXB0ciA9IHBoaWVyOwotCQl3aGlsZSAocHRy
ICE9IHBlbmQgJiYgKHVuc2lnbmVkIGNoYXIpICpnaGllciAhPSBUT0xPV0VSKCpwdHIpCi0JCSAg
ICAgICAmJiAoKnB0ciAhPSBnLT5zZXBfY2hhciB8fAorCQl3aGlsZSAocGhpZXIgIT0gcGVuZCAm
JiAodW5zaWduZWQgY2hhcikgKmdoaWVyICE9IFRPTE9XRVIoKnBoaWVyKQorCQkgICAgICAgJiYg
KCpwaGllciAhPSBnLT5zZXBfY2hhciB8fAogCQkJICAgKCEqZ2hpZXIgJiYgZ3N0YXIgJiYgKmdz
dGFyID09ICclJyAmJiBtaW4KLQkJCSAgICAmJiBwdHIgLSBzdGFydCA8ICptaW4pKSkgewotCQkg
ICAgKytwdHI7CisJCQkgICAgJiYgcGhpZXIgLSBzdGFydCA8ICptaW4pKSkgeworCQkgICAgKytw
aGllcjsKIAkJfQotCQlpZiAocHRyID09IHBlbmQpIHsKKwkJaWYgKHBoaWVyID09IHBlbmQpIHsK
IAkJICAgIGdwdHIgPSBnaGllcjsKKwkJICAgIHB0ciA9IHBoaWVyOwogCQkgICAgYnJlYWs7CiAJ
CX0KLQkJaWYgKCpwdHIgPT0gZy0+c2VwX2NoYXIpIHsKKwkJaWYgKCpnaGllciAhPSAqcGhpZXIg
JiYgKnBoaWVyID09IGctPnNlcF9jaGFyKSB7CiAJCSAgICBpZiAoISpnaGllciAmJiBtaW4KLQkJ
CSYmICptaW4gPCBwdHIgLSBzdGFydCAmJiBwdHIgIT0gcGVuZAotCQkJJiYgKnB0ciA9PSBnLT5z
ZXBfY2hhcgotCQkJKSB7Ci0JCQkqbWluID0gZ3N0YXIgPyBwdHIgLSBzdGFydCArIDEgOiAtMTsK
LQkJCXJldHVybiAocHRyIC0gc3RhcnQpOworCQkJJiYgKm1pbiA8IHBoaWVyIC0gc3RhcnQgJiYg
cGhpZXIgIT0gcGVuZCkgeworCQkJKm1pbiA9IGdzdGFyID8gcGhpZXIgLSBzdGFydCArIDEgOiAt
MTsKKwkJCXJldHVybiAocGhpZXIgLSBzdGFydCk7CiAJCSAgICB9CiAJCSAgICBnaGllciA9IE5V
TEw7CiAJCSAgICBzZXBmb3VuZCA9IDE7CiAJCX0gZWxzZSB7Ci0JCSAgICBwaGllciA9ICsrcHRy
OworCQkgICAgcHRyID0gKytwaGllcjsKIAkJICAgIGdwdHIgPSBnaGllciArIDE7CiAJCX0KIAkg
ICAgfQpAQCAtNDQ2LDcgKzQ0Myw3IEBACiAgICAgaW50IGFyZ2M7CiAgICAgY2hhciogYXJndltd
OwogewotICAgIGdsb2IgKmcgPSBnbG9iX2luaXRfc3VwcHJlc3MoYXJndlsxXSwgR0xPQl9JTkJP
WENBU0V8R0xPQl9ISUVSQVJDSFksCisgICAgZ2xvYiAqZyA9IGdsb2JfaW5pdF9zdXBwcmVzcyhh
cmd2WzFdLCAnLicsIEdMT0JfSU5CT1hDQVNFfEdMT0JfSElFUkFSQ0hZLAogCQkJCSAidXNlci5u
aWZ0eSIpOwogICAgIGNoYXIgdGV4dFsxMDI0XTsKICAgICBpbnQgbGVuOwpkaWZmIC11ciBjeXJ1
cy1pbWFwZC0yLjIuMTIuc3VwZXJvbGQvbGliL2dsb2IuaCBjeXJ1cy1pbWFwZC0yLjIuMTIvbGli
L2dsb2IuaAotLS0gY3lydXMtaW1hcGQtMi4yLjEyLnN1cGVyb2xkL2xpYi9nbG9iLmgJMjAwMy0w
Mi0xMyAyMzoxNTo0MC4wMDAwMDAwMDAgKzAzMDAKKysrIGN5cnVzLWltYXBkLTIuMi4xMi9saWIv
Z2xvYi5oCTIwMDYtMDItMjAgMTk6MDQ6NDYuODkyNTAzMDAwICswMzAwCkBAIC03OCw3ICs3OCw3
IEBACiAgKiAgZmxhZ3MgICAgLS0gc2VlIGZsYWcgdmFsdWVzIGFib3ZlCiAgKiAgc3VwcHJlc3Mg
LS0gcHJlZml4IHRvIHN1cHByZXNzCiAgKi8KLWV4dGVybiBnbG9iICpnbG9iX2luaXRfc3VwcHJl
c3MgUCgoY29uc3QgY2hhciAqc3RyLCBpbnQgZmxhZ3MsCitleHRlcm4gZ2xvYiAqZ2xvYl9pbml0
X3N1cHByZXNzIFAoKGNvbnN0IGNoYXIgKnN0ciwgY2hhciBzZXBfY2hhciwgaW50IGZsYWdzLAog
CQkJCSAgIGNvbnN0IGNoYXIgKnN1cHByZXNzKSk7CiAKIC8qIGZyZWUgYSBnbG9iIHN0cnVjdHVy
ZQpAQCAtOTcsNyArOTcsNyBAQAogZXh0ZXJuIGludCBnbG9iX3Rlc3QgUCgoZ2xvYiAqZywgY29u
c3QgY2hhciAqc3RyLCBsb25nIGxlbiwgbG9uZyAqbWluKSk7CiAKIC8qIG1hY3JvcyAqLwotI2Rl
ZmluZSBnbG9iX2luaXQoc3RyLCBmbGFncykgZ2xvYl9pbml0X3N1cHByZXNzKChzdHIpLCAoZmxh
Z3MpLCBOVUxMKQorI2RlZmluZSBnbG9iX2luaXQoc3RyLCBzZXBfY2hhciwgZmxhZ3MpIGdsb2Jf
aW5pdF9zdXBwcmVzcygoc3RyKSwgKHNlcF9jaGFyKSwgKGZsYWdzKSwgTlVMTCkKICNkZWZpbmUg
Z2xvYl9pbmJveGNhc2UoZykgKChnKS0+aW5ib3gpCiAjZGVmaW5lIEdMT0JfVEVTVChnLCBzdHIp
IGdsb2JfdGVzdCgoZyksIChzdHIpLCAwLCBOVUxMKQogI2RlZmluZSBHTE9CX1NFVF9TRVBBUkFU
T1IoZywgYykgKChnKS0+c2VwX2NoYXIgPSAoYykpCg==
</data>        

          </attachment>
      

    </bug>

</bugzilla>