<?xml version="1.0" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugzilla.cyrusimap.org/bugzilla.dtd">

<bugzilla version="3.2.5.1-2"
          urlbase="https://bugzilla.cyrusimap.org/"
          maintainer="Dave McMurtrie &lt;dave64@andrew.cmu.edu&gt;"
>

    <bug>
          <bug_id>3244</bug_id>
          
          <creation_ts>2010-06-21 11:06 EDT</creation_ts>
          <short_desc>Add several options to unexpunge command</short_desc>
          <delta_ts>2010-06-21 11:06:18 EDT</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Cyrus IMAP</product>
          <component>IMAP</component>
          <version>2.3.x</version>
          <rep_platform>PC</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>NEW</bug_status>
          
          
          
          
          
          <priority>P5</priority>
          <bug_severity>enhancement</bug_severity>
          <target_milestone>Future</target_milestone>
          
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Brian Awood">bawood@umich.edu</reporter>
          <assigned_to name="Ken Murchison">murch@andrew.cmu.edu</assigned_to>
          <cc>wes@umich.edu</cc>
          <qa_contact name="The Cyrus Bugzilla List">cyrus-bugzilla@lists.andrew.cmu.edu</qa_contact>

      

      

      
          <long_desc isprivate="0">
            <who name="Brian Awood">bawood@umich.edu</who>
            <bug_when>2010-06-21 11:06:18 EDT</bug_when>
            <thetext>Created an attachment (id=1291)
add -r and -c options

Attaching patch to add -r (recursive), -c (expunged message count) functionality to the unexpunge command.</thetext>
          </long_desc>
      
          <attachment
              isobsolete="0"
              ispatch="1"
              isprivate="0"
          >
            <attachid>1291</attachid>
            <date>2010-06-21 11:06 EDT</date>
            <desc>add -r and -c options</desc>
            <filename>Add-recursive-r-and-count-expunged-c-to-unexpunge-co.patch</filename>
            <type>text/plain</type>
            <size>12802</size>
            <attacher>bawood@umich.edu</attacher>
            
              <data encoding="base64">ClRoZSAtYyBmbGFnIHByaW50cyBhIGNvdW50IG9mIHRoZSBtZXNzYWdlcyBpbiB0aGUgZXhwdW5n
ZWQgc3RhdGUKZm9yIGEgbWFpbGJveC4gIFRoZSBvdXRwdXQgaXMgaW4gdGhlIGZvcm0gIm1haWxi
b3g6IGNvdW50Ii4KVGhlIC1yIGZsYWcgY2F1c2VzIHVuZXhwdW5nZSB0byByZWN1cnNlIGZyb20g
dGhlIHNwZWNpZmllZAptYWlsYm94LCBpdCBjYW4gYmUgY29tYmluZWQgd2l0aCB0aGUgbmV3IC1j
IGZsYWcsIG9yIHRoZSBleGlzdGluZwotbCBhbmQgLWEgYnV0IG5vdCAtdS4KCmRpZmYgLS1naXQg
YS9pbWFwL3VuZXhwdW5nZS5jIGIvaW1hcC91bmV4cHVuZ2UuYwppbmRleCBhZmJjNmRmLi5lOWRk
MTllIDEwMDY0NAotLS0gYS9pbWFwL3VuZXhwdW5nZS5jCisrKyBiL2ltYXAvdW5leHB1bmdlLmMK
QEAgLTc5LDE3ICs3OSwyNCBAQAogLyogZ2xvYmFsIHN0YXRlICovCiBjb25zdCBpbnQgY29uZmln
X25lZWRfZGF0YSA9IDA7CiAKK2ludCAgdW5zZXRkZWxldGVkID0gMDsKK3RpbWVfdCB0aW1lX3Np
bmNlOworCiAvKiBjdXJyZW50IG5hbWVzcGFjZSAqLwogc3RhdGljIHN0cnVjdCBuYW1lc3BhY2Ug
dW5leF9uYW1lc3BhY2U7CiAKK2ludCBkb191bmV4cHVuZ2UoY2hhciAqbmFtZSwgaW50IG1hdGNo
bGVuLCBpbnQgbWF5Y3JlYXRlLCB2b2lkICpyb2NrKTsKK2ludCB1bmV4cHVuZ2UoY2hhciAqbWJv
eG5hbWUsIHVuc2lnbmVkIGxvbmcgKnVpZHMsIHVuc2lnbmVkIG51aWRzKTsKKwogaW50IHZlcmJv
c2UgPSAwOwogCiB2b2lkIHVzYWdlKHZvaWQpCiB7CiAgICAgZnByaW50ZihzdGRlcnIsCi0JICAg
ICJ1bmV4cHVuZ2UgWy1DIDxhbHRjb25maWc+XSAtbCA8bWFpbGJveD5cbiIKKwkgICAgInVuZXhw
dW5nZSBbLUMgPGFsdGNvbmZpZz5dIC1sIFstcl0gPG1haWxib3g+XG4iCisJICAgICJ1bmV4cHVu
Z2UgWy1DIDxhbHRjb25maWc+XSAtYyBbLXJdIDxtYWlsYm94PlxuIgogICAgICAgICAgICAgInVu
ZXhwdW5nZSBbLUMgPGFsdGNvbmZpZz5dIC10IHRpbWUtaW50ZXJ2YWwgWyAtZCBdIFsgLXYgXSBt
YWlsYm94XG4iCi0JICAgICJ1bmV4cHVuZ2UgWy1DIDxhbHRjb25maWc+XSAtYSBbLWRdIFstdl0g
PG1haWxib3g+XG4iCisJICAgICJ1bmV4cHVuZ2UgWy1DIDxhbHRjb25maWc+XSAtYSBbLWRdIFst
dl0gWy1yXSA8bWFpbGJveD5cbiIKIAkgICAgInVuZXhwdW5nZSBbLUMgPGFsdGNvbmZpZz5dIC11
IFstZF0gWy12XSA8bWFpbGJveD4gPHVpZD4uLi5cbiIpOwogICAgIGV4aXQoLTEpOwogfQpAQCAt
OTksOCArMTA2LDkgQEAgZW51bSB7CiAgICAgTU9ERV9MSVNULAogICAgIE1PREVfQUxMLAogICAg
IE1PREVfVElNRSwKLSAgICBNT0RFX1VJRAotfTsKKyAgICBNT0RFX1VJRCwKKyAgICBNT0RFX0NP
VU5UCit9IG1vZGUgPSBNT0RFX1VOS05PV047CiAKIHN0cnVjdCBtc2cgewogICAgIHVuc2lnbmVk
IHJlY25vOwpAQCAtMTYyLDcgKzE3MCw3IEBAIHZvaWQgbGlzdF9leHB1bmdlZChzdHJ1Y3QgbWFp
bGJveCAqbWFpbGJveCwKIGludCByZXN0b3JlX2V4cHVuZ2VkKHN0cnVjdCBtYWlsYm94ICptYWls
Ym94LAogCQkgICAgIHN0cnVjdCBtc2cgKm1zZ3MsIHVuc2lnbmVkIGxvbmcgZWV4aXN0cywKIAkJ
ICAgICBjb25zdCBjaGFyICpleHB1bmdlX2luZGV4X2Jhc2UsCi0JCSAgICAgdW5zaWduZWQgKm51
bXJlc3RvcmVkLCBpbnQgdW5zZXRkZWxldGVkKQorCQkgICAgIHVuc2lnbmVkICpudW1yZXN0b3Jl
ZCkKIHsKICAgICBpbnQgciA9IDA7CiAgICAgY29uc3QgY2hhciAqaXJlYzsKQEAgLTQxNSwxMTQg
KzQyMywzMyBAQCBpbnQgcmVzdG9yZV9leHB1bmdlZChzdHJ1Y3QgbWFpbGJveCAqbWFpbGJveCwK
ICAgICByZXR1cm4gcjsKIH0KIAotaW50IG1haW4oaW50IGFyZ2MsIGNoYXIgKmFyZ3ZbXSkKKy8q
CisgKiBtYm94bGlzdF9maW5kYWxsKCkgY2FsbGJhY2sgZnVuY3Rpb24gZm9yIHVuZXhwdW5nZSBy
ZWN1cnNpdmUgZmVhdHVyZXMKKyAqLworaW50Citkb191bmV4cHVuZ2UoY2hhciAqbmFtZSwKKwkg
IGludCBtYXRjaGxlbiBfX2F0dHJpYnV0ZV9fKCh1bnVzZWQpKSwKKwkgIGludCBtYXljcmVhdGUg
X19hdHRyaWJ1dGVfXygodW51c2VkKSksCisJICB2b2lkICpyb2NrIF9fYXR0cmlidXRlX18oKHVu
dXNlZCkpKQogewotICAgIGV4dGVybiBjaGFyICpvcHRhcmc7Ci0gICAgaW50IG9wdCwgciA9IDA7
Ci0gICAgY2hhciAqYWx0X2NvbmZpZyA9IE5VTEw7Ci0gICAgY2hhciBidWZbTUFYX01BSUxCT1hf
UEFUSCsxXTsKLSAgICBzdHJ1Y3QgbWFpbGJveCBtYWlsYm94OwotICAgIGludCBkb2Nsb3NlID0g
MCwgbW9kZSA9IE1PREVfVU5LTk9XTiwgdW5zZXRkZWxldGVkID0gMDsKLSAgICBjaGFyIGV4cHVu
Z2VfZm5hbWVbTUFYX01BSUxCT1hfUEFUSCsxXTsKKyAgICByZXR1cm4gdW5leHB1bmdlKG5hbWUs
IE5VTEwsIDApOworfQorCitpbnQKK3VuZXhwdW5nZShjaGFyICptYm94bmFtZSwgdW5zaWduZWQg
bG9uZyAqdWlkcywgdW5zaWduZWQgbnVpZHMpCit7CisgICAgaW50IGRvY2xvc2UgPSAwLCByOwog
ICAgIGludCBleHB1bmdlX2ZkID0gLTE7Ci0gICAgc3RydWN0IHN0YXQgc2J1ZjsKKyAgICBjaGFy
IGV4cHVuZ2VfZm5hbWVbTUFYX01BSUxCT1hfUEFUSCsxXTsKICAgICBjb25zdCBjaGFyICpsb2Nr
ZmFpbGFjdGlvbjsKLSAgICBzdHJ1Y3QgbXNnICptc2dzOwogICAgIHVuc2lnbmVkIG51bXJlc3Rv
cmVkID0gMDsKLSAgICB0aW1lX3QgbGFzdF91cGRhdGUsIHRpbWVfc2luY2UgPSB0aW1lKE5VTEwp
OwotICAgIGludCBsZW4sIHNlY3MgPSAwOwotCi0gICAgaWYgKChnZXRldWlkKCkpID09IDAgJiYg
KGJlY29tZV9jeXJ1cygpICE9IDApKSB7Ci0JZmF0YWwoIm11c3QgcnVuIGFzIHRoZSBDeXJ1cyB1
c2VyIiwgRUNfVVNBR0UpOwotICAgIH0KLQotICAgIHdoaWxlICgob3B0ID0gZ2V0b3B0KGFyZ2Ms
IGFyZ3YsICJDOmxhdWR0OnYiKSkgIT0gRU9GKSB7Ci0Jc3dpdGNoIChvcHQpIHsKLQljYXNlICdD
JzogLyogYWx0IGNvbmZpZyBmaWxlICovCi0JICAgIGFsdF9jb25maWcgPSBvcHRhcmc7Ci0JICAg
IGJyZWFrOwotCi0JY2FzZSAnbCc6Ci0JICAgIGlmIChtb2RlICE9IE1PREVfVU5LTk9XTikgdXNh
Z2UoKTsKLQkgICAgbW9kZSA9IE1PREVfTElTVDsKLQkgICAgYnJlYWs7Ci0JCi0JY2FzZSAnYSc6
Ci0JICAgIGlmIChtb2RlICE9IE1PREVfVU5LTk9XTikgdXNhZ2UoKTsKLQkgICAgbW9kZSA9IE1P
REVfQUxMOwotCSAgICBicmVhazsKLQkKLQljYXNlICd0JzoKLQkgICAgaWYgKG1vZGUgIT0gTU9E
RV9VTktOT1dOKSB1c2FnZSgpOwotCi0JICAgIG1vZGUgPSBNT0RFX1RJTUU7Ci0gICAgICAgICAg
ICBzZWNzID0gYXRvaShvcHRhcmcpOwotICAgICAgICAgICAgbGVuICA9IHN0cmxlbihvcHRhcmcp
OwotICAgICAgICAgICAgCi0gICAgICAgICAgICBpZiAoKHNlY3MgPiAwKSAmJiAobGVuID4gMSkp
IHsKLSAgICAgICAgICAgICAgICBzd2l0Y2ggKG9wdGFyZ1tsZW4tMV0pIHsKLSAgICAgICAgICAg
ICAgICBjYXNlICdtJzoKLSAgICAgICAgICAgICAgICAgICAgc2VjcyAqPSA2MDsKLSAgICAgICAg
ICAgICAgICAgICAgYnJlYWs7Ci0gICAgICAgICAgICAgICAgY2FzZSAnaCc6Ci0gICAgICAgICAg
ICAgICAgICAgIHNlY3MgKj0gKDYwKjYwKTsKLSAgICAgICAgICAgICAgICAgICAgYnJlYWs7Ci0g
ICAgICAgICAgICAgICAgY2FzZSAnZCc6Ci0gICAgICAgICAgICAgICAgICAgIHNlY3MgKj0gKDI0
KjYwKjYwKTsKLSAgICAgICAgICAgICAgICAgICAgYnJlYWs7Ci0gICAgICAgICAgICAgICAgY2Fz
ZSAndyc6Ci0gICAgICAgICAgICAgICAgICAgIHNlY3MgKj0gKDcqMjQqNjAqNjApOwotICAgICAg
ICAgICAgICAgICAgICBicmVhazsKLSAgICAgICAgICAgICAgICB9Ci0gICAgICAgICAgICB9Ci0g
ICAgICAgICAgICB0aW1lX3NpbmNlID0gdGltZShOVUxMKSAtIHNlY3M7Ci0JICAgIGJyZWFrOwot
Ci0JY2FzZSAndSc6Ci0JICAgIGlmIChtb2RlICE9IE1PREVfVU5LTk9XTikgdXNhZ2UoKTsKLQkg
ICAgbW9kZSA9IE1PREVfVUlEOwotCSAgICBicmVhazsKLQotCWNhc2UgJ2QnOgotCSAgICB1bnNl
dGRlbGV0ZWQgPSAxOwotCSAgICBicmVhazsKLQkKLQljYXNlICd2JzoKLQkgICAgdmVyYm9zZSA9
IDE7Ci0JICAgIGJyZWFrOwotCQotCWRlZmF1bHQ6Ci0JICAgIHVzYWdlKCk7Ci0JICAgIGJyZWFr
OwotCX0KLSAgICB9Ci0KLSAgICAvKiBzYW5pdHkgY2hlY2sgKi8KLSAgICBpZiAobW9kZSA9PSBN
T0RFX1VOS05PV04gfHwKLQkob3B0aW5kICsgKG1vZGUgPT0gTU9ERV9VSUQgPyAxIDogMCkpID49
IGFyZ2MpIHVzYWdlKCk7Ci0KLSAgICBjeXJ1c19pbml0KGFsdF9jb25maWcsICJ1bmV4cHVuZ2Ui
LCAwKTsKLQotICAgIG1ib3hsaXN0X2luaXQoMCk7Ci0gICAgbWJveGxpc3Rfb3BlbihOVUxMKTsK
LQotICAgIHF1b3RhZGJfaW5pdCgwKTsKLSAgICBxdW90YWRiX29wZW4oTlVMTCk7Ci0KLSAgICBz
eW5jX2xvZ19pbml0KCk7Ci0KLSAgICAvKiBTZXQgbmFtZXNwYWNlIC0tIGZvcmNlIHN0YW5kYXJk
IChpbnRlcm5hbCkgKi8KLSAgICBpZiAoKHIgPSBtYm94bmFtZV9pbml0X25hbWVzcGFjZSgmdW5l
eF9uYW1lc3BhY2UsIDEpKSAhPSAwKSB7Ci0Jc3lzbG9nKExPR19FUlIsIGVycm9yX21lc3NhZ2Uo
cikpOwotCWZhdGFsKGVycm9yX21lc3NhZ2UociksIEVDX0NPTkZJRyk7Ci0gICAgfQotCi0gICAg
LyogVHJhbnNsYXRlIG1haWxib3huYW1lICovCi0gICAgKCp1bmV4X25hbWVzcGFjZS5tYm94bmFt
ZV90b2ludGVybmFsKSgmdW5leF9uYW1lc3BhY2UsIGFyZ3Zbb3B0aW5kXSwKLQkJCQkJICBOVUxM
LCBidWYpOworICAgIHN0cnVjdCBtYWlsYm94IG1haWxib3g7CisgICAgc3RydWN0IG1zZyAqbXNn
czsKKyAgICBzdHJ1Y3Qgc3RhdCBzYnVmOworICAgIHRpbWVfdCBsYXN0X3VwZGF0ZTsKIAogICAg
IC8qIE9wZW4vbG9jayBoZWFkZXIgKi8KLSAgICByID0gbWFpbGJveF9vcGVuX2hlYWRlcihidWYs
IDAsICZtYWlsYm94KTsKKyAgICByID0gbWFpbGJveF9vcGVuX2hlYWRlcihtYm94bmFtZSwgMCwg
Jm1haWxib3gpOwogICAgIGlmICghciAmJiBtYWlsYm94LmhlYWRlcl9mZCAhPSAtMSkgewogCWRv
Y2xvc2UgPSAxOwogCSh2b2lkKSBtYWlsYm94X2xvY2tfaGVhZGVyKCZtYWlsYm94KTsKQEAgLTUz
Nyw2ICs0NjQsMTMgQEAgaW50IG1haW4oaW50IGFyZ2MsIGNoYXIgKmFyZ3ZbXSkKICAgICB9CiAg
ICAgaWYgKCFyKSByID0gbWFpbGJveF9sb2NrX3BvcCgmbWFpbGJveCk7CiAKKyAgICBpZiAocikg
eworCS8qIG1haWxib3ggY29ycnVwdC9ub25leGlzdGVudCAtLSBza2lwIGl0ICovCisJc3lzbG9n
KExPR19XQVJOSU5HLCAidW5hYmxlIHRvIG9wZW4vbG9jayBtYWlsYm94ICVzIiwgbWJveG5hbWUp
OworCWlmIChkb2Nsb3NlKSBtYWlsYm94X2Nsb3NlKCZtYWlsYm94KTsKKwlyZXR1cm4gMDsKKyAg
ICB9CisKICAgICAvKiBPcGVuIGV4cHVuZ2UgaW5kZXggKi8KICAgICBpZiAoIXIpIHsKIAljaGFy
ICpwYXRoID0KQEAgLTU1MCw5ICs0ODQsMTYgQEAgaW50IG1haW4oaW50IGFyZ2MsIGNoYXIgKmFy
Z3ZbXSkKIAlleHB1bmdlX2ZkID0gb3BlbihleHB1bmdlX2ZuYW1lLCBPX1JEV1IsIDA2NjYpOwog
ICAgIH0KIAotICAgIGlmIChyIHx8IGV4cHVuZ2VfZmQgPT0gLTEpIHsKKyAgICBpZiAoZXhwdW5n
ZV9mZCA9PSAtMSkgeworCWlmIChtb2RlID09IE1PREVfQ09VTlQpIHsKKwkgICAgLyogVHJhbnNs
YXRlIG1haWxib3huYW1lICovCisJICAgIGNoYXIgYnVmW01BWF9NQUlMQk9YX1BBVEgrMV07CisJ
ICAgICgqdW5leF9uYW1lc3BhY2UubWJveG5hbWVfdG9leHRlcm5hbCkoJnVuZXhfbmFtZXNwYWNl
LAorCQkJICAgICBtYWlsYm94Lm5hbWUsIE5VTEwsIGJ1Zik7CisJICAgIHByaW50ZigiJXM6IDBc
biIsIGJ1Zik7CisJfQogCS8qIG1haWxib3ggY29ycnVwdC9ub25leGlzdGVudCAtLSBza2lwIGl0
ICovCi0Jc3lzbG9nKExPR19XQVJOSU5HLCAidW5hYmxlIHRvIG9wZW4vbG9jayBtYWlsYm94ICVz
IiwgYXJndltvcHRpbmRdKTsKKwlzeXNsb2coTE9HX1dBUk5JTkcsICJ1bmFibGUgdG8gb3BlbiAl
czogJW0iLCBleHB1bmdlX2ZuYW1lKTsKIAlpZiAoZG9jbG9zZSkgbWFpbGJveF9jbG9zZSgmbWFp
bGJveCk7CiAJcmV0dXJuIDA7CiAgICAgfQpAQCAtNTY3LDMxICs1MDgsMzMgQEAgaW50IG1haW4o
aW50IGFyZ2MsIGNoYXIgKmFyZ3ZbXSkKIAl1bnNpZ25lZCBsb25nIGV4aXN0cywgdWlkOwogCWNv
bnN0IGNoYXIgKnJlYzsKIAl1bnNpZ25lZCBtc2dubzsKLQl1bnNpZ25lZCBsb25nICp1aWRzID0g
TlVMTDsKLQl1bnNpZ25lZCBudWlkcyA9IDA7CiAKIAltYXBfcmVmcmVzaChleHB1bmdlX2ZkLCAx
LCAmZXhwdW5nZV9pbmRleF9iYXNlLAogCQkgICAgJmV4cHVuZ2VfaW5kZXhfbGVuLCBzYnVmLnN0
X3NpemUsICJleHB1bmdlIiwKIAkJICAgIG1haWxib3gubmFtZSk7CiAKKwlpZiAoc2J1Zi5zdF9z
aXplIDwgSU5ERVhfSEVBREVSX1NJWkUpIHsKKwkgICAgc3lzbG9nKExPR19FUlIsICJFUlJPUjog
JXMgY3lydXMuZXhwdW5nZSBpbnZhbGlkIiwKKwkJICAgIG1haWxib3gubmFtZSk7CisJICAgIGdv
dG8gZG9uZTsKKwl9CisKIAlleGlzdHMgPSBudG9obCgqKChiaXQzMiAqKShleHB1bmdlX2luZGV4
X2Jhc2UrT0ZGU0VUX0VYSVNUUykpKTsKKwlpZiAoc2J1Zi5zdF9zaXplIDwgKCBJTkRFWF9IRUFE
RVJfU0laRSArIChleGlzdHMgKiBJTkRFWF9SRUNPUkRfU0laRSkpKSB7CisJICAgIHN5c2xvZyhM
T0dfRVJSLAorCQkgICAgIkVSUk9SOiAlcyBjeXJ1cy5leHB1bmdlIHRvbyBzaG9ydCBmb3IgJWx1
IG1lc3NhZ2VzIiwKKwkJICAgIG1haWxib3gubmFtZSwgZXhpc3RzKTsKKwkgICAgZ290byBkb25l
OworCX0KIAorICAgIGlmIChtb2RlID09IE1PREVfQ09VTlQpIHsKKwkvKiBUcmFuc2xhdGUgbWFp
bGJveG5hbWUgKi8KKwljaGFyIGJ1ZltNQVhfTUFJTEJPWF9QQVRIKzFdOworCSgqdW5leF9uYW1l
c3BhY2UubWJveG5hbWVfdG9leHRlcm5hbCkoJnVuZXhfbmFtZXNwYWNlLCBtYWlsYm94Lm5hbWUs
IE5VTEwsIGJ1Zik7CisJcHJpbnRmKCIlczogJWx1XG4iLCBidWYsIGV4aXN0cyk7CisgICAgfSBl
bHNlIHsKIAltc2dzID0gKHN0cnVjdCBtc2cgKikgeG1hbGxvYyhleGlzdHMgKiBzaXplb2Yoc3Ry
dWN0IG1zZykpOwogCi0JLyogR2V0IFVJRHMgb2YgbWVzc2FnZXMgdG8gcmVzdG9yZSAqLwotCWlm
IChtb2RlID09IE1PREVfVUlEKSB7Ci0JICAgIHVuc2lnbmVkIGk7Ci0KLQkgICAgbnVpZHMgPSBh
cmdjIC0gKytvcHRpbmQ7Ci0JICAgIHVpZHMgPSAodW5zaWduZWQgbG9uZyAqKSB4bWFsbG9jKG51
aWRzICogc2l6ZW9mKHVuc2lnbmVkIGxvbmcpKTsKLQotCSAgICBmb3IgKGkgPSAwOyBpIDwgbnVp
ZHM7IGkrKykKLQkJdWlkc1tpXSA9IHN0cnRvdWwoYXJndltvcHRpbmQraV0sIE5VTEwsIDEwKTsK
LQotCSAgICAvKiBTb3J0IHRoZSBVSURzIHNvIHdlIGNhbiBiaW5hcnkgc2VhcmNoICovCi0JICAg
IHFzb3J0KHVpZHMsIG51aWRzLCBzaXplb2YodW5zaWduZWQgbG9uZyksIGNvbXBhcmVfdWlkKTsK
LQl9Ci0KIAkvKiBHZXQgVUlEcyBvZiBleHB1bmdlZCBtZXNzYWdlcyAqLwogCWZvciAobXNnbm8g
PSAwOyBtc2dubyA8IGV4aXN0czsgbXNnbm8rKykgewogCSAgICAvKiBKdW1wIHRvIGluZGV4IHJl
Y29yZCBmb3IgdGhpcyBtZXNzYWdlICovCkBAIC02MTUsOSArNTU4LDExIEBAIGludCBtYWluKGlu
dCBhcmdjLCBjaGFyICphcmd2W10pCiAJCQkJCSAgICAgIHNpemVvZih1bnNpZ25lZCBsb25nKSwK
IAkJCQkJICAgICAgY29tcGFyZV91aWQpICE9IE5VTEw7CiAJCWJyZWFrOworCSAgICBkZWZhdWx0
OgorCQkvKiBtYWlubHkgcHJldmVudCBjb21waWxlciB3YXJuaW5nICovCisJCWZwcmludGYoc3Rk
ZXJyLCAiVW5rbm93biBtb2RlIVxuIik7CiAJICAgIH0KIAl9Ci0JaWYgKHVpZHMpIGZyZWUodWlk
cyk7CiAKIAkvKiBTb3J0IG1zZ3MgYnkgVUlEICovCiAJcXNvcnQobXNncywgZXhpc3RzLCBzaXpl
b2Yoc3RydWN0IG1zZyksIGNvbXBhcmVfbXNnKTsKQEAgLTYyOSw3ICs1NzQsNyBAQCBpbnQgbWFp
bihpbnQgYXJnYywgY2hhciAqYXJndltdKQogCQkgICAgbW9kZSA9PSBNT0RFX0FMTCA/ICJhbGwg
IiA6ICIiLCBtYWlsYm94Lm5hbWUpOwogCiAJICAgIHIgPSByZXN0b3JlX2V4cHVuZ2VkKCZtYWls
Ym94LCBtc2dzLCBleGlzdHMsIGV4cHVuZ2VfaW5kZXhfYmFzZSwKLQkJCQkgJm51bXJlc3RvcmVk
LCB1bnNldGRlbGV0ZWQpOworCQkJCSAmbnVtcmVzdG9yZWQpOwogCSAgICBpZiAoIXIpIHsKIAkJ
cHJpbnRmKCJyZXN0b3JlZCAldSBvdXQgb2YgJWx1IGV4cHVuZ2VkIG1lc3NhZ2VzXG4iLAogCQkJ
bnVtcmVzdG9yZWQsIGV4aXN0cyk7CkBAIC02MzgsMTYgKzU4MywxNyBAQCBpbnQgbWFpbihpbnQg
YXJnYywgY2hhciAqYXJndltdKQogCQkgICAgICAgbnVtcmVzdG9yZWQsIGV4aXN0cywgbWFpbGJv
eC5uYW1lKTsKIAkgICAgfQogCX0KLQotCW1hcF9mcmVlKCZleHB1bmdlX2luZGV4X2Jhc2UsICZl
eHB1bmdlX2luZGV4X2xlbik7CiAJZnJlZShtc2dzKTsKKyAgICB9Citkb25lOgorCW1hcF9mcmVl
KCZleHB1bmdlX2luZGV4X2Jhc2UsICZleHB1bmdlX2luZGV4X2xlbik7CiAKIAlpZiAobG9ja191
bmxvY2soZXhwdW5nZV9mZCkpCiAJICAgIHN5c2xvZyhMT0dfRVJSLAogCQkgICAiSU9FUlJPUjog
dW5sb2NraW5nIGV4cHVuZ2UgaW5kZXggb2YgJXM6ICVtIiwgCiAJCSAgIG1haWxib3gubmFtZSk7
CiAgICAgfQotICAgIGNsb3NlKGV4cHVuZ2VfZmQpOworICAgIGlmIChleHB1bmdlX2ZkID49IDAp
IGNsb3NlKGV4cHVuZ2VfZmQpOwogCiAgICAgbWFpbGJveF91bmxvY2tfcG9wKCZtYWlsYm94KTsK
ICAgICBtYWlsYm94X3VubG9ja19pbmRleCgmbWFpbGJveCk7CkBAIC02NjEsNiArNjA3LDE0NCBA
QCBpbnQgbWFpbihpbnQgYXJnYywgY2hhciAqYXJndltdKQogICAgIHF1b3RhZGJfY2xvc2UoKTsK
ICAgICBxdW90YWRiX2RvbmUoKTsKIAorICAgIHJldHVybiByOworfQorCitpbnQgbWFpbihpbnQg
YXJnYywgY2hhciAqYXJndltdKQoreworICAgIGV4dGVybiBjaGFyICpvcHRhcmc7CisgICAgaW50
IG9wdCwgciA9IDAsIHJlY3Vyc2l2ZSA9IDA7CisgICAgY2hhciAqYWx0X2NvbmZpZyA9IE5VTEw7
CisgICAgY2hhciBidWZbTUFYX01BSUxCT1hfUEFUSCsxXTsKKyAgICBpbnQgbGVuLCBzZWNzID0g
MDsKKyAgICB1bnNpZ25lZCBsb25nICp1aWRzID0gTlVMTDsKKyAgICB1bnNpZ25lZCBudWlkcyA9
IDA7CisKKyAgICBpZiAoKGdldGV1aWQoKSkgPT0gMCAmJiAoYmVjb21lX2N5cnVzKCkgIT0gMCkp
IHsKKwlmYXRhbCgibXVzdCBydW4gYXMgdGhlIEN5cnVzIHVzZXIiLCBFQ19VU0FHRSk7CisgICAg
fQorCisgICAgd2hpbGUgKChvcHQgPSBnZXRvcHQoYXJnYywgYXJndiwgIkM6bGF1ZHQ6dmNyIikp
ICE9IEVPRikgeworCXN3aXRjaCAob3B0KSB7CisJY2FzZSAnQyc6IC8qIGFsdCBjb25maWcgZmls
ZSAqLworCSAgICBhbHRfY29uZmlnID0gb3B0YXJnOworCSAgICBicmVhazsKKworCWNhc2UgJ2wn
OgorCSAgICBpZiAobW9kZSAhPSBNT0RFX1VOS05PV04pIHVzYWdlKCk7CisJICAgIG1vZGUgPSBN
T0RFX0xJU1Q7CisJICAgIGJyZWFrOworCQorCWNhc2UgJ2EnOgorCSAgICBpZiAobW9kZSAhPSBN
T0RFX1VOS05PV04pIHVzYWdlKCk7CisJICAgIG1vZGUgPSBNT0RFX0FMTDsKKwkgICAgYnJlYWs7
CisJCisJY2FzZSAndCc6CisJICAgIGlmIChtb2RlICE9IE1PREVfVU5LTk9XTikgdXNhZ2UoKTsK
KworCSAgICBtb2RlID0gTU9ERV9USU1FOworICAgICAgICAgICAgc2VjcyA9IGF0b2kob3B0YXJn
KTsKKyAgICAgICAgICAgIGxlbiAgPSBzdHJsZW4ob3B0YXJnKTsKKyAgICAgICAgICAgIAorICAg
ICAgICAgICAgaWYgKChzZWNzID4gMCkgJiYgKGxlbiA+IDEpKSB7CisgICAgICAgICAgICAgICAg
c3dpdGNoIChvcHRhcmdbbGVuLTFdKSB7CisgICAgICAgICAgICAgICAgY2FzZSAnbSc6CisgICAg
ICAgICAgICAgICAgICAgIHNlY3MgKj0gNjA7CisgICAgICAgICAgICAgICAgICAgIGJyZWFrOwor
ICAgICAgICAgICAgICAgIGNhc2UgJ2gnOgorICAgICAgICAgICAgICAgICAgICBzZWNzICo9ICg2
MCo2MCk7CisgICAgICAgICAgICAgICAgICAgIGJyZWFrOworICAgICAgICAgICAgICAgIGNhc2Ug
J2QnOgorICAgICAgICAgICAgICAgICAgICBzZWNzICo9ICgyNCo2MCo2MCk7CisgICAgICAgICAg
ICAgICAgICAgIGJyZWFrOworICAgICAgICAgICAgICAgIGNhc2UgJ3cnOgorICAgICAgICAgICAg
ICAgICAgICBzZWNzICo9ICg3KjI0KjYwKjYwKTsKKyAgICAgICAgICAgICAgICAgICAgYnJlYWs7
CisgICAgICAgICAgICAgICAgfQorICAgICAgICAgICAgfQorICAgICAgICAgICAgdGltZV9zaW5j
ZSA9IHRpbWUoTlVMTCkgLSBzZWNzOworCSAgICBicmVhazsKKworCWNhc2UgJ3UnOgorCSAgICBp
ZiAobW9kZSAhPSBNT0RFX1VOS05PV04pIHVzYWdlKCk7CisJICAgIG1vZGUgPSBNT0RFX1VJRDsK
KwkgICAgYnJlYWs7CisKKwljYXNlICdkJzoKKwkgICAgdW5zZXRkZWxldGVkID0gMTsKKwkgICAg
YnJlYWs7CisJCisJY2FzZSAndic6CisJICAgIHZlcmJvc2UgPSAxOworCSAgICBicmVhazsKKwor
CWNhc2UgJ2MnOgorCSAgICBpZiAobW9kZSAhPSBNT0RFX1VOS05PV04pIHVzYWdlKCk7CisJICAg
IG1vZGUgPSBNT0RFX0NPVU5UOworCSAgICBicmVhazsKKworCWNhc2UgJ3InOgorCSAgICBpZiAo
bW9kZSA9PSBNT0RFX1VJRCkgdXNhZ2UoKTsKKwkgICAgcmVjdXJzaXZlID0gMTsKKwkgICAgYnJl
YWs7CisJCisJZGVmYXVsdDoKKwkgICAgdXNhZ2UoKTsKKwkgICAgYnJlYWs7CisJfQorICAgIH0K
KworICAgIC8qIHNhbml0eSBjaGVjayAqLworICAgIGlmIChtb2RlID09IE1PREVfVU5LTk9XTiB8
fAorCShvcHRpbmQgKyAobW9kZSA9PSBNT0RFX1VJRCA/IDEgOiAwKSkgPj0gYXJnYykgdXNhZ2Uo
KTsKKworICAgIGN5cnVzX2luaXQoYWx0X2NvbmZpZywgInVuZXhwdW5nZSIsIDApOworCisgICAg
bWJveGxpc3RfaW5pdCgwKTsKKyAgICBtYm94bGlzdF9vcGVuKE5VTEwpOworCisgICAgcXVvdGFk
Yl9pbml0KDApOworICAgIHF1b3RhZGJfb3BlbihOVUxMKTsKKworICAgIHN5bmNfbG9nX2luaXQo
KTsKKworICAgIC8qIFNldCBuYW1lc3BhY2UgLS0gZm9yY2Ugc3RhbmRhcmQgKGludGVybmFsKSAq
LworICAgIGlmICgociA9IG1ib3huYW1lX2luaXRfbmFtZXNwYWNlKCZ1bmV4X25hbWVzcGFjZSwg
MSkpICE9IDApIHsKKwlzeXNsb2coTE9HX0VSUiwgZXJyb3JfbWVzc2FnZShyKSk7CisJZmF0YWwo
ZXJyb3JfbWVzc2FnZShyKSwgRUNfQ09ORklHKTsKKyAgICB9CisKKyAgICAvKiBUcmFuc2xhdGUg
bWFpbGJveG5hbWUgKi8KKyAgICAoKnVuZXhfbmFtZXNwYWNlLm1ib3huYW1lX3RvaW50ZXJuYWwp
KCZ1bmV4X25hbWVzcGFjZSwgYXJndltvcHRpbmRdLAorCQkJCQkgIE5VTEwsIGJ1Zik7CisKKyAg
ICAvKiBHZXQgVUlEcyBvZiBtZXNzYWdlcyB0byByZXN0b3JlICovCisgICAgaWYgKG1vZGUgPT0g
TU9ERV9VSUQpIHsKKyAgICAgICAgdW5zaWduZWQgaTsKKworCW51aWRzID0gYXJnYyAtICsrb3B0
aW5kOworCXVpZHMgPSAodW5zaWduZWQgbG9uZyAqKSB4bWFsbG9jKG51aWRzICogc2l6ZW9mKHVu
c2lnbmVkIGxvbmcpKTsKKworCWZvciAoaSA9IDA7IGkgPCBudWlkczsgaSsrKSB7CisJICAgIHVp
ZHNbaV0gPSBzdHJ0b3VsKGFyZ3Zbb3B0aW5kK2ldLCBOVUxMLCAxMCk7CisJfQorCisJLyogU29y
dCB0aGUgVUlEcyBzbyB3ZSBjYW4gYmluYXJ5IHNlYXJjaCAqLworCXFzb3J0KHVpZHMsIG51aWRz
LCBzaXplb2YodW5zaWduZWQgbG9uZyksIGNvbXBhcmVfdWlkKTsKKyAgICB9CisKKyAgICBpZiAo
ICFyZWN1cnNpdmUgKSB7CisJciA9IHVuZXhwdW5nZSggYnVmLCB1aWRzLCBudWlkcyApOworICAg
IH0gZWxzZSB7CisJc3RybGNhdChidWYsICIqIiwgc2l6ZW9mKGJ1ZikpOworCXIgPSAoKnVuZXhf
bmFtZXNwYWNlLm1ib3hsaXN0X2ZpbmRhbGwpKCZ1bmV4X25hbWVzcGFjZSwgYnVmLCAxLCAwLCAw
LAorCQkJCQkgICBkb191bmV4cHVuZ2UsIE5VTEwpOworLyogWFhYIGNhbGwgdW5leHB1bmdlIGFw
cHJvcHJpYXRlbHkgWFhYICovCisgICAgfQorCisgICAgaWYgKHVpZHMpIGZyZWUodWlkcyk7CisK
ICAgICBtYm94bGlzdF9jbG9zZSgpOwogICAgIG1ib3hsaXN0X2RvbmUoKTsKIApkaWZmIC0tZ2l0
IGEvbWFuL3VuZXhwdW5nZS44IGIvbWFuL3VuZXhwdW5nZS44CmluZGV4IGU5YjYwNDMuLjMxNTJh
ZjAgMTAwNjQ0Ci0tLSBhL21hbi91bmV4cHVuZ2UuOAorKysgYi9tYW4vdW5leHB1bmdlLjgKQEAg
LTEwOCw2ICsxMDgsMTQgQEAgZmlsZSB1bmxlc3Mgc3BlY2lmaWVkIG90aGVyd2lzZSBieSBcZkIt
Q1xmUi4KIC5CSSBcLUMgIiBjb25maWctZmlsZSIKIFJlYWQgY29uZmlndXJhdGlvbiBvcHRpb25z
IGZyb20gXGZJY29uZmlnLWZpbGVcZlIuCiAuVFAKKy5CIFwtcgorUmVjdXJzaXZlbHkgcHJvY2Vz
cyBtYWlsYm94ZXMuIE11dHVhbGx5IGV4Y2x1c2l2ZSB0byAtdS4KKy5UUAorLkIgXC1jCitQcmlu
dCBhIGNvdW50IG9mIHRoZSBtZXNzYWdlcyB0aGF0IGFyZSBhdmFpbGFibGUgdG8gYmUgdW5leHB1
bmdlZCBmb3IKK2EgbWFpbGJveC4gIE5vdGhpbmcgaXMgcHJpbnRlZCBmb3IgYSBtYWlsYm94IHRo
YXQgaGFzIG5vIGN5cnVzLmV4cHVuZ2UKK2ZpbGUuCisuVFAKIC5CIFwtbAogTGlzdCB0aGUgZXhw
dW5nZWQgbWVzc2FnZXMgaW4gdGhlIHNwZWNpZmllZCBtYWlsYm94IHdoaWNoIGFyZSBhdmFpbGFi
bGUKIGZvciByZXN0b3JhdGlvbi4KLS0gCjEuNy4wLjMKCg==
</data>        

          </attachment>
      

    </bug>

</bugzilla>