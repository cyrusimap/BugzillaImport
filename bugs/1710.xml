<?xml version="1.0" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugzilla.cyrusimap.org/bugzilla.dtd">

<bugzilla version="3.2.5.1-2"
          urlbase="https://bugzilla.cyrusimap.org/"
          maintainer="Dave McMurtrie &lt;dave64@andrew.cmu.edu&gt;"
>

    <bug>
          <bug_id>1710</bug_id>
          
          <creation_ts>2002-12-10 14:57 EDT</creation_ts>
          <short_desc>lmtpd does not translate UTF-8 into mUTF7 for sieve_fileinto()</short_desc>
          <delta_ts>2010-10-18 12:42:59 EDT</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Cyrus IMAP</product>
          <component>IMAP</component>
          <version>2.1.x</version>
          <rep_platform>Other</rep_platform>
          <op_sys>other</op_sys>
          <bug_status>CLOSED</bug_status>
          <resolution>FIXED</resolution>
          
          
          
          
          <priority>P2</priority>
          <bug_severity>bug</bug_severity>
          <target_milestone>Future</target_milestone>
          
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Larry Greenfield">leg+cyrus@andrew.cmu.edu</reporter>
          <assigned_to name="Ken Murchison">murch@andrew.cmu.edu</assigned_to>
          <cc>mail@roland-stuehmer.de</cc>
    
    <cc>mark@air.co.jp</cc>
    
    <cc>rk@netuse.de</cc>
    
    <cc>robm@fastmail.fm</cc>
          

      

      

      
          <long_desc isprivate="0">
            <who name="Larry Greenfield">leg+cyrus@andrew.cmu.edu</who>
            <bug_when>2002-12-10 14:57:12 EDT</bug_when>
            <thetext>Sieve scripts, and the sieve library (sieve_interface.h) deal with UTF-8 and
UTF-8 only. lmtpd needs to translate from UTF-8 to mUTF7 when performing a
fileinto so that users don&apos;t need to see the yuckiness that is mUTF7.</thetext>
          </long_desc>
          <long_desc isprivate="0">
            <who name="Larry Greenfield">leg+cyrus@andrew.cmu.edu</who>
            <bug_when>2002-12-10 14:58:30 EDT</bug_when>
            <thetext>adding Mark Keasling, who showed interest in fixing.

the method we discussed was to add a function call to mboxname.c to convert
UTF-8 to mUTF7. it might also validate the mailbox name at that time.</thetext>
          </long_desc>
          <long_desc isprivate="0">
            <who name="Larry Greenfield">leg+cyrus@andrew.cmu.edu</who>
            <bug_when>2003-01-08 15:25:13 EDT</bug_when>
            <thetext>fixing summary
</thetext>
          </long_desc>
          <long_desc isprivate="0">
            <who name="Mark Keasling">mark@air.co.jp</who>
            <bug_when>2003-02-06 04:07:36 EDT</bug_when>
            <thetext>Created an attachment (id=111)
Patch to convert sieve_fileinto() names from utf8 to utf7
</thetext>
          </long_desc>
          <long_desc isprivate="0">
            <who name="Mark Keasling">mark@air.co.jp</who>
            <bug_when>2003-02-06 05:07:17 EDT</bug_when>
            <thetext>Created an attachment (id=112)
Patch to convert sieve_fileinto() names from utf8 to utf7

Previous attempt didn&apos;t compile... :( Teach me to look
before leaping.

BTW: This patch is based on cyrus-imapd-2.1.11 source.

Larry Greenfield says the utf8toutf7 code should go in
lib/ ; but, I&apos;m ignorant and don&apos;t want to blindly muck
about in the Makefile generation stuff.</thetext>
          </long_desc>
          <long_desc isprivate="0">
            <who name="Larry Greenfield">leg+cyrus@andrew.cmu.edu</who>
            <bug_when>2003-02-10 16:18:30 EDT</bug_when>
            <thetext>(From update of attachment 112)
two things:
i don&apos;t understand when a caller would want to pass NULL as the first parameter
to mboxname_utf8toutf7(); it looks like it&apos;ll inevitably return NULL in that
case and no useful work will be performed.

- i just updated lib/imapurl.c with comments and checking for overlong utf-8
sequences. it might be of interest.
</thetext>
          </long_desc>
          <long_desc isprivate="0">
            <who name="Ken Murchison">murch@andrew.cmu.edu</who>
            <bug_when>2008-02-20 12:49:45 EDT</bug_when>
            <thetext>Add code to do UTF-8 to mUTF-7 conversion at script compile time, rather than at execution time.  Probably needs some further testing.</thetext>
          </long_desc>
      
          <attachment
              isobsolete="1"
              ispatch="1"
              isprivate="0"
          >
            <attachid>111</attachid>
            <date>2003-02-06 04:07 EDT</date>
            <desc>Patch to convert sieve_fileinto() names from utf8 to utf7</desc>
            <filename>lldiffs</filename>
            <type>text/plain</type>
            <size>7602</size>
            <attacher>mark@air.co.jp</attacher>
            
              <data encoding="base64">KioqIGxtdHBkLmMub2xkCU1vbiBKYW4gMjAgMTY6NTg6MTQgMjAwMwotLS0gbG10cGQuYwlUaHUg
RmViICA2IDE3OjQ5OjI2IDIwMDMKKioqKioqKioqKioqKioqCioqKiA3MTgsNzMzICoqKioKLS0t
IDcxOCw3NDUgLS0tLQogICAgICBtZXNzYWdlX2RhdGFfdCAqbWQgPSBtZGF0YS0+bTsKICAgICAg
aW50IHF1b3Rhb3ZlcnJpZGUgPSBtc2dfZ2V0cmNwdF9pZ25vcmVxdW90YShtZCwgbWRhdGEtPmN1
cl9yY3B0KTsKICAgICAgaW50IHJldDsKKyAgICAgY2hhciBuYW1lW01BWF9NQUlMQk9YX1BBVEhd
OworICAgICB1bnNpZ25lZCBsb25nIGxlbmd0aCA9IHNpemVvZiAobmFtZSk7CiAgCiAgICAgIC8q
IHdlJ3JlIG5vdyB0aGUgdXNlciB3aG8gb3ducyB0aGUgc2NyaXB0ICovCiAgICAgIGlmICghc2Qt
PmF1dGhzdGF0ZSkKICAJcmV0dXJuIFNJRVZFX0ZBSUw7CiAgCisgICAgIG1lbXNldChuYW1lLCAw
LCBsZW5ndGgpOyAgICAgICAgICAgICAgICAgICAgICAvKiBjbGVhciBuYW1lIGJ1ZmZlciAgICAg
Ki8KKyAgICAgaWYgKCFtYm94bmFtZV91dGY4dG9tdXRmNyhuYW1lLCAmbGVuZ3RoLCBmYy0+bWFp
bGJveCkpCisgCXJldHVybiBTSUVWRV9GQUlMOyAgICAgICAgICAgICAgICAgICAgICAgICAgLyog
RkFJTDogY291bGRudCBjb252ZXJ0ICovCisgICAgIGlmICgqbmFtZSkgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAvKiB1c2UgbXV0ZjcgbmFtZSAgICAgICAgKi8KKyAJcmV0ID0g
ZGVsaXZlcl9tYWlsYm94KG1kLT5kYXRhLCBtZGF0YS0+c3RhZ2UsIG1kLT5zaXplLAorIAkJCSAg
ICAgIGZjLT5pbWFwZmxhZ3MtPmZsYWcsIGZjLT5pbWFwZmxhZ3MtPm5mbGFncywKKyAJCQkgICAg
ICBzZC0+dXNlcm5hbWUsIHNkLT5hdXRoc3RhdGUsIG1kLT5pZCwKKyAJCQkgICAgICBzZC0+dXNl
cm5hbWUsIG1kYXRhLT5ub3RpZnloZWFkZXIsCisgCQkJICAgICAgbmFtZSwgcXVvdGFvdmVycmlk
ZSwgMCk7CisgICAgIGVsc2UgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAvKiB1c2Ugb3JpZ2luYWwgbmFtZSAgICAgKi8KICAJcmV0ID0gZGVsaXZlcl9tYWlsYm94KG1k
LT5kYXRhLCBtZGF0YS0+c3RhZ2UsIG1kLT5zaXplLAogIAkJCSAgICAgIGZjLT5pbWFwZmxhZ3Mt
PmZsYWcsIGZjLT5pbWFwZmxhZ3MtPm5mbGFncywKICAJCQkgICAgICBzZC0+dXNlcm5hbWUsIHNk
LT5hdXRoc3RhdGUsIG1kLT5pZCwKICAJCQkgICAgICBzZC0+dXNlcm5hbWUsIG1kYXRhLT5ub3Rp
ZnloZWFkZXIsCiAgCQkJICAgICAgZmMtPm1haWxib3gsIHF1b3Rhb3ZlcnJpZGUsIDApOwogIAog
ICAgICBpZiAocmV0ID09IDApIHsKICAKKioqIG1ib3huYW1lLmgub2xkCU1vbiBGZWIgIDMgMTQ6
MDY6MjcgMjAwMwotLS0gbWJveG5hbWUuaAlUaHUgRmViICA2IDE3OjM4OjM2IDIwMDMKKioqKioq
KioqKioqKioqCioqKiAxMDMsMTA2ICoqKioKLS0tIDEwMywxMTIgLS0tLQogIAogIGludCBtYm94
bmFtZV9uZXRuZXdzY2hlY2soY2hhciAqbmFtZSk7CiAgCisgLyoKKyAgKiBDb252ZXJ0cyBhIFVU
Ri04IHN0cmluZyB0byBNVVRGLTcuICBtdXRmN19kc3Qgc2hvdWxkIGEgYnVmZmVyIGFibGUKKyAg
KiB0byBob2xkIGF0IGxlYXN0IG1ib3huYW1lX3V0Zjh0b211dGY3X2xlbmd0aCggKSArIDEgYnl0
ZXMuCisgICovCisgY2hhciAqIG1ib3huYW1lX3V0Zjh0b3V0ZjcoY2hhciAqdXRmNywgdW5zaWdu
ZWQgbG9uZyAqc2l6ZSwgY29uc3QgY2hhciAqdXRmOCk7CisgCiAgI2VuZGlmCioqKiBtYm94bmFt
ZS5jLm9sZAlNb24gRmViICAzIDE0OjA1OjQzIDIwMDMKLS0tIG1ib3huYW1lLmMJVGh1IEZlYiAg
NiAxNzozNzozMyAyMDAzCioqKioqKioqKioqKioqKgoqKiogNTU0LDU1NiAqKioqCi0tLSA1NTQs
NzAwIC0tLS0KICAgICAgfQogICAgICByZXR1cm4gMDsKICB9CisgCisgLyogVVRGNyBtb2RpZmll
ZCBiYXNlNjQgYWxwaGFiZXQgKi8KKyBzdGF0aWMgY29uc3QgY2hhciBiYXNlNjRjaGFyc1tdID0K
KyAgICJBQkNERUZHSElKS0xNTk9QUVJTVFVWV1hZWmFiY2RlZmdoaWprbG1ub3BxcnN0dXZ3eHl6
MDEyMzQ1Njc4OSssIjsKKyAKKyAvKiBVVEYxNiBkZWZpbml0aW9ucyAqLworICNkZWZpbmUgVVRG
MTZNQVNLICAgICAgIDB4MDNGRlVMCisgI2RlZmluZSBVVEYxNlNISUZUICAgICAgMTAKKyAjZGVm
aW5lIFVURjE2QkFTRSAgICAgICAweDEwMDAwVUwKKyAjZGVmaW5lIFVURjE2SElHSFNUQVJUICAw
eEQ4MDBVTAorICNkZWZpbmUgVVRGMTZISUdIRU5EICAgIDB4REJGRlVMCisgI2RlZmluZSBVVEYx
NkxPU1RBUlQgICAgMHhEQzAwVUwKKyAjZGVmaW5lIFVURjE2TE9FTkQgICAgICAweERGRkZVTAor
IAorIC8qCisgICogbWJveG5hbWVfdXRmOHRvdXRmNworICAqICAgQ29udmVydHMgYSBVVEYtOCBz
dHJpbmcgdG8gTVVURi03LgorICAqIFJldHVybjogdXRmNyBwb2ludGVyLCBvciBudWxsIHBvaW50
ZXIgaW4gY2FzZSBvZiBlcnJvcgorICAqIFBhcmFtZXRlcjogdXRmNyAob3B0aW9uYWwpCisgICog
ICBwb2ludGVyIHRvIGJ1ZmZlciB0byBjYXRjaCByZXN1bHQgb2YgY29udmVyc2lvbgorICAqIFBh
cmFtZXRlcjogc2l6ZSAocmVxdWlyZWQpCisgICogICBvbiBlbnRyeSBjb250YWlucyBzaXplIG9m
IHV0ZjcgYnVmZmVyLgorICAqICAgb24gcmV0dXJuIGNvbnRhaW5zIGxlbmd0aCBvZiB1dGY3IHN0
cmluZy4KKyAgKiBQYXJhbWV0ZXI6IHV0ZjggKHJlcXVpcmVkKQorICAqICAgcG9pbnRlciB0byBi
dWZmZXIgY29udGFpbmluZyB1dGY4IHN0cmluZyB0byBiZSBjb252ZXJ0ZWQuCisgICovCisgY2hh
ciAqIG1ib3huYW1lX3V0Zjh0b3V0ZjcoY2hhciAqdXRmNywgdW5zaWduZWQgbG9uZyAqc2l6ZSwg
Y29uc3QgY2hhciAqdXRmOCkKKyB7CisgICAgIGNvbnN0IHVuc2lnbmVkIGNoYXIgKnNyYzsKKyAg
ICAgY2hhciAqZHN0IDsKKyAgICAgdW5zaWduZWQgaW50IHV0Zjhwb3MgPSAwLCB1dGY4dG90YWws
IGksIGMsIHV0Zjdtb2RlLCBiaXRzdG9nbywgdXRmMTZmbGFnOworICAgICB1bnNpZ25lZCBsb25n
IHVjczQgPSAwLCBiaXRidWYgPSAwLCBsZW4gPSAwLCB1dGY3bGVuID0gMDsKKyAKKyAgICAgLyog
Y2hlY2sgYXJncyAqLworICAgICBpZiAoIXNpemUgfHwgIXV0ZjgpIHJldHVybiAoY2hhciAqKTA7
ICAgICAgICAgICAvKiBubyBsZW4gb3Igc3JjICAgICAgICAgKi8KKyAgICAgaWYgKCF1dGY3KSBs
ZW4gPSAwOyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLyogbm8gZHN0IGJ1ZmZlciBsZW4g
PSAwICovCisgICAgIGVsc2UgbGVuID0gKnNpemU7ICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgIC8qIGxlbiA9IGRzdCBidWYgc2l6ZSAgICAqLworICAgICAvKiBpbml0aWFsaXplIHBvaW50
ZXJzICovCisgICAgIHNyYyA9IChjb25zdCB1bnNpZ25lZCBjaGFyICopdXRmODsKKyAgICAgZHN0
ID0gdXRmNzsKKyAgICAgdXRmN21vZGUgPSAwOworICAgICB1dGY4dG90YWwgPSAwOworICAgICBi
aXRzdG9nbyA9IDA7CisgICAgIHdoaWxlICgoYyA9ICpzcmMpICE9ICdcMCcpIHsKKyAgICAgICAg
ICsrc3JjOworICAgICAgICAgLyogbm9ybWFsIGNoYXJhY3Rlcj8gKi8KKyAgICAgICAgIGlmIChj
ID49ICcgJyAmJiBjIDw9ICd+JykgeworICAgICAgICAgICAgIC8qIHN3aXRjaCBvdXQgb2YgVVRG
LTcgbW9kZSAqLworICAgICAgICAgICAgIGlmICh1dGY3bW9kZSkgeworICAgICAgICAgICAgICAg
ICBpZiAoYml0c3RvZ28pIHsKKyAJCSAgICB1dGY3bGVuKys7ICAgICAgICAgICAgICAgICAgICAg
ICAgLyogY291bnQgY2hhcmFjdGVyICAgICAgICovCisgCQkgICAgaWYoZHN0ICYmICh1dGY3bGVu
IDwgbGVuKSkgICAgICAgIC8qIGhhdmUgZHN0PyBiaWcgZW5vdWdoPyAqLworIAkJCSpkc3QrKyA9
IGJhc2U2NGNoYXJzWyhiaXRidWYgPDwgKDYgLSBiaXRzdG9nbykpICYgMHgzRl07CisgICAgICAg
ICAgICAgICAgIH0KKyAJCXV0ZjdsZW4rKzsgICAgICAgICAgICAgICAgICAgICAgICAgICAgLyog
Y291bnQgY2hhcmFjdGVyICAgICAgICovCisgICAgICAgICAgICAgICAgIGlmKGRzdCAmJiAodXRm
N2xlbiA8IGxlbikpICAgICAgICAgIC8qIGhhdmUgZHN0PyBiaWcgZW5vdWdoPyAqLworIAkJICAg
ICpkc3QrKyA9ICctJzsKKyAgICAgICAgICAgICAgICAgdXRmN21vZGUgPSAwOworICAgICAgICAg
ICAgIH0KKyAgICAgICAgICAgICB1dGY3bGVuKys7ICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgLyogY291bnQgY2hhcmFjdGVyICAgICAgICovCisgCSAgICBpZihkc3QgJiYgKHV0ZjdsZW4g
PCBsZW4pKSAgICAgICAgICAgICAgICAvKiBoYXZlIGRzdD8gYmlnIGVub3VnaD8gKi8KKyAJCSpk
c3QrKyA9IGM7CisgICAgICAgICAgICAgLyogZW5jb2RlICcmJyBhcyAnJi0nICovCisgICAgICAg
ICAgICAgaWYgKGMgPT0gJyYnKSB7CisgICAgICAgICAgICAgICAgIHV0ZjdsZW4rKzsgICAgICAg
ICAgICAgICAgICAgICAgICAgIC8qIGNvdW50IGNoYXJhY2VyICAgICAgICAqLworICAgICAgICAg
ICAgICAgICBpZihkc3QgJiYgKHV0ZjdsZW4gPCBsZW4pKSAgICAgICAgICAvKiBoYXZlIGRzdD8g
YmlnIGVub3VnaD8gKi8KKyAJCSAgICAqZHN0KysgPSAnLSc7CisgICAgICAgICAgICAgfQorICAg
ICAgICAgICAgIGNvbnRpbnVlOworICAgICAgICAgfQorICAgICAgICAgLyogc3dpdGNoIHRvIFVU
Ri03IG1vZGUgKi8KKyAgICAgICAgIGlmICghdXRmN21vZGUpIHsKKyAgICAgICAgICAgICB1dGY3
bGVuKys7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLyogY291bnQgY2hhcmFjdGVyICAg
ICAgICovCisgCSAgICBpZihkc3QgJiYgKHV0ZjdsZW4gPCBsZW4pKSAgICAgICAgICAgICAgICAv
KiBoYXZlIGRzdD8gYmlnIGVub3VnaD8gKi8KKyAJCSpkc3QrKyA9ICcmJzsKKyAgICAgICAgICAg
ICB1dGY3bW9kZSA9IDE7CisgICAgICAgICB9CisgICAgICAgICAvKiBFbmNvZGUgVVMtQVNDSUkg
Y2hhcmFjdGVycyBhcyB0aGVtc2VsdmVzICovCisgICAgICAgICBpZiAoYyA8IDB4ODApIHsKKyAg
ICAgICAgICAgICB1Y3M0ID0gYzsKKyAgICAgICAgICAgICB1dGY4dG90YWwgPSAxOworICAgICAg
ICAgfSBlbHNlIGlmICh1dGY4dG90YWwpIHsKKyAgICAgICAgICAgICAvKiBzYXZlIFVURjggYml0
cyBpbnRvIFVDUzQgKi8KKyAgICAgICAgICAgICB1Y3M0ID0gKHVjczQgPDwgNikgfCAoYyAmIDB4
M0ZVTCk7CisgICAgICAgICAgICAgaWYgKCsrdXRmOHBvcyA8IHV0Zjh0b3RhbCkgeworICAgICAg
ICAgICAgICAgICBjb250aW51ZTsKKyAgICAgICAgICAgICB9CisgICAgICAgICB9IGVsc2Ugewor
ICAgICAgICAgICAgIHV0Zjhwb3MgPSAxOworICAgICAgICAgICAgIGlmIChjIDwgMHhFMCkgewor
ICAgICAgICAgICAgICAgICB1dGY4dG90YWwgPSAyOworICAgICAgICAgICAgICAgICB1Y3M0ID0g
YyAmIDB4MUY7CisgICAgICAgICAgICAgfSBlbHNlIGlmIChjIDwgMHhGMCkgeworICAgICAgICAg
ICAgICAgICB1dGY4dG90YWwgPSAzOworICAgICAgICAgICAgICAgICB1Y3M0ID0gYyAmIDB4MEY7
CisgICAgICAgICAgICAgfSBlbHNlIHsKKyAgICAgICAgICAgICAgICAgLyogTk9URTogY2FuJ3Qg
Y29udmVydCBVVEY4IHNlcXVlbmNlcyBsb25nZXIgdGhhbiA0ICovCisgICAgICAgICAgICAgICAg
IHV0Zjh0b3RhbCA9IDQ7CisgICAgICAgICAgICAgICAgIHVjczQgPSBjICYgMHgwMzsKKyAgICAg
ICAgICAgICB9CisgICAgICAgICAgICAgY29udGludWU7CisgICAgICAgICB9CisgICAgICAgICAv
KiBsb29wIHRvIHNwbGl0IHVjczQgaW50byB0d28gdXRmMTYgY2hhcnMgaWYgbmVjZXNzYXJ5ICov
CisgICAgICAgICB1dGY4dG90YWwgPSAwOworICAgICAgICAgZG8geworICAgICAgICAgICAgIGlm
ICh1Y3M0ID49IFVURjE2QkFTRSkgeworICAgICAgICAgICAgICAgICB1Y3M0IC09IFVURjE2QkFT
RTsKKyAgICAgICAgICAgICAgICAgYml0YnVmID0gKGJpdGJ1ZiA8PCAxNikgfCAoKHVjczQgPj4g
VVRGMTZTSElGVCkKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
KyBVVEYxNkhJR0hTVEFSVCk7CisgICAgICAgICAgICAgICAgIHVjczQgPSAodWNzNCAmIFVURjE2
TUFTSykgKyBVVEYxNkxPU1RBUlQ7CisgICAgICAgICAgICAgICAgIHV0ZjE2ZmxhZyA9IDE7Cisg
ICAgICAgICAgICAgfSBlbHNlIHsKKyAgICAgICAgICAgICAgICAgYml0YnVmID0gKGJpdGJ1ZiA8
PCAxNikgfCB1Y3M0OworICAgICAgICAgICAgICAgICB1dGYxNmZsYWcgPSAwOworICAgICAgICAg
ICAgIH0KKyAgICAgICAgICAgICBiaXRzdG9nbyArPSAxNjsKKyAgICAgICAgICAgICAvKiBzcGV3
IG91dCBiYXNlNjQgKi8KKyAgICAgICAgICAgICB3aGlsZSAoYml0c3RvZ28gPj0gNikgeworICAg
ICAgICAgICAgICAgICBiaXRzdG9nbyAtPSA2OworICAgICAgICAgICAgICAgICB1dGY3bGVuKys7
ICAgICAgICAgICAgICAgICAgICAgICAgICAvKiBjb3VudCBjaGFyYWN0ZXIgICAgICAgKi8KKyAJ
CWlmKGRzdCAmJiAodXRmN2xlbiA8IGxlbikpICAgICAgICAgICAgLyogaGF2ZSBkc3Q/IGJpZyBl
bm91Z2g/ICovCisgCQkgICAgKmRzdCsrID0gYmFzZTY0Y2hhcnNbKGJpdHN0b2dvID8gKGJpdGJ1
ZiA+PiBiaXRzdG9nbykKKyAJCQkJCSAgOiBiaXRidWYpCisgCQkJCQkmIDB4M0ZdOworICAgICAg
ICAgICAgIH0KKyAgICAgICAgIH0gd2hpbGUgKHV0ZjE2ZmxhZyk7CisgICAgIH0KKyAgICAgLyog
aWYgaW4gVVRGLTcgbW9kZSwgZmluaXNoIGluIEFTQ0lJICovCisgICAgIGlmICh1dGY3bW9kZSkg
eworICAgICAgICAgaWYgKGJpdHN0b2dvKSB7CisgICAgICAgICAgICAgdXRmN2xlbisrOyAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgIC8qIGNvdW50IGNoYXJhY3RlciAgICAgICAqLworIAkg
ICAgaWYoZHN0ICYmICh1dGY3bGVuIDwgbGVuKSkgICAgICAgICAgICAgICAgLyogaGF2ZSBkc3Q/
IGJpZyBlbm91Z2g/ICovCisgCQkqZHN0KysgPSBiYXNlNjRjaGFyc1soYml0YnVmIDw8ICg2IC0g
Yml0c3RvZ28pKSAmIDB4M0ZdOworICAgICAgICAgfQorICAgICAgICAgdXRmN2xlbisrOworIAlp
Zihkc3QgJiYgKHV0ZjdsZW4gPCBsZW4pKSAqZHN0KysgPSAnLSc7CisgICAgIH0KKyAgICAgaWYo
ZHN0ICYmICh1dGY3bGVuIDwgbGVuKSkgICAgICAgICAgICAgICAgICAgICAgLyogaGF2ZSBkc3Q/
IGJpZyBlbm91Z2g/ICovCisgCSpkc3QgPSAnXDAnOyAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAvKiBudWxsIHRlcm1pbmF0ZSBkc3QgICAgKi8KKyAgICAgZWxzZSAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLyogbm8gZHN0IG9yIG5vdCBlbm91Z2gg
ICovCisgCXV0ZjcgPSAoY2hhciAqKTA7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvKiBG
QUlMVVJFOiBudWxsIHJlc3VsdCAgKi8KKyAgICAgKnNpemUgPSB1dGY3bGVuOyAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgLyogcmV0dXJuIG11dGY3IGxlbmd0aCAgICovCisgICAgIHJl
dHVybiB1dGY3OyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8qIHJldHVybiBy
ZXN1bHQgICAgICAgICAqLworIH0K
</data>        

          </attachment>
          <attachment
              isobsolete="0"
              ispatch="1"
              isprivate="0"
          >
            <attachid>112</attachid>
            <date>2003-02-06 05:07 EDT</date>
            <desc>Patch to convert sieve_fileinto() names from utf8 to utf7</desc>
            <filename>lldiffs</filename>
            <type>text/plain</type>
            <size>7115</size>
            <attacher>mark@air.co.jp</attacher>
            
              <data encoding="base64">KioqIGltYXAvbG10cGQuYy5vbGQJTW9uIEphbiAyMCAxNjo1ODoxNCAyMDAzCi0tLSBpbWFwL2xt
dHBkLmMJVGh1IEZlYiAgNiAxODo0NDozMiAyMDAzCioqKioqKioqKioqKioqKgoqKiogNzE4LDcz
MCAqKioqCi0tLSA3MTgsNzQyIC0tLS0KICAgICAgbWVzc2FnZV9kYXRhX3QgKm1kID0gbWRhdGEt
Pm07CiAgICAgIGludCBxdW90YW92ZXJyaWRlID0gbXNnX2dldHJjcHRfaWdub3JlcXVvdGEobWQs
IG1kYXRhLT5jdXJfcmNwdCk7CiAgICAgIGludCByZXQ7CisgICAgIGNoYXIgbmFtZVtNQVhfTUFJ
TEJPWF9QQVRIXTsKKyAgICAgdW5zaWduZWQgbG9uZyBsZW5ndGggPSBzaXplb2YgKG5hbWUpOwog
IAogICAgICAvKiB3ZSdyZSBub3cgdGhlIHVzZXIgd2hvIG93bnMgdGhlIHNjcmlwdCAqLwogICAg
ICBpZiAoIXNkLT5hdXRoc3RhdGUpCiAgCXJldHVybiBTSUVWRV9GQUlMOwogIAorICAgICBtZW1z
ZXQobmFtZSwgMCwgbGVuZ3RoKTsJCQkgICAgLyogY2xlYXIgbmFtZSBidWZmZXIgICAgICovCisg
ICAgIGlmICghbWJveG5hbWVfdXRmOHRvdXRmNyhuYW1lLCAmbGVuZ3RoLCBmYy0+bWFpbGJveCkp
CisgCXJldHVybiBTSUVWRV9GQUlMOwkJCSAgICAvKiBGQUlMOiBjb3VsZG50IGNvbnZlcnQgKi8K
KyAgICAgaWYgKCpuYW1lKQkJCQkJICAgIC8qIHVzZSBtdXRmNyBuYW1lICAgICAgICAqLworIAly
ZXQgPSBkZWxpdmVyX21haWxib3gobWQtPmRhdGEsIG1kYXRhLT5zdGFnZSwgbWQtPnNpemUsCisg
CQkJICAgICAgZmMtPmltYXBmbGFncy0+ZmxhZywgZmMtPmltYXBmbGFncy0+bmZsYWdzLAorIAkJ
CSAgICAgIHNkLT51c2VybmFtZSwgc2QtPmF1dGhzdGF0ZSwgbWQtPmlkLAorIAkJCSAgICAgIHNk
LT51c2VybmFtZSwgbWRhdGEtPm5vdGlmeWhlYWRlciwKKyAJCQkgICAgICBuYW1lLCBxdW90YW92
ZXJyaWRlLCAwKTsKKyAgICAgZWxzZQkJCQkJICAgIC8qIHVzZSBvcmlnaW5hbCBuYW1lICAgICAq
LwogIAlyZXQgPSBkZWxpdmVyX21haWxib3gobWQtPmRhdGEsIG1kYXRhLT5zdGFnZSwgbWQtPnNp
emUsCiAgCQkJICAgICAgZmMtPmltYXBmbGFncy0+ZmxhZywgZmMtPmltYXBmbGFncy0+bmZsYWdz
LAogIAkJCSAgICAgIHNkLT51c2VybmFtZSwgc2QtPmF1dGhzdGF0ZSwgbWQtPmlkLAogIAkJCSAg
ICAgIHNkLT51c2VybmFtZSwgbWRhdGEtPm5vdGlmeWhlYWRlciwKICAJCQkgICAgICBmYy0+bWFp
bGJveCwgcXVvdGFvdmVycmlkZSwgMCk7CioqKiBpbWFwL21ib3huYW1lLmgub2xkCU1vbiBKYW4g
MjAgMTY6NDc6MjYgMjAwMwotLS0gaW1hcC9tYm94bmFtZS5oCVRodSBGZWIgIDYgMTc6Mzg6MzYg
MjAwMwoqKioqKioqKioqKioqKioKKioqIDEwMywxMDYgKioqKgotLS0gMTAzLDExMiAtLS0tCiAg
CiAgaW50IG1ib3huYW1lX25ldG5ld3NjaGVjayhjaGFyICpuYW1lKTsKICAKKyAvKgorICAqIENv
bnZlcnRzIGEgVVRGLTggc3RyaW5nIHRvIE1VVEYtNy4gIG11dGY3X2RzdCBzaG91bGQgYSBidWZm
ZXIgYWJsZQorICAqIHRvIGhvbGQgYXQgbGVhc3QgbWJveG5hbWVfdXRmOHRvbXV0ZjdfbGVuZ3Ro
KCApICsgMSBieXRlcy4KKyAgKi8KKyBjaGFyICogbWJveG5hbWVfdXRmOHRvdXRmNyhjaGFyICp1
dGY3LCB1bnNpZ25lZCBsb25nICpzaXplLCBjb25zdCBjaGFyICp1dGY4KTsKKyAKICAjZW5kaWYK
KioqIGltYXAvbWJveG5hbWUuYy5vbGQJTW9uIEphbiAyMCAxNjo0NDoxOCAyMDAzCi0tLSBpbWFw
L21ib3huYW1lLmMJVGh1IEZlYiAgNiAxNzozNzozMyAyMDAzCioqKioqKioqKioqKioqKgoqKiog
NTU0LDU1NiAqKioqCi0tLSA1NTQsNzAwIC0tLS0KICAgICAgfQogICAgICByZXR1cm4gMDsKICB9
CisgCisgLyogVVRGNyBtb2RpZmllZCBiYXNlNjQgYWxwaGFiZXQgKi8KKyBzdGF0aWMgY29uc3Qg
Y2hhciBiYXNlNjRjaGFyc1tdID0KKyAgICJBQkNERUZHSElKS0xNTk9QUVJTVFVWV1hZWmFiY2Rl
ZmdoaWprbG1ub3BxcnN0dXZ3eHl6MDEyMzQ1Njc4OSssIjsKKyAKKyAvKiBVVEYxNiBkZWZpbml0
aW9ucyAqLworICNkZWZpbmUgVVRGMTZNQVNLICAgICAgIDB4MDNGRlVMCisgI2RlZmluZSBVVEYx
NlNISUZUICAgICAgMTAKKyAjZGVmaW5lIFVURjE2QkFTRSAgICAgICAweDEwMDAwVUwKKyAjZGVm
aW5lIFVURjE2SElHSFNUQVJUICAweEQ4MDBVTAorICNkZWZpbmUgVVRGMTZISUdIRU5EICAgIDB4
REJGRlVMCisgI2RlZmluZSBVVEYxNkxPU1RBUlQgICAgMHhEQzAwVUwKKyAjZGVmaW5lIFVURjE2
TE9FTkQgICAgICAweERGRkZVTAorIAorIC8qCisgICogbWJveG5hbWVfdXRmOHRvdXRmNworICAq
ICAgQ29udmVydHMgYSBVVEYtOCBzdHJpbmcgdG8gTVVURi03LgorICAqIFJldHVybjogdXRmNyBw
b2ludGVyLCBvciBudWxsIHBvaW50ZXIgaW4gY2FzZSBvZiBlcnJvcgorICAqIFBhcmFtZXRlcjog
dXRmNyAob3B0aW9uYWwpCisgICogICBwb2ludGVyIHRvIGJ1ZmZlciB0byBjYXRjaCByZXN1bHQg
b2YgY29udmVyc2lvbgorICAqIFBhcmFtZXRlcjogc2l6ZSAocmVxdWlyZWQpCisgICogICBvbiBl
bnRyeSBjb250YWlucyBzaXplIG9mIHV0ZjcgYnVmZmVyLgorICAqICAgb24gcmV0dXJuIGNvbnRh
aW5zIGxlbmd0aCBvZiB1dGY3IHN0cmluZy4KKyAgKiBQYXJhbWV0ZXI6IHV0ZjggKHJlcXVpcmVk
KQorICAqICAgcG9pbnRlciB0byBidWZmZXIgY29udGFpbmluZyB1dGY4IHN0cmluZyB0byBiZSBj
b252ZXJ0ZWQuCisgICovCisgY2hhciAqIG1ib3huYW1lX3V0Zjh0b3V0ZjcoY2hhciAqdXRmNywg
dW5zaWduZWQgbG9uZyAqc2l6ZSwgY29uc3QgY2hhciAqdXRmOCkKKyB7CisgICAgIGNvbnN0IHVu
c2lnbmVkIGNoYXIgKnNyYzsKKyAgICAgY2hhciAqZHN0IDsKKyAgICAgdW5zaWduZWQgaW50IHV0
Zjhwb3MgPSAwLCB1dGY4dG90YWwsIGksIGMsIHV0Zjdtb2RlLCBiaXRzdG9nbywgdXRmMTZmbGFn
OworICAgICB1bnNpZ25lZCBsb25nIHVjczQgPSAwLCBiaXRidWYgPSAwLCBsZW4gPSAwLCB1dGY3
bGVuID0gMDsKKyAKKyAgICAgLyogY2hlY2sgYXJncyAqLworICAgICBpZiAoIXNpemUgfHwgIXV0
ZjgpIHJldHVybiAoY2hhciAqKTA7ICAgIC8qIG5vIGxlbiBvciBzcmMgICAgICAgICAqLworICAg
ICBpZiAoIXV0ZjcpIGxlbiA9IDA7CQkJICAgIC8qIG5vIGRzdCBidWZmZXIgbGVuID0gMCAqLwor
ICAgICBlbHNlIGxlbiA9ICpzaXplOwkJCSAgICAvKiBsZW4gPSBkc3QgYnVmIHNpemUgICAgKi8K
KyAgICAgLyogaW5pdGlhbGl6ZSBwb2ludGVycyAqLworICAgICBzcmMgPSAoY29uc3QgdW5zaWdu
ZWQgY2hhciAqKXV0Zjg7CisgICAgIGRzdCA9IHV0Zjc7CisgICAgIHV0Zjdtb2RlID0gMDsKKyAg
ICAgdXRmOHRvdGFsID0gMDsKKyAgICAgYml0c3RvZ28gPSAwOworICAgICB3aGlsZSAoKGMgPSAq
c3JjKSAhPSAnXDAnKSB7CisgICAgICAgICArK3NyYzsKKyAgICAgICAgIC8qIG5vcm1hbCBjaGFy
YWN0ZXI/ICovCisgICAgICAgICBpZiAoYyA+PSAnICcgJiYgYyA8PSAnficpIHsKKyAgICAgICAg
ICAgICAvKiBzd2l0Y2ggb3V0IG9mIFVURi03IG1vZGUgKi8KKyAgICAgICAgICAgICBpZiAodXRm
N21vZGUpIHsKKyAgICAgICAgICAgICAgICAgaWYgKGJpdHN0b2dvKSB7CisgCQkgICAgdXRmN2xl
bisrOwkJCSAgICAvKiBjb3VudCBjaGFyYWN0ZXIgICAgICAgKi8KKyAJCSAgICBpZihkc3QgJiYg
KHV0ZjdsZW4gPCBsZW4pKSAgICAgIC8qIGhhdmUgZHN0PyBiaWcgZW5vdWdoPyAqLworIAkJCSpk
c3QrKyA9IGJhc2U2NGNoYXJzWyhiaXRidWYgPDwgKDYgLSBiaXRzdG9nbykpICYgMHgzRl07Cisg
ICAgICAgICAgICAgICAgIH0KKyAJCXV0ZjdsZW4rKzsJCQkgICAgLyogY291bnQgY2hhcmFjdGVy
ICAgICAgICovCisgICAgICAgICAgICAgICAgIGlmKGRzdCAmJiAodXRmN2xlbiA8IGxlbikpCSAg
ICAvKiBoYXZlIGRzdD8gYmlnIGVub3VnaD8gKi8KKyAJCSAgICAqZHN0KysgPSAnLSc7CisgICAg
ICAgICAgICAgICAgIHV0Zjdtb2RlID0gMDsKKyAgICAgICAgICAgICB9CisgICAgICAgICAgICAg
dXRmN2xlbisrOwkJCQkgICAgLyogY291bnQgY2hhcmFjdGVyICAgICAgICovCisgCSAgICBpZihk
c3QgJiYgKHV0ZjdsZW4gPCBsZW4pKQkJICAgIC8qIGhhdmUgZHN0PyBiaWcgZW5vdWdoPyAqLwor
IAkJKmRzdCsrID0gYzsKKyAgICAgICAgICAgICAvKiBlbmNvZGUgJyYnIGFzICcmLScgKi8KKyAg
ICAgICAgICAgICBpZiAoYyA9PSAnJicpIHsKKyAgICAgICAgICAgICAgICAgdXRmN2xlbisrOwkJ
CSAgICAvKiBjb3VudCBjaGFyYWNlciAgICAgICAgKi8KKyAgICAgICAgICAgICAgICAgaWYoZHN0
ICYmICh1dGY3bGVuIDwgbGVuKSkJICAgIC8qIGhhdmUgZHN0PyBiaWcgZW5vdWdoPyAqLworIAkJ
ICAgICpkc3QrKyA9ICctJzsKKyAgICAgICAgICAgICB9CisgICAgICAgICAgICAgY29udGludWU7
CisgICAgICAgICB9CisgICAgICAgICAvKiBzd2l0Y2ggdG8gVVRGLTcgbW9kZSAqLworICAgICAg
ICAgaWYgKCF1dGY3bW9kZSkgeworICAgICAgICAgICAgIHV0ZjdsZW4rKzsJCQkJICAgIC8qIGNv
dW50IGNoYXJhY3RlciAgICAgICAqLworIAkgICAgaWYoZHN0ICYmICh1dGY3bGVuIDwgbGVuKSkJ
CSAgICAvKiBoYXZlIGRzdD8gYmlnIGVub3VnaD8gKi8KKyAJCSpkc3QrKyA9ICcmJzsKKyAgICAg
ICAgICAgICB1dGY3bW9kZSA9IDE7CisgICAgICAgICB9CisgICAgICAgICAvKiBFbmNvZGUgVVMt
QVNDSUkgY2hhcmFjdGVycyBhcyB0aGVtc2VsdmVzICovCisgICAgICAgICBpZiAoYyA8IDB4ODAp
IHsKKyAgICAgICAgICAgICB1Y3M0ID0gYzsKKyAgICAgICAgICAgICB1dGY4dG90YWwgPSAxOwor
ICAgICAgICAgfSBlbHNlIGlmICh1dGY4dG90YWwpIHsKKyAgICAgICAgICAgICAvKiBzYXZlIFVU
RjggYml0cyBpbnRvIFVDUzQgKi8KKyAgICAgICAgICAgICB1Y3M0ID0gKHVjczQgPDwgNikgfCAo
YyAmIDB4M0ZVTCk7CisgICAgICAgICAgICAgaWYgKCsrdXRmOHBvcyA8IHV0Zjh0b3RhbCkgewor
ICAgICAgICAgICAgICAgICBjb250aW51ZTsKKyAgICAgICAgICAgICB9CisgICAgICAgICB9IGVs
c2UgeworICAgICAgICAgICAgIHV0Zjhwb3MgPSAxOworICAgICAgICAgICAgIGlmIChjIDwgMHhF
MCkgeworICAgICAgICAgICAgICAgICB1dGY4dG90YWwgPSAyOworICAgICAgICAgICAgICAgICB1
Y3M0ID0gYyAmIDB4MUY7CisgICAgICAgICAgICAgfSBlbHNlIGlmIChjIDwgMHhGMCkgeworICAg
ICAgICAgICAgICAgICB1dGY4dG90YWwgPSAzOworICAgICAgICAgICAgICAgICB1Y3M0ID0gYyAm
IDB4MEY7CisgICAgICAgICAgICAgfSBlbHNlIHsKKyAgICAgICAgICAgICAgICAgLyogTk9URTog
Y2FuJ3QgY29udmVydCBVVEY4IHNlcXVlbmNlcyBsb25nZXIgdGhhbiA0ICovCisgICAgICAgICAg
ICAgICAgIHV0Zjh0b3RhbCA9IDQ7CisgICAgICAgICAgICAgICAgIHVjczQgPSBjICYgMHgwMzsK
KyAgICAgICAgICAgICB9CisgICAgICAgICAgICAgY29udGludWU7CisgICAgICAgICB9CisgICAg
ICAgICAvKiBsb29wIHRvIHNwbGl0IHVjczQgaW50byB0d28gdXRmMTYgY2hhcnMgaWYgbmVjZXNz
YXJ5ICovCisgICAgICAgICB1dGY4dG90YWwgPSAwOworICAgICAgICAgZG8geworICAgICAgICAg
ICAgIGlmICh1Y3M0ID49IFVURjE2QkFTRSkgeworICAgICAgICAgICAgICAgICB1Y3M0IC09IFVU
RjE2QkFTRTsKKyAgICAgICAgICAgICAgICAgYml0YnVmID0gKGJpdGJ1ZiA8PCAxNikgfCAoKHVj
czQgPj4gVVRGMTZTSElGVCkKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgKyBVVEYxNkhJR0hTVEFSVCk7CisgICAgICAgICAgICAgICAgIHVjczQgPSAodWNzNCAm
IFVURjE2TUFTSykgKyBVVEYxNkxPU1RBUlQ7CisgICAgICAgICAgICAgICAgIHV0ZjE2ZmxhZyA9
IDE7CisgICAgICAgICAgICAgfSBlbHNlIHsKKyAgICAgICAgICAgICAgICAgYml0YnVmID0gKGJp
dGJ1ZiA8PCAxNikgfCB1Y3M0OworICAgICAgICAgICAgICAgICB1dGYxNmZsYWcgPSAwOworICAg
ICAgICAgICAgIH0KKyAgICAgICAgICAgICBiaXRzdG9nbyArPSAxNjsKKyAgICAgICAgICAgICAv
KiBzcGV3IG91dCBiYXNlNjQgKi8KKyAgICAgICAgICAgICB3aGlsZSAoYml0c3RvZ28gPj0gNikg
eworICAgICAgICAgICAgICAgICBiaXRzdG9nbyAtPSA2OworICAgICAgICAgICAgICAgICB1dGY3
bGVuKys7CQkJICAgIC8qIGNvdW50IGNoYXJhY3RlciAgICAgICAqLworIAkJaWYoZHN0ICYmICh1
dGY3bGVuIDwgbGVuKSkJICAgIC8qIGhhdmUgZHN0PyBiaWcgZW5vdWdoPyAqLworIAkJICAgICpk
c3QrKyA9IGJhc2U2NGNoYXJzWyhiaXRzdG9nbyA/IChiaXRidWYgPj4gYml0c3RvZ28pCisgCQkJ
CQkgIDogYml0YnVmKQorIAkJCQkJJiAweDNGXTsKKyAgICAgICAgICAgICB9CisgICAgICAgICB9
IHdoaWxlICh1dGYxNmZsYWcpOworICAgICB9CisgICAgIC8qIGlmIGluIFVURi03IG1vZGUsIGZp
bmlzaCBpbiBBU0NJSSAqLworICAgICBpZiAodXRmN21vZGUpIHsKKyAgICAgICAgIGlmIChiaXRz
dG9nbykgeworICAgICAgICAgICAgIHV0ZjdsZW4rKzsJCQkJICAgIC8qIGNvdW50IGNoYXJhY3Rl
ciAgICAgICAqLworIAkgICAgaWYoZHN0ICYmICh1dGY3bGVuIDwgbGVuKSkJCSAgICAvKiBoYXZl
IGRzdD8gYmlnIGVub3VnaD8gKi8KKyAJCSpkc3QrKyA9IGJhc2U2NGNoYXJzWyhiaXRidWYgPDwg
KDYgLSBiaXRzdG9nbykpICYgMHgzRl07CisgICAgICAgICB9CisgICAgICAgICB1dGY3bGVuKys7
CisgCWlmKGRzdCAmJiAodXRmN2xlbiA8IGxlbikpICpkc3QrKyA9ICctJzsKKyAgICAgfQorICAg
ICBpZihkc3QgJiYgKHV0ZjdsZW4gPCBsZW4pKQkJCSAgICAvKiBoYXZlIGRzdD8gYmlnIGVub3Vn
aD8gKi8KKyAJKmRzdCA9ICdcMCc7CQkJCSAgICAvKiBudWxsIHRlcm1pbmF0ZSBkc3QgICAgKi8K
KyAgICAgZWxzZQkJCQkJICAgIC8qIG5vIGRzdCBvciBub3QgZW5vdWdoICAqLworIAl1dGY3ID0g
KGNoYXIgKikwOwkJCSAgICAvKiBGQUlMVVJFOiByZXR1cm4gbnVsbCAgKi8KKyAgICAgKnNpemUg
PSB1dGY3bGVuOwkJCQkgICAgLyogcmV0dXJuIG11dGY3IGxlbmd0aCAgICovCisgICAgIHJldHVy
biB1dGY3OwkJCQkgICAgLyogcmV0dXJuIHJlc3VsdCAgICAgICAgICovCisgfQo=
</data>        

          </attachment>
      

    </bug>

</bugzilla>