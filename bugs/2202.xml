<?xml version="1.0" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugzilla.cyrusimap.org/bugzilla.dtd">

<bugzilla version="3.2.5.1-2"
          urlbase="https://bugzilla.cyrusimap.org/"
          maintainer="Dave McMurtrie &lt;dave64@andrew.cmu.edu&gt;"
>

    <bug>
          <bug_id>2202</bug_id>
          
          <creation_ts>2003-09-27 21:57 EDT</creation_ts>
          <short_desc>lmtpd doesn&apos;t include locally generated headers in the header cache</short_desc>
          <delta_ts>2010-10-18 12:43:03 EDT</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Cyrus IMAP</product>
          <component>IMAP</component>
          <version>2.1.x</version>
          <rep_platform>Other</rep_platform>
          <op_sys>other</op_sys>
          <bug_status>CLOSED</bug_status>
          <resolution>FIXED</resolution>
          
          
          
          
          <priority>P2</priority>
          <bug_severity>bug</bug_severity>
          <target_milestone>Future</target_milestone>
          
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Chris Stromsoe">cbs@cts.ucla.edu</reporter>
          <assigned_to name="Rob Siemborski">rjs3@andrew.cmu.edu</assigned_to>
          
          <qa_contact name="The Cyrus Bugzilla List">cyrus-bugzilla@lists.andrew.cmu.edu</qa_contact>

      

      

      
          <long_desc isprivate="0">
            <who name="Chris Stromsoe">cbs@cts.ucla.edu</who>
            <bug_when>2003-09-27 21:57:36 EDT</bug_when>
            <thetext>lmtpd does not include the generated headers (X-Sieve, Return-Path, lmtpd
Received) in the header cache to allow sieve parsing.  lmtpd.c, lmtpengine.c,
and lmtpengine.h need to be patched.</thetext>
          </long_desc>
          <long_desc isprivate="0">
            <who name="Chris Stromsoe">cbs@cts.ucla.edu</who>
            <bug_when>2003-09-27 22:03:12 EDT</bug_when>
            <thetext>Created an attachment (id=228)
this patch adds all the generated headers to the header cache

This patches lmtpd.c, lmtpproxyd.c, lmtpengine.c, and lmtpengine.h.  It changes
struct lmtp_func (changes addheaders from char* to struct Header* and adds int
nheaders) and changes the initializers for lmtp_func to account for the new
field.	It adds a new function addheader() to add arbitrary headers to the
header cache.</thetext>
          </long_desc>
          <long_desc isprivate="0">
            <who name="Chris Stromsoe">cbs@cts.ucla.edu</who>
            <bug_when>2003-11-23 08:07:00 EDT</bug_when>
            <thetext>Created an attachment (id=237)
patch updated for 2.1.16

The former patch updated from 2.1.15 to 2.1.16.  It applies cleanly with an
offset of 2 lines in lmtpengine.c</thetext>
          </long_desc>
          <long_desc isprivate="0">
            <who name="Ken Murchison">ken@oceana.com</who>
            <bug_when>2004-03-03 16:24:19 EDT</bug_when>
            <thetext>Committed a fix to 2.2 based in Chris&apos; patch.</thetext>
          </long_desc>
      
          <attachment
              isobsolete="1"
              ispatch="1"
              isprivate="0"
          >
            <attachid>228</attachid>
            <date>2003-09-27 22:03 EDT</date>
            <desc>this patch adds all the generated headers to the header cache</desc>
            <filename>cyrus-imapd-2.1.15.diff</filename>
            <type>text/plain</type>
            <size>10200</size>
            <attacher>cbs@cts.ucla.edu</attacher>
            
              <data encoding="base64">ZGlmZiAtcnUgY3lydXMtaW1hcGQtMi4xLjE1Lm9yaWcvaW1hcC9sbXRwZC5jIGN5cnVzLWltYXBk
LTIuMS4xNS9pbWFwL2xtdHBkLmMKLS0tIGN5cnVzLWltYXBkLTIuMS4xNS5vcmlnL2ltYXAvbG10
cGQuYwkyMDAzLTA4LTEzIDExOjM5OjM4LjAwMDAwMDAwMCAtMDcwMAorKysgY3lydXMtaW1hcGQt
Mi4xLjE1L2ltYXAvbG10cGQuYwkyMDAzLTA5LTI3IDE2OjAxOjUwLjUwOTExOTAwMCAtMDcwMApA
QCAtMTQ2LDcgKzE0Niw3IEBACiBzdGF0aWMgdm9pZCByZW1vdmVzcG9vbChtZXNzYWdlX2RhdGFf
dCAqbXNnZGF0YSk7CiAKIHN0cnVjdCBsbXRwX2Z1bmMgbXlsbXRwID0geyAmZGVsaXZlciwgJnZl
cmlmeV91c2VyLCAmc2h1dF9kb3duLAotCQkJICAgICZzcG9vbGZpbGUsICZyZW1vdmVzcG9vbCwg
MCwgMSwgMCB9OworCQkJICAgICZzcG9vbGZpbGUsICZyZW1vdmVzcG9vbCwgMCwgMCwgMSwgMCB9
OwogCiBzdGF0aWMgdm9pZCBsb2dkdXBlbGVtKCk7CiBzdGF0aWMgdm9pZCB1c2FnZSgpOwpAQCAt
MjA2LDggKzIwNiw3IEBACiAJc2lldmVfZGlyID0gTlVMTDsKICAgICB9CiAKLSAgICBteWxtdHAu
YWRkaGVhZGVycyA9IHhtYWxsb2MoODApOwotICAgIHNucHJpbnRmKG15bG10cC5hZGRoZWFkZXJz
LCA4MCwgIlgtU2lldmU6ICVzXHJcbiIsIFNJRVZFX1ZFUlNJT04pOworICAgIGFkZGhlYWRlcigm
bXlsbXRwLCAiWC1TaWV2ZSIsIFNJRVZFX1ZFUlNJT04pOwogCiAgICAgLyogc2V0dXAgc2lldmUg
c3VwcG9ydCAqLwogICAgIHNldHVwX3NpZXZlKCk7CmRpZmYgLXJ1IGN5cnVzLWltYXBkLTIuMS4x
NS5vcmlnL2ltYXAvbG10cGVuZ2luZS5jIGN5cnVzLWltYXBkLTIuMS4xNS9pbWFwL2xtdHBlbmdp
bmUuYwotLS0gY3lydXMtaW1hcGQtMi4xLjE1Lm9yaWcvaW1hcC9sbXRwZW5naW5lLmMJMjAwMy0w
Ny0yMiAxMjoxNzoxNS4wMDAwMDAwMDAgLTA3MDAKKysrIGN5cnVzLWltYXBkLTIuMS4xNS9pbWFw
L2xtdHBlbmdpbmUuYwkyMDAzLTA5LTI3IDE2OjA4OjUyLjM1ODUwODAwMCAtMDcwMApAQCAtOTMs
MTIgKzkzLDYgQEAKICNkZWZpbmUgUkNQVF9HUk9XIDMwCiAKIC8qIGRhdGEgcGVyIG1lc3NhZ2Ug
Ki8KLXN0cnVjdCBIZWFkZXIgewotICAgIGNoYXIgKm5hbWU7Ci0gICAgaW50IG5jb250ZW50czsK
LSAgICBjaGFyICpjb250ZW50c1sxXTsKLX07Ci0KIHN0cnVjdCBhZGRyZXNzX2RhdGEgewogICAg
IGNoYXIgKnVzZXI7CiAgICAgY2hhciAqYWxsOwpAQCAtODkyLDYgKzg4Niw1NCBAQAogICAgIHJl
dHVybiAwOwogfQogCisKK3N0YXRpYyBpbnQgaW5zZXJ0X2NhY2hlX2VsZW1lbnQgKG1lc3NhZ2Vf
ZGF0YV90ICptLCBjaGFyICpuYW1lLCBjaGFyICpib2R5KSB7CisgICAgICAgIGludCBjbCwgY2xp
bml0OworCWludCBubGVuID0gc3RybGVuKG5hbWUpICsgMTsKKworCXdoaWxlIChubGVuLS0pIHsK
KwkgICAgbmFtZVtubGVuXSA9IHRvbG93ZXIobmFtZVtubGVuXSk7CisJfQorCisgICAgICAgIC8q
IHB1dCBpdCBpbiB0aGUgaGFzaCB0YWJsZSAqLworICAgICAgICBjbGluaXQgPSBjbCA9IGhhc2ho
ZWFkZXIobmFtZSk7CisgICAgICAgIHdoaWxlIChtLT5jYWNoZVtjbF0gIT0gTlVMTCAmJiBzdHJj
bXAobmFtZSwgbS0+Y2FjaGVbY2xdLT5uYW1lKSkgeworICAgICAgICAgICAgY2wrKzsgICAgICAg
ICAgICAgICAvKiByZXNvbHZlIGNvbGxpc2lvbnMgbGluZWFybHkgKi8KKyAgICAgICAgICAgIGNs
ICU9IEhFQURFUkNBQ0hFU0laRTsKKyAgICAgICAgICAgIGlmIChjbCA9PSBjbGluaXQpIGJyZWFr
OyAvKiBnb25lIGFsbCB0aGUgd2F5IGFyb3VuZCwgc28gYmFpbCAqLworICAgICAgICB9CisKKyAg
ICAgICAgLyogZm91bmQgd2hlcmUgdG8gcHV0IGl0LCBzbyBpbnNlcnQgaXQgaW50byBhIGxpc3Qg
Ki8KKyAgICAgICAgaWYgKG0tPmNhY2hlW2NsXSkgeworICAgICAgICAgICAgLyogYWRkIHRoaXMg
Ym9keSBvbiAqLworICAgICAgICAgICAgbS0+Y2FjaGVbY2xdLT5jb250ZW50c1ttLT5jYWNoZVtj
bF0tPm5jb250ZW50cysrXSA9IGJvZHk7CisKKyAgICAgICAgICAgIC8qIHdob29wcywgd29uJ3Qg
aGF2ZSByb29tIGZvciB0aGUgbnVsbCBhdCB0aGUgZW5kISAqLworICAgICAgICAgICAgaWYgKCEo
bS0+Y2FjaGVbY2xdLT5uY29udGVudHMgJSA4KSkgeworICAgICAgICAgICAgICAgIC8qIGluY3Jl
YXNlIHRoZSBzaXplICovCisgICAgICAgICAgICAgICAgbS0+Y2FjaGVbY2xdID0gKGhlYWRlcl90
ICopCisgICAgICAgICAgICAgICAgICAgIHhyZWFsbG9jKG0tPmNhY2hlW2NsXSxzaXplb2YoaGVh
ZGVyX3QpICsKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKCg4ICsgbS0+Y2FjaGVbY2xd
LT5uY29udGVudHMpICogc2l6ZW9mKGNoYXIgKikpKTsKKyAgICAgICAgICAgIH0KKyAgICAgICAg
ICAgIC8qIGhhdmUgbm8gbmVlZCBvZiB0aGlzICovCisgICAgICAgICAgICBmcmVlKG5hbWUpOwor
CSAgICBuYW1lID0gMDsKKyAgICAgICAgfSBlbHNlIHsKKyAgICAgICAgICAgIC8qIGNyZWF0ZSBh
IG5ldyBlbnRyeSBpbiB0aGUgaGFzaCB0YWJsZSAqLworICAgICAgICAgICAgbS0+Y2FjaGVbY2xd
ID0gKGhlYWRlcl90ICopIHhtYWxsb2Moc2l6ZW9mKGhlYWRlcl90KSArCisgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA4ICogc2l6ZW9mKGNoYXIqKSk7Cisg
ICAgICAgICAgICBtLT5jYWNoZVtjbF0tPm5hbWUgPSBuYW1lOworICAgICAgICAgICAgbS0+Y2Fj
aGVbY2xdLT5jb250ZW50c1swXSA9IGJvZHk7CisgICAgICAgICAgICBtLT5jYWNoZVtjbF0tPm5j
b250ZW50cyA9IDE7CisgICAgICAgIH0KKworICAgICAgICAvKiB3ZSBhbHdheXMgd2FudCBhIE5V
TEwgYXQgdGhlIGVuZCAqLworICAgICAgICBtLT5jYWNoZVtjbF0tPmNvbnRlbnRzW20tPmNhY2hl
W2NsXS0+bmNvbnRlbnRzXSA9IE5VTEw7CisKKyAgICAgICAgcmV0dXJuIDA7Cit9CisKKwogc3Rh
dGljIGludCBmaWxsX2NhY2hlKHN0cnVjdCBwcm90c3RyZWFtICpmaW4sIEZJTEUgKmZvdXQsIG1l
c3NhZ2VfZGF0YV90ICptKQogewogICAgIGludCByID0gMDsKQEAgLTg5OSw3ICs5NDEsNiBAQAog
ICAgIC8qIGxldCdzIGZpbGwgdGhhdCBoZWFkZXIgY2FjaGUgKi8KICAgICBmb3IgKDs7KSB7CiAJ
Y2hhciAqbmFtZSwgKmJvZHk7Ci0JaW50IGNsLCBjbGluaXQ7CiAKIAlpZiAoKHIgPSBwYXJzZWhl
YWRlcihmaW4sIGZvdXQsICZuYW1lLCAmYm9keSkpIDwgMCkgewogCSAgICBicmVhazsKQEAgLTkw
OSw0MCArOTUwLDcgQEAKIAkgICAgYnJlYWs7CiAJfQogCi0JLyogcHV0IGl0IGluIHRoZSBoYXNo
IHRhYmxlICovCi0JY2xpbml0ID0gY2wgPSBoYXNoaGVhZGVyKG5hbWUpOwotCXdoaWxlIChtLT5j
YWNoZVtjbF0gIT0gTlVMTCAmJiBzdHJjbXAobmFtZSwgbS0+Y2FjaGVbY2xdLT5uYW1lKSkgewot
CSAgICBjbCsrOwkJLyogcmVzb2x2ZSBjb2xsaXNpb25zIGxpbmVhcmx5ICovCi0JICAgIGNsICU9
IEhFQURFUkNBQ0hFU0laRTsKLQkgICAgaWYgKGNsID09IGNsaW5pdCkgYnJlYWs7IC8qIGdvbmUg
YWxsIHRoZSB3YXkgYXJvdW5kLCBzbyBiYWlsICovCi0JfQotCi0JLyogZm91bmQgd2hlcmUgdG8g
cHV0IGl0LCBzbyBpbnNlcnQgaXQgaW50byBhIGxpc3QgKi8KLQlpZiAobS0+Y2FjaGVbY2xdKSB7
Ci0JICAgIC8qIGFkZCB0aGlzIGJvZHkgb24gKi8KLQkgICAgbS0+Y2FjaGVbY2xdLT5jb250ZW50
c1ttLT5jYWNoZVtjbF0tPm5jb250ZW50cysrXSA9IGJvZHk7Ci0KLQkgICAgLyogd2hvb3BzLCB3
b24ndCBoYXZlIHJvb20gZm9yIHRoZSBudWxsIGF0IHRoZSBlbmQhICovCi0JICAgIGlmICghKG0t
PmNhY2hlW2NsXS0+bmNvbnRlbnRzICUgOCkpIHsKLQkJLyogaW5jcmVhc2UgdGhlIHNpemUgKi8K
LQkJbS0+Y2FjaGVbY2xdID0gKGhlYWRlcl90ICopCi0JCSAgICB4cmVhbGxvYyhtLT5jYWNoZVtj
bF0sc2l6ZW9mKGhlYWRlcl90KSArCi0JCQkgICAgICgoOCArIG0tPmNhY2hlW2NsXS0+bmNvbnRl
bnRzKSAqIHNpemVvZihjaGFyICopKSk7Ci0JICAgIH0KLQotCSAgICAvKiBoYXZlIG5vIG5lZWQg
b2YgdGhpcyAqLwotCSAgICBmcmVlKG5hbWUpOwotCX0gZWxzZSB7Ci0JICAgIC8qIGNyZWF0ZSBh
IG5ldyBlbnRyeSBpbiB0aGUgaGFzaCB0YWJsZSAqLwotCSAgICBtLT5jYWNoZVtjbF0gPSAoaGVh
ZGVyX3QgKikgeG1hbGxvYyhzaXplb2YoaGVhZGVyX3QpICsgCi0JCQkJCQk4ICogc2l6ZW9mKGNo
YXIqKSk7Ci0JICAgIG0tPmNhY2hlW2NsXS0+bmFtZSA9IG5hbWU7Ci0JICAgIG0tPmNhY2hlW2Ns
XS0+Y29udGVudHNbMF0gPSBib2R5OwotCSAgICBtLT5jYWNoZVtjbF0tPm5jb250ZW50cyA9IDE7
Ci0JfQotCi0JLyogd2UgYWx3YXlzIHdhbnQgYSBOVUxMIGF0IHRoZSBlbmQgKi8KLQltLT5jYWNo
ZVtjbF0tPmNvbnRlbnRzW20tPmNhY2hlW2NsXS0+bmNvbnRlbnRzXSA9IE5VTEw7CisJaW5zZXJ0
X2NhY2hlX2VsZW1lbnQobSwgbmFtZSwgYm9keSk7CiAgICAgfQogCiAgICAgaWYgKHIpIHsKQEAg
LTk3NCw2ICs5ODIsOCBAQAogICAgIGludCBucmNwdHMgPSBtLT5yY3B0X251bTsKICAgICB0aW1l
X3QgdDsKICAgICBjaGFyIGRhdGVzdHJbODBdOworICAgIGNoYXIgKm5hbWUgPSBOVUxMLCAqdmFs
ID0gTlVMTDsKKyAgICBpbnQgdmxlbiA9IDA7CiAKICAgICAvKiBDb3B5IHRvIHNwb29sIGZpbGUg
Ki8KICAgICBmID0gZnVuYy0+c3Bvb2xmaWxlKG0pOwpAQCAtMTAwMiwyMiArMTAxMiw0OSBAQAog
CSAgICBob3N0bmFtZSA9IGNvbmZpZ19zZXJ2ZXJuYW1lOwogCX0KIAotCWZwcmludGYoZiwgIlJl
dHVybi1QYXRoOiA8JXMlcyVzPlxyXG4iLAorCXZsZW4gPSBzdHJsZW4ocnBhdGgpICsgKGhvc3Ru
YW1lID8gMSArIHN0cmxlbihob3N0bmFtZSkgOiAwKSArIDI7CisJdmFsID0gKGNoYXIqKXhtYWxs
b2MoKHZsZW4gKyAxKSAqIHNpemVvZihjaGFyKikpOworCXNwcmludGYodmFsLCAiPCVzJXMlcz4i
LAogCQlycGF0aCwgaG9zdG5hbWUgPyAiQCIgOiAiIiwgaG9zdG5hbWUgPyBob3N0bmFtZSA6ICIi
KTsKKwl2YWxbdmxlbl0gPSAwOworCW5hbWUgPSB4c3RyZHVwKCJSZXR1cm4tUGF0aCIpOworCisJ
ZnByaW50ZihmLCAiJXM6ICVzXHJcbiIsIG5hbWUsIHZhbCk7CisJaW5zZXJ0X2NhY2hlX2VsZW1l
bnQobSwgeHN0cmR1cChuYW1lKSwgeHN0cmR1cCh2YWwpKTsKKworCWZyZWUobmFtZSk7CisJZnJl
ZSh2YWwpOworCW5hbWUgPSB2YWwgPSBOVUxMOworCXZsZW4gPSAwOwogICAgIH0KIAogICAgIC8q
IGFkZCBhIHJlY2VpdmVkIGhlYWRlciAqLwotICAgIHQgPSB0aW1lKE5VTEwpOwotICAgIHJmYzgy
MmRhdGVfZ2VuKGRhdGVzdHIsIHNpemVvZihkYXRlc3RyKSwgdCk7Ci0gICAgZnByaW50ZihmLCAi
UmVjZWl2ZWQ6IGZyb20gJXMgKCVzKSIsCi0JICAgIGNkLT5saGxvX3BhcmFtLCBjZC0+Y2xpZW50
aG9zdCk7CiAgICAgaWYgKG0tPmF1dGh1c2VyKSB7CiAJY29uc3QgaW50ICpzc2ZwOworCWludCBs
Yml0cyA9IDAsIGxzc2ZwOwogCXNhc2xfZ2V0cHJvcChjZC0+Y29ubiwgU0FTTF9TU0YsIChjb25z
dCB2b2lkICoqKSAmc3NmcCk7Ci0JZnByaW50ZihmLCAiIChhdXRoZW50aWNhdGVkIHVzZXI9JXMg
Yml0cz0lZCkiLCBtLT5hdXRodXNlciwgKnNzZnApOworCisJbHNzZnAgPSAqc3NmcDsKKwlkbyB7
CisJICAgIGxiaXRzKys7CisJfSB3aGlsZSAoKGludCkobHNzZnAvPTEwKSAhPSAwKTsKKworCXZs
ZW4gPSAyOCArIHN0cmxlbihtLT5hdXRodXNlcikgKyBsYml0czsKKyAgICAgICAgdmFsID0gKGNo
YXIqKXhtYWxsb2MoKHZsZW4gKyAxKSAqIHNpemVvZihjaGFyKikpOworCXNwcmludGYodmFsLCAi
IChhdXRoZW50aWNhdGVkIHVzZXI9JXMgYml0cz0lZCkiLCBtLT5hdXRodXNlciwgKnNzZnApOwor
ICAgIH0KKworICAgIHZsZW4gKz0gc3RybGVuKGNkLT5saGxvX3BhcmFtKSArIHN0cmxlbihjZC0+
Y2xpZW50aG9zdCkgKworCSAgICBzdHJsZW4oY29uZmlnX3NlcnZlcm5hbWUpICsgc3RybGVuKENZ
UlVTX1ZFUlNJT04pICsgMzM7CisgICAgaWYgKHZhbCA9PSBOVUxMKSB7CisJdmFsID0gKGNoYXIq
KXhtYWxsb2MoKHZsZW4gKyAxKSAqIHNpemVvZihjaGFyKikpOworCXZhbFswXSA9ICdcMCc7Cisg
ICAgfSBlbHNlIHsKKwl2YWwgPSAoY2hhciopeHJlYWxsb2ModmFsLCAodmxlbiArIDEpICogc2l6
ZW9mKGNoYXIqKSk7CiAgICAgfQotICAgIGZwcmludGYoZiwgIlxyXG5cdGJ5ICVzIChDeXJ1cyAl
cykgd2l0aCBMTVRQIiwKLQkJY29uZmlnX3NlcnZlcm5hbWUsIENZUlVTX1ZFUlNJT04pOworICAg
IHNwcmludGYodmFsLCAiZnJvbSAlcyAoJXMpJXNcclxuXHRieSAlcyAoQ3lydXMgJXMpIHdpdGgg
TE1UUCIsCisJICAgIGNkLT5saGxvX3BhcmFtLCBjZC0+Y2xpZW50aG9zdCwgKHZhbFswXSA9PSAn
XDAnID8gIiIgOiB2YWwpLAorCSAgICBjb25maWdfc2VydmVybmFtZSwgQ1lSVVNfVkVSU0lPTik7
CiAKICNpZmRlZiBIQVZFX1NTTAogICAgIGlmIChjZC0+dGxzX2Nvbm4pIHsKQEAgLTEwMjYsMTUg
KzEwNjMsNDYgQEAKIAl0bHNfaW5mb1swXSA9ICdcMCc7CiAJLyogZ3JhYiBUTFMgaW5mbyBmb3Ig
UmVjZWl2ZWQ6IGhlYWRlciAqLwogCXRsc19nZXRfaW5mbyhjZC0+dGxzX2Nvbm4sIHRsc19pbmZv
LCBzaXplb2YodGxzX2luZm8pKTsKLQlpZiAoKnRsc19pbmZvKSBmcHJpbnRmKGYsICIgKCVzKSIs
IHRsc19pbmZvKTsKKwlpZiAoKnRsc19pbmZvKSB7CisJICAgIHZsZW4gKz0gc3RybGVuKHRsc19p
bmZvKSArIDM7CisJICAgIHZhbCA9IChjaGFyKil4cmVhbGxvYyh2YWwsICh2bGVuICsgMSkgKiBz
aXplb2YoY2hhciopKTsKKwkgICAgc3ByaW50Zih2YWwsICIlcyAoJXMpIiwgdmFsLCB0bHNfaW5m
byk7CisJfQogICAgIH0KICNlbmRpZiAvKiBIQVZFX1NTTCAqLwogCi0gICAgZnByaW50ZihmLCAi
OyAlc1xyXG4iLCBkYXRlc3RyKTsKKyAgICB0ID0gdGltZShOVUxMKTsKKyAgICByZmM4MjJkYXRl
X2dlbihkYXRlc3RyLCBzaXplb2YoZGF0ZXN0ciksIHQpOworCisgICAgdmxlbiArPSBzdHJsZW4o
ZGF0ZXN0cikgKyAyOworICAgIHZhbCA9IChjaGFyKil4cmVhbGxvYyh2YWwsICh2bGVuICsgMSkg
KiBzaXplb2YoY2hhciopKTsKKyAgICBzcHJpbnRmKHZhbCwgIiVzOyAlcyIsIHZhbCwgZGF0ZXN0
cik7CisKKyAgICB2YWxbdmxlbl0gPSAwOworICAgIG5hbWUgPSB4c3RyZHVwKCJSZWNlaXZlZCIp
OworCisgICAgZnByaW50ZihmLCAiJXM6ICVzXHJcbiIsIG5hbWUsIHZhbCk7CisgICAgaW5zZXJ0
X2NhY2hlX2VsZW1lbnQobSwgeHN0cmR1cChuYW1lKSwgeHN0cmR1cCh2YWwpKTsKKworICAgIGZy
ZWUobmFtZSk7CisgICAgZnJlZSh2YWwpOworICAgIG5hbWUgPSB2YWwgPSAwOwogCiAgICAgLyog
YWRkIGFueSByZXF1ZXN0ZWQgaGVhZGVycyAqLwotICAgIGlmIChmdW5jLT5hZGRoZWFkZXJzKSB7
Ci0JZnB1dHMoZnVuYy0+YWRkaGVhZGVycywgZik7CisgICAgLyogbmVlZCB0byBwYXJzZSB0byBh
ZGQgdG8gdGhlIGhlYWRlciBjYWNoZSAqLworICAgIGlmIChmdW5jLT5uaGVhZGVycyA+IDApIHsK
KwlpbnQgaSA9IDA7CisJZG8geworCSAgICBmcHJpbnRmKGYsICIlczogJXNcclxuIiwgZnVuYy0+
YWRkaGVhZGVyc1tpXS5uYW1lLAorCQkgICAgIGZ1bmMtPmFkZGhlYWRlcnNbaV0uY29udGVudHNb
MF0pOworCisJICAgIC8qIGNvcHkgdGhlIGRhdGEgYmVpbmcgcGFzc2VkIGluOyBhZGRoZWFkZXJz
W10gd2lsbCBiZQorCSAgICAgICBmcmVlZCB3aGVuIGxtdHBkIGV4aXRzLCBkb24ndCB3YW50IG5h
bWUgZnJlZWQKKwkgICAgICAgYmVmb3JlIHRoZW4gKi8KKwkgICAgaW5zZXJ0X2NhY2hlX2VsZW1l
bnQobSwgeHN0cmR1cChmdW5jLT5hZGRoZWFkZXJzW2ldLm5hbWUpLAorCQkgICAgIHhzdHJkdXAo
ZnVuYy0+YWRkaGVhZGVyc1tpXS5jb250ZW50c1swXSkpOworCSAgICBpKys7CisJfSB3aGlsZSAo
aSAhPSBmdW5jLT5uaGVhZGVycyk7CiAgICAgfQogCiAgICAgLyogZmlsbCB0aGUgY2FjaGUgKi8K
QEAgLTI2MjYsMyArMjY5NCwxNCBAQAogCiAgICAgcmV0dXJuIFNBU0xfT0s7CiB9CisKKworaW50
IGFkZGhlYWRlcihzdHJ1Y3QgbG10cF9mdW5jICpmdW5jLCBjaGFyICpuYW1lLCBjaGFyICpib2R5
KQoreworICAgIGZ1bmMtPm5oZWFkZXJzKys7CisgICAgZnVuYy0+YWRkaGVhZGVycyA9IChoZWFk
ZXJfdCAqKXhyZWFsbG9jKGZ1bmMtPmFkZGhlYWRlcnMsIGZ1bmMtPm5oZWFkZXJzICogc2l6ZW9m
KGhlYWRlcl90KSk7CisgICAgZnVuYy0+YWRkaGVhZGVyc1tmdW5jLT5uaGVhZGVycyAtIDFdLm5h
bWUgPSB4c3RyZHVwKG5hbWUpOworICAgIGZ1bmMtPmFkZGhlYWRlcnNbZnVuYy0+bmhlYWRlcnMg
LSAxXS5jb250ZW50c1swXSA9IHhzdHJkdXAoYm9keSk7CisgICAgZnVuYy0+YWRkaGVhZGVyc1tm
dW5jLT5uaGVhZGVycyAtIDFdLm5jb250ZW50cyA9IDE7CisgICAgcmV0dXJuIDA7Cit9CmRpZmYg
LXJ1IGN5cnVzLWltYXBkLTIuMS4xNS5vcmlnL2ltYXAvbG10cGVuZ2luZS5oIGN5cnVzLWltYXBk
LTIuMS4xNS9pbWFwL2xtdHBlbmdpbmUuaAotLS0gY3lydXMtaW1hcGQtMi4xLjE1Lm9yaWcvaW1h
cC9sbXRwZW5naW5lLmgJMjAwMy0wOC0xMiAwODoyMjo1Ny4wMDAwMDAwMDAgLTA3MDAKKysrIGN5
cnVzLWltYXBkLTIuMS4xNS9pbWFwL2xtdHBlbmdpbmUuaAkyMDAzLTA5LTI3IDE2OjAzOjAzLjE2
NTk3NzAwMCAtMDcwMApAQCAtNTEsNiArNTEsMTIgQEAKIHR5cGVkZWYgc3RydWN0IEhlYWRlciBo
ZWFkZXJfdDsKIHR5cGVkZWYgc3RydWN0IGFkZHJlc3NfZGF0YSBhZGRyZXNzX2RhdGFfdDsKIAor
c3RydWN0IEhlYWRlciB7CisgICAgY2hhciAqbmFtZTsKKyAgICBpbnQgbmNvbnRlbnRzOworICAg
IGNoYXIgKmNvbnRlbnRzWzFdOworfTsKKwogc3RydWN0IG1lc3NhZ2VfZGF0YSB7CiAgICAgc3Ry
dWN0IHByb3RzdHJlYW0gKmRhdGE7CS8qIG1lc3NhZ2UgaW4gdGVtcCBmaWxlICovCiAgICAgRklM
RSAqZjsJCQkvKiBGSUxFICogY29ycmVzcG9uZGluZyAqLwpAQCAtMTA3LDExICsxMTMsMTcgQEAK
ICAgICB2b2lkICgqc2h1dGRvd24pKGludCBjb2RlKTsKICAgICBGSUxFICooKnNwb29sZmlsZSko
bWVzc2FnZV9kYXRhX3QgKm0pOwogICAgIHZvaWQgKCpyZW1vdmVzcG9vbCkobWVzc2FnZV9kYXRh
X3QgKm0pOwotICAgIGNoYXIgKmFkZGhlYWRlcnM7CQkvKiBhZGQgdGhlc2UgaGVhZGVycyB0byBh
bGwgbWVzc2FnZXMgKi8KKyAgICBoZWFkZXJfdCAqYWRkaGVhZGVyczsJLyogYWRkIHRoZXNlIGhl
YWRlcnMgdG8gYWxsIG1lc3NhZ2VzICovCisgICAgaW50IG5oZWFkZXJzOwkJLyogY291bnQgb2Yg
YWxsIGhlYWRlcnMgdG8gYWRkICovCiAgICAgaW50IGFkZHJldHBhdGg7CQkvKiBzaG91bGQgaSBh
ZGQgYSByZXR1cm4tcGF0aCBoZWFkZXI/ICovCiAgICAgaW50IHByZWF1dGg7CQkvKiBwcmVhdXRo
IGNvbm5lY3Rpb24/ICovCiB9OwogCisKKy8qIGFkZCBhcmJpdHJhcnkgaGVhZGVycyB0byB0aGUg
bG10cF9mdW5jIHN0cnVjdCAqLworaW50IGFkZGhlYWRlcihzdHJ1Y3QgbG10cF9mdW5jICpmdW5j
LCBjaGFyICpuYW1lLCBjaGFyICpib2R5KTsKKworCiAvKiBydW4gTE1UUCBvbiAncGluJyBhbmQg
J3BvdXQnLCBkb2luZyBjYWxsYmFja3MgdG8gJ2Z1bmMnIHdoZXJlIGFwcHJvcHJpYXRlCiAgKiAK
ICAqIHdpbGwgY2FsbCBzaWduYWxzX3BvbGwoKSBvbiBvY2Nhc2lvbi4KZGlmZiAtcnUgY3lydXMt
aW1hcGQtMi4xLjE1Lm9yaWcvaW1hcC9sbXRwcHJveHlkLmMgY3lydXMtaW1hcGQtMi4xLjE1L2lt
YXAvbG10cHByb3h5ZC5jCi0tLSBjeXJ1cy1pbWFwZC0yLjEuMTUub3JpZy9pbWFwL2xtdHBwcm94
eWQuYwkyMDAzLTA1LTI4IDE5OjE0OjMyLjAwMDAwMDAwMCAtMDcwMAorKysgY3lydXMtaW1hcGQt
Mi4xLjE1L2ltYXAvbG10cHByb3h5ZC5jCTIwMDMtMDktMjcgMTU6NTk6MjguMjYyNTcxMDAwIC0w
NzAwCkBAIC0xNDQsNyArMTQ0LDcgQEAKIHN0YXRpYyB2b2lkIHVzYWdlKCk7CiAKIHN0cnVjdCBs
bXRwX2Z1bmMgbXlsbXRwID0geyAmZGVsaXZlciwgJnZlcmlmeV91c2VyLCAmc2h1dF9kb3duLAot
CQkJICAgICZwcm94eV9zcG9vbGZpbGUsIE5VTEwsIDAsIDAsIDAgfTsKKwkJCSAgICAmcHJveHlf
c3Bvb2xmaWxlLCBOVUxMLCAwLCAwLCAwLCAwIH07CiAKIC8qIGdsb2JhbHMgKi8KIHN0YXRpYyBp
bnQgcXVvdGFvdmVycmlkZSA9IDA7CQkvKiBzaG91bGQgaSBvdmVycmlkZSBxdW90YT8gKi8K
</data>        

          </attachment>
          <attachment
              isobsolete="0"
              ispatch="1"
              isprivate="0"
          >
            <attachid>237</attachid>
            <date>2003-11-23 08:07 EDT</date>
            <desc>patch updated for 2.1.16</desc>
            <filename>cyrus-imapd-2.1.16.patch</filename>
            <type>text/plain</type>
            <size>10204</size>
            <attacher>cbs@cts.ucla.edu</attacher>
            
              <data encoding="base64">ZGlmZiAtcnVOIGN5cnVzLWltYXBkLTIuMS4xNi5vcmlnL2ltYXAvbG10cGQuYyBjeXJ1cy1pbWFw
ZC0yLjEuMTYvaW1hcC9sbXRwZC5jCi0tLSBjeXJ1cy1pbWFwZC0yLjEuMTYub3JpZy9pbWFwL2xt
dHBkLmMJMjAwMy0xMS0yMyAwNDo1NjoyOC4wMDAwMDAwMDAgLTA4MDAKKysrIGN5cnVzLWltYXBk
LTIuMS4xNi9pbWFwL2xtdHBkLmMJMjAwMy0xMS0yMyAwNDo1ODo0My41NTgxODYwMDAgLTA4MDAK
QEAgLTE0Niw3ICsxNDYsNyBAQAogc3RhdGljIHZvaWQgcmVtb3Zlc3Bvb2wobWVzc2FnZV9kYXRh
X3QgKm1zZ2RhdGEpOwogCiBzdHJ1Y3QgbG10cF9mdW5jIG15bG10cCA9IHsgJmRlbGl2ZXIsICZ2
ZXJpZnlfdXNlciwgJnNodXRfZG93biwKLQkJCSAgICAmc3Bvb2xmaWxlLCAmcmVtb3Zlc3Bvb2ws
IDAsIDEsIDAgfTsKKwkJCSAgICAmc3Bvb2xmaWxlLCAmcmVtb3Zlc3Bvb2wsIDAsIDAsIDEsIDAg
fTsKIAogc3RhdGljIHZvaWQgbG9nZHVwZWxlbSgpOwogc3RhdGljIHZvaWQgdXNhZ2UoKTsKQEAg
LTIwNiw4ICsyMDYsNyBAQAogCXNpZXZlX2RpciA9IE5VTEw7CiAgICAgfQogCi0gICAgbXlsbXRw
LmFkZGhlYWRlcnMgPSB4bWFsbG9jKDgwKTsKLSAgICBzbnByaW50ZihteWxtdHAuYWRkaGVhZGVy
cywgODAsICJYLVNpZXZlOiAlc1xyXG4iLCBTSUVWRV9WRVJTSU9OKTsKKyAgICBhZGRoZWFkZXIo
Jm15bG10cCwgIlgtU2lldmUiLCBTSUVWRV9WRVJTSU9OKTsKIAogICAgIC8qIHNldHVwIHNpZXZl
IHN1cHBvcnQgKi8KICAgICBzZXR1cF9zaWV2ZSgpOwpkaWZmIC1ydU4gY3lydXMtaW1hcGQtMi4x
LjE2Lm9yaWcvaW1hcC9sbXRwZW5naW5lLmMgY3lydXMtaW1hcGQtMi4xLjE2L2ltYXAvbG10cGVu
Z2luZS5jCi0tLSBjeXJ1cy1pbWFwZC0yLjEuMTYub3JpZy9pbWFwL2xtdHBlbmdpbmUuYwkyMDAz
LTExLTIzIDA0OjU2OjI4LjAwMDAwMDAwMCAtMDgwMAorKysgY3lydXMtaW1hcGQtMi4xLjE2L2lt
YXAvbG10cGVuZ2luZS5jCTIwMDMtMTEtMjMgMDQ6NTg6NDMuNTYzNzMyMDAwIC0wODAwCkBAIC05
MywxMiArOTMsNiBAQAogI2RlZmluZSBSQ1BUX0dST1cgMzAKIAogLyogZGF0YSBwZXIgbWVzc2Fn
ZSAqLwotc3RydWN0IEhlYWRlciB7Ci0gICAgY2hhciAqbmFtZTsKLSAgICBpbnQgbmNvbnRlbnRz
OwotICAgIGNoYXIgKmNvbnRlbnRzWzFdOwotfTsKLQogc3RydWN0IGFkZHJlc3NfZGF0YSB7CiAg
ICAgY2hhciAqdXNlcjsKICAgICBjaGFyICphbGw7CkBAIC04OTIsNiArODg2LDU0IEBACiAgICAg
cmV0dXJuIDA7CiB9CiAKKworc3RhdGljIGludCBpbnNlcnRfY2FjaGVfZWxlbWVudCAobWVzc2Fn
ZV9kYXRhX3QgKm0sIGNoYXIgKm5hbWUsIGNoYXIgKmJvZHkpIHsKKyAgICAgICAgaW50IGNsLCBj
bGluaXQ7CisJaW50IG5sZW4gPSBzdHJsZW4obmFtZSkgKyAxOworCisJd2hpbGUgKG5sZW4tLSkg
eworCSAgICBuYW1lW25sZW5dID0gdG9sb3dlcihuYW1lW25sZW5dKTsKKwl9CisKKyAgICAgICAg
LyogcHV0IGl0IGluIHRoZSBoYXNoIHRhYmxlICovCisgICAgICAgIGNsaW5pdCA9IGNsID0gaGFz
aGhlYWRlcihuYW1lKTsKKyAgICAgICAgd2hpbGUgKG0tPmNhY2hlW2NsXSAhPSBOVUxMICYmIHN0
cmNtcChuYW1lLCBtLT5jYWNoZVtjbF0tPm5hbWUpKSB7CisgICAgICAgICAgICBjbCsrOyAgICAg
ICAgICAgICAgIC8qIHJlc29sdmUgY29sbGlzaW9ucyBsaW5lYXJseSAqLworICAgICAgICAgICAg
Y2wgJT0gSEVBREVSQ0FDSEVTSVpFOworICAgICAgICAgICAgaWYgKGNsID09IGNsaW5pdCkgYnJl
YWs7IC8qIGdvbmUgYWxsIHRoZSB3YXkgYXJvdW5kLCBzbyBiYWlsICovCisgICAgICAgIH0KKwor
ICAgICAgICAvKiBmb3VuZCB3aGVyZSB0byBwdXQgaXQsIHNvIGluc2VydCBpdCBpbnRvIGEgbGlz
dCAqLworICAgICAgICBpZiAobS0+Y2FjaGVbY2xdKSB7CisgICAgICAgICAgICAvKiBhZGQgdGhp
cyBib2R5IG9uICovCisgICAgICAgICAgICBtLT5jYWNoZVtjbF0tPmNvbnRlbnRzW20tPmNhY2hl
W2NsXS0+bmNvbnRlbnRzKytdID0gYm9keTsKKworICAgICAgICAgICAgLyogd2hvb3BzLCB3b24n
dCBoYXZlIHJvb20gZm9yIHRoZSBudWxsIGF0IHRoZSBlbmQhICovCisgICAgICAgICAgICBpZiAo
IShtLT5jYWNoZVtjbF0tPm5jb250ZW50cyAlIDgpKSB7CisgICAgICAgICAgICAgICAgLyogaW5j
cmVhc2UgdGhlIHNpemUgKi8KKyAgICAgICAgICAgICAgICBtLT5jYWNoZVtjbF0gPSAoaGVhZGVy
X3QgKikKKyAgICAgICAgICAgICAgICAgICAgeHJlYWxsb2MobS0+Y2FjaGVbY2xdLHNpemVvZiho
ZWFkZXJfdCkgKworICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoKDggKyBtLT5jYWNoZVtj
bF0tPm5jb250ZW50cykgKiBzaXplb2YoY2hhciAqKSkpOworICAgICAgICAgICAgfQorICAgICAg
ICAgICAgLyogaGF2ZSBubyBuZWVkIG9mIHRoaXMgKi8KKyAgICAgICAgICAgIGZyZWUobmFtZSk7
CisJICAgIG5hbWUgPSAwOworICAgICAgICB9IGVsc2UgeworICAgICAgICAgICAgLyogY3JlYXRl
IGEgbmV3IGVudHJ5IGluIHRoZSBoYXNoIHRhYmxlICovCisgICAgICAgICAgICBtLT5jYWNoZVtj
bF0gPSAoaGVhZGVyX3QgKikgeG1hbGxvYyhzaXplb2YoaGVhZGVyX3QpICsKKyAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDggKiBzaXplb2YoY2hhciopKTsK
KyAgICAgICAgICAgIG0tPmNhY2hlW2NsXS0+bmFtZSA9IG5hbWU7CisgICAgICAgICAgICBtLT5j
YWNoZVtjbF0tPmNvbnRlbnRzWzBdID0gYm9keTsKKyAgICAgICAgICAgIG0tPmNhY2hlW2NsXS0+
bmNvbnRlbnRzID0gMTsKKyAgICAgICAgfQorCisgICAgICAgIC8qIHdlIGFsd2F5cyB3YW50IGEg
TlVMTCBhdCB0aGUgZW5kICovCisgICAgICAgIG0tPmNhY2hlW2NsXS0+Y29udGVudHNbbS0+Y2Fj
aGVbY2xdLT5uY29udGVudHNdID0gTlVMTDsKKworICAgICAgICByZXR1cm4gMDsKK30KKworCiBz
dGF0aWMgaW50IGZpbGxfY2FjaGUoc3RydWN0IHByb3RzdHJlYW0gKmZpbiwgRklMRSAqZm91dCwg
bWVzc2FnZV9kYXRhX3QgKm0pCiB7CiAgICAgaW50IHIgPSAwOwpAQCAtODk5LDcgKzk0MSw2IEBA
CiAgICAgLyogbGV0J3MgZmlsbCB0aGF0IGhlYWRlciBjYWNoZSAqLwogICAgIGZvciAoOzspIHsK
IAljaGFyICpuYW1lLCAqYm9keTsKLQlpbnQgY2wsIGNsaW5pdDsKIAogCWlmICgociA9IHBhcnNl
aGVhZGVyKGZpbiwgZm91dCwgJm5hbWUsICZib2R5KSkgPCAwKSB7CiAJICAgIGJyZWFrOwpAQCAt
OTA5LDQwICs5NTAsNyBAQAogCSAgICBicmVhazsKIAl9CiAKLQkvKiBwdXQgaXQgaW4gdGhlIGhh
c2ggdGFibGUgKi8KLQljbGluaXQgPSBjbCA9IGhhc2hoZWFkZXIobmFtZSk7Ci0Jd2hpbGUgKG0t
PmNhY2hlW2NsXSAhPSBOVUxMICYmIHN0cmNtcChuYW1lLCBtLT5jYWNoZVtjbF0tPm5hbWUpKSB7
Ci0JICAgIGNsKys7CQkvKiByZXNvbHZlIGNvbGxpc2lvbnMgbGluZWFybHkgKi8KLQkgICAgY2wg
JT0gSEVBREVSQ0FDSEVTSVpFOwotCSAgICBpZiAoY2wgPT0gY2xpbml0KSBicmVhazsgLyogZ29u
ZSBhbGwgdGhlIHdheSBhcm91bmQsIHNvIGJhaWwgKi8KLQl9Ci0KLQkvKiBmb3VuZCB3aGVyZSB0
byBwdXQgaXQsIHNvIGluc2VydCBpdCBpbnRvIGEgbGlzdCAqLwotCWlmIChtLT5jYWNoZVtjbF0p
IHsKLQkgICAgLyogYWRkIHRoaXMgYm9keSBvbiAqLwotCSAgICBtLT5jYWNoZVtjbF0tPmNvbnRl
bnRzW20tPmNhY2hlW2NsXS0+bmNvbnRlbnRzKytdID0gYm9keTsKLQotCSAgICAvKiB3aG9vcHMs
IHdvbid0IGhhdmUgcm9vbSBmb3IgdGhlIG51bGwgYXQgdGhlIGVuZCEgKi8KLQkgICAgaWYgKCEo
bS0+Y2FjaGVbY2xdLT5uY29udGVudHMgJSA4KSkgewotCQkvKiBpbmNyZWFzZSB0aGUgc2l6ZSAq
LwotCQltLT5jYWNoZVtjbF0gPSAoaGVhZGVyX3QgKikKLQkJICAgIHhyZWFsbG9jKG0tPmNhY2hl
W2NsXSxzaXplb2YoaGVhZGVyX3QpICsKLQkJCSAgICAgKCg4ICsgbS0+Y2FjaGVbY2xdLT5uY29u
dGVudHMpICogc2l6ZW9mKGNoYXIgKikpKTsKLQkgICAgfQotCi0JICAgIC8qIGhhdmUgbm8gbmVl
ZCBvZiB0aGlzICovCi0JICAgIGZyZWUobmFtZSk7Ci0JfSBlbHNlIHsKLQkgICAgLyogY3JlYXRl
IGEgbmV3IGVudHJ5IGluIHRoZSBoYXNoIHRhYmxlICovCi0JICAgIG0tPmNhY2hlW2NsXSA9ICho
ZWFkZXJfdCAqKSB4bWFsbG9jKHNpemVvZihoZWFkZXJfdCkgKyAKLQkJCQkJCTggKiBzaXplb2Yo
Y2hhciopKTsKLQkgICAgbS0+Y2FjaGVbY2xdLT5uYW1lID0gbmFtZTsKLQkgICAgbS0+Y2FjaGVb
Y2xdLT5jb250ZW50c1swXSA9IGJvZHk7Ci0JICAgIG0tPmNhY2hlW2NsXS0+bmNvbnRlbnRzID0g
MTsKLQl9Ci0KLQkvKiB3ZSBhbHdheXMgd2FudCBhIE5VTEwgYXQgdGhlIGVuZCAqLwotCW0tPmNh
Y2hlW2NsXS0+Y29udGVudHNbbS0+Y2FjaGVbY2xdLT5uY29udGVudHNdID0gTlVMTDsKKwlpbnNl
cnRfY2FjaGVfZWxlbWVudChtLCBuYW1lLCBib2R5KTsKICAgICB9CiAKICAgICBpZiAocikgewpA
QCAtOTc0LDYgKzk4Miw4IEBACiAgICAgaW50IG5yY3B0cyA9IG0tPnJjcHRfbnVtOwogICAgIHRp
bWVfdCB0OwogICAgIGNoYXIgZGF0ZXN0cls4MF07CisgICAgY2hhciAqbmFtZSA9IE5VTEwsICp2
YWwgPSBOVUxMOworICAgIGludCB2bGVuID0gMDsKIAogICAgIC8qIENvcHkgdG8gc3Bvb2wgZmls
ZSAqLwogICAgIGYgPSBmdW5jLT5zcG9vbGZpbGUobSk7CkBAIC0xMDAyLDIyICsxMDEyLDQ5IEBA
CiAJICAgIGhvc3RuYW1lID0gY29uZmlnX3NlcnZlcm5hbWU7CiAJfQogCi0JZnByaW50ZihmLCAi
UmV0dXJuLVBhdGg6IDwlcyVzJXM+XHJcbiIsCisJdmxlbiA9IHN0cmxlbihycGF0aCkgKyAoaG9z
dG5hbWUgPyAxICsgc3RybGVuKGhvc3RuYW1lKSA6IDApICsgMjsKKwl2YWwgPSAoY2hhciopeG1h
bGxvYygodmxlbiArIDEpICogc2l6ZW9mKGNoYXIqKSk7CisJc3ByaW50Zih2YWwsICI8JXMlcyVz
PiIsCiAJCXJwYXRoLCBob3N0bmFtZSA/ICJAIiA6ICIiLCBob3N0bmFtZSA/IGhvc3RuYW1lIDog
IiIpOworCXZhbFt2bGVuXSA9IDA7CisJbmFtZSA9IHhzdHJkdXAoIlJldHVybi1QYXRoIik7CisK
KwlmcHJpbnRmKGYsICIlczogJXNcclxuIiwgbmFtZSwgdmFsKTsKKwlpbnNlcnRfY2FjaGVfZWxl
bWVudChtLCB4c3RyZHVwKG5hbWUpLCB4c3RyZHVwKHZhbCkpOworCisJZnJlZShuYW1lKTsKKwlm
cmVlKHZhbCk7CisJbmFtZSA9IHZhbCA9IE5VTEw7CisJdmxlbiA9IDA7CiAgICAgfQogCiAgICAg
LyogYWRkIGEgcmVjZWl2ZWQgaGVhZGVyICovCi0gICAgdCA9IHRpbWUoTlVMTCk7Ci0gICAgcmZj
ODIyZGF0ZV9nZW4oZGF0ZXN0ciwgc2l6ZW9mKGRhdGVzdHIpLCB0KTsKLSAgICBmcHJpbnRmKGYs
ICJSZWNlaXZlZDogZnJvbSAlcyAoJXMpIiwKLQkgICAgY2QtPmxobG9fcGFyYW0sIGNkLT5jbGll
bnRob3N0KTsKICAgICBpZiAobS0+YXV0aHVzZXIpIHsKIAljb25zdCBpbnQgKnNzZnA7CisJaW50
IGxiaXRzID0gMCwgbHNzZnA7CiAJc2FzbF9nZXRwcm9wKGNkLT5jb25uLCBTQVNMX1NTRiwgKGNv
bnN0IHZvaWQgKiopICZzc2ZwKTsKLQlmcHJpbnRmKGYsICIgKGF1dGhlbnRpY2F0ZWQgdXNlcj0l
cyBiaXRzPSVkKSIsIG0tPmF1dGh1c2VyLCAqc3NmcCk7CisKKwlsc3NmcCA9ICpzc2ZwOworCWRv
IHsKKwkgICAgbGJpdHMrKzsKKwl9IHdoaWxlICgoaW50KShsc3NmcC89MTApICE9IDApOworCisJ
dmxlbiA9IDI4ICsgc3RybGVuKG0tPmF1dGh1c2VyKSArIGxiaXRzOworICAgICAgICB2YWwgPSAo
Y2hhciopeG1hbGxvYygodmxlbiArIDEpICogc2l6ZW9mKGNoYXIqKSk7CisJc3ByaW50Zih2YWws
ICIgKGF1dGhlbnRpY2F0ZWQgdXNlcj0lcyBiaXRzPSVkKSIsIG0tPmF1dGh1c2VyLCAqc3NmcCk7
CisgICAgfQorCisgICAgdmxlbiArPSBzdHJsZW4oY2QtPmxobG9fcGFyYW0pICsgc3RybGVuKGNk
LT5jbGllbnRob3N0KSArCisJICAgIHN0cmxlbihjb25maWdfc2VydmVybmFtZSkgKyBzdHJsZW4o
Q1lSVVNfVkVSU0lPTikgKyAzMzsKKyAgICBpZiAodmFsID09IE5VTEwpIHsKKwl2YWwgPSAoY2hh
ciopeG1hbGxvYygodmxlbiArIDEpICogc2l6ZW9mKGNoYXIqKSk7CisJdmFsWzBdID0gJ1wwJzsK
KyAgICB9IGVsc2UgeworCXZhbCA9IChjaGFyKil4cmVhbGxvYyh2YWwsICh2bGVuICsgMSkgKiBz
aXplb2YoY2hhciopKTsKICAgICB9Ci0gICAgZnByaW50ZihmLCAiXHJcblx0YnkgJXMgKEN5cnVz
ICVzKSB3aXRoIExNVFAiLAotCQljb25maWdfc2VydmVybmFtZSwgQ1lSVVNfVkVSU0lPTik7Cisg
ICAgc3ByaW50Zih2YWwsICJmcm9tICVzICglcyklc1xyXG5cdGJ5ICVzIChDeXJ1cyAlcykgd2l0
aCBMTVRQIiwKKwkgICAgY2QtPmxobG9fcGFyYW0sIGNkLT5jbGllbnRob3N0LCAodmFsWzBdID09
ICdcMCcgPyAiIiA6IHZhbCksCisJICAgIGNvbmZpZ19zZXJ2ZXJuYW1lLCBDWVJVU19WRVJTSU9O
KTsKIAogI2lmZGVmIEhBVkVfU1NMCiAgICAgaWYgKGNkLT50bHNfY29ubikgewpAQCAtMTAyNiwx
NSArMTA2Myw0NiBAQAogCXRsc19pbmZvWzBdID0gJ1wwJzsKIAkvKiBncmFiIFRMUyBpbmZvIGZv
ciBSZWNlaXZlZDogaGVhZGVyICovCiAJdGxzX2dldF9pbmZvKGNkLT50bHNfY29ubiwgdGxzX2lu
Zm8sIHNpemVvZih0bHNfaW5mbykpOwotCWlmICgqdGxzX2luZm8pIGZwcmludGYoZiwgIiAoJXMp
IiwgdGxzX2luZm8pOworCWlmICgqdGxzX2luZm8pIHsKKwkgICAgdmxlbiArPSBzdHJsZW4odGxz
X2luZm8pICsgMzsKKwkgICAgdmFsID0gKGNoYXIqKXhyZWFsbG9jKHZhbCwgKHZsZW4gKyAxKSAq
IHNpemVvZihjaGFyKikpOworCSAgICBzcHJpbnRmKHZhbCwgIiVzICglcykiLCB2YWwsIHRsc19p
bmZvKTsKKwl9CiAgICAgfQogI2VuZGlmIC8qIEhBVkVfU1NMICovCiAKLSAgICBmcHJpbnRmKGYs
ICI7ICVzXHJcbiIsIGRhdGVzdHIpOworICAgIHQgPSB0aW1lKE5VTEwpOworICAgIHJmYzgyMmRh
dGVfZ2VuKGRhdGVzdHIsIHNpemVvZihkYXRlc3RyKSwgdCk7CisKKyAgICB2bGVuICs9IHN0cmxl
bihkYXRlc3RyKSArIDI7CisgICAgdmFsID0gKGNoYXIqKXhyZWFsbG9jKHZhbCwgKHZsZW4gKyAx
KSAqIHNpemVvZihjaGFyKikpOworICAgIHNwcmludGYodmFsLCAiJXM7ICVzIiwgdmFsLCBkYXRl
c3RyKTsKKworICAgIHZhbFt2bGVuXSA9IDA7CisgICAgbmFtZSA9IHhzdHJkdXAoIlJlY2VpdmVk
Iik7CisKKyAgICBmcHJpbnRmKGYsICIlczogJXNcclxuIiwgbmFtZSwgdmFsKTsKKyAgICBpbnNl
cnRfY2FjaGVfZWxlbWVudChtLCB4c3RyZHVwKG5hbWUpLCB4c3RyZHVwKHZhbCkpOworCisgICAg
ZnJlZShuYW1lKTsKKyAgICBmcmVlKHZhbCk7CisgICAgbmFtZSA9IHZhbCA9IDA7CiAKICAgICAv
KiBhZGQgYW55IHJlcXVlc3RlZCBoZWFkZXJzICovCi0gICAgaWYgKGZ1bmMtPmFkZGhlYWRlcnMp
IHsKLQlmcHV0cyhmdW5jLT5hZGRoZWFkZXJzLCBmKTsKKyAgICAvKiBuZWVkIHRvIHBhcnNlIHRv
IGFkZCB0byB0aGUgaGVhZGVyIGNhY2hlICovCisgICAgaWYgKGZ1bmMtPm5oZWFkZXJzID4gMCkg
eworCWludCBpID0gMDsKKwlkbyB7CisJICAgIGZwcmludGYoZiwgIiVzOiAlc1xyXG4iLCBmdW5j
LT5hZGRoZWFkZXJzW2ldLm5hbWUsCisJCSAgICAgZnVuYy0+YWRkaGVhZGVyc1tpXS5jb250ZW50
c1swXSk7CisKKwkgICAgLyogY29weSB0aGUgZGF0YSBiZWluZyBwYXNzZWQgaW47IGFkZGhlYWRl
cnNbXSB3aWxsIGJlCisJICAgICAgIGZyZWVkIHdoZW4gbG10cGQgZXhpdHMsIGRvbid0IHdhbnQg
bmFtZSBmcmVlZAorCSAgICAgICBiZWZvcmUgdGhlbiAqLworCSAgICBpbnNlcnRfY2FjaGVfZWxl
bWVudChtLCB4c3RyZHVwKGZ1bmMtPmFkZGhlYWRlcnNbaV0ubmFtZSksCisJCSAgICAgeHN0cmR1
cChmdW5jLT5hZGRoZWFkZXJzW2ldLmNvbnRlbnRzWzBdKSk7CisJICAgIGkrKzsKKwl9IHdoaWxl
IChpICE9IGZ1bmMtPm5oZWFkZXJzKTsKICAgICB9CiAKICAgICAvKiBmaWxsIHRoZSBjYWNoZSAq
LwpAQCAtMjYyOCwzICsyNjk2LDE0IEBACiAKICAgICByZXR1cm4gU0FTTF9PSzsKIH0KKworCitp
bnQgYWRkaGVhZGVyKHN0cnVjdCBsbXRwX2Z1bmMgKmZ1bmMsIGNoYXIgKm5hbWUsIGNoYXIgKmJv
ZHkpCit7CisgICAgZnVuYy0+bmhlYWRlcnMrKzsKKyAgICBmdW5jLT5hZGRoZWFkZXJzID0gKGhl
YWRlcl90ICopeHJlYWxsb2MoZnVuYy0+YWRkaGVhZGVycywgZnVuYy0+bmhlYWRlcnMgKiBzaXpl
b2YoaGVhZGVyX3QpKTsKKyAgICBmdW5jLT5hZGRoZWFkZXJzW2Z1bmMtPm5oZWFkZXJzIC0gMV0u
bmFtZSA9IHhzdHJkdXAobmFtZSk7CisgICAgZnVuYy0+YWRkaGVhZGVyc1tmdW5jLT5uaGVhZGVy
cyAtIDFdLmNvbnRlbnRzWzBdID0geHN0cmR1cChib2R5KTsKKyAgICBmdW5jLT5hZGRoZWFkZXJz
W2Z1bmMtPm5oZWFkZXJzIC0gMV0ubmNvbnRlbnRzID0gMTsKKyAgICByZXR1cm4gMDsKK30KZGlm
ZiAtcnVOIGN5cnVzLWltYXBkLTIuMS4xNi5vcmlnL2ltYXAvbG10cGVuZ2luZS5oIGN5cnVzLWlt
YXBkLTIuMS4xNi9pbWFwL2xtdHBlbmdpbmUuaAotLS0gY3lydXMtaW1hcGQtMi4xLjE2Lm9yaWcv
aW1hcC9sbXRwZW5naW5lLmgJMjAwMy0xMS0yMyAwNDo1NjoyOC4wMDAwMDAwMDAgLTA4MDAKKysr
IGN5cnVzLWltYXBkLTIuMS4xNi9pbWFwL2xtdHBlbmdpbmUuaAkyMDAzLTExLTIzIDA0OjU4OjQz
LjU2NTI0MzAwMCAtMDgwMApAQCAtNTEsNiArNTEsMTIgQEAKIHR5cGVkZWYgc3RydWN0IEhlYWRl
ciBoZWFkZXJfdDsKIHR5cGVkZWYgc3RydWN0IGFkZHJlc3NfZGF0YSBhZGRyZXNzX2RhdGFfdDsK
IAorc3RydWN0IEhlYWRlciB7CisgICAgY2hhciAqbmFtZTsKKyAgICBpbnQgbmNvbnRlbnRzOwor
ICAgIGNoYXIgKmNvbnRlbnRzWzFdOworfTsKKwogc3RydWN0IG1lc3NhZ2VfZGF0YSB7CiAgICAg
c3RydWN0IHByb3RzdHJlYW0gKmRhdGE7CS8qIG1lc3NhZ2UgaW4gdGVtcCBmaWxlICovCiAgICAg
RklMRSAqZjsJCQkvKiBGSUxFICogY29ycmVzcG9uZGluZyAqLwpAQCAtMTA3LDExICsxMTMsMTcg
QEAKICAgICB2b2lkICgqc2h1dGRvd24pKGludCBjb2RlKTsKICAgICBGSUxFICooKnNwb29sZmls
ZSkobWVzc2FnZV9kYXRhX3QgKm0pOwogICAgIHZvaWQgKCpyZW1vdmVzcG9vbCkobWVzc2FnZV9k
YXRhX3QgKm0pOwotICAgIGNoYXIgKmFkZGhlYWRlcnM7CQkvKiBhZGQgdGhlc2UgaGVhZGVycyB0
byBhbGwgbWVzc2FnZXMgKi8KKyAgICBoZWFkZXJfdCAqYWRkaGVhZGVyczsJLyogYWRkIHRoZXNl
IGhlYWRlcnMgdG8gYWxsIG1lc3NhZ2VzICovCisgICAgaW50IG5oZWFkZXJzOwkJLyogY291bnQg
b2YgYWxsIGhlYWRlcnMgdG8gYWRkICovCiAgICAgaW50IGFkZHJldHBhdGg7CQkvKiBzaG91bGQg
aSBhZGQgYSByZXR1cm4tcGF0aCBoZWFkZXI/ICovCiAgICAgaW50IHByZWF1dGg7CQkvKiBwcmVh
dXRoIGNvbm5lY3Rpb24/ICovCiB9OwogCisKKy8qIGFkZCBhcmJpdHJhcnkgaGVhZGVycyB0byB0
aGUgbG10cF9mdW5jIHN0cnVjdCAqLworaW50IGFkZGhlYWRlcihzdHJ1Y3QgbG10cF9mdW5jICpm
dW5jLCBjaGFyICpuYW1lLCBjaGFyICpib2R5KTsKKworCiAvKiBydW4gTE1UUCBvbiAncGluJyBh
bmQgJ3BvdXQnLCBkb2luZyBjYWxsYmFja3MgdG8gJ2Z1bmMnIHdoZXJlIGFwcHJvcHJpYXRlCiAg
KiAKICAqIHdpbGwgY2FsbCBzaWduYWxzX3BvbGwoKSBvbiBvY2Nhc2lvbi4KZGlmZiAtcnVOIGN5
cnVzLWltYXBkLTIuMS4xNi5vcmlnL2ltYXAvbG10cHByb3h5ZC5jIGN5cnVzLWltYXBkLTIuMS4x
Ni9pbWFwL2xtdHBwcm94eWQuYwotLS0gY3lydXMtaW1hcGQtMi4xLjE2Lm9yaWcvaW1hcC9sbXRw
cHJveHlkLmMJMjAwMy0xMS0yMyAwNDo1NjoyOC4wMDAwMDAwMDAgLTA4MDAKKysrIGN5cnVzLWlt
YXBkLTIuMS4xNi9pbWFwL2xtdHBwcm94eWQuYwkyMDAzLTExLTIzIDA0OjU4OjQzLjU2NjczNTAw
MCAtMDgwMApAQCAtMTQ0LDcgKzE0NCw3IEBACiBzdGF0aWMgdm9pZCB1c2FnZSgpOwogCiBzdHJ1
Y3QgbG10cF9mdW5jIG15bG10cCA9IHsgJmRlbGl2ZXIsICZ2ZXJpZnlfdXNlciwgJnNodXRfZG93
biwKLQkJCSAgICAmcHJveHlfc3Bvb2xmaWxlLCBOVUxMLCAwLCAwLCAwIH07CisJCQkgICAgJnBy
b3h5X3Nwb29sZmlsZSwgTlVMTCwgMCwgMCwgMCwgMCB9OwogCiAvKiBnbG9iYWxzICovCiBzdGF0
aWMgaW50IHF1b3Rhb3ZlcnJpZGUgPSAwOwkJLyogc2hvdWxkIGkgb3ZlcnJpZGUgcXVvdGE/ICov
Cg==
</data>        

          </attachment>
      

    </bug>

</bugzilla>