<?xml version="1.0" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugzilla.cyrusimap.org/bugzilla.dtd">

<bugzilla version="3.2.5.1-2"
          urlbase="https://bugzilla.cyrusimap.org/"
          maintainer="Dave McMurtrie &lt;dave64@andrew.cmu.edu&gt;"
>

    <bug>
          <bug_id>3441</bug_id>
          
          <creation_ts>2011-04-13 09:34 EDT</creation_ts>
          <short_desc>squatter exits with bus error</short_desc>
          <delta_ts>2011-04-22 15:53:09 EDT</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Cyrus IMAP</product>
          <component>IMAP</component>
          <version>2.4.6</version>
          <rep_platform>PC</rep_platform>
          <op_sys>Linux</op_sys>
          <bug_status>ASSIGNED</bug_status>
          
          
          
          
          
          <priority>P5</priority>
          <bug_severity>bug</bug_severity>
          <target_milestone>Future</target_milestone>
          
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Rudy Gevaert">rudy.gevaert@ugent.be</reporter>
          <assigned_to name="Bron Gondwana">brong@fastmail.fm</assigned_to>
          <cc>brong@fastmail.fm</cc>
          <qa_contact name="The Cyrus Bugzilla List">cyrus-bugzilla@lists.andrew.cmu.edu</qa_contact>

      

      

      
          <long_desc isprivate="0">
            <who name="Rudy Gevaert">rudy.gevaert@ugent.be</who>
            <bug_when>2011-04-13 09:34:59 EDT</bug_when>
            <thetext>Hi,

It als seems that our squatter is having problems:

Core was generated by `/usr/cyrus-2.4.6/bin/squatter -C
/etc/cyrus-ugent/conf/mail12/imapd.conf -s -i&apos;.
Program terminated with signal 7, Bus error.
#0  squat_scan_recurse (s=0x7f2afed135fe &lt;Address 0x7f2afed135fe out of
bounds&gt;, data_end=0x7f2afed1b0cc &lt;Address 0x7f2afed1b0cc out of bounds&gt;,
name=0x7fff32e33b30 &quot;9 &amp;i&quot;, level=3,
    handler=0x431260 &lt;squat_count_docs_callback&gt;, closure=0x7fff32e33fec) at
squat.c:687
687    squat.c: No such file or directory.
    in squat.c
(gdb) bt
#0  squat_scan_recurse (s=0x7f2afed135fe &lt;Address 0x7f2afed135fe out of
bounds&gt;, data_end=0x7f2afed1b0cc &lt;Address 0x7f2afed1b0cc out of bounds&gt;,
name=0x7fff32e33b30 &quot;9 &amp;i&quot;, level=3,
    handler=0x431260 &lt;squat_count_docs_callback&gt;, closure=0x7fff32e33fec) at
squat.c:687
#1  0x0000000000431809 in squat_scan_recurse (s=0x7f2afed135fe &lt;Address
0x7f2afed135fe out of bounds&gt;, data_end=&lt;value optimized out&gt;,
name=0x7fff32e33b30 &quot;9 &amp;i&quot;, level=&lt;value optimized out&gt;,
    handler=&lt;value optimized out&gt;, closure=&lt;value optimized out&gt;) at
squat.c:749
#2  0x0000000000431809 in squat_scan_recurse (s=0x7f2afed135fe &lt;Address
0x7f2afed135fe out of bounds&gt;, data_end=&lt;value optimized out&gt;,
name=0x7fff32e33b30 &quot;9 &amp;i&quot;, level=&lt;value optimized out&gt;,
    handler=&lt;value optimized out&gt;, closure=&lt;value optimized out&gt;) at
squat.c:749
#3  0x0000000000431d34 in squat_count_docs (index=0x27d1b10, first_char=57 &apos;9&apos;,
counter=0x7fff32e33fec) at squat.c:952
#4  0x000000000041221b in dump_index_trie_words (index=0x27ae270, OK=&lt;value
optimized out&gt;) at squat_build.c:1375
#5  index_close_internal (index=0x27ae270, OK=&lt;value optimized out&gt;) at
squat_build.c:1545
#6  0x00000000004076e8 in squat_single (state=0x279e030, incremental=1) at
squatter.c:482
#7  0x0000000000407c9f in index_me (name=0x2635cc0
&quot;ugent.be!user.els^baerten.Drafts&quot;, matchlen=&lt;value optimized out&gt;,
maycreate=&lt;value optimized out&gt;, rock=&lt;value optimized out&gt;) at squatter.c:623
#8  0x0000000000408104 in main (argc=5, argv=0x7fff32e35c38) at squatter.c:745</thetext>
          </long_desc>
          <long_desc isprivate="0">
            <who name="Rudy Gevaert">rudy.gevaert@ugent.be</who>
            <bug_when>2011-04-13 09:35:35 EDT</bug_when>
            <thetext>I&apos;ve nailed it down to a specific mailbox:

cyrus@cyrprd2:~$ gdb /usr/cyrus-2.4.6/bin/squatter
GNU gdb (GDB) 7.0.1-debian
Copyright (C) 2009 Free Software Foundation, Inc.
License GPLv3+: GNU GPL version 3 or later &lt;http://gnu.org/licenses/gpl.html&gt;
This is free software: you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.  Type &quot;show copying&quot;
and &quot;show warranty&quot; for details.
This GDB was configured as &quot;x86_64-linux-gnu&quot;.
For bug reporting instructions, please see:
&lt;http://www.gnu.org/software/gdb/bugs/&gt;...
Reading symbols from /usr/cyrus-2.4.6/bin/squatter...done.
(gdb) run  -C /etc/cyrus-ugent/conf/mail12/imapd.conf -s -i -r user/els.baerten@ugent.be
Starting program: /usr/cyrus-2.4.6/bin/squatter -C /etc/cyrus-ugent/conf/mail12/imapd.conf -s -i -r user/els.baerten@ugent.be
[Thread debugging using libthread_db enabled]

Program received signal SIGBUS, Bus error.
squat_scan_recurse (s=0x7ffff28675fe &lt;Address 0x7ffff28675fe out of bounds&gt;, data_end=0x7ffff286f0cc &quot;&quot;, name=0x7fffffffbd10 &quot;9 &amp;i&quot;, level=3, handler=0x431260 &lt;squat_count_docs_callback&gt;, 
    closure=0x7fffffffc1cc) at squat.c:687
687	squat.c: No such file or directory.
	in squat.c
(gdb) bt
#0  squat_scan_recurse (s=0x7ffff28675fe &lt;Address 0x7ffff28675fe out of bounds&gt;, data_end=0x7ffff286f0cc &quot;&quot;, name=0x7fffffffbd10 &quot;9 &amp;i&quot;, level=3, handler=0x431260 &lt;squat_count_docs_callback&gt;, 
    closure=0x7fffffffc1cc) at squat.c:687
#1  0x0000000000431809 in squat_scan_recurse (s=0x7ffff28675fe &lt;Address 0x7ffff28675fe out of bounds&gt;, data_end=&lt;value optimized out&gt;, name=0x7fffffffbd10 &quot;9 &amp;i&quot;, level=&lt;value optimized out&gt;, 
    handler=&lt;value optimized out&gt;, closure=&lt;value optimized out&gt;) at squat.c:749
#2  0x0000000000431809 in squat_scan_recurse (s=0x7ffff28675fe &lt;Address 0x7ffff28675fe out of bounds&gt;, data_end=&lt;value optimized out&gt;, name=0x7fffffffbd10 &quot;9 &amp;i&quot;, level=&lt;value optimized out&gt;, 
    handler=&lt;value optimized out&gt;, closure=&lt;value optimized out&gt;) at squat.c:749
#3  0x0000000000431d34 in squat_count_docs (index=0x779d90, first_char=57 &apos;9&apos;, counter=0x7fffffffc1cc) at squat.c:952
#4  0x000000000041221b in dump_index_trie_words (index=0x7763e0, OK=&lt;value optimized out&gt;) at squat_build.c:1375
#5  index_close_internal (index=0x7763e0, OK=&lt;value optimized out&gt;) at squat_build.c:1545
#6  0x00000000004076e8 in squat_single (state=0x7757a0, incremental=1) at squatter.c:482
#7  0x0000000000407c9f in index_me (name=0x7fffffffccf0 &quot;ugent.be!user.els^baerten.Drafts&quot;, matchlen=&lt;value optimized out&gt;, maycreate=&lt;value optimized out&gt;, rock=&lt;value optimized out&gt;) at squatter.c:623
#8  0x000000000041ec0e in find_cb (rockp=0x7fffffffda10, key=&lt;value optimized out&gt;, keylen=32, data=&lt;value optimized out&gt;, datalen=&lt;value optimized out&gt;) at mboxlist.c:1697
#9  0x000000000044a8ae in myforeach (db=0x775220, prefix=&lt;value optimized out&gt;, prefixlen=26, goodp=&lt;value optimized out&gt;, cb=&lt;value optimized out&gt;, rock=&lt;value optimized out&gt;, tidptr=0x0)
    at cyrusdb_skiplist.c:1122
#10 0x000000000041dbc5 in mboxlist_findall (namespace=&lt;value optimized out&gt;, pattern=&lt;value optimized out&gt;, isadmin=1, userid=&lt;value optimized out&gt;, auth_state=&lt;value optimized out&gt;, 
    proc=&lt;value optimized out&gt;, rock=0x7fffffffeaec) at mboxlist.c:1889
#11 0x0000000000407f88 in main (argc=7, argv=&lt;value optimized out&gt;) at squatter.c:757
(gdb)</thetext>
          </long_desc>
          <long_desc isprivate="0">
            <who name="Bron Gondwana">brong@fastmail.fm</who>
            <bug_when>2011-04-13 09:50:17 EDT</bug_when>
            <thetext>I&apos;m looking at it :)</thetext>
          </long_desc>
          <long_desc isprivate="0">
            <who name="Bron Gondwana">brong@fastmail.fm</who>
            <bug_when>2011-04-13 10:23:40 EDT</bug_when>
            <thetext>I&apos;m going to leave this one for &apos;future&apos;.  First I need to see what&apos;s wrong with the specific squatter file!</thetext>
          </long_desc>
          <long_desc isprivate="0">
            <who name="Bron Gondwana">brong@fastmail.fm</who>
            <bug_when>2011-04-22 15:53:09 EDT</bug_when>
            <thetext>Tuning this right down - the file can certainly kill squatter on 2.4.6, and doesn&apos;t on 2.4.8 - but I don&apos;t think it&apos;s because we&apos;ve _fixed_ anything - more that the memory layout is slightly different and it&apos;s trashing something else.  Squatter is nasty nasty code :(</thetext>
          </long_desc>
      
      

    </bug>

</bugzilla>