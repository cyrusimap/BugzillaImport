<?xml version="1.0" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugzilla.cyrusimap.org/bugzilla.dtd">

<bugzilla version="3.2.5.1-2"
          urlbase="https://bugzilla.cyrusimap.org/"
          maintainer="Dave McMurtrie &lt;dave64@andrew.cmu.edu&gt;"
>

    <bug>
          <bug_id>3346</bug_id>
          
          <creation_ts>2010-11-21 05:18 EDT</creation_ts>
          <short_desc>./configure does not check for gperf</short_desc>
          <delta_ts>2010-11-29 20:50:48 EDT</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Cyrus IMAP</product>
          <component>lib</component>
          <version>2.5.x (next)</version>
          <rep_platform>PC</rep_platform>
          <op_sys>Linux</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          
          
          <priority>P3</priority>
          <bug_severity>bug</bug_severity>
          <target_milestone>2.5-next</target_milestone>
          
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Jeroen van Meeuwen (Kolab Systems)">vanmeeuwen@kolabsys.com</reporter>
          <assigned_to name="Greg Banks">gnb@fastmail.fm</assigned_to>
          
          <qa_contact name="The Cyrus Bugzilla List">cyrus-bugzilla@lists.andrew.cmu.edu</qa_contact>

      

      

      
          <long_desc isprivate="0">
            <who name="Jeroen van Meeuwen (Kolab Systems)">vanmeeuwen@kolabsys.com</who>
            <bug_when>2010-11-21 05:18:08 EDT</bug_when>
            <thetext>./configure does not check for gperf, and so when gperf is not available, building Cyrus IMAP will only fail during &quot;make&quot; - it should fail ./configure</thetext>
          </long_desc>
          <long_desc isprivate="0">
            <who name="Greg Banks">gnb@fastmail.fm</who>
            <bug_when>2010-11-21 20:13:47 EDT</bug_when>
            <thetext>This is true and not an accident.  The theory is this:

a) When you build from a release tarball, you already have the C code
   generated by gperf in the tarball[1], so you don&apos;t need to run gperf
   at all, and thus there&apos;s no reason to check for it in ./configure
   and having ./configure fail where it used to work is downright unhelpful.

b) And when you&apos;re building from git, you should be sufficiently familiar
   with the code to realise you needed gperf, and sufficiently clueful to
   work out why the build failed.

So I can a add a check for the gperf binary in configure, that&apos;s easy,
but I can&apos;t see an obvious way to make it useful in case b) without
breaking case a).  At the moment ./configure can&apos;t tell the difference
between those cases.

I figure I could:

 * make ./configure detect when it&apos;s run from git and do the gperf check, or

 * add an Automake-like --enable-maintainer-mode option to ./configure
   which you need to use to get the rule that runs compile_st.pl, and
   which checks for gperf (and other stuff we need to do &quot;make dist&quot;, like
   the various documentation tools).

 * do some combination of the above two

 * ignore the issue

Let me know what you prefer.

[1] http://git.cyrusimap.org/cyrus-imapd/patch/?id=6e64ead93076f6d793992444f62c0aaf4efcfcc8</thetext>
          </long_desc>
          <long_desc isprivate="0">
            <who name="Jeroen van Meeuwen (Kolab Systems)">vanmeeuwen@kolabsys.com</who>
            <bug_when>2010-11-23 04:59:13 EDT</bug_when>
            <thetext>./configure might just issue a FAIL if gperf does not exist, and the files gperf creates do also not exist in the tree, perhaps?</thetext>
          </long_desc>
          <long_desc isprivate="0">
            <who name="Greg Banks">gnb@fastmail.fm</who>
            <bug_when>2010-11-29 20:50:48 EDT</bug_when>
            <thetext>http://git.cyrusimap.org/cyrus-imapd/commit/?id=6f84c3ae1b73a6fe3635dfe96a0b342cb2b1eab4

http://git.cyrusimap.org/cyrus-imapd/commit/?id=4f4c46d388fcd50ed945751942c538cdf5461a39

http://git.cyrusimap.org/cyrus-imapd/commit/?id=ca9931139890263b8f32d1ef3eab2e3b27540fb9</thetext>
          </long_desc>
      
      

    </bug>

</bugzilla>