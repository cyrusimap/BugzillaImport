<?xml version="1.0" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugzilla.cyrusimap.org/bugzilla.dtd">

<bugzilla version="3.2.5.1-2"
          urlbase="https://bugzilla.cyrusimap.org/"
          maintainer="Dave McMurtrie &lt;dave64@andrew.cmu.edu&gt;"
>

    <bug>
          <bug_id>3638</bug_id>
          
          <creation_ts>2012-01-20 17:23 EDT</creation_ts>
          <short_desc>sessionid logging improvements for murder environments</short_desc>
          <delta_ts>2012-03-12 09:32:06 EDT</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Cyrus IMAP</product>
          <component>Murder</component>
          <version>2.4.x (next)</version>
          <rep_platform>PC</rep_platform>
          <op_sys>Linux</op_sys>
          <bug_status>CLOSED</bug_status>
          <resolution>FIXED</resolution>
          
          
          
          
          <priority>P3</priority>
          <bug_severity>bug</bug_severity>
          <target_milestone>2.4.14</target_milestone>
          
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Wolfgang Breyha">wbreyha@gmx.net</reporter>
          <assigned_to name="Bron Gondwana">brong@fastmail.fm</assigned_to>
          <cc>gnb@fastmail.fm</cc>
    
    <cc>vanmeeuwen@kolabsys.com</cc>
          <qa_contact name="The Cyrus Bugzilla List">cyrus-bugzilla@lists.andrew.cmu.edu</qa_contact>

      

      

      
          <long_desc isprivate="0">
            <who name="Wolfgang Breyha">wbreyha@gmx.net</who>
            <bug_when>2012-01-20 17:23:33 EDT</bug_when>
            <thetext>Created an attachment (id=1454)
sessionid logging improvements

This patch is based on #3598. Since it is already committed I built this patch on my 2.4.13 with #3598 applied.

This patch adds
*) parsing of SESSIONID=&lt;...&gt; moved from lmtpengine.c to global.c:parse_sessionid()
*) lmtpengine.c uses parse_sessionid()
*) SESSIONID added to all OK [CAPA...] answers of imapd. Backported from
http://git.cyrusimap.org/cyrus-imapd/commit/?h=cyrus-imapd-2.4&amp;id=bcab97a9607be4228fd274431fc4a6ed3a67fb77
*) SESSIONID added to syslog output on several places in imapd and pop3d were I thought they are missing.
*) output &quot;proxy &lt;userid&gt; sessionid=&lt;&gt; remote=&lt;&gt;&quot; in backend_connect for imap and pop3 sessions</thetext>
          </long_desc>
          <long_desc isprivate="0">
            <who name="Wolfgang Breyha">wbreyha@gmx.net</who>
            <bug_when>2012-01-23 07:23:29 EDT</bug_when>
            <thetext>Created an attachment (id=1455)
sessionid logging improvements

also fixes possible unterminated string in strncpy introduced in #3598</thetext>
          </long_desc>
          <long_desc isprivate="0">
            <who name="Wolfgang Breyha">wbreyha@gmx.net</who>
            <bug_when>2012-01-23 07:29:55 EDT</bug_when>
            <thetext>Created an attachment (id=1456)
sessionid logging improvements

another one moving parse_sessionid into to &quot;if (auditlog)&quot; since it&apos;s only used there as reported by Greg Banks.</thetext>
          </long_desc>
          <long_desc isprivate="0">
            <who name="Greg Banks">gnb@fastmail.fm</who>
            <bug_when>2012-01-24 19:23:49 EDT</bug_when>
            <thetext>The last of the patches (id 1456) has been pushed to both the master branch

http://git.cyrusimap.org/cyrus-imapd/commit/?id=2bd325bca220a55c510dbfd51d1e725a9e062f0d

and the 2.4 branch

http://git.cyrusimap.org/cyrus-imapd/commit/?h=cyrus-imapd-2.4&amp;id=66dc1a17ec8b7a25e030c97619690c264e615b17

Thanks for the patch, Wolfgang!  Is there anything else we need to
do or can we resolve this ticket?

(moved to ASSIGNED anyway)</thetext>
          </long_desc>
          <long_desc isprivate="0">
            <who name="Wolfgang Breyha">wbreyha@gmx.net</who>
            <bug_when>2012-01-24 20:09:33 EDT</bug_when>
            <thetext>At least imap/pop3/lmtp should be fine now for tracking sessions in murder environments. Thanks for accepting my patch!</thetext>
          </long_desc>
          <long_desc isprivate="0">
            <who name="Greg Banks">gnb@fastmail.fm</who>
            <bug_when>2012-01-24 20:39:05 EDT</bug_when>
            <thetext>Right then, RESOLVEing.</thetext>
          </long_desc>
          <long_desc isprivate="0">
            <who name="Jeroen van Meeuwen (Kolab Systems)">vanmeeuwen@kolabsys.com</who>
            <bug_when>2012-03-12 09:32:06 EDT</bug_when>
            <thetext>Correcting status and milestone</thetext>
          </long_desc>
      
          <attachment
              isobsolete="1"
              ispatch="1"
              isprivate="0"
          >
            <attachid>1454</attachid>
            <date>2012-01-20 17:23 EDT</date>
            <desc>sessionid logging improvements</desc>
            <filename>cyrus-imapd-2.4.13-sessionid.patch</filename>
            <type>text/plain</type>
            <size>6149</size>
            <attacher>wbreyha@gmx.net</attacher>
            
              <data encoding="base64">ZGlmZiAtdXJOIGN5cnVzLWltYXBkLTIuNC4xMy5vcmlnL2ltYXAvYmFja2VuZC5jIGN5cnVzLWlt
YXBkLTIuNC4xMy53Yi9pbWFwL2JhY2tlbmQuYwotLS0gY3lydXMtaW1hcGQtMi40LjEzLm9yaWcv
aW1hcC9iYWNrZW5kLmMJMjAxMS0xMi0zMCAyMjoxOToxOC4wMDAwMDAwMDAgKzAxMDAKKysrIGN5
cnVzLWltYXBkLTIuNC4xMy53Yi9pbWFwL2JhY2tlbmQuYwkyMDEyLTAxLTIwIDIyOjMwOjQ1LjU5
MzAyNzkyMSArMDEwMApAQCAtNDE0LDYgKzQxNCw3IEBACiAgICAgY2hhciBidWZbMjA0OF0sICpt
ZWNobGlzdCA9IE5VTEw7CiAgICAgc3RydWN0IHNpZ2FjdGlvbiBhY3Rpb247CiAgICAgc3RydWN0
IGJhY2tlbmQgKnJldDsKKyAgICBjaGFyIHJzZXNzaW9uaWRbTUFYX1NFU1NJT05JRF9TSVpFXTsK
IAogICAgIGlmICghcmV0X2JhY2tlbmQpIHsKIAlyZXQgPSB4em1hbGxvYyhzaXplb2Yoc3RydWN0
IGJhY2tlbmQpKTsKQEAgLTYwOSw2ICs2MTAsMTIgQEAKIAkJbWVjaGxpc3QgPSBwYXJzZV9jYXBh
YmlsaXR5KG15X3N0YXR1cywgcHJvdCwKIAkJCQkJCSZyZXQtPmNhcGFiaWxpdHkpOwogCSAgICB9
CisKKwkgICAgaWYgKCEoc3RyY21wKHByb3QtPnNlcnZpY2UsICJpbWFwIikgJiYKKwkJIChzdHJj
bXAocHJvdC0+c2VydmljZSwgInBvcDMiKSkpKSB7CisJCXBhcnNlX3Nlc3Npb25pZChteV9zdGF0
dXMsIHJzZXNzaW9uaWQpOworCQlzeXNsb2coTE9HX05PVElDRSwgInByb3h5ICVzIHNlc3Npb25p
ZD08JXM+IHJlbW90ZT08JXM+IiwgdXNlcmlkLCBzZXNzaW9uX2lkKCksIHJzZXNzaW9uaWQpOwor
CSAgICB9CiAJfQogCiAJaWYgKG1saXN0KSBmcmVlKG1saXN0KTsKZGlmZiAtdXJOIGN5cnVzLWlt
YXBkLTIuNC4xMy5vcmlnL2ltYXAvZ2xvYmFsLmMgY3lydXMtaW1hcGQtMi40LjEzLndiL2ltYXAv
Z2xvYmFsLmMKLS0tIGN5cnVzLWltYXBkLTIuNC4xMy5vcmlnL2ltYXAvZ2xvYmFsLmMJMjAxMS0x
Mi0zMCAxNzoyMTo1My4wMDAwMDAwMDAgKzAxMDAKKysrIGN5cnVzLWltYXBkLTIuNC4xMy53Yi9p
bWFwL2dsb2JhbC5jCTIwMTItMDEtMjAgMTc6Mzg6NDQuMzE2MDEzMjU5ICswMTAwCkBAIC04MTUs
NiArODE1LDI1IEBACiAgICAgcmV0dXJuIChjb25zdCBjaGFyICopc2Vzc2lvbl9pZF9idWY7CiB9
CiAKKy8qIHBhcnNlIHNlc3Npb25pZCBvdXQgb2YgcHJvdG9jb2wgYW5zd2VycyAqLwordm9pZCBw
YXJzZV9zZXNzaW9uaWQoY29uc3QgY2hhciAqc3RyLCBjaGFyICpzZXNzaW9uaWQpCit7CisgICAg
Y2hhciAqc3AsICplcDsKKyAgICBpbnQgbGVuOworCisgICAgaWYgKChzdHIpICYmIChzcCA9IHN0
cnN0cihzdHIsICJTRVNTSU9OSUQ9PCIpKSAmJiAoZXAgPSBzdHJjaHIoc3AsICc+JykpKQorICAg
IHsKKwlzcCArPSAxMTsKKwlsZW4gPSBlcCAtIHNwOworCXN0cm5jcHkoc2Vzc2lvbmlkLCBzcCwg
CisJICAgIGxlbiA8IE1BWF9TRVNTSU9OSURfU0laRSA/IGxlbiA6IE1BWF9TRVNTSU9OSURfU0la
RSAtIDEpOworCWVwID0gc2Vzc2lvbmlkICsgbGVuOworCSplcCA9ICdcMCc7CisgICAgfQorICAg
IGVsc2UKKwlzdHJjcHkoc2Vzc2lvbmlkLCAidW5rbm93biIpOworfQorCiBpbnQgY2FwYV9pc19k
aXNhYmxlZChjb25zdCBjaGFyICpzdHIpCiB7CiAgICAgaWYgKCFzdXBwcmVzc2VkX2NhcGFiaWxp
dGllcykgcmV0dXJuIDA7CmRpZmYgLXVyTiBjeXJ1cy1pbWFwZC0yLjQuMTMub3JpZy9pbWFwL2lt
YXBkLmMgY3lydXMtaW1hcGQtMi40LjEzLndiL2ltYXAvaW1hcGQuYwotLS0gY3lydXMtaW1hcGQt
Mi40LjEzLm9yaWcvaW1hcC9pbWFwZC5jCTIwMTEtMTItMzAgMTc6MjE6NTMuMDAwMDAwMDAwICsw
MTAwCisrKyBjeXJ1cy1pbWFwZC0yLjQuMTMud2IvaW1hcC9pbWFwZC5jCTIwMTItMDEtMjAgMjA6
Mzg6MDguMzk0MDAxMTAxICswMTAwCkBAIC0yMjQ4LDEyICsyMjQ4LDE1IEBACiAJfQogICAgIH0K
ICAgICBlbHNlIGlmICggbm9zYXNscGFzc3dkY2hlY2sgKSB7Ci0JcmVwbHkgPSAiVXNlciBsb2dn
ZWQgaW4iOworCXNucHJpbnRmKHJlcGx5YnVmLCBzaXplb2YocmVwbHlidWYpLCAKKwkgICAgIlVz
ZXIgbG9nZ2VkIGluIFNFU1NJT05JRD08JXM+Iiwgc2Vzc2lvbl9pZCgpKTsKKwlyZXBseSA9IHJl
cGx5YnVmOwogCWltYXBkX3VzZXJpZCA9IHhzdHJkdXAoY2Fub25fdXNlcik7CiAJaW1hcGRfYXV0
aHN0YXRlID0gYXV0aF9uZXdzdGF0ZShjYW5vbl91c2VyKTsKIAlzeXNsb2coTE9HX05PVElDRSwg
ImxvZ2luOiAlcyAlcyVzIG5vcGFzc3dvcmQlcyAlcyIsIGltYXBkX2NsaWVudGhvc3QsCiAJICAg
ICAgIGltYXBkX3VzZXJpZCwgaW1hcGRfbWFnaWNwbHVzID8gaW1hcGRfbWFnaWNwbHVzIDogIiIs
Ci0JICAgICAgIGltYXBkX3N0YXJ0dGxzX2RvbmUgPyAiK1RMUyIgOiAiIiwgcmVwbHkpOworCSAg
ICAgICBpbWFwZF9zdGFydHRsc19kb25lID8gIitUTFMiIDogIiIsIAorCSAgICAgICByZXBseSA/
IHJlcGx5IDogIiIpOwogICAgIH0KICAgICBlbHNlIGlmICgociA9IHNhc2xfY2hlY2twYXNzKGlt
YXBkX3Nhc2xjb25uLAogCQkJCSBjYW5vbl91c2VyLApAQCAtMjM0Myw2ICsyMzQ2LDggQEAKIAog
ICAgIGNvbnN0IHZvaWQgKnZhbDsKICAgICBjaGFyICpzc2Ztc2c9TlVMTDsKKyAgICBjaGFyIHJl
cGx5YnVmW01BWF9NQUlMQk9YX0JVRkZFUl07CisgICAgY29uc3QgY2hhciAqcmVwbHkgPSBOVUxM
OwogCiAgICAgY29uc3QgY2hhciAqY2Fub25fdXNlcjsKIApAQCAtMjQzMyw5ICsyNDM4LDEzIEBA
CiAJaW1hcGRfdXNlcmlkID0geHN0cmR1cChjYW5vbl91c2VyKTsKICAgICB9CiAKKyAgICBzbnBy
aW50ZihyZXBseWJ1Ziwgc2l6ZW9mKHJlcGx5YnVmKSwgCisJIlVzZXIgbG9nZ2VkIGluIFNFU1NJ
T05JRD08JXM+Iiwgc2Vzc2lvbl9pZCgpKTsKKyAgICByZXBseSA9IHJlcGx5YnVmOwogICAgIHN5
c2xvZyhMT0dfTk9USUNFLCAibG9naW46ICVzICVzJXMgJXMlcyAlcyIsIGltYXBkX2NsaWVudGhv
c3QsCiAJICAgaW1hcGRfdXNlcmlkLCBpbWFwZF9tYWdpY3BsdXMgPyBpbWFwZF9tYWdpY3BsdXMg
OiAiIiwKLQkgICBhdXRodHlwZSwgaW1hcGRfc3RhcnR0bHNfZG9uZSA/ICIrVExTIiA6ICIiLCAi
VXNlciBsb2dnZWQgaW4iKTsKKwkgICBhdXRodHlwZSwgaW1hcGRfc3RhcnR0bHNfZG9uZSA/ICIr
VExTIiA6ICIiLCAKKwkgICByZXBseSA/IHJlcGx5IDogIiIpOwogCiAgICAgc2FzbF9nZXRwcm9w
KGltYXBkX3Nhc2xjb25uLCBTQVNMX1NTRiwgJnZhbCk7CiAgICAgc2FzbHByb3BzLnNzZiA9ICoo
KHNhc2xfc3NmX3QgKikgdmFsKTsKQEAgLTI0NjMsOSArMjQ3MiwxMSBAQAogICAgIGlmICghc2Fz
bHByb3BzLnNzZikgewogCXByb3RfcHJpbnRmKGltYXBkX291dCwgIiVzIE9LIFtDQVBBQklMSVRZ
ICIsIHRhZyk7CiAJY2FwYV9yZXNwb25zZShDQVBBX1BSRUFVVEh8Q0FQQV9QT1NUQVVUSCk7Ci0J
cHJvdF9wcmludGYoaW1hcGRfb3V0LCAiXSBTdWNjZXNzICglcylcclxuIiwgc3NmbXNnKTsKKwlw
cm90X3ByaW50ZihpbWFwZF9vdXQsICJdIFN1Y2Nlc3MgKCVzKSBTRVNTSU9OSUQ9PCVzPlxyXG4i
LAorCXNzZm1zZywgc2Vzc2lvbl9pZCgpKTsKICAgICB9IGVsc2UgewotCXByb3RfcHJpbnRmKGlt
YXBkX291dCwgIiVzIE9LIFN1Y2Nlc3MgKCVzKVxyXG4iLCB0YWcsIHNzZm1zZyk7CisJcHJvdF9w
cmludGYoaW1hcGRfb3V0LCAiJXMgT0sgU3VjY2VzcyAoJXMpIFNFU1NJT05JRD08JXM+XHJcbiIs
CisJdGFnLCBzc2Ztc2csIHNlc3Npb25faWQoKSk7CiAgICAgfQogCiAgICAgcHJvdF9zZXRzYXNs
KGltYXBkX2luLCAgaW1hcGRfc2FzbGNvbm4pOwpkaWZmIC11ck4gY3lydXMtaW1hcGQtMi40LjEz
Lm9yaWcvaW1hcC9sbXRwZW5naW5lLmMgY3lydXMtaW1hcGQtMi40LjEzLndiL2ltYXAvbG10cGVu
Z2luZS5jCi0tLSBjeXJ1cy1pbWFwZC0yLjQuMTMub3JpZy9pbWFwL2xtdHBlbmdpbmUuYwkyMDEx
LTEyLTMwIDE3OjIxOjUzLjAwMDAwMDAwMCArMDEwMAorKysgY3lydXMtaW1hcGQtMi40LjEzLndi
L2ltYXAvbG10cGVuZ2luZS5jCTIwMTItMDEtMjAgMTc6NDE6NDIuODk4MDQzMzY5ICswMTAwCkBA
IC0xODYyLDE1ICsxODYyLDggQEAKICAgICBpZiAoIUlTR09PRChjb2RlKSkgewogCWdvdG8gZmFp
bGFsbDsKICAgICB9Ci0gICAgaWYgKChzcCA9IHN0cnN0cihidWYsICJTRVNTSU9OSUQ9PCIpKSAm
JiAoZXAgPSBzdHJjaHIoc3AsICc+JykpKQotICAgIHsKLQlzcCArPSAxMTsKLQkqZXAgPSAnXDAn
OwotCXN0cm5jcHkocnNlc3Npb25pZCwgc3AsIE1BWF9TRVNTSU9OSURfU0laRSk7Ci0gICAgfQot
ICAgIGVsc2UKLSAgICAgICAgc3RyY3B5KHJzZXNzaW9uaWQsICJ1bmtub3duIik7CiAKKyAgICBw
YXJzZV9zZXNzaW9uaWQoYnVmLCByc2Vzc2lvbmlkKTsKICAgICBpZiAoY29uZmlnX2F1ZGl0bG9n
KQogCXN5c2xvZyhMT0dfTk9USUNFLCAiYXVkaXRsb2c6IHByb3h5IHNlc3Npb25pZD08JXM+IHJl
bW90ZT08JXM+Iiwgc2Vzc2lvbl9pZCgpLCByc2Vzc2lvbmlkKTsKIApkaWZmIC11ck4gY3lydXMt
aW1hcGQtMi40LjEzLm9yaWcvaW1hcC9wb3AzZC5jIGN5cnVzLWltYXBkLTIuNC4xMy53Yi9pbWFw
L3BvcDNkLmMKLS0tIGN5cnVzLWltYXBkLTIuNC4xMy5vcmlnL2ltYXAvcG9wM2QuYwkyMDExLTEy
LTMwIDE3OjIxOjUzLjAwMDAwMDAwMCArMDEwMAorKysgY3lydXMtaW1hcGQtMi40LjEzLndiL2lt
YXAvcG9wM2QuYwkyMDEyLTAxLTIwIDIxOjU0OjIyLjE3OTAxMTk0NyArMDEwMApAQCAtMTM0OCw5
ICsxMzQ4LDkgQEAKICAgICB9CiAgICAgcG9wZF91c2VyaWQgPSB4c3RyZHVwKChjb25zdCBjaGFy
ICopIGNhbm9uX3VzZXIpOwogICAgIAotICAgIHN5c2xvZyhMT0dfTk9USUNFLCAibG9naW46ICVz
ICVzJXMgQVBPUCVzICVzIiwgcG9wZF9jbGllbnRob3N0LAorICAgIHN5c2xvZyhMT0dfTk9USUNF
LCAibG9naW46ICVzICVzJXMgQVBPUCVzICVzIFNFU1NJT05JRD08JXM+IiwgcG9wZF9jbGllbnRo
b3N0LAogCSAgIHBvcGRfdXNlcmlkLCBwb3BkX3N1YmZvbGRlciA/IHBvcGRfc3ViZm9sZGVyIDog
IiIsCi0JICAgcG9wZF9zdGFydHRsc19kb25lID8gIitUTFMiIDogIiIsICJVc2VyIGxvZ2dlZCBp
biIpOworCSAgIHBvcGRfc3RhcnR0bHNfZG9uZSA/ICIrVExTIiA6ICIiLCAiVXNlciBsb2dnZWQg
aW4iLCBzZXNzaW9uX2lkKCkpOwogCiAgICAgcG9wZF9hdXRoc3RhdGUgPSBhdXRoX25ld3N0YXRl
KHBvcGRfdXNlcmlkKTsKIApAQCAtMTQxNyw5ICsxNDE3LDkgQEAKIAkgICAgcmV0dXJuOwogCX0K
IAotCXN5c2xvZyhMT0dfTk9USUNFLCAibG9naW46ICVzICVzJXMgS1BPUCVzICVzIiwgcG9wZF9j
bGllbnRob3N0LAorCXN5c2xvZyhMT0dfTk9USUNFLCAibG9naW46ICVzICVzJXMgS1BPUCVzICVz
IFNFU1NJT05JRD08JXM+IiwgcG9wZF9jbGllbnRob3N0LAogCSAgICAgICBwb3BkX3VzZXJpZCwg
cG9wZF9zdWJmb2xkZXIgPyBwb3BkX3N1YmZvbGRlciA6ICIiLAotCSAgICAgICBwb3BkX3N0YXJ0
dGxzX2RvbmUgPyAiK1RMUyIgOiAiIiwgIlVzZXIgbG9nZ2VkIGluIik7CisJICAgICAgIHBvcGRf
c3RhcnR0bHNfZG9uZSA/ICIrVExTIiA6ICIiLCAiVXNlciBsb2dnZWQgaW4iLCBzZXNzaW9uX2lk
KCkpOwogCiAJb3BlbmluYm94KCk7CiAJcmV0dXJuOwpAQCAtMTY4Nyw5ICsxNjg3LDkgQEAKICAg
ICB9IGVsc2UgewogCXBvcGRfdXNlcmlkID0geHN0cmR1cChjYW5vbl91c2VyKTsKICAgICB9Ci0g
ICAgc3lzbG9nKExPR19OT1RJQ0UsICJsb2dpbjogJXMgJXMlcyAlcyVzICVzIiwgcG9wZF9jbGll
bnRob3N0LAorICAgIHN5c2xvZyhMT0dfTk9USUNFLCAibG9naW46ICVzICVzJXMgJXMlcyAlcyBT
RVNTSU9OSUQ9PCVzPiIsIHBvcGRfY2xpZW50aG9zdCwKIAkgICBwb3BkX3VzZXJpZCwgcG9wZF9z
dWJmb2xkZXIgPyBwb3BkX3N1YmZvbGRlciA6ICIiLAotCSAgIGF1dGh0eXBlLCBwb3BkX3N0YXJ0
dGxzX2RvbmUgPyAiK1RMUyIgOiAiIiwgIlVzZXIgbG9nZ2VkIGluIik7CisJICAgYXV0aHR5cGUs
IHBvcGRfc3RhcnR0bHNfZG9uZSA/ICIrVExTIiA6ICIiLCAiVXNlciBsb2dnZWQgaW4iLCBzZXNz
aW9uX2lkKCkpOwogCiAgICAgc2FzbF9nZXRwcm9wKHBvcGRfc2FzbGNvbm4sIFNBU0xfU1NGLCAm
dmFsKTsKICAgICBzYXNscHJvcHMuc3NmID0gKigoc2FzbF9zc2ZfdCAqKSB2YWwpOwo=
</data>        

          </attachment>
          <attachment
              isobsolete="1"
              ispatch="1"
              isprivate="0"
          >
            <attachid>1455</attachid>
            <date>2012-01-23 07:23 EDT</date>
            <desc>sessionid logging improvements</desc>
            <filename>cyrus-imapd-2.4.13-sessionid.patch</filename>
            <type>text/plain</type>
            <size>6185</size>
            <attacher>wbreyha@gmx.net</attacher>
            
              <data encoding="base64">ZGlmZiAtdXJOIGN5cnVzLWltYXBkLTIuNC4xMy5vcmlnL2ltYXAvYmFja2VuZC5jIGN5cnVzLWlt
YXBkLTIuNC4xMy53Yi9pbWFwL2JhY2tlbmQuYwotLS0gY3lydXMtaW1hcGQtMi40LjEzLm9yaWcv
aW1hcC9iYWNrZW5kLmMJMjAxMS0xMi0zMCAyMjoxOToxOC4wMDAwMDAwMDAgKzAxMDAKKysrIGN5
cnVzLWltYXBkLTIuNC4xMy53Yi9pbWFwL2JhY2tlbmQuYwkyMDEyLTAxLTIwIDIyOjMwOjQ1LjU5
MzAyNzkyMSArMDEwMApAQCAtNDE0LDYgKzQxNCw3IEBACiAgICAgY2hhciBidWZbMjA0OF0sICpt
ZWNobGlzdCA9IE5VTEw7CiAgICAgc3RydWN0IHNpZ2FjdGlvbiBhY3Rpb247CiAgICAgc3RydWN0
IGJhY2tlbmQgKnJldDsKKyAgICBjaGFyIHJzZXNzaW9uaWRbTUFYX1NFU1NJT05JRF9TSVpFXTsK
IAogICAgIGlmICghcmV0X2JhY2tlbmQpIHsKIAlyZXQgPSB4em1hbGxvYyhzaXplb2Yoc3RydWN0
IGJhY2tlbmQpKTsKQEAgLTYwOSw2ICs2MTAsMTIgQEAKIAkJbWVjaGxpc3QgPSBwYXJzZV9jYXBh
YmlsaXR5KG15X3N0YXR1cywgcHJvdCwKIAkJCQkJCSZyZXQtPmNhcGFiaWxpdHkpOwogCSAgICB9
CisKKwkgICAgaWYgKCEoc3RyY21wKHByb3QtPnNlcnZpY2UsICJpbWFwIikgJiYKKwkJIChzdHJj
bXAocHJvdC0+c2VydmljZSwgInBvcDMiKSkpKSB7CisJCXBhcnNlX3Nlc3Npb25pZChteV9zdGF0
dXMsIHJzZXNzaW9uaWQpOworCQlzeXNsb2coTE9HX05PVElDRSwgInByb3h5ICVzIHNlc3Npb25p
ZD08JXM+IHJlbW90ZT08JXM+IiwgdXNlcmlkLCBzZXNzaW9uX2lkKCksIHJzZXNzaW9uaWQpOwor
CSAgICB9CiAJfQogCiAJaWYgKG1saXN0KSBmcmVlKG1saXN0KTsKZGlmZiAtdXJOIGN5cnVzLWlt
YXBkLTIuNC4xMy5vcmlnL2ltYXAvZ2xvYmFsLmMgY3lydXMtaW1hcGQtMi40LjEzLndiL2ltYXAv
Z2xvYmFsLmMKLS0tIGN5cnVzLWltYXBkLTIuNC4xMy5vcmlnL2ltYXAvZ2xvYmFsLmMJMjAxMS0x
Mi0zMCAxNzoyMTo1My4wMDAwMDAwMDAgKzAxMDAKKysrIGN5cnVzLWltYXBkLTIuNC4xMy53Yi9p
bWFwL2dsb2JhbC5jCTIwMTItMDEtMjMgMTM6MTc6NDkuNjA1MDI2NDM1ICswMTAwCkBAIC04MTUs
NiArODE1LDI5IEBACiAgICAgcmV0dXJuIChjb25zdCBjaGFyICopc2Vzc2lvbl9pZF9idWY7CiB9
CiAKKy8qIHBhcnNlIHNlc3Npb25pZCBvdXQgb2YgcHJvdG9jb2wgYW5zd2VycyAqLwordm9pZCBw
YXJzZV9zZXNzaW9uaWQoY29uc3QgY2hhciAqc3RyLCBjaGFyICpzZXNzaW9uaWQpCit7CisgICAg
Y2hhciAqc3AsICplcDsKKyAgICBpbnQgbGVuOworCisgICAgaWYgKChzdHIpICYmIChzcCA9IHN0
cnN0cihzdHIsICJTRVNTSU9OSUQ9PCIpKSAmJiAoZXAgPSBzdHJjaHIoc3AsICc+JykpKQorICAg
IHsKKwlzcCArPSAxMTsKKwlsZW4gPSBlcCAtIHNwOworCWlmIChsZW4gPCBNQVhfU0VTU0lPTklE
X1NJWkUpCisJeworCSAgICBzdHJuY3B5KHNlc3Npb25pZCwgc3AsIGxlbik7CisJICAgIGVwID0g
c2Vzc2lvbmlkICsgbGVuOworCSAgICAqZXAgPSAnXDAnOworCX0KKwllbHNlCisJICAgIHN0cmNw
eShzZXNzaW9uaWQsICJpbnZhbGlkIik7CisgICAgfQorICAgIGVsc2UKKwlzdHJjcHkoc2Vzc2lv
bmlkLCAidW5rbm93biIpOworfQorCiBpbnQgY2FwYV9pc19kaXNhYmxlZChjb25zdCBjaGFyICpz
dHIpCiB7CiAgICAgaWYgKCFzdXBwcmVzc2VkX2NhcGFiaWxpdGllcykgcmV0dXJuIDA7CmRpZmYg
LXVyTiBjeXJ1cy1pbWFwZC0yLjQuMTMub3JpZy9pbWFwL2ltYXBkLmMgY3lydXMtaW1hcGQtMi40
LjEzLndiL2ltYXAvaW1hcGQuYwotLS0gY3lydXMtaW1hcGQtMi40LjEzLm9yaWcvaW1hcC9pbWFw
ZC5jCTIwMTEtMTItMzAgMTc6MjE6NTMuMDAwMDAwMDAwICswMTAwCisrKyBjeXJ1cy1pbWFwZC0y
LjQuMTMud2IvaW1hcC9pbWFwZC5jCTIwMTItMDEtMjAgMjA6Mzg6MDguMzk0MDAxMTAxICswMTAw
CkBAIC0yMjQ4LDEyICsyMjQ4LDE1IEBACiAJfQogICAgIH0KICAgICBlbHNlIGlmICggbm9zYXNs
cGFzc3dkY2hlY2sgKSB7Ci0JcmVwbHkgPSAiVXNlciBsb2dnZWQgaW4iOworCXNucHJpbnRmKHJl
cGx5YnVmLCBzaXplb2YocmVwbHlidWYpLCAKKwkgICAgIlVzZXIgbG9nZ2VkIGluIFNFU1NJT05J
RD08JXM+Iiwgc2Vzc2lvbl9pZCgpKTsKKwlyZXBseSA9IHJlcGx5YnVmOwogCWltYXBkX3VzZXJp
ZCA9IHhzdHJkdXAoY2Fub25fdXNlcik7CiAJaW1hcGRfYXV0aHN0YXRlID0gYXV0aF9uZXdzdGF0
ZShjYW5vbl91c2VyKTsKIAlzeXNsb2coTE9HX05PVElDRSwgImxvZ2luOiAlcyAlcyVzIG5vcGFz
c3dvcmQlcyAlcyIsIGltYXBkX2NsaWVudGhvc3QsCiAJICAgICAgIGltYXBkX3VzZXJpZCwgaW1h
cGRfbWFnaWNwbHVzID8gaW1hcGRfbWFnaWNwbHVzIDogIiIsCi0JICAgICAgIGltYXBkX3N0YXJ0
dGxzX2RvbmUgPyAiK1RMUyIgOiAiIiwgcmVwbHkpOworCSAgICAgICBpbWFwZF9zdGFydHRsc19k
b25lID8gIitUTFMiIDogIiIsIAorCSAgICAgICByZXBseSA/IHJlcGx5IDogIiIpOwogICAgIH0K
ICAgICBlbHNlIGlmICgociA9IHNhc2xfY2hlY2twYXNzKGltYXBkX3Nhc2xjb25uLAogCQkJCSBj
YW5vbl91c2VyLApAQCAtMjM0Myw2ICsyMzQ2LDggQEAKIAogICAgIGNvbnN0IHZvaWQgKnZhbDsK
ICAgICBjaGFyICpzc2Ztc2c9TlVMTDsKKyAgICBjaGFyIHJlcGx5YnVmW01BWF9NQUlMQk9YX0JV
RkZFUl07CisgICAgY29uc3QgY2hhciAqcmVwbHkgPSBOVUxMOwogCiAgICAgY29uc3QgY2hhciAq
Y2Fub25fdXNlcjsKIApAQCAtMjQzMyw5ICsyNDM4LDEzIEBACiAJaW1hcGRfdXNlcmlkID0geHN0
cmR1cChjYW5vbl91c2VyKTsKICAgICB9CiAKKyAgICBzbnByaW50ZihyZXBseWJ1Ziwgc2l6ZW9m
KHJlcGx5YnVmKSwgCisJIlVzZXIgbG9nZ2VkIGluIFNFU1NJT05JRD08JXM+Iiwgc2Vzc2lvbl9p
ZCgpKTsKKyAgICByZXBseSA9IHJlcGx5YnVmOwogICAgIHN5c2xvZyhMT0dfTk9USUNFLCAibG9n
aW46ICVzICVzJXMgJXMlcyAlcyIsIGltYXBkX2NsaWVudGhvc3QsCiAJICAgaW1hcGRfdXNlcmlk
LCBpbWFwZF9tYWdpY3BsdXMgPyBpbWFwZF9tYWdpY3BsdXMgOiAiIiwKLQkgICBhdXRodHlwZSwg
aW1hcGRfc3RhcnR0bHNfZG9uZSA/ICIrVExTIiA6ICIiLCAiVXNlciBsb2dnZWQgaW4iKTsKKwkg
ICBhdXRodHlwZSwgaW1hcGRfc3RhcnR0bHNfZG9uZSA/ICIrVExTIiA6ICIiLCAKKwkgICByZXBs
eSA/IHJlcGx5IDogIiIpOwogCiAgICAgc2FzbF9nZXRwcm9wKGltYXBkX3Nhc2xjb25uLCBTQVNM
X1NTRiwgJnZhbCk7CiAgICAgc2FzbHByb3BzLnNzZiA9ICooKHNhc2xfc3NmX3QgKikgdmFsKTsK
QEAgLTI0NjMsOSArMjQ3MiwxMSBAQAogICAgIGlmICghc2FzbHByb3BzLnNzZikgewogCXByb3Rf
cHJpbnRmKGltYXBkX291dCwgIiVzIE9LIFtDQVBBQklMSVRZICIsIHRhZyk7CiAJY2FwYV9yZXNw
b25zZShDQVBBX1BSRUFVVEh8Q0FQQV9QT1NUQVVUSCk7Ci0JcHJvdF9wcmludGYoaW1hcGRfb3V0
LCAiXSBTdWNjZXNzICglcylcclxuIiwgc3NmbXNnKTsKKwlwcm90X3ByaW50ZihpbWFwZF9vdXQs
ICJdIFN1Y2Nlc3MgKCVzKSBTRVNTSU9OSUQ9PCVzPlxyXG4iLAorCXNzZm1zZywgc2Vzc2lvbl9p
ZCgpKTsKICAgICB9IGVsc2UgewotCXByb3RfcHJpbnRmKGltYXBkX291dCwgIiVzIE9LIFN1Y2Nl
c3MgKCVzKVxyXG4iLCB0YWcsIHNzZm1zZyk7CisJcHJvdF9wcmludGYoaW1hcGRfb3V0LCAiJXMg
T0sgU3VjY2VzcyAoJXMpIFNFU1NJT05JRD08JXM+XHJcbiIsCisJdGFnLCBzc2Ztc2csIHNlc3Np
b25faWQoKSk7CiAgICAgfQogCiAgICAgcHJvdF9zZXRzYXNsKGltYXBkX2luLCAgaW1hcGRfc2Fz
bGNvbm4pOwpkaWZmIC11ck4gY3lydXMtaW1hcGQtMi40LjEzLm9yaWcvaW1hcC9sbXRwZW5naW5l
LmMgY3lydXMtaW1hcGQtMi40LjEzLndiL2ltYXAvbG10cGVuZ2luZS5jCi0tLSBjeXJ1cy1pbWFw
ZC0yLjQuMTMub3JpZy9pbWFwL2xtdHBlbmdpbmUuYwkyMDExLTEyLTMwIDE3OjIxOjUzLjAwMDAw
MDAwMCArMDEwMAorKysgY3lydXMtaW1hcGQtMi40LjEzLndiL2ltYXAvbG10cGVuZ2luZS5jCTIw
MTItMDEtMjAgMTc6NDE6NDIuODk4MDQzMzY5ICswMTAwCkBAIC0xODYyLDE1ICsxODYyLDggQEAK
ICAgICBpZiAoIUlTR09PRChjb2RlKSkgewogCWdvdG8gZmFpbGFsbDsKICAgICB9Ci0gICAgaWYg
KChzcCA9IHN0cnN0cihidWYsICJTRVNTSU9OSUQ9PCIpKSAmJiAoZXAgPSBzdHJjaHIoc3AsICc+
JykpKQotICAgIHsKLQlzcCArPSAxMTsKLQkqZXAgPSAnXDAnOwotCXN0cm5jcHkocnNlc3Npb25p
ZCwgc3AsIE1BWF9TRVNTSU9OSURfU0laRSk7Ci0gICAgfQotICAgIGVsc2UKLSAgICAgICAgc3Ry
Y3B5KHJzZXNzaW9uaWQsICJ1bmtub3duIik7CiAKKyAgICBwYXJzZV9zZXNzaW9uaWQoYnVmLCBy
c2Vzc2lvbmlkKTsKICAgICBpZiAoY29uZmlnX2F1ZGl0bG9nKQogCXN5c2xvZyhMT0dfTk9USUNF
LCAiYXVkaXRsb2c6IHByb3h5IHNlc3Npb25pZD08JXM+IHJlbW90ZT08JXM+Iiwgc2Vzc2lvbl9p
ZCgpLCByc2Vzc2lvbmlkKTsKIApkaWZmIC11ck4gY3lydXMtaW1hcGQtMi40LjEzLm9yaWcvaW1h
cC9wb3AzZC5jIGN5cnVzLWltYXBkLTIuNC4xMy53Yi9pbWFwL3BvcDNkLmMKLS0tIGN5cnVzLWlt
YXBkLTIuNC4xMy5vcmlnL2ltYXAvcG9wM2QuYwkyMDExLTEyLTMwIDE3OjIxOjUzLjAwMDAwMDAw
MCArMDEwMAorKysgY3lydXMtaW1hcGQtMi40LjEzLndiL2ltYXAvcG9wM2QuYwkyMDEyLTAxLTIw
IDIxOjU0OjIyLjE3OTAxMTk0NyArMDEwMApAQCAtMTM0OCw5ICsxMzQ4LDkgQEAKICAgICB9CiAg
ICAgcG9wZF91c2VyaWQgPSB4c3RyZHVwKChjb25zdCBjaGFyICopIGNhbm9uX3VzZXIpOwogICAg
IAotICAgIHN5c2xvZyhMT0dfTk9USUNFLCAibG9naW46ICVzICVzJXMgQVBPUCVzICVzIiwgcG9w
ZF9jbGllbnRob3N0LAorICAgIHN5c2xvZyhMT0dfTk9USUNFLCAibG9naW46ICVzICVzJXMgQVBP
UCVzICVzIFNFU1NJT05JRD08JXM+IiwgcG9wZF9jbGllbnRob3N0LAogCSAgIHBvcGRfdXNlcmlk
LCBwb3BkX3N1YmZvbGRlciA/IHBvcGRfc3ViZm9sZGVyIDogIiIsCi0JICAgcG9wZF9zdGFydHRs
c19kb25lID8gIitUTFMiIDogIiIsICJVc2VyIGxvZ2dlZCBpbiIpOworCSAgIHBvcGRfc3RhcnR0
bHNfZG9uZSA/ICIrVExTIiA6ICIiLCAiVXNlciBsb2dnZWQgaW4iLCBzZXNzaW9uX2lkKCkpOwog
CiAgICAgcG9wZF9hdXRoc3RhdGUgPSBhdXRoX25ld3N0YXRlKHBvcGRfdXNlcmlkKTsKIApAQCAt
MTQxNyw5ICsxNDE3LDkgQEAKIAkgICAgcmV0dXJuOwogCX0KIAotCXN5c2xvZyhMT0dfTk9USUNF
LCAibG9naW46ICVzICVzJXMgS1BPUCVzICVzIiwgcG9wZF9jbGllbnRob3N0LAorCXN5c2xvZyhM
T0dfTk9USUNFLCAibG9naW46ICVzICVzJXMgS1BPUCVzICVzIFNFU1NJT05JRD08JXM+IiwgcG9w
ZF9jbGllbnRob3N0LAogCSAgICAgICBwb3BkX3VzZXJpZCwgcG9wZF9zdWJmb2xkZXIgPyBwb3Bk
X3N1YmZvbGRlciA6ICIiLAotCSAgICAgICBwb3BkX3N0YXJ0dGxzX2RvbmUgPyAiK1RMUyIgOiAi
IiwgIlVzZXIgbG9nZ2VkIGluIik7CisJICAgICAgIHBvcGRfc3RhcnR0bHNfZG9uZSA/ICIrVExT
IiA6ICIiLCAiVXNlciBsb2dnZWQgaW4iLCBzZXNzaW9uX2lkKCkpOwogCiAJb3BlbmluYm94KCk7
CiAJcmV0dXJuOwpAQCAtMTY4Nyw5ICsxNjg3LDkgQEAKICAgICB9IGVsc2UgewogCXBvcGRfdXNl
cmlkID0geHN0cmR1cChjYW5vbl91c2VyKTsKICAgICB9Ci0gICAgc3lzbG9nKExPR19OT1RJQ0Us
ICJsb2dpbjogJXMgJXMlcyAlcyVzICVzIiwgcG9wZF9jbGllbnRob3N0LAorICAgIHN5c2xvZyhM
T0dfTk9USUNFLCAibG9naW46ICVzICVzJXMgJXMlcyAlcyBTRVNTSU9OSUQ9PCVzPiIsIHBvcGRf
Y2xpZW50aG9zdCwKIAkgICBwb3BkX3VzZXJpZCwgcG9wZF9zdWJmb2xkZXIgPyBwb3BkX3N1YmZv
bGRlciA6ICIiLAotCSAgIGF1dGh0eXBlLCBwb3BkX3N0YXJ0dGxzX2RvbmUgPyAiK1RMUyIgOiAi
IiwgIlVzZXIgbG9nZ2VkIGluIik7CisJICAgYXV0aHR5cGUsIHBvcGRfc3RhcnR0bHNfZG9uZSA/
ICIrVExTIiA6ICIiLCAiVXNlciBsb2dnZWQgaW4iLCBzZXNzaW9uX2lkKCkpOwogCiAgICAgc2Fz
bF9nZXRwcm9wKHBvcGRfc2FzbGNvbm4sIFNBU0xfU1NGLCAmdmFsKTsKICAgICBzYXNscHJvcHMu
c3NmID0gKigoc2FzbF9zc2ZfdCAqKSB2YWwpOwo=
</data>        

          </attachment>
          <attachment
              isobsolete="0"
              ispatch="1"
              isprivate="0"
          >
            <attachid>1456</attachid>
            <date>2012-01-23 07:29 EDT</date>
            <desc>sessionid logging improvements</desc>
            <filename>cyrus-imapd-2.4.13-sessionid.patch</filename>
            <type>text/plain</type>
            <size>6269</size>
            <attacher>wbreyha@gmx.net</attacher>
            
              <data encoding="base64">ZGlmZiAtdXJOIGN5cnVzLWltYXBkLTIuNC4xMy5vcmlnL2ltYXAvYmFja2VuZC5jIGN5cnVzLWlt
YXBkLTIuNC4xMy53Yi9pbWFwL2JhY2tlbmQuYwotLS0gY3lydXMtaW1hcGQtMi40LjEzLm9yaWcv
aW1hcC9iYWNrZW5kLmMJMjAxMS0xMi0zMCAyMjoxOToxOC4wMDAwMDAwMDAgKzAxMDAKKysrIGN5
cnVzLWltYXBkLTIuNC4xMy53Yi9pbWFwL2JhY2tlbmQuYwkyMDEyLTAxLTIwIDIyOjMwOjQ1LjU5
MzAyNzkyMSArMDEwMApAQCAtNDE0LDYgKzQxNCw3IEBACiAgICAgY2hhciBidWZbMjA0OF0sICpt
ZWNobGlzdCA9IE5VTEw7CiAgICAgc3RydWN0IHNpZ2FjdGlvbiBhY3Rpb247CiAgICAgc3RydWN0
IGJhY2tlbmQgKnJldDsKKyAgICBjaGFyIHJzZXNzaW9uaWRbTUFYX1NFU1NJT05JRF9TSVpFXTsK
IAogICAgIGlmICghcmV0X2JhY2tlbmQpIHsKIAlyZXQgPSB4em1hbGxvYyhzaXplb2Yoc3RydWN0
IGJhY2tlbmQpKTsKQEAgLTYwOSw2ICs2MTAsMTIgQEAKIAkJbWVjaGxpc3QgPSBwYXJzZV9jYXBh
YmlsaXR5KG15X3N0YXR1cywgcHJvdCwKIAkJCQkJCSZyZXQtPmNhcGFiaWxpdHkpOwogCSAgICB9
CisKKwkgICAgaWYgKCEoc3RyY21wKHByb3QtPnNlcnZpY2UsICJpbWFwIikgJiYKKwkJIChzdHJj
bXAocHJvdC0+c2VydmljZSwgInBvcDMiKSkpKSB7CisJCXBhcnNlX3Nlc3Npb25pZChteV9zdGF0
dXMsIHJzZXNzaW9uaWQpOworCQlzeXNsb2coTE9HX05PVElDRSwgInByb3h5ICVzIHNlc3Npb25p
ZD08JXM+IHJlbW90ZT08JXM+IiwgdXNlcmlkLCBzZXNzaW9uX2lkKCksIHJzZXNzaW9uaWQpOwor
CSAgICB9CiAJfQogCiAJaWYgKG1saXN0KSBmcmVlKG1saXN0KTsKZGlmZiAtdXJOIGN5cnVzLWlt
YXBkLTIuNC4xMy5vcmlnL2ltYXAvZ2xvYmFsLmMgY3lydXMtaW1hcGQtMi40LjEzLndiL2ltYXAv
Z2xvYmFsLmMKLS0tIGN5cnVzLWltYXBkLTIuNC4xMy5vcmlnL2ltYXAvZ2xvYmFsLmMJMjAxMS0x
Mi0zMCAxNzoyMTo1My4wMDAwMDAwMDAgKzAxMDAKKysrIGN5cnVzLWltYXBkLTIuNC4xMy53Yi9p
bWFwL2dsb2JhbC5jCTIwMTItMDEtMjMgMTM6MTc6NDkuNjA1MDI2NDM1ICswMTAwCkBAIC04MTUs
NiArODE1LDI5IEBACiAgICAgcmV0dXJuIChjb25zdCBjaGFyICopc2Vzc2lvbl9pZF9idWY7CiB9
CiAKKy8qIHBhcnNlIHNlc3Npb25pZCBvdXQgb2YgcHJvdG9jb2wgYW5zd2VycyAqLwordm9pZCBw
YXJzZV9zZXNzaW9uaWQoY29uc3QgY2hhciAqc3RyLCBjaGFyICpzZXNzaW9uaWQpCit7CisgICAg
Y2hhciAqc3AsICplcDsKKyAgICBpbnQgbGVuOworCisgICAgaWYgKChzdHIpICYmIChzcCA9IHN0
cnN0cihzdHIsICJTRVNTSU9OSUQ9PCIpKSAmJiAoZXAgPSBzdHJjaHIoc3AsICc+JykpKQorICAg
IHsKKwlzcCArPSAxMTsKKwlsZW4gPSBlcCAtIHNwOworCWlmIChsZW4gPCBNQVhfU0VTU0lPTklE
X1NJWkUpCisJeworCSAgICBzdHJuY3B5KHNlc3Npb25pZCwgc3AsIGxlbik7CisJICAgIGVwID0g
c2Vzc2lvbmlkICsgbGVuOworCSAgICAqZXAgPSAnXDAnOworCX0KKwllbHNlCisJICAgIHN0cmNw
eShzZXNzaW9uaWQsICJpbnZhbGlkIik7CisgICAgfQorICAgIGVsc2UKKwlzdHJjcHkoc2Vzc2lv
bmlkLCAidW5rbm93biIpOworfQorCiBpbnQgY2FwYV9pc19kaXNhYmxlZChjb25zdCBjaGFyICpz
dHIpCiB7CiAgICAgaWYgKCFzdXBwcmVzc2VkX2NhcGFiaWxpdGllcykgcmV0dXJuIDA7CmRpZmYg
LXVyTiBjeXJ1cy1pbWFwZC0yLjQuMTMub3JpZy9pbWFwL2ltYXBkLmMgY3lydXMtaW1hcGQtMi40
LjEzLndiL2ltYXAvaW1hcGQuYwotLS0gY3lydXMtaW1hcGQtMi40LjEzLm9yaWcvaW1hcC9pbWFw
ZC5jCTIwMTEtMTItMzAgMTc6MjE6NTMuMDAwMDAwMDAwICswMTAwCisrKyBjeXJ1cy1pbWFwZC0y
LjQuMTMud2IvaW1hcC9pbWFwZC5jCTIwMTItMDEtMjAgMjA6Mzg6MDguMzk0MDAxMTAxICswMTAw
CkBAIC0yMjQ4LDEyICsyMjQ4LDE1IEBACiAJfQogICAgIH0KICAgICBlbHNlIGlmICggbm9zYXNs
cGFzc3dkY2hlY2sgKSB7Ci0JcmVwbHkgPSAiVXNlciBsb2dnZWQgaW4iOworCXNucHJpbnRmKHJl
cGx5YnVmLCBzaXplb2YocmVwbHlidWYpLCAKKwkgICAgIlVzZXIgbG9nZ2VkIGluIFNFU1NJT05J
RD08JXM+Iiwgc2Vzc2lvbl9pZCgpKTsKKwlyZXBseSA9IHJlcGx5YnVmOwogCWltYXBkX3VzZXJp
ZCA9IHhzdHJkdXAoY2Fub25fdXNlcik7CiAJaW1hcGRfYXV0aHN0YXRlID0gYXV0aF9uZXdzdGF0
ZShjYW5vbl91c2VyKTsKIAlzeXNsb2coTE9HX05PVElDRSwgImxvZ2luOiAlcyAlcyVzIG5vcGFz
c3dvcmQlcyAlcyIsIGltYXBkX2NsaWVudGhvc3QsCiAJICAgICAgIGltYXBkX3VzZXJpZCwgaW1h
cGRfbWFnaWNwbHVzID8gaW1hcGRfbWFnaWNwbHVzIDogIiIsCi0JICAgICAgIGltYXBkX3N0YXJ0
dGxzX2RvbmUgPyAiK1RMUyIgOiAiIiwgcmVwbHkpOworCSAgICAgICBpbWFwZF9zdGFydHRsc19k
b25lID8gIitUTFMiIDogIiIsIAorCSAgICAgICByZXBseSA/IHJlcGx5IDogIiIpOwogICAgIH0K
ICAgICBlbHNlIGlmICgociA9IHNhc2xfY2hlY2twYXNzKGltYXBkX3Nhc2xjb25uLAogCQkJCSBj
YW5vbl91c2VyLApAQCAtMjM0Myw2ICsyMzQ2LDggQEAKIAogICAgIGNvbnN0IHZvaWQgKnZhbDsK
ICAgICBjaGFyICpzc2Ztc2c9TlVMTDsKKyAgICBjaGFyIHJlcGx5YnVmW01BWF9NQUlMQk9YX0JV
RkZFUl07CisgICAgY29uc3QgY2hhciAqcmVwbHkgPSBOVUxMOwogCiAgICAgY29uc3QgY2hhciAq
Y2Fub25fdXNlcjsKIApAQCAtMjQzMyw5ICsyNDM4LDEzIEBACiAJaW1hcGRfdXNlcmlkID0geHN0
cmR1cChjYW5vbl91c2VyKTsKICAgICB9CiAKKyAgICBzbnByaW50ZihyZXBseWJ1Ziwgc2l6ZW9m
KHJlcGx5YnVmKSwgCisJIlVzZXIgbG9nZ2VkIGluIFNFU1NJT05JRD08JXM+Iiwgc2Vzc2lvbl9p
ZCgpKTsKKyAgICByZXBseSA9IHJlcGx5YnVmOwogICAgIHN5c2xvZyhMT0dfTk9USUNFLCAibG9n
aW46ICVzICVzJXMgJXMlcyAlcyIsIGltYXBkX2NsaWVudGhvc3QsCiAJICAgaW1hcGRfdXNlcmlk
LCBpbWFwZF9tYWdpY3BsdXMgPyBpbWFwZF9tYWdpY3BsdXMgOiAiIiwKLQkgICBhdXRodHlwZSwg
aW1hcGRfc3RhcnR0bHNfZG9uZSA/ICIrVExTIiA6ICIiLCAiVXNlciBsb2dnZWQgaW4iKTsKKwkg
ICBhdXRodHlwZSwgaW1hcGRfc3RhcnR0bHNfZG9uZSA/ICIrVExTIiA6ICIiLCAKKwkgICByZXBs
eSA/IHJlcGx5IDogIiIpOwogCiAgICAgc2FzbF9nZXRwcm9wKGltYXBkX3Nhc2xjb25uLCBTQVNM
X1NTRiwgJnZhbCk7CiAgICAgc2FzbHByb3BzLnNzZiA9ICooKHNhc2xfc3NmX3QgKikgdmFsKTsK
QEAgLTI0NjMsOSArMjQ3MiwxMSBAQAogICAgIGlmICghc2FzbHByb3BzLnNzZikgewogCXByb3Rf
cHJpbnRmKGltYXBkX291dCwgIiVzIE9LIFtDQVBBQklMSVRZICIsIHRhZyk7CiAJY2FwYV9yZXNw
b25zZShDQVBBX1BSRUFVVEh8Q0FQQV9QT1NUQVVUSCk7Ci0JcHJvdF9wcmludGYoaW1hcGRfb3V0
LCAiXSBTdWNjZXNzICglcylcclxuIiwgc3NmbXNnKTsKKwlwcm90X3ByaW50ZihpbWFwZF9vdXQs
ICJdIFN1Y2Nlc3MgKCVzKSBTRVNTSU9OSUQ9PCVzPlxyXG4iLAorCXNzZm1zZywgc2Vzc2lvbl9p
ZCgpKTsKICAgICB9IGVsc2UgewotCXByb3RfcHJpbnRmKGltYXBkX291dCwgIiVzIE9LIFN1Y2Nl
c3MgKCVzKVxyXG4iLCB0YWcsIHNzZm1zZyk7CisJcHJvdF9wcmludGYoaW1hcGRfb3V0LCAiJXMg
T0sgU3VjY2VzcyAoJXMpIFNFU1NJT05JRD08JXM+XHJcbiIsCisJdGFnLCBzc2Ztc2csIHNlc3Np
b25faWQoKSk7CiAgICAgfQogCiAgICAgcHJvdF9zZXRzYXNsKGltYXBkX2luLCAgaW1hcGRfc2Fz
bGNvbm4pOwpkaWZmIC11ck4gY3lydXMtaW1hcGQtMi40LjEzLm9yaWcvaW1hcC9sbXRwZW5naW5l
LmMgY3lydXMtaW1hcGQtMi40LjEzLndiL2ltYXAvbG10cGVuZ2luZS5jCi0tLSBjeXJ1cy1pbWFw
ZC0yLjQuMTMub3JpZy9pbWFwL2xtdHBlbmdpbmUuYwkyMDExLTEyLTMwIDE3OjIxOjUzLjAwMDAw
MDAwMCArMDEwMAorKysgY3lydXMtaW1hcGQtMi40LjEzLndiL2ltYXAvbG10cGVuZ2luZS5jCTIw
MTItMDEtMjMgMTM6Mjg6MDEuNTgxMDI2Nzk5ICswMTAwCkBAIC0xODYyLDE3ICsxODYyLDExIEBA
CiAgICAgaWYgKCFJU0dPT0QoY29kZSkpIHsKIAlnb3RvIGZhaWxhbGw7CiAgICAgfQotICAgIGlm
ICgoc3AgPSBzdHJzdHIoYnVmLCAiU0VTU0lPTklEPTwiKSkgJiYgKGVwID0gc3RyY2hyKHNwLCAn
PicpKSkKLSAgICB7Ci0Jc3AgKz0gMTE7Ci0JKmVwID0gJ1wwJzsKLQlzdHJuY3B5KHJzZXNzaW9u
aWQsIHNwLCBNQVhfU0VTU0lPTklEX1NJWkUpOwotICAgIH0KLSAgICBlbHNlCi0gICAgICAgIHN0
cmNweShyc2Vzc2lvbmlkLCAidW5rbm93biIpOwogCi0gICAgaWYgKGNvbmZpZ19hdWRpdGxvZykK
KyAgICBpZiAoY29uZmlnX2F1ZGl0bG9nKSB7CisgICAgICAgIHBhcnNlX3Nlc3Npb25pZChidWYs
IHJzZXNzaW9uaWQpOwogCXN5c2xvZyhMT0dfTk9USUNFLCAiYXVkaXRsb2c6IHByb3h5IHNlc3Np
b25pZD08JXM+IHJlbW90ZT08JXM+Iiwgc2Vzc2lvbl9pZCgpLCByc2Vzc2lvbmlkKTsKKyAgICB9
CiAKICAgICAvKiBtYWlsIGZyb20gKi8KICAgICBpZiAoIXR4bi0+ZnJvbSkgewpkaWZmIC11ck4g
Y3lydXMtaW1hcGQtMi40LjEzLm9yaWcvaW1hcC9wb3AzZC5jIGN5cnVzLWltYXBkLTIuNC4xMy53
Yi9pbWFwL3BvcDNkLmMKLS0tIGN5cnVzLWltYXBkLTIuNC4xMy5vcmlnL2ltYXAvcG9wM2QuYwky
MDExLTEyLTMwIDE3OjIxOjUzLjAwMDAwMDAwMCArMDEwMAorKysgY3lydXMtaW1hcGQtMi40LjEz
LndiL2ltYXAvcG9wM2QuYwkyMDEyLTAxLTIwIDIxOjU0OjIyLjE3OTAxMTk0NyArMDEwMApAQCAt
MTM0OCw5ICsxMzQ4LDkgQEAKICAgICB9CiAgICAgcG9wZF91c2VyaWQgPSB4c3RyZHVwKChjb25z
dCBjaGFyICopIGNhbm9uX3VzZXIpOwogICAgIAotICAgIHN5c2xvZyhMT0dfTk9USUNFLCAibG9n
aW46ICVzICVzJXMgQVBPUCVzICVzIiwgcG9wZF9jbGllbnRob3N0LAorICAgIHN5c2xvZyhMT0df
Tk9USUNFLCAibG9naW46ICVzICVzJXMgQVBPUCVzICVzIFNFU1NJT05JRD08JXM+IiwgcG9wZF9j
bGllbnRob3N0LAogCSAgIHBvcGRfdXNlcmlkLCBwb3BkX3N1YmZvbGRlciA/IHBvcGRfc3ViZm9s
ZGVyIDogIiIsCi0JICAgcG9wZF9zdGFydHRsc19kb25lID8gIitUTFMiIDogIiIsICJVc2VyIGxv
Z2dlZCBpbiIpOworCSAgIHBvcGRfc3RhcnR0bHNfZG9uZSA/ICIrVExTIiA6ICIiLCAiVXNlciBs
b2dnZWQgaW4iLCBzZXNzaW9uX2lkKCkpOwogCiAgICAgcG9wZF9hdXRoc3RhdGUgPSBhdXRoX25l
d3N0YXRlKHBvcGRfdXNlcmlkKTsKIApAQCAtMTQxNyw5ICsxNDE3LDkgQEAKIAkgICAgcmV0dXJu
OwogCX0KIAotCXN5c2xvZyhMT0dfTk9USUNFLCAibG9naW46ICVzICVzJXMgS1BPUCVzICVzIiwg
cG9wZF9jbGllbnRob3N0LAorCXN5c2xvZyhMT0dfTk9USUNFLCAibG9naW46ICVzICVzJXMgS1BP
UCVzICVzIFNFU1NJT05JRD08JXM+IiwgcG9wZF9jbGllbnRob3N0LAogCSAgICAgICBwb3BkX3Vz
ZXJpZCwgcG9wZF9zdWJmb2xkZXIgPyBwb3BkX3N1YmZvbGRlciA6ICIiLAotCSAgICAgICBwb3Bk
X3N0YXJ0dGxzX2RvbmUgPyAiK1RMUyIgOiAiIiwgIlVzZXIgbG9nZ2VkIGluIik7CisJICAgICAg
IHBvcGRfc3RhcnR0bHNfZG9uZSA/ICIrVExTIiA6ICIiLCAiVXNlciBsb2dnZWQgaW4iLCBzZXNz
aW9uX2lkKCkpOwogCiAJb3BlbmluYm94KCk7CiAJcmV0dXJuOwpAQCAtMTY4Nyw5ICsxNjg3LDkg
QEAKICAgICB9IGVsc2UgewogCXBvcGRfdXNlcmlkID0geHN0cmR1cChjYW5vbl91c2VyKTsKICAg
ICB9Ci0gICAgc3lzbG9nKExPR19OT1RJQ0UsICJsb2dpbjogJXMgJXMlcyAlcyVzICVzIiwgcG9w
ZF9jbGllbnRob3N0LAorICAgIHN5c2xvZyhMT0dfTk9USUNFLCAibG9naW46ICVzICVzJXMgJXMl
cyAlcyBTRVNTSU9OSUQ9PCVzPiIsIHBvcGRfY2xpZW50aG9zdCwKIAkgICBwb3BkX3VzZXJpZCwg
cG9wZF9zdWJmb2xkZXIgPyBwb3BkX3N1YmZvbGRlciA6ICIiLAotCSAgIGF1dGh0eXBlLCBwb3Bk
X3N0YXJ0dGxzX2RvbmUgPyAiK1RMUyIgOiAiIiwgIlVzZXIgbG9nZ2VkIGluIik7CisJICAgYXV0
aHR5cGUsIHBvcGRfc3RhcnR0bHNfZG9uZSA/ICIrVExTIiA6ICIiLCAiVXNlciBsb2dnZWQgaW4i
LCBzZXNzaW9uX2lkKCkpOwogCiAgICAgc2FzbF9nZXRwcm9wKHBvcGRfc2FzbGNvbm4sIFNBU0xf
U1NGLCAmdmFsKTsKICAgICBzYXNscHJvcHMuc3NmID0gKigoc2FzbF9zc2ZfdCAqKSB2YWwpOwo=
</data>        

          </attachment>
      

    </bug>

</bugzilla>