<?xml version="1.0" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugzilla.cyrusimap.org/bugzilla.dtd">

<bugzilla version="3.2.5.1-2"
          urlbase="https://bugzilla.cyrusimap.org/"
          maintainer="Dave McMurtrie &lt;dave64@andrew.cmu.edu&gt;"
>

    <bug>
          <bug_id>3299</bug_id>
          
          <creation_ts>2010-10-31 09:21 EDT</creation_ts>
          <short_desc>sync_client crash in response_parse</short_desc>
          <delta_ts>2010-11-05 09:43:06 EDT</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Cyrus IMAP</product>
          <component>Replication</component>
          <version>2.4.2</version>
          <rep_platform>PC</rep_platform>
          <op_sys>Solaris</op_sys>
          <bug_status>CLOSED</bug_status>
          <resolution>FIXED</resolution>
          
          
          
          
          <priority>P1</priority>
          <bug_severity>blocker</bug_severity>
          <target_milestone>2.4.3</target_milestone>
          
          
          
          <everconfirmed>1</everconfirmed>
          <reporter>cyrus@fiddaman.net</reporter>
          <assigned_to name="Bron Gondwana">brong@fastmail.fm</assigned_to>
          <cc>vanmeeuwen@kolabsys.com</cc>
          <qa_contact name="The Cyrus Bugzilla List">cyrus-bugzilla@lists.andrew.cmu.edu</qa_contact>

      

      

      
          <long_desc isprivate="0">
            <who name="">cyrus@fiddaman.net</who>
            <bug_when>2010-10-31 09:21:19 EDT</bug_when>
            <thetext>I&apos;m getting occasional crashes from sync_client, it seems to recover okay when it is restarted afterwards. Here&apos;s a stack trace:

Core was generated by `/opt/cyrus/bin/sync_client -r -o&apos;.
Program terminated with signal 11, Segmentation fault.
[New process 93321    ]
#0  0x0000000000419d0e in response_parse (cmd=0x46f92d &quot;MAILBOXES&quot;, 
    folder_list=0x5a5a80, sub_list=0x0, sieve_list=0x0, seen_list=0x0, 
    quota_list=0x0) at sync_client.c:381
381         for (kl = kin-&gt;head; kl; kl = kl-&gt;next) {
(gdb) where
#0  0x0000000000419d0e in response_parse (cmd=0x46f92d &quot;MAILBOXES&quot;, 
    folder_list=0x5a5a80, sub_list=0x0, sieve_list=0x0, seen_list=0x0, 
    quota_list=0x0) at sync_client.c:381
#1  0x000000000041cf18 in do_mailboxes (mboxname_list=0x5a58d0)
    at sync_client.c:1589
#2  0x000000000041e8b2 in do_sync (
    filename=0x59f110 &quot;/data/cyrus/config/sync/log-12226&quot;)
    at sync_client.c:2199
#3  0x000000000041ee2c in do_daemon_work (
    sync_log_file=0xfffffd7fffdfed50 &quot;/data/cyrus/config/sync/log&quot;, 
    sync_shutdown_file=0x0, timeout=600, min_delta=1, 
    restartp=0xfffffd7fffdfe700) at sync_client.c:2358
#4  0x000000000041f42d in do_daemon (
    sync_log_file=0xfffffd7fffdfed50 &quot;/data/cyrus/config/sync/log&quot;, 
    sync_shutdown_file=0x0, timeout=600, min_delta=1, be=0x59d950, cb=0x59d8c0)
    at sync_client.c:2546
#5  0x0000000000420227 in main (argc=3, argv=0xfffffd7fffdffdf8)
    at sync_client.c:2892
(gdb) print kl
$1 = (struct dlist *) 0xfffffd7ffeed9efc
(gdb) print kin
$2 = (struct dlist *) 0x0
(gdb) list

I&apos;ll keep a hold of a core file in case you need anything else.</thetext>
          </long_desc>
          <long_desc isprivate="0">
            <who name="Jeroen van Meeuwen (Kolab Systems)">vanmeeuwen@kolabsys.com</who>
            <bug_when>2010-10-31 09:29:16 EDT</bug_when>
            <thetext>Thanks for logging, Andy. Assigning to Bron and blocking 2.4-next release</thetext>
          </long_desc>
          <long_desc isprivate="0">
            <who name="Bron Gondwana">brong@fastmail.fm</who>
            <bug_when>2010-11-05 08:50:04 EDT</bug_when>
            <thetext>I&apos;m pretty sure this is fixed by this commit:

http://git.cyrusimap.org/cyrus-imapd/commit/?id=640d6ebdbef10270f2e7bf848c32c0b39516a0a5

Innocent looking sucker, isn&apos;t it.  I&apos;m going to mark this resolved in 2.4.3 - feel free to re-open if you can re-create it after we release!

(there are a couple of side issues here - the underlying cause was probably a corrupted file on the far end getting &quot;RESERVED&quot; for a copy, and then turning out to not match the sha1 when it actually gets parsed)  There are separate fixes for that as well in 2.4.3.  We managed to recreate this at FastMail quite convincingly when we had a disk corruption on one replica!</thetext>
          </long_desc>
          <long_desc isprivate="0">
            <who name="Jeroen van Meeuwen (Kolab Systems)">vanmeeuwen@kolabsys.com</who>
            <bug_when>2010-11-05 09:43:06 EDT</bug_when>
            <thetext>Closing ticket</thetext>
          </long_desc>
      
      

    </bug>

</bugzilla>