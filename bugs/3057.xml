<?xml version="1.0" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugzilla.cyrusimap.org/bugzilla.dtd">

<bugzilla version="3.2.5.1-2"
          urlbase="https://bugzilla.cyrusimap.org/"
          maintainer="Dave McMurtrie &lt;dave64@andrew.cmu.edu&gt;"
>

    <bug>
          <bug_id>3057</bug_id>
          
          <creation_ts>2008-04-18 10:07 EDT</creation_ts>
          <short_desc>Only return IMAP_QUOTA_EXCEEDED if needed</short_desc>
          <delta_ts>2011-09-25 04:54:26 EDT</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Cyrus IMAP</product>
          <component>Sieve</component>
          <version>2.3.x</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>ASSIGNED</bug_status>
          
          
          
          
          
          <priority>P3</priority>
          <bug_severity>enhancement</bug_severity>
          <target_milestone>Future</target_milestone>
          
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Michael Menge">michael.menge@zdv.uni-tuebingen.de</reporter>
          <assigned_to name="Bron Gondwana">brong@fastmail.fm</assigned_to>
          <cc>wes@umich.edu</cc>
          

      

      

      
          <long_desc isprivate="0">
            <who name="Michael Menge">michael.menge@zdv.uni-tuebingen.de</who>
            <bug_when>2008-04-18 10:07:50 EDT</bug_when>
            <thetext>Created an attachment (id=1000)
Patch for Cyrus Imapd 2.3.11

Cyrus checks quota bevor parsing the sieve-script and returns IMAP_QUOTA_EXCEEDED
even if the e-Mail is not stored. This results e.g. in bounces for spams that would have been discarded in the sieve-script.

The Attached patch checks the quota between evaluating the script and performing the action. It will perform no action and return IMAP_QUOTA_EXCEEDED if the script would perform an fileinto or keep action that would cause IMAP_QUOTA_EXCEEDED

This patch was only tested in a non-Murder-Setup</thetext>
          </long_desc>
          <long_desc isprivate="0">
            <who name="Ken Murchison">murch@andrew.cmu.edu</who>
            <bug_when>2008-04-18 10:19:24 EDT</bug_when>
            <thetext>I think we&apos;ll hold off on this change until 2.3.13</thetext>
          </long_desc>
          <long_desc isprivate="0">
            <who name="Michael Menge">michael.menge@zdv.uni-tuebingen.de</who>
            <bug_when>2009-11-25 05:26:31 EDT</bug_when>
            <thetext>Created an attachment (id=1238)
New version of the patch for Cyrus Imapd 2.3.15

Changes between versions

- Adds option sieve_quota to imapd.conf
- Don&apos;t use quota transactions  </thetext>
          </long_desc>
          <long_desc isprivate="0">
            <who name="Bron Gondwana">brong@fastmail.fm</who>
            <bug_when>2011-05-18 09:49:41 EDT</bug_when>
            <thetext>Taking over all quota-related tickets</thetext>
          </long_desc>
          <long_desc isprivate="0">
            <who name="Bron Gondwana">brong@fastmail.fm</who>
            <bug_when>2011-05-26 10:27:49 EDT</bug_when>
            <thetext>This would be great to have, but not for 2.4.9 - too much else going in!</thetext>
          </long_desc>
          <long_desc isprivate="0">
            <who name="Bron Gondwana">brong@fastmail.fm</who>
            <bug_when>2011-06-29 08:29:02 EDT</bug_when>
            <thetext>Is there actually any reason to check the quota up-front before processing, since we can always fail at the actual &quot;fileinto&quot; stage anyway.</thetext>
          </long_desc>
          <long_desc isprivate="0">
            <who name="Michael Menge">michael.menge@zdv.uni-tuebingen.de</who>
            <bug_when>2011-06-29 09:21:21 EDT</bug_when>
            <thetext>If we fail at the &quot;fileinto&quot; stage we might have done some actions. This 
would lead to partially executed scripts with MDN beeing send for mails 
where the recipient did recieve a copy (folder with other quotaroot or 
redirect).

Although RFC 3028 does not require atomic script execution (2.10.6) 
we would be required to notify the user which actions where taken. 

(The implicit keep would lead to ad absurdum the purpose of quota).</thetext>
          </long_desc>
          <long_desc isprivate="0">
            <who name="Bron Gondwana">brong@fastmail.fm</who>
            <bug_when>2011-09-25 04:54:26 EDT</bug_when>
            <thetext>Actually, it&apos;s complex - pushing off past 2.4.</thetext>
          </long_desc>
      
          <attachment
              isobsolete="1"
              ispatch="1"
              isprivate="0"
          >
            <attachid>1000</attachid>
            <date>2008-04-18 10:07 EDT</date>
            <desc>Patch for Cyrus Imapd 2.3.11</desc>
            <filename>sieve_quota.patch</filename>
            <type>text/plain</type>
            <size>13367</size>
            <attacher>michael.menge@zdv.uni-tuebingen.de</attacher>
            
              <data encoding="base64">ZGlmZiAteCAnTWFrZWZpbGUqJyAteCAnKn4qfionIC11IC1yIGN5cnVzLWltYXBkLTIuMy4xMS5v
cmcvaW1hcC9sbXRwZC5jIGN5cnVzLWltYXBkLTIuMy4xMS9pbWFwL2xtdHBkLmMKLS0tIGN5cnVz
LWltYXBkLTIuMy4xMS5vcmcvaW1hcC9sbXRwZC5jCTIwMDgtMDMtMjcgMTM6NDE6NDAuMDAwMDAw
MDAwICswMTAwCisrKyBjeXJ1cy1pbWFwZC0yLjMuMTEvaW1hcC9sbXRwZC5jCTIwMDgtMDQtMTgg
MTA6MTY6NTAuMDAwMDAwMDAwICswMjAwCkBAIC0xMDIxLDEwICsxMDIxLDkgQEAKIAkJICAgIElN
QVBfUEVSTUlTU0lPTl9ERU5JRUQgOiBJTUFQX01BSUxCT1hfTk9ORVhJU1RFTlQ7CiAJICAgIH0K
IAl9IGVsc2UgaWYgKCFyKSB7CisJICAvLyBxdW90YSB3aWxsIGJlIGNoZWNrZWQgbGF0ZXIgCiAJ
ICAgIHIgPSBhcHBlbmRfY2hlY2sobmFtZWJ1ZiwgTUFJTEJPWF9GT1JNQVRfTk9STUFMLCBhdXRo
c3RhdGUsCi0JCQkgICAgIGFjbGNoZWNrLCAocXVvdGFjaGVjayA8IDApCi0JCQkgICAgIHx8IGNv
bmZpZ19nZXRzd2l0Y2goSU1BUE9QVF9MTVRQX1NUUklDVF9RVU9UQSkgPwotCQkJICAgICBxdW90
YWNoZWNrIDogMCk7CisJCQkgICAgIGFjbGNoZWNrLCAtMSk7CiAJfQogICAgIH0KIApkaWZmIC14
ICdNYWtlZmlsZSonIC14ICcqfip+KicgLXUgLXIgY3lydXMtaW1hcGQtMi4zLjExLm9yZy9pbWFw
L2xtdHBlbmdpbmUuYyBjeXJ1cy1pbWFwZC0yLjMuMTEvaW1hcC9sbXRwZW5naW5lLmMKLS0tIGN5
cnVzLWltYXBkLTIuMy4xMS5vcmcvaW1hcC9sbXRwZW5naW5lLmMJMjAwOC0wMy0yNyAxMzo0MTo0
MC4wMDAwMDAwMDAgKzAxMDAKKysrIGN5cnVzLWltYXBkLTIuMy4xMS9pbWFwL2xtdHBlbmdpbmUu
YwkyMDA4LTA0LTE4IDExOjE1OjEyLjAwMDAwMDAwMCArMDIwMApAQCAtMzczLDYgKzM3MywxMiBA
QAogICAgIHJldHVybiBtLT5yY3B0W3JjcHRfbnVtXS0+aWdub3JlcXVvdGE7CiB9CiAKK3ZvaWQg
IG1zZ19zZXRyY3B0X2lnbm9yZXF1b3RhKG1lc3NhZ2VfZGF0YV90ICptLCBpbnQgcmNwdF9udW0p
Cit7CisgICAgYXNzZXJ0KDAgPD0gcmNwdF9udW0gJiYgcmNwdF9udW0gPCBtLT5yY3B0X251bSk7
CisgICAgbS0+cmNwdFtyY3B0X251bV0tPmlnbm9yZXF1b3RhPTE7Cit9CisKIC8qIHNldCBhIHJl
Y2lwaWVudCBzdGF0dXM7ICdyJyBzaG91bGQgYmUgYW4gSU1BUCBlcnJvciBjb2RlIHRoYXQgd2ls
bCBiZQogICAgdHJhbnNsYXRlZCBpbnRvIGFuIExNVFAgc3RhdHVzIGNvZGUgKi8KIHZvaWQgbXNn
X3NldHJjcHRfc3RhdHVzKG1lc3NhZ2VfZGF0YV90ICptLCBpbnQgcmNwdF9udW0sIGludCByKQpk
aWZmIC14ICdNYWtlZmlsZSonIC14ICcqfip+KicgLXUgLXIgY3lydXMtaW1hcGQtMi4zLjExLm9y
Zy9pbWFwL2xtdHBlbmdpbmUuaCBjeXJ1cy1pbWFwZC0yLjMuMTEvaW1hcC9sbXRwZW5naW5lLmgK
LS0tIGN5cnVzLWltYXBkLTIuMy4xMS5vcmcvaW1hcC9sbXRwZW5naW5lLmgJMjAwOC0wMy0yNyAx
Mzo0MTo0MS4wMDAwMDAwMDAgKzAxMDAKKysrIGN5cnVzLWltYXBkLTIuMy4xMS9pbWFwL2xtdHBl
bmdpbmUuaAkyMDA4LTA0LTE4IDExOjE3OjQ5LjAwMDAwMDAwMCArMDIwMApAQCAtOTEsNiArOTEs
OSBAQAogLyogcmV0dXJuIGlnbm9yZXF1b3RhIGZsYWcgb2YgJ3JjcHRfbnVtJyAqLwogaW50IG1z
Z19nZXRyY3B0X2lnbm9yZXF1b3RhKG1lc3NhZ2VfZGF0YV90ICptLCBpbnQgcmNwdF9udW0pOwog
CisvKiBzZXQgaWdub3JlcXVvdGEgZmxhZyBvZiAncmNwdF9udW0nIHRvIDEgKi8KK3ZvaWQgbXNn
X3NldHJjcHRfaWdub3JlcXVvdGEobWVzc2FnZV9kYXRhX3QgKm0sIGludCByY3B0X251bSk7CisK
IC8qIHNldCBhIHJlY2lwaWVudCBzdGF0dXM7ICdyJyBzaG91bGQgYmUgYW4gSU1BUCBlcnJvciBj
b2RlIHRoYXQgd2lsbCBiZQogICAgdHJhbnNsYXRlZCBpbnRvIGFuIExNVFAgc3RhdHVzIGNvZGUg
Ki8KIHZvaWQgbXNnX3NldHJjcHRfc3RhdHVzKG1lc3NhZ2VfZGF0YV90ICptLCBpbnQgcmNwdF9u
dW0sIGludCByKTsKZGlmZiAteCAnTWFrZWZpbGUqJyAteCAnKn4qfionIC11IC1yIGN5cnVzLWlt
YXBkLTIuMy4xMS5vcmcvaW1hcC9sbXRwX3NpZXZlLmMgY3lydXMtaW1hcGQtMi4zLjExL2ltYXAv
bG10cF9zaWV2ZS5jCi0tLSBjeXJ1cy1pbWFwZC0yLjMuMTEub3JnL2ltYXAvbG10cF9zaWV2ZS5j
CTIwMDgtMDMtMjcgMTM6NDE6NDEuMDAwMDAwMDAwICswMTAwCisrKyBjeXJ1cy1pbWFwZC0yLjMu
MTEvaW1hcC9sbXRwX3NpZXZlLmMJMjAwOC0wNC0xOCAxMToyMTozOS4wMDAwMDAwMDAgKzAyMDAK
QEAgLTc3LDYgKzc3LDcgQEAKICNpbmNsdWRlICJ4bWFsbG9jLmgiCiAjaW5jbHVkZSAieHN0cmxj
cHkuaCIKICNpbmNsdWRlICJ4c3RybGNhdC5oIgorI2luY2x1ZGUgIi4uL3NpZXZlL21lc3NhZ2Uu
aCIKIAogc3RhdGljIGludCBzaWV2ZV91c2Vob21lZGlyID0gMDsKIHN0YXRpYyBjb25zdCBjaGFy
ICpzaWV2ZV9kaXIgPSBOVUxMOwpAQCAtMzYwLDYgKzM2MSwxMTkgQEAKIH0KIAogCitzdGF0aWMg
aW50IHNpZXZlX3F1b3RhX2NoZWNrKHZvaWQgKnNjcmlwdF9jb250ZXh0LAorICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICB2b2lkICptZXNzYWdlX2NvbnRleHQsCisgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgIGFjdGlvbl9saXN0X3QgKmFjdGlvbnMsCisgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgIGNvbnN0IGNoYXIgKmVycm1zZykKK3sKKyAgYWN0aW9uX2xpc3RfdCAqYTsKKyAg
YWN0aW9uX3QgbGFzdGFjdGlvbiA9IC0xOworICBpbnQgcmV0ID0gMDsKKyAgaW50IGhhc3F1b3Rh
cm9vdDsKKyAgaW50IHF1b3RhY2hlY2sgPSAwOworICBpbnQgaW1wbGljaXRfa2VlcCA9IDE7Cisg
IGEgPSBhY3Rpb25zOworICBzY3JpcHRfZGF0YV90ICpzZCA9IChzY3JpcHRfZGF0YV90ICopIHNj
cmlwdF9jb250ZXh0OworICBkZWxpdmVyX2RhdGFfdCAqbWRhdGEgPSAoZGVsaXZlcl9kYXRhX3Qg
KikgIG1lc3NhZ2VfY29udGV4dDsKKyAgbWVzc2FnZV9kYXRhX3QgKm1kID0gbWRhdGEtPm07Cisg
IHNpZXZlX2ZpbGVpbnRvX2NvbnRleHRfdCAqZmMgPSBOVUxMOworICBjaGFyIG5hbWVidWZbTUFY
X01BSUxCT1hfTkFNRSsxXTsKKyAgY2hhciBxdW90YV9yb290W01BWF9NQUlMQk9YX1BBVEgrMV07
CisgIHN0cnVjdCB0eG4gKnRpZD1OVUxMOworICBzdHJ1Y3QgcXVvdGEgcXVvdGE7CisgIAorICBp
ZiAobXNnX2dldHJjcHRfaWdub3JlcXVvdGEobWQsIG1kYXRhLT5jdXJfcmNwdCkpIHsKKyAgICBy
ZXR1cm4gMDsKKyAgfQorICBxdW90YWNoZWNrPShjb25maWdfZ2V0c3dpdGNoKElNQVBPUFRfTE1U
UF9TVFJJQ1RfUVVPVEEpID8gbWQtPnNpemUgOjApOworICB3aGlsZSAoYSAhPSBOVUxMKSB7Cisg
ICAgbGFzdGFjdGlvbiA9IGEtPmE7CisgICAgZXJybXNnID0gTlVMTDsKKyAgICBpbXBsaWNpdF9r
ZWVwID0gaW1wbGljaXRfa2VlcCAmJiAhYS0+Y2FuY2VsX2tlZXA7CisgICAgc3dpdGNoIChhLT5h
KSB7CisgICAgY2FzZSBBQ1RJT05fRklMRUlOVE86CisgICAgICBmYz0oc2lldmVfZmlsZWludG9f
Y29udGV4dF90ICopICZhLT51LmZpbDsKKyAgICAgIHJldCA9ICgqbWRhdGEtPm5hbWVzcGFjZS0+
bWJveG5hbWVfdG9pbnRlcm5hbCkobWRhdGEtPm5hbWVzcGFjZSwKKwkJCQkJCSAgICAgZmMtPm1h
aWxib3gsCisJCQkJCQkgICAgIHNkLT51c2VybmFtZSwgbmFtZWJ1Zik7CisgICAgICBoYXNxdW90
YXJvb3QgPSBxdW90YV9maW5kcm9vdChxdW90YV9yb290LCBzaXplb2YocXVvdGFfcm9vdCksIG5h
bWVidWYpOworICAgICAgcXVvdGEucm9vdD1xdW90YV9yb290OworICAgICAgcmV0ID0gcXVvdGFf
cmVhZCgmcXVvdGEsICZ0aWQsIDEpOworICAgICAgaWYgKGhhc3F1b3Rhcm9vdCkgeworICAgICAg
ICBpZiAoIXJldCkgeworICAgICAgICAgIGlmIChxdW90YS5saW1pdCA+PSAwICYmIHF1b3RhY2hl
Y2sgPj0gMCAmJgorICAgICAgICAgICAgICBxdW90YS51c2VkICsgcXVvdGFjaGVjayA+ICgodXF1
b3RhX3QpIHF1b3RhLmxpbWl0ICogUVVPVEFfVU5JVFMpKSB7CisgICAgICAgICAgICBxdW90YV9h
Ym9ydCgmdGlkKTsKKyAgICAgICAgICAgIHJldCA9IElNQVBfUVVPVEFfRVhDRUVERUQ7CisgICAg
ICAgICAgICByZXR1cm4gcmV0OworICAgICAgICAgIH0gZWxzZSB7CisgICAgICAgICAgICBpZiAo
cXVvdGFjaGVjayA+PSAwKSB7CisgICAgICAgICAgICAgIHF1b3RhLnVzZWQgKz0gcXVvdGFjaGVj
azsKKyAgICAgICAgICAgICAgcXVvdGFfd3JpdGUoJnF1b3RhLCAmdGlkKTsKKyAgICAgICAgICAg
IH0KKyAgICAgICAgICB9CisgICAgICAgIH0KKyAgICAgIH0KKyAgICAgIGJyZWFrOworICAgIGNh
c2UgQUNUSU9OX0tFRVA6CisgICAgICByZXQgPSAoKm1kYXRhLT5uYW1lc3BhY2UtPm1ib3huYW1l
X3RvaW50ZXJuYWwpKG1kYXRhLT5uYW1lc3BhY2UsCisJCQkJCQkgICAgICJJTkJPWCIsCisJCQkJ
CQkgICAgIHNkLT51c2VybmFtZSwgbmFtZWJ1Zik7CisgICAgICBoYXNxdW90YXJvb3QgPSBxdW90
YV9maW5kcm9vdChxdW90YV9yb290LCBzaXplb2YocXVvdGFfcm9vdCksIG5hbWVidWYpOworICAg
ICAgcXVvdGEucm9vdD1xdW90YV9yb290OworICAgICAgcmV0ID0gcXVvdGFfcmVhZCgmcXVvdGEs
ICZ0aWQsIDEpOworICAgICAgaWYgKGhhc3F1b3Rhcm9vdCkgeworICAgICAgICBpZiAoIXJldCkg
eworICAgICAgICAgIGlmIChxdW90YS5saW1pdCA+PSAwICYmIHF1b3RhY2hlY2sgPj0gMCAmJgor
ICAgICAgICAgICAgICBxdW90YS51c2VkICsgcXVvdGFjaGVjayA+ICgodXF1b3RhX3QpIHF1b3Rh
LmxpbWl0ICogUVVPVEFfVU5JVFMpKSB7CisgICAgICAgICAgICBxdW90YV9hYm9ydCgmdGlkKTsK
KyAgICAgICAgICAgIHJldCA9IElNQVBfUVVPVEFfRVhDRUVERUQ7CisgICAgICAgICAgICByZXR1
cm4gcmV0OworICAgICAgICAgIH0gZWxzZSB7CisgICAgICAgICAgICBpZiAocXVvdGFjaGVjayA+
PSAwKSB7CisgICAgICAgICAgICAgIHF1b3RhLnVzZWQgKz0gcXVvdGFjaGVjazsKKyAgICAgICAg
ICAgICAgcXVvdGFfd3JpdGUoJnF1b3RhLCAmdGlkKTsKKyAgICAgICAgICAgIH0KKyAgICAgICAg
ICB9CisgICAgICAgIH0KKyAgICAgIH0KKyAgICAgIGJyZWFrOworICAgIGRlZmF1bHQ6CisgICAg
ICBicmVhazsKKyAgICB9CisgICAgYSA9IGEtPm5leHQ7CisgIH0KKyAgaWYgKGltcGxpY2l0X2tl
ZXApIHsKKyAgICByZXQgPSAoKm1kYXRhLT5uYW1lc3BhY2UtPm1ib3huYW1lX3RvaW50ZXJuYWwp
KG1kYXRhLT5uYW1lc3BhY2UsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAiSU5CT1giLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgc2QtPnVzZXJuYW1lLCBuYW1lYnVmKTsKKyAgICBoYXNxdW90YXJv
b3QgPSBxdW90YV9maW5kcm9vdChxdW90YV9yb290LCBzaXplb2YocXVvdGFfcm9vdCksIG5hbWVi
dWYpOworICAgIHF1b3RhLnJvb3Q9cXVvdGFfcm9vdDsKKyAgICByZXQgPSBxdW90YV9yZWFkKCZx
dW90YSwgJnRpZCwgMSk7CisgICAgaWYgKGhhc3F1b3Rhcm9vdCkgeworICAgICAgaWYgKCFyZXQp
IHsKKyAgICAgICAgaWYgKHF1b3RhLmxpbWl0ID49IDAgJiYgcXVvdGFjaGVjayA+PSAwICYmCisg
ICAgICAgICAgICBxdW90YS51c2VkICsgcXVvdGFjaGVjayA+ICgodXF1b3RhX3QpIHF1b3RhLmxp
bWl0ICogUVVPVEFfVU5JVFMpKSB7CisgICAgICAgICAgcXVvdGFfYWJvcnQoJnRpZCk7CisgICAg
ICAgICAgcmV0ID0gSU1BUF9RVU9UQV9FWENFRURFRDsKKyAgICAgICAgICByZXR1cm4gcmV0Owor
ICAgICAgICB9IGVsc2UgeworICAgICAgICAgIGlmIChxdW90YWNoZWNrID49IDApIHsKKyAgICAg
ICAgICAgIHF1b3RhLnVzZWQgKz0gcXVvdGFjaGVjazsKKyAgICAgICAgICAgIHF1b3RhX3dyaXRl
KCZxdW90YSwgJnRpZCk7CisgICAgICAgICAgfQorCX0KKyAgICAgIH0KKyAgICB9CisgIH0KKyAg
cXVvdGFfYWJvcnQoJnRpZCk7CisgIGlmIChxdW90YWNoZWNrPT0wKXsKKyAgICBtc2dfc2V0cmNw
dF9pZ25vcmVxdW90YShtZCwgbWRhdGEtPmN1cl9yY3B0KTsKKyAgfQorICByZXR1cm4gMDsKKyAg
Cit9CisKIHN0YXRpYyBpbnQgc2lldmVfcmVkaXJlY3Qodm9pZCAqYWMsIAogCQkJICB2b2lkICpp
YyBfX2F0dHJpYnV0ZV9fKCh1bnVzZWQpKSwgCiAJCQkgIHZvaWQgKnNjLCB2b2lkICptYywgY29u
c3QgY2hhciAqKmVycm1zZykKQEAgLTgwNSw2ICs5MTksMTQgQEAKIAlmYXRhbCgic2lldmVfcmVn
aXN0ZXJfZXhlY3V0ZV9lcnJvcigpIiwgRUNfU09GVFdBUkUpOwogICAgIH0KIAorICAgIHJlcyA9
IHNpZXZlX3JlZ2lzdGVyX3F1b3RhX2NoZWNrKGludGVycCwgJnNpZXZlX3F1b3RhX2NoZWNrKTsK
KyAgICBpZiAocmVzICE9IFNJRVZFX09LKSB7CisJc3lzbG9nKExPR19FUlIsICJzaWV2ZV9yZWdp
c3Rlcl9xdW90YV9jaGVjaygpIHJldHVybnMgJWRcbiIsIHJlcyk7CisJZmF0YWwoInNpZXZlX3Jl
Z2lzdGVyX3F1b3RhX2NoZWNrKCkiLCBFQ19TT0ZUV0FSRSk7CisgICAgfQorCisKKwogICAgIHJl
dHVybiBpbnRlcnA7CiB9CiAKZGlmZiAteCAnTWFrZWZpbGUqJyAteCAnKn4qfionIC11IC1yIGN5
cnVzLWltYXBkLTIuMy4xMS5vcmcvc2lldmUvaW50ZXJwLmMgY3lydXMtaW1hcGQtMi4zLjExL3Np
ZXZlL2ludGVycC5jCi0tLSBjeXJ1cy1pbWFwZC0yLjMuMTEub3JnL3NpZXZlL2ludGVycC5jCTIw
MDgtMDMtMjcgMTM6NDE6MzIuMDAwMDAwMDAwICswMTAwCisrKyBjeXJ1cy1pbWFwZC0yLjMuMTEv
c2lldmUvaW50ZXJwLmMJMjAwOC0wNC0xNiAxMzozOToxNi4wMDAwMDAwMDAgKzAyMDAKQEAgLTI1
NCw2ICsyNTQsMTQgQEAKICAgICByZXR1cm4gU0lFVkVfT0s7CiB9CiAKK2ludCBzaWV2ZV9yZWdp
c3Rlcl9xdW90YV9jaGVjayhzaWV2ZV9pbnRlcnBfdCAqaW50ZXJwLCBzaWV2ZV9jYWxsYmFja19x
dW90YV9jaGVjayAqZikKK3sKKyAgICBpbnRlcnAtPnF1b3RhX2NoZWNrID0gZjsKKyAgICByZXR1
cm4gU0lFVkVfT0s7Cit9CisKKworCiBpbnQgaW50ZXJwX3ZlcmlmeShzaWV2ZV9pbnRlcnBfdCAq
aSkKIHsKICAgICBpZiAoaS0+cmVkaXJlY3QgJiYgaS0+a2VlcCAmJiBpLT5nZXRzaXplICYmIGkt
PmdldGhlYWRlcikgewpkaWZmIC14ICdNYWtlZmlsZSonIC14ICcqfip+KicgLXUgLXIgY3lydXMt
aW1hcGQtMi4zLjExLm9yZy9zaWV2ZS9pbnRlcnAuaCBjeXJ1cy1pbWFwZC0yLjMuMTEvc2lldmUv
aW50ZXJwLmgKLS0tIGN5cnVzLWltYXBkLTIuMy4xMS5vcmcvc2lldmUvaW50ZXJwLmgJMjAwOC0w
My0yNyAxMzo0MTozMS4wMDAwMDAwMDAgKzAxMDAKKysrIGN5cnVzLWltYXBkLTIuMy4xMS9zaWV2
ZS9pbnRlcnAuaAkyMDA4LTA0LTE2IDEzOjM2OjE1LjAwMDAwMDAwMCArMDIwMApAQCAtMzUsNyAr
MzUsNyBAQAogICAgIHNpZXZlX2NhbGxiYWNrICpyZWRpcmVjdCwgKmRpc2NhcmQsICpyZWplY3Qs
ICpmaWxlaW50bywgKmtlZXA7CiAgICAgc2lldmVfY2FsbGJhY2sgKm5vdGlmeTsKICAgICBzaWV2
ZV92YWNhdGlvbl90ICp2YWNhdGlvbjsKLQorICAgIHNpZXZlX2NhbGxiYWNrX3F1b3RhX2NoZWNr
ICpxdW90YV9jaGVjazsKICAgICBzaWV2ZV9nZXRfc2l6ZSAqZ2V0c2l6ZTsKICAgICBzaWV2ZV9n
ZXRfaGVhZGVyICpnZXRoZWFkZXI7CiAgICAgc2lldmVfZ2V0X2VudmVsb3BlICpnZXRlbnZlbG9w
ZTsKZGlmZiAteCAnTWFrZWZpbGUqJyAteCAnKn4qfionIC11IC1yIGN5cnVzLWltYXBkLTIuMy4x
MS5vcmcvc2lldmUvbWVzc2FnZS5oIGN5cnVzLWltYXBkLTIuMy4xMS9zaWV2ZS9tZXNzYWdlLmgK
LS0tIGN5cnVzLWltYXBkLTIuMy4xMS5vcmcvc2lldmUvbWVzc2FnZS5oCTIwMDgtMDMtMjcgMTM6
NDE6MzEuMDAwMDAwMDAwICswMTAwCisrKyBjeXJ1cy1pbWFwZC0yLjMuMTEvc2lldmUvbWVzc2Fn
ZS5oCTIwMDgtMDQtMTggMTU6NDM6MjMuMDAwMDAwMDAwICswMjAwCkBAIC0zMSw1OCArMzEsMTEg
QEAKICNpbmNsdWRlICJzaWV2ZV9pbnRlcmZhY2UuaCIJLyogZm9yIGFjdGlvbiBjb250ZXh0cyAq
LwogI2luY2x1ZGUgInRyZWUuaCIJCS8qIGZvciBzdHJpbmdsaXN0X3QgKi8KIAotdHlwZWRlZiBz
dHJ1Y3QgQWN0aW9uIGFjdGlvbl9saXN0X3Q7Ci0KLXR5cGVkZWYgZW51bSB7Ci0gICAgQUNUSU9O
X05VTEwgPSAtMSwKLSAgICBBQ1RJT05fTk9ORSA9IDAsCi0gICAgQUNUSU9OX1JFSkVDVCwKLSAg
ICBBQ1RJT05fRklMRUlOVE8sCi0gICAgQUNUSU9OX0tFRVAsCi0gICAgQUNUSU9OX1JFRElSRUNU
LAotICAgIEFDVElPTl9ESVNDQVJELAotICAgIEFDVElPTl9WQUNBVElPTiwKLSAgICBBQ1RJT05f
U0VURkxBRywKLSAgICBBQ1RJT05fQURERkxBRywKLSAgICBBQ1RJT05fUkVNT1ZFRkxBRywKLSAg
ICBBQ1RJT05fTUFSSywKLSAgICBBQ1RJT05fVU5NQVJLLAotICAgIEFDVElPTl9OT1RJRlksCi0g
ICAgQUNUSU9OX0RFTk9USUZZCi19IGFjdGlvbl90OwogCiAvKiBpbmZvcm1hdGlvbiAqLwogYWN0
aW9uX2xpc3RfdCAqbmV3X2FjdGlvbl9saXN0KHZvaWQpOwogdm9pZCBmcmVlX2FjdGlvbl9saXN0
KGFjdGlvbl9saXN0X3QgKmFjdGlvbnMpOwogCi0vKiBpbnZhcmlhbnQ6IGFsd2F5cyBoYXZlIGEg
ZHVtbXkgZWxlbWVudCB3aGVuIGZyZWVfYWN0aW9uX2xpc3QsIHBhcmFtCi0gICBhbmQgdmFjX3N1
YmogYXJlIGZyZWVkLiAgbm9uZSBvZiB0aGUgb3RoZXJzIGFyZSBhdXRvbWF0aWNhbGx5IGZyZWVk
LgotCi0gICB0aGUgZG9fYWN0aW9uKCkgZnVuY3Rpb25zIHNob3VsZCBjb3B5IHBhcmFtICovCi1z
dHJ1Y3QgQWN0aW9uIHsKLSAgICBhY3Rpb25fdCBhOwotICAgIGludCBjYW5jZWxfa2VlcDsKLSAg
ICB1bmlvbiB7Ci0Jc2lldmVfcmVqZWN0X2NvbnRleHRfdCByZWo7Ci0Jc2lldmVfZmlsZWludG9f
Y29udGV4dF90IGZpbDsKLQlzaWV2ZV9rZWVwX2NvbnRleHRfdCBrZWVwOwotCXNpZXZlX3JlZGly
ZWN0X2NvbnRleHRfdCByZWQ7Ci0Jc3RydWN0IHsKLQkgICAgLyogYWRkciwgZnJvbWFkZHIsIHN1
YmogLSBmcmVlZCEgKi8KLQkgICAgc2lldmVfc2VuZF9yZXNwb25zZV9jb250ZXh0X3Qgc2VuZDsK
LQkgICAgc2lldmVfYXV0b3Jlc3BvbmRfY29udGV4dF90IGF1dG9yZXNwOwotCX0gdmFjOwotCXN0
cnVjdCB7Ci0JICAgIGNvbnN0IGNoYXIgKmZsYWc7Ci0JfSBmbGE7Ci0gICAgfSB1OwotICAgIGNo
YXIgKnBhcmFtOwkJLyogZnJlZWQhICovCi0gICAgc3RydWN0IEFjdGlvbiAqbmV4dDsKLSAgICBj
aGFyICp2YWNfc3ViajsJCS8qIGZyZWVkISAqLwotICAgIGNoYXIgKnZhY19tc2c7Ci0gICAgaW50
IHZhY19kYXlzOwotfTsKLQogdHlwZWRlZiBzdHJ1Y3Qgbm90aWZ5X2xpc3RfcyB7CiAgICAgaW50
IGlzYWN0aXZlOwogICAgIGNvbnN0IGNoYXIgKmlkOwpAQCAtMTA5LDYgKzYyLDEyIEBACiBub3Rp
ZnlfbGlzdF90ICpuZXdfbm90aWZ5X2xpc3Qodm9pZCk7CiB2b2lkIGZyZWVfbm90aWZ5X2xpc3Qo
bm90aWZ5X2xpc3RfdCAqbik7CiAKKy8qIGludmFyaWFudDogYWx3YXlzIGhhdmUgYSBkdW1teSBl
bGVtZW50IHdoZW4gZnJlZV9hY3Rpb25fbGlzdCwgcGFyYW0KKyAgIGFuZCB2YWNfc3ViaiBhcmUg
ZnJlZWQuICBub25lIG9mIHRoZSBvdGhlcnMgYXJlIGF1dG9tYXRpY2FsbHkgZnJlZWQuCisKKyAg
IHRoZSBkb19hY3Rpb24oKSBmdW5jdGlvbnMgc2hvdWxkIGNvcHkgcGFyYW0gKi8KKworCiAvKiBh
Y3Rpb25zOyByZXR1cm4gbmVnYXRpdmUgb24gZmFpbHVyZS4KICAqIHRoZXNlIGRvbid0IGFjdHVh
bGx5IHBlcmZvcm0gdGhlIGFjdGlvbnMsIHRoZXkganVzdCBhZGQgaXQgdG8gdGhlCiAgKiBhY3Rp
b24gbGlzdCAqLwpkaWZmIC14ICdNYWtlZmlsZSonIC14ICcqfip+KicgLXUgLXIgY3lydXMtaW1h
cGQtMi4zLjExLm9yZy9zaWV2ZS9zY3JpcHQuYyBjeXJ1cy1pbWFwZC0yLjMuMTEvc2lldmUvc2Ny
aXB0LmMKLS0tIGN5cnVzLWltYXBkLTIuMy4xMS5vcmcvc2lldmUvc2NyaXB0LmMJMjAwOC0wMy0y
NyAxMzo0MTozMi4wMDAwMDAwMDAgKzAxMDAKKysrIGN5cnVzLWltYXBkLTIuMy4xMS9zaWV2ZS9z
Y3JpcHQuYwkyMDA4LTA0LTE2IDEzOjQwOjAwLjAwMDAwMDAwMCArMDIwMApAQCAtOTI4LDEwICs5
MjgsMTggQEAKIAkJCQkgYWN0aW9uc19zdHJpbmcsIGVycm1zZyk7CiAJfQogCWVsc2UgewotCSAg
ICByZXQgPSBkb19hY3Rpb25fbGlzdChpbnRlcnAsICZib2R5X2NhY2hlLAotCQkJCSBzY3JpcHRf
Y29udGV4dCwgbWVzc2FnZV9jb250ZXh0LCAKLQkJCQkgJmltYXBmbGFncywgYWN0aW9ucywgbm90
aWZ5X2xpc3QsCi0JCQkJIGFjdGlvbnNfc3RyaW5nLCBlcnJtc2cpOworCSAgaWYgKGludGVycC0+
cXVvdGFfY2hlY2spIHsKKyAgICAgICAgICAgIHJldCA9IGludGVycC0+cXVvdGFfY2hlY2soc2Ny
aXB0X2NvbnRleHQsIG1lc3NhZ2VfY29udGV4dCwKKwkJCQkJICAgIGFjdGlvbnMsICBlcnJtc2cp
OworCSAgICBpZiAocmV0PT1TSUVWRV9PSykgeworCSAgICAgIHJldCA9IGRvX2FjdGlvbl9saXN0
KGludGVycCwgJmJvZHlfY2FjaGUsCisJCQkJICAgc2NyaXB0X2NvbnRleHQsIG1lc3NhZ2VfY29u
dGV4dCwgCisJCQkJICAgJmltYXBmbGFncywgYWN0aW9ucywgbm90aWZ5X2xpc3QsCisJCQkJICAg
YWN0aW9uc19zdHJpbmcsIGVycm1zZyk7CisJICAgIH0KKwkgIH0gZWxzZSB7CisJICAgIHJldCA9
IFNJRVZFX0lOVEVSTkFMX0VSUk9SOworCSAgfSAKIAl9CiAgICAgfQogCmRpZmYgLXggJ01ha2Vm
aWxlKicgLXggJyp+Kn4qJyAtdSAtciBjeXJ1cy1pbWFwZC0yLjMuMTEub3JnL3NpZXZlL3NpZXZl
X2ludGVyZmFjZS5oIGN5cnVzLWltYXBkLTIuMy4xMS9zaWV2ZS9zaWV2ZV9pbnRlcmZhY2UuaAot
LS0gY3lydXMtaW1hcGQtMi4zLjExLm9yZy9zaWV2ZS9zaWV2ZV9pbnRlcmZhY2UuaAkyMDA4LTAz
LTI3IDEzOjQxOjMyLjAwMDAwMDAwMCArMDEwMAorKysgY3lydXMtaW1hcGQtMi4zLjExL3NpZXZl
L3NpZXZlX2ludGVyZmFjZS5oCTIwMDgtMDQtMTYgMTM6MjA6NDQuMDAwMDAwMDAwICswMjAwCkBA
IC00NSw2ICs0NSw3IEBACiB0eXBlZGVmIGludCBzaWV2ZV9jYWxsYmFjayh2b2lkICphY3Rpb25f
Y29udGV4dCwgdm9pZCAqaW50ZXJwX2NvbnRleHQsIAogCQkJICAgdm9pZCAqc2NyaXB0X2NvbnRl
eHQsCiAJCQkgICB2b2lkICptZXNzYWdlX2NvbnRleHQsIGNvbnN0IGNoYXIgKiplcnJtc2cpOwor
CiB0eXBlZGVmIGludCBzaWV2ZV9nZXRfc2l6ZSh2b2lkICptZXNzYWdlX2NvbnRleHQsIGludCAq
c2l6ZSk7CiB0eXBlZGVmIGludCBzaWV2ZV9nZXRfaGVhZGVyKHZvaWQgKm1lc3NhZ2VfY29udGV4
dCwgCiAJCQkgICAgIGNvbnN0IGNoYXIgKmhlYWRlciwKQEAgLTEyMyw2ICsxMjQsNTUgQEAKICAg
ICBpbnQgbWltZTsKIH0gc2lldmVfc2VuZF9yZXNwb25zZV9jb250ZXh0X3Q7CiAKK3R5cGVkZWYg
c3RydWN0IEFjdGlvbiBhY3Rpb25fbGlzdF90OworCit0eXBlZGVmIGVudW0geworICAgIEFDVElP
Tl9OVUxMID0gLTEsCisgICAgQUNUSU9OX05PTkUgPSAwLAorICAgIEFDVElPTl9SRUpFQ1QsCisg
ICAgQUNUSU9OX0ZJTEVJTlRPLAorICAgIEFDVElPTl9LRUVQLAorICAgIEFDVElPTl9SRURJUkVD
VCwKKyAgICBBQ1RJT05fRElTQ0FSRCwKKyAgICBBQ1RJT05fVkFDQVRJT04sCisgICAgQUNUSU9O
X1NFVEZMQUcsCisgICAgQUNUSU9OX0FEREZMQUcsCisgICAgQUNUSU9OX1JFTU9WRUZMQUcsCisg
ICAgQUNUSU9OX01BUkssCisgICAgQUNUSU9OX1VOTUFSSywKKyAgICBBQ1RJT05fTk9USUZZLAor
ICAgIEFDVElPTl9ERU5PVElGWQorfSBhY3Rpb25fdDsKKworc3RydWN0IEFjdGlvbiB7CisgICAg
YWN0aW9uX3QgYTsKKyAgICBpbnQgY2FuY2VsX2tlZXA7CisgICAgdW5pb24geworCXNpZXZlX3Jl
amVjdF9jb250ZXh0X3QgcmVqOworCXNpZXZlX2ZpbGVpbnRvX2NvbnRleHRfdCBmaWw7CisJc2ll
dmVfa2VlcF9jb250ZXh0X3Qga2VlcDsKKwlzaWV2ZV9yZWRpcmVjdF9jb250ZXh0X3QgcmVkOwor
CXN0cnVjdCB7CisJICAgIC8qIGFkZHIsIGZyb21hZGRyLCBzdWJqIC0gZnJlZWQhICovCisJICAg
IHNpZXZlX3NlbmRfcmVzcG9uc2VfY29udGV4dF90IHNlbmQ7CisJICAgIHNpZXZlX2F1dG9yZXNw
b25kX2NvbnRleHRfdCBhdXRvcmVzcDsKKwl9IHZhYzsKKwlzdHJ1Y3QgeworCSAgICBjb25zdCBj
aGFyICpmbGFnOworCX0gZmxhOworICAgIH0gdTsKKyAgICBjaGFyICpwYXJhbTsJCS8qIGZyZWVk
ISAqLworICAgIHN0cnVjdCBBY3Rpb24gKm5leHQ7CisgICAgY2hhciAqdmFjX3N1Ymo7CQkvKiBm
cmVlZCEgKi8KKyAgICBjaGFyICp2YWNfbXNnOworICAgIGludCB2YWNfZGF5czsKK307CisKK3R5
cGVkZWYgaW50IHNpZXZlX2NhbGxiYWNrX3F1b3RhX2NoZWNrKCB2b2lkICpzY3JpcHRfY29udGV4
dCwKKwkJCQkJdm9pZCAqbWVzc2FnZV9jb250ZXh0LAorCQkJCQlhY3Rpb25fbGlzdF90ICphY3Rp
b25zLAorCQkJCQljb25zdCBjaGFyICoqZXJybXNnKTsKKwogLyogYnVpbGQgYSBzaWV2ZSBpbnRl
cnByZXRvciAqLwogaW50IHNpZXZlX2ludGVycF9hbGxvYyhzaWV2ZV9pbnRlcnBfdCAqKmludGVy
cCwgdm9pZCAqaW50ZXJwX2NvbnRleHQpOwogaW50IHNpZXZlX2ludGVycF9mcmVlKHNpZXZlX2lu
dGVycF90ICoqaW50ZXJwKTsKQEAgLTEzOCw2ICsxODgsNyBAQAogaW50IHNpZXZlX3JlZ2lzdGVy
X2ltYXBmbGFncyhzaWV2ZV9pbnRlcnBfdCAqaW50ZXJwLCBzaWV2ZV9pbWFwZmxhZ3NfdCAqbWFy
ayk7CiBpbnQgc2lldmVfcmVnaXN0ZXJfbm90aWZ5KHNpZXZlX2ludGVycF90ICppbnRlcnAsIHNp
ZXZlX2NhbGxiYWNrICpmKTsKIGludCBzaWV2ZV9yZWdpc3Rlcl9pbmNsdWRlKHNpZXZlX2ludGVy
cF90ICppbnRlcnAsIHNpZXZlX2dldF9pbmNsdWRlICpmKTsKK2ludCBzaWV2ZV9yZWdpc3Rlcl9x
dW90YV9jaGVjayhzaWV2ZV9pbnRlcnBfdCAqaW50ZXJwLCBzaWV2ZV9jYWxsYmFja19xdW90YV9j
aGVjayAqZik7CiAKIC8qIGFkZCB0aGUgY2FsbGJhY2tzIGZvciBtZXNzYWdlcy4gYWdhaW4sIHVu
ZGVmaW5lZCBpZiB1c2VkIGFmdGVyCiAgICBzaWV2ZV9zY3JpcHRfcGFyc2UgKi8KQEAgLTE3Miw3
ICsyMjMsNiBAQAogLyogZXhlY3V0ZSBieXRlY29kZSBvbiBhIG1lc3NhZ2UgKi8KIGludCBzaWV2
ZV9leGVjdXRlX2J5dGVjb2RlKHNpZXZlX2V4ZWN1dGVfdCAqc2NyaXB0LCBzaWV2ZV9pbnRlcnBf
dCAqaW50ZXJwLAogCQkJICAgdm9pZCAqc2NyaXB0X2NvbnRleHQsIHZvaWQgKm1lc3NhZ2VfY29u
dGV4dCk7Ci0KIC8qIEdldCBzcGFjZSBzZXBhcmF0ZWQgbGlzdCBvZiBleHRlbnNpb25zIHN1cHBv
cnRlZCBieSB0aGUgaW1wbGVtZW50YXRpb24gKi8KIGNvbnN0IGNoYXIgKnNpZXZlX2xpc3RleHRl
bnNpb25zKHNpZXZlX2ludGVycF90ICppKTsKIAo=
</data>        

          </attachment>
          <attachment
              isobsolete="0"
              ispatch="1"
              isprivate="0"
          >
            <attachid>1238</attachid>
            <date>2009-11-25 05:26 EDT</date>
            <desc>New version of the patch for Cyrus Imapd 2.3.15</desc>
            <filename>sieve_quota2.patch</filename>
            <type>text/plain</type>
            <size>13640</size>
            <attacher>michael.menge@zdv.uni-tuebingen.de</attacher>
            
              <data encoding="base64">ZGlmZiAtLWdpdCBhL2ltYXAvbG10cF9zaWV2ZS5jIGIvaW1hcC9sbXRwX3NpZXZlLmMKaW5kZXgg
NDZlNmM0Zi4uOGI3N2FiNCAxMDA2NDQKLS0tIGEvaW1hcC9sbXRwX3NpZXZlLmMKKysrIGIvaW1h
cC9sbXRwX3NpZXZlLmMKQEAgLTYyLDYgKzYyLDcgQEAKICNpbmNsdWRlICJkdXBsaWNhdGUuaCIK
ICNpbmNsdWRlICJleGl0Y29kZXMuaCIKICNpbmNsdWRlICJnbG9iYWwuaCIKKyNpbmNsdWRlICJo
YXNoLmgiCiAjaW5jbHVkZSAiaW1hcF9lcnIuaCIKICNpbmNsdWRlICJsbXRwZC5oIgogI2luY2x1
ZGUgImxtdHBfc2lldmUuaCIKQEAgLTc3LDYgKzc4LDcgQEAKICNpbmNsdWRlICJ4bWFsbG9jLmgi
CiAjaW5jbHVkZSAieHN0cmxjcHkuaCIKICNpbmNsdWRlICJ4c3RybGNhdC5oIgorI2luY2x1ZGUg
Im1lc3NhZ2UuaCIKIAogc3RhdGljIGludCBzaWV2ZV91c2Vob21lZGlyID0gMDsKIHN0YXRpYyBj
b25zdCBjaGFyICpzaWV2ZV9kaXIgPSBOVUxMOwpAQCAtMzU5LDYgKzM2MSwxMjcgQEAgc3RhdGlj
IGludCBzZW5kX2ZvcndhcmQoY29uc3QgY2hhciAqZm9yd2FyZHRvLAogICAgIHJldHVybiBzbV9z
dGF0OwkvKiBzZW5kbWFpbCBleGl0IHZhbHVlICovCiB9CiAKK3N0YXRpYyBpbnQgc2lldmVfcXVv
dGFyb290X2NoZWNrKGhhc2hfdGFibGUgKnF1b3Rhcm9vdHMsCisgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgY2hhciAqcXVvdGFfcm9vdCwgaW50IHF1b3RhY2hlY2spCisKK3sKKyAg
ICBzdHJ1Y3QgdHhuICp0aWQ9TlVMTDsKKyAgICBpbnQgcmV0PTA7CisgICAgc3RydWN0IHF1b3Rh
ICpxdW90YXA9TlVMTDsKKworICAgIHF1b3RhcCA9IGhhc2hfbG9va3VwKHF1b3RhX3Jvb3QsIHF1
b3Rhcm9vdHMpOworICAgIGlmICghcXVvdGFwKSB7CisgICAgICAgIHF1b3RhcCA9IChzdHJ1Y3Qg
cXVvdGEqKSB4bWFsbG9jKHNpemVvZihzdHJ1Y3QgcXVvdGEpKTsKKyAgICAgICAgaWYgKCFxdW90
YXApIHsKKyAgICAgICAgICAgIHJldHVybiBTSUVWRV9OT01FTTsKKyAgICAgICAgfQorICAgICAg
ICBxdW90YXAtPnJvb3Q9cXVvdGFfcm9vdDsKKyAgICAgICAgcmV0ID0gcXVvdGFfcmVhZChxdW90
YXAsICZ0aWQsIDApOworICAgICAgICBpZiAocmV0KSB7CisgICAgICAgICAgICByZXR1cm4gU0lF
VkVfSU5URVJOQUxfRVJST1I7CisgICAgICAgIH0KKyAgICAgICAgaGFzaF9pbnNlcnQocXVvdGFf
cm9vdCwgcXVvdGFwLCBxdW90YXJvb3RzKTsKKyAgICB9CisKKworICAgIGlmIChxdW90YXAtPmxp
bWl0ID49IDAgJiYgcXVvdGFjaGVjayA+PSAwICYmCisgICAgICAgIHF1b3RhcC0+dXNlZCArIHF1
b3RhY2hlY2sgPiAoKHVxdW90YV90KSBxdW90YXAtPmxpbWl0ICogUVVPVEFfVU5JVFMpKSB7Cisg
ICAgICAgIHJldHVybiBJTUFQX1FVT1RBX0VYQ0VFREVEOworICAgIH0gZWxzZSB7CisgICAgICBp
ZiAocXVvdGFjaGVjayA+PSAwKSB7CisgICAgICAgIHF1b3RhcC0+dXNlZCArPSBxdW90YWNoZWNr
OworICAgICAgfQorICAgIH0KKyAgICByZXR1cm4gMDsKK30KKworCitzdGF0aWMgaW50IHNpZXZl
X3F1b3RhX2NoZWNrKHZvaWQgKnNjcmlwdF9jb250ZXh0LAorICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICB2b2lkICptZXNzYWdlX2NvbnRleHQsCisgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgIGFjdGlvbl9saXN0X3QgKmFjdGlvbnMpCit7CisgIGFjdGlvbl9saXN0X3QgKmE7CisgIGFj
dGlvbl90IGxhc3RhY3Rpb24gPSAtMTsKKyAgaW50IHJldCA9IDA7CisgIGludCBoYXNxdW90YXJv
b3Q7CisgIGludCBxdW90YWNoZWNrID0gMDsKKyAgaW50IGltcGxpY2l0X2tlZXAgPSAxOworICBh
ID0gYWN0aW9uczsKKyAgc2NyaXB0X2RhdGFfdCAqc2QgPSAoc2NyaXB0X2RhdGFfdCAqKSBzY3Jp
cHRfY29udGV4dDsKKyAgZGVsaXZlcl9kYXRhX3QgKm1kYXRhID0gKGRlbGl2ZXJfZGF0YV90ICop
ICBtZXNzYWdlX2NvbnRleHQ7CisgIG1lc3NhZ2VfZGF0YV90ICptZCA9IG1kYXRhLT5tOworICBz
aWV2ZV9maWxlaW50b19jb250ZXh0X3QgKmZjID0gTlVMTDsKKyAgY2hhciBuYW1lYnVmW01BWF9N
QUlMQk9YX05BTUUrMV07CisgIGNoYXIgcXVvdGFfcm9vdFtNQVhfTUFJTEJPWF9QQVRIKzFdOwor
ICBzdHJ1Y3QgcXVvdGEgKnF1b3RhcD1OVUxMOworICBzdHJ1Y3QgaGFzaF90YWJsZSBxdW90YXJv
b3RzOworICAKKyAgaWYgKG1zZ19nZXRyY3B0X2lnbm9yZXF1b3RhKG1kLCBtZGF0YS0+Y3VyX3Jj
cHQpKSB7CisgICAgcmV0dXJuIFNJRVZFX09LOworICB9CisgIGNvbnN0cnVjdF9oYXNoX3RhYmxl
KCZxdW90YXJvb3RzLCA4LCAwKTsKKyAgcXVvdGFjaGVjaz0oY29uZmlnX2dldHN3aXRjaChJTUFQ
T1BUX0xNVFBfU1RSSUNUX1FVT1RBKSA/IG1kLT5zaXplIDowKTsKKyAgd2hpbGUgKGEgIT0gTlVM
TCkgeworICAgIGltcGxpY2l0X2tlZXAgPSBpbXBsaWNpdF9rZWVwICYmICFhLT5jYW5jZWxfa2Vl
cDsKKyAgICBzd2l0Y2ggKGEtPmEpIHsKKyAgICBjYXNlIEFDVElPTl9GSUxFSU5UTzoKKyAgICAg
IGZjPShzaWV2ZV9maWxlaW50b19jb250ZXh0X3QgKikgJmEtPnUuZmlsOworICAgICAgcmV0ID0g
KCptZGF0YS0+bmFtZXNwYWNlLT5tYm94bmFtZV90b2ludGVybmFsKShtZGF0YS0+bmFtZXNwYWNl
LAorCQkJCQkJICAgICBmYy0+bWFpbGJveCwKKwkJCQkJCSAgICAgc2QtPnVzZXJuYW1lLCBuYW1l
YnVmKTsKKworICAgICAgaGFzcXVvdGFyb290ID0gcXVvdGFfZmluZHJvb3QocXVvdGFfcm9vdCwg
c2l6ZW9mKHF1b3RhX3Jvb3QpLCBuYW1lYnVmKTsKKyAgICAgIGlmIChoYXNxdW90YXJvb3QpIHsK
KyAgICAgICAgcmV0ID0gIHNpZXZlX3F1b3Rhcm9vdF9jaGVjaygmcXVvdGFyb290cywgcXVvdGFf
cm9vdCxxdW90YWNoZWNrKTsKKyAgICAgICAgaWYgKHJldCAhPSBTSUVWRV9PSykgeworICAgICAg
ICAgICAgZnJlZV9oYXNoX3RhYmxlKCZxdW90YXJvb3RzLCBmcmVlKTsKKyAgICAgICAgICAgIHJl
dHVybiByZXQ7CisgICAgICAgIH0gCisgICAgICB9IAorICAgICAgYnJlYWs7CisgICAgY2FzZSBB
Q1RJT05fS0VFUDoKKyAgICAgIHJldCA9ICgqbWRhdGEtPm5hbWVzcGFjZS0+bWJveG5hbWVfdG9p
bnRlcm5hbCkobWRhdGEtPm5hbWVzcGFjZSwKKwkJCQkJCSAgICAgIklOQk9YIiwKKwkJCQkJCSAg
ICAgc2QtPnVzZXJuYW1lLCBuYW1lYnVmKTsKKyAgCisgICAgICBoYXNxdW90YXJvb3QgPSBxdW90
YV9maW5kcm9vdChxdW90YV9yb290LCBzaXplb2YocXVvdGFfcm9vdCksIG5hbWVidWYpOworICAg
ICAgaWYgKGhhc3F1b3Rhcm9vdCkgeworICAgICAgICByZXQgPSAgc2lldmVfcXVvdGFyb290X2No
ZWNrKCZxdW90YXJvb3RzLCBxdW90YV9yb290LHF1b3RhY2hlY2spOworICAgICAgICBpZiAocmV0
ICE9IFNJRVZFX09LKSB7CisgICAgICAgICAgICBmcmVlX2hhc2hfdGFibGUoJnF1b3Rhcm9vdHMs
IGZyZWUpOworICAgICAgICAgICAgcmV0dXJuIHJldDsKKyAgICAgICAgfQorICAgICAgfQorICAg
ICAgYnJlYWs7CisgICAgZGVmYXVsdDoKKyAgICAgIGJyZWFrOworICAgIH0KKworICAgIGEgPSBh
LT5uZXh0OworICB9CisKKyAgaWYgKGltcGxpY2l0X2tlZXApIHsKKyAgICByZXQgPSAoKm1kYXRh
LT5uYW1lc3BhY2UtPm1ib3huYW1lX3RvaW50ZXJuYWwpKG1kYXRhLT5uYW1lc3BhY2UsCisgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiSU5CT1giLAor
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2QtPnVz
ZXJuYW1lLCBuYW1lYnVmKTsKKyAgIAorICAgIGhhc3F1b3Rhcm9vdCA9IHF1b3RhX2ZpbmRyb290
KHF1b3RhX3Jvb3QsIHNpemVvZihxdW90YV9yb290KSwgbmFtZWJ1Zik7CisgICAgaWYgKGhhc3F1
b3Rhcm9vdCkgeworICAgICAgICByZXQgPSAgc2lldmVfcXVvdGFyb290X2NoZWNrKCZxdW90YXJv
b3RzLCBxdW90YV9yb290LHF1b3RhY2hlY2spOworICAgICAgICBpZiAocmV0ICE9IFNJRVZFX09L
KSB7CisgICAgICAgICAgICBmcmVlX2hhc2hfdGFibGUoJnF1b3Rhcm9vdHMsIGZyZWUpOworICAg
ICAgICAgICAgcmV0dXJuIHJldDsKKyAgICAgICAgfQorICAgICAgfSAKKyAgICAKKyAgICB9Cisg
IGlmIChxdW90YWNoZWNrPT0wKXsKKyAgICBtc2dfc2V0cmNwdF9pZ25vcmVxdW90YShtZCwgbWRh
dGEtPmN1cl9yY3B0KTsKKyAgfQorICBmcmVlX2hhc2hfdGFibGUoJnF1b3Rhcm9vdHMsIGZyZWUp
OworICByZXR1cm4gU0lFVkVfT0s7CisgIAorfQogCiBzdGF0aWMgaW50IHNpZXZlX3JlZGlyZWN0
KHZvaWQgKmFjLCAKIAkJCSAgdm9pZCAqaWMgX19hdHRyaWJ1dGVfXygodW51c2VkKSksIApAQCAt
ODA1LDYgKzkyOCwxNCBAQCBzaWV2ZV9pbnRlcnBfdCAqc2V0dXBfc2lldmUodm9pZCkKIAlmYXRh
bCgic2lldmVfcmVnaXN0ZXJfZXhlY3V0ZV9lcnJvcigpIiwgRUNfU09GVFdBUkUpOwogICAgIH0K
IAorICAgIHJlcyA9IHNpZXZlX3JlZ2lzdGVyX3F1b3RhX2NoZWNrKGludGVycCwgJnNpZXZlX3F1
b3RhX2NoZWNrKTsKKyAgICBpZiAocmVzICE9IFNJRVZFX09LKSB7CisJc3lzbG9nKExPR19FUlIs
ICJzaWV2ZV9yZWdpc3Rlcl9xdW90YV9jaGVjaygpIHJldHVybnMgJWRcbiIsIHJlcyk7CisJZmF0
YWwoInNpZXZlX3JlZ2lzdGVyX3F1b3RhX2NoZWNrKCkiLCBFQ19TT0ZUV0FSRSk7CisgICAgfQor
CisKKwogICAgIHJldHVybiBpbnRlcnA7CiB9CiAKZGlmZiAtLWdpdCBhL2ltYXAvbG10cGQuYyBi
L2ltYXAvbG10cGQuYwppbmRleCBhZWUzZDg0Li5jNTVkNWRmIDEwMDY0NAotLS0gYS9pbWFwL2xt
dHBkLmMKKysrIGIvaW1hcC9sbXRwZC5jCkBAIC0xMDQyLDYgKzEwNDIsMTEgQEAgc3RhdGljIGlu
dCB2ZXJpZnlfdXNlcihjb25zdCBjaGFyICp1c2VyLCBjb25zdCBjaGFyICpkb21haW4sIGNoYXIg
Km1haWxib3gsCiAJCSAgICBJTUFQX1BFUk1JU1NJT05fREVOSUVEIDogSU1BUF9NQUlMQk9YX05P
TkVYSVNURU5UOwogCSAgICB9CiAJfSBlbHNlIGlmICghcikgeworICAgICAgICAgICAgaWYgKGNv
bmZpZ19nZXRzd2l0Y2goSU1BUE9QVF9TSUVWRV9RVU9UQSkpIHsKKyAgICAgICAgICAgICAgICAv
LyBxdW90YSB3aWxsIGJlIGNoZWNrZWQgbGF0ZXIKKyAgICAgICAgICAgICAgICBxdW90YWNoZWNr
ID0gLTE7CisgICAgICAgICAgICB9CisKIAkgICAgciA9IGFwcGVuZF9jaGVjayhuYW1lYnVmLCBN
QUlMQk9YX0ZPUk1BVF9OT1JNQUwsIGF1dGhzdGF0ZSwKIAkJCSAgICAgYWNsY2hlY2ssIChxdW90
YWNoZWNrIDwgMCkKIAkJCSAgICAgfHwgY29uZmlnX2dldHN3aXRjaChJTUFQT1BUX0xNVFBfU1RS
SUNUX1FVT1RBKSA/CmRpZmYgLS1naXQgYS9pbWFwL2xtdHBlbmdpbmUuYyBiL2ltYXAvbG10cGVu
Z2luZS5jCmluZGV4IGVmZjNlNTAuLmNkN2FhMzIgMTAwNjQ0Ci0tLSBhL2ltYXAvbG10cGVuZ2lu
ZS5jCisrKyBiL2ltYXAvbG10cGVuZ2luZS5jCkBAIC0zNzUsNiArMzc1LDEyIEBAIGludCBtc2df
Z2V0cmNwdF9pZ25vcmVxdW90YShtZXNzYWdlX2RhdGFfdCAqbSwgaW50IHJjcHRfbnVtKQogICAg
IHJldHVybiBtLT5yY3B0W3JjcHRfbnVtXS0+aWdub3JlcXVvdGE7CiB9CiAKK3ZvaWQgIG1zZ19z
ZXRyY3B0X2lnbm9yZXF1b3RhKG1lc3NhZ2VfZGF0YV90ICptLCBpbnQgcmNwdF9udW0pCit7Cisg
ICAgYXNzZXJ0KDAgPD0gcmNwdF9udW0gJiYgcmNwdF9udW0gPCBtLT5yY3B0X251bSk7CisgICAg
bS0+cmNwdFtyY3B0X251bV0tPmlnbm9yZXF1b3RhPTE7Cit9CisKIC8qIHNldCBhIHJlY2lwaWVu
dCBzdGF0dXM7ICdyJyBzaG91bGQgYmUgYW4gSU1BUCBlcnJvciBjb2RlIHRoYXQgd2lsbCBiZQog
ICAgdHJhbnNsYXRlZCBpbnRvIGFuIExNVFAgc3RhdHVzIGNvZGUgKi8KIHZvaWQgbXNnX3NldHJj
cHRfc3RhdHVzKG1lc3NhZ2VfZGF0YV90ICptLCBpbnQgcmNwdF9udW0sIGludCByKQpkaWZmIC0t
Z2l0IGEvaW1hcC9sbXRwZW5naW5lLmggYi9pbWFwL2xtdHBlbmdpbmUuaAppbmRleCAxOGU0MGNk
Li5jODkxODMyIDEwMDY0NAotLS0gYS9pbWFwL2xtdHBlbmdpbmUuaAorKysgYi9pbWFwL2xtdHBl
bmdpbmUuaApAQCAtOTQsNiArOTQsOSBAQCBjb25zdCBjaGFyICptc2dfZ2V0cmNwdGFsbChtZXNz
YWdlX2RhdGFfdCAqbSwgaW50IHJjcHRfbnVtKTsKIC8qIHJldHVybiBpZ25vcmVxdW90YSBmbGFn
IG9mICdyY3B0X251bScgKi8KIGludCBtc2dfZ2V0cmNwdF9pZ25vcmVxdW90YShtZXNzYWdlX2Rh
dGFfdCAqbSwgaW50IHJjcHRfbnVtKTsKIAorLyogc2V0IGlnbm9yZXF1b3RhIGZsYWcgb2YgJ3Jj
cHRfbnVtJyB0byAxICovCit2b2lkIG1zZ19zZXRyY3B0X2lnbm9yZXF1b3RhKG1lc3NhZ2VfZGF0
YV90ICptLCBpbnQgcmNwdF9udW0pOworCiAvKiBzZXQgYSByZWNpcGllbnQgc3RhdHVzOyAncicg
c2hvdWxkIGJlIGFuIElNQVAgZXJyb3IgY29kZSB0aGF0IHdpbGwgYmUKICAgIHRyYW5zbGF0ZWQg
aW50byBhbiBMTVRQIHN0YXR1cyBjb2RlICovCiB2b2lkIG1zZ19zZXRyY3B0X3N0YXR1cyhtZXNz
YWdlX2RhdGFfdCAqbSwgaW50IHJjcHRfbnVtLCBpbnQgcik7CmRpZmYgLS1naXQgYS9saWIvaW1h
cG9wdGlvbnMgYi9saWIvaW1hcG9wdGlvbnMKaW5kZXggNzUzNzMzMS4uYzQ2ZmRlMyAxMDA2NDQK
LS0tIGEvbGliL2ltYXBvcHRpb25zCisrKyBiL2xpYi9pbWFwb3B0aW9ucwpAQCAtOTY3LDYgKzk2
NywxMCBAQCBwcm9kdWN0IHZlcnNpb24gaW4gdGhlIGNhcGFiaWxpdGllcyAqLwogeyAic2lldmVf
bWF4c2NyaXB0cyIsIDUsIElOVCB9CiAvKiBNYXhpbXVtIG51bWJlciBvZiBzaWV2ZSBzY3JpcHRz
IGFueSB1c2VyIG1heSBoYXZlLCBlbmZvcmNlZCBhdAogICAgc3VibWlzc2lvbiBieSB0aW1zaWV2
ZWQoOCkuICovCisKK3sgInNpZXZlX3F1b3RhIiwgMCwgU1dJVENIIH0KKy8qIFNlbmQgb3ZlcnF1
b3RhIGJvdW5jZXMgYWZ0ZXIgcGFyc2luZyB0aGUgc2lldmUgc2NyaXB0IGFuZCBvbmx5CisgICBm
b3IgbWVzc2FnZXMgd2hpY2ggbWF0Y2ggYSBrZWVwIG9yIGZpbGVpbnRvIHJ1bGUuICovCiAgICAK
IHsgInNpZXZlX3V0ZjhmaWxlaW50byIsIDAsIFNXSVRDSCB9CiAvKiBJZiBlbmFibGVkLCB0aGUg
c2lldmUgZW5naW5lIGV4cGVjdHMgZm9sZGVyIG5hbWVzIGZvciB0aGUKZGlmZiAtLWdpdCBhL3Np
ZXZlL2ludGVycC5jIGIvc2lldmUvaW50ZXJwLmMKaW5kZXggODMzZTU3Zi4uNDI0MWZlYiAxMDA2
NDQKLS0tIGEvc2lldmUvaW50ZXJwLmMKKysrIGIvc2lldmUvaW50ZXJwLmMKQEAgLTI3Miw2ICsy
NzIsMTQgQEAgaW50IHNpZXZlX3JlZ2lzdGVyX2V4ZWN1dGVfZXJyb3Ioc2lldmVfaW50ZXJwX3Qg
KmludGVycCwgc2lldmVfZXhlY3V0ZV9lcnJvciAqZikKICAgICByZXR1cm4gU0lFVkVfT0s7CiB9
CiAKK2ludCBzaWV2ZV9yZWdpc3Rlcl9xdW90YV9jaGVjayhzaWV2ZV9pbnRlcnBfdCAqaW50ZXJw
LCBzaWV2ZV9jYWxsYmFja19xdW90YV9jaGVjayAqZikKK3sKKyAgICBpbnRlcnAtPnF1b3RhX2No
ZWNrID0gZjsKKyAgICByZXR1cm4gU0lFVkVfT0s7Cit9CisKKworCiBpbnQgaW50ZXJwX3Zlcmlm
eShzaWV2ZV9pbnRlcnBfdCAqaSkKIHsKICAgICBpZiAoaS0+cmVkaXJlY3QgJiYgaS0+a2VlcCAm
JiBpLT5nZXRzaXplICYmIGktPmdldGhlYWRlcikgewpkaWZmIC0tZ2l0IGEvc2lldmUvaW50ZXJw
LmggYi9zaWV2ZS9pbnRlcnAuaAppbmRleCAwNWY3M2JhLi5lZDZhNWNmIDEwMDY0NAotLS0gYS9z
aWV2ZS9pbnRlcnAuaAorKysgYi9zaWV2ZS9pbnRlcnAuaApAQCAtNTMsNyArNTMsNyBAQCBzdHJ1
Y3Qgc2lldmVfaW50ZXJwIHsKICAgICBzaWV2ZV9jYWxsYmFjayAqcmVkaXJlY3QsICpkaXNjYXJk
LCAqcmVqZWN0LCAqZmlsZWludG8sICprZWVwOwogICAgIHNpZXZlX2NhbGxiYWNrICpub3RpZnk7
CiAgICAgc2lldmVfdmFjYXRpb25fdCAqdmFjYXRpb247Ci0KKyAgICBzaWV2ZV9jYWxsYmFja19x
dW90YV9jaGVjayAqcXVvdGFfY2hlY2s7CiAgICAgc2lldmVfZ2V0X3NpemUgKmdldHNpemU7CiAg
ICAgc2lldmVfZ2V0X2hlYWRlciAqZ2V0aGVhZGVyOwogICAgIHNpZXZlX2dldF9lbnZlbG9wZSAq
Z2V0ZW52ZWxvcGU7CmRpZmYgLS1naXQgYS9zaWV2ZS9tZXNzYWdlLmggYi9zaWV2ZS9tZXNzYWdl
LmgKaW5kZXggYmQ5ZGE3Mi4uMmI2NDRhZSAxMDA2NDQKLS0tIGEvc2lldmUvbWVzc2FnZS5oCisr
KyBiL3NpZXZlL21lc3NhZ2UuaApAQCAtNDksMjYgKzQ5LDYgQEAKICNpbmNsdWRlICJzaWV2ZV9p
bnRlcmZhY2UuaCIJLyogZm9yIGFjdGlvbiBjb250ZXh0cyAqLwogI2luY2x1ZGUgInRyZWUuaCIJ
CS8qIGZvciBzdHJpbmdsaXN0X3QgKi8KIAotdHlwZWRlZiBzdHJ1Y3QgQWN0aW9uIGFjdGlvbl9s
aXN0X3Q7Ci0KLXR5cGVkZWYgZW51bSB7Ci0gICAgQUNUSU9OX05VTEwgPSAtMSwKLSAgICBBQ1RJ
T05fTk9ORSA9IDAsCi0gICAgQUNUSU9OX1JFSkVDVCwKLSAgICBBQ1RJT05fRklMRUlOVE8sCi0g
ICAgQUNUSU9OX0tFRVAsCi0gICAgQUNUSU9OX1JFRElSRUNULAotICAgIEFDVElPTl9ESVNDQVJE
LAotICAgIEFDVElPTl9WQUNBVElPTiwKLSAgICBBQ1RJT05fU0VURkxBRywKLSAgICBBQ1RJT05f
QURERkxBRywKLSAgICBBQ1RJT05fUkVNT1ZFRkxBRywKLSAgICBBQ1RJT05fTUFSSywKLSAgICBB
Q1RJT05fVU5NQVJLLAotICAgIEFDVElPTl9OT1RJRlksCi0gICAgQUNUSU9OX0RFTk9USUZZCi19
IGFjdGlvbl90OwotCiAvKiBpbmZvcm1hdGlvbiAqLwogYWN0aW9uX2xpc3RfdCAqbmV3X2FjdGlv
bl9saXN0KHZvaWQpOwogdm9pZCBmcmVlX2FjdGlvbl9saXN0KGFjdGlvbl9saXN0X3QgKmFjdGlv
bnMpOwpAQCAtNzcsMjkgKzU3LDYgQEAgdm9pZCBmcmVlX2FjdGlvbl9saXN0KGFjdGlvbl9saXN0
X3QgKmFjdGlvbnMpOwogICAgYW5kIHZhY19zdWJqIGFyZSBmcmVlZC4gIG5vbmUgb2YgdGhlIG90
aGVycyBhcmUgYXV0b21hdGljYWxseSBmcmVlZC4KIAogICAgdGhlIGRvX2FjdGlvbigpIGZ1bmN0
aW9ucyBzaG91bGQgY29weSBwYXJhbSAqLwotc3RydWN0IEFjdGlvbiB7Ci0gICAgYWN0aW9uX3Qg
YTsKLSAgICBpbnQgY2FuY2VsX2tlZXA7Ci0gICAgdW5pb24gewotCXNpZXZlX3JlamVjdF9jb250
ZXh0X3QgcmVqOwotCXNpZXZlX2ZpbGVpbnRvX2NvbnRleHRfdCBmaWw7Ci0Jc2lldmVfa2VlcF9j
b250ZXh0X3Qga2VlcDsKLQlzaWV2ZV9yZWRpcmVjdF9jb250ZXh0X3QgcmVkOwotCXN0cnVjdCB7
Ci0JICAgIC8qIGFkZHIsIGZyb21hZGRyLCBzdWJqIC0gZnJlZWQhICovCi0JICAgIHNpZXZlX3Nl
bmRfcmVzcG9uc2VfY29udGV4dF90IHNlbmQ7Ci0JICAgIHNpZXZlX2F1dG9yZXNwb25kX2NvbnRl
eHRfdCBhdXRvcmVzcDsKLQl9IHZhYzsKLQlzdHJ1Y3QgewotCSAgICBjb25zdCBjaGFyICpmbGFn
OwotCX0gZmxhOwotICAgIH0gdTsKLSAgICBjaGFyICpwYXJhbTsJCS8qIGZyZWVkISAqLwotICAg
IHN0cnVjdCBBY3Rpb24gKm5leHQ7Ci0gICAgY2hhciAqdmFjX3N1Ymo7CQkvKiBmcmVlZCEgKi8K
LSAgICBjaGFyICp2YWNfbXNnOwotICAgIGludCB2YWNfZGF5czsKLX07CiAKIHR5cGVkZWYgc3Ry
dWN0IG5vdGlmeV9saXN0X3MgewogICAgIGludCBpc2FjdGl2ZTsKZGlmZiAtLWdpdCBhL3NpZXZl
L3NjcmlwdC5jIGIvc2lldmUvc2NyaXB0LmMKaW5kZXggYzk3ZDI5My4uZmY1NWVmMyAxMDA2NDQK
LS0tIGEvc2lldmUvc2NyaXB0LmMKKysrIGIvc2lldmUvc2NyaXB0LmMKQEAgLTk0NiwxMSArOTQ2
LDI2IEBAIGludCBzaWV2ZV9leGVjdXRlX2J5dGVjb2RlKHNpZXZlX2V4ZWN1dGVfdCAqZXhlLCBz
aWV2ZV9pbnRlcnBfdCAqaW50ZXJwLAogCQkJCSBhY3Rpb25zX3N0cmluZywgZXJybXNnKTsKIAl9
CiAJZWxzZSB7Ci0JICAgIHJldCA9IGRvX2FjdGlvbl9saXN0KGludGVycCwgJmJvZHlfY2FjaGUs
Ci0JCQkJIHNjcmlwdF9jb250ZXh0LCBtZXNzYWdlX2NvbnRleHQsIAotCQkJCSAmaW1hcGZsYWdz
LCBhY3Rpb25zLCBub3RpZnlfbGlzdCwKLQkJCQkgYWN0aW9uc19zdHJpbmcsIGVycm1zZyk7Ci0J
fQorICAgICAgICAgIGlmIChjb25maWdfZ2V0c3dpdGNoKElNQVBPUFRfU0lFVkVfUVVPVEEpKSB7
CisgICAgICAgICAgICBpZiAoaW50ZXJwLT5xdW90YV9jaGVjaykgeworICAgICAgICAgICAgICBy
ZXQgPSBpbnRlcnAtPnF1b3RhX2NoZWNrKHNjcmlwdF9jb250ZXh0LCBtZXNzYWdlX2NvbnRleHQs
CisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWN0aW9ucyk7Cisg
ICAgICAgICAgICAgIGlmIChyZXQ9PVNJRVZFX09LKSB7CisgICAgICAgICAgICAgICAgcmV0ID0g
ZG9fYWN0aW9uX2xpc3QoaW50ZXJwLCAmYm9keV9jYWNoZSwKKyAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICBzY3JpcHRfY29udGV4dCwgbWVzc2FnZV9jb250ZXh0LAorICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICZpbWFwZmxhZ3MsIGFjdGlvbnMsIG5vdGlmeV9saXN0
LAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFjdGlvbnNfc3RyaW5nLCBlcnJt
c2cpOworICAgICAgICAgICAgICB9CisgICAgICAgICAgICB9IGVsc2UgeworICAgICAgICAgICAg
ICByZXQgPSBTSUVWRV9JTlRFUk5BTF9FUlJPUjsKKyAgICAgICAgICAgIH0KKyAgICAgICAgICB9
IGVsc2UgeworICAgICAgICAgICAgcmV0ID0gZG9fYWN0aW9uX2xpc3QoaW50ZXJwLCAmYm9keV9j
YWNoZSwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NyaXB0X2NvbnRleHQs
IG1lc3NhZ2VfY29udGV4dCwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJmlt
YXBmbGFncywgYWN0aW9ucywgbm90aWZ5X2xpc3QsCisgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgIGFjdGlvbnNfc3RyaW5nLCBlcnJtc2cpOworICAgICAgICAgIH0KKyAgICAgICB9
CiAgICAgfQogCiAgICAgZnJlZV9oYXNoX3RhYmxlKCZib2R5X2NhY2hlLCBmcmVlKTsKZGlmZiAt
LWdpdCBhL3NpZXZlL3NpZXZlX2ludGVyZmFjZS5oIGIvc2lldmUvc2lldmVfaW50ZXJmYWNlLmgK
aW5kZXggYTNmZTAwOC4uNTM0MzExZSAxMDA2NDQKLS0tIGEvc2lldmUvc2lldmVfaW50ZXJmYWNl
LmgKKysrIGIvc2lldmUvc2lldmVfaW50ZXJmYWNlLmgKQEAgLTYzLDYgKzYzLDcgQEAgdHlwZWRl
ZiBzdHJ1Y3QgYnl0ZWNvZGVfaW5mbyBieXRlY29kZV9pbmZvX3Q7CiB0eXBlZGVmIGludCBzaWV2
ZV9jYWxsYmFjayh2b2lkICphY3Rpb25fY29udGV4dCwgdm9pZCAqaW50ZXJwX2NvbnRleHQsIAog
CQkJICAgdm9pZCAqc2NyaXB0X2NvbnRleHQsCiAJCQkgICB2b2lkICptZXNzYWdlX2NvbnRleHQs
IGNvbnN0IGNoYXIgKiplcnJtc2cpOworCiB0eXBlZGVmIGludCBzaWV2ZV9nZXRfc2l6ZSh2b2lk
ICptZXNzYWdlX2NvbnRleHQsIGludCAqc2l6ZSk7CiB0eXBlZGVmIGludCBzaWV2ZV9nZXRfaGVh
ZGVyKHZvaWQgKm1lc3NhZ2VfY29udGV4dCwgCiAJCQkgICAgIGNvbnN0IGNoYXIgKmhlYWRlciwK
QEAgLTE0MSw2ICsxNDIsNTQgQEAgdHlwZWRlZiBzdHJ1Y3Qgc2lldmVfc2VuZF9yZXNwb25zZV9j
b250ZXh0IHsKICAgICBpbnQgbWltZTsKIH0gc2lldmVfc2VuZF9yZXNwb25zZV9jb250ZXh0X3Q7
CiAKK3R5cGVkZWYgc3RydWN0IEFjdGlvbiBhY3Rpb25fbGlzdF90OworCit0eXBlZGVmIGVudW0g
eworICAgIEFDVElPTl9OVUxMID0gLTEsCisgICAgQUNUSU9OX05PTkUgPSAwLAorICAgIEFDVElP
Tl9SRUpFQ1QsCisgICAgQUNUSU9OX0ZJTEVJTlRPLAorICAgIEFDVElPTl9LRUVQLAorICAgIEFD
VElPTl9SRURJUkVDVCwKKyAgICBBQ1RJT05fRElTQ0FSRCwKKyAgICBBQ1RJT05fVkFDQVRJT04s
CisgICAgQUNUSU9OX1NFVEZMQUcsCisgICAgQUNUSU9OX0FEREZMQUcsCisgICAgQUNUSU9OX1JF
TU9WRUZMQUcsCisgICAgQUNUSU9OX01BUkssCisgICAgQUNUSU9OX1VOTUFSSywKKyAgICBBQ1RJ
T05fTk9USUZZLAorICAgIEFDVElPTl9ERU5PVElGWQorfSBhY3Rpb25fdDsKKworc3RydWN0IEFj
dGlvbiB7CisgICAgYWN0aW9uX3QgYTsKKyAgICBpbnQgY2FuY2VsX2tlZXA7CisgICAgdW5pb24g
eworCXNpZXZlX3JlamVjdF9jb250ZXh0X3QgcmVqOworCXNpZXZlX2ZpbGVpbnRvX2NvbnRleHRf
dCBmaWw7CisJc2lldmVfa2VlcF9jb250ZXh0X3Qga2VlcDsKKwlzaWV2ZV9yZWRpcmVjdF9jb250
ZXh0X3QgcmVkOworCXN0cnVjdCB7CisJICAgIC8qIGFkZHIsIGZyb21hZGRyLCBzdWJqIC0gZnJl
ZWQhICovCisJICAgIHNpZXZlX3NlbmRfcmVzcG9uc2VfY29udGV4dF90IHNlbmQ7CisJICAgIHNp
ZXZlX2F1dG9yZXNwb25kX2NvbnRleHRfdCBhdXRvcmVzcDsKKwl9IHZhYzsKKwlzdHJ1Y3Qgewor
CSAgICBjb25zdCBjaGFyICpmbGFnOworCX0gZmxhOworICAgIH0gdTsKKyAgICBjaGFyICpwYXJh
bTsJCS8qIGZyZWVkISAqLworICAgIHN0cnVjdCBBY3Rpb24gKm5leHQ7CisgICAgY2hhciAqdmFj
X3N1Ymo7CQkvKiBmcmVlZCEgKi8KKyAgICBjaGFyICp2YWNfbXNnOworICAgIGludCB2YWNfZGF5
czsKK307CisKK3R5cGVkZWYgaW50IHNpZXZlX2NhbGxiYWNrX3F1b3RhX2NoZWNrKCB2b2lkICpz
Y3JpcHRfY29udGV4dCwKKwkJCQkJdm9pZCAqbWVzc2FnZV9jb250ZXh0LAorCQkJCQlhY3Rpb25f
bGlzdF90ICphY3Rpb25zKTsKKwogLyogYnVpbGQgYSBzaWV2ZSBpbnRlcnByZXRvciAqLwogaW50
IHNpZXZlX2ludGVycF9hbGxvYyhzaWV2ZV9pbnRlcnBfdCAqKmludGVycCwgdm9pZCAqaW50ZXJw
X2NvbnRleHQpOwogaW50IHNpZXZlX2ludGVycF9mcmVlKHNpZXZlX2ludGVycF90ICoqaW50ZXJw
KTsKQEAgLTE1Niw2ICsyMDUsNyBAQCBpbnQgc2lldmVfcmVnaXN0ZXJfdmFjYXRpb24oc2lldmVf
aW50ZXJwX3QgKmludGVycCwgc2lldmVfdmFjYXRpb25fdCAqdik7CiBpbnQgc2lldmVfcmVnaXN0
ZXJfaW1hcGZsYWdzKHNpZXZlX2ludGVycF90ICppbnRlcnAsIHNpZXZlX2ltYXBmbGFnc190ICpt
YXJrKTsKIGludCBzaWV2ZV9yZWdpc3Rlcl9ub3RpZnkoc2lldmVfaW50ZXJwX3QgKmludGVycCwg
c2lldmVfY2FsbGJhY2sgKmYpOwogaW50IHNpZXZlX3JlZ2lzdGVyX2luY2x1ZGUoc2lldmVfaW50
ZXJwX3QgKmludGVycCwgc2lldmVfZ2V0X2luY2x1ZGUgKmYpOworaW50IHNpZXZlX3JlZ2lzdGVy
X3F1b3RhX2NoZWNrKHNpZXZlX2ludGVycF90ICppbnRlcnAsIHNpZXZlX2NhbGxiYWNrX3F1b3Rh
X2NoZWNrICpmKTsKIAogLyogYWRkIHRoZSBjYWxsYmFja3MgZm9yIG1lc3NhZ2VzLiBhZ2Fpbiwg
dW5kZWZpbmVkIGlmIHVzZWQgYWZ0ZXIKICAgIHNpZXZlX3NjcmlwdF9wYXJzZSAqLwpAQCAtMTkw
LDcgKzI0MCw2IEBAIGludCBzaWV2ZV9zY3JpcHRfZnJlZShzaWV2ZV9zY3JpcHRfdCAqKnMpOwog
LyogZXhlY3V0ZSBieXRlY29kZSBvbiBhIG1lc3NhZ2UgKi8KIGludCBzaWV2ZV9leGVjdXRlX2J5
dGVjb2RlKHNpZXZlX2V4ZWN1dGVfdCAqc2NyaXB0LCBzaWV2ZV9pbnRlcnBfdCAqaW50ZXJwLAog
CQkJICAgdm9pZCAqc2NyaXB0X2NvbnRleHQsIHZvaWQgKm1lc3NhZ2VfY29udGV4dCk7Ci0KIC8q
IEdldCBzcGFjZSBzZXBhcmF0ZWQgbGlzdCBvZiBleHRlbnNpb25zIHN1cHBvcnRlZCBieSB0aGUg
aW1wbGVtZW50YXRpb24gKi8KIGNvbnN0IGNoYXIgKnNpZXZlX2xpc3RleHRlbnNpb25zKHNpZXZl
X2ludGVycF90ICppKTsKIAo=
</data>        

          </attachment>
      

    </bug>

</bugzilla>