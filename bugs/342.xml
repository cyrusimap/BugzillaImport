<?xml version="1.0" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugzilla.cyrusimap.org/bugzilla.dtd">

<bugzilla version="3.2.5.1-2"
          urlbase="https://bugzilla.cyrusimap.org/"
          maintainer="Dave McMurtrie &lt;dave64@andrew.cmu.edu&gt;"
>

    <bug>
          <bug_id>342</bug_id>
          
          <creation_ts>2000-10-18 16:07 EDT</creation_ts>
          <short_desc>proxyd hurts pipelining client&apos;s performance</short_desc>
          <delta_ts>2010-10-18 12:42:49 EDT</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Cyrus IMAP</product>
          <component>Murder</component>
          <version>2.0.x</version>
          <rep_platform>PC</rep_platform>
          <op_sys>Linux</op_sys>
          <bug_status>CLOSED</bug_status>
          <resolution>FIXED</resolution>
          
          
          
          
          <priority>P3</priority>
          <bug_severity>bug</bug_severity>
          <target_milestone>Future</target_milestone>
          
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Larry Greenfield">leg+cyrus@andrew.cmu.edu</reporter>
          <assigned_to name="Rob Siemborski">rjs3@andrew.cmu.edu</assigned_to>
          
          

      

      

      
          <long_desc isprivate="0">
            <who name="Larry Greenfield">leg+cyrus@andrew.cmu.edu</who>
            <bug_when>2000-10-18 16:07:35 EDT</bug_when>
            <thetext>since proxyd will read one command at a time, send it to the backend, wait for
the response, and repeat, it hurts pipelining client&apos;s performance.

it turns a series of pipelined commands into non-pipelined ones by the time they
hit the backend server.

batimail does
client -&gt; imapd: 
  01 SELECT &lt;mailbox&gt;
  02 UID SEARCH unseen
imapd -&gt; client 
  ...
  01 OK
  ...
  02 OK

now we have
client -&gt; proxyd:
  01 SELECT &lt;mailbox&gt;
  02 UID SEARCH unseen
proxyd -&gt; imapd 
  01 SELECT &lt;mailbox&gt;
imapd -&gt; proxyd 
  ...
  01 OK
proxyd -&gt; imapd 
  02 UID SEARCH unseen]
imapd -&gt; proxyd 
  ...
  02 OK
proxyd -&gt; client
  ...
  01 OK
  ...
  02 OK</thetext>
          </long_desc>
          <long_desc isprivate="0">
            <who name="Ken Murchison">ken@oceana.com</who>
            <bug_when>2004-03-15 11:12:29 EDT</bug_when>
            <thetext>Created an attachment (id=271)
working prototype for pipelining

This patch takes advantage of the fact that imapd will always process commands
in order.</thetext>
          </long_desc>
          <long_desc isprivate="0">
            <who name="Ken Murchison">ken@oceana.com</who>
            <bug_when>2004-03-15 13:49:21 EDT</bug_when>
            <thetext>Created an attachment (id=272)
pipelining to selected backend only

Quickie rewrite of full patch.	Not tested as much as full patch.</thetext>
          </long_desc>
          <long_desc isprivate="0">
            <who name="Ken Murchison">ken@oceana.com</who>
            <bug_when>2004-08-06 12:42:57 EDT</bug_when>
            <thetext>Created an attachment (id=301)
pipeline to selected backend only patch for 2.3

Considering adding this to 2.3.  Will definitely need more testing, but it
doesn&apos;t seem to break anything in my testing (2 users using the proxy
exclusively).</thetext>
          </long_desc>
          <long_desc isprivate="0">
            <who name="Ken Murchison">ken@oceana.com</who>
            <bug_when>2004-09-01 17:14:17 EDT</bug_when>
            <thetext>Implemented in 2.3.  In my limited testing, pipelining seems to work and nothing
else is broken.  Needs testing with more backends and clients.</thetext>
          </long_desc>
      
          <attachment
              isobsolete="0"
              ispatch="1"
              isprivate="0"
          >
            <attachid>271</attachid>
            <date>2004-03-15 11:12 EDT</date>
            <desc>working prototype for pipelining</desc>
            <filename>proxyd-piplining.patch</filename>
            <type>text/plain</type>
            <size>19165</size>
            <attacher>ken@oceana.com</attacher>
            
              <data encoding="base64">SW5kZXg6IGltYXAvcHJveHlkLmMKPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQpSQ1MgZmlsZTogL2Fmcy9hbmRyZXcvc3lz
dGVtL2N2cy9zcmMvY3lydXMvaW1hcC9wcm94eWQuYyx2CnJldHJpZXZpbmcgcmV2aXNpb24gMS4x
NzgKZGlmZiAtYyAtcjEuMTc4IHByb3h5ZC5jCioqKiBpbWFwL3Byb3h5ZC5jCTkgTWFyIDIwMDQg
MTg6MDg6NDEgLTAwMDAJMS4xNzgKLS0tIGltYXAvcHJveHlkLmMJMTUgTWFyIDIwMDQgMTY6MDI6
NDAgLTAwMDAKKioqKioqKioqKioqKioqCioqKiAxMzcsMTQyICoqKioKLS0tIDEzNywxNDMgLS0t
LQogIC8qIHBlci11c2VyIHNlc3Npb24gc3RhdGUgKi8KICBzdHJ1Y3QgcHJvdHN0cmVhbSAqcHJv
eHlkX291dCA9IE5VTEw7CiAgc3RydWN0IHByb3RzdHJlYW0gKnByb3h5ZF9pbiA9IE5VTEw7Cisg
c3RydWN0IHByb3Rncm91cCAqcHJvdGluID0gTlVMTDsKICBzdGF0aWMgY2hhciBwcm94eWRfY2xp
ZW50aG9zdFtOSV9NQVhIT1NUKjIrMV0gPSAiW2xvY2FsXSI7CiAgc3RhdGljIGludCBwcm94eWRf
bG9nZmQgPSAtMTsKICB0aW1lX3QgcHJveHlkX2xvZ3RpbWU7CioqKioqKioqKioqKioqKgoqKiog
ODc3LDg4MiAqKioqCi0tLSA4NzgsODg1IC0tLS0KICAJcmV0dXJuOwogICAgICB9CiAgCisgICAg
IHByb3Rncm91cF9kZWxldGUocHJvdGluLCBzLT5pbik7CisgCiAgICAgIC8qIG5lZWQgdG8gbG9n
b3V0IG9mIHNlcnZlciAqLwogICAgICBiYWNrZW5kX2Rpc2Nvbm5lY3QocywgJnByb3RvY29sW1BS
T1RPQ09MX0lNQVBdKTsKICAKKioqKioqKioqKioqKioqCioqKiA5MzksOTQ0ICoqKioKLS0tIDk0
Miw5NDkgLS0tLQogIAkvKiBhZGQgdGhlIHRpbWVvdXQgKi8KICAJcmV0LT50aW1lb3V0ID0gcHJv
dF9hZGR3YWl0ZXZlbnQocHJveHlkX2luLCB0aW1lKE5VTEwpICsgSURMRV9USU1FT1VULAogIAkJ
CQkJIGJhY2tlbmRfdGltZW91dCwgcmV0KTsKKyAKKyAJcHJvdGdyb3VwX2luc2VydChwcm90aW4s
IHJldC0+aW4pOwogICAgICB9CiAgCiAgICAgIHJldC0+dGltZW91dC0+bWFyayA9IHRpbWUoTlVM
TCkgKyBJRExFX1RJTUVPVVQ7CioqKioqKioqKioqKioqKgoqKiogMTExMCwxMTE1ICoqKioKLS0t
IDExMTUsMTEyMyAtLS0tCiAgICAgIAogICAgICBwcm94eWRfaW4gPSBwcm94eWRfb3V0ID0gTlVM
TDsKICAKKyAgICAgaWYgKHByb3RpbikgcHJvdGdyb3VwX2ZyZWUocHJvdGluKTsKKyAgICAgcHJv
dGluID0gTlVMTDsKKyAKICAjaWZkZWYgSEFWRV9TU0wKICAgICAgaWYgKHRsc19jb25uKSB7CiAg
CWlmICh0bHNfcmVzZXRfc2VydmVydGxzKCZ0bHNfY29ubikgPT0gLTEpIHsKKioqKioqKioqKioq
KioqCioqKiAxMzMzLDEzMzggKioqKgotLS0gMTM0MSwxMzQ4IC0tLS0KICAJcHJvdF9mcmVlKHBy
b3h5ZF9vdXQpOwogICAgICB9CiAgCisgICAgIGlmIChwcm90aW4pIHByb3Rncm91cF9mcmVlKHBy
b3Rpbik7CisgCiAgI2lmZGVmIEhBVkVfU1NMCiAgICAgIHRsc19zaHV0ZG93bl9zZXJ2ZXJlbmdp
bmUoKTsKICAjZW5kaWYKKioqKioqKioqKioqKioqCioqKiAxMzg3LDEzOTMgKioqKgotLS0gMTM5
NywxNDEwIC0tLS0KICAJY2xvc2UoZmQpOwogICAgICB9CiAgCisgICAgIHByb3RpbiA9IHByb3Rn
cm91cF9uZXcoMik7IC8qIFhYWCBzaG91bGQgd2Ugc3RhcnQgd2l0aCBtb3JlPyAqLworICAgICBw
cm90Z3JvdXBfaW5zZXJ0KHByb3RpbiwgcHJveHlkX2luKTsKKyAKICAgICAgZm9yICg7Oykgewor
IAlzdHJ1Y3QgcHJvdGdyb3VwICpwcm90b3V0ID0gTlVMTDsKKyAJc3RydWN0IHRpbWV2YWwgdGlt
ZW91dDsKKyAJaW50IG4sIGNsaWVudGluOworIAogIAlpZiAoISBwcm94eWRfdXNlcmlzYWRtaW4g
JiYgc2h1dGRvd25fZmlsZShzaHV0LCBzaXplb2Yoc2h1dCkpKSB7CiAgCSAgICBmb3IgKHAgPSBz
aHV0OyAqcCA9PSAnWyc7IHArKyk7IC8qIGNhbid0IGhhdmUgWyBiZSBmaXJzdCBjaGFyICovCiAg
CSAgICBwcm90X3ByaW50Zihwcm94eWRfb3V0LCAiKiBCWUUgW0FMRVJUXSAlc1xyXG4iLCBwKTsK
KioqKioqKioqKioqKioqCioqKiAxMzk2LDE0MDEgKioqKgotLS0gMTQxMywxNDcwIC0tLS0KICAK
ICAJc2lnbmFsc19wb2xsKCk7CiAgCisgCS8qIGZsdXNoIGFueSBidWZmZXJlZCBvdXRwdXQgKi8K
KyAJbiA9IDA7CisgCXdoaWxlIChiYWNrZW5kX2NhY2hlZFtuXSkgeworIAkgICAgaWYgKGJhY2tl
bmRfY2FjaGVkW25dLT5vdXQpIHByb3RfZmx1c2goYmFja2VuZF9jYWNoZWRbbl0tPm91dCk7Cisg
CSAgICBuKys7CisgCX0KKyAJcHJvdF9mbHVzaChwcm94eWRfb3V0KTsKKyAKKyAJdGltZW91dC50
dl9zZWMgPSA2MDsKKyAJdGltZW91dC50dl91c2VjID0gMDsKKyAKKyAJbiA9IHByb3Rfc2VsZWN0
KHByb3RpbiwgUFJPVF9OT19GRCwgJnByb3RvdXQsIE5VTEwsICZ0aW1lb3V0KTsKKyAJaWYgKG4g
PT0gLTEpIHsKKyAJICAgIHN5c2xvZyhMT0dfRVJSLCAicHJvdF9zZWxlY3QoKSBmYWlsZWQgaW4g
Y21kbG9vcCgpOiAlbSIpOworIAkgICAgZmF0YWwoInByb3Rfc2VsZWN0KCkgZmFpbGVkIGluIGNt
ZGxvb3AoKSIsIEVDX1RFTVBGQUlMKTsKKyAJfQorIAorIAljbGllbnRpbiA9IDA7CisgCWlmIChu
ICYmIHByb3RvdXQpIHsKKyAJICAgIHN0cnVjdCBwcm90c3RyZWFtICpwdG1wOworIAorIAkgICAg
Lyogc2VlIHdobyBoYXMgaW5wdXQgKi8KKyAJICAgIGZvciAoOyBuOyBuLS0pIHsKKyAJCXB0bXAg
PSBwcm90Z3JvdXBfZ2V0ZWxlbWVudChwcm90b3V0LCBuLTEpOworIAorIAkJaWYgKHB0bXAgPT0g
cHJveHlkX2luKSB7CisgCQkgICAgLyogaW5wdXQgZnJvbSBjbGllbnQsIHByb2Nlc3MgaXQgbGF0
ZXIgKi8KKyAJCSAgICBjbGllbnRpbiA9IDE7CisgCQl9IGVsc2UgeworIAkJICAgIC8qIGlucHV0
IGZyb20gYSBiYWNrZW5kLCBzdHJlYW0gaXQgdG8gY2xpZW50ICovCisgCQkgICAgZG8geworIAkJ
CWNoYXIgYnVmWzQwOTZdOworIAkJCWludCBjID0gcHJvdF9yZWFkKHB0bXAsIGJ1Ziwgc2l6ZW9m
KGJ1ZikpOworIAkJCWlmIChjID09IDAgfHwgYyA8IDApIGJyZWFrOworIAkJCXByb3Rfd3JpdGUo
cHJveHlkX291dCwgYnVmLCBjKTsKKyAJCSAgICB9IHdoaWxlIChwdG1wLT5jbnQgPiAwKTsKKyAK
KyAJCSAgICBpZiAocHJvdF9lcnJvcihwdG1wKSkgeworIAkJCS8qIHVoIG9oLCB3ZSdyZSBub3Qg
aGFwcHkgKi8KKyAJCQlmYXRhbCgiTG9zdCBjb25uZWN0aW9uIHRvIGJhY2tlbmQiLCBFQ19VTkFW
QUlMQUJMRSk7CisgCQkgICAgfQorIAkJfQorIAkgICAgfQorIAl9CisgCWlmIChwcm90b3V0KSBw
cm90Z3JvdXBfZnJlZShwcm90b3V0KTsKKyAJcHJvdG91dCA9IE5VTEw7CisgCisgCWlmICghY2xp
ZW50aW4pIHsKKyAJICAgIC8qIG5vIGlucHV0IGZyb20gY2xpZW50ICovCisgCSAgICBjb250aW51
ZTsKKyAJfQorIAogIAkvKiBQYXJzZSB0YWcgKi8KICAJYyA9IGdldHdvcmQocHJveHlkX2luLCAm
dGFnKTsKICAJaWYgKGMgPT0gRU9GKSB7CioqKioqKioqKioqKioqKgoqKiogMTY2MiwxNjcwICoq
KioKLS0tIDE3MzEsMTc1MSAtLS0tCiAgCQljbWRfbG9naW4odGFnLnMsIGFyZzEucyk7CiAgCSAg
ICB9CiAgCSAgICBlbHNlIGlmICghc3RyY21wKGNtZC5zLCAiTG9nb3V0IikpIHsKKyAJCWNoYXIg
bXl0YWdbMTI4XTsKKyAJCWludCBpID0gMDsKKyAKICAJCWlmIChjID09ICdccicpIGMgPSBwcm90
X2dldGMocHJveHlkX2luKTsKICAJCWlmIChjICE9ICdcbicpIGdvdG8gZXh0cmFhcmdzOwogIAkJ
CisgCQkvKiBmb3JjZSBhbnkgcmVzcG9uc2VzIGZyb20gb3VyIGJhY2tlbmRzICovCisgCQl3aGls
ZSAoYmFja2VuZF9jYWNoZWRbaV0pIHsKKyAJCSAgICBwcm94eWRfZ2VudGFnKG15dGFnLCBzaXpl
b2YobXl0YWcpKTsKKyAKKyAJCSAgICBwcm90X3ByaW50ZihiYWNrZW5kX2NhY2hlZFtpXS0+b3V0
LCAiJXMgTm9vcFxyXG4iLCBteXRhZyk7CisgCQkgICAgcGlwZV91bnRpbF90YWcoYmFja2VuZF9j
YWNoZWRbaV0sIG15dGFnLCAwKTsKKyAJCSAgICBpKys7CisgCQl9CisgCiAgCQlwcm90X3ByaW50
Zihwcm94eWRfb3V0LCAKICAJCQkgICAgIiogQllFICVzXHJcbiIsIGVycm9yX21lc3NhZ2UoSU1B
UF9CWUVfTE9HT1VUKSk7CiAgCQlwcm90X3ByaW50Zihwcm94eWRfb3V0LCAiJXMgT0sgJXNcclxu
IiwgCioqKioqKioqKioqKioqKgoqKiogMjMwNiwyMzEyICoqKioKICB7CiAgICAgIGlmIChiYWNr
ZW5kX2N1cnJlbnQpIHsKICAJcHJvdF9wcmludGYoYmFja2VuZF9jdXJyZW50LT5vdXQsICIlcyAl
c1xyXG4iLCB0YWcsIGNtZCk7Ci0gCXBpcGVfaW5jbHVkaW5nX3RhZyhiYWNrZW5kX2N1cnJlbnQs
IHRhZywgMCk7CiAgICAgIH0gZWxzZSB7CiAgCXByb3RfcHJpbnRmKHByb3h5ZF9vdXQsICIlcyBP
SyAlc1xyXG4iLCB0YWcsCiAgCQkgICAgZXJyb3JfbWVzc2FnZShJTUFQX09LX0NPTVBMRVRFRCkp
OwotLS0gMjM4NywyMzkyIC0tLS0KKioqKioqKioqKioqKioqCioqKiAyNTIxLDI1MjggKioqKgog
IHsKICAgICAgc3RhdGljIGludCBpZGxlX3BlcmlvZCA9IC0xOwogICAgICBzdGF0aWMgc3RydWN0
IGJ1ZiBhcmc7CiEgICAgIHN0cnVjdCBwcm90Z3JvdXAgKnByb3RpbiA9IHByb3Rncm91cF9uZXco
Mik7CiEgICAgIHN0cnVjdCBwcm90Z3JvdXAgKnByb3RvdXQgPSBOVUxMOwogICAgICBzdHJ1Y3Qg
dGltZXZhbCB0aW1lb3V0OwogICAgICBpbnQgYyA9IEVPRiwgbiwgZG9uZSA9IDAsIHNodXRkb3du
ID0gMDsKICAgICAgY2hhciBidWZbMjA0OF0sIHNodXRbMTAyNF07Ci0tLSAyNjAxLDI2MDggLS0t
LQogIHsKICAgICAgc3RhdGljIGludCBpZGxlX3BlcmlvZCA9IC0xOwogICAgICBzdGF0aWMgc3Ry
dWN0IGJ1ZiBhcmc7CiEgICAgIHN0cnVjdCBwcm90Z3JvdXAgKmlkbGVpbiA9IHByb3Rncm91cF9u
ZXcoMik7CiEgICAgIHN0cnVjdCBwcm90Z3JvdXAgKmlkbGVvdXQgPSBOVUxMOwogICAgICBzdHJ1
Y3QgdGltZXZhbCB0aW1lb3V0OwogICAgICBpbnQgYyA9IEVPRiwgbiwgZG9uZSA9IDAsIHNodXRk
b3duID0gMDsKICAgICAgY2hhciBidWZbMjA0OF0sIHNodXRbMTAyNF07CioqKioqKioqKioqKioq
KgoqKiogMjU0MCwyNTQ3ICoqKioKICAgICAgfQogIAogICAgICAvKiBSZXNldCBwcm90aW4gdG8g
YWxsIHplcm9zICh0byBwcmVzZXJ2ZSBtZW1vcnkgYWxsb2NhdGlvbikgKi8KISAgICAgcHJvdGdy
b3VwX3Jlc2V0KHByb3Rpbik7CiEgICAgIHByb3Rncm91cF9pbnNlcnQocHJvdGluLCBwcm94eWRf
aW4pOwogIAogICAgICBpZiAoYmFja2VuZF9jdXJyZW50ICYmIENBUEEoYmFja2VuZF9jdXJyZW50
LCBDQVBBX0lETEUpKSB7CiAgCS8qIFN0YXJ0IElETEUgb24gYmFja2VuZCAqLwotLS0gMjYyMCwy
NjI3IC0tLS0KICAgICAgfQogIAogICAgICAvKiBSZXNldCBwcm90aW4gdG8gYWxsIHplcm9zICh0
byBwcmVzZXJ2ZSBtZW1vcnkgYWxsb2NhdGlvbikgKi8KISAgICAgcHJvdGdyb3VwX3Jlc2V0KGlk
bGVpbik7CiEgICAgIHByb3Rncm91cF9pbnNlcnQoaWRsZWluLCBwcm94eWRfaW4pOwogIAogICAg
ICBpZiAoYmFja2VuZF9jdXJyZW50ICYmIENBUEEoYmFja2VuZF9jdXJyZW50LCBDQVBBX0lETEUp
KSB7CiAgCS8qIFN0YXJ0IElETEUgb24gYmFja2VuZCAqLwoqKioqKioqKioqKioqKioKKioqIDI1
NjEsMjU2NyAqKioqCiAgCSAgICBnb3RvIGRvbmU7CiAgCX0KICAKISAJcHJvdGdyb3VwX2luc2Vy
dChwcm90aW4sIGJhY2tlbmRfY3VycmVudC0+aW4pOwogICAgICB9CiAgCiAgICAgIC8qIFRlbGwg
Y2xpZW50IHdlIGFyZSBpZGxpbmcgYW5kIHdhaXRpbmcgZm9yIGVuZCBvZiBjb21tYW5kICovCi0t
LSAyNjQxLDI2NDcgLS0tLQogIAkgICAgZ290byBkb25lOwogIAl9CiAgCiEgCXByb3Rncm91cF9p
bnNlcnQoaWRsZWluLCBiYWNrZW5kX2N1cnJlbnQtPmluKTsKICAgICAgfQogIAogICAgICAvKiBU
ZWxsIGNsaWVudCB3ZSBhcmUgaWRsaW5nIGFuZCB3YWl0aW5nIGZvciBlbmQgb2YgY29tbWFuZCAq
LwoqKioqKioqKioqKioqKioKKioqIDI1ODUsMjYwNyAqKioqCiAgCSAgICBwcm90X2ZsdXNoKHBy
b3h5ZF9vdXQpOwogIAl9CiAgCiEgCS8qIENsZWFyIHByb3RvdXQgaWYgbmVlZGVkICovCiEgCXBy
b3Rncm91cF9mcmVlKHByb3RvdXQpOwohIAlwcm90b3V0ID0gTlVMTDsKICAKICAJdGltZW91dC50
dl9zZWMgPSBpZGxlX3BlcmlvZDsKICAJdGltZW91dC50dl91c2VjID0gMDsKICAKISAJbiA9IHBy
b3Rfc2VsZWN0KHByb3RpbiwgUFJPVF9OT19GRCwgJnByb3RvdXQsIE5VTEwsICZ0aW1lb3V0KTsK
ICAJaWYgKG4gPT0gLTEpIHsKICAJICAgIHN5c2xvZyhMT0dfRVJSLCAicHJvdF9zZWxlY3QoKSBm
YWlsZWQgaW4gY21kX2lkbGUoKTogJW0iKTsKICAJICAgIGZhdGFsKCJwcm90X3NlbGVjdCgpIGZh
aWxlZCBpbiBjbWRfaWRsZSgpIiwgRUNfVEVNUEZBSUwpOwogIAl9CiEgCWlmIChuICYmIHByb3Rv
dXQpIHsKICAJICAgIHN0cnVjdCBwcm90c3RyZWFtICpwdG1wOwogIAogIAkgICAgZm9yICg7IG47
IG4tLSkgewohIAkJcHRtcCA9IHByb3Rncm91cF9nZXRlbGVtZW50KHByb3RvdXQsIG4tMSk7CiAg
CQlpZiAocHRtcCA9PSBwcm94eWRfaW4pIHsKICAJCSAgICAvKiBUaGUgY2xpZW50IHNlbnQgdXMg
c29tZXRoaW5nLCB3ZSdyZSBkb25lICovCiAgCQkgICAgZG9uZSA9IDE7Ci0tLSAyNjY1LDI2ODcg
LS0tLQogIAkgICAgcHJvdF9mbHVzaChwcm94eWRfb3V0KTsKICAJfQogIAohIAkvKiBDbGVhciBp
ZGxlb3V0IGlmIG5lZWRlZCAqLwohIAlwcm90Z3JvdXBfZnJlZShpZGxlb3V0KTsKISAJaWRsZW91
dCA9IE5VTEw7CiAgCiAgCXRpbWVvdXQudHZfc2VjID0gaWRsZV9wZXJpb2Q7CiAgCXRpbWVvdXQu
dHZfdXNlYyA9IDA7CiAgCiEgCW4gPSBwcm90X3NlbGVjdChpZGxlaW4sIFBST1RfTk9fRkQsICZp
ZGxlb3V0LCBOVUxMLCAmdGltZW91dCk7CiAgCWlmIChuID09IC0xKSB7CiAgCSAgICBzeXNsb2co
TE9HX0VSUiwgInByb3Rfc2VsZWN0KCkgZmFpbGVkIGluIGNtZF9pZGxlKCk6ICVtIik7CiAgCSAg
ICBmYXRhbCgicHJvdF9zZWxlY3QoKSBmYWlsZWQgaW4gY21kX2lkbGUoKSIsIEVDX1RFTVBGQUlM
KTsKICAJfQohIAlpZiAobiAmJiBpZGxlb3V0KSB7CiAgCSAgICBzdHJ1Y3QgcHJvdHN0cmVhbSAq
cHRtcDsKICAKICAJICAgIGZvciAoOyBuOyBuLS0pIHsKISAJCXB0bXAgPSBwcm90Z3JvdXBfZ2V0
ZWxlbWVudChpZGxlb3V0LCBuLTEpOwogIAkJaWYgKHB0bXAgPT0gcHJveHlkX2luKSB7CiAgCQkg
ICAgLyogVGhlIGNsaWVudCBzZW50IHVzIHNvbWV0aGluZywgd2UncmUgZG9uZSAqLwogIAkJICAg
IGRvbmUgPSAxOwoqKioqKioqKioqKioqKioKKioqIDI2MzQsMjY0MSAqKioqCiAgICAgIGMgPSBn
ZXR3b3JkKHByb3h5ZF9pbiwgJmFyZyk7CiAgCiAgICBkb25lOgohICAgICBwcm90Z3JvdXBfZnJl
ZShwcm90aW4pOwohICAgICBwcm90Z3JvdXBfZnJlZShwcm90b3V0KTsKICAKICAgICAgaWYgKGRv
bmUgJiYgYmFja2VuZF9jdXJyZW50ICYmIENBUEEoYmFja2VuZF9jdXJyZW50LCBDQVBBX0lETEUp
KSB7CiAgCS8qIEVpdGhlciB0aGUgY2xpZW50IHRpbWVkIG91dCwgb3IgZ2F2ZSB1cyBhIGNvbnRp
bnVhdGlvbiwKLS0tIDI3MTQsMjcyMSAtLS0tCiAgICAgIGMgPSBnZXR3b3JkKHByb3h5ZF9pbiwg
JmFyZyk7CiAgCiAgICBkb25lOgohICAgICBwcm90Z3JvdXBfZnJlZShpZGxlaW4pOwohICAgICBw
cm90Z3JvdXBfZnJlZShpZGxlb3V0KTsKICAKICAgICAgaWYgKGRvbmUgJiYgYmFja2VuZF9jdXJy
ZW50ICYmIENBUEEoYmFja2VuZF9jdXJyZW50LCBDQVBBX0lETEUpKSB7CiAgCS8qIEVpdGhlciB0
aGUgY2xpZW50IHRpbWVkIG91dCwgb3IgZ2F2ZSB1cyBhIGNvbnRpbnVhdGlvbiwKKioqKioqKioq
KioqKioqCioqKiAyNzQ5LDI3NzcgKioqKgogIAlpZiAoIXMpIHIgPSBJTUFQX1NFUlZFUl9VTkFW
QUlMQUJMRTsKICAgICAgfQogICAgICBpZiAoIXIpIHsKISAJcHJvdF9wcmludGYocy0+b3V0LCAi
JXMgQXBwZW5kIHslZCt9XHJcbiVzICIsIHRhZywgc3RybGVuKG5hbWUpLCBuYW1lKTsKISAJaWYg
KCFwaXBlX2NvbW1hbmQocywgMTYzODQpKSB7CiEgCSAgICBwaXBlX3VudGlsX3RhZyhzLCB0YWcs
IDApOwohIAl9CiEgICAgIH0gZWxzZSB7CiEgCWVhdGxpbmUocHJveHlkX2luLCBwcm90X2dldGMo
cHJveHlkX2luKSk7CiEgICAgIH0KISAKISAgICAgaWYgKGJhY2tlbmRfY3VycmVudCAmJiBiYWNr
ZW5kX2N1cnJlbnQgIT0gcykgewohIAljaGFyIG15dGFnWzEyOF07CiAgCiEgCXByb3h5ZF9nZW50
YWcobXl0YWcsIHNpemVvZihteXRhZykpOwogIAkKISAJcHJvdF9wcmludGYoYmFja2VuZF9jdXJy
ZW50LT5vdXQsICIlcyBOb29wXHJcbiIsIG15dGFnKTsKISAJcGlwZV91bnRpbF90YWcoYmFja2Vu
ZF9jdXJyZW50LCBteXRhZywgMCk7CiEgICAgIH0KICAKISAgICAgaWYgKHIpIHsKISAJcHJvdF9w
cmludGYocHJveHlkX291dCwgIiVzIE5PICVzXHJcbiIsIHRhZywgZXJyb3JfbWVzc2FnZShyKSk7
CiAgICAgIH0gZWxzZSB7CiEgCS8qIHdlJ3JlIGFsbG93ZWQgdG8gcmVmZXJlbmNlIGxhc3RfcmVz
dWx0IHNpbmNlIHRoZSBub29wLCBpZgohIAkgICBzZW50LCB3ZW50IHRvIGEgZGlmZmVyZW50IHNl
cnZlciAqLwohIAlwcm90X3ByaW50Zihwcm94eWRfb3V0LCAiJXMgJXMiLCB0YWcsIHMtPmxhc3Rf
cmVzdWx0KTsKICAgICAgfQogIH0KICAKLS0tIDI4MjksMjg0OCAtLS0tCiAgCWlmICghcykgciA9
IElNQVBfU0VSVkVSX1VOQVZBSUxBQkxFOwogICAgICB9CiAgICAgIGlmICghcikgewohIAlpZiAo
YmFja2VuZF9jdXJyZW50ICYmIGJhY2tlbmRfY3VycmVudCAhPSBzKSB7CiEgCSAgICBjaGFyIG15
dGFnWzEyOF07CiAgCiEgCSAgICBwcm94eWRfZ2VudGFnKG15dGFnLCBzaXplb2YobXl0YWcpKTsK
ICAJCiEgCSAgICBwcm90X3ByaW50ZihiYWNrZW5kX2N1cnJlbnQtPm91dCwgIiVzIE5vb3Bcclxu
IiwgbXl0YWcpOwohIAkgICAgcGlwZV91bnRpbF90YWcoYmFja2VuZF9jdXJyZW50LCBteXRhZywg
MCk7CiEgCX0KICAKISAJcHJvdF9wcmludGYocy0+b3V0LCAiJXMgQXBwZW5kIHslZCt9XHJcbiVz
ICIsIHRhZywgc3RybGVuKG5hbWUpLCBuYW1lKTsKISAJcGlwZV9jb21tYW5kKHMsIDE2Mzg0KTsK
ICAgICAgfSBlbHNlIHsKISAJZWF0bGluZShwcm94eWRfaW4sIHByb3RfZ2V0Yyhwcm94eWRfaW4p
KTsKISAJcHJvdF9wcmludGYocHJveHlkX291dCwgIiVzIE5PICVzXHJcbiIsIHRhZywgZXJyb3Jf
bWVzc2FnZShyKSk7CiAgICAgIH0KICB9CiAgCioqKioqKioqKioqKioqKgoqKiogMjg0OSwyODU1
ICoqKioKICAgICAgcHJvdF9wcmludGYoYmFja2VuZF9jdXJyZW50LT5vdXQsICIlcyBDbG9zZVxy
XG4iLCB0YWcpOwogICAgICAvKiB4eHggZG8gd2Ugd2FudCB0aGlzIHRvIHNheSBPSyBpZiB0aGUg
Y29ubmVjdGlvbiBpcyBnb25lPwogICAgICAgKiBzYXlpbmcgTk8gaXMgY2xlYXJseSB3cm9uZywg
aGVuc2UgdGhlIGZhdGFsIHJlcXVlc3QuICovCi0gICAgIHBpcGVfaW5jbHVkaW5nX3RhZyhiYWNr
ZW5kX2N1cnJlbnQsIHRhZywgMCk7CiAgICAgIGJhY2tlbmRfY3VycmVudCA9IE5VTEw7CiAgfQog
IAotLS0gMjkyMCwyOTI1IC0tLS0KKioqKioqKioqKioqKioqCioqKiAyODY0LDI4NzAgKioqKgog
ICAgICBwcm90X3ByaW50ZihiYWNrZW5kX2N1cnJlbnQtPm91dCwgIiVzIFVuc2VsZWN0XHJcbiIs
IHRhZyk7CiAgICAgIC8qIHh4eCBkbyB3ZSB3YW50IHRoaXMgdG8gc2F5IE9LIGlmIHRoZSBjb25u
ZWN0aW9uIGlzIGdvbmU/CiAgICAgICAqIHNheWluZyBOTyBpcyBjbGVhcmx5IHdyb25nLCBoZW5z
ZSB0aGUgZmF0YWwgcmVxdWVzdC4gKi8KLSAgICAgcGlwZV9pbmNsdWRpbmdfdGFnKGJhY2tlbmRf
Y3VycmVudCwgdGFnLCAwKTsKICAgICAgYmFja2VuZF9jdXJyZW50ID0gTlVMTDsKICB9CiAgCi0t
LSAyOTM0LDI5MzkgLS0tLQoqKioqKioqKioqKioqKioKKioqIDI4ODAsMjg4OCAqKioqCiAgICAg
IGFzc2VydChiYWNrZW5kX2N1cnJlbnQgIT0gTlVMTCk7CiAgCiAgICAgIHByb3RfcHJpbnRmKGJh
Y2tlbmRfY3VycmVudC0+b3V0LCAiJXMgJXMgJXMgIiwgdGFnLCBjbWQsIHNlcXVlbmNlKTsKISAg
ICAgaWYgKCFwaXBlX2NvbW1hbmQoYmFja2VuZF9jdXJyZW50LCA2NTUzNikpIHsKISAJcGlwZV9p
bmNsdWRpbmdfdGFnKGJhY2tlbmRfY3VycmVudCwgdGFnLCAwKTsKISAgICAgfQogIH0KICAKICAv
KgotLS0gMjk0OSwyOTU1IC0tLS0KICAgICAgYXNzZXJ0KGJhY2tlbmRfY3VycmVudCAhPSBOVUxM
KTsKICAKICAgICAgcHJvdF9wcmludGYoYmFja2VuZF9jdXJyZW50LT5vdXQsICIlcyAlcyAlcyAi
LCB0YWcsIGNtZCwgc2VxdWVuY2UpOwohICAgICBwaXBlX2NvbW1hbmQoYmFja2VuZF9jdXJyZW50
LCA2NTUzNik7CiAgfQogIAogIC8qCioqKioqKioqKioqKioqKgoqKiogMjg5NCwyOTAwICoqKioK
ICAKICAgICAgcHJvdF9wcmludGYoYmFja2VuZF9jdXJyZW50LT5vdXQsICIlcyBQYXJ0aWFsICVz
ICVzICVzICVzXHJcbiIsCiAgCQl0YWcsIG1zZ25vLCBkYXRhLCBzdGFydCwgY291bnQpOwotICAg
ICBwaXBlX2luY2x1ZGluZ190YWcoYmFja2VuZF9jdXJyZW50LCB0YWcsIDApOwogIH0KICAKICAv
KgotLS0gMjk2MSwyOTY2IC0tLS0KKioqKioqKioqKioqKioqCioqKiAyOTEwLDI5MTggKioqKgog
IAogICAgICBwcm90X3ByaW50ZihiYWNrZW5kX2N1cnJlbnQtPm91dCwgIiVzICVzICVzICVzICIs
CiAgCQl0YWcsIGNtZCwgc2VxdWVuY2UsIG9wZXJhdGlvbik7CiEgICAgIGlmICghcGlwZV9jb21t
YW5kKGJhY2tlbmRfY3VycmVudCwgNjU1MzYpKSB7CiEgCXBpcGVfaW5jbHVkaW5nX3RhZyhiYWNr
ZW5kX2N1cnJlbnQsIHRhZywgMCk7CiEgICAgIH0KICB9CiAgCiAgdm9pZCBjbWRfc2VhcmNoKGNo
YXIgKnRhZywgaW50IHVzaW5ndWlkKQotLS0gMjk3NiwyOTgyIC0tLS0KICAKICAgICAgcHJvdF9w
cmludGYoYmFja2VuZF9jdXJyZW50LT5vdXQsICIlcyAlcyAlcyAlcyAiLAogIAkJdGFnLCBjbWQs
IHNlcXVlbmNlLCBvcGVyYXRpb24pOwohICAgICBwaXBlX2NvbW1hbmQoYmFja2VuZF9jdXJyZW50
LCA2NTUzNik7CiAgfQogIAogIHZvaWQgY21kX3NlYXJjaChjaGFyICp0YWcsIGludCB1c2luZ3Vp
ZCkKKioqKioqKioqKioqKioqCioqKiAyOTIyLDI5MzAgKioqKgogICAgICBhc3NlcnQoYmFja2Vu
ZF9jdXJyZW50ICE9IE5VTEwpOwogIAogICAgICBwcm90X3ByaW50ZihiYWNrZW5kX2N1cnJlbnQt
Pm91dCwgIiVzICVzICIsIHRhZywgY21kKTsKISAgICAgaWYgKCFwaXBlX2NvbW1hbmQoYmFja2Vu
ZF9jdXJyZW50LCA2NTUzNikpIHsKISAJcGlwZV9pbmNsdWRpbmdfdGFnKGJhY2tlbmRfY3VycmVu
dCwgdGFnLCAwKTsKISAgICAgfQogIH0KICAKICB2b2lkIGNtZF9zb3J0KGNoYXIgKnRhZywgaW50
IHVzaW5ndWlkKQotLS0gMjk4NiwyOTkyIC0tLS0KICAgICAgYXNzZXJ0KGJhY2tlbmRfY3VycmVu
dCAhPSBOVUxMKTsKICAKICAgICAgcHJvdF9wcmludGYoYmFja2VuZF9jdXJyZW50LT5vdXQsICIl
cyAlcyAiLCB0YWcsIGNtZCk7CiEgICAgIHBpcGVfY29tbWFuZChiYWNrZW5kX2N1cnJlbnQsIDY1
NTM2KTsKICB9CiAgCiAgdm9pZCBjbWRfc29ydChjaGFyICp0YWcsIGludCB1c2luZ3VpZCkKKioq
KioqKioqKioqKioqCioqKiAyOTM0LDI5NDIgKioqKgogICAgICBhc3NlcnQoYmFja2VuZF9jdXJy
ZW50ICE9IE5VTEwpOwogIAogICAgICBwcm90X3ByaW50ZihiYWNrZW5kX2N1cnJlbnQtPm91dCwg
IiVzICVzICIsIHRhZywgY21kKTsKISAgICAgaWYgKCFwaXBlX2NvbW1hbmQoYmFja2VuZF9jdXJy
ZW50LCA2NTUzNikpIHsKISAJcGlwZV9pbmNsdWRpbmdfdGFnKGJhY2tlbmRfY3VycmVudCwgdGFn
LCAwKTsKISAgICAgfQogIH0KICAKICB2b2lkIGNtZF90aHJlYWQoY2hhciAqdGFnLCBpbnQgdXNp
bmd1aWQpCi0tLSAyOTk2LDMwMDIgLS0tLQogICAgICBhc3NlcnQoYmFja2VuZF9jdXJyZW50ICE9
IE5VTEwpOwogIAogICAgICBwcm90X3ByaW50ZihiYWNrZW5kX2N1cnJlbnQtPm91dCwgIiVzICVz
ICIsIHRhZywgY21kKTsKISAgICAgcGlwZV9jb21tYW5kKGJhY2tlbmRfY3VycmVudCwgNjU1MzYp
OwogIH0KICAKICB2b2lkIGNtZF90aHJlYWQoY2hhciAqdGFnLCBpbnQgdXNpbmd1aWQpCioqKioq
KioqKioqKioqKgoqKiogMjk0NiwyOTU0ICoqKioKICAgICAgYXNzZXJ0KGJhY2tlbmRfY3VycmVu
dCAhPSBOVUxMKTsKICAKICAgICAgcHJvdF9wcmludGYoYmFja2VuZF9jdXJyZW50LT5vdXQsICIl
cyAlcyAiLCB0YWcsIGNtZCk7CiEgICAgIGlmICghcGlwZV9jb21tYW5kKGJhY2tlbmRfY3VycmVu
dCwgNjU1MzYpKSB7CiEgCXBpcGVfaW5jbHVkaW5nX3RhZyhiYWNrZW5kX2N1cnJlbnQsIHRhZywg
MCk7CiEgICAgIH0KICB9CiAgCiAgc3RhdGljIGludCBjaG9tcChzdHJ1Y3QgcHJvdHN0cmVhbSAq
cCwgY2hhciAqcykKLS0tIDMwMDYsMzAxMiAtLS0tCiAgICAgIGFzc2VydChiYWNrZW5kX2N1cnJl
bnQgIT0gTlVMTCk7CiAgCiAgICAgIHByb3RfcHJpbnRmKGJhY2tlbmRfY3VycmVudC0+b3V0LCAi
JXMgJXMgIiwgdGFnLCBjbWQpOwohICAgICBwaXBlX2NvbW1hbmQoYmFja2VuZF9jdXJyZW50LCA2
NTUzNik7CiAgfQogIAogIHN0YXRpYyBpbnQgY2hvbXAoc3RydWN0IHByb3RzdHJlYW0gKnAsIGNo
YXIgKnMpCioqKioqKioqKioqKioqKgoqKiogMzA1NSwzMDYxICoqKioKICAJLyogdGhpcyBpcyB0
aGUgZWFzeSBjYXNlICovCiAgCXByb3RfcHJpbnRmKGJhY2tlbmRfY3VycmVudC0+b3V0LCAiJXMg
JXMgJXMgeyVkK31cclxuJXNcclxuIiwKICAJCSAgICB0YWcsIGNtZCwgc2VxdWVuY2UsIHN0cmxl
bihuYW1lKSwgbmFtZSk7Ci0gCXBpcGVfaW5jbHVkaW5nX3RhZyhiYWNrZW5kX2N1cnJlbnQsIHRh
ZywgMCk7CiAgICAgIH0gZWxzZSB7CiAgCWNoYXIgbXl0YWdbMTI4XTsKICAJc3RydWN0IGQgewot
LS0gMzExMywzMTE4IC0tLS0KKioqKioqKioqKioqKioqCioqKiAzMzg5LDMzOTUgKioqKgogICAg
ICB9IGVsc2UgewogIAlwcm90X3ByaW50ZihiYWNrZW5kX2N1cnJlbnQtPm91dCwgIiVzIEV4cHVu
Z2VcclxuIiwgdGFnKTsKICAgICAgfQotICAgICBwaXBlX2luY2x1ZGluZ190YWcoYmFja2VuZF9j
dXJyZW50LCB0YWcsIDApOwogIH0gICAgCiAgCiAgLyoKLS0tIDM0NDYsMzQ1MSAtLS0tCioqKioq
KioqKioqKioqKgoqKiogMzQzOSwzNDQ2ICoqKioKICAJLyogb2ssIHNlbmQgdGhlIGNyZWF0ZSB0
byB0aGF0IHNlcnZlciAqLwogIAlwcm90X3ByaW50ZihzLT5vdXQsICIlcyBDUkVBVEUgeyVkK31c
clxuJXNcclxuIiwgCiAgCQkgICAgdGFnLCBzdHJsZW4obmFtZSksIG5hbWUpOwotIAlyZXMgPSBw
aXBlX2luY2x1ZGluZ190YWcocywgdGFnLCAwKTsKLSAJdGFnID0gIioiOwkJLyogY2FuJ3Qgc2Vu
ZCBhbm90aGVyIHRhZ2dlZCByZXNwb25zZSAqLwogIAkKICAJaWYgKCFDQVBBKHMsIENBUEFfTVVQ
REFURSkpIHsKICAJICAgIC8qIGRvIE1VUERBVEUgY3JlYXRlIG9wZXJhdGlvbnMgKi8KLS0tIDM0
OTUsMzUwMCAtLS0tCioqKioqKioqKioqKioqKgoqKiogMzQ4MCwzNDg3ICoqKioKICAgICAgaWYg
KCFyKSB7CiAgCXByb3RfcHJpbnRmKHMtPm91dCwgIiVzIERFTEVURSB7JWQrfVxyXG4lc1xyXG4i
LCAKICAJCSAgICB0YWcsIHN0cmxlbihuYW1lKSwgbmFtZSk7Ci0gCXJlcyA9IHBpcGVfaW5jbHVk
aW5nX3RhZyhzLCB0YWcsIDApOwotIAl0YWcgPSAiKiI7CQkvKiBjYW4ndCBzZW5kIGFub3RoZXIg
dGFnZ2VkIHJlc3BvbnNlICovCiAgCiAgCWlmICghQ0FQQShzLCBDQVBBX01VUERBVEUpICYmIHJl
cyA9PSBQUk9YWV9PSykgewogIAkgICAgLyogZG8gTVVQREFURSBkZWxldGUgb3BlcmF0aW9ucyAq
LwotLS0gMzUzNCwzNTM5IC0tLS0KKioqKioqKioqKioqKioqCioqKiAzODExLDM4MTcgKioqKgog
IAkJCXRhZywgY21kLCAKICAJCQlzdHJsZW4obmFtZSksIG5hbWUpOwogIAl9Ci0gCXBpcGVfaW5j
bHVkaW5nX3RhZyhiYWNrZW5kX2luYm94LCB0YWcsIDApOwogICAgICB9IGVsc2UgewogIAlyID0g
SU1BUF9TRVJWRVJfVU5BVkFJTEFCTEU7CiAgICAgIH0KLS0tIDM4NjMsMzg2OCAtLS0tCioqKioq
KioqKioqKioqKgoqKiogNDA1MSw0MDU4ICoqKioKICAJCQl0YWcsIHN0cmxlbihuYW1lKSwgbmFt
ZSwKICAJCQlzdHJsZW4oaWRlbnRpZmllciksIGlkZW50aWZpZXIpOwogIAl9CSAgICAKISAJcmVz
ID0gcGlwZV9pbmNsdWRpbmdfdGFnKHMsIHRhZywgMCk7CiEgCXRhZyA9ICIqIjsJCS8qIGNhbid0
IHNlbmQgYW5vdGhlciB0YWdnZWQgcmVzcG9uc2UgKi8KICAJaWYgKCFDQVBBKHMsIENBUEFfTVVQ
REFURSkgJiYgcmVzID09IFBST1hZX09LKSB7CiAgCSAgICAvKiBzZXR1cCBuZXcgQUNMIGluIE1V
UERBVEUgKi8KICAJfQotLS0gNDEwMiw0MTA4IC0tLS0KICAJCQl0YWcsIHN0cmxlbihuYW1lKSwg
bmFtZSwKICAJCQlzdHJsZW4oaWRlbnRpZmllciksIGlkZW50aWZpZXIpOwogIAl9CSAgICAKISAK
ICAJaWYgKCFDQVBBKHMsIENBUEFfTVVQREFURSkgJiYgcmVzID09IFBST1hZX09LKSB7CiAgCSAg
ICAvKiBzZXR1cCBuZXcgQUNMIGluIE1VUERBVEUgKi8KICAJfQoqKioqKioqKioqKioqKioKKioq
IDQxNTAsNDE1NiAqKioqCiAgCWlmIChzKSB7CiAgCSAgICBwcm90X3ByaW50ZihzLT5vdXQsICIl
cyBHZXRxdW90YXJvb3QgeyVkK31cclxuJXNcclxuIiwKICAJCQl0YWcsIHN0cmxlbihuYW1lKSwg
bmFtZSk7Ci0gCSAgICBwaXBlX2luY2x1ZGluZ190YWcocywgdGFnLCAwKTsKICAJfSBlbHNlIHsK
ICAJICAgIHIgPSBJTUFQX1NFUlZFUl9VTkFWQUlMQUJMRTsKICAJfQotLS0gNDIwMCw0MjA1IC0t
LS0KKioqKioqKioqKioqKioqCioqKiA0Mzc1LDQzODUgKioqKgogICAgICBpZiAoIXIpIHMgPSBw
cm94eWRfZmluZHNlcnZlcihzZXJ2ZXIpOwogICAgICBpZiAoIXIgJiYgIXMpIHIgPSBJTUFQX1NF
UlZFUl9VTkFWQUlMQUJMRTsKICAgICAgaWYgKCFyKSB7Ci0gCXByb3RfcHJpbnRmKHMtPm91dCwg
IiVzIFN0YXR1cyB7JWQrfVxyXG4lcyAiLCB0YWcsCi0gCQkgICAgc3RybGVuKG5hbWUpLCBuYW1l
KTsKLSAJaWYgKCFwaXBlX2NvbW1hbmQocywgNjU1MzYpKSB7Ci0gCSAgICBwaXBlX3VudGlsX3Rh
ZyhzLCB0YWcsIDApOwotIAl9CiAgCWlmIChiYWNrZW5kX2N1cnJlbnQgJiYgcyAhPSBiYWNrZW5k
X2N1cnJlbnQpIHsKICAJICAgIGNoYXIgbXl0YWdbMTI4XTsKICAJICAgIAotLS0gNDQyNCw0NDI5
IC0tLS0KKioqKioqKioqKioqKioqCioqKiA0Mzg4LDQ0MDAgKioqKgogIAkgICAgcHJvdF9wcmlu
dGYoYmFja2VuZF9jdXJyZW50LT5vdXQsICIlcyBOb29wXHJcbiIsIG15dGFnKTsKICAJICAgIHBp
cGVfdW50aWxfdGFnKGJhY2tlbmRfY3VycmVudCwgbXl0YWcsIDApOwogIAl9CiAgICAgIH0gZWxz
ZSB7CiAgCWVhdGxpbmUocHJveHlkX2luLCBwcm90X2dldGMocHJveHlkX2luKSk7Ci0gICAgIH0K
LSAKLSAgICAgaWYgKCFyKSB7Ci0gCXByb3RfcHJpbnRmKHByb3h5ZF9vdXQsICIlcyAlcyIsIHRh
Zywgcy0+bGFzdF9yZXN1bHQpOwotICAgICB9IGVsc2UgewogIAlwcm90X3ByaW50Zihwcm94eWRf
b3V0LCAiJXMgTk8gJXNcclxuIiwgdGFnLCBlcnJvcl9tZXNzYWdlKHIpKTsKICAgICAgfQogIH0K
LS0tIDQ0MzIsNDQ0MiAtLS0tCiAgCSAgICBwcm90X3ByaW50ZihiYWNrZW5kX2N1cnJlbnQtPm91
dCwgIiVzIE5vb3BcclxuIiwgbXl0YWcpOwogIAkgICAgcGlwZV91bnRpbF90YWcoYmFja2VuZF9j
dXJyZW50LCBteXRhZywgMCk7CiAgCX0KKyAJcHJvdF9wcmludGYocy0+b3V0LCAiJXMgU3RhdHVz
IHslZCt9XHJcbiVzICIsIHRhZywKKyAJCSAgICBzdHJsZW4obmFtZSksIG5hbWUpOworIAlwaXBl
X2NvbW1hbmQocywgNjU1MzYpOwogICAgICB9IGVsc2UgewogIAllYXRsaW5lKHByb3h5ZF9pbiwg
cHJvdF9nZXRjKHByb3h5ZF9pbikpOwogIAlwcm90X3ByaW50Zihwcm94eWRfb3V0LCAiJXMgTk8g
JXNcclxuIiwgdGFnLCBlcnJvcl9tZXNzYWdlKHIpKTsKICAgICAgfQogIH0KSW5kZXg6IGxpYi9w
cm90LmMKPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PQpSQ1MgZmlsZTogL2Fmcy9hbmRyZXcvc3lzdGVtL2N2cy9zcmMvY3ly
dXMvbGliL3Byb3QuYyx2CnJldHJpZXZpbmcgcmV2aXNpb24gMS44NgpkaWZmIC1jIC1yMS44NiBw
cm90LmMKKioqIGxpYi9wcm90LmMJMjcgRmViIDIwMDQgMjI6MDg6NTYgLTAwMDAJMS44NgotLS0g
bGliL3Byb3QuYwkxNSBNYXIgMjAwNCAxNjowMjo0MSAtMDAwMAoqKioqKioqKioqKioqKioKKioq
IDEwMDQsMTAwOSAqKioqCi0tLSAxMDA0LDEwMTAgLS0tLQogIAl0aW1lX3QgdGhpc190aW1lb3V0
ID0gMDsgICAvKiB0aGlzIHN0cmVhbSAqLwogIAkKICAJcyA9IHJlYWRzdHJlYW1zLT5ncm91cFtp
XTsKKyAJaWYgKCFzKSBjb250aW51ZTsKICAKICAJYXNzZXJ0KCFzLT53cml0ZSk7CiAgCioqKioq
KioqKioqKioqKgoqKiogMTEwNSwxMTEwICoqKioKLS0tIDExMDYsMTExMiAtLS0tCiAgCQogIAlm
b3IoaSA9IDA7IGk8cmVhZHN0cmVhbXMtPm5leHRfZWxlbWVudDsgaSsrKSB7CiAgCSAgICBzID0g
cmVhZHN0cmVhbXMtPmdyb3VwW2ldOworIAkgICAgaWYgKCFzKSBjb250aW51ZTsKICAKICAJICAg
IGlmKEZEX0lTU0VUKHMtPmZkLCAmcmZkcykpIHsKICAJCWZvdW5kX2ZkcysrOwoqKioqKioqKioq
KioqKioKKioqIDExOTgsMTIxMyAqKioqCiAgCiAgdm9pZCBwcm90Z3JvdXBfaW5zZXJ0KHN0cnVj
dCBwcm90Z3JvdXAgKmdyb3VwLCBzdHJ1Y3QgcHJvdHN0cmVhbSAqaXRlbSkgCiAgewogICAgICBh
c3NlcnQoZ3JvdXApOwogICAgICBhc3NlcnQoaXRlbSk7CiEgICAgIC8qIERvdWJsZSBzaXplIG9m
IHRoZSBwcm90Z3JvdXAgaWYgd2UncmUgYXQgb3VyIGxpbWl0ICovCiEgICAgIGlmKGdyb3VwLT5u
ZXh0X2VsZW1lbnQgPT0gZ3JvdXAtPm5hbGxvY2VkKSB7CiAgCWdyb3VwLT5uYWxsb2NlZCAqPSAy
OwogIAlncm91cC0+Z3JvdXAgPSB4cmVhbGxvYyhncm91cC0+Z3JvdXAsCiAgCQkJCWdyb3VwLT5u
YWxsb2NlZCAqIHNpemVvZihzdHJ1Y3QgcHJvdHN0cmVhbSAqKSk7CiAgICAgIH0KISAgICAgLyog
SW5zZXJ0IHRoZSBpdGVtIG9uIHRoZSBlbmQgb2YgdGhlIGdyb3VwICovCiEgICAgIGdyb3VwLT5n
cm91cFtncm91cC0+bmV4dF9lbGVtZW50KytdID0gaXRlbTsKICB9CiAgCiAgc3RydWN0IHByb3Rz
dHJlYW0gKnByb3Rncm91cF9nZXRlbGVtZW50KHN0cnVjdCBwcm90Z3JvdXAgKmdyb3VwLAotLS0g
MTIwMCwxMjQwIC0tLS0KICAKICB2b2lkIHByb3Rncm91cF9pbnNlcnQoc3RydWN0IHByb3Rncm91
cCAqZ3JvdXAsIHN0cnVjdCBwcm90c3RyZWFtICppdGVtKSAKICB7CisgICAgIGludCBpLCBlbXB0
eTsKKyAKICAgICAgYXNzZXJ0KGdyb3VwKTsKICAgICAgYXNzZXJ0KGl0ZW0pOwohIAohICAgICAv
KiBTZWUgaWYgd2UgYWxyZWFkeSBoYXZlIHRoaXMgcHJvdHN0cmVhbSAqLwohICAgICBmb3IgKGkg
PSAwLCBlbXB0eSA9IGdyb3VwLT5uZXh0X2VsZW1lbnQ7IGkgPCBncm91cC0+bmV4dF9lbGVtZW50
OyBpKyspIHsKISAJaWYgKCFncm91cC0+Z3JvdXBbaV0pIGVtcHR5ID0gaTsKISAJZWxzZSBpZiAo
Z3JvdXAtPmdyb3VwW2ldID09IGl0ZW0pIHJldHVybjsKISAgICAgfQohICAgICAvKiBEb3VibGUg
c2l6ZSBvZiB0aGUgcHJvdGdyb3VwIGlmIHdlJ3JlIGF0IG91ciBsaW1pdCAqLyAKISAgICAgaWYg
KGVtcHR5ID09IGdyb3VwLT5uZXh0X2VsZW1lbnQgJiYKISAJZ3JvdXAtPm5leHRfZWxlbWVudCsr
ID09IGdyb3VwLT5uYWxsb2NlZCkgewogIAlncm91cC0+bmFsbG9jZWQgKj0gMjsKICAJZ3JvdXAt
Pmdyb3VwID0geHJlYWxsb2MoZ3JvdXAtPmdyb3VwLAogIAkJCQlncm91cC0+bmFsbG9jZWQgKiBz
aXplb2Yoc3RydWN0IHByb3RzdHJlYW0gKikpOwogICAgICB9CiEgICAgIC8qIEluc2VydCB0aGUg
aXRlbSBhdCB0aGUgZW1wdHkgbG9jYXRpb24gKi8KISAgICAgZ3JvdXAtPmdyb3VwW2VtcHR5XSA9
IGl0ZW07CiEgfQohIAohIHZvaWQgcHJvdGdyb3VwX2RlbGV0ZShzdHJ1Y3QgcHJvdGdyb3VwICpn
cm91cCwgc3RydWN0IHByb3RzdHJlYW0gKml0ZW0pIAohIHsKISAgICAgaW50IGk7CiEgCiEgICAg
IGFzc2VydChncm91cCk7CiEgICAgIGFzc2VydChpdGVtKTsKISAKISAgICAgLyogZmluZCB0aGUg
cHJvdHN0cmVhbSAqLwohICAgICBmb3IgKGkgPSAwOyBpIDwgZ3JvdXAtPm5leHRfZWxlbWVudDsg
aSsrKSB7CiEgCWlmIChncm91cC0+Z3JvdXBbaV0gPT0gaXRlbSkgewohIAkgICAgZ3JvdXAtPmdy
b3VwW2ldID0gTlVMTDsKISAJICAgIHJldHVybjsKISAJfQohICAgICB9CiAgfQogIAogIHN0cnVj
dCBwcm90c3RyZWFtICpwcm90Z3JvdXBfZ2V0ZWxlbWVudChzdHJ1Y3QgcHJvdGdyb3VwICpncm91
cCwKSW5kZXg6IGxpYi9wcm90LmgKPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQpSQ1MgZmlsZTogL2Fmcy9hbmRyZXcvc3lz
dGVtL2N2cy9zcmMvY3lydXMvbGliL3Byb3QuaCx2CnJldHJpZXZpbmcgcmV2aXNpb24gMS40MQpk
aWZmIC1jIC1yMS40MSBwcm90LmgKKioqIGxpYi9wcm90LmgJMjcgRmViIDIwMDQgMjI6MDg6NTcg
LTAwMDAJMS40MQotLS0gbGliL3Byb3QuaAkxNSBNYXIgMjAwNCAxNjowMjo0MSAtMDAwMAoqKioq
KioqKioqKioqKioKKioqIDIzMiwyMzcgKioqKgotLS0gMjMyLDI0MCAtLS0tCiAgLyogSW5zZXJ0
IGFuIGVsZW1lbnQgaW50byBhIHByb3Rncm91cCAqLwogIHZvaWQgcHJvdGdyb3VwX2luc2VydChz
dHJ1Y3QgcHJvdGdyb3VwICpncm91cCwgc3RydWN0IHByb3RzdHJlYW0gKml0ZW0pOwogIAorIC8q
IERlbGV0ZSBhbiBlbGVtZW50IGZyb20gYSBwcm90Z3JvdXAgKi8KKyB2b2lkIHByb3Rncm91cF9k
ZWxldGUoc3RydWN0IHByb3Rncm91cCAqZ3JvdXAsIHN0cnVjdCBwcm90c3RyZWFtICppdGVtKTsK
KyAKICAvKiBSZXR1cm5zIHRoZSBwcm90c3RyZWFtIGF0IHRoYXQgcG9zaXRpb24gaW4gdGhlIHBy
b3Rncm91cCwgb3IgTlVMTCBpZgogICAqIGFuIGludmFsaWQgZWxlbWVudCBpcyByZXF1ZXN0ZWQg
Ki8KICBzdHJ1Y3QgcHJvdHN0cmVhbSAqcHJvdGdyb3VwX2dldGVsZW1lbnQoc3RydWN0IHByb3Rn
cm91cCAqZ3JvdXAsCg==
</data>        

          </attachment>
          <attachment
              isobsolete="0"
              ispatch="1"
              isprivate="0"
          >
            <attachid>272</attachid>
            <date>2004-03-15 13:49 EDT</date>
            <desc>pipelining to selected backend only</desc>
            <filename>proxyd-piplining.patch2</filename>
            <type>text/plain</type>
            <size>21105</size>
            <attacher>ken@oceana.com</attacher>
            
              <data encoding="base64">SW5kZXg6IGltYXAvcHJveHlkLmMKPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQpSQ1MgZmlsZTogL2Fmcy9hbmRyZXcvc3lz
dGVtL2N2cy9zcmMvY3lydXMvaW1hcC9wcm94eWQuYyx2CnJldHJpZXZpbmcgcmV2aXNpb24gMS4x
NzgKZGlmZiAtYyAtcjEuMTc4IHByb3h5ZC5jCioqKiBpbWFwL3Byb3h5ZC5jCTkgTWFyIDIwMDQg
MTg6MDg6NDEgLTAwMDAJMS4xNzgKLS0tIGltYXAvcHJveHlkLmMJMTUgTWFyIDIwMDQgMTg6NDY6
MjcgLTAwMDAKKioqKioqKioqKioqKioqCioqKiAxMzcsMTQyICoqKioKLS0tIDEzNywxNDMgLS0t
LQogIC8qIHBlci11c2VyIHNlc3Npb24gc3RhdGUgKi8KICBzdHJ1Y3QgcHJvdHN0cmVhbSAqcHJv
eHlkX291dCA9IE5VTEw7CiAgc3RydWN0IHByb3RzdHJlYW0gKnByb3h5ZF9pbiA9IE5VTEw7Cisg
c3RydWN0IHByb3Rncm91cCAqcHJvdGluID0gTlVMTDsKICBzdGF0aWMgY2hhciBwcm94eWRfY2xp
ZW50aG9zdFtOSV9NQVhIT1NUKjIrMV0gPSAiW2xvY2FsXSI7CiAgc3RhdGljIGludCBwcm94eWRf
bG9nZmQgPSAtMTsKICB0aW1lX3QgcHJveHlkX2xvZ3RpbWU7CioqKioqKioqKioqKioqKgoqKiog
MTExMCwxMTE1ICoqKioKLS0tIDExMTEsMTExOSAtLS0tCiAgICAgIAogICAgICBwcm94eWRfaW4g
PSBwcm94eWRfb3V0ID0gTlVMTDsKICAKKyAgICAgaWYgKHByb3RpbikgcHJvdGdyb3VwX2ZyZWUo
cHJvdGluKTsKKyAgICAgcHJvdGluID0gTlVMTDsKKyAKICAjaWZkZWYgSEFWRV9TU0wKICAgICAg
aWYgKHRsc19jb25uKSB7CiAgCWlmICh0bHNfcmVzZXRfc2VydmVydGxzKCZ0bHNfY29ubikgPT0g
LTEpIHsKKioqKioqKioqKioqKioqCioqKiAxMzMzLDEzMzggKioqKgotLS0gMTMzNywxMzQ0IC0t
LS0KICAJcHJvdF9mcmVlKHByb3h5ZF9vdXQpOwogICAgICB9CiAgCisgICAgIGlmIChwcm90aW4p
IHByb3Rncm91cF9mcmVlKHByb3Rpbik7CisgCiAgI2lmZGVmIEhBVkVfU1NMCiAgICAgIHRsc19z
aHV0ZG93bl9zZXJ2ZXJlbmdpbmUoKTsKICAjZW5kaWYKKioqKioqKioqKioqKioqCioqKiAxMzg3
LDEzOTMgKioqKgotLS0gMTM5MywxNDA2IC0tLS0KICAJY2xvc2UoZmQpOwogICAgICB9CiAgCisg
ICAgIHByb3RpbiA9IHByb3Rncm91cF9uZXcoMik7IC8qIFhYWCBzaG91bGQgd2Ugc3RhcnQgd2l0
aCBtb3JlPyAqLworICAgICBwcm90Z3JvdXBfaW5zZXJ0KHByb3RpbiwgcHJveHlkX2luKTsKKyAK
ICAgICAgZm9yICg7OykgeworIAlzdHJ1Y3QgcHJvdGdyb3VwICpwcm90b3V0ID0gTlVMTDsKKyAJ
c3RydWN0IHRpbWV2YWwgdGltZW91dDsKKyAJaW50IG4sIGNsaWVudGluOworIAogIAlpZiAoISBw
cm94eWRfdXNlcmlzYWRtaW4gJiYgc2h1dGRvd25fZmlsZShzaHV0LCBzaXplb2Yoc2h1dCkpKSB7
CiAgCSAgICBmb3IgKHAgPSBzaHV0OyAqcCA9PSAnWyc7IHArKyk7IC8qIGNhbid0IGhhdmUgWyBi
ZSBmaXJzdCBjaGFyICovCiAgCSAgICBwcm90X3ByaW50Zihwcm94eWRfb3V0LCAiKiBCWUUgW0FM
RVJUXSAlc1xyXG4iLCBwKTsKKioqKioqKioqKioqKioqCioqKiAxMzk2LDE0MDEgKioqKgotLS0g
MTQwOSwxNDY5IC0tLS0KICAKICAJc2lnbmFsc19wb2xsKCk7CiAgCisgCS8qIGZsdXNoIGFueSBi
dWZmZXJlZCBvdXRwdXQgKi8KKyAJaWYgKGJhY2tlbmRfY3VycmVudCkgcHJvdF9mbHVzaChiYWNr
ZW5kX2N1cnJlbnQtPm91dCk7CisgCXByb3RfZmx1c2gocHJveHlkX291dCk7CisgCisgCXRpbWVv
dXQudHZfc2VjID0gNjA7CisgCXRpbWVvdXQudHZfdXNlYyA9IDA7CisgCisgCW4gPSBwcm90X3Nl
bGVjdChwcm90aW4sIFBST1RfTk9fRkQsICZwcm90b3V0LCBOVUxMLCAmdGltZW91dCk7CisgCWlm
IChuID09IC0xKSB7CisgCSAgICBzeXNsb2coTE9HX0VSUiwgInByb3Rfc2VsZWN0KCkgZmFpbGVk
IGluIGNtZGxvb3AoKTogJW0iKTsKKyAJICAgIGZhdGFsKCJwcm90X3NlbGVjdCgpIGZhaWxlZCBp
biBjbWRsb29wKCkiLCBFQ19URU1QRkFJTCk7CisgCX0KKyAKKyAJY2xpZW50aW4gPSAwOworIAlp
ZiAobiAmJiBwcm90b3V0KSB7CisgCSAgICBzdHJ1Y3QgcHJvdHN0cmVhbSAqcHRtcDsKKyAKKyAJ
ICAgIC8qIHNlZSB3aG8gaGFzIGlucHV0ICovCisgCSAgICBmb3IgKDsgbjsgbi0tKSB7CisgCQlw
dG1wID0gcHJvdGdyb3VwX2dldGVsZW1lbnQocHJvdG91dCwgbi0xKTsKKyAKKyAJCWlmIChwdG1w
ID09IHByb3h5ZF9pbikgeworIAkJICAgIC8qIGlucHV0IGZyb20gY2xpZW50LCBwcm9jZXNzIGl0
IGxhdGVyICovCisgCQkgICAgY2xpZW50aW4gPSAxOworIAkJfQorIAkJZWxzZSBpZiAoYmFja2Vu
ZF9jdXJyZW50ICYmIHB0bXAgPT0gYmFja2VuZF9jdXJyZW50LT5pbil7CisgCQkgICAgLyogaW5w
dXQgZnJvbSBzZWxlY3RlZCBiYWNrZW5kLCBzdHJlYW0gaXQgdG8gY2xpZW50ICovCisgCQkgICAg
ZG8geworIAkJCWNoYXIgYnVmWzQwOTZdOworIAkJCWludCBjID0gcHJvdF9yZWFkKGJhY2tlbmRf
Y3VycmVudC0+aW4sIGJ1Ziwgc2l6ZW9mKGJ1ZikpOworIAkJCWlmIChjID09IDAgfHwgYyA8IDAp
IGJyZWFrOworIAkJCXByb3Rfd3JpdGUocHJveHlkX291dCwgYnVmLCBjKTsKKyAJCSAgICB9IHdo
aWxlIChiYWNrZW5kX2N1cnJlbnQtPmluLT5jbnQgPiAwKTsKKyAKKyAJCSAgICBpZiAocHJvdF9l
cnJvcihiYWNrZW5kX2N1cnJlbnQtPmluKSkgeworIAkJCS8qIHVoIG9oLCB3ZSdyZSBub3QgaGFw
cHkgKi8KKyAJCQlmYXRhbCgiTG9zdCBjb25uZWN0aW9uIHRvIHNlbGVjdGVkIGJhY2tlbmQiLAor
IAkJCSAgICAgIEVDX1VOQVZBSUxBQkxFKTsKKyAJCSAgICB9CisgCQl9CisgCQllbHNlIHsKKyAJ
CSAgICAvKiBYWFggc2hvdWxkbid0IGdldCBoZXJlICEhISAqLworIAkJICAgIGZhdGFsKCJ1bmtu
b3duIHByb3RzdHJlYW0gcmV0dXJuZWQgYnkgcHJvdF9zZWxlY3QgaW4gY21kbG9vcCIsCisgCQkJ
ICBFQ19TT0ZUV0FSRSk7CisgCQl9CisgCSAgICB9CisgCX0KKyAJaWYgKHByb3RvdXQpIHByb3Rn
cm91cF9mcmVlKHByb3RvdXQpOworIAlwcm90b3V0ID0gTlVMTDsKKyAKKyAJaWYgKCFjbGllbnRp
bikgeworIAkgICAgLyogbm8gaW5wdXQgZnJvbSBjbGllbnQgKi8KKyAJICAgIGNvbnRpbnVlOwor
IAl9CisgCiAgCS8qIFBhcnNlIHRhZyAqLwogIAljID0gZ2V0d29yZChwcm94eWRfaW4sICZ0YWcp
OwogIAlpZiAoYyA9PSBFT0YpIHsKKioqKioqKioqKioqKioqCioqKiAxNjY1LDE2NzAgKioqKgot
LS0gMTczMywxNzQ4IC0tLS0KICAJCWlmIChjID09ICdccicpIGMgPSBwcm90X2dldGMocHJveHlk
X2luKTsKICAJCWlmIChjICE9ICdcbicpIGdvdG8gZXh0cmFhcmdzOwogIAkJCisgCQkvKiBmb3Jj
ZSBhbnkgcmVzcG9uc2VzIGZyb20gb3VyIHNlbGVjdGVkIGJhY2tlbmQgKi8KKyAJCWlmIChiYWNr
ZW5kX2N1cnJlbnQpIHsKKyAJCSAgICBjaGFyIG15dGFnWzEyOF07CisgCisgCQkgICAgcHJveHlk
X2dlbnRhZyhteXRhZywgc2l6ZW9mKG15dGFnKSk7CisgCisgCQkgICAgcHJvdF9wcmludGYoYmFj
a2VuZF9jdXJyZW50LT5vdXQsICIlcyBOb29wXHJcbiIsIG15dGFnKTsKKyAJCSAgICBwaXBlX3Vu
dGlsX3RhZyhiYWNrZW5kX2N1cnJlbnQsIG15dGFnLCAwKTsKKyAJCX0KKyAKICAJCXByb3RfcHJp
bnRmKHByb3h5ZF9vdXQsIAogIAkJCSAgICAiKiBCWUUgJXNcclxuIiwgZXJyb3JfbWVzc2FnZShJ
TUFQX0JZRV9MT0dPVVQpKTsKICAJCXByb3RfcHJpbnRmKHByb3h5ZF9vdXQsICIlcyBPSyAlc1xy
XG4iLCAKKioqKioqKioqKioqKioqCioqKiAyMzA2LDIzMTIgKioqKgogIHsKICAgICAgaWYgKGJh
Y2tlbmRfY3VycmVudCkgewogIAlwcm90X3ByaW50ZihiYWNrZW5kX2N1cnJlbnQtPm91dCwgIiVz
ICVzXHJcbiIsIHRhZywgY21kKTsKLSAJcGlwZV9pbmNsdWRpbmdfdGFnKGJhY2tlbmRfY3VycmVu
dCwgdGFnLCAwKTsKICAgICAgfSBlbHNlIHsKICAJcHJvdF9wcmludGYocHJveHlkX291dCwgIiVz
IE9LICVzXHJcbiIsIHRhZywKICAJCSAgICBlcnJvcl9tZXNzYWdlKElNQVBfT0tfQ09NUExFVEVE
KSk7Ci0tLSAyMzg0LDIzODkgLS0tLQoqKioqKioqKioqKioqKioKKioqIDI1MjEsMjUyOCAqKioq
CiAgewogICAgICBzdGF0aWMgaW50IGlkbGVfcGVyaW9kID0gLTE7CiAgICAgIHN0YXRpYyBzdHJ1
Y3QgYnVmIGFyZzsKISAgICAgc3RydWN0IHByb3Rncm91cCAqcHJvdGluID0gcHJvdGdyb3VwX25l
dygyKTsKISAgICAgc3RydWN0IHByb3Rncm91cCAqcHJvdG91dCA9IE5VTEw7CiAgICAgIHN0cnVj
dCB0aW1ldmFsIHRpbWVvdXQ7CiAgICAgIGludCBjID0gRU9GLCBuLCBkb25lID0gMCwgc2h1dGRv
d24gPSAwOwogICAgICBjaGFyIGJ1ZlsyMDQ4XSwgc2h1dFsxMDI0XTsKLS0tIDI1OTgsMjYwNSAt
LS0tCiAgewogICAgICBzdGF0aWMgaW50IGlkbGVfcGVyaW9kID0gLTE7CiAgICAgIHN0YXRpYyBz
dHJ1Y3QgYnVmIGFyZzsKISAgICAgc3RydWN0IHByb3Rncm91cCAqaWRsZWluID0gcHJvdGdyb3Vw
X25ldygyKTsKISAgICAgc3RydWN0IHByb3Rncm91cCAqaWRsZW91dCA9IE5VTEw7CiAgICAgIHN0
cnVjdCB0aW1ldmFsIHRpbWVvdXQ7CiAgICAgIGludCBjID0gRU9GLCBuLCBkb25lID0gMCwgc2h1
dGRvd24gPSAwOwogICAgICBjaGFyIGJ1ZlsyMDQ4XSwgc2h1dFsxMDI0XTsKKioqKioqKioqKioq
KioqCioqKiAyNTQwLDI1NDcgKioqKgogICAgICB9CiAgCiAgICAgIC8qIFJlc2V0IHByb3RpbiB0
byBhbGwgemVyb3MgKHRvIHByZXNlcnZlIG1lbW9yeSBhbGxvY2F0aW9uKSAqLwohICAgICBwcm90
Z3JvdXBfcmVzZXQocHJvdGluKTsKISAgICAgcHJvdGdyb3VwX2luc2VydChwcm90aW4sIHByb3h5
ZF9pbik7CiAgCiAgICAgIGlmIChiYWNrZW5kX2N1cnJlbnQgJiYgQ0FQQShiYWNrZW5kX2N1cnJl
bnQsIENBUEFfSURMRSkpIHsKICAJLyogU3RhcnQgSURMRSBvbiBiYWNrZW5kICovCi0tLSAyNjE3
LDI2MjQgLS0tLQogICAgICB9CiAgCiAgICAgIC8qIFJlc2V0IHByb3RpbiB0byBhbGwgemVyb3Mg
KHRvIHByZXNlcnZlIG1lbW9yeSBhbGxvY2F0aW9uKSAqLwohICAgICBwcm90Z3JvdXBfcmVzZXQo
aWRsZWluKTsKISAgICAgcHJvdGdyb3VwX2luc2VydChpZGxlaW4sIHByb3h5ZF9pbik7CiAgCiAg
ICAgIGlmIChiYWNrZW5kX2N1cnJlbnQgJiYgQ0FQQShiYWNrZW5kX2N1cnJlbnQsIENBUEFfSURM
RSkpIHsKICAJLyogU3RhcnQgSURMRSBvbiBiYWNrZW5kICovCioqKioqKioqKioqKioqKgoqKiog
MjU2MSwyNTY3ICoqKioKICAJICAgIGdvdG8gZG9uZTsKICAJfQogIAohIAlwcm90Z3JvdXBfaW5z
ZXJ0KHByb3RpbiwgYmFja2VuZF9jdXJyZW50LT5pbik7CiAgICAgIH0KICAKICAgICAgLyogVGVs
bCBjbGllbnQgd2UgYXJlIGlkbGluZyBhbmQgd2FpdGluZyBmb3IgZW5kIG9mIGNvbW1hbmQgKi8K
LS0tIDI2MzgsMjY0NCAtLS0tCiAgCSAgICBnb3RvIGRvbmU7CiAgCX0KICAKISAJcHJvdGdyb3Vw
X2luc2VydChpZGxlaW4sIGJhY2tlbmRfY3VycmVudC0+aW4pOwogICAgICB9CiAgCiAgICAgIC8q
IFRlbGwgY2xpZW50IHdlIGFyZSBpZGxpbmcgYW5kIHdhaXRpbmcgZm9yIGVuZCBvZiBjb21tYW5k
ICovCioqKioqKioqKioqKioqKgoqKiogMjU4NSwyNjA3ICoqKioKICAJICAgIHByb3RfZmx1c2go
cHJveHlkX291dCk7CiAgCX0KICAKISAJLyogQ2xlYXIgcHJvdG91dCBpZiBuZWVkZWQgKi8KISAJ
cHJvdGdyb3VwX2ZyZWUocHJvdG91dCk7CiEgCXByb3RvdXQgPSBOVUxMOwogIAogIAl0aW1lb3V0
LnR2X3NlYyA9IGlkbGVfcGVyaW9kOwogIAl0aW1lb3V0LnR2X3VzZWMgPSAwOwogIAohIAluID0g
cHJvdF9zZWxlY3QocHJvdGluLCBQUk9UX05PX0ZELCAmcHJvdG91dCwgTlVMTCwgJnRpbWVvdXQp
OwogIAlpZiAobiA9PSAtMSkgewogIAkgICAgc3lzbG9nKExPR19FUlIsICJwcm90X3NlbGVjdCgp
IGZhaWxlZCBpbiBjbWRfaWRsZSgpOiAlbSIpOwogIAkgICAgZmF0YWwoInByb3Rfc2VsZWN0KCkg
ZmFpbGVkIGluIGNtZF9pZGxlKCkiLCBFQ19URU1QRkFJTCk7CiAgCX0KISAJaWYgKG4gJiYgcHJv
dG91dCkgewogIAkgICAgc3RydWN0IHByb3RzdHJlYW0gKnB0bXA7CiAgCiAgCSAgICBmb3IgKDsg
bjsgbi0tKSB7CiEgCQlwdG1wID0gcHJvdGdyb3VwX2dldGVsZW1lbnQocHJvdG91dCwgbi0xKTsK
ICAJCWlmIChwdG1wID09IHByb3h5ZF9pbikgewogIAkJICAgIC8qIFRoZSBjbGllbnQgc2VudCB1
cyBzb21ldGhpbmcsIHdlJ3JlIGRvbmUgKi8KICAJCSAgICBkb25lID0gMTsKLS0tIDI2NjIsMjY4
NCAtLS0tCiAgCSAgICBwcm90X2ZsdXNoKHByb3h5ZF9vdXQpOwogIAl9CiAgCiEgCS8qIENsZWFy
IGlkbGVvdXQgaWYgbmVlZGVkICovCiEgCXByb3Rncm91cF9mcmVlKGlkbGVvdXQpOwohIAlpZGxl
b3V0ID0gTlVMTDsKICAKICAJdGltZW91dC50dl9zZWMgPSBpZGxlX3BlcmlvZDsKICAJdGltZW91
dC50dl91c2VjID0gMDsKICAKISAJbiA9IHByb3Rfc2VsZWN0KGlkbGVpbiwgUFJPVF9OT19GRCwg
JmlkbGVvdXQsIE5VTEwsICZ0aW1lb3V0KTsKICAJaWYgKG4gPT0gLTEpIHsKICAJICAgIHN5c2xv
ZyhMT0dfRVJSLCAicHJvdF9zZWxlY3QoKSBmYWlsZWQgaW4gY21kX2lkbGUoKTogJW0iKTsKICAJ
ICAgIGZhdGFsKCJwcm90X3NlbGVjdCgpIGZhaWxlZCBpbiBjbWRfaWRsZSgpIiwgRUNfVEVNUEZB
SUwpOwogIAl9CiEgCWlmIChuICYmIGlkbGVvdXQpIHsKICAJICAgIHN0cnVjdCBwcm90c3RyZWFt
ICpwdG1wOwogIAogIAkgICAgZm9yICg7IG47IG4tLSkgewohIAkJcHRtcCA9IHByb3Rncm91cF9n
ZXRlbGVtZW50KGlkbGVvdXQsIG4tMSk7CiAgCQlpZiAocHRtcCA9PSBwcm94eWRfaW4pIHsKICAJ
CSAgICAvKiBUaGUgY2xpZW50IHNlbnQgdXMgc29tZXRoaW5nLCB3ZSdyZSBkb25lICovCiAgCQkg
ICAgZG9uZSA9IDE7CioqKioqKioqKioqKioqKgoqKiogMjYzNCwyNjQxICoqKioKICAgICAgYyA9
IGdldHdvcmQocHJveHlkX2luLCAmYXJnKTsKICAKICAgIGRvbmU6CiEgICAgIHByb3Rncm91cF9m
cmVlKHByb3Rpbik7CiEgICAgIHByb3Rncm91cF9mcmVlKHByb3RvdXQpOwogIAogICAgICBpZiAo
ZG9uZSAmJiBiYWNrZW5kX2N1cnJlbnQgJiYgQ0FQQShiYWNrZW5kX2N1cnJlbnQsIENBUEFfSURM
RSkpIHsKICAJLyogRWl0aGVyIHRoZSBjbGllbnQgdGltZWQgb3V0LCBvciBnYXZlIHVzIGEgY29u
dGludWF0aW9uLAotLS0gMjcxMSwyNzE4IC0tLS0KICAgICAgYyA9IGdldHdvcmQocHJveHlkX2lu
LCAmYXJnKTsKICAKICAgIGRvbmU6CiEgICAgIHByb3Rncm91cF9mcmVlKGlkbGVpbik7CiEgICAg
IHByb3Rncm91cF9mcmVlKGlkbGVvdXQpOwogIAogICAgICBpZiAoZG9uZSAmJiBiYWNrZW5kX2N1
cnJlbnQgJiYgQ0FQQShiYWNrZW5kX2N1cnJlbnQsIENBUEFfSURMRSkpIHsKICAJLyogRWl0aGVy
IHRoZSBjbGllbnQgdGltZWQgb3V0LCBvciBnYXZlIHVzIGEgY29udGludWF0aW9uLAoqKioqKioq
KioqKioqKioKKioqIDI3NDgsMjc2MiAqKioqCiAgCXMgPSBwcm94eWRfZmluZHNlcnZlcihuZXdz
ZXJ2ZXIpOwogIAlpZiAoIXMpIHIgPSBJTUFQX1NFUlZFUl9VTkFWQUlMQUJMRTsKICAgICAgfQot
ICAgICBpZiAoIXIpIHsKLSAJcHJvdF9wcmludGYocy0+b3V0LCAiJXMgQXBwZW5kIHslZCt9XHJc
biVzICIsIHRhZywgc3RybGVuKG5hbWUpLCBuYW1lKTsKLSAJaWYgKCFwaXBlX2NvbW1hbmQocywg
MTYzODQpKSB7Ci0gCSAgICBwaXBlX3VudGlsX3RhZyhzLCB0YWcsIDApOwotIAl9Ci0gICAgIH0g
ZWxzZSB7Ci0gCWVhdGxpbmUocHJveHlkX2luLCBwcm90X2dldGMocHJveHlkX2luKSk7Ci0gICAg
IH0KLSAKICAgICAgaWYgKGJhY2tlbmRfY3VycmVudCAmJiBiYWNrZW5kX2N1cnJlbnQgIT0gcykg
ewogIAljaGFyIG15dGFnWzEyOF07CiAgCi0tLSAyODI1LDI4MzAgLS0tLQoqKioqKioqKioqKioq
KioKKioqIDI3NjUsMjc3NyAqKioqCiAgCXByb3RfcHJpbnRmKGJhY2tlbmRfY3VycmVudC0+b3V0
LCAiJXMgTm9vcFxyXG4iLCBteXRhZyk7CiAgCXBpcGVfdW50aWxfdGFnKGJhY2tlbmRfY3VycmVu
dCwgbXl0YWcsIDApOwogICAgICB9CiEgCiEgICAgIGlmIChyKSB7CiEgCXByb3RfcHJpbnRmKHBy
b3h5ZF9vdXQsICIlcyBOTyAlc1xyXG4iLCB0YWcsIGVycm9yX21lc3NhZ2UocikpOwogICAgICB9
IGVsc2UgewohIAkvKiB3ZSdyZSBhbGxvd2VkIHRvIHJlZmVyZW5jZSBsYXN0X3Jlc3VsdCBzaW5j
ZSB0aGUgbm9vcCwgaWYKISAJICAgc2VudCwgd2VudCB0byBhIGRpZmZlcmVudCBzZXJ2ZXIgKi8K
ISAJcHJvdF9wcmludGYocHJveHlkX291dCwgIiVzICVzIiwgdGFnLCBzLT5sYXN0X3Jlc3VsdCk7
CiAgICAgIH0KICB9CiAgCi0tLSAyODMzLDI4NDcgLS0tLQogIAlwcm90X3ByaW50ZihiYWNrZW5k
X2N1cnJlbnQtPm91dCwgIiVzIE5vb3BcclxuIiwgbXl0YWcpOwogIAlwaXBlX3VudGlsX3RhZyhi
YWNrZW5kX2N1cnJlbnQsIG15dGFnLCAwKTsKICAgICAgfQohICAgICBpZiAoIXIpIHsKISAJcHJv
dF9wcmludGYocy0+b3V0LCAiJXMgQXBwZW5kIHslZCt9XHJcbiVzICIsIHRhZywgc3RybGVuKG5h
bWUpLCBuYW1lKTsKISAJaWYgKCFwaXBlX2NvbW1hbmQocywgMTYzODQpKSB7CiEgCSAgICBpZiAo
IWJhY2tlbmRfY3VycmVudCB8fCBzICE9IGJhY2tlbmRfY3VycmVudCkKISAJCXBpcGVfaW5jbHVk
aW5nX3RhZyhzLCB0YWcsIDApOwohIAl9CiAgICAgIH0gZWxzZSB7CiEgCWVhdGxpbmUocHJveHlk
X2luLCBwcm90X2dldGMocHJveHlkX2luKSk7CiEgCXByb3RfcHJpbnRmKHByb3h5ZF9vdXQsICIl
cyBOTyAlc1xyXG4iLCB0YWcsIGVycm9yX21lc3NhZ2UocikpOwogICAgICB9CiAgfQogIAoqKioq
KioqKioqKioqKioKKioqIDI4MDgsMjgxMyAqKioqCi0tLSAyODc4LDI4ODYgLS0tLQogICAgICBp
ZiAoYmFja2VuZF9jdXJyZW50ICYmIGJhY2tlbmRfY3VycmVudCAhPSBiYWNrZW5kX25leHQpIHsK
ICAJY2hhciBteXRhZ1sxMjhdOwogIAorIAkvKiByZW1vdmUgYmFja2VuZF9jdXJyZW50IGZyb20g
dGhlIHByb3Rncm91cCAqLworIAlwcm90Z3JvdXBfZGVsZXRlKHByb3RpbiwgYmFja2VuZF9jdXJy
ZW50LT5pbik7CisgCiAgCS8qIHN3aXRjaGluZyBzZXJ2ZXJzOyBmbHVzaCBvbGQgc2VydmVyIG91
dHB1dCAqLwogIAlwcm94eWRfZ2VudGFnKG15dGFnLCBzaXplb2YobXl0YWcpKTsKICAJcHJvdF9w
cmludGYoYmFja2VuZF9jdXJyZW50LT5vdXQsICIlcyBVbnNlbGVjdFxyXG4iLCBteXRhZyk7Cioq
KioqKioqKioqKioqKgoqKiogMjgyOSwyODM0ICoqKioKLS0tIDI5MDIsMjkxMCAtLS0tCiAgCXBy
b2NfcmVnaXN0ZXIoInByb3h5ZCIsIHByb3h5ZF9jbGllbnRob3N0LCBwcm94eWRfdXNlcmlkLCBt
YWlsYm94bmFtZSk7CiAgCXN5c2xvZyhMT0dfREVCVUcsICJvcGVuOiB1c2VyICVzIG9wZW5lZCAl
cyBvbiAlcyIsIHByb3h5ZF91c2VyaWQsIG5hbWUsCiAgCSAgICAgICBuZXdzZXJ2ZXIpOworIAor
IAkvKiBhZGQgYmFja2VuZF9jdXJyZW50IHRvIHRoZSBwcm90Z3JvdXAgKi8KKyAJcHJvdGdyb3Vw
X2luc2VydChwcm90aW4sIGJhY2tlbmRfY3VycmVudC0+aW4pOwogIAlicmVhazsKICAgICAgZGVm
YXVsdDoKICAJc3lzbG9nKExPR19ERUJVRywgIm9wZW46IHVzZXIgJXMgZmFpbGVkIHRvIG9wZW4g
JXMiLCBwcm94eWRfdXNlcmlkLAoqKioqKioqKioqKioqKioKKioqIDI4NDUsMjg1MCAqKioqCi0t
LSAyOTIxLDI5MjkgLS0tLQogIHZvaWQgY21kX2Nsb3NlKGNoYXIgKnRhZykKICB7CiAgICAgIGFz
c2VydChiYWNrZW5kX2N1cnJlbnQgIT0gTlVMTCk7CisgCisgICAgIC8qIHJlbW92ZSBiYWNrZW5k
X2N1cnJlbnQgZnJvbSB0aGUgcHJvdGdyb3VwICovCisgICAgIHByb3Rncm91cF9kZWxldGUocHJv
dGluLCBiYWNrZW5kX2N1cnJlbnQtPmluKTsKICAgICAgCiAgICAgIHByb3RfcHJpbnRmKGJhY2tl
bmRfY3VycmVudC0+b3V0LCAiJXMgQ2xvc2VcclxuIiwgdGFnKTsKICAgICAgLyogeHh4IGRvIHdl
IHdhbnQgdGhpcyB0byBzYXkgT0sgaWYgdGhlIGNvbm5lY3Rpb24gaXMgZ29uZT8KKioqKioqKioq
KioqKioqCioqKiAyODYxLDI4NjYgKioqKgotLS0gMjk0MCwyOTQ4IC0tLS0KICB7CiAgICAgIGFz
c2VydChiYWNrZW5kX2N1cnJlbnQgIT0gTlVMTCk7CiAgCisgICAgIC8qIHJlbW92ZSBiYWNrZW5k
X2N1cnJlbnQgZnJvbSB0aGUgcHJvdGdyb3VwICovCisgICAgIHByb3Rncm91cF9kZWxldGUocHJv
dGluLCBiYWNrZW5kX2N1cnJlbnQtPmluKTsKKyAKICAgICAgcHJvdF9wcmludGYoYmFja2VuZF9j
dXJyZW50LT5vdXQsICIlcyBVbnNlbGVjdFxyXG4iLCB0YWcpOwogICAgICAvKiB4eHggZG8gd2Ug
d2FudCB0aGlzIHRvIHNheSBPSyBpZiB0aGUgY29ubmVjdGlvbiBpcyBnb25lPwogICAgICAgKiBz
YXlpbmcgTk8gaXMgY2xlYXJseSB3cm9uZywgaGVuc2UgdGhlIGZhdGFsIHJlcXVlc3QuICovCioq
KioqKioqKioqKioqKgoqKiogMjg4MCwyODg4ICoqKioKICAgICAgYXNzZXJ0KGJhY2tlbmRfY3Vy
cmVudCAhPSBOVUxMKTsKICAKICAgICAgcHJvdF9wcmludGYoYmFja2VuZF9jdXJyZW50LT5vdXQs
ICIlcyAlcyAlcyAiLCB0YWcsIGNtZCwgc2VxdWVuY2UpOwohICAgICBpZiAoIXBpcGVfY29tbWFu
ZChiYWNrZW5kX2N1cnJlbnQsIDY1NTM2KSkgewohIAlwaXBlX2luY2x1ZGluZ190YWcoYmFja2Vu
ZF9jdXJyZW50LCB0YWcsIDApOwohICAgICB9CiAgfQogIAogIC8qCi0tLSAyOTYyLDI5NjggLS0t
LQogICAgICBhc3NlcnQoYmFja2VuZF9jdXJyZW50ICE9IE5VTEwpOwogIAogICAgICBwcm90X3By
aW50ZihiYWNrZW5kX2N1cnJlbnQtPm91dCwgIiVzICVzICVzICIsIHRhZywgY21kLCBzZXF1ZW5j
ZSk7CiEgICAgIHBpcGVfY29tbWFuZChiYWNrZW5kX2N1cnJlbnQsIDY1NTM2KTsKICB9CiAgCiAg
LyoKKioqKioqKioqKioqKioqCioqKiAyODk0LDI5MDAgKioqKgogIAogICAgICBwcm90X3ByaW50
ZihiYWNrZW5kX2N1cnJlbnQtPm91dCwgIiVzIFBhcnRpYWwgJXMgJXMgJXMgJXNcclxuIiwKICAJ
CXRhZywgbXNnbm8sIGRhdGEsIHN0YXJ0LCBjb3VudCk7Ci0gICAgIHBpcGVfaW5jbHVkaW5nX3Rh
ZyhiYWNrZW5kX2N1cnJlbnQsIHRhZywgMCk7CiAgfQogIAogIC8qCi0tLSAyOTc0LDI5NzkgLS0t
LQoqKioqKioqKioqKioqKioKKioqIDI5MTAsMjkxOCAqKioqCiAgCiAgICAgIHByb3RfcHJpbnRm
KGJhY2tlbmRfY3VycmVudC0+b3V0LCAiJXMgJXMgJXMgJXMgIiwKICAJCXRhZywgY21kLCBzZXF1
ZW5jZSwgb3BlcmF0aW9uKTsKISAgICAgaWYgKCFwaXBlX2NvbW1hbmQoYmFja2VuZF9jdXJyZW50
LCA2NTUzNikpIHsKISAJcGlwZV9pbmNsdWRpbmdfdGFnKGJhY2tlbmRfY3VycmVudCwgdGFnLCAw
KTsKISAgICAgfQogIH0KICAKICB2b2lkIGNtZF9zZWFyY2goY2hhciAqdGFnLCBpbnQgdXNpbmd1
aWQpCi0tLSAyOTg5LDI5OTUgLS0tLQogIAogICAgICBwcm90X3ByaW50ZihiYWNrZW5kX2N1cnJl
bnQtPm91dCwgIiVzICVzICVzICVzICIsCiAgCQl0YWcsIGNtZCwgc2VxdWVuY2UsIG9wZXJhdGlv
bik7CiEgICAgIHBpcGVfY29tbWFuZChiYWNrZW5kX2N1cnJlbnQsIDY1NTM2KTsKICB9CiAgCiAg
dm9pZCBjbWRfc2VhcmNoKGNoYXIgKnRhZywgaW50IHVzaW5ndWlkKQoqKioqKioqKioqKioqKioK
KioqIDI5MjIsMjkzMCAqKioqCiAgICAgIGFzc2VydChiYWNrZW5kX2N1cnJlbnQgIT0gTlVMTCk7
CiAgCiAgICAgIHByb3RfcHJpbnRmKGJhY2tlbmRfY3VycmVudC0+b3V0LCAiJXMgJXMgIiwgdGFn
LCBjbWQpOwohICAgICBpZiAoIXBpcGVfY29tbWFuZChiYWNrZW5kX2N1cnJlbnQsIDY1NTM2KSkg
ewohIAlwaXBlX2luY2x1ZGluZ190YWcoYmFja2VuZF9jdXJyZW50LCB0YWcsIDApOwohICAgICB9
CiAgfQogIAogIHZvaWQgY21kX3NvcnQoY2hhciAqdGFnLCBpbnQgdXNpbmd1aWQpCi0tLSAyOTk5
LDMwMDUgLS0tLQogICAgICBhc3NlcnQoYmFja2VuZF9jdXJyZW50ICE9IE5VTEwpOwogIAogICAg
ICBwcm90X3ByaW50ZihiYWNrZW5kX2N1cnJlbnQtPm91dCwgIiVzICVzICIsIHRhZywgY21kKTsK
ISAgICAgcGlwZV9jb21tYW5kKGJhY2tlbmRfY3VycmVudCwgNjU1MzYpOwogIH0KICAKICB2b2lk
IGNtZF9zb3J0KGNoYXIgKnRhZywgaW50IHVzaW5ndWlkKQoqKioqKioqKioqKioqKioKKioqIDI5
MzQsMjk0MiAqKioqCiAgICAgIGFzc2VydChiYWNrZW5kX2N1cnJlbnQgIT0gTlVMTCk7CiAgCiAg
ICAgIHByb3RfcHJpbnRmKGJhY2tlbmRfY3VycmVudC0+b3V0LCAiJXMgJXMgIiwgdGFnLCBjbWQp
OwohICAgICBpZiAoIXBpcGVfY29tbWFuZChiYWNrZW5kX2N1cnJlbnQsIDY1NTM2KSkgewohIAlw
aXBlX2luY2x1ZGluZ190YWcoYmFja2VuZF9jdXJyZW50LCB0YWcsIDApOwohICAgICB9CiAgfQog
IAogIHZvaWQgY21kX3RocmVhZChjaGFyICp0YWcsIGludCB1c2luZ3VpZCkKLS0tIDMwMDksMzAx
NSAtLS0tCiAgICAgIGFzc2VydChiYWNrZW5kX2N1cnJlbnQgIT0gTlVMTCk7CiAgCiAgICAgIHBy
b3RfcHJpbnRmKGJhY2tlbmRfY3VycmVudC0+b3V0LCAiJXMgJXMgIiwgdGFnLCBjbWQpOwohICAg
ICBwaXBlX2NvbW1hbmQoYmFja2VuZF9jdXJyZW50LCA2NTUzNik7CiAgfQogIAogIHZvaWQgY21k
X3RocmVhZChjaGFyICp0YWcsIGludCB1c2luZ3VpZCkKKioqKioqKioqKioqKioqCioqKiAyOTQ2
LDI5NTQgKioqKgogICAgICBhc3NlcnQoYmFja2VuZF9jdXJyZW50ICE9IE5VTEwpOwogIAogICAg
ICBwcm90X3ByaW50ZihiYWNrZW5kX2N1cnJlbnQtPm91dCwgIiVzICVzICIsIHRhZywgY21kKTsK
ISAgICAgaWYgKCFwaXBlX2NvbW1hbmQoYmFja2VuZF9jdXJyZW50LCA2NTUzNikpIHsKISAJcGlw
ZV9pbmNsdWRpbmdfdGFnKGJhY2tlbmRfY3VycmVudCwgdGFnLCAwKTsKISAgICAgfQogIH0KICAK
ICBzdGF0aWMgaW50IGNob21wKHN0cnVjdCBwcm90c3RyZWFtICpwLCBjaGFyICpzKQotLS0gMzAx
OSwzMDI1IC0tLS0KICAgICAgYXNzZXJ0KGJhY2tlbmRfY3VycmVudCAhPSBOVUxMKTsKICAKICAg
ICAgcHJvdF9wcmludGYoYmFja2VuZF9jdXJyZW50LT5vdXQsICIlcyAlcyAiLCB0YWcsIGNtZCk7
CiEgICAgIHBpcGVfY29tbWFuZChiYWNrZW5kX2N1cnJlbnQsIDY1NTM2KTsKICB9CiAgCiAgc3Rh
dGljIGludCBjaG9tcChzdHJ1Y3QgcHJvdHN0cmVhbSAqcCwgY2hhciAqcykKKioqKioqKioqKioq
KioqCioqKiAzMDU1LDMwNjEgKioqKgogIAkvKiB0aGlzIGlzIHRoZSBlYXN5IGNhc2UgKi8KICAJ
cHJvdF9wcmludGYoYmFja2VuZF9jdXJyZW50LT5vdXQsICIlcyAlcyAlcyB7JWQrfVxyXG4lc1xy
XG4iLAogIAkJICAgIHRhZywgY21kLCBzZXF1ZW5jZSwgc3RybGVuKG5hbWUpLCBuYW1lKTsKLSAJ
cGlwZV9pbmNsdWRpbmdfdGFnKGJhY2tlbmRfY3VycmVudCwgdGFnLCAwKTsKICAgICAgfSBlbHNl
IHsKICAJY2hhciBteXRhZ1sxMjhdOwogIAlzdHJ1Y3QgZCB7Ci0tLSAzMTI2LDMxMzEgLS0tLQoq
KioqKioqKioqKioqKioKKioqIDMzODksMzM5NSAqKioqCiAgICAgIH0gZWxzZSB7CiAgCXByb3Rf
cHJpbnRmKGJhY2tlbmRfY3VycmVudC0+b3V0LCAiJXMgRXhwdW5nZVxyXG4iLCB0YWcpOwogICAg
ICB9Ci0gICAgIHBpcGVfaW5jbHVkaW5nX3RhZyhiYWNrZW5kX2N1cnJlbnQsIHRhZywgMCk7CiAg
fSAgICAKICAKICAvKgotLS0gMzQ1OSwzNDY0IC0tLS0KKioqKioqKioqKioqKioqCioqKiAzNDM5
LDM0NDYgKioqKgogIAkvKiBvaywgc2VuZCB0aGUgY3JlYXRlIHRvIHRoYXQgc2VydmVyICovCiAg
CXByb3RfcHJpbnRmKHMtPm91dCwgIiVzIENSRUFURSB7JWQrfVxyXG4lc1xyXG4iLCAKICAJCSAg
ICB0YWcsIHN0cmxlbihuYW1lKSwgbmFtZSk7CiEgCXJlcyA9IHBpcGVfaW5jbHVkaW5nX3RhZyhz
LCB0YWcsIDApOwohIAl0YWcgPSAiKiI7CQkvKiBjYW4ndCBzZW5kIGFub3RoZXIgdGFnZ2VkIHJl
c3BvbnNlICovCiAgCQogIAlpZiAoIUNBUEEocywgQ0FQQV9NVVBEQVRFKSkgewogIAkgICAgLyog
ZG8gTVVQREFURSBjcmVhdGUgb3BlcmF0aW9ucyAqLwotLS0gMzUwOCwzNTE3IC0tLS0KICAJLyog
b2ssIHNlbmQgdGhlIGNyZWF0ZSB0byB0aGF0IHNlcnZlciAqLwogIAlwcm90X3ByaW50ZihzLT5v
dXQsICIlcyBDUkVBVEUgeyVkK31cclxuJXNcclxuIiwgCiAgCQkgICAgdGFnLCBzdHJsZW4obmFt
ZSksIG5hbWUpOwohIAlpZiAoIWJhY2tlbmRfY3VycmVudCB8fCBzICE9IGJhY2tlbmRfY3VycmVu
dCkgewohIAkgICAgcmVzID0gcGlwZV9pbmNsdWRpbmdfdGFnKHMsIHRhZywgMCk7CiEgCSAgICB0
YWcgPSAiKiI7CQkvKiBjYW4ndCBzZW5kIGFub3RoZXIgdGFnZ2VkIHJlc3BvbnNlICovCiEgCX0K
ICAJCiAgCWlmICghQ0FQQShzLCBDQVBBX01VUERBVEUpKSB7CiAgCSAgICAvKiBkbyBNVVBEQVRF
IGNyZWF0ZSBvcGVyYXRpb25zICovCioqKioqKioqKioqKioqKgoqKiogMzQ4MCwzNDg3ICoqKioK
ICAgICAgaWYgKCFyKSB7CiAgCXByb3RfcHJpbnRmKHMtPm91dCwgIiVzIERFTEVURSB7JWQrfVxy
XG4lc1xyXG4iLCAKICAJCSAgICB0YWcsIHN0cmxlbihuYW1lKSwgbmFtZSk7CiEgCXJlcyA9IHBp
cGVfaW5jbHVkaW5nX3RhZyhzLCB0YWcsIDApOwohIAl0YWcgPSAiKiI7CQkvKiBjYW4ndCBzZW5k
IGFub3RoZXIgdGFnZ2VkIHJlc3BvbnNlICovCiAgCiAgCWlmICghQ0FQQShzLCBDQVBBX01VUERB
VEUpICYmIHJlcyA9PSBQUk9YWV9PSykgewogIAkgICAgLyogZG8gTVVQREFURSBkZWxldGUgb3Bl
cmF0aW9ucyAqLwotLS0gMzU1MSwzNTYwIC0tLS0KICAgICAgaWYgKCFyKSB7CiAgCXByb3RfcHJp
bnRmKHMtPm91dCwgIiVzIERFTEVURSB7JWQrfVxyXG4lc1xyXG4iLCAKICAJCSAgICB0YWcsIHN0
cmxlbihuYW1lKSwgbmFtZSk7CiEgCWlmICghYmFja2VuZF9jdXJyZW50IHx8IHMgIT0gYmFja2Vu
ZF9jdXJyZW50KSB7CiEgCSAgICByZXMgPSBwaXBlX2luY2x1ZGluZ190YWcocywgdGFnLCAwKTsK
ISAJICAgIHRhZyA9ICIqIjsJCS8qIGNhbid0IHNlbmQgYW5vdGhlciB0YWdnZWQgcmVzcG9uc2Ug
Ki8KISAJfQogIAogIAlpZiAoIUNBUEEocywgQ0FQQV9NVVBEQVRFKSAmJiByZXMgPT0gUFJPWFlf
T0spIHsKICAJICAgIC8qIGRvIE1VUERBVEUgZGVsZXRlIG9wZXJhdGlvbnMgKi8KKioqKioqKioq
KioqKioqCioqKiAzODExLDM4MTcgKioqKgogIAkJCXRhZywgY21kLCAKICAJCQlzdHJsZW4obmFt
ZSksIG5hbWUpOwogIAl9CiEgCXBpcGVfaW5jbHVkaW5nX3RhZyhiYWNrZW5kX2luYm94LCB0YWcs
IDApOwogICAgICB9IGVsc2UgewogIAlyID0gSU1BUF9TRVJWRVJfVU5BVkFJTEFCTEU7CiAgICAg
IH0KLS0tIDM4ODQsMzg5MSAtLS0tCiAgCQkJdGFnLCBjbWQsIAogIAkJCXN0cmxlbihuYW1lKSwg
bmFtZSk7CiAgCX0KISAJaWYgKCFiYWNrZW5kX2N1cnJlbnQgfHwgYmFja2VuZF9pbmJveCAhPSBi
YWNrZW5kX2N1cnJlbnQpCiEgCSAgICBwaXBlX2luY2x1ZGluZ190YWcoYmFja2VuZF9pbmJveCwg
dGFnLCAwKTsKICAgICAgfSBlbHNlIHsKICAJciA9IElNQVBfU0VSVkVSX1VOQVZBSUxBQkxFOwog
ICAgICB9CioqKioqKioqKioqKioqKgoqKiogNDA1MSw0MDU4ICoqKioKICAJCQl0YWcsIHN0cmxl
bihuYW1lKSwgbmFtZSwKICAJCQlzdHJsZW4oaWRlbnRpZmllciksIGlkZW50aWZpZXIpOwogIAl9
CSAgICAKISAJcmVzID0gcGlwZV9pbmNsdWRpbmdfdGFnKHMsIHRhZywgMCk7CiEgCXRhZyA9ICIq
IjsJCS8qIGNhbid0IHNlbmQgYW5vdGhlciB0YWdnZWQgcmVzcG9uc2UgKi8KICAJaWYgKCFDQVBB
KHMsIENBUEFfTVVQREFURSkgJiYgcmVzID09IFBST1hZX09LKSB7CiAgCSAgICAvKiBzZXR1cCBu
ZXcgQUNMIGluIE1VUERBVEUgKi8KICAJfQotLS0gNDEyNSw0MTM0IC0tLS0KICAJCQl0YWcsIHN0
cmxlbihuYW1lKSwgbmFtZSwKICAJCQlzdHJsZW4oaWRlbnRpZmllciksIGlkZW50aWZpZXIpOwog
IAl9CSAgICAKISAJaWYgKCFiYWNrZW5kX2N1cnJlbnQgfHwgcyAhPSBiYWNrZW5kX2N1cnJlbnQp
IHsKISAJICAgIHJlcyA9IHBpcGVfaW5jbHVkaW5nX3RhZyhzLCB0YWcsIDApOwohIAkgICAgdGFn
ID0gIioiOwkJLyogY2FuJ3Qgc2VuZCBhbm90aGVyIHRhZ2dlZCByZXNwb25zZSAqLwohIAl9CiAg
CWlmICghQ0FQQShzLCBDQVBBX01VUERBVEUpICYmIHJlcyA9PSBQUk9YWV9PSykgewogIAkgICAg
Lyogc2V0dXAgbmV3IEFDTCBpbiBNVVBEQVRFICovCiAgCX0KKioqKioqKioqKioqKioqCioqKiA0
MTUwLDQxNTYgKioqKgogIAlpZiAocykgewogIAkgICAgcHJvdF9wcmludGYocy0+b3V0LCAiJXMg
R2V0cXVvdGFyb290IHslZCt9XHJcbiVzXHJcbiIsCiAgCQkJdGFnLCBzdHJsZW4obmFtZSksIG5h
bWUpOwohIAkgICAgcGlwZV9pbmNsdWRpbmdfdGFnKHMsIHRhZywgMCk7CiAgCX0gZWxzZSB7CiAg
CSAgICByID0gSU1BUF9TRVJWRVJfVU5BVkFJTEFCTEU7CiAgCX0KLS0tIDQyMjYsNDIzMyAtLS0t
CiAgCWlmIChzKSB7CiAgCSAgICBwcm90X3ByaW50ZihzLT5vdXQsICIlcyBHZXRxdW90YXJvb3Qg
eyVkK31cclxuJXNcclxuIiwKICAJCQl0YWcsIHN0cmxlbihuYW1lKSwgbmFtZSk7CiEgCSAgICBp
ZiAoIWJhY2tlbmRfY3VycmVudCB8fCBzICE9IGJhY2tlbmRfY3VycmVudCkKISAJCXBpcGVfaW5j
bHVkaW5nX3RhZyhzLCB0YWcsIDApOwogIAl9IGVsc2UgewogIAkgICAgciA9IElNQVBfU0VSVkVS
X1VOQVZBSUxBQkxFOwogIAl9CioqKioqKioqKioqKioqKgoqKiogNDM3NSw0Mzg1ICoqKioKICAg
ICAgaWYgKCFyKSBzID0gcHJveHlkX2ZpbmRzZXJ2ZXIoc2VydmVyKTsKICAgICAgaWYgKCFyICYm
ICFzKSByID0gSU1BUF9TRVJWRVJfVU5BVkFJTEFCTEU7CiAgICAgIGlmICghcikgewotIAlwcm90
X3ByaW50ZihzLT5vdXQsICIlcyBTdGF0dXMgeyVkK31cclxuJXMgIiwgdGFnLAotIAkJICAgIHN0
cmxlbihuYW1lKSwgbmFtZSk7Ci0gCWlmICghcGlwZV9jb21tYW5kKHMsIDY1NTM2KSkgewotIAkg
ICAgcGlwZV91bnRpbF90YWcocywgdGFnLCAwKTsKLSAJfQogIAlpZiAoYmFja2VuZF9jdXJyZW50
ICYmIHMgIT0gYmFja2VuZF9jdXJyZW50KSB7CiAgCSAgICBjaGFyIG15dGFnWzEyOF07CiAgCSAg
ICAKLS0tIDQ0NTIsNDQ1NyAtLS0tCioqKioqKioqKioqKioqKgoqKiogNDM4OCw0NDAwICoqKioK
ICAJICAgIHByb3RfcHJpbnRmKGJhY2tlbmRfY3VycmVudC0+b3V0LCAiJXMgTm9vcFxyXG4iLCBt
eXRhZyk7CiAgCSAgICBwaXBlX3VudGlsX3RhZyhiYWNrZW5kX2N1cnJlbnQsIG15dGFnLCAwKTsK
ICAJfQogICAgICB9IGVsc2UgewogIAllYXRsaW5lKHByb3h5ZF9pbiwgcHJvdF9nZXRjKHByb3h5
ZF9pbikpOwotICAgICB9Ci0gCi0gICAgIGlmICghcikgewotIAlwcm90X3ByaW50Zihwcm94eWRf
b3V0LCAiJXMgJXMiLCB0YWcsIHMtPmxhc3RfcmVzdWx0KTsKLSAgICAgfSBlbHNlIHsKICAJcHJv
dF9wcmludGYocHJveHlkX291dCwgIiVzIE5PICVzXHJcbiIsIHRhZywgZXJyb3JfbWVzc2FnZShy
KSk7CiAgICAgIH0KICB9Ci0tLSA0NDYwLDQ0NzMgLS0tLQogIAkgICAgcHJvdF9wcmludGYoYmFj
a2VuZF9jdXJyZW50LT5vdXQsICIlcyBOb29wXHJcbiIsIG15dGFnKTsKICAJICAgIHBpcGVfdW50
aWxfdGFnKGJhY2tlbmRfY3VycmVudCwgbXl0YWcsIDApOwogIAl9CisgCXByb3RfcHJpbnRmKHMt
Pm91dCwgIiVzIFN0YXR1cyB7JWQrfVxyXG4lcyAiLCB0YWcsCisgCQkgICAgc3RybGVuKG5hbWUp
LCBuYW1lKTsKKyAJaWYgKCFwaXBlX2NvbW1hbmQocywgNjU1MzYpKSB7CisgCSAgICBpZiAoIWJh
Y2tlbmRfY3VycmVudCB8fCBzICE9IGJhY2tlbmRfY3VycmVudCkKKyAJCXBpcGVfaW5jbHVkaW5n
X3RhZyhzLCB0YWcsIDApOworIAl9CiAgICAgIH0gZWxzZSB7CiAgCWVhdGxpbmUocHJveHlkX2lu
LCBwcm90X2dldGMocHJveHlkX2luKSk7CiAgCXByb3RfcHJpbnRmKHByb3h5ZF9vdXQsICIlcyBO
TyAlc1xyXG4iLCB0YWcsIGVycm9yX21lc3NhZ2UocikpOwogICAgICB9CiAgfQpJbmRleDogbGli
L3Byb3QuYwo9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09ClJDUyBmaWxlOiAvYWZzL2FuZHJldy9zeXN0ZW0vY3ZzL3NyYy9j
eXJ1cy9saWIvcHJvdC5jLHYKcmV0cmlldmluZyByZXZpc2lvbiAxLjg2CmRpZmYgLWMgLXIxLjg2
IHByb3QuYwoqKiogbGliL3Byb3QuYwkyNyBGZWIgMjAwNCAyMjowODo1NiAtMDAwMAkxLjg2Ci0t
LSBsaWIvcHJvdC5jCTE1IE1hciAyMDA0IDE4OjQ2OjI4IC0wMDAwCioqKioqKioqKioqKioqKgoq
KiogMTAwNCwxMDA5ICoqKioKLS0tIDEwMDQsMTAxMCAtLS0tCiAgCXRpbWVfdCB0aGlzX3RpbWVv
dXQgPSAwOyAgIC8qIHRoaXMgc3RyZWFtICovCiAgCQogIAlzID0gcmVhZHN0cmVhbXMtPmdyb3Vw
W2ldOworIAlpZiAoIXMpIGNvbnRpbnVlOwogIAogIAlhc3NlcnQoIXMtPndyaXRlKTsKICAKKioq
KioqKioqKioqKioqCioqKiAxMTA1LDExMTAgKioqKgotLS0gMTEwNiwxMTEyIC0tLS0KICAJCiAg
CWZvcihpID0gMDsgaTxyZWFkc3RyZWFtcy0+bmV4dF9lbGVtZW50OyBpKyspIHsKICAJICAgIHMg
PSByZWFkc3RyZWFtcy0+Z3JvdXBbaV07CisgCSAgICBpZiAoIXMpIGNvbnRpbnVlOwogIAogIAkg
ICAgaWYoRkRfSVNTRVQocy0+ZmQsICZyZmRzKSkgewogIAkJZm91bmRfZmRzKys7CioqKioqKioq
KioqKioqKgoqKiogMTE5OCwxMjEzICoqKioKICAKICB2b2lkIHByb3Rncm91cF9pbnNlcnQoc3Ry
dWN0IHByb3Rncm91cCAqZ3JvdXAsIHN0cnVjdCBwcm90c3RyZWFtICppdGVtKSAKICB7CiAgICAg
IGFzc2VydChncm91cCk7CiAgICAgIGFzc2VydChpdGVtKTsKISAgICAgLyogRG91YmxlIHNpemUg
b2YgdGhlIHByb3Rncm91cCBpZiB3ZSdyZSBhdCBvdXIgbGltaXQgKi8KISAgICAgaWYoZ3JvdXAt
Pm5leHRfZWxlbWVudCA9PSBncm91cC0+bmFsbG9jZWQpIHsKICAJZ3JvdXAtPm5hbGxvY2VkICo9
IDI7CiAgCWdyb3VwLT5ncm91cCA9IHhyZWFsbG9jKGdyb3VwLT5ncm91cCwKICAJCQkJZ3JvdXAt
Pm5hbGxvY2VkICogc2l6ZW9mKHN0cnVjdCBwcm90c3RyZWFtICopKTsKICAgICAgfQohICAgICAv
KiBJbnNlcnQgdGhlIGl0ZW0gb24gdGhlIGVuZCBvZiB0aGUgZ3JvdXAgKi8KISAgICAgZ3JvdXAt
Pmdyb3VwW2dyb3VwLT5uZXh0X2VsZW1lbnQrK10gPSBpdGVtOwogIH0KICAKICBzdHJ1Y3QgcHJv
dHN0cmVhbSAqcHJvdGdyb3VwX2dldGVsZW1lbnQoc3RydWN0IHByb3Rncm91cCAqZ3JvdXAsCi0t
LSAxMjAwLDEyNDAgLS0tLQogIAogIHZvaWQgcHJvdGdyb3VwX2luc2VydChzdHJ1Y3QgcHJvdGdy
b3VwICpncm91cCwgc3RydWN0IHByb3RzdHJlYW0gKml0ZW0pIAogIHsKKyAgICAgaW50IGksIGVt
cHR5OworIAogICAgICBhc3NlcnQoZ3JvdXApOwogICAgICBhc3NlcnQoaXRlbSk7CiEgCiEgICAg
IC8qIFNlZSBpZiB3ZSBhbHJlYWR5IGhhdmUgdGhpcyBwcm90c3RyZWFtICovCiEgICAgIGZvciAo
aSA9IDAsIGVtcHR5ID0gZ3JvdXAtPm5leHRfZWxlbWVudDsgaSA8IGdyb3VwLT5uZXh0X2VsZW1l
bnQ7IGkrKykgewohIAlpZiAoIWdyb3VwLT5ncm91cFtpXSkgZW1wdHkgPSBpOwohIAllbHNlIGlm
IChncm91cC0+Z3JvdXBbaV0gPT0gaXRlbSkgcmV0dXJuOwohICAgICB9CiEgICAgIC8qIERvdWJs
ZSBzaXplIG9mIHRoZSBwcm90Z3JvdXAgaWYgd2UncmUgYXQgb3VyIGxpbWl0ICovIAohICAgICBp
ZiAoZW1wdHkgPT0gZ3JvdXAtPm5leHRfZWxlbWVudCAmJgohIAlncm91cC0+bmV4dF9lbGVtZW50
KysgPT0gZ3JvdXAtPm5hbGxvY2VkKSB7CiAgCWdyb3VwLT5uYWxsb2NlZCAqPSAyOwogIAlncm91
cC0+Z3JvdXAgPSB4cmVhbGxvYyhncm91cC0+Z3JvdXAsCiAgCQkJCWdyb3VwLT5uYWxsb2NlZCAq
IHNpemVvZihzdHJ1Y3QgcHJvdHN0cmVhbSAqKSk7CiAgICAgIH0KISAgICAgLyogSW5zZXJ0IHRo
ZSBpdGVtIGF0IHRoZSBlbXB0eSBsb2NhdGlvbiAqLwohICAgICBncm91cC0+Z3JvdXBbZW1wdHld
ID0gaXRlbTsKISB9CiEgCiEgdm9pZCBwcm90Z3JvdXBfZGVsZXRlKHN0cnVjdCBwcm90Z3JvdXAg
Kmdyb3VwLCBzdHJ1Y3QgcHJvdHN0cmVhbSAqaXRlbSkgCiEgewohICAgICBpbnQgaTsKISAKISAg
ICAgYXNzZXJ0KGdyb3VwKTsKISAgICAgYXNzZXJ0KGl0ZW0pOwohIAohICAgICAvKiBmaW5kIHRo
ZSBwcm90c3RyZWFtICovCiEgICAgIGZvciAoaSA9IDA7IGkgPCBncm91cC0+bmV4dF9lbGVtZW50
OyBpKyspIHsKISAJaWYgKGdyb3VwLT5ncm91cFtpXSA9PSBpdGVtKSB7CiEgCSAgICBncm91cC0+
Z3JvdXBbaV0gPSBOVUxMOwohIAkgICAgcmV0dXJuOwohIAl9CiEgICAgIH0KICB9CiAgCiAgc3Ry
dWN0IHByb3RzdHJlYW0gKnByb3Rncm91cF9nZXRlbGVtZW50KHN0cnVjdCBwcm90Z3JvdXAgKmdy
b3VwLApJbmRleDogbGliL3Byb3QuaAo9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09ClJDUyBmaWxlOiAvYWZzL2FuZHJldy9z
eXN0ZW0vY3ZzL3NyYy9jeXJ1cy9saWIvcHJvdC5oLHYKcmV0cmlldmluZyByZXZpc2lvbiAxLjQx
CmRpZmYgLWMgLXIxLjQxIHByb3QuaAoqKiogbGliL3Byb3QuaAkyNyBGZWIgMjAwNCAyMjowODo1
NyAtMDAwMAkxLjQxCi0tLSBsaWIvcHJvdC5oCTE1IE1hciAyMDA0IDE4OjQ2OjI4IC0wMDAwCioq
KioqKioqKioqKioqKgoqKiogMjMyLDIzNyAqKioqCi0tLSAyMzIsMjQwIC0tLS0KICAvKiBJbnNl
cnQgYW4gZWxlbWVudCBpbnRvIGEgcHJvdGdyb3VwICovCiAgdm9pZCBwcm90Z3JvdXBfaW5zZXJ0
KHN0cnVjdCBwcm90Z3JvdXAgKmdyb3VwLCBzdHJ1Y3QgcHJvdHN0cmVhbSAqaXRlbSk7CiAgCisg
LyogRGVsZXRlIGFuIGVsZW1lbnQgZnJvbSBhIHByb3Rncm91cCAqLworIHZvaWQgcHJvdGdyb3Vw
X2RlbGV0ZShzdHJ1Y3QgcHJvdGdyb3VwICpncm91cCwgc3RydWN0IHByb3RzdHJlYW0gKml0ZW0p
OworIAogIC8qIFJldHVybnMgdGhlIHByb3RzdHJlYW0gYXQgdGhhdCBwb3NpdGlvbiBpbiB0aGUg
cHJvdGdyb3VwLCBvciBOVUxMIGlmCiAgICogYW4gaW52YWxpZCBlbGVtZW50IGlzIHJlcXVlc3Rl
ZCAqLwogIHN0cnVjdCBwcm90c3RyZWFtICpwcm90Z3JvdXBfZ2V0ZWxlbWVudChzdHJ1Y3QgcHJv
dGdyb3VwICpncm91cCwK
</data>        

          </attachment>
          <attachment
              isobsolete="0"
              ispatch="1"
              isprivate="0"
          >
            <attachid>301</attachid>
            <date>2004-08-06 12:42 EDT</date>
            <desc>pipeline to selected backend only patch for 2.3</desc>
            <filename>proxy_pipeline.patch</filename>
            <type>text/plain</type>
            <size>13143</size>
            <attacher>ken@oceana.com</attacher>
            
              <data encoding="base64">SW5kZXg6IGltYXAvaW1hcGQuYwo9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09ClJDUyBmaWxlOiAvYWZzL2FuZHJldy9zeXN0
ZW0vY3ZzL3NyYy9jeXJ1cy9pbWFwL2ltYXBkLmMsdgpyZXRyaWV2aW5nIHJldmlzaW9uIDEuNDQz
LjIuMzYKZGlmZiAtdSAtcjEuNDQzLjIuMzYgaW1hcGQuYwotLS0gaW1hcC9pbWFwZC5jCTUgQXVn
IDIwMDQgMTY6MjM6MzEgLTAwMDAJMS40NDMuMi4zNgorKysgaW1hcC9pbWFwZC5jCTYgQXVnIDIw
MDQgMTY6MzE6MzIgLTAwMDAKQEAgLTE0MSw2ICsxNDEsNyBAQAogLyogcGVyLXVzZXIvc2Vzc2lv
biBzdGF0ZSAqLwogc3RydWN0IHByb3RzdHJlYW0gKmltYXBkX291dCA9IE5VTEw7CiBzdHJ1Y3Qg
cHJvdHN0cmVhbSAqaW1hcGRfaW4gPSBOVUxMOworc3RydWN0IHByb3Rncm91cCAqcHJvdGluID0g
TlVMTDsKIHN0YXRpYyBjaGFyIGltYXBkX2NsaWVudGhvc3RbTklfTUFYSE9TVCoyKzFdID0gIlts
b2NhbF0iOwogc3RhdGljIGludCBpbWFwZF9sb2dmZCA9IC0xOwogY2hhciAqaW1hcGRfdXNlcmlk
ID0gTlVMTCwgKnByb3h5X3VzZXJpZCA9IE5VTEw7CkBAIC01MTgsNiArNTE5LDkgQEAKICAgICAK
ICAgICBpbWFwZF9pbiA9IGltYXBkX291dCA9IE5VTEw7CiAKKyAgICBpZiAocHJvdGluKSBwcm90
Z3JvdXBfZnJlZShwcm90aW4pOworICAgIHByb3RpbiA9IE5VTEw7CisKICNpZmRlZiBIQVZFX1NT
TAogICAgIGlmICh0bHNfY29ubikgewogCWlmICh0bHNfcmVzZXRfc2VydmVydGxzKCZ0bHNfY29u
bikgPT0gLTEpIHsKQEAgLTgzNyw2ICs4NDEsOCBAQAogCXNubXBfaW5jcmVtZW50KEFDVElWRV9D
T05ORUNUSU9OUywgLTEpOwogICAgIH0KIAorICAgIGlmIChwcm90aW4pIHByb3Rncm91cF9mcmVl
KHByb3Rpbik7CisKICNpZmRlZiBIQVZFX1NTTAogICAgIHRsc19zaHV0ZG93bl9zZXJ2ZXJlbmdp
bmUoKTsKICNlbmRpZgpAQCAtOTEzLDcgKzkxOSwxNCBAQAogCWNsb3NlKGZkKTsKICAgICB9CiAK
KyAgICBwcm90aW4gPSBwcm90Z3JvdXBfbmV3KDIpOworICAgIHByb3Rncm91cF9pbnNlcnQocHJv
dGluLCBpbWFwZF9pbik7CisKICAgICBmb3IgKDs7KSB7CisJc3RydWN0IHByb3Rncm91cCAqcHJv
dG91dCA9IE5VTEw7CisJc3RydWN0IHRpbWV2YWwgdGltZW91dDsKKwlpbnQgbiwgY2xpZW50aW47
CisKIAlpZiAoICFpbWFwZF91c2VyaXNhZG1pbiAmJiBpbWFwZF91c2VyaWQKIAkgICAgICYmIHNo
dXRkb3duX2ZpbGUoc2h1dCwgc2l6ZW9mKHNodXQpKSkgewogCSAgICBmb3IgKHAgPSBzaHV0OyAq
cCA9PSAnWyc7IHArKyk7IC8qIGNhbid0IGhhdmUgWyBiZSBmaXJzdCBjaGFyICovCkBAIC05MjMs
NiArOTM2LDYxIEBACiAKIAlzaWduYWxzX3BvbGwoKTsKIAorCS8qIGZsdXNoIGFueSBidWZmZXJl
ZCBvdXRwdXQgKi8KKwlpZiAoYmFja2VuZF9jdXJyZW50KSBwcm90X2ZsdXNoKGJhY2tlbmRfY3Vy
cmVudC0+b3V0KTsKKwlwcm90X2ZsdXNoKGltYXBkX291dCk7CisKKwl0aW1lb3V0LnR2X3NlYyA9
IDYwOworCXRpbWVvdXQudHZfdXNlYyA9IDA7CisJCisJbiA9IHByb3Rfc2VsZWN0KHByb3Rpbiwg
UFJPVF9OT19GRCwgJnByb3RvdXQsIE5VTEwsICZ0aW1lb3V0KTsKKwlpZiAobiA9PSAtMSkgewor
CSAgICBzeXNsb2coTE9HX0VSUiwgInByb3Rfc2VsZWN0KCkgZmFpbGVkIGluIGNtZGxvb3AoKTog
JW0iKTsKKwkgICAgZmF0YWwoInByb3Rfc2VsZWN0KCkgZmFpbGVkIGluIGNtZGxvb3AoKSIsIEVD
X1RFTVBGQUlMKTsKKwl9CisKKwljbGllbnRpbiA9IDA7CisJaWYgKG4gJiYgcHJvdG91dCkgewor
CSAgICBzdHJ1Y3QgcHJvdHN0cmVhbSAqcHRtcDsKKworCSAgICAvKiBzZWUgd2hvIGhhcyBpbnB1
dCAqLworCSAgICBmb3IgKDsgbjsgbi0tKSB7CisJCXB0bXAgPSBwcm90Z3JvdXBfZ2V0ZWxlbWVu
dChwcm90b3V0LCBuLTEpOworCisJCWlmIChwdG1wID09IGltYXBkX2luKSB7CisJCSAgICAvKiBp
bnB1dCBmcm9tIGNsaWVudCwgcHJvY2VzcyBpdCBsYXRlciAqLworCQkgICAgY2xpZW50aW4gPSAx
OworCQl9CisJCWVsc2UgaWYgKGJhY2tlbmRfY3VycmVudCAmJiBwdG1wID09IGJhY2tlbmRfY3Vy
cmVudC0+aW4peworCQkgICAgLyogaW5wdXQgZnJvbSBzZWxlY3RlZCBiYWNrZW5kLCBzdHJlYW0g
aXQgdG8gY2xpZW50ICovCisJCSAgICBkbyB7CisJCQljaGFyIGJ1Zls0MDk2XTsKKwkJCWludCBj
ID0gcHJvdF9yZWFkKHB0bXAsIGJ1Ziwgc2l6ZW9mKGJ1ZikpOworCQkJaWYgKGMgPT0gMCB8fCBj
IDwgMCkgYnJlYWs7CisJCQlwcm90X3dyaXRlKGltYXBkX291dCwgYnVmLCBjKTsKKwkJICAgIH0g
d2hpbGUgKHB0bXAtPmNudCA+IDApOworCisJCSAgICBpZiAocHJvdF9lcnJvcihwdG1wKSkgewor
CQkJLyogdWggb2gsIHdlJ3JlIG5vdCBoYXBweSAqLworCQkJZmF0YWwoIkxvc3QgY29ubmVjdGlv
biB0byBzZWxlY3RlZCBiYWNrZW5kIiwKKwkJCSAgICAgIEVDX1VOQVZBSUxBQkxFKTsKKwkJICAg
IH0KKwkJfQorCQllbHNlIHsKKwkJICAgIC8qIFhYWCBzaG91bGRuJ3QgZ2V0IGhlcmUgISEhICov
CisJCSAgICBmYXRhbCgidW5rbm93biBwcm90c3RyZWFtIHJldHVybmVkIGJ5IHByb3Rfc2VsZWN0
IGluIGNtZGxvb3AiLAorCQkJICBFQ19TT0ZUV0FSRSk7CisJCX0KKwkgICAgfQorCX0KKwlpZiAo
cHJvdG91dCkgcHJvdGdyb3VwX2ZyZWUocHJvdG91dCk7CisJcHJvdG91dCA9IE5VTEw7CisKKwlp
ZiAoIWNsaWVudGluKSB7CisJICAgIC8qIG5vIGlucHV0IGZyb20gY2xpZW50ICovCisJICAgIGNv
bnRpbnVlOworCX0KKwogCS8qIFBhcnNlIHRhZyAqLwogCWMgPSBnZXR3b3JkKGltYXBkX2luLCAm
dGFnKTsKIAlpZiAoYyA9PSBFT0YpIHsKQEAgLTEyNTcsNiArMTMyNSwxNiBAQAogCiAJCXNubXBf
aW5jcmVtZW50KExPR09VVF9DT1VOVCwgMSk7CQkKIAorCQkvKiBmb3JjZSBhbnkgcmVzcG9uc2Vz
IGZyb20gb3VyIHNlbGVjdGVkIGJhY2tlbmQgKi8KKwkJaWYgKGJhY2tlbmRfY3VycmVudCkgewor
CQkgICAgY2hhciBteXRhZ1sxMjhdOworCisJCSAgICBwcm94eV9nZW50YWcobXl0YWcsIHNpemVv
ZihteXRhZykpOworCisJCSAgICBwcm90X3ByaW50ZihiYWNrZW5kX2N1cnJlbnQtPm91dCwgIiVz
IE5vb3BcclxuIiwgbXl0YWcpOworCQkgICAgcGlwZV91bnRpbF90YWcoYmFja2VuZF9jdXJyZW50
LCBteXRhZywgMCk7CisJCX0KKwogCQlwcm90X3ByaW50ZihpbWFwZF9vdXQsICIqIEJZRSAlc1xy
XG4iLCAKIAkJCSAgICBlcnJvcl9tZXNzYWdlKElNQVBfQllFX0xPR09VVCkpOwogCQlwcm90X3By
aW50ZihpbWFwZF9vdXQsICIlcyBPSyAlc1xyXG4iLCB0YWcucywgCkBAIC0yMTEzLDcgKzIxOTEs
NiBAQAogICAgIGlmIChiYWNrZW5kX2N1cnJlbnQpIHsKIAkvKiByZW1vdGUgbWFpbGJveCAqLwog
CXByb3RfcHJpbnRmKGJhY2tlbmRfY3VycmVudC0+b3V0LCAiJXMgJXNcclxuIiwgdGFnLCBjbWQp
OwotCXBpcGVfaW5jbHVkaW5nX3RhZyhiYWNrZW5kX2N1cnJlbnQsIHRhZywgMCk7CiAKIAlyZXR1
cm47CiAgICAgfQpAQCAtMjI5Nyw4ICsyMzc0LDggQEAKIHsKICAgICBzdGF0aWMgaW50IGlkbGVf
cGVyaW9kID0gLTE7CiAgICAgc3RhdGljIHN0cnVjdCBidWYgYXJnOwotICAgIHN0cnVjdCBwcm90
Z3JvdXAgKnByb3RpbiA9IHByb3Rncm91cF9uZXcoMik7Ci0gICAgc3RydWN0IHByb3Rncm91cCAq
cHJvdG91dCA9IE5VTEw7CisgICAgc3RydWN0IHByb3Rncm91cCAqaWRsZWluID0gcHJvdGdyb3Vw
X25ldygyKTsKKyAgICBzdHJ1Y3QgcHJvdGdyb3VwICppZGxlb3V0ID0gTlVMTDsKICAgICBzdHJ1
Y3QgdGltZXZhbCB0aW1lb3V0OwogICAgIGludCBjID0gRU9GLCBuLCBkb25lID0gMCwgc2h1dGRv
d24gPSAwOwogICAgIGNoYXIgYnVmWzIwNDhdLCBzaHV0WzEwMjRdOwpAQCAtMjMwOSw5ICsyMzg2
LDkgQEAKICAgICAgIGlmIChpZGxlX3BlcmlvZCA8IDEpIGlkbGVfcGVyaW9kID0gMDsKICAgICB9
CiAKLSAgICAvKiBSZXNldCBwcm90aW4gdG8gYWxsIHplcm9zICh0byBwcmVzZXJ2ZSBtZW1vcnkg
YWxsb2NhdGlvbikgKi8KLSAgICBwcm90Z3JvdXBfcmVzZXQocHJvdGluKTsKLSAgICBwcm90Z3Jv
dXBfaW5zZXJ0KHByb3RpbiwgaW1hcGRfaW4pOworICAgIC8qIFJlc2V0IGlkbGVpbiB0byBhbGwg
emVyb3MgKHRvIHByZXNlcnZlIG1lbW9yeSBhbGxvY2F0aW9uKSAqLworICAgIHByb3Rncm91cF9y
ZXNldChpZGxlaW4pOworICAgIHByb3Rncm91cF9pbnNlcnQoaWRsZWluLCBpbWFwZF9pbik7CiAK
ICAgICBpZiAoYmFja2VuZF9jdXJyZW50ICYmIENBUEEoYmFja2VuZF9jdXJyZW50LCBDQVBBX0lE
TEUpKSB7CiAJLyogU3RhcnQgSURMRSBvbiBiYWNrZW5kICovCkBAIC0yMzMxLDcgKzI0MDgsNyBA
QAogCSAgICBnb3RvIGRvbmU7CiAJfQogCi0JcHJvdGdyb3VwX2luc2VydChwcm90aW4sIGJhY2tl
bmRfY3VycmVudC0+aW4pOworCXByb3Rncm91cF9pbnNlcnQoaWRsZWluLCBiYWNrZW5kX2N1cnJl
bnQtPmluKTsKICAgICB9CiAKICAgICAvKiBTdGFydCBsaXN0ZW5pbmcgdG8gaWRsZWQgKi8KQEAg
LTIzNTQsMjMgKzI0MzEsMjMgQEAKIAkgICAgcHJvdF9mbHVzaChpbWFwZF9vdXQpOwogCX0KIAot
CS8qIENsZWFyIHByb3RvdXQgaWYgbmVlZGVkICovCi0JcHJvdGdyb3VwX2ZyZWUocHJvdG91dCk7
Ci0JcHJvdG91dCA9IE5VTEw7CisJLyogQ2xlYXIgaWRsZW91dCBpZiBuZWVkZWQgKi8KKwlwcm90
Z3JvdXBfZnJlZShpZGxlb3V0KTsKKwlpZGxlb3V0ID0gTlVMTDsKIAogCXRpbWVvdXQudHZfc2Vj
ID0gaWRsZV9wZXJpb2Q7CiAJdGltZW91dC50dl91c2VjID0gMDsKIAotCW4gPSBwcm90X3NlbGVj
dChwcm90aW4sIFBST1RfTk9fRkQsICZwcm90b3V0LCBOVUxMLCAmdGltZW91dCk7CisJbiA9IHBy
b3Rfc2VsZWN0KGlkbGVpbiwgUFJPVF9OT19GRCwgJmlkbGVvdXQsIE5VTEwsICZ0aW1lb3V0KTsK
IAlpZiAobiA9PSAtMSAmJiBlcnJubyAhPSBFSU5UUikgewogCSAgICBzeXNsb2coTE9HX0VSUiwg
InByb3Rfc2VsZWN0KCkgZmFpbGVkIGluIGNtZF9pZGxlKCk6ICVtIik7CiAJICAgIGZhdGFsKCJw
cm90X3NlbGVjdCgpIGZhaWxlZCBpbiBjbWRfaWRsZSgpIiwgRUNfVEVNUEZBSUwpOwogCX0KLQlp
ZiAobiA+IDAgJiYgcHJvdG91dCkgeworCWlmIChuID4gMCAmJiBpZGxlb3V0KSB7CiAJICAgIHN0
cnVjdCBwcm90c3RyZWFtICpwdG1wOwogCiAJICAgIGZvciAoOyBuOyBuLS0pIHsKLQkJcHRtcCA9
IHByb3Rncm91cF9nZXRlbGVtZW50KHByb3RvdXQsIG4tMSk7CisJCXB0bXAgPSBwcm90Z3JvdXBf
Z2V0ZWxlbWVudChpZGxlb3V0LCBuLTEpOwogCQlpZiAocHRtcCA9PSBpbWFwZF9pbikgewogCQkg
ICAgLyogVGhlIGNsaWVudCBzZW50IHVzIHNvbWV0aGluZywgd2UncmUgZG9uZSAqLwogCQkgICAg
ZG9uZSA9IDE7CkBAIC0yNDAzLDggKzI0ODAsOCBAQAogICAgIGMgPSBnZXR3b3JkKGltYXBkX2lu
LCAmYXJnKTsKIAogICBkb25lOgotICAgIHByb3Rncm91cF9mcmVlKHByb3Rpbik7Ci0gICAgcHJv
dGdyb3VwX2ZyZWUocHJvdG91dCk7CisgICAgcHJvdGdyb3VwX2ZyZWUoaWRsZWluKTsKKyAgICBw
cm90Z3JvdXBfZnJlZShpZGxlb3V0KTsKIAogICAgIGlmIChkb25lKSB7CiAJLyogRG9uZSBsaXN0
ZW5pbmcgdG8gaWRsZWQgKi8KQEAgLTI1NTksMjMgKzI2MzYsMTcgQEAKIAkJCSAgICAgJmJhY2tl
bmRfY3VycmVudCwgJmJhY2tlbmRfaW5ib3gsIGltYXBkX2luKTsKIAlpZiAoIXMpIHIgPSBJTUFQ
X1NFUlZFUl9VTkFWQUlMQUJMRTsKIAorCWltYXBkX2NoZWNrKHMsIDAsIDApOworCiAJaWYgKCFy
KSB7CiAJICAgIHByb3RfcHJpbnRmKHMtPm91dCwgIiVzIEFwcGVuZCB7JWQrfVxyXG4lcyAiLCB0
YWcsIHN0cmxlbihuYW1lKSwgbmFtZSk7CiAJICAgIGlmICghcGlwZV9jb21tYW5kKHMsIDE2Mzg0
KSkgewotCQlwaXBlX3VudGlsX3RhZyhzLCB0YWcsIDApOworCQlpZiAoIWJhY2tlbmRfY3VycmVu
dCB8fCBzICE9IGJhY2tlbmRfY3VycmVudCkKKwkJICAgIHBpcGVfaW5jbHVkaW5nX3RhZyhzLCB0
YWcsIDApOwogCSAgICB9CiAJfSBlbHNlIHsKIAkgICAgZWF0bGluZShpbWFwZF9pbiwgcHJvdF9n
ZXRjKGltYXBkX2luKSk7Ci0JfQotCi0JaW1hcGRfY2hlY2socywgMCwgMCk7Ci0KLQlpZiAocikg
ewogCSAgICBwcm90X3ByaW50ZihpbWFwZF9vdXQsICIlcyBOTyAlc1xyXG4iLCB0YWcsIGVycm9y
X21lc3NhZ2UocikpOwotCX0gZWxzZSB7Ci0JICAgIC8qIHdlJ3JlIGFsbG93ZWQgdG8gcmVmZXJl
bmNlIGxhc3RfcmVzdWx0IHNpbmNlIHRoZSBub29wLCBpZgotCSAgICAgICBzZW50LCB3ZW50IHRv
IGEgZGlmZmVyZW50IHNlcnZlciAqLwotCSAgICBwcm90X3ByaW50ZihpbWFwZF9vdXQsICIlcyAl
cyIsIHRhZywgcy0+bGFzdF9yZXN1bHQpOwogCX0KIAogCXJldHVybjsKQEAgLTI4NTUsNiArMjky
Niw5IEBACiAJaWYgKGJhY2tlbmRfY3VycmVudCAmJiBiYWNrZW5kX2N1cnJlbnQgIT0gYmFja2Vu
ZF9uZXh0KSB7CiAJICAgIGNoYXIgbXl0YWdbMTI4XTsKIAorCSAgICAvKiByZW1vdmUgYmFja2Vu
ZF9jdXJyZW50IGZyb20gdGhlIHByb3Rncm91cCAqLworCSAgICBwcm90Z3JvdXBfZGVsZXRlKHBy
b3RpbiwgYmFja2VuZF9jdXJyZW50LT5pbik7CisKIAkgICAgLyogc3dpdGNoaW5nIHNlcnZlcnM7
IGZsdXNoIG9sZCBzZXJ2ZXIgb3V0cHV0ICovCiAJICAgIHByb3h5X2dlbnRhZyhteXRhZywgc2l6
ZW9mKG15dGFnKSk7CiAJICAgIHByb3RfcHJpbnRmKGJhY2tlbmRfY3VycmVudC0+b3V0LCAiJXMg
VW5zZWxlY3RcclxuIiwgbXl0YWcpOwpAQCAtMjg3Niw2ICsyOTUwLDkgQEAKIAkgICAgcHJvY19y
ZWdpc3RlcigiaW1hcGQiLCBpbWFwZF9jbGllbnRob3N0LCBpbWFwZF91c2VyaWQsIG1haWxib3hu
YW1lKTsKIAkgICAgc3lzbG9nKExPR19ERUJVRywgIm9wZW46IHVzZXIgJXMgb3BlbmVkICVzIG9u
ICVzIiwKIAkJICAgaW1hcGRfdXNlcmlkLCBuYW1lLCBuZXdzZXJ2ZXIpOworCisJICAgIC8qIGFk
ZCBiYWNrZW5kX2N1cnJlbnQgdG8gdGhlIHByb3Rncm91cCAqLworCSAgICBwcm90Z3JvdXBfaW5z
ZXJ0KHByb3RpbiwgYmFja2VuZF9jdXJyZW50LT5pbik7CiAJICAgIGJyZWFrOwogCWRlZmF1bHQ6
CiAJICAgIHN5c2xvZyhMT0dfREVCVUcsICJvcGVuOiB1c2VyICVzIGZhaWxlZCB0byBvcGVuICVz
IiwgaW1hcGRfdXNlcmlkLApAQCAtMjg5Miw2ICsyOTY5LDkgQEAKICAgICBpZiAoYmFja2VuZF9j
dXJyZW50KSB7CiAgICAgICBjaGFyIG15dGFnWzEyOF07CiAKKyAgICAgIC8qIHJlbW92ZSBiYWNr
ZW5kX2N1cnJlbnQgZnJvbSB0aGUgcHJvdGdyb3VwICovCisgICAgICBwcm90Z3JvdXBfZGVsZXRl
KHByb3RpbiwgYmFja2VuZF9jdXJyZW50LT5pbik7CisKICAgICAgIC8qIHN3aXRjaGluZyBzZXJ2
ZXJzOyBmbHVzaCBvbGQgc2VydmVyIG91dHB1dCAqLwogICAgICAgcHJveHlfZ2VudGFnKG15dGFn
LCBzaXplb2YobXl0YWcpKTsKICAgICAgIHByb3RfcHJpbnRmKGJhY2tlbmRfY3VycmVudC0+b3V0
LCAiJXMgVW5zZWxlY3RcclxuIiwgbXl0YWcpOwpAQCAtMjk4Miw2ICszMDYyLDkgQEAKIAkgKiBz
YXlpbmcgTk8gaXMgY2xlYXJseSB3cm9uZywgaGVuc2UgdGhlIGZhdGFsIHJlcXVlc3QuICovCiAJ
cGlwZV9pbmNsdWRpbmdfdGFnKGJhY2tlbmRfY3VycmVudCwgdGFnLCAwKTsKIAliYWNrZW5kX2N1
cnJlbnQgPSBOVUxMOworCisJLyogcmVtb3ZlIGJhY2tlbmRfY3VycmVudCBmcm9tIHRoZSBwcm90
Z3JvdXAgKi8KKwlwcm90Z3JvdXBfZGVsZXRlKHByb3RpbiwgYmFja2VuZF9jdXJyZW50LT5pbik7
CiAJcmV0dXJuOwogICAgIH0KIApAQCAtMzAxNyw2ICszMTAwLDkgQEAKIAkgKiBzYXlpbmcgTk8g
aXMgY2xlYXJseSB3cm9uZywgaGVuc2UgdGhlIGZhdGFsIHJlcXVlc3QuICovCiAJcGlwZV9pbmNs
dWRpbmdfdGFnKGJhY2tlbmRfY3VycmVudCwgdGFnLCAwKTsKIAliYWNrZW5kX2N1cnJlbnQgPSBO
VUxMOworCisJLyogcmVtb3ZlIGJhY2tlbmRfY3VycmVudCBmcm9tIHRoZSBwcm90Z3JvdXAgKi8K
Kwlwcm90Z3JvdXBfZGVsZXRlKHByb3RpbiwgYmFja2VuZF9jdXJyZW50LT5pbik7CiAJcmV0dXJu
OwogICAgIH0KIApAQCAtMzA4Nyw5ICszMTczLDcgQEAKICAgICBpZiAoYmFja2VuZF9jdXJyZW50
KSB7CiAJLyogcmVtb3RlIG1haWxib3ggKi8KIAlwcm90X3ByaW50ZihiYWNrZW5kX2N1cnJlbnQt
Pm91dCwgIiVzICVzICVzICIsIHRhZywgY21kLCBzZXF1ZW5jZSk7Ci0JaWYgKCFwaXBlX2NvbW1h
bmQoYmFja2VuZF9jdXJyZW50LCA2NTUzNikpIHsKLQkgICAgcGlwZV9pbmNsdWRpbmdfdGFnKGJh
Y2tlbmRfY3VycmVudCwgdGFnLCAwKTsKLQl9CisJcGlwZV9jb21tYW5kKGJhY2tlbmRfY3VycmVu
dCwgNjU1MzYpOwogCXJldHVybjsKICAgICB9CiAKQEAgLTM0NzcsNyArMzU2MSw2IEBACiAJLyog
cmVtb3RlIG1haWxib3ggKi8KIAlwcm90X3ByaW50ZihiYWNrZW5kX2N1cnJlbnQtPm91dCwgIiVz
IFBhcnRpYWwgJXMgJXMgJXMgJXNcclxuIiwKIAkJICAgIHRhZywgbXNnbm8sIGRhdGEsIHN0YXJ0
LCBjb3VudCk7Ci0JcGlwZV9pbmNsdWRpbmdfdGFnKGJhY2tlbmRfY3VycmVudCwgdGFnLCAwKTsK
IAlyZXR1cm47CiAgICAgfQogCkBAIC0zNjA1LDkgKzM2ODgsNyBAQAogCS8qIHJlbW90ZSBtYWls
Ym94ICovCiAJcHJvdF9wcmludGYoYmFja2VuZF9jdXJyZW50LT5vdXQsICIlcyAlcyAlcyAlcyAi
LAogCQkgICAgdGFnLCBjbWQsIHNlcXVlbmNlLCBvcGVyYXRpb24pOwotCWlmICghcGlwZV9jb21t
YW5kKGJhY2tlbmRfY3VycmVudCwgNjU1MzYpKSB7Ci0JICAgIHBpcGVfaW5jbHVkaW5nX3RhZyhi
YWNrZW5kX2N1cnJlbnQsIHRhZywgMCk7Ci0JfQorCXBpcGVfY29tbWFuZChiYWNrZW5kX2N1cnJl
bnQsIDY1NTM2KTsKIAlyZXR1cm47CiAgICAgfQogCkBAIC0zNzQ2LDkgKzM4MjcsNyBAQAogCWNv
bnN0IGNoYXIgKmNtZCA9IHVzaW5ndWlkID8gIlVJRCBTZWFyY2giIDogIlNlYXJjaCI7CiAKIAlw
cm90X3ByaW50ZihiYWNrZW5kX2N1cnJlbnQtPm91dCwgIiVzICVzICIsIHRhZywgY21kKTsKLQlp
ZiAoIXBpcGVfY29tbWFuZChiYWNrZW5kX2N1cnJlbnQsIDY1NTM2KSkgewotCSAgICBwaXBlX2lu
Y2x1ZGluZ190YWcoYmFja2VuZF9jdXJyZW50LCB0YWcsIDApOwotCX0KKwlwaXBlX2NvbW1hbmQo
YmFja2VuZF9jdXJyZW50LCA2NTUzNik7CiAJcmV0dXJuOwogICAgIH0KIApAQCAtMzgwNiw5ICsz
ODg1LDcgQEAKIAljaGFyICpjbWQgPSB1c2luZ3VpZCA/ICJVSUQgU29ydCIgOiAiU29ydCI7CiAK
IAlwcm90X3ByaW50ZihiYWNrZW5kX2N1cnJlbnQtPm91dCwgIiVzICVzICIsIHRhZywgY21kKTsK
LQlpZiAoIXBpcGVfY29tbWFuZChiYWNrZW5kX2N1cnJlbnQsIDY1NTM2KSkgewotCSAgICBwaXBl
X2luY2x1ZGluZ190YWcoYmFja2VuZF9jdXJyZW50LCB0YWcsIDApOwotCX0KKwlwaXBlX2NvbW1h
bmQoYmFja2VuZF9jdXJyZW50LCA2NTUzNik7CiAJcmV0dXJuOwogICAgIH0KIApAQCAtMzkwMCw5
ICszOTc3LDcgQEAKIAljb25zdCBjaGFyICpjbWQgPSB1c2luZ3VpZCA/ICJVSUQgVGhyZWFkIiA6
ICJUaHJlYWQiOwogCiAJcHJvdF9wcmludGYoYmFja2VuZF9jdXJyZW50LT5vdXQsICIlcyAlcyAi
LCB0YWcsIGNtZCk7Ci0JaWYgKCFwaXBlX2NvbW1hbmQoYmFja2VuZF9jdXJyZW50LCA2NTUzNikp
IHsKLQkgICAgcGlwZV9pbmNsdWRpbmdfdGFnKGJhY2tlbmRfY3VycmVudCwgdGFnLCAwKTsKLQl9
CisJcGlwZV9jb21tYW5kKGJhY2tlbmRfY3VycmVudCwgNjU1MzYpOwogCXJldHVybjsKICAgICB9
CiAKQEAgLTQwMTcsNyArNDA5Miw2IEBACiAJcHJvdF9wcmludGYoYmFja2VuZF9jdXJyZW50LT5v
dXQsICIlcyAlcyAlcyB7JWQrfVxyXG4lc1xyXG4iLAogCQkgICAgdGFnLCB1c2luZ3VpZCA/ICJV
SUQgQ29weSIgOiAiQ29weSIsCiAJCSAgICBzZXF1ZW5jZSwgc3RybGVuKG5hbWUpLCBuYW1lKTsK
LQlwaXBlX2luY2x1ZGluZ190YWcoYmFja2VuZF9jdXJyZW50LCB0YWcsIDApOwogCiAJcmV0dXJu
OwogICAgIH0KQEAgLTQxMzQsNyArNDIwOCw2IEBACiAJfSBlbHNlIHsKIAkgICAgcHJvdF9wcmlu
dGYoYmFja2VuZF9jdXJyZW50LT5vdXQsICIlcyBFeHB1bmdlXHJcbiIsIHRhZyk7CiAJfQotCXBp
cGVfaW5jbHVkaW5nX3RhZyhiYWNrZW5kX2N1cnJlbnQsIHRhZywgMCk7CiAJcmV0dXJuOwogICAg
IH0KIApAQCAtNTE1OCw3ICs1MjMxLDggQEAKIAkJCSAgICB0YWcsIGNtZCwgCiAJCQkgICAgc3Ry
bGVuKG5hbWUpLCBuYW1lKTsKIAkgICAgfQotCSAgICBwaXBlX3VudGlsX3RhZyhiYWNrZW5kX2lu
Ym94LCB0YWcsIDApOworCSAgICBpZiAoIWJhY2tlbmRfY3VycmVudCB8fCBiYWNrZW5kX2luYm94
ICE9IGJhY2tlbmRfY3VycmVudCkKKwkJcGlwZV91bnRpbF90YWcoYmFja2VuZF9pbmJveCwgdGFn
LCAwKTsKIAl9CiAKIAlpbWFwZF9jaGVjayhiYWNrZW5kX2luYm94LCAwLCAwKTsKSW5kZXg6IGxp
Yi9wcm90LmMKPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PQpSQ1MgZmlsZTogL2Fmcy9hbmRyZXcvc3lzdGVtL2N2cy9zcmMv
Y3lydXMvbGliL3Byb3QuYyx2CnJldHJpZXZpbmcgcmV2aXNpb24gMS44Mi4yLjQKZGlmZiAtdSAt
cjEuODIuMi40IHByb3QuYwotLS0gbGliL3Byb3QuYwkxIE1hciAyMDA0IDE0OjMwOjIxIC0wMDAw
CTEuODIuMi40CisrKyBsaWIvcHJvdC5jCTYgQXVnIDIwMDQgMTY6MzE6MzIgLTAwMDAKQEAgLTEw
MDQsNiArMTAwNCw3IEBACiAJdGltZV90IHRoaXNfdGltZW91dCA9IDA7ICAgLyogdGhpcyBzdHJl
YW0gKi8KIAkKIAlzID0gcmVhZHN0cmVhbXMtPmdyb3VwW2ldOworCWlmICghcykgY29udGludWU7
CiAKIAlhc3NlcnQoIXMtPndyaXRlKTsKIApAQCAtMTEwNSw2ICsxMTA2LDcgQEAKIAkKIAlmb3Io
aSA9IDA7IGk8cmVhZHN0cmVhbXMtPm5leHRfZWxlbWVudDsgaSsrKSB7CiAJICAgIHMgPSByZWFk
c3RyZWFtcy0+Z3JvdXBbaV07CisJICAgIGlmICghcykgY29udGludWU7CiAKIAkgICAgaWYoRkRf
SVNTRVQocy0+ZmQsICZyZmRzKSkgewogCQlmb3VuZF9mZHMrKzsKQEAgLTExOTgsMTYgKzEyMDAs
NDEgQEAKIAogdm9pZCBwcm90Z3JvdXBfaW5zZXJ0KHN0cnVjdCBwcm90Z3JvdXAgKmdyb3VwLCBz
dHJ1Y3QgcHJvdHN0cmVhbSAqaXRlbSkgCiB7CisgICAgaW50IGksIGVtcHR5OworCiAgICAgYXNz
ZXJ0KGdyb3VwKTsKICAgICBhc3NlcnQoaXRlbSk7Ci0gICAgLyogRG91YmxlIHNpemUgb2YgdGhl
IHByb3Rncm91cCBpZiB3ZSdyZSBhdCBvdXIgbGltaXQgKi8KLSAgICBpZihncm91cC0+bmV4dF9l
bGVtZW50ID09IGdyb3VwLT5uYWxsb2NlZCkgeworCisgICAgLyogU2VlIGlmIHdlIGFscmVhZHkg
aGF2ZSB0aGlzIHByb3RzdHJlYW0gKi8KKyAgICBmb3IgKGkgPSAwLCBlbXB0eSA9IGdyb3VwLT5u
ZXh0X2VsZW1lbnQ7IGkgPCBncm91cC0+bmV4dF9lbGVtZW50OyBpKyspIHsKKwlpZiAoIWdyb3Vw
LT5ncm91cFtpXSkgZW1wdHkgPSBpOworCWVsc2UgaWYgKGdyb3VwLT5ncm91cFtpXSA9PSBpdGVt
KSByZXR1cm47CisgICAgfQorICAgIC8qIERvdWJsZSBzaXplIG9mIHRoZSBwcm90Z3JvdXAgaWYg
d2UncmUgYXQgb3VyIGxpbWl0ICovIAorICAgIGlmIChlbXB0eSA9PSBncm91cC0+bmV4dF9lbGVt
ZW50ICYmCisJZ3JvdXAtPm5leHRfZWxlbWVudCsrID09IGdyb3VwLT5uYWxsb2NlZCkgewogCWdy
b3VwLT5uYWxsb2NlZCAqPSAyOwogCWdyb3VwLT5ncm91cCA9IHhyZWFsbG9jKGdyb3VwLT5ncm91
cCwKIAkJCQlncm91cC0+bmFsbG9jZWQgKiBzaXplb2Yoc3RydWN0IHByb3RzdHJlYW0gKikpOwog
ICAgIH0KLSAgICAvKiBJbnNlcnQgdGhlIGl0ZW0gb24gdGhlIGVuZCBvZiB0aGUgZ3JvdXAgKi8K
LSAgICBncm91cC0+Z3JvdXBbZ3JvdXAtPm5leHRfZWxlbWVudCsrXSA9IGl0ZW07CisgICAgLyog
SW5zZXJ0IHRoZSBpdGVtIGF0IHRoZSBlbXB0eSBsb2NhdGlvbiAqLworICAgIGdyb3VwLT5ncm91
cFtlbXB0eV0gPSBpdGVtOworfQorCit2b2lkIHByb3Rncm91cF9kZWxldGUoc3RydWN0IHByb3Rn
cm91cCAqZ3JvdXAsIHN0cnVjdCBwcm90c3RyZWFtICppdGVtKSAKK3sKKyAgICBpbnQgaTsKKwor
ICAgIGFzc2VydChncm91cCk7CisgICAgYXNzZXJ0KGl0ZW0pOworCisgICAgLyogZmluZCB0aGUg
cHJvdHN0cmVhbSAqLworICAgIGZvciAoaSA9IDA7IGkgPCBncm91cC0+bmV4dF9lbGVtZW50OyBp
KyspIHsKKwlpZiAoZ3JvdXAtPmdyb3VwW2ldID09IGl0ZW0pIHsKKwkgICAgZ3JvdXAtPmdyb3Vw
W2ldID0gTlVMTDsKKwkgICAgcmV0dXJuOworCX0KKyAgICB9CiB9CiAKIHN0cnVjdCBwcm90c3Ry
ZWFtICpwcm90Z3JvdXBfZ2V0ZWxlbWVudChzdHJ1Y3QgcHJvdGdyb3VwICpncm91cCwKSW5kZXg6
IGxpYi9wcm90LmgKPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PQpSQ1MgZmlsZTogL2Fmcy9hbmRyZXcvc3lzdGVtL2N2cy9z
cmMvY3lydXMvbGliL3Byb3QuaCx2CnJldHJpZXZpbmcgcmV2aXNpb24gMS40MC4yLjIKZGlmZiAt
dSAtcjEuNDAuMi4yIHByb3QuaAotLS0gbGliL3Byb3QuaAkyNCBKdW4gMjAwNCAxNToxNjozMCAt
MDAwMAkxLjQwLjIuMgorKysgbGliL3Byb3QuaAk2IEF1ZyAyMDA0IDE2OjMxOjMyIC0wMDAwCkBA
IC0yMzYsNiArMjM2LDkgQEAKIC8qIEluc2VydCBhbiBlbGVtZW50IGludG8gYSBwcm90Z3JvdXAg
Ki8KIHZvaWQgcHJvdGdyb3VwX2luc2VydChzdHJ1Y3QgcHJvdGdyb3VwICpncm91cCwgc3RydWN0
IHByb3RzdHJlYW0gKml0ZW0pOwogCisvKiBEZWxldGUgYW4gZWxlbWVudCBmcm9tIGEgcHJvdGdy
b3VwICovCit2b2lkIHByb3Rncm91cF9kZWxldGUoc3RydWN0IHByb3Rncm91cCAqZ3JvdXAsIHN0
cnVjdCBwcm90c3RyZWFtICppdGVtKTsKKwogLyogUmV0dXJucyB0aGUgcHJvdHN0cmVhbSBhdCB0
aGF0IHBvc2l0aW9uIGluIHRoZSBwcm90Z3JvdXAsIG9yIE5VTEwgaWYKICAqIGFuIGludmFsaWQg
ZWxlbWVudCBpcyByZXF1ZXN0ZWQgKi8KIHN0cnVjdCBwcm90c3RyZWFtICpwcm90Z3JvdXBfZ2V0
ZWxlbWVudChzdHJ1Y3QgcHJvdGdyb3VwICpncm91cCwK
</data>        

          </attachment>
      

    </bug>

</bugzilla>