<?xml version="1.0" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugzilla.cyrusimap.org/bugzilla.dtd">

<bugzilla version="3.2.5.1-2"
          urlbase="https://bugzilla.cyrusimap.org/"
          maintainer="Dave McMurtrie &lt;dave64@andrew.cmu.edu&gt;"
>

    <bug>
          <bug_id>2375</bug_id>
          
          <creation_ts>2004-02-17 14:42 EDT</creation_ts>
          <short_desc>ptloader ldap patch/enhacement</short_desc>
          <delta_ts>2010-10-18 12:43:04 EDT</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Cyrus IMAP</product>
          <component>IMAP</component>
          <version>2.2.x</version>
          <rep_platform>Sun</rep_platform>
          <op_sys>Solaris</op_sys>
          <bug_status>CLOSED</bug_status>
          <resolution>FIXED</resolution>
          
          
          
          
          <priority>P2</priority>
          <bug_severity>enhancement</bug_severity>
          <target_milestone>Future</target_milestone>
          
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Igor Brezac">igor@ipass.net</reporter>
          <assigned_to name="Rob Siemborski">rjs3@andrew.cmu.edu</assigned_to>
          
          <qa_contact name="The Cyrus Bugzilla List">cyrus-bugzilla@lists.andrew.cmu.edu</qa_contact>

      

      

      
          <long_desc isprivate="0">
            <who name="Igor Brezac">igor@ipass.net</who>
            <bug_when>2004-02-17 14:42:59 EDT</bug_when>
            <thetext>Rob, it looks like you&apos;ve been busy lately, so I am adding patches here for
easier tracking.  The code here fixes memory leak, I added &apos;group:&apos; syntax and
additional ldap params to support group queries.  I am not sure if this is the
route you&apos;d like to take, I can easily go back to the current behavior.  The
configuration params are getting rather extensive now.  ;(</thetext>
          </long_desc>
          <long_desc isprivate="0">
            <who name="Igor Brezac">igor@ipass.net</who>
            <bug_when>2004-02-17 14:44:48 EDT</bug_when>
            <thetext>Created an attachment (id=261)
libcyr_cfg*, imapoptions, auth_pts
</thetext>
          </long_desc>
          <long_desc isprivate="0">
            <who name="Igor Brezac">igor@ipass.net</who>
            <bug_when>2004-02-17 14:45:05 EDT</bug_when>
            <thetext>Created an attachment (id=262)
ldap.c
</thetext>
          </long_desc>
          <long_desc isprivate="0">
            <who name="Rob Siemborski">rjs3@andrew.cmu.edu</who>
            <bug_when>2004-02-24 16:59:12 EDT</bug_when>
            <thetext>this patch appears to be missing the necessary imapoptions-&gt;libcyrus config hook
in imap/global.c, or is that intentional?</thetext>
          </long_desc>
          <long_desc isprivate="0">
            <who name="Igor Brezac">igor@ipass.net</who>
            <bug_when>2004-02-24 17:12:15 EDT</bug_when>
            <thetext>Oops. I missed including the following:

Index: imap/global.c
===================================================================
RCS file: /cvs/src/cyrus/imap/global.c,v
retrieving revision 1.8
diff -u -r1.8 global.c
--- imap/global.c       26 Jan 2004 17:46:56 -0000      1.8
+++ imap/global.c       24 Feb 2004 22:11:29 -0000
@@ -201,6 +201,8 @@
                                  config_getswitch(IMAPOPT_FULLDIRHASH));
        libcyrus_config_setstring(CYRUSOPT_PTSCACHE_DB,
                                  config_getstring(IMAPOPT_PTSCACHE_DB));
+    libcyrus_config_setstring(CYRUSOPT_PTLOADER_SOCK,
+                             config_getstring(IMAPOPT_PTLOADER_SOCK));
        libcyrus_config_setswitch(CYRUSOPT_VIRTDOMAINS,
                                  config_getenum(IMAPOPT_VIRTDOMAINS));
 
</thetext>
          </long_desc>
          <long_desc isprivate="0">
            <who name="Rob Siemborski">rjs3@andrew.cmu.edu</who>
            <bug_when>2004-02-24 18:11:46 EDT</bug_when>
            <thetext>committed</thetext>
          </long_desc>
      
          <attachment
              isobsolete="0"
              ispatch="1"
              isprivate="0"
          >
            <attachid>261</attachid>
            <date>2004-02-17 14:44 EDT</date>
            <desc>libcyr_cfg*, imapoptions, auth_pts</desc>
            <filename>ptldap.patch</filename>
            <type>text/plain</type>
            <size>9325</size>
            <attacher>igor@ipass.net</attacher>
            
              <data encoding="base64">SW5kZXg6IGxpYi9hdXRoX3B0cy5jCj09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KUkNTIGZpbGU6IC9jdnMvc3JjL2N5cnVz
L2xpYi9hdXRoX3B0cy5jLHYKcmV0cmlldmluZyByZXZpc2lvbiAxLjYKZGlmZiAtdSAtcjEuNiBh
dXRoX3B0cy5jCi0tLSBsaWIvYXV0aF9wdHMuYwkxNSBEZWMgMjAwMyAyMjo0MjozOCAtMDAwMAkx
LjYKKysrIGxpYi9hdXRoX3B0cy5jCTE3IEZlYiAyMDA0IDE5OjA1OjU1IC0wMDAwCkBAIC0xMTAs
OCArMTEwLDEwIEBACiAgICAgCiAgICAgLyogaXMgaXQgYSBncm91cCBpJ20gYSBtZW1iZXIgb2Yg
PyAqLwogICAgIGZvciAoaT0wOyBpIDwgYXV0aF9zdGF0ZS0+bmdyb3VwczsgaSsrKQotICAgICAg
ICBpZiAoaWRoYXNoID09IGF1dGhfc3RhdGUtPmdyb3Vwc1tpXS5oYXNoICYmCi0JICAgICFzdHJj
bXAoaWRlbnRpZmllciwgYXV0aF9zdGF0ZS0+Z3JvdXBzW2ldLmlkKSkKKyAgICAgICAgaWYgKCBp
ZGhhc2ggPT0gYXV0aF9zdGF0ZS0+Z3JvdXBzW2ldLmhhc2ggJiYKKwkgICAgICAgICgoICFzdHJu
Y21wKGlkZW50aWZpZXIsICJncm91cDoiLCA2KSAmJiAKKyAgICAgICAgICAgICAgICAhc3RyY21w
KGlkZW50aWZpZXIrNiwgYXV0aF9zdGF0ZS0+Z3JvdXBzW2ldLmlkKSApIHx8CisgICAgICAgICAg
ICAgIXN0cmNtcChpZGVudGlmaWVyLCBhdXRoX3N0YXRlLT5ncm91cHNbaV0uaWQpKSApCiAgICAg
ICAgICAgICByZXR1cm4gMjsKICAgCiAgICAgcmV0dXJuIDA7CkBAIC0yNzUsOCArMjc3LDEyIEBA
CiAgICAgICAgIGdvdG8gZG9uZTsKICAgICB9CiAgICAgICAgIAotICAgIHN0cmNweShmbmFtZWJ1
ZiwgY29uZmlnX2Rpcik7Ci0gICAgc3RyY2F0KGZuYW1lYnVmLCBQVFNfREJTT0NLRVQpOworICAg
IGlmIChsaWJjeXJ1c19jb25maWdfZ2V0c3RyaW5nKENZUlVTT1BUX1BUTE9BREVSX1NPQ0spKQor
ICAgICAgICBzdHJjcHkoZm5hbWVidWYsIGxpYmN5cnVzX2NvbmZpZ19nZXRzdHJpbmcoQ1lSVVNP
UFRfUFRMT0FERVJfU09DSykpOworICAgIGVsc2UgeworICAgICAgICBzdHJjcHkoZm5hbWVidWYs
IGNvbmZpZ19kaXIpOworICAgICAgICBzdHJjYXQoZm5hbWVidWYsIFBUU19EQlNPQ0tFVCk7Cisg
ICAgfQogCiAgICAgbWVtc2V0KChjaGFyICopJnNydmFkZHIsIDAsIHNpemVvZihzcnZhZGRyKSk7
CiAgICAgc3J2YWRkci5zdW5fZmFtaWx5ID0gQUZfVU5JWDsKSW5kZXg6IGxpYi9pbWFwb3B0aW9u
cwo9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09ClJDUyBmaWxlOiAvY3ZzL3NyYy9jeXJ1cy9saWIvaW1hcG9wdGlvbnMsdgpy
ZXRyaWV2aW5nIHJldmlzaW9uIDEuMTMKZGlmZiAtdSAtcjEuMTMgaW1hcG9wdGlvbnMKLS0tIGxp
Yi9pbWFwb3B0aW9ucwkyMCBKYW4gMjAwNCAwMToxMTowMyAtMDAwMAkxLjEzCisrKyBsaWIvaW1h
cG9wdGlvbnMJMTcgRmViIDIwMDQgMTk6MDk6MDAgLTAwMDAKQEAgLTIyOSw0MSArMjI5LDE1MiBA
QAogeyAiaW1wbGljaXRfb3duZXJfcmlnaHRzIiwgImxjYSIsIFNUUklORyB9CiAvKiBUaGUgaW1w
bGljaXQgQWNjZXNzIENvbnRyb2wgTGlzdCAoQUNMKSBmb3IgdGhlIG93bmVyIG9mIGEgbWFpbGJv
eC4gKi8KIAoteyAibGRhcF9iYXNlIiwgTlVMTCwgU1RSSU5HIH0KK3sgImxkYXBfYXV0aHoiLCBO
VUxMLCBTVFJJTkcgfQorLyogU0FTTCBhdXRob3JpemF0aW9uIElEIGZvciB0aGUgTERBUCBzZXJ2
ZXIgKi8KKworeyAibGRhcF9iYXNlIiwgIiIsIFNUUklORyB9CiAvKiBDb250YWlucyB0aGUgTERB
UCBiYXNlIGRuIGZvciB0aGUgTERBUCBwdGxvYWRlciBtb2R1bGUgKi8KIAoteyAibGRhcF9maWx0
ZXIiLCBOVUxMLCBTVFJJTkcgfQotLyogQ29udGFpbnMgdGhlIGxkYXAgZmlsdGVyIHRvIHVzZSB3
aGVuIGxvb2tpbmcgdXAgdGhlIHVzZXIgaWQuICBUaGUgb2NjdXJhbmNlCi0gICBvZiBhbnkgJXUg
aW4gdGhlIHN0cmluZyB3aWxsIGJlIHJlcGxhY2VkIHdpdGggdGhlIGNhbm9uaWNhbGl6ZWQgdXNl
ciBpZCAqLworeyAibGRhcF9iaW5kX2RuIiwgTlVMTCwgU1RSSU5HIH0KKy8qIEJpbmQgRE4gZm9y
IHRoZSBjb25uZWN0aW9uIHRvIHRoZSBMREFQIHNlcnZlciAoc2ltcGxlIGJpbmQpLgorICAgRG8g
bm90IHVzZSBmb3IgYW5vbnltb3VzIHNpbXBsZSBiaW5kcyAqLwogCi17ICJsZGFwX3NlcnZlcnMi
LCBOVUxMLCBTVFJJTkcgfQotLyogQ29udGFpbnMgYSBsaXN0IG9mIHRoZSBVUkxzIG9mIGFsbCB0
aGUgTERBUCBzZXJ2ZXJzIHdoZW4gdXNpbmcgdGhlCi0gICBMREFQIFBUUyBtb2R1bGUuICovCit7
ICJsZGFwX2RlcmVmIiwgIm5ldmVyIiwgU1RSSU5HTElTVCgic2VhcmNoIiwgImZpbmQiLCAiYWx3
YXlzIiwgIm5ldmVyIikgfQorLyogU3BlY2lmeSBob3cgYWxpYXNlcyBkZXJlZmVyZW5jaW5nIGlz
IGhhbmRsZWQgZHVyaW5nIHNlYXJjaC4gKi8KKworeyAibGRhcF9maWx0ZXIiLCAiKHVpZD0ldSki
LCBTVFJJTkcgfQorLyogU3BlY2lmeSBhIGZpbHRlciB0aGF0IHNlYXJjaGVzIHVzZXIgaWRlbnRp
ZmllcnMuICBUaGUgZm9sbG93aW5nIHRva2VucyBjYW4gYmUKKyAgIHVzZWQgaW4gdGhlIGZpbHRl
ciBzdHJpbmc6CisKKyAgICUlICAgPSAlCisgICAldSAgID0gdXNlcgorICAgJVUgICA9IHVzZXIg
cG9ydGlvbiBvZiAldSAoJVUgPSB0ZXN0IHdoZW4gJXUgPSB0ZXN0QGRvbWFpbi50bGQpCisgICAl
ZCAgID0gZG9tYWluIHBvcnRpb24gb2YgJXUgaWYgYXZhaWxhYmxlICglZCA9IGRvbWFpbi50bGQg
d2hlbiAldSA9CisgICAgICAgICAgJXRlc3RAZG9tYWluLnRsZCksIG90aGVyd2lzZSBzYW1lIGFz
ICVyCisgICAlRCAgID0gdXNlciBkbi4gICh1c2Ugd2hlbiBsZGFwX21lbWJlcl9tZXRob2Q6IGZp
bHRlcikKKyAgICUxLTkgPSBkb21haW4gdG9rZW5zICglMSA9IHRsZCwgJTIgPSBkb21haW4gd2hl
biAlZCA9IGRvbWFpbi50bGQpCisKKyAgIGxkYXBfZmlsdGVyIGlzIG5vdCB1c2VkIHdoZW4gbGRh
cF9zYXNsIGlzIGVuYWJsZWQuICovCisKK3sgImxkYXBfZ3JvdXBfYmFzZSIsICIiLCBTVFJJTkcg
fQorLyogTERBUCBiYXNlIGRuIGZvciBsZGFwX2dyb3VwX2ZpbHRlci4gKi8KKworeyAibGRhcF9n
cm91cF9maWx0ZXIiLCAiKGNuPSV1KSIsIFNUUklORyB9CisvKiBTcGVjaWZ5IGEgZmlsdGVyIHRo
YXQgc2VhcmNoZXMgZm9yIGdyb3VwIGlkZW50aWZpZXJzLgorICAgU2VlIGxkYXBfZmlsdGVyIGZv
ciBtb3JlIG9wdGlvbnMuICovIAorCit7ICJsZGFwX2dyb3VwX3Njb3BlIiwgInN1YiIsIFNUUklO
R0xJU1QoInN1YiIsICJvbmUiLCAiYmFzZSIpIH0KKy8qIFNwZWNpZnkgc2VhcmNoIHNjb3BlIGZv
ciBsZGFwX2dyb3VwX2ZpbHRlci4gKi8KKworeyAibGRhcF9pZCIsIE5VTEwsIFNUUklORyB9Cisv
KiBTQVNMIGF1dGhlbnRpY2F0aW9uIElEIGZvciB0aGUgTERBUCBzZXJ2ZXIgKi8KKworeyAibGRh
cF9tZWNoIiwgTlVMTCwgU1RSSU5HIH0KKy8qIFNBU0wgbWVjaGFuaXNtIGZvciBMREFQIGF1dGhl
bnRpY2F0aW9uICovCisKK3sgImxkYXBfbWVtYmVyX2F0dHJpYnV0ZSIsIE5VTEwsIFNUUklORyB9
CisvKiBTZWUgbGRhcF9tZW1iZXJfbWV0aG9kLiAqLworCit7ICJsZGFwX21lbWJlcl9iYXNlIiwg
IiIsIFNUUklORyB9CisvKiBMREFQIGJhc2UgZG4gZm9yIGxkYXBfbWVtYmVyX2ZpbHRlci4gKi8K
KworeyAibGRhcF9tZW1iZXJfZmlsdGVyIiwgIihtZW1iZXI9JUQpIiwgU1RSSU5HIH0KKy8qIFNw
ZWNpZnkgYSBmaWx0ZXIgZm9yICJsZGFwX21lbWJlcl9tZXRob2Q6IGZpbHRlciIuICAKKyAgIFNl
ZSBsZGFwX2ZpbHRlciBmb3IgbW9yZSBvcHRpb25zLiAqLyAKKworeyAibGRhcF9tZW1iZXJfbWV0
aG9kIiwgImF0dHJpYnV0ZSIsIFNUUklOR0xJU1QoImF0dHJpYnV0ZSIsICJmaWx0ZXIiKSB9Cisv
KiBTcGVjaWZ5IGEgZ3JvdXAgbWV0aG9kLiAgVGhlICJhdHRyaWJ1dGUiIG1ldGhvZCByZXRyaWV2
ZXMgZ3JvdXBzIGZyb20gCisgICBhIG11bHRpLXZhbHVlZCBhdHRyaWJ1dGVkIHNwZWNpZmllZCBp
biBsZGFwX21lbWJlcl9hdHRyaWJ1dGUuICAKKyAgIFRoZSAiZmlsdGVyIiBtZXRob2QgdXNlcyBh
IGZpbHRlciwgbGRhcF9tZW1iZXJfZmlsdGVyLCB0byBmaW5kIGdyb3VwczsgCisgICBsZGFwX21l
bWJlcl9hdHRyaWJ1dGUgaXMgYSBzaW5nbGUtdmFsdWUgYXR0cmlidXRlIGdyb3VwIG5hbWUuICov
CisKK3sgImxkYXBfbWVtYmVyX3Njb3BlIiwgInN1YiIsIFNUUklOR0xJU1QoInN1YiIsICJvbmUi
LCAiYmFzZSIpIH0KKy8qIFNwZWNpZnkgc2VhcmNoIHNjb3BlIGZvciBsZGFwX21lbWJlcl9maWx0
ZXIuICovCisKK3sgImxkYXBfcGFzc3dvcmQiLCBOVUxMLCBTVFJJTkcgfQorLyogUGFzc3dvcmQg
Zm9yIHRoZSBjb25uZWN0aW9uIHRvIHRoZSBMREFQIHNlcnZlciAoU0FTTCBhbmQgc2ltcGxlIGJp
bmQpLiAgCisgICBEbyBub3QgdXNlIGZvciBhbm9ueW1vdXMgc2ltcGxlIGJpbmRzICovCisKK3sg
ImxkYXBfcmVhbG0iLCBOVUxMLCBTVFJJTkcgfQorLyogU0FTTCByZWFsbSBmb3IgTERBUCBhdXRo
ZW50aWNhdGlvbiAqLworCit7ICJsZGFwX3JlZmVycmFscyIsIDAsIFNXSVRDSCB9CisvKiBTcGVj
aWZ5IHdoZXRoZXIgb3Igbm90IHRoZSBjbGllbnQgc2hvdWxkIGZvbGxvdyByZWZlcnJhbHMuICov
CisKK3sgImxkYXBfcmVzdGFydCIsIDEsIFNXSVRDSCB9CisvKiBTcGVjaWZ5IHdoZXRoZXIgb3Ig
bm90IExEQVAgSS9PIG9wZXJhdGlvbnMgYXJlIGF1dG9tYXRpY2FsbHkgcmVzdGFydGVkCisgICBp
ZiB0aGV5IGFib3J0IHByZW1hdHVyZWx5LiAqLwogCiB7ICJsZGFwX3Nhc2wiLCAxLCBTV0lUQ0gg
fQogLyogVXNlIFNBU0wgZm9yIExEQVAgYmluZHMgaW4gdGhlIExEQVAgUFRTIG1vZHVsZS4gKi8K
IAogeyAibGRhcF9zYXNsX2F1dGhjIiwgTlVMTCwgU1RSSU5HIH0KLS8qIEZvcmNlIHRoZSB1c2Ug
b2YgYSBwYXJ0aWN1bGFyIFNBU0wgYXV0aGVudGljYXRpb24gSUQgZm9yIHRoZSBMREFQIHNlcnZl
ciAqLworLyogRGVwcmljYXRlZC4gIFVzZSBsZGFwX2lkICovCiAKIHsgImxkYXBfc2FzbF9hdXRo
eiIsIE5VTEwsIFNUUklORyB9Ci0vKiBGb3JjZSB0aGUgdXNlIG9mIGEgcGFydGljdWxhciBTQVNM
IGF1dGhvcml6YXRpb24gSUQgZm9yIHRoZSBMREFQIHNlcnZlciAqLworLyogRGVwcmljYXRlZC4g
IFVzZSBsZGFwX2F1dGh6ICovCiAKIHsgImxkYXBfc2FzbF9tZWNoIiwgTlVMTCwgU1RSSU5HIH0K
LS8qIEZvcmNlIHRoZSB1c2Ugb2YgYSBwYXJ0aWN1bGFyIFNBU0wgbWVjaGFuaXNtIGZvciBMREFQ
IGF1dGhlbnRpY2F0aW9uICovCisvKiBEZXByaWNhdGVkLiAgVXNlIGxkYXBfbWVjaCAqLwogCiB7
ICJsZGFwX3Nhc2xfcGFzc3dvcmQiLCBOVUxMLCBTVFJJTkcgfQotLyogUGFzc3dvcmQgZm9yIHRo
ZSBMREFQIFNBU0wgbWVjaGFuaXNtIChpZiBuZWVkZWQpICovCisvKiBEZXByaWNhdGVkLiAgVXNl
ciBsZGFwX3Bhc3N3b3JkICovCiAKIHsgImxkYXBfc2FzbF9yZWFsbSIsIE5VTEwsIFNUUklORyB9
Ci0vKiBGb3JjZSB0aGUgdXNlIG9mIGEgcGFydGljdWxhciBTQVNMIHJlYWxtIGZvciBMREFQIGF1
dGhlbnRpY2F0aW9uICovCisvKiBEZXByaWNhdGVkLiAgVXNlIGxkYXBfcmVhbG0gKi8KKworeyAi
bGRhcF9zY29wZSIsICJzdWIiLCBTVFJJTkdMSVNUKCJzdWIiLCAib25lIiwgImJhc2UiKSB9Cisv
KiBTcGVjaWZ5IHNlYXJjaCBzY29wZS4gKi8KKworeyAibGRhcF9zZXJ2ZXJzIiwgImxkYXA6Ly9s
b2NhbGhvc3QvIiwgU1RSSU5HIH0KKy8qIERlcHJpY2F0ZWQuICBVc2UgbGRhcF91cmkgKi8KKwor
eyAibGRhcF9zaXplX2xpbWl0IiwgMSwgSU5UIH0KKy8qIFNwZWNpZnkgYSBudW1iZXIgb2YgZW50
cmllcyBmb3IgYSBzZWFyY2ggcmVxdWVzdCB0byByZXR1cm4uICovCisKK3sgImxkYXBfc3RhcnRf
dGxzIiwgMCwgU1dJVENIIH0KKy8qIFVzZSBTdGFydFRMUyBleHRlbmRlZCBvcGVyYXRpb24uICBE
byBub3QgdXNlIGxkYXBzOiBsZGFwX3VyaSB3aGVuCisgICB0aGlzIG9wdGlvbiBpcyBlbmFibGVk
LiAqLworCit7ICJsZGFwX3RpbWVfbGltaXQiLCA1LCBJTlQgfQorLyogU3BlY2lmeSBhIG51bWJl
ciBvZiBzZWNvbmRzIGZvciBhIHNlYXJjaCByZXF1ZXN0IHRvIGNvbXBsZXRlLiAqLworCit7ICJs
ZGFwX3RpbWVvdXQiLCA1LCBJTlQgfQorLyogU3BlY2lmeSBhIG51bWJlciBvZiBzZWNvbmRzIGEg
c2VhcmNoIGNhbiB0YWtlIGJlZm9yZSB0aW1pbmcgb3V0LiAqLworCit7ICJsZGFwX3Rsc19jYWNl
cnRfZGlyIiwgTlVMTCwgU1RSSU5HIH0KKy8qIFBhdGggdG8gZGlyZWN0b3J5IHdpdGggQ0EgKENl
cnRpZmljYXRlIEF1dGhvcml0eSkgY2VydGlmaWNhdGVzLiAqLworCit7ICJsZGFwX3Rsc19jYWNl
cnRfZmlsZSIsIE5VTEwsIFNUUklORyB9CisvKiBGaWxlIGNvbnRhaW5pbmcgQ0EgKENlcnRpZmlj
YXRlIEF1dGhvcml0eSkgY2VydGlmaWNhdGUocykuICovCiAKLXsgImxkYXBfbWVtYmVyX2F0dHJp
YnV0ZSIsICJtZW1iZXJPZiIsIFNUUklORyB9Ci0vKiBUaGUgbXVsdGktdmFsdWVkIGF0dHJpYnV0
ZSBuYW1lIGZvciBhbiBlbnRpdHkgdGhhdCBsaXN0cyBpdHMgZ3JvdXBzLiAqLworeyAibGRhcF90
bHNfY2VydCIsIE5VTEwsIFNUUklORyB9CisvKiBGaWxlIGNvbnRhaW5pbmcgdGhlIGNsaWVudCBj
ZXJ0aWZpY2F0ZS4gKi8KKworeyAibGRhcF90bHNfY2hlY2tfcGVlciIsIDAsIFNXSVRDSCB9Cisv
KiBSZXF1aXJlIGFuZCB2ZXJpZnkgc2VydmVyIGNlcnRpZmljYXRlLiAgSWYgdGhpcyBvcHRpb24g
aXMgeWVzLAorICAgeW91IG11c3Qgc3BlY2lmeSBsZGFwX3Rsc19jYWNlcnRfZmlsZSBvciBsZGFw
X3Rsc19jYWNlcnRfZGlyLiAqLworCit7ICJsZGFwX3Rsc19jaXBoZXJzIiwgTlVMTCwgU1RSSU5H
IH0KKy8qIExpc3Qgb2YgU1NML1RMUyBjaXBoZXJzIHRvIGFsbG93LiAgVGhlIGZvcm1hdCBvZiB0
aGUgc3RyaW5nIGlzCisgICBkZXNjcmliZWQgaW4gY2lwaGVycygxKS4gKi8KKworeyAibGRhcF90
bHNfa2V5IiwgTlVMTCwgU1RSSU5HIH0KKy8qIEZpbGUgY29udGFpbmluZyB0aGUgcHJpdmF0ZSBj
bGllbnQga2V5LiAqLworCit7ICJsZGFwX3VyaSIsIE5VTEwsIFNUUklORyB9CisvKiBDb250YWlu
cyBhIGxpc3Qgb2YgdGhlIFVSTHMgb2YgYWxsIHRoZSBMREFQIHNlcnZlcnMgd2hlbiB1c2luZyB0
aGUKKyAgIExEQVAgUFRTIG1vZHVsZS4gKi8KKworeyAibGRhcF92ZXJzaW9uIiwgMywgSU5UIH0K
Ky8qIFNwZWNpZnkgdGhlIExEQVAgcHJvdG9jb2wgdmVyc2lvbi4gIElmIGxkYXBfc3RhcnRfdGxz
IGFuZC9vcgorICAgbGRhcF91c2Vfc2FzbCBhcmUgZW5hYmxlZCwgbGRhcF92ZXJzaW9uIHdpbGwg
YmUgYXV0b21hdGlhY2FsbHkKKyAgIHNldCB0byAzLiAqLwogCiB7ICJsbXRwX2Rvd25jYXNlX3Jj
cHQiLCAwLCBTV0lUQ0ggfQogLyogSWYgZW5hYmxlZCwgbG10cGQgd2lsbCBjb252ZXJ0IHRoZSBy
ZWNpcGllbnQgYWRkcmVzcyB0byBsb3dlcmNhc2UKICAgICh1cCB0byBhICcrJyBjaGFyYWN0ZXIs
IGlmIHByZXNlbnQpLiAqLworCiB7ICJsbXRwX292ZXJfcXVvdGFfcGVybV9mYWlsdXJlIiwgMCwg
U1dJVENIIH0KIC8qIElmIGVuYWJsZWQsIGxtdHBkIHJldHVybnMgYSBwZXJtYW5lbnQgZmFpbHVy
ZSBjb2RlIHdoZW4gYSB1c2VyJ3MKICAgIG1haWxib3ggaXMgb3ZlciBxdW90YS4gIEJ5IGRlZmF1
bHQsIHRoZSBmYWlsdXJlIGlzIHRlbXBvcmFyeSwKQEAgLTQ2OSw2ICs1ODAsOSBAQAogLyogQSBs
aXN0IG9mIHVzZXJzIGFuZCBncm91cHMgdGhhdCBhcmUgYWxsb3dlZCB0byBwcm94eSBmb3Igb3Ro
ZXIKICAgIHVzZXJzLCBzZXBlcmF0ZWQgYnkgc3BhY2VzLiAgQW55IHVzZXIgbGlzdGVkIGluIHRo
aXMgd2lsbCBiZQogICAgYWxsb3dlZCB0byBsb2dpbiBmb3IgYW55IG90aGVyIHVzZXI6IHVzZSB3
aXRoIGNhdXRpb24uICovIAorCit7ICJwdGxvYWRlcl9zb2NrIiwgIi9wdGNsaWVudC9wdHNvY2si
LCBTVFJJTkcgfQorLyogVW5peCBkb21haW4gc29ja2V0IHRoYXQgcHRsb2FkZXIgbGlzdGVucyBv
bi4gKi8KIAogeyAicHRzY2FjaGVfZGIiLCAiYmVya2VsZXkiLCBTVFJJTkdMSVNUKCJiZXJrZWxl
eSIsICJza2lwbGlzdCIpfQogLyogVGhlIGN5cnVzZGIgYmFja2VuZCB0byB1c2UgZm9yIHRoZSBw
dHMgY2FjaGUuICovCkluZGV4OiBsaWIvbGliY3lyX2NmZy5jCj09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KUkNTIGZpbGU6
IC9jdnMvc3JjL2N5cnVzL2xpYi9saWJjeXJfY2ZnLmMsdgpyZXRyaWV2aW5nIHJldmlzaW9uIDEu
NApkaWZmIC11IC1yMS40IGxpYmN5cl9jZmcuYwotLS0gbGliL2xpYmN5cl9jZmcuYwkyMCBKYW4g
MjAwNCAwMToxMTowMyAtMDAwMAkxLjQKKysrIGxpYi9saWJjeXJfY2ZnLmMJMTcgRmViIDIwMDQg
MTk6MTE6MzcgLTAwMDAKQEAgLTkxLDYgKzkxLDEwIEBACiAgICAgICAodW5pb24gY3lydXNfY29u
ZmlnX3ZhbHVlKSgoY29uc3QgY2hhciAqKSJiZXJrZWxleSIpLAogICAgICAgQ1lSVVNfT1BUX1NU
UklORyB9LAogCisgICAgeyBDWVJVU09QVF9QVExPQURFUl9TT0NLLAorICAgICAgKHVuaW9uIGN5
cnVzX2NvbmZpZ192YWx1ZSkoKGNvbnN0IGNoYXIgKikiL3B0Y2xpZW50L3B0c29jayIpLAorICAg
ICAgQ1lSVVNfT1BUX1NUUklORyB9LAorCiAgICAgeyBDWVJVU09QVF9WSVJURE9NQUlOUywKICAg
ICAgICh1bmlvbiBjeXJ1c19jb25maWdfdmFsdWUpKChpbnQpMCksCiAgICAgICBDWVJVU19PUFRf
U1dJVENIIH0sCkluZGV4OiBsaWIvbGliY3lyX2NmZy5oCj09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KUkNTIGZpbGU6IC9j
dnMvc3JjL2N5cnVzL2xpYi9saWJjeXJfY2ZnLmgsdgpyZXRyaWV2aW5nIHJldmlzaW9uIDEuNApk
aWZmIC11IC1yMS40IGxpYmN5cl9jZmcuaAotLS0gbGliL2xpYmN5cl9jZmcuaAkyMCBKYW4gMjAw
NCAwMToxMTowNCAtMDAwMAkxLjQKKysrIGxpYi9saWJjeXJfY2ZnLmgJMTcgRmViIDIwMDQgMTk6
MTE6NDIgLTAwMDAKQEAgLTg3LDYgKzg3LDggQEAKICAgICBDWVJVU09QVF9GVUxMRElSSEFTSCwK
ICAgICAvKiBEYXRhYmFzZSBmb3IgdXNlIGJ5IEFVVEhfUFRTICovCiAgICAgQ1lSVVNPUFRfUFRT
Q0FDSEVfREIsCisgICAgLyogcHRsb2FkZXIgc29ja2V0IGZvciB1c2UgYnkgQVVUSF9QVFMgKi8K
KyAgICBDWVJVU09QVF9QVExPQURFUl9TT0NLLAogICAgIC8qIFZpcnR1YWwgRG9tYWlucyAoT0ZG
KSAqLwogICAgIENZUlVTT1BUX1ZJUlRET01BSU5TLAogCg==
</data>        

          </attachment>
          <attachment
              isobsolete="0"
              ispatch="0"
              isprivate="0"
          >
            <attachid>262</attachid>
            <date>2004-02-17 14:45 EDT</date>
            <desc>ldap.c</desc>
            <filename>ldap.c</filename>
            <type>text/plain</type>
            <size>33087</size>
            <attacher>igor@ipass.net</attacher>
            
              <data encoding="base64">LyogbGRhcC5jIC0gTERBUCBCYWNrZW5kIHRvIHB0bG9hZGVyICovCi8qCiAqIENvcHlyaWdodCAo
YykgMTk5OC0yMDAzIENhcm5lZ2llIE1lbGxvbiBVbml2ZXJzaXR5LiAgQWxsIHJpZ2h0cyByZXNl
cnZlZC4KICoKICogUmVkaXN0cmlidXRpb24gYW5kIHVzZSBpbiBzb3VyY2UgYW5kIGJpbmFyeSBm
b3Jtcywgd2l0aCBvciB3aXRob3V0CiAqIG1vZGlmaWNhdGlvbiwgYXJlIHBlcm1pdHRlZCBwcm92
aWRlZCB0aGF0IHRoZSBmb2xsb3dpbmcgY29uZGl0aW9ucwogKiBhcmUgbWV0OgogKgogKiAxLiBS
ZWRpc3RyaWJ1dGlvbnMgb2Ygc291cmNlIGNvZGUgbXVzdCByZXRhaW4gdGhlIGFib3ZlIGNvcHly
aWdodAogKiAgICBub3RpY2UsIHRoaXMgbGlzdCBvZiBjb25kaXRpb25zIGFuZCB0aGUgZm9sbG93
aW5nIGRpc2NsYWltZXIuIAogKgogKiAyLiBSZWRpc3RyaWJ1dGlvbnMgaW4gYmluYXJ5IGZvcm0g
bXVzdCByZXByb2R1Y2UgdGhlIGFib3ZlIGNvcHlyaWdodAogKiAgICBub3RpY2UsIHRoaXMgbGlz
dCBvZiBjb25kaXRpb25zIGFuZCB0aGUgZm9sbG93aW5nIGRpc2NsYWltZXIgaW4KICogICAgdGhl
IGRvY3VtZW50YXRpb24gYW5kL29yIG90aGVyIG1hdGVyaWFscyBwcm92aWRlZCB3aXRoIHRoZQog
KiAgICBkaXN0cmlidXRpb24uCiAqCiAqIDMuIFRoZSBuYW1lICJDYXJuZWdpZSBNZWxsb24gVW5p
dmVyc2l0eSIgbXVzdCBub3QgYmUgdXNlZCB0bwogKiAgICBlbmRvcnNlIG9yIHByb21vdGUgcHJv
ZHVjdHMgZGVyaXZlZCBmcm9tIHRoaXMgc29mdHdhcmUgd2l0aG91dAogKiAgICBwcmlvciB3cml0
dGVuIHBlcm1pc3Npb24uIEZvciBwZXJtaXNzaW9uIG9yIGFueSBvdGhlciBsZWdhbAogKiAgICBk
ZXRhaWxzLCBwbGVhc2UgY29udGFjdCAgCiAqICAgICAgT2ZmaWNlIG9mIFRlY2hub2xvZ3kgVHJh
bnNmZXIKICogICAgICBDYXJuZWdpZSBNZWxsb24gVW5pdmVyc2l0eQogKiAgICAgIDUwMDAgRm9y
YmVzIEF2ZW51ZQogKiAgICAgIFBpdHRzYnVyZ2gsIFBBICAxNTIxMy0zODkwCiAqICAgICAgKDQx
MikgMjY4LTQzODcsIGZheDogKDQxMikgMjY4LTczOTUKICogICAgICB0ZWNoLXRyYW5zZmVyQGFu
ZHJldy5jbXUuZWR1CiAqCiAqIDQuIFJlZGlzdHJpYnV0aW9ucyBvZiBhbnkgZm9ybSB3aGF0c29l
dmVyIG11c3QgcmV0YWluIHRoZSBmb2xsb3dpbmcKICogICAgYWNrbm93bGVkZ21lbnQ6CiAqICAg
ICJUaGlzIHByb2R1Y3QgaW5jbHVkZXMgc29mdHdhcmUgZGV2ZWxvcGVkIGJ5IENvbXB1dGluZyBT
ZXJ2aWNlcwogKiAgICAgYXQgQ2FybmVnaWUgTWVsbG9uIFVuaXZlcnNpdHkgKGh0dHA6Ly93d3cu
Y211LmVkdS9jb21wdXRpbmcvKS4iCiAqCiAqIENBUk5FR0lFIE1FTExPTiBVTklWRVJTSVRZIERJ
U0NMQUlNUyBBTEwgV0FSUkFOVElFUyBXSVRIIFJFR0FSRCBUTwogKiBUSElTIFNPRlRXQVJFLCBJ
TkNMVURJTkcgQUxMIElNUExJRUQgV0FSUkFOVElFUyBPRiBNRVJDSEFOVEFCSUxJVFkKICogQU5E
IEZJVE5FU1MsIElOIE5PIEVWRU5UIFNIQUxMIENBUk5FR0lFIE1FTExPTiBVTklWRVJTSVRZIEJF
IExJQUJMRQogKiBGT1IgQU5ZIFNQRUNJQUwsIElORElSRUNUIE9SIENPTlNFUVVFTlRJQUwgREFN
QUdFUyBPUiBBTlkgREFNQUdFUwogKiBXSEFUU09FVkVSIFJFU1VMVElORyBGUk9NIExPU1MgT0Yg
VVNFLCBEQVRBIE9SIFBST0ZJVFMsIFdIRVRIRVIgSU4KICogQU4gQUNUSU9OIE9GIENPTlRSQUNU
LCBORUdMSUdFTkNFIE9SIE9USEVSIFRPUlRJT1VTIEFDVElPTiwgQVJJU0lORwogKiBPVVQgT0Yg
T1IgSU4gQ09OTkVDVElPTiBXSVRIIFRIRSBVU0UgT1IgUEVSRk9STUFOQ0UgT0YgVEhJUyBTT0ZU
V0FSRS4KICoKICovCgpzdGF0aWMgY2hhciByY3NpZFtdIF9fYXR0cmlidXRlX18oKHVudXNlZCkp
ID0gCiAgICAgICIkSWQ6IGxkYXAuYyx2IDEuMyAyMDA0LzAxLzIzIDE2OjM1OjI4IHJqczMgRXhw
ICQiOwoKI2luY2x1ZGUgPGNvbmZpZy5oPgoKI2luY2x1ZGUgPHN0cmluZy5oPgojaW5jbHVkZSA8
c3RkaW8uaD4KI2luY2x1ZGUgPHN0ZGxpYi5oPgojaW5jbHVkZSA8c3lzL3R5cGVzLmg+CiNpbmNs
dWRlIDxzeXMvc3RhdC5oPgojaW5jbHVkZSA8c3lzL3R5cGVzLmg+CiNpbmNsdWRlIDxzeXMvcGFy
YW0uaD4KI2luY2x1ZGUgPGZjbnRsLmg+CiNpbmNsdWRlIDxzeXMvc29ja2V0Lmg+CiNpbmNsdWRl
IDxzeXMvdW4uaD4KI2luY2x1ZGUgPHN5cy91aW8uaD4KI2luY2x1ZGUgPGNvbV9lcnIuaD4KCiNp
bmNsdWRlIDxsZGFwLmg+CiNpbmNsdWRlIDxsYmVyLmg+CgovKiBsaWJpbWFwICovCiNpbmNsdWRl
ICJnbG9iYWwuaCIKCi8qIGxpYmNvbmZpZyAqLwojaW5jbHVkZSAibGliY29uZmlnLmgiCgovKiBs
aWJjeXJ1cyAqLwojaW5jbHVkZSAiYXV0aF9wdHMuaCIKI2luY2x1ZGUgImV4aXRjb2Rlcy5oIgoj
aW5jbHVkZSAic3RyaGFzaC5oIgojaW5jbHVkZSAieG1hbGxvYy5oIgoKLyogeHh4IHRoaXMganVz
dCB1c2VzIHRoZSBVTklYIGNhbm9uaWNhbGl6YXRpb24gc2VtYW50aWNzLCB3aGljaCBpcwogKiBt
b3N0IGxpa2VseSB3cm9uZyAqLwoKLyogTWFwIG9mIHdoaWNoIGNoYXJhY3RlcnMgYXJlIGFsbG93
ZWQgYnkgYXV0aF9jYW5vbmlmeWlkLgogKiBLZXk6IDAgLT4gbm90IGFsbG93ZWQgKHNwZWNpYWws
IGN0cmwsIG9yIHdvdWxkIGNvbmZ1c2UgVW5peCBvciBpbWFwZCkKICogICAgICAxIC0+IGFsbG93
ZWQsIGJ1dCByZXF1aXJlcyBhbiBhbHBoYSBzb21ld2hlcmUgZWxzZSBpbiB0aGUgc3RyaW5nCiAq
ICAgICAgMiAtPiBhbGxvd2VkLCBhbmQgaXMgYW4gYWxwaGEKICoKICogQXQgbGVhc3Qgb25lIGNo
YXJhY3RlciBtdXN0IGJlIGFuIGFscGhhLgogKgogKiBUaGlzIG1heSBub3QgYmUgcmVzdHJpY3Rp
dmUgZW5vdWdoLgogKiBIZXJlIGFyZSB0aGUgcmVhc29ucyBmb3IgdGhlIHJlc3RyaWN0aW9uczoK
ICoKICogJglmb3JiaWRkZW4gYmVjYXVzZSBvZiBNVVRGLTcuICAoVGhpcyBjb3VsZCBiZSBmaXhl
ZC4pCiAqIDogICAgZm9yYmlkZGVuIGJlY2F1c2UgaXQncyBzcGVjaWFsIGluIC9ldGMvcGFzc3dk
CiAqIC8gICAgZm9yYmlkZGVuIGJlY2F1c2UgaXQgY2FuJ3QgYmUgdXNlZCBpbiBhIG1haWxib3gg
bmFtZQogKiAqICUgIGZvcmJpZGRlbiBiZWNhdXNlIHRoZXkncmUgSU1BUCBtYWdpYyBpbiB0aGUg
TElTVC9MU1VCIGNvbW1hbmRzCiAqID8gICAgaXQganVzdCBzY2FyZXMgbWUKICogY3RybCBjaGFy
cywgREVMCiAqICAgICAgY2FuJ3Qgc2VuZCB0aGVtIGFzIElNQVAgY2hhcmFjdGVycyBpbiBwbGFp
biBmb2xkZXIgbmFtZXMsIEkgdGhpbmsKICogODAtRkYgZm9yYmlkZGVuIGJlY2F1c2UgeW91IGNh
bid0IHNlbmQgdGhlbSBpbiBJTUFQIGFueXdheQogKiAgICAgICAoYW5kIHRoZXkncmUgZm9yYmlk
ZGVuIGFzIGZvbGRlciBuYW1lcykuIChUaGlzIGNvdWxkIGJlIGZpeGVkLikKICoKICogKyBhbmQg
LSBhcmUgKmFsbG93ZWQqIGFsdGhvdWdoICcrJyBpcyBwcm9iYWJseSB1c2VkIGZvciB1c2VyaWQr
ZGV0YWlsCiAqIHN1YmFkZHJlc3NpbmcgYW5kIHFtYWlsIHVzZXJzIHVzZSAnLScgZm9yIHN1YmFk
ZHJlc3NpbmcuCiAqCiAqIElkZW50aWZpZXJzIGRvbid0IHJlcXVpcmUgYSBkaWdpdCwgcmVhbGx5
LCBzbyB0aGF0IHNob3VsZCBwcm9iYWJseSBiZQogKiByZWxheGVkLCB0b28uCiAqLwpzdGF0aWMg
Y2hhciBhbGxvd2VkY2hhcnNbMjU2XSA9IHsKIC8qIDAgIDEgIDIgIDMgIDQgIDUgIDYgIDcgIDgg
IDkgIEEgIEIgIEMgIEQgIEUgIEYgKi8KICAgIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAs
IDAsIDAsIDAsIDAsIDAsIDAsIC8qIDAwLTBGICovCiAgICAwLCAwLCAwLCAwLCAwLCAwLCAwLCAw
LCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAvKiAxMC0xRiAqLwogICAgMSwgMSwgMSwgMSwgMSwg
MCwgMCwgMSwgMSwgMSwgMCwgMSwgMSwgMSwgMSwgMCwgLyogMjAtMkYgKi8KICAgIDEsIDEsIDEs
IDEsIDEsIDEsIDEsIDEsIDEsIDEsIDAsIDEsIDEsIDEsIDEsIDAsIC8qIDMwLTNGICovCgogICAg
MSwgMiwgMiwgMiwgMiwgMiwgMiwgMiwgMiwgMiwgMiwgMiwgMiwgMiwgMiwgMiwgLyogNDAtNEYg
Ki8KICAgIDIsIDIsIDIsIDIsIDIsIDIsIDIsIDIsIDIsIDIsIDIsIDEsIDEsIDEsIDEsIDEsIC8q
IDUwLTVGICovCiAgICAxLCAyLCAyLCAyLCAyLCAyLCAyLCAyLCAyLCAyLCAyLCAyLCAyLCAyLCAy
LCAyLCAvKiA2MC02RiAqLwogICAgMiwgMiwgMiwgMiwgMiwgMiwgMiwgMiwgMiwgMiwgMiwgMSwg
MSwgMSwgMSwgMCwgLyogNzAtN0YgKi8KCiAgICAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAw
LCAwLCAwLCAwLCAwLCAwLCAwLAogICAgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwg
MCwgMCwgMCwgMCwgMCwKICAgIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAs
IDAsIDAsIDAsCiAgICAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAw
LCAwLAoKICAgIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAs
CiAgICAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLAogICAg
MCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwKICAgIDAsIDAs
IDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAKfTsKCnR5cGVkZWYgc3Ry
dWN0IF9wdHNtIHsKICAgIGNoYXIgICAqdXJpOwogICAgaW50ICAgIHZlcnNpb247CiAgICBzdHJ1
Y3QgdGltZXZhbCB0aW1lb3V0OwogICAgaW50ICAgIHNpemVfbGltaXQ7CiAgICBpbnQgICAgdGlt
ZV9saW1pdDsKICAgIGludCAgICBkZXJlZjsKICAgIGludCAgICByZWZlcnJhbHM7CiAgICBpbnQg
ICAgcmVzdGFydDsKICAgIGludCAgICBzY29wZTsKICAgIGNoYXIgICAqYmFzZTsKICAgIGludCAg
ICBzYXNsOwogICAgY2hhciAgICppZDsKICAgIGNoYXIgICAqYmluZF9kbjsKICAgIGNoYXIgICAq
cGFzc3dvcmQ7CiAgICBjaGFyICAgKmF1dGh6OwogICAgY2hhciAgICptZWNoOwogICAgY2hhciAg
ICpyZWFsbTsKICAgIGNoYXIgICAqZmlsdGVyOwogICAgY2hhciAgICpzYXNsX3NlY3Byb3BzOwog
ICAgaW50ICAgIHN0YXJ0X3RsczsKICAgIGludCAgICB0bHNfY2hlY2tfcGVlcjsKICAgIGNoYXIg
ICAqdGxzX2NhY2VydF9maWxlOwogICAgY2hhciAgICp0bHNfY2FjZXJ0X2RpcjsKICAgIGNoYXIg
ICAqdGxzX2NpcGhlcnM7CiAgICBjaGFyICAgKnRsc19jZXJ0OwogICAgY2hhciAgICp0bHNfa2V5
OwogICAgaW50ICAgIG1lbWJlcl9tZXRob2Q7CiAgICBjaGFyICAgKm1lbWJlcl9hdHRyaWJ1dGU7
CiAgICBjaGFyICAgKm1lbWJlcl9maWx0ZXI7CiAgICBjaGFyICAgKm1lbWJlcl9iYXNlOwogICAg
aW50ICAgIG1lbWJlcl9zY29wZTsKICAgIGNoYXIgICAqZ3JvdXBfZmlsdGVyOwogICAgY2hhciAg
ICpncm91cF9iYXNlOwogICAgaW50ICAgIGdyb3VwX3Njb3BlOwogICAgTERBUCAgICpsZDsKfSB0
X3B0c207CgojZGVmaW5lIFBUU01fT0sgMAojZGVmaW5lIFBUU01fRkFJTCAtMQojZGVmaW5lIFBU
U01fTk9NRU0gLTIKI2RlZmluZSBQVFNNX1JFVFJZIC0zCgojZGVmaW5lIFBUU01fTUVNQkVSX01F
VEhPRF9BVFRSSUJVVEUgMAojZGVmaW5lIFBUU01fTUVNQkVSX01FVEhPRF9GSUxURVIgMQoKI2Rl
ZmluZSBJU1NFVCh4KSAgKCh4ICE9IE5VTEwpICYmICgqKHgpICE9ICdcMCcpKQojZGVmaW5lIEVN
UFRZKHgpICAoKHggPT0gTlVMTCkgfHwgKCooeCkgPT0gJ1wwJykpCgpzdGF0aWMgdF9wdHNtICpw
dHNtID0gTlVMTDsKCnN0YXRpYyBpbnQgcHRzbW9kdWxlX2ludGVyYWN0KAoJTERBUCAqbGQsIAoJ
dW5zaWduZWQgZmxhZ3MgX19hdHRyaWJ1dGVfXygodW51c2VkKSksIAoJdm9pZCAqZGVmLCAKCXZv
aWQgKmludGVyKQp7CglzYXNsX2ludGVyYWN0X3QgKmluID0gaW50ZXI7Cgljb25zdCBjaGFyICpw
OwoJdF9wdHNtICpwdHNtZGVmID0gZGVmOwoKCWZvciAoO2luLT5pZCAhPSBTQVNMX0NCX0xJU1Rf
RU5EO2luKyspIHsKCQlwID0gTlVMTDsKCQlzd2l0Y2goaW4tPmlkKSB7CgkJCWNhc2UgU0FTTF9D
Ql9BVVRITkFNRToKCQkJCWlmIChJU1NFVChwdHNtZGVmLT5pZCkpCgkJCQkJcCA9IHB0c21kZWYt
PmlkOwoJCQkJYnJlYWs7CgkJCWNhc2UgU0FTTF9DQl9VU0VSOgoJCQkJaWYgKElTU0VUKHB0c21k
ZWYtPmF1dGh6KSkKCQkJCQlwID0gcHRzbWRlZi0+YXV0aHo7CgkJCQlicmVhazsKCQkJY2FzZSBT
QVNMX0NCX0dFVFJFQUxNOgoJCQkJaWYgKElTU0VUKHB0c21kZWYtPnJlYWxtKSkKCQkJCQlwID0g
cHRzbWRlZi0+cmVhbG07CgkJCQlicmVhazsgICAgICAgICAgCgkJCWNhc2UgU0FTTF9DQl9QQVNT
OgoJCQkJaWYgKElTU0VUKHB0c21kZWYtPnBhc3N3b3JkKSkKCQkJCQlwID0gcHRzbWRlZi0+cGFz
c3dvcmQ7CgkJCQlicmVhazsKCQl9CgoJCWluLT5yZXN1bHQgPSBwID8gcCA6ICIiOwoJCWluLT5s
ZW4gPSBzdHJsZW4oaW4tPnJlc3VsdCk7Cgl9CgoJcmV0dXJuIExEQVBfU1VDQ0VTUzsKfQoKLyoK
ICogQ29udmVydCAnaWRlbnRpZmllcicgaW50byBjYW5vbmljYWwgZm9ybS4KICogUmV0dXJucyBh
IHBvaW50ZXIgdG8gYSBzdGF0aWMgYnVmZmVyIGNvbnRhaW5pbmcgdGhlIGNhbm9uaWNhbCBmb3Jt
CiAqIG9yIE5VTEwgaWYgJ2lkZW50aWZpZXInIGlzIGludmFsaWQuCiAqCiAqIFhYWCBJZiBhbnkg
b2YgdGhlIGNoYXJhY3RlcnMgbWFya2VkIHdpdGggMCBhcmUgdmFsaWQgYW5kIGFyZSBjcm9wcGlu
ZyB1cCwKICogdGhlIHJpZ2h0IHRoaW5nIHRvIGRvIGlzIHByb2JhYmx5IHRvIGNhbm9uaWNhbGl6
ZSB0aGUgaWRlbnRpZmllciB0byB0d28KICogcmVwcmVzZW50YXRpb25zOiBvbmUgZm9yIGdldHB3
ZW50IGNhbGxzIGFuZCBvbmUgZm9yIGZvbGRlciBuYW1lcy4gIFRoZQogKiBsYXR0ZXIgY2Fub25p
Y2FsaXplcyB0byBhIE1VVEY3IHJlcHJlc2VudGF0aW9uLgogKi8Kc3RhdGljIGNoYXIgKnB0c21v
ZHVsZV9jYW5vbmlmeWlkKGNvbnN0IGNoYXIgKmlkZW50aWZpZXIsIHNpemVfdCBsZW4pCnsKICAg
IHN0YXRpYyBjaGFyIHJldGJ1Zls4MV07CiAgICBjaGFyIHNhd2FscGhhOwogICAgY2hhciAqcDsK
ICAgIGludCB1c2VybmFtZV90b2xvd2VyID0gMDsKICAgIGludCBpID0gMDsKCiAgICBpZighbGVu
KSBsZW4gPSBzdHJsZW4oaWRlbnRpZmllcik7CiAgICBpZihsZW4gPj0gc2l6ZW9mKHJldGJ1Zikp
IHJldHVybiBOVUxMOwoKICAgIG1lbWNweShyZXRidWYsIGlkZW50aWZpZXIsIGxlbik7CiAgICBy
ZXRidWZbbGVuXSA9ICdcMCc7CgogICAgaWYgKCFzdHJuY21wKHJldGJ1ZiwgImdyb3VwOiIsIDYp
KQogICAgICAgIGkgPSA2OwoKICAgIC8qIENvcHkgdGhlIHN0cmluZyBhbmQgbG9vayB1cCB2YWx1
ZXMgaW4gdGhlIGFsbG93ZWRjaGFycyBhcnJheSBhYm92ZS4KICAgICAqIElmIHdlIHNlZSBhbnkg
d2UgZG9uJ3QgbGlrZSwgcmVqZWN0IHRoZSBzdHJpbmcuCiAgICAgKiBMb3dlcmNhc2UgdXNlcm5h
bWVzIGlmIHJlcXVlc3RlZC4KICAgICAqLwogICAgdXNlcm5hbWVfdG9sb3dlciA9IGNvbmZpZ19n
ZXRzd2l0Y2goSU1BUE9QVF9VU0VSTkFNRV9UT0xPV0VSKTsKICAgIHNhd2FscGhhID0gMDsKICAg
IGZvcihwID0gcmV0YnVmK2k7ICpwOyBwKyspIHsKICAgICAgICBpZiAodXNlcm5hbWVfdG9sb3dl
ciAmJiBpc3VwcGVyKCh1bnNpZ25lZCBjaGFyKSpwKSkKICAgICAgICAgICAgKnAgPSB0b2xvd2Vy
KCh1bnNpZ25lZCBjaGFyKSpwKTsKCiAgICAgICAgc3dpdGNoIChhbGxvd2VkY2hhcnNbKih1bnNp
Z25lZCBjaGFyKikgcF0pIHsKICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgIHJldHVybiBOVUxM
OwogICAgICAgICAgICAKICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgIHNhd2FscGhhID0gMTsK
ICAgICAgICAgICAgLyogRkFMTCBUSFJPVUdIICovCiAgICAgICAgICAgIAogICAgICAgIGRlZmF1
bHQ6CiAgICAgICAgICAgIDsKICAgICAgICB9CiAgICB9CgogICAgaWYgKCFzYXdhbHBoYSkgcmV0
dXJuIE5VTEw7ICAvKiBoYXMgdG8gYmUgb25lIGFscGhhIGNoYXIgKi8KCiAgICByZXR1cm4gcmV0
YnVmOwp9CgoKc3RhdGljIGludCBwdHNtb2R1bGVfY29ubmVjdCh2b2lkKSAKewoJaW50IHJjID0g
MDsKCglpZiAocHRzbSA9PSBOVUxMKSAgLy8gU2FuaXR5IENoZWNrCgkJcmV0dXJuIFBUU01fRkFJ
TDsKCglpZiAocHRzbS0+bGQgIT0gTlVMTCkKCQlyZXR1cm4gUFRTTV9PSzsKCglpZiAoSVNTRVQo
cHRzbS0+dGxzX2NhY2VydF9maWxlKSkgewoJCXJjID0gbGRhcF9zZXRfb3B0aW9uIChOVUxMLCBM
REFQX09QVF9YX1RMU19DQUNFUlRGSUxFLCBwdHNtLT50bHNfY2FjZXJ0X2ZpbGUpOwoJCWlmIChy
YyAhPSBMREFQX1NVQ0NFU1MpIHsKCQkJc3lzbG9nIChMT0dfV0FSTklORywgIlVuYWJsZSB0byBz
ZXQgTERBUF9PUFRfWF9UTFNfQ0FDRVJURklMRSAoJXMpLiIsIGxkYXBfZXJyMnN0cmluZyAocmMp
KTsKCQl9Cgl9CgoJaWYgKElTU0VUKHB0c20tPnRsc19jYWNlcnRfZGlyKSkgewoJCXJjID0gbGRh
cF9zZXRfb3B0aW9uIChOVUxMLCBMREFQX09QVF9YX1RMU19DQUNFUlRESVIsIHB0c20tPnRsc19j
YWNlcnRfZGlyKTsKCQlpZiAocmMgIT0gTERBUF9TVUNDRVNTKSB7CgkJCXN5c2xvZyAoTE9HX1dB
Uk5JTkcsICJVbmFibGUgdG8gc2V0IExEQVBfT1BUX1hfVExTX0NBQ0VSVERJUiAoJXMpLiIsIGxk
YXBfZXJyMnN0cmluZyAocmMpKTsKCQl9Cgl9CgoJaWYgKHB0c20tPnRsc19jaGVja19wZWVyICE9
IDApIHsKCQlyYyA9IGxkYXBfc2V0X29wdGlvbihOVUxMLCBMREFQX09QVF9YX1RMU19SRVFVSVJF
X0NFUlQsICZwdHNtLT50bHNfY2hlY2tfcGVlcik7CgkJaWYgKHJjICE9IExEQVBfU1VDQ0VTUykg
ewoJCQlzeXNsb2cgKExPR19XQVJOSU5HLCAiVW5hYmxlIHRvIHNldCBMREFQX09QVF9YX1RMU19S
RVFVSVJFX0NFUlQgKCVzKS4iLCBsZGFwX2VycjJzdHJpbmcgKHJjKSk7CgkJfQoJfQoKCWlmIChJ
U1NFVChwdHNtLT50bHNfY2lwaGVycykpIHsKCQkvKiBzZXQgY2lwaGVyIHN1aXRlLCBjZXJ0aWZp
Y2F0ZSBhbmQgcHJpdmF0ZSBrZXk6ICovCgkJcmMgPSBsZGFwX3NldF9vcHRpb24oTlVMTCwgTERB
UF9PUFRfWF9UTFNfQ0lQSEVSX1NVSVRFLCBwdHNtLT50bHNfY2lwaGVycyk7CgkJaWYgKHJjICE9
IExEQVBfU1VDQ0VTUykgewoJCQlzeXNsb2cgKExPR19XQVJOSU5HLCAiVW5hYmxlIHRvIHNldCBM
REFQX09QVF9YX1RMU19DSVBIRVJfU1VJVEUgKCVzKS4iLCBsZGFwX2VycjJzdHJpbmcgKHJjKSk7
CgkJfQoJfQoKCWlmIChJU1NFVChwdHNtLT50bHNfY2VydCkpIHsKCQlyYyA9IGxkYXBfc2V0X29w
dGlvbihOVUxMLCBMREFQX09QVF9YX1RMU19DRVJURklMRSwgcHRzbS0+dGxzX2NlcnQpOwoJCWlm
IChyYyAhPSBMREFQX1NVQ0NFU1MpIHsKCQkJc3lzbG9nIChMT0dfV0FSTklORywgIlVuYWJsZSB0
byBzZXQgTERBUF9PUFRfWF9UTFNfQ0VSVEZJTEUgKCVzKS4iLCBsZGFwX2VycjJzdHJpbmcgKHJj
KSk7CgkJfQoJfQoKCWlmIChJU1NFVChwdHNtLT50bHNfa2V5KSkgewoJCXJjID0gbGRhcF9zZXRf
b3B0aW9uKE5VTEwsIExEQVBfT1BUX1hfVExTX0tFWUZJTEUsIHB0c20tPnRsc19rZXkpOwoJCWlm
IChyYyAhPSBMREFQX1NVQ0NFU1MpIHsKCQkJc3lzbG9nIChMT0dfV0FSTklORywgIlVuYWJsZSB0
byBzZXQgTERBUF9PUFRfWF9UTFNfS0VZRklMRSAoJXMpLiIsIGxkYXBfZXJyMnN0cmluZyAocmMp
KTsKCQl9Cgl9CgoJcmMgPSBsZGFwX2luaXRpYWxpemUoJnB0c20tPmxkLCBwdHNtLT51cmkpOwoJ
aWYgKHJjICE9IExEQVBfU1VDQ0VTUykgewoJCXN5c2xvZyhMT0dfRVJSLCAibGRhcF9pbml0aWFs
aXplIGZhaWxlZCAoJXMpIiwgcHRzbS0+dXJpKTsKCQlyZXR1cm4gUFRTTV9GQUlMOwoJfQoKCXJj
ID0gbGRhcF9zZXRfb3B0aW9uKHB0c20tPmxkLCBMREFQX09QVF9QUk9UT0NPTF9WRVJTSU9OLCAm
KHB0c20tPnZlcnNpb24pKTsKCWlmIChyYyAhPSBMREFQX09QVF9TVUNDRVNTKSB7CgoJCWlmIChw
dHNtLT5zYXNsIHx8CgkJICAgIHB0c20tPnN0YXJ0X3RscykgewoJCQlzeXNsb2coTE9HX0VSUiwg
IkZhaWxlZCB0byBzZXQgTERBUF9PUFRfUFJPVE9DT0xfVkVSU0lPTiAlZCwgcmVxdWlyZWQgZm9y
IGxkYXBfc3RhcnRfdGxzIGFuZCBsZGFwX3Nhc2wuIiwgcHRzbS0+dmVyc2lvbik7CgkJCWxkYXBf
dW5iaW5kKHB0c20tPmxkKTsKICAgICAgICAgICAgcHRzbS0+bGQgPSBOVUxMOwoJCQlyZXR1cm4g
UFRTTV9GQUlMOwoJCX0gZWxzZQoJCQlzeXNsb2coTE9HX1dBUk5JTkcsICJVbmFibGUgdG8gc2V0
IExEQVBfT1BUX1BST1RPQ09MX1ZFUlNJT04gJWQuIiwgcHRzbS0+dmVyc2lvbik7CgoJCXB0c20t
PnZlcnNpb24gPSBMREFQX1ZFUlNJT04yOwoJfQoKCXJjID0gbGRhcF9zZXRfb3B0aW9uKHB0c20t
PmxkLCBMREFQX09QVF9ORVRXT1JLX1RJTUVPVVQsICYocHRzbS0+dGltZW91dCkpOwoJaWYgKHJj
ICE9IExEQVBfT1BUX1NVQ0NFU1MpIHsKCQlzeXNsb2coTE9HX1dBUk5JTkcsICJVbmFibGUgdG8g
c2V0IExEQVBfT1BUX05FVFdPUktfVElNRU9VVCAlZC4lZC4iLCBwdHNtLT50aW1lb3V0LnR2X3Nl
YywgcHRzbS0+dGltZW91dC50dl91c2VjKTsKCX0KCglyYyA9IGxkYXBfc2V0X29wdGlvbihwdHNt
LT5sZCwgTERBUF9PUFRfVElNRUxJTUlULCAmKHB0c20tPnRpbWVfbGltaXQpKTsKCWlmIChyYyAh
PSBMREFQX09QVF9TVUNDRVNTKSB7CgkJc3lzbG9nKExPR19XQVJOSU5HLCAiVW5hYmxlIHRvIHNl
dCBMREFQX09QVF9USU1FTElNSVQgJWQuIiwgcHRzbS0+dGltZV9saW1pdCk7Cgl9CgoJcmMgPSBs
ZGFwX3NldF9vcHRpb24ocHRzbS0+bGQsIExEQVBfT1BUX0RFUkVGLCAmKHB0c20tPmRlcmVmKSk7
CglpZiAocmMgIT0gTERBUF9PUFRfU1VDQ0VTUykgewoJCXN5c2xvZyhMT0dfV0FSTklORywgIlVu
YWJsZSB0byBzZXQgTERBUF9PUFRfREVSRUYgJWQuIiwgcHRzbS0+ZGVyZWYpOwoJfQoKCXJjID0g
bGRhcF9zZXRfb3B0aW9uKHB0c20tPmxkLCBMREFQX09QVF9SRUZFUlJBTFMsIHB0c20tPnJlZmVy
cmFscyA/IExEQVBfT1BUX09OIDogTERBUF9PUFRfT0ZGKTsKCWlmIChyYyAhPSBMREFQX09QVF9T
VUNDRVNTKSB7CgkJc3lzbG9nKExPR19XQVJOSU5HLCAiVW5hYmxlIHRvIHNldCBMREFQX09QVF9S
RUZFUlJBTFMuIik7Cgl9CgoJcmMgPSBsZGFwX3NldF9vcHRpb24ocHRzbS0+bGQsIExEQVBfT1BU
X1NJWkVMSU1JVCwgJihwdHNtLT5zaXplX2xpbWl0KSk7CglpZiAocmMgIT0gTERBUF9PUFRfU1VD
Q0VTUykKCQlzeXNsb2coTE9HX1dBUk5JTkcsICJVbmFibGUgdG8gc2V0IExEQVBfT1BUX1NJWkVM
SU1JVCAlZC4iLCBwdHNtLT5zaXplX2xpbWl0KTsKCglyYyA9IGxkYXBfc2V0X29wdGlvbihwdHNt
LT5sZCwgTERBUF9PUFRfUkVTVEFSVCwgcHRzbS0+cmVzdGFydCA/IExEQVBfT1BUX09OIDogTERB
UF9PUFRfT0ZGKTsKCWlmIChyYyAhPSBMREFQX09QVF9TVUNDRVNTKSB7CgkJc3lzbG9nKExPR19X
QVJOSU5HLCAiVW5hYmxlIHRvIHNldCBMREFQX09QVF9SRVNUQVJULiIpOwoJfQoKCWlmIChwdHNt
LT5zdGFydF90bHMpIHsKCgkJcmMgPSBsZGFwX3N0YXJ0X3Rsc19zKHB0c20tPmxkLCBOVUxMLCBO
VUxMKTsKCQlpZiAocmMgIT0gTERBUF9TVUNDRVNTKSB7CgkJCXN5c2xvZyhMT0dfRVJSLCAic3Rh
cnQgdGxzIGZhaWxlZCAoJXMpLiIsIGxkYXBfZXJyMnN0cmluZyhyYykpOwoJCQlsZGFwX3VuYmlu
ZChwdHNtLT5sZCk7CiAgICAgICAgICAgIHB0c20tPmxkID0gTlVMTDsKCQkJcmV0dXJuIFBUU01f
RkFJTDsKCQl9Cgl9CgkKCWlmIChwdHNtLT5zYXNsKSB7CgoJCWlmIChFTVBUWShwdHNtLT5tZWNo
KSkKCQkJbGRhcF9nZXRfb3B0aW9uKHB0c20tPmxkLCBMREFQX09QVF9YX1NBU0xfTUVDSCwgJihw
dHNtLT5tZWNoKSk7CgoJCWlmIChFTVBUWShwdHNtLT5yZWFsbSkpCgkJCWxkYXBfZ2V0X29wdGlv
bihwdHNtLT5sZCwgTERBUF9PUFRfWF9TQVNMX1JFQUxNLCAmKHB0c20tPnJlYWxtKSk7CgoJCWlm
IChJU1NFVChwdHNtLT5zYXNsX3NlY3Byb3BzKSkgewoJCQlyYyA9IGxkYXBfc2V0X29wdGlvbihw
dHNtLT5sZCwgTERBUF9PUFRfWF9TQVNMX1NFQ1BST1BTLCAodm9pZCAqKSBwdHNtLT5zYXNsX3Nl
Y3Byb3BzKTsKCQkJaWYoIHJjICE9IExEQVBfT1BUX1NVQ0NFU1MgKSB7CgkJCQlzeXNsb2coTE9H
X0VSUiwgIlVuYWJsZSB0byBzZXQgTERBUF9PUFRfWF9TQVNMX1NFQ1BST1BTLiIpOwoJCQkJbGRh
cF91bmJpbmQocHRzbS0+bGQpOwogICAgICAgICAgICAgICAgcHRzbS0+bGQgPSBOVUxMOwoJCQkJ
cmV0dXJuIFBUU01fRkFJTDsKCQkJfQoJCX0KCgkJcmMgPSBsZGFwX3Nhc2xfaW50ZXJhY3RpdmVf
YmluZF9zKAoJCQlwdHNtLT5sZCwgCgkJCXB0c20tPmJpbmRfZG4sCgkJCXB0c20tPm1lY2gsIAoJ
CQlOVUxMLCAKCQkJTlVMTCwgCgkJCUxEQVBfU0FTTF9RVUlFVCwgCgkJCXB0c21vZHVsZV9pbnRl
cmFjdCwgCgkJCXB0c20pOwoJfSBlbHNlCgkJcmMgPSBsZGFwX3NpbXBsZV9iaW5kX3MocHRzbS0+
bGQsIHB0c20tPmJpbmRfZG4sIHB0c20tPnBhc3N3b3JkKTsKCiAgICBpZiAocmMgIT0gTERBUF9T
VUNDRVNTKSB7CiAgICAgICAgc3lzbG9nKExPR19FUlIsCiAgICAgICAgICAgICAgIChwdHNtLT5z
YXNsID8gImxkYXBfc2FzbF9pbnRlcmFjdGl2ZV9iaW5kKCkgZmFpbGVkICVkICglcykuIiA6ICJs
ZGFwX3NpbXBsZV9iaW5kKCkgZmFpbGVkICVkICglcykuIiksIHJjLCBsZGFwX2VycjJzdHJpbmco
cmMpKTsKICAgICAgICBsZGFwX3VuYmluZChwdHNtLT5sZCk7CiAgICAgICAgcHRzbS0+bGQgPSBO
VUxMOwogICAgICAgIHJldHVybiAocmMgPT0gTERBUF9TRVJWRVJfRE9XTiA/IFBUU01fUkVUUlkg
OiBQVFNNX0ZBSUwpOwoJfQoKCXJldHVybiBQVFNNX09LOwp9CgovKiBBUEkgKi8KY29uc3QgY2hh
ciAqcHRzbW9kdWxlX25hbWUgPSAibGRhcCI7Cgp2b2lkIHB0c21vZHVsZV9pbml0KHZvaWQpIAp7
CiAgICBjaGFyICpwID0gTlVMTDsKCiAgICBpZiAocHRzbSkKICAgICAgICByZXR1cm47IC8vIEFs
cmVhZHkgY29uZmlndXJlZAoKICAgIHB0c20gPSB4bWFsbG9jKHNpemVvZih0X3B0c20pKTsKICAg
IGlmIChwdHNtID09IE5VTEwpIHsKICAgICAgICBmYXRhbCgieG1hbGxvYygpIGZhaWxlZCIsIEVD
X0NPTkZJRyk7CiAgICB9CgogICAgcHRzbS0+dXJpID0gKGNvbmZpZ19nZXRzdHJpbmcoSU1BUE9Q
VF9MREFQX1VSSSkgPyAKICAgICAgICBjb25maWdfZ2V0c3RyaW5nKElNQVBPUFRfTERBUF9VUkkp
IDogY29uZmlnX2dldHN0cmluZyhJTUFQT1BUX0xEQVBfU0VSVkVSUykpOwogICAgcHRzbS0+dmVy
c2lvbiA9IChjb25maWdfZ2V0aW50KElNQVBPUFRfTERBUF9WRVJTSU9OKSA9PSAyID8gTERBUF9W
RVJTSU9OMiA6IExEQVBfVkVSU0lPTjMpOwogICAgcHRzbS0+dGltZW91dC50dl9zZWMgPSBjb25m
aWdfZ2V0aW50KElNQVBPUFRfTERBUF9USU1FX0xJTUlUKTsKICAgIHB0c20tPnRpbWVvdXQudHZf
dXNlYyA9IDA7CiAgICBwdHNtLT5yZXN0YXJ0ID0gY29uZmlnX2dldHN3aXRjaChJTUFQT1BUX0xE
QVBfUkVTVEFSVCk7CiAgICBwID0gY29uZmlnX2dldHN0cmluZyhJTUFQT1BUX0xEQVBfREVSRUYp
OwogICAgaWYgKCFzdHJjYXNlY21wKHAsICJzZWFyY2giKSkgewogICAgICAgIHB0c20tPmRlcmVm
ID0gTERBUF9ERVJFRl9TRUFSQ0hJTkc7CiAgICB9IGVsc2UgaWYgKCFzdHJjYXNlY21wKHAsICJm
aW5kIikpIHsKICAgICAgICBwdHNtLT5kZXJlZiA9IExEQVBfREVSRUZfRklORElORzsKICAgIH0g
ZWxzZSBpZiAoIXN0cmNhc2VjbXAocCwgImFsd2F5cyIpKSB7CiAgICAgICAgcHRzbS0+ZGVyZWYg
PSBMREFQX0RFUkVGX0FMV0FZUzsKICAgIH0gZWxzZSB7CiAgICAgICAgcHRzbS0+ZGVyZWYgPSBM
REFQX0RFUkVGX05FVkVSOwogICAgfQogICAgcHRzbS0+cmVmZXJyYWxzID0gY29uZmlnX2dldHN3
aXRjaChJTUFQT1BUX0xEQVBfUkVGRVJSQUxTKTsKICAgIHB0c20tPnNpemVfbGltaXQgPSBjb25m
aWdfZ2V0aW50KElNQVBPUFRfTERBUF9TSVpFX0xJTUlUKTsKICAgIHB0c20tPnRpbWVfbGltaXQg
PSBjb25maWdfZ2V0aW50KElNQVBPUFRfTERBUF9USU1FX0xJTUlUKTsKICAgIHAgPSBjb25maWdf
Z2V0c3RyaW5nKElNQVBPUFRfTERBUF9TQ09QRSk7CiAgICBpZiAoIXN0cmNhc2VjbXAocCwgIm9u
ZSIpKSB7CiAgICAgICAgcHRzbS0+c2NvcGUgPSBMREFQX1NDT1BFX09ORUxFVkVMOwogICAgfSBl
bHNlIGlmICghc3RyY2FzZWNtcChwLCAiYmFzZSIpKSB7CiAgICAgICAgcHRzbS0+c2NvcGUgPSBM
REFQX1NDT1BFX0JBU0U7CiAgICB9IGVsc2UgewogICAgICAgIHB0c20tPnNjb3BlID0gTERBUF9T
Q09QRV9TVUJUUkVFOwogICAgfQogICAgcHRzbS0+YmluZF9kbiA9IGNvbmZpZ19nZXRzdHJpbmco
SU1BUE9QVF9MREFQX0JJTkRfRE4pOwogICAgcHRzbS0+c2FzbCA9IGNvbmZpZ19nZXRzd2l0Y2go
SU1BUE9QVF9MREFQX1NBU0wpOwogICAgcHRzbS0+aWQgPSAoY29uZmlnX2dldHN0cmluZyhJTUFQ
T1BUX0xEQVBfSUQpID8gCiAgICAgICAgY29uZmlnX2dldHN0cmluZyhJTUFQT1BUX0xEQVBfSUQp
IDogY29uZmlnX2dldHN0cmluZyhJTUFQT1BUX0xEQVBfU0FTTF9BVVRIQykpOwogICAgcHRzbS0+
YXV0aHogPSAoY29uZmlnX2dldHN0cmluZyhJTUFQT1BUX0xEQVBfQVVUSFopID8gCiAgICAgICAg
Y29uZmlnX2dldHN0cmluZyhJTUFQT1BUX0xEQVBfQVVUSFopIDogY29uZmlnX2dldHN0cmluZyhJ
TUFQT1BUX0xEQVBfU0FTTF9BVVRIWikpOwogICAgcHRzbS0+bWVjaCA9IChjb25maWdfZ2V0c3Ry
aW5nKElNQVBPUFRfTERBUF9NRUNIKSA/IAogICAgICAgIGNvbmZpZ19nZXRzdHJpbmcoSU1BUE9Q
VF9MREFQX01FQ0gpIDogY29uZmlnX2dldHN0cmluZyhJTUFQT1BUX0xEQVBfU0FTTF9NRUNIKSk7
CiAgICBwdHNtLT5yZWFsbSA9IChjb25maWdfZ2V0c3RyaW5nKElNQVBPUFRfTERBUF9SRUFMTSkg
PyAKICAgICAgICBjb25maWdfZ2V0c3RyaW5nKElNQVBPUFRfTERBUF9SRUFMTSkgOiBjb25maWdf
Z2V0c3RyaW5nKElNQVBPUFRfTERBUF9TQVNMX1JFQUxNKSk7CiAgICBwdHNtLT5wYXNzd29yZCA9
IChjb25maWdfZ2V0c3RyaW5nKElNQVBPUFRfTERBUF9QQVNTV09SRCkgPyAKICAgICAgICBjb25m
aWdfZ2V0c3RyaW5nKElNQVBPUFRfTERBUF9QQVNTV09SRCkgOiBjb25maWdfZ2V0c3RyaW5nKElN
QVBPUFRfTERBUF9TQVNMX1BBU1NXT1JEKSk7CiAgICBwdHNtLT5zdGFydF90bHMgPSBjb25maWdf
Z2V0c3dpdGNoKElNQVBPUFRfTERBUF9TVEFSVF9UTFMpOwogICAgcHRzbS0+dGxzX2NoZWNrX3Bl
ZXIgPSBjb25maWdfZ2V0c3dpdGNoKElNQVBPUFRfTERBUF9UTFNfQ0hFQ0tfUEVFUik7CiAgICBw
dHNtLT50bHNfY2FjZXJ0X2ZpbGUgPSBjb25maWdfZ2V0c3RyaW5nKElNQVBPUFRfTERBUF9UTFNf
Q0FDRVJUX0ZJTEUpOwogICAgcHRzbS0+dGxzX2NhY2VydF9kaXIgPSBjb25maWdfZ2V0c3RyaW5n
KElNQVBPUFRfTERBUF9UTFNfQ0FDRVJUX0RJUik7CiAgICBwdHNtLT50bHNfY2lwaGVycyA9IGNv
bmZpZ19nZXRzdHJpbmcoSU1BUE9QVF9MREFQX1RMU19DSVBIRVJTKTsKICAgIHB0c20tPnRsc19j
ZXJ0ID0gY29uZmlnX2dldHN0cmluZyhJTUFQT1BUX0xEQVBfVExTX0NFUlQpOwogICAgcHRzbS0+
dGxzX2tleSA9IGNvbmZpZ19nZXRzdHJpbmcoSU1BUE9QVF9MREFQX1RMU19LRVkpOwogICAgcCA9
IGNvbmZpZ19nZXRzdHJpbmcoSU1BUE9QVF9MREFQX01FTUJFUl9NRVRIT0QpOwogICAgaWYgKCFz
dHJjYXNlY21wKHAsICJmaWx0ZXIiKSkgewogICAgICAgIHB0c20tPm1lbWJlcl9tZXRob2QgPSBQ
VFNNX01FTUJFUl9NRVRIT0RfRklMVEVSOwogICAgfSBlbHNlIHsKICAgICAgICBwdHNtLT5tZW1i
ZXJfbWV0aG9kID0gUFRTTV9NRU1CRVJfTUVUSE9EX0FUVFJJQlVURTsKICAgIH0KICAgIHAgPSBj
b25maWdfZ2V0c3RyaW5nKElNQVBPUFRfTERBUF9NRU1CRVJfU0NPUEUpOwogICAgaWYgKCFzdHJj
YXNlY21wKHAsICJvbmUiKSkgewogICAgICAgIHB0c20tPm1lbWJlcl9zY29wZSA9IExEQVBfU0NP
UEVfT05FTEVWRUw7CiAgICB9IGVsc2UgaWYgKCFzdHJjYXNlY21wKHAsICJiYXNlIikpIHsKICAg
ICAgICBwdHNtLT5tZW1iZXJfc2NvcGUgPSBMREFQX1NDT1BFX0JBU0U7CiAgICB9IGVsc2Ugewog
ICAgICAgIHB0c20tPm1lbWJlcl9zY29wZSA9IExEQVBfU0NPUEVfU1VCVFJFRTsKICAgIH0KICAg
IHB0c20tPm1lbWJlcl9maWx0ZXIgPSBjb25maWdfZ2V0c3RyaW5nKElNQVBPUFRfTERBUF9NRU1C
RVJfRklMVEVSKTsKICAgIHB0c20tPm1lbWJlcl9iYXNlID0gY29uZmlnX2dldHN0cmluZyhJTUFQ
T1BUX0xEQVBfTUVNQkVSX0JBU0UpOwogICAgcHRzbS0+bWVtYmVyX2F0dHJpYnV0ZSA9IChjb25m
aWdfZ2V0c3RyaW5nKElNQVBPUFRfTERBUF9NRU1CRVJfQVRUUklCVVRFKSA/CiAgICAgICAgY29u
ZmlnX2dldHN0cmluZyhJTUFQT1BUX0xEQVBfTUVNQkVSX0FUVFJJQlVURSkgOiBjb25maWdfZ2V0
c3RyaW5nKElNQVBPUFRfTERBUF9NRU1CRVJfQVRUUklCVVRFKSk7CiAgICBwID0gY29uZmlnX2dl
dHN0cmluZyhJTUFQT1BUX0xEQVBfR1JPVVBfU0NPUEUpOwogICAgaWYgKCFzdHJjYXNlY21wKHAs
ICJvbmUiKSkgewogICAgICAgIHB0c20tPmdyb3VwX3Njb3BlID0gTERBUF9TQ09QRV9PTkVMRVZF
TDsKICAgIH0gZWxzZSBpZiAoIXN0cmNhc2VjbXAocCwgImJhc2UiKSkgewogICAgICAgIHB0c20t
Pmdyb3VwX3Njb3BlID0gTERBUF9TQ09QRV9CQVNFOwogICAgfSBlbHNlIHsKICAgICAgICBwdHNt
LT5ncm91cF9zY29wZSA9IExEQVBfU0NPUEVfU1VCVFJFRTsKICAgIH0KICAgIHB0c20tPmdyb3Vw
X2ZpbHRlciA9IGNvbmZpZ19nZXRzdHJpbmcoSU1BUE9QVF9MREFQX0dST1VQX0ZJTFRFUik7CiAg
ICBwdHNtLT5ncm91cF9iYXNlID0gY29uZmlnX2dldHN0cmluZyhJTUFQT1BUX0xEQVBfR1JPVVBf
QkFTRSk7CiAgICBwdHNtLT5maWx0ZXIgPSBjb25maWdfZ2V0c3RyaW5nKElNQVBPUFRfTERBUF9G
SUxURVIpOwogICAgcHRzbS0+YmFzZSA9IGNvbmZpZ19nZXRzdHJpbmcoSU1BUE9QVF9MREFQX0JB
U0UpOwoKCWlmIChwdHNtLT52ZXJzaW9uICE9IExEQVBfVkVSU0lPTjMgJiYgCgkgICAgKHB0c20t
PnNhc2wgfHwKCSAgICAgcHRzbS0+c3RhcnRfdGxzKSkKCSAgICBwdHNtLT52ZXJzaW9uID0gTERB
UF9WRVJTSU9OMzsKCiAgICBwdHNtLT5sZCA9IE5VTEw7Cn0KCi8qCiAqIE5vdGU6IGNhbGxpbmcg
ZnVuY3Rpb24gbXVzdCBmcmVlIG1lbW9yeS4KICovCnN0YXRpYyBpbnQgcHRzbW9kdWxlX2VzY2Fw
ZSgKCWNvbnN0IGNoYXIgKnMsIAoJY29uc3QgdW5zaWduZWQgaW50IG4sIAoJY2hhciAqKnJlc3Vs
dCkgCnsKCWNoYXIgKmJ1ZjsKCWNoYXIgKmVuZCwgKnB0ciwgKnRlbXA7CgoJaWYgKG4gPiBzdHJs
ZW4ocykpICAvLyBTYW5pdHkgY2hlY2ssIGp1c3QgaW4gY2FzZQoJCXJldHVybiBQVFNNX0ZBSUw7
CgoJYnVmID0geG1hbGxvYyhuICogNSArIDEpOwoJaWYgKGJ1ZiA9PSBOVUxMKSB7CgkJcmV0dXJu
IFBUU01fTk9NRU07Cgl9CgoJYnVmWzBdID0gJ1wwJzsKCXB0ciA9IChjaGFyICopczsKCWVuZCA9
IHB0ciArIG47CgoJd2hpbGUgKCgodGVtcCA9IHN0cnBicmsocHRyLCAiKigpXFxcMCIpKSE9TlVM
TCkgJiYgKHRlbXA8ZW5kKSkgewoKCQlpZiAodGVtcD5wdHIpCgkJCXN0cm5jYXQoYnVmLCBwdHIs
IHRlbXAtcHRyKTsKCgkJc3dpdGNoICgqdGVtcCkgewoJCQljYXNlICcqJzoKCQkJCXN0cmNhdChi
dWYsICJcXDJhIik7CgkJCQlicmVhazsKCQkJY2FzZSAnKCc6CgkJCQlzdHJjYXQoYnVmLCAiXFwy
OCIpOwoJCQkJYnJlYWs7CgkJCWNhc2UgJyknOgoJCQkJc3RyY2F0KGJ1ZiwgIlxcMjkiKTsKCQkJ
CWJyZWFrOwoJCQljYXNlICdcXCc6CgkJCQlzdHJjYXQoYnVmLCAiXFw1YyIpOwoJCQkJYnJlYWs7
CgkJCWNhc2UgJ1wwJzoKCQkJCXN0cmNhdChidWYsICJcXDAwIik7CgkJCQlicmVhazsKCQl9CgkJ
cHRyPXRlbXArMTsKCX0KCWlmIChwdHI8ZW5kKQoJCXN0cm5jYXQoYnVmLCBwdHIsIGVuZC1wdHIp
OwoKCSpyZXN1bHQgPSBidWY7CgoJcmV0dXJuIFBUU01fT0s7Cn0KCnN0YXRpYyBpbnQgcHRzbW9k
dWxlX3Rva2VuaXplX2RvbWFpbnMoCgljb25zdCBjaGFyICpkLCAKCWludCBuLCAKCWNoYXIgKipy
ZXN1bHQpCnsKCWNoYXIgKnMsICpzMTsKCWNoYXIgKmxhc3RzOwoJaW50IG50LCBpOwoKCSpyZXN1
bHQgPSBOVUxMOwoKCWlmIChkID09IE5VTEwgfHwgbiA8IDEgfHwgbiA+IDkpCgkJcmV0dXJuIFBU
U01fRkFJTDsKCglzID0gc3RyZHVwKGQpOwoJaWYgKHMgPT0gTlVMTCkKCQlyZXR1cm4gUFRTTV9O
T01FTTsKCglmb3IoIG50PTAsIHMxPXM7ICpzMTsgczErKyApCgkJaWYoICpzMSA9PSAnLicgKSBu
dCsrOwoJbnQrKzsKCglpZiAobiA+IG50KSB7CgkJZnJlZShzKTsKCQlyZXR1cm4gUFRTTV9GQUlM
OwoJfQoKCWkgPSBudCAtIG47CglzMSA9IChjaGFyICopc3RydG9rX3IocywgIi4iLCAmbGFzdHMp
OwoJd2hpbGUoczEpIHsKCQlpZiAoaSA9PSAwKSB7CgkJCSpyZXN1bHQgPSBzdHJkdXAoczEpOwoJ
CQlmcmVlKHMpOwoJCQlyZXR1cm4gKCpyZXN1bHQgPT0gTlVMTCA/IFBUU01fTk9NRU0gOiBQVFNN
X09LKTsKCQl9CgkJczEgPSAoY2hhciAqKXN0cnRva19yKE5VTEwsICIuIiwgJmxhc3RzKTsKCQlp
LS07Cgl9CgoJZnJlZShzKTsKCXJldHVybiBQVFNNX0ZBSUw7Cn0KCiNkZWZpbmUgUFRTTV9NQVgo
YSxiKSAoYT5iP2E6YikKCi8qCiAqIHB0c21vZHVsZV9leHBhbmRfdG9rZW5zCiAqIFBhcnRzIHdp
dGggdGhlIHN0cmluZ3MgcHJvdmlkZWQuCiAqICAgJSUgICA9ICUKICogICAldSAgID0gdXNlcgog
KiAgICVVICAgPSB1c2VyIHBhcnQgb2YgJXUKICogICAlZCAgID0gZG9tYWluIHBhcnQgb2YgJXUg
aWYgYXZhaWxhYmxlLCBvdGh3aXNlIHNhbWUgYXMgJXIKICogICAlMS05ID0gZG9tYWluIHRva2Vu
cyAoJTEgPSB0bGQsICUyID0gZG9tYWluIHdoZW4gJWQgPSBkb21haW4udGxkKQogKiAgICVEICAg
PSB1c2VyIEROCiAqIE5vdGU6IGNhbGxpbmcgZnVuY3Rpb24gbXVzdCBmcmVlIG1lbW9yeS4KICov
CnN0YXRpYyBpbnQgcHRzbW9kdWxlX2V4cGFuZF90b2tlbnMoCgljb25zdCBjaGFyICpwYXR0ZXJu
LAoJY29uc3QgY2hhciAqdXNlcm5hbWUsIAoJY29uc3QgY2hhciAqZG4sCgljaGFyICoqcmVzdWx0
KSAKewoJY2hhciAqYnVmOyAKCWNoYXIgKmVuZCwgKnB0ciwgKnRlbXA7CgljaGFyICplYnVmLCAq
dXNlcjsKCWNoYXIgKmRvbWFpbjsKCWludCByYzsKCgkvKiB0byBwZXJtaXQgbXVsdGlwbGUgb2Nj
dXJlbmNlcyBvZiB1c2VybmFtZSBhbmQvb3IgcmVhbG0gaW4gZmlsdGVyICovCgkvKiBhbmQgYXZv
aWQgbWVtb3J5IG92ZXJmbG93IGluIGZpbHRlciBidWlsZCBbZWc6ICh8KHVpZD0ldSkodXNlcmlk
PSV1KSkgXSAqLwoJaW50IHBlcmNlbnRzLCB1c2VyX2xlbiwgZG5fbGVuLCBtYXhwYXJhbWxlbmd0
aDsKCQoJaWYgKHBhdHRlcm4gPT0gTlVMTCkgewoJCXN5c2xvZyhMT0dfRVJSLCAiZmlsdGVyIHBh
dHRlcm4gbm90IHNldHVwIik7CgkJcmV0dXJuIFBUU01fRkFJTDsKCX0KCgkvKiBmaW5kIHRoZSBs
b25nZXN0IHBhcmFtIG9mIHVzZXJuYW1lIGFuZCByZWFsbSwgCgkgICBkbyBub3Qgd29ycnkgYWJv
dXQgZG9tYWluIGJlY2F1c2UgaXQgaXMgYWx3YXlzIHNob3J0ZXIgCgkgICB0aGVuIHVzZXJuYW1l
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovCgl1c2VyX2xlbj11
c2VybmFtZSA/IHN0cmxlbih1c2VybmFtZSkgOiAwOwoJZG5fbGVuPWRuID8gc3RybGVuKGRuKSA6
IDA7CgoJbWF4cGFyYW1sZW5ndGggPSBQVFNNX01BWCh1c2VyX2xlbiwgZG5fbGVuKTsKCgkvKiBm
aW5kIHRoZSBudW1iZXIgb2Ygb2NjdXJlbmNlcyBvZiBwZXJjZW50IHNpZ24gaW4gZmlsdGVyICov
Cglmb3IoIHBlcmNlbnRzPTAsIGJ1Zj0oY2hhciAqKXBhdHRlcm47ICpidWY7IGJ1ZisrICkgewoJ
CWlmKCAqYnVmID09ICclJyApIHBlcmNlbnRzKys7Cgl9CgoJLyogcGVyY2VudHMgKiAzICogbWF4
cGFyYW1sZW5ndGggYmVjYXVzZSB3ZSBuZWVkIHRvIGFjY291bnQgZm9yCiAgICAgICAgICogYW4g
ZW50aXJlbHktZXNjYXBlZCB3b3JzdC1jYXNlLWxlbmd0aCBwYXJhbWV0ZXIgKi8KCWJ1Zj14bWFs
bG9jKHN0cmxlbihwYXR0ZXJuKSArIChwZXJjZW50cyAqIDMgKiBtYXhwYXJhbWxlbmd0aCkgKzEp
OwoJaWYoYnVmID09IE5VTEwpCgkJcmV0dXJuIFBUU01fTk9NRU07CglidWZbMF0gPSAnXDAnOwoJ
CglwdHIgPSAoY2hhciAqKXBhdHRlcm47CgllbmQgPSBwdHIgKyBzdHJsZW4ocHRyKTsKCgl3aGls
ZSAoKHRlbXA9c3RyY2hyKHB0ciwnJScpKSE9TlVMTCApIHsKCgkJaWYgKCh0ZW1wLXB0cikgPiAw
KQoJCQlzdHJuY2F0KGJ1ZiwgcHRyLCB0ZW1wLXB0cik7CgoJCWlmICgodGVtcCsxKSA+PSBlbmQp
IHsKCQkJc3lzbG9nKExPR19ERUJVRywgIkluY29tcGxldGUgbG9va3VwIHN1YnN0aXR1dGlvbiBm
b3JtYXQiKTsKCQkJYnJlYWs7CgkJfQoKCQlzd2l0Y2ggKCoodGVtcCsxKSkgewoJCQljYXNlICcl
JzoKCQkJCXN0cm5jYXQoYnVmLHRlbXArMSwxKTsKCQkJCWJyZWFrOwoJCQljYXNlICd1JzoKCQkJ
CWlmIChJU1NFVCh1c2VybmFtZSkpIHsKCQkJCQlyYz1wdHNtb2R1bGVfZXNjYXBlKHVzZXJuYW1l
LCBzdHJsZW4odXNlcm5hbWUpLCAmZWJ1Zik7CgkJCQkJaWYgKHJjID09IFBUU01fT0spIHsKCQkJ
CQkJc3RyY2F0KGJ1ZixlYnVmKTsKCQkJCQkJZnJlZShlYnVmKTsKCQkJCQl9CgkJCQl9IGVsc2UK
CQkJCQlzeXNsb2coTE9HX0RFQlVHLCAiVXNlcm5hbWUgbm90IGF2YWlsYWJsZS4iKTsKCQkJCWJy
ZWFrOwoJCQljYXNlICdVJzoKCQkJCWlmIChJU1NFVCh1c2VybmFtZSkpIHsKCQkJCQkKCQkJCQl1
c2VyID0gc3RyY2hyKHVzZXJuYW1lLCAnQCcpOwoJCQkJCXJjPXB0c21vZHVsZV9lc2NhcGUodXNl
cm5hbWUsICh1c2VyID8gdXNlciAtIHVzZXJuYW1lIDogc3RybGVuKHVzZXJuYW1lKSksICZlYnVm
KTsKCQkJCQlpZiAocmMgPT0gUFRTTV9PSykgewoJCQkJCQlzdHJjYXQoYnVmLGVidWYpOwoJCQkJ
CQlmcmVlKGVidWYpOwoJCQkJCX0KCQkJCX0gZWxzZQoJCQkJCXN5c2xvZyhMT0dfREVCVUcsICJV
c2VybmFtZSBub3QgYXZhaWxhYmxlLiIpOwoJCQkJYnJlYWs7CgkJCWNhc2UgJzEnOgoJCQljYXNl
ICcyJzoKCQkJY2FzZSAnMyc6CgkJCWNhc2UgJzQnOgoJCQljYXNlICc1JzoKCQkJY2FzZSAnNic6
CgkJCWNhc2UgJzcnOgoJCQljYXNlICc4JzoKCQkJY2FzZSAnOSc6CgkJCQlpZiAoSVNTRVQodXNl
cm5hbWUpICYmIChkb21haW4gPSBzdHJjaHIodXNlcm5hbWUsICdAJykpICYmIGRvbWFpblsxXSE9
J1wwJykgewoJCQkJCXJjPXB0c21vZHVsZV90b2tlbml6ZV9kb21haW5zKGRvbWFpbisxLCAoaW50
KSAqKHRlbXArMSktNDgsICZlYnVmKTsKCQkJCQlpZiAocmMgPT0gUFRTTV9PSykgewoJCQkJCQlz
dHJjYXQoYnVmLGVidWYpOwoJCQkJCQlmcmVlKGVidWYpOwoJCQkJCX0KCQkJCX0gZWxzZQoJCQkJ
CXN5c2xvZyhMT0dfREVCVUcsICJEb21haW4gdG9rZW5zIG5vdCBhdmFpbGFibGUuIik7CgkJCQli
cmVhazsKCQkJY2FzZSAnZCc6CgkJCQlpZiAoSVNTRVQodXNlcm5hbWUpICYmIChkb21haW4gPSBz
dHJjaHIodXNlcm5hbWUsICdAJykpICYmIGRvbWFpblsxXSE9J1wwJykgewoJCQkJCXJjPXB0c21v
ZHVsZV9lc2NhcGUoZG9tYWluKzEsIHN0cmxlbihkb21haW4rMSksICZlYnVmKTsKCQkJCQlpZiAo
cmMgPT0gUFRTTV9PSykgewoJCQkJCQlzdHJjYXQoYnVmLGVidWYpOwoJCQkJCQlmcmVlKGVidWYp
OwoJCQkJCX0KCQkJCQlicmVhazsKCQkJCX0gCgkJCWNhc2UgJ0QnOgoJCQkJaWYgKElTU0VUKGRu
KSkgewoJCQkJCXJjID0gcHRzbW9kdWxlX2VzY2FwZShkbiwgc3RybGVuKGRuKSwgJmVidWYpOwoJ
CQkJCWlmIChyYyA9PSBQVFNNX09LKSB7CgkJCQkJCXN0cmNhdChidWYsZWJ1Zik7CgkJCQkJCWZy
ZWUoZWJ1Zik7CgkJCQkJfQoJCQkJfSBlbHNlCgkJCQkJc3lzbG9nKExPR19ERUJVRywgImRuIG5v
dCBhdmFpbGFibGUuIik7CgkJCQlicmVhazsKCQkJZGVmYXVsdDoKCQkJCWJyZWFrOwoJCX0KCQlw
dHI9dGVtcCsyOwoJfQoJaWYgKHRlbXA8ZW5kKQoJCXN0cmNhdChidWYsIHB0cik7CgoJKnJlc3Vs
dCA9IGJ1ZjsKCglyZXR1cm4gUFRTTV9PSzsKfQoKCnN0YXRpYyBpbnQgcHRzbW9kdWxlX2dldF9k
bigKICAgIGNvbnN0IGNoYXIgKmNhbm9uX2lkLAogICAgc2l6ZV90IHNpemUsCiAgICBjaGFyICoq
cmV0KQp7CiAgICBpbnQgcmM7CgojaWYgTERBUF9WRU5ET1JfVkVSU0lPTiA+PSAyMDEyNQogICAg
c3RydWN0IGJlcnZhbCAqZG4gPSBOVUxMOwogICAgTERBUENvbnRyb2wgYzsKICAgIExEQVBDb250
cm9sICpjdHJsWzJdOwogICAgY2hhciAqYXV0aHppZDsKI2Vsc2UKICAgIGNoYXIgKmJhc2UgPSBO
VUxMLCAqZmlsdGVyID0gTlVMTDsKICAgIGNoYXIgKmF0dHJzW10gPSB7TlVMTH07CiAgICBMREFQ
TWVzc2FnZSAqcmVzOwogICAgTERBUE1lc3NhZ2UgKmVudHJ5OwogICAgY2hhciAqYXR0ciwgKip2
YWxzOwogICAgQmVyRWxlbWVudCAqYmVyOwojZW5kaWYKCiAgICAqcmV0ID0gTlVMTDsKCiAgICBp
ZiAocHRzbS0+bGQgPT0gTlVMTCkKICAgICAgICByZXR1cm4gUFRTTV9GQUlMOwoKI2lmIExEQVBf
VkVORE9SX1ZFUlNJT04gPj0gMjAxMjUKCiAgICBhdXRoemlkID0geG1hbGxvYyhzaXplICsgc2l6
ZW9mKCJ1OiIpKTsKICAgIGlmIChhdXRoemlkID09IE5VTEwpCiAgICAgICAgcmV0dXJuIFBUU01f
Tk9NRU07CgogICAgc3RyY3B5KGF1dGh6aWQsICJ1OiIpOwogICAgc3RyY3B5KGF1dGh6aWQrMiwg
Y2Fub25faWQpOwogICAgYy5sZGN0bF9vaWQgPSBMREFQX0NPTlRST0xfUFJPWFlfQVVUSFo7CiAg
ICBjLmxkY3RsX3ZhbHVlLmJ2X3ZhbCA9IGF1dGh6aWQ7CiAgICBjLmxkY3RsX3ZhbHVlLmJ2X2xl
biA9IHNpemUgKyAyOwogICAgYy5sZGN0bF9pc2NyaXRpY2FsID0gMTsKCiAgICBjdHJsWzBdID0g
JmM7CiAgICBjdHJsWzFdID0gTlVMTDsKICAgIHJjID0gbGRhcF93aG9hbWlfcyhwdHNtLT5sZCwg
JmRuLCBjdHJsLCBOVUxMKTsKICAgIGZyZWUoYXV0aHppZCk7CiAgICBpZiAoIHJjICE9IExEQVBf
U1VDQ0VTUyB8fCAhZG4gKSB7CiAgICAgICAgaWYgKHJjID09IExEQVBfU0VSVkVSX0RPV04pIHsK
ICAgICAgICAgICAgbGRhcF91bmJpbmQocHRzbS0+bGQpOwogICAgICAgICAgICBwdHNtLT5sZCA9
IE5VTEw7CiAgICAgICAgICAgIHJldHVybiBQVFNNX1JFVFJZOwogICAgICAgIH0KICAgICAgICBy
ZXR1cm4gUFRTTV9GQUlMOwogICAgfQoKICAgIGlmICggZG4tPmJ2X3ZhbCAmJgogICAgICAgICFz
dHJuY21wKGRuLT5idl92YWwsICJkbjoiLCAzKSApCiAgICAgICAgKnJldCA9IHN0cmR1cChkbi0+
YnZfdmFsKzMpOwogICAgYmVyX2J2ZnJlZShkbik7CgojZWxzZQoKICAgIHJjID0gcHRzbW9kdWxl
X2V4cGFuZF90b2tlbnMocHRzbS0+ZmlsdGVyLCBjYW5vbl9pZCwgTlVMTCwgJmZpbHRlcik7CiAg
ICBpZiAocmMgIT0gUFRTTV9PSykKICAgICAgICByZXR1cm4gcmM7CgogICAgcmMgPSBwdHNtb2R1
bGVfZXhwYW5kX3Rva2VucyhwdHNtLT5iYXNlLCBjYW5vbl9pZCwgTlVMTCwgJmJhc2UpOwogICAg
aWYgKHJjICE9IFBUU01fT0spCiAgICAgICAgcmV0dXJuIHJjOwoKICAgIHJjID0gbGRhcF9zZWFy
Y2hfc3QocHRzbS0+bGQsIGJhc2UsIHB0c20tPnNjb3BlLCBmaWx0ZXIsIGF0dHJzLCAwLCAmKHB0
c20tPnRpbWVvdXQpLCAmcmVzKTsKICAgIGZyZWUoZmlsdGVyKTsKICAgIGZyZWUoYmFzZSk7CiAg
ICBpZiAocmMgIT0gTERBUF9TVUNDRVNTKSB7CiAgICAgICAgaWYgKHJjID09IExEQVBfU0VSVkVS
X0RPV04pIHsKICAgICAgICAgICAgbGRhcF91bmJpbmQocHRzbS0+bGQpOwogICAgICAgICAgICBw
dHNtLT5sZCA9IE5VTEw7CiAgICAgICAgICAgIHJldHVybiBQVFNNX1JFVFJZOwogICAgICAgIH0K
ICAgICAgICByZXR1cm4gUFRTTV9GQUlMOwogICAgfQoKICAgIGlmICggKGVudHJ5ID0gbGRhcF9m
aXJzdF9lbnRyeShwdHNtLT5sZCwgcmVzKSkgIT0gTlVMTCApCiAgICAgICAgKnJldCA9IGxkYXBf
Z2V0X2RuKHB0c20tPmxkLCBlbnRyeSk7CgogICAgbGRhcF9tc2dmcmVlKHJlcyk7CiAgICByZXMg
PSBOVUxMOwoKI2VuZGlmCgogICAgcmV0dXJuICgqcmV0ID8gUFRTTV9PSyA6IFBUU01fRkFJTCk7
Cn0KCgpzdGF0aWMgaW50IHB0c21vZHVsZV9tYWtlX2F1dGhzdGF0ZV9hdHRyaWJ1dGUoCiAgICBj
b25zdCBjaGFyICpjYW5vbl9pZCwKICAgIHNpemVfdCBzaXplLAogICAgY29uc3QgY2hhciAqKnJl
cGx5LCAKICAgIGludCAqZHNpemUsCiAgICBzdHJ1Y3QgYXV0aF9zdGF0ZSAqKm5ld3N0YXRlKSAK
ewogICAgY2hhciAqZG4gPSBOVUxMOwogICAgTERBUE1lc3NhZ2UgKnJlczsKICAgIExEQVBNZXNz
YWdlICplbnRyeTsKICAgIGNoYXIgKmF0dHIsICoqdmFsczsKICAgIEJlckVsZW1lbnQgKmJlcjsK
ICAgIGludCByYzsKICAgIGNoYXIgKmF0dHJzW10gPSB7cHRzbS0+bWVtYmVyX2F0dHJpYnV0ZSxO
VUxMfTsKCiAgICByYyA9IHB0c21vZHVsZV9jb25uZWN0KCk7CiAgICBpZiAocmMgIT0gUFRTTV9P
SykgewogICAgICAgICpyZXBseSA9ICJwdHNtb2R1bGVfY29ubmVjdCgpIGZhaWxlZCI7CiAgICAg
ICAgcmV0dXJuIHJjOwogICAgfQoKICAgIHJjID0gcHRzbW9kdWxlX2dldF9kbihjYW5vbl9pZCwg
c2l6ZSwgJmRuKTsKICAgIGlmIChyYyAhPSBQVFNNX09LKSB7CiAgICAgICAgKnJlcGx5ID0gImlk
ZW50aWZpZXIgbm90IGZvdW5kIjsKICAgICAgICBnb3RvIGRvbmU7CiAgICB9CgogICAgcmMgPSBs
ZGFwX3NlYXJjaF9zdChwdHNtLT5sZCwgZG4sIExEQVBfU0NPUEVfQkFTRSwgIihvYmplY3RjbGFz
cz0qKSIsIGF0dHJzLCAwLCAmKHB0c20tPnRpbWVvdXQpLCAmcmVzKTsKICAgIGlmICggcmMgIT0g
TERBUF9TVUNDRVNTICkgewogICAgICAgICpyZXBseSA9ICJsZGFwX3NlYXJjaChhdHRyaWJ1dGUp
IGZhaWxlZCI7CiAgICAgICAgaWYgKCByYyA9PSBMREFQX1NFUlZFUl9ET1dOICkgewogICAgICAg
ICAgICBsZGFwX3VuYmluZChwdHNtLT5sZCk7CiAgICAgICAgICAgIHB0c20tPmxkID0gTlVMTDsK
ICAgICAgICAgICAgcmMgPSBQVFNNX1JFVFJZOwogICAgICAgIH0gZWxzZQogICAgICAgICAgICBy
YyA9IFBUU01fRkFJTDsKICAgICAgICBnb3RvIGRvbmU7CiAgICB9CgogICAgaWYgKChlbnRyeSA9
IGxkYXBfZmlyc3RfZW50cnkocHRzbS0+bGQsIHJlcykpICE9IE5VTEwpIHsKICAgICAgICBmb3Ig
KGF0dHIgPSBsZGFwX2ZpcnN0X2F0dHJpYnV0ZShwdHNtLT5sZCwgZW50cnksICZiZXIpOyBhdHRy
ICE9IE5VTEw7IAogICAgICAgICAgICBhdHRyID0gbGRhcF9uZXh0X2F0dHJpYnV0ZShwdHNtLT5s
ZCwgZW50cnksIGJlcikpIHsKICAgICAgICAgICAgaW50IGksIG51bXZhbHM7CgogICAgICAgICAg
ICB2YWxzID0gbGRhcF9nZXRfdmFsdWVzKHB0c20tPmxkLCBlbnRyeSwgYXR0cik7CiAgICAgICAg
ICAgIGlmICh2YWxzID09IE5VTEwpCiAgICAgICAgICAgICAgICBjb250aW51ZTsKCiAgICAgICAg
ICAgIGZvciAoaSA9IDA7IHZhbHNbaV0gIT0gTlVMTDsgaSsrKQogICAgICAgICAgICAgICAgbnVt
dmFscyA9IGk7CiAgICAgICAgICAgIG51bXZhbHMrKzsKCiAgICAgICAgICAgICpkc2l6ZSA9IHNp
emVvZihzdHJ1Y3QgYXV0aF9zdGF0ZSkgKwogICAgICAgICAgICAgICAgICAgICAobnVtdmFscyAq
IHNpemVvZihzdHJ1Y3QgYXV0aF9pZGVudCkpOwogICAgICAgICAgICAqbmV3c3RhdGUgPSB4bWFs
bG9jKCpkc2l6ZSk7CiAgICAgICAgICAgIGlmICgqbmV3c3RhdGUgPT0gTlVMTCkgewogICAgICAg
ICAgICAgICAgKnJlcGx5ID0gIm5vIG1lbW9yeSI7CiAgICAgICAgICAgICAgICByYyA9IFBUU01f
RkFJTDsKICAgICAgICAgICAgICAgIGdvdG8gZG9uZTsKICAgICAgICAgICAgfQogICAgICAgICAg
ICAoKm5ld3N0YXRlKS0+bmdyb3VwcyA9IG51bXZhbHM7CgogICAgICAgICAgICBmb3IgKGkgPSAw
OyB2YWxzW2ldICE9IE5VTEw7IGkrKykgewogICAgICAgICAgICAgICAgc3RybGNweSgoKm5ld3N0
YXRlKS0+Z3JvdXBzW2ldLmlkLCB2YWxzW2ldLCAKICAgICAgICAgICAgICAgICAgICBzaXplb2Yo
KCpuZXdzdGF0ZSktPmdyb3Vwc1tpXS5pZCkpOwogICAgICAgICAgICAgICAgKCpuZXdzdGF0ZSkt
Pmdyb3Vwc1tpXS5oYXNoID0gc3RyaGFzaCgoKm5ld3N0YXRlKS0+Z3JvdXBzW2ldLmlkKTsKICAg
ICAgICAgICAgfQoKICAgICAgICAgICAgbGRhcF92YWx1ZV9mcmVlKHZhbHMpOwogICAgICAgICAg
ICB2YWxzID0gTlVMTDsKICAgICAgICAgICAgbGRhcF9tZW1mcmVlKGF0dHIpOwogICAgICAgICAg
ICBhdHRyID0gTlVMTDsKICAgICAgICB9CiAgICB9CgogICAgaWYoISpuZXdzdGF0ZSkgewogICAg
ICAgICpkc2l6ZSA9IHNpemVvZihzdHJ1Y3QgYXV0aF9zdGF0ZSk7CiAgICAgICAgKm5ld3N0YXRl
ID0geG1hbGxvYygqZHNpemUpOwogICAgICAgIGlmICgqbmV3c3RhdGUgPT0gTlVMTCkgewogICAg
ICAgICAgICAqcmVwbHkgPSAibm8gbWVtb3J5IjsKICAgICAgICAgICAgcmMgPSBQVFNNX0ZBSUw7
CiAgICAgICAgICAgIGdvdG8gZG9uZTsKICAgICAgICB9CiAgICAgICAgKCpuZXdzdGF0ZSktPm5n
cm91cHMgPSAwOwogICAgfQogICAgCiAgICAvKiBmaWxsIGluIHRoZSByZXN0IG9mIG91ciBuZXcg
c3RhdGUgc3RydWN0dXJlICovCiAgICBzdHJjcHkoKCpuZXdzdGF0ZSktPnVzZXJpZC5pZCwgY2Fu
b25faWQpOwogICAgKCpuZXdzdGF0ZSktPnVzZXJpZC5oYXNoID0gc3RyaGFzaChjYW5vbl9pZCk7
CiAgICAoKm5ld3N0YXRlKS0+bWFyayA9IHRpbWUoMCk7CgogICAgcmMgPSBQVFNNX09LOwoKZG9u
ZTo7CgogICAgaWYgKHJlcykKICAgICAgICBsZGFwX21zZ2ZyZWUocmVzKTsKICAgIGlmICh2YWxz
KQogICAgICAgIGxkYXBfdmFsdWVfZnJlZSh2YWxzKTsKICAgIGlmIChhdHRyKQogICAgICAgIGxk
YXBfbWVtZnJlZShhdHRyKTsKICAgIGlmIChiZXIpCiAgICAgICAgYmVyX2ZyZWUoYmVyLCAwKTsK
ICAgIGlmIChkbikKICAgICAgICBmcmVlKGRuKTsKCiAgICByZXR1cm4gcmM7Cn0KCnN0YXRpYyBp
bnQgcHRzbW9kdWxlX21ha2VfYXV0aHN0YXRlX2ZpbHRlcigKICAgIGNvbnN0IGNoYXIgKmNhbm9u
X2lkLAogICAgc2l6ZV90IHNpemUsCiAgICBjb25zdCBjaGFyICoqcmVwbHksIAogICAgaW50ICpk
c2l6ZSwKICAgIHN0cnVjdCBhdXRoX3N0YXRlICoqbmV3c3RhdGUpIAp7CiAgICBjaGFyICpiYXNl
ID0gTlVMTCwgKmZpbHRlciA9IE5VTEw7CiAgICBpbnQgcmM7CiAgICBpbnQgaTsgaW50IG47CiAg
ICBMREFQTWVzc2FnZSAqcmVzID0gTlVMTDsKICAgIExEQVBNZXNzYWdlICplbnRyeTsKICAgIGNo
YXIgKmF0dHIsICoqdmFsczsKICAgIEJlckVsZW1lbnQgKmJlciA9IE5VTEw7CiAgICBjaGFyICph
dHRyc1tdID0ge3B0c20tPm1lbWJlcl9hdHRyaWJ1dGUsTlVMTH07CiAgICBjaGFyICpkbiA9IE5V
TEw7CgogICAgcmMgPSBwdHNtb2R1bGVfY29ubmVjdCgpOwogICAgaWYgKHJjICE9IFBUU01fT0sp
IHsKICAgICAgICAqcmVwbHkgPSAicHRzbW9kdWxlX2Nvbm5lY3QoKSBmYWlsZWQiOwogICAgICAg
IHJldHVybiByYzsKICAgIH0KCiAgICByYyA9IHB0c21vZHVsZV9nZXRfZG4oY2Fub25faWQsIHNp
emUsICZkbik7CiAgICBpZiAocmMgIT0gUFRTTV9PSykgewogICAgICAgICpyZXBseSA9ICJpZGVu
dGlmaWVyIG5vdCBmb3VuZCI7CiAgICAgICAgcmV0dXJuIHJjOwogICAgfQoKICAgIHJjID0gcHRz
bW9kdWxlX2V4cGFuZF90b2tlbnMocHRzbS0+bWVtYmVyX2ZpbHRlciwgY2Fub25faWQsIGRuLCAm
ZmlsdGVyKTsKICAgIGlmIChyYyAhPSBQVFNNX09LKSB7CiAgICAgICAgKnJlcGx5ID0gInB0c21v
ZHVsZV9leHBhbmRfdG9rZW5zKCkgZmFpbGVkIGZvciBtZW1iZXIgZmlsdGVyIjsKICAgICAgICBn
b3RvIGRvbmU7CiAgICB9CgogICAgcmMgPSBwdHNtb2R1bGVfZXhwYW5kX3Rva2VucyhwdHNtLT5t
ZW1iZXJfYmFzZSwgY2Fub25faWQsIGRuLCAmYmFzZSk7CiAgICBpZiAocmMgIT0gUFRTTV9PSykg
ewogICAgICAgICpyZXBseSA9ICJwdHNtb2R1bGVfZXhwYW5kX3Rva2VucygpIGZhaWxlZCBmb3Ig
bWVtYmVyIHNlYXJjaCBiYXNlIjsKICAgICAgICBnb3RvIGRvbmU7CiAgICB9CgogICAgcmMgPSBs
ZGFwX3NlYXJjaF9zdChwdHNtLT5sZCwgYmFzZSwgcHRzbS0+bWVtYmVyX3Njb3BlLCBmaWx0ZXIs
IGF0dHJzLCAwLCAmKHB0c20tPnRpbWVvdXQpLCAmcmVzKTsKICAgIGlmIChyYyAhPSBMREFQX1NV
Q0NFU1MpIHsKICAgICAgICAqcmVwbHkgPSAibGRhcF9zZWFyY2goZmlsdGVyKSBmYWlsZWQiOwog
ICAgICAgIGlmIChyYyA9PSBMREFQX1NFUlZFUl9ET1dOKSB7CiAgICAgICAgICAgIGxkYXBfdW5i
aW5kKHB0c20tPmxkKTsKICAgICAgICAgICAgcHRzbS0+bGQgPSBOVUxMOwogICAgICAgICAgICBy
YyA9IFBUU01fUkVUUlk7CiAgICAgICAgfSBlbHNlCiAgICAgICAgICAgIHJjID0gUFRTTV9GQUlM
OwogICAgICAgIGdvdG8gZG9uZTsKICAgIH0KCiAgICBuID0gbGRhcF9jb3VudF9lbnRyaWVzKHB0
c20tPmxkLCByZXMpOwogICAgaWYgKG4gPCAwKSB7CiAgICAgICAgKnJlcGx5ID0gImxkYXBfY291
bnRfZW50cmllcygpIGZhaWxlZCI7CiAgICAgICAgcmMgPSBQVFNNX0ZBSUw7CiAgICAgICAgZ290
byBkb25lOwogICAgfQoKICAgICpkc2l6ZSA9IHNpemVvZihzdHJ1Y3QgYXV0aF9zdGF0ZSkgKwog
ICAgICAgICAgICAgKG4gKiBzaXplb2Yoc3RydWN0IGF1dGhfaWRlbnQpKTsKICAgICpuZXdzdGF0
ZSA9IHhtYWxsb2MoKmRzaXplKTsKICAgIGlmICgqbmV3c3RhdGUgPT0gTlVMTCkgewogICAgICAg
ICpyZXBseSA9ICJubyBtZW1vcnkiOwogICAgICAgIHJjID0gUFRTTV9GQUlMOwogICAgICAgIGdv
dG8gZG9uZTsKICAgIH0KICAgICgqbmV3c3RhdGUpLT5uZ3JvdXBzID0gbjsKICAgIHN0cmNweSgo
Km5ld3N0YXRlKS0+dXNlcmlkLmlkLCBjYW5vbl9pZCk7CiAgICAoKm5ld3N0YXRlKS0+dXNlcmlk
Lmhhc2ggPSBzdHJoYXNoKGNhbm9uX2lkKTsKICAgICgqbmV3c3RhdGUpLT5tYXJrID0gdGltZSgw
KTsKCiAgICBmb3IgKGkgPSAwLCBlbnRyeSA9IGxkYXBfZmlyc3RfZW50cnkocHRzbS0+bGQsIHJl
cyk7IGVudHJ5ICE9IE5VTEw7CiAgICAgICAgIGkrKywgZW50cnkgPSBsZGFwX25leHRfZW50cnko
cHRzbS0+bGQsIGVudHJ5KSkgewogICAgICAgIGZvciAoYXR0ciA9IGxkYXBfZmlyc3RfYXR0cmli
dXRlKHB0c20tPmxkLCBlbnRyeSwgJmJlcik7IGF0dHIgIT0gTlVMTDsgCiAgICAgICAgICAgIGF0
dHIgPSBsZGFwX25leHRfYXR0cmlidXRlKHB0c20tPmxkLCBlbnRyeSwgYmVyKSkgewoKICAgICAg
ICAgICAgdmFscyA9IGxkYXBfZ2V0X3ZhbHVlcyhwdHNtLT5sZCwgZW50cnksIGF0dHIpOwogICAg
ICAgICAgICBpZiAodmFscyA9PSBOVUxMKQogICAgICAgICAgICAgICAgY29udGludWU7CgogICAg
ICAgICAgICBzdHJsY3B5KCgqbmV3c3RhdGUpLT5ncm91cHNbaV0uaWQsIHZhbHNbMF0sIAogICAg
ICAgICAgICAgICAgc2l6ZW9mKCgqbmV3c3RhdGUpLT5ncm91cHNbaV0uaWQpKTsKICAgICAgICAg
ICAgKCpuZXdzdGF0ZSktPmdyb3Vwc1tpXS5oYXNoID0gc3RyaGFzaCgoKm5ld3N0YXRlKS0+Z3Jv
dXBzW2ldLmlkKTsKCiAgICAgICAgICAgIGxkYXBfdmFsdWVfZnJlZSh2YWxzKTsKICAgICAgICAg
ICAgdmFscyA9IE5VTEw7CiAgICAgICAgICAgIGxkYXBfbWVtZnJlZShhdHRyKTsKICAgICAgICAg
ICAgYXR0ciA9IE5VTEw7CiAgICAgICAgfQogICAgfQoKICAgIHJjID0gUFRTTV9PSzsKCmRvbmU6
OwoKICAgIGlmIChyZXMpCiAgICAgICAgbGRhcF9tc2dmcmVlKHJlcyk7CiAgICBpZiAoYmVyKQog
ICAgICAgIGJlcl9mcmVlKGJlciwgMCk7CiAgICBiZXIgPSBOVUxMOwogICAgaWYgKGRuKQogICAg
ICAgIGZyZWUoZG4pOwogICAgaWYgKGZpbHRlcikKICAgICAgICBmcmVlKGZpbHRlcik7CiAgICBp
ZiAoYmFzZSkKICAgICAgICBmcmVlKGJhc2UpOwoKICAgIHJldHVybiByYzsKfQoKc3RhdGljIGlu
dCBwdHNtb2R1bGVfbWFrZV9hdXRoc3RhdGVfZ3JvdXAoCiAgICBjb25zdCBjaGFyICpjYW5vbl9p
ZCwKICAgIHNpemVfdCBzaXplLAogICAgY29uc3QgY2hhciAqKnJlcGx5LCAKICAgIGludCAqZHNp
emUsCiAgICBzdHJ1Y3QgYXV0aF9zdGF0ZSAqKm5ld3N0YXRlKSAKewogICAgY2hhciAqYmFzZSA9
IE5VTEwsICpmaWx0ZXIgPSBOVUxMOwogICAgaW50IHJjOwogICAgaW50IGk7IGludCBuOwogICAg
TERBUE1lc3NhZ2UgKnJlczsKICAgIExEQVBNZXNzYWdlICplbnRyeTsKICAgIGNoYXIgKmF0dHIs
ICoqdmFsczsKICAgIGNoYXIgKmF0dHJzW10gPSB7TlVMTH07CgogICAgaWYgKHN0cm5jbXAoY2Fu
b25faWQsICJncm91cDoiLCA2KSkgIHsgLy8gU2FuaXR5IGNoZWNrCiAgICAgICAgKnJlcGx5ID0g
Im5vdCBhIGdyb3VwIGlkZW50aWZpZXIiOwogICAgICAgIHJldHVybiBQVFNNX0ZBSUw7CiAgICB9
CgogICAgcmMgPSBwdHNtb2R1bGVfY29ubmVjdCgpOwogICAgaWYgKHJjICE9IFBUU01fT0spIHsK
ICAgICAgICAqcmVwbHkgPSAicHRzbW9kdWxlX2Nvbm5lY3QoKSBmYWlsZWQiOwogICAgICAgIHJl
dHVybiByYzsKICAgIH0KCiAgICByYyA9IHB0c21vZHVsZV9leHBhbmRfdG9rZW5zKHB0c20tPmdy
b3VwX2ZpbHRlciwgY2Fub25faWQrNiwgTlVMTCwgJmZpbHRlcik7CiAgICBpZiAocmMgIT0gUFRT
TV9PSykgewogICAgICAgICpyZXBseSA9ICJwdHNtb2R1bGVfZXhwYW5kX3Rva2VucygpIGZhaWxl
ZCBmb3IgZ3JvdXAgZmlsdGVyIjsKICAgICAgICBnb3RvIGRvbmU7CiAgICB9CgogICAgcmMgPSBw
dHNtb2R1bGVfZXhwYW5kX3Rva2VucyhwdHNtLT5ncm91cF9iYXNlLCBjYW5vbl9pZCs2LCBOVUxM
LCAmYmFzZSk7CiAgICBpZiAocmMgIT0gUFRTTV9PSykgewogICAgICAgICpyZXBseSA9ICJwdHNt
b2R1bGVfZXhwYW5kX3Rva2VucygpIGZhaWxlZCBmb3IgZ3JvdXAgc2VhcmNoIGJhc2UiOwogICAg
ICAgIGdvdG8gZG9uZTsKICAgIH0KCiAgICByYyA9IGxkYXBfc2VhcmNoX3N0KHB0c20tPmxkLCBi
YXNlLCBwdHNtLT5ncm91cF9zY29wZSwgZmlsdGVyLCBhdHRycywgMCwgJihwdHNtLT50aW1lb3V0
KSwgJnJlcyk7CiAgICBpZiAocmMgIT0gTERBUF9TVUNDRVNTKSB7CiAgICAgICAgKnJlcGx5ID0g
ImxkYXBfc2VhcmNoKGdyb3VwKSBmYWlsZWQiOwogICAgICAgIGlmIChyYyA9PSBMREFQX1NFUlZF
Ul9ET1dOKSB7CiAgICAgICAgICAgIGxkYXBfdW5iaW5kKHB0c20tPmxkKTsKICAgICAgICAgICAg
cHRzbS0+bGQgPSBOVUxMOwogICAgICAgICAgICByYyA9IFBUU01fUkVUUlk7CiAgICAgICAgfSBl
bHNlCiAgICAgICAgICAgIHJjID0gUFRTTV9GQUlMOwogICAgICAgIGdvdG8gZG9uZTsKICAgIH0K
CiAgICBuID0gbGRhcF9jb3VudF9lbnRyaWVzKHB0c20tPmxkLCByZXMpOwogICAgaWYgKG4gIT0g
MSkgewogICAgICAgICpyZXBseSA9ICJncm91cCBpZGVudGlmaWVyIG5vdCBmb3VuZCI7CiAgICAg
ICAgcmMgPSBQVFNNX0ZBSUw7CiAgICAgICAgZ290byBkb25lOwogICAgfQoKICAgICpkc2l6ZSA9
IHNpemVvZihzdHJ1Y3QgYXV0aF9zdGF0ZSkgKwogICAgICAgICAgICAgKG4gKiBzaXplb2Yoc3Ry
dWN0IGF1dGhfaWRlbnQpKTsKICAgICpuZXdzdGF0ZSA9IHhtYWxsb2MoKmRzaXplKTsKICAgIGlm
ICgqbmV3c3RhdGUgPT0gTlVMTCkgewogICAgICAgICpyZXBseSA9ICJubyBtZW1vcnkiOwogICAg
ICAgIHJjID0gUFRTTV9GQUlMOwogICAgICAgIGdvdG8gZG9uZTsKICAgIH0KICAgICgqbmV3c3Rh
dGUpLT5uZ3JvdXBzID0gMDsKICAgIHN0cmNweSgoKm5ld3N0YXRlKS0+dXNlcmlkLmlkLCBjYW5v
bl9pZCk7CiAgICAoKm5ld3N0YXRlKS0+dXNlcmlkLmhhc2ggPSBzdHJoYXNoKGNhbm9uX2lkKTsK
ICAgICgqbmV3c3RhdGUpLT5tYXJrID0gdGltZSgwKTsKCiAgICByYyA9IFBUU01fT0s7Cgpkb25l
OjsKCiAgICBpZiAocmVzKQogICAgICAgIGxkYXBfbXNnZnJlZShyZXMpOwogICAgaWYgKGZpbHRl
cikKICAgICAgICBmcmVlKGZpbHRlcik7CiAgICBpZiAoYmFzZSkKICAgICAgICBmcmVlKGJhc2Up
OwoKICAgIHJldHVybiByYzsKfQoKc3RydWN0IGF1dGhfc3RhdGUgKnB0c21vZHVsZV9tYWtlX2F1
dGhzdGF0ZSgKICAgIGNvbnN0IGNoYXIgKmlkZW50aWZpZXIsCiAgICBzaXplX3Qgc2l6ZSwKICAg
IGNvbnN0IGNoYXIgKipyZXBseSwgCiAgICBpbnQgKmRzaXplKSAKewogICAgY29uc3QgY2hhciAq
Y2Fub25faWQ7CiAgICBzdHJ1Y3QgYXV0aF9zdGF0ZSAqbmV3c3RhdGUgPSBOVUxMOwogICAgaW50
IHJjOwogICAgaW50IHJldHJpZXMgPSAxOwoKICAgIGNhbm9uX2lkID0gcHRzbW9kdWxlX2Nhbm9u
aWZ5aWQoaWRlbnRpZmllciwgc2l6ZSk7CiAgICBpZiAoRU1QVFkoY2Fub25faWQpKSB7CiAgICAg
ICAgKnJlcGx5ID0gInB0c21vZHVsZV9jYW5vbmlmeWlkKCkgZmFpbGVkIjsKICAgICAgICByZXR1
cm4gTlVMTDsKICAgIH0KICAgIHNpemUgPSBzdHJsZW4oY2Fub25faWQpOwoKcmV0cnk6OwoKICAg
ICpyZXBseSA9IE5VTEw7CgogICAgaWYgKCFzdHJuY21wKGNhbm9uX2lkLCAiZ3JvdXA6IiwgNikp
CiAgICAgICAgcmMgPSBwdHNtb2R1bGVfbWFrZV9hdXRoc3RhdGVfZ3JvdXAoY2Fub25faWQsIHNp
emUsIHJlcGx5LCBkc2l6ZSwgJm5ld3N0YXRlKTsKICAgIGVsc2UgewogICAgICAgIGlmIChwdHNt
LT5tZW1iZXJfbWV0aG9kID09IFBUU01fTUVNQkVSX01FVEhPRF9BVFRSSUJVVEUpCiAgICAgICAg
ICAgIHJjID0gcHRzbW9kdWxlX21ha2VfYXV0aHN0YXRlX2F0dHJpYnV0ZShjYW5vbl9pZCwgc2l6
ZSwgcmVwbHksIGRzaXplLCAmbmV3c3RhdGUpOwogICAgICAgIGVsc2UKICAgICAgICAgICAgcmMg
PSBwdHNtb2R1bGVfbWFrZV9hdXRoc3RhdGVfZmlsdGVyKGNhbm9uX2lkLCBzaXplLCByZXBseSwg
ZHNpemUsICZuZXdzdGF0ZSk7CiAgICB9CiAgICBpZiAocmMgPT0gUFRTTV9SRVRSWSAmJgogICAg
ICAgIHJldHJpZXMpIHsKICAgICAgICByZXRyaWVzLS07CiAgICAgICAgZ290byByZXRyeTsKICAg
IH0KCiAgICByZXR1cm4gbmV3c3RhdGU7Cn0K
</data>        

          </attachment>
      

    </bug>

</bugzilla>