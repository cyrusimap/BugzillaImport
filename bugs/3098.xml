<?xml version="1.0" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugzilla.cyrusimap.org/bugzilla.dtd">

<bugzilla version="3.2.5.1-2"
          urlbase="https://bugzilla.cyrusimap.org/"
          maintainer="Dave McMurtrie &lt;dave64@andrew.cmu.edu&gt;"
>

    <bug>
          <bug_id>3098</bug_id>
          
          <creation_ts>2008-10-06 11:57 EDT</creation_ts>
          <short_desc>new managesieve breaks existing clients and proxying</short_desc>
          <delta_ts>2010-10-25 18:46:47 EDT</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Cyrus IMAP</product>
          <component>Sieve</component>
          <version>2.3.x</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>CLOSED</bug_status>
          <resolution>FIXED</resolution>
          
          
          
          
          <priority>P5</priority>
          <bug_severity>blocker</bug_severity>
          <target_milestone>Future</target_milestone>
          
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Wes Craig">wes@umich.edu</reporter>
          <assigned_to name="Ken Murchison">murch@andrew.cmu.edu</assigned_to>
          
          

      

      

      
          <long_desc isprivate="0">
            <who name="Wes Craig">wes@umich.edu</who>
            <bug_when>2008-10-06 11:57:59 EDT</bug_when>
            <thetext>Created an attachment (id=1030)
make sieve sasl capability response optional

The SASL &amp; STARTTLS behavior defined in more recent internet drafts breaks backwards compatibility with a number of sieve clients.  Moreover, if proxy sieve is enabled, the new behavior makes incremental update of frontends &amp; backends impossible.</thetext>
          </long_desc>
          <long_desc isprivate="0">
            <who name="Wes Craig">wes@umich.edu</who>
            <bug_when>2008-10-06 11:59:13 EDT</bug_when>
            <thetext>Do we want similar options for STARTTLS?  I gather it has the same issues, but I&apos;m get the impression that the standard hasn&apos;t flip-flopped quite so much.</thetext>
          </long_desc>
          <long_desc isprivate="0">
            <who name="Ken Murchison">murch@andrew.cmu.edu</who>
            <bug_when>2008-10-08 11:54:33 EDT</bug_when>
            <thetext>Let&apos;s do the minimum needed for backwards compat</thetext>
          </long_desc>
          <long_desc isprivate="0">
            <who name="Wes Craig">wes@umich.edu</who>
            <bug_when>2008-10-08 13:34:18 EDT</bug_when>
            <thetext>Committed:
http://bugzilla.andrew.cmu.edu/cgi-bin/cvsweb.cgi/src/cyrus/timsieved/parser.c.diff?r1=1.50&amp;r2=1.51
http://bugzilla.andrew.cmu.edu/cgi-bin/cvsweb.cgi/src/cyrus/lib/imapoptions.diff?r1=1.58&amp;r2=1.59
</thetext>
          </long_desc>
          <long_desc isprivate="0">
            <who name="Ken Murchison">murch@andrew.cmu.edu</who>
            <bug_when>2008-12-11 17:42:22 EDT</bug_when>
            <thetext>Created an attachment (id=1048)
client side auto-detect of ManageSieve auto-capability response

The previous patch solves the timsieved issues, but didn&apos;t fix sieveshell (which we found out the hard way).  The new patch has all ManageSieve client code (sieveshell, imtest, timsieved) &quot;peek&quot; for the automatic capability response.  If it exists, we use it.  Otherwise the capabilities are explicitly asked for.  This obsoletes the sieve_sasl_expect_unsolicited_capability option.

The patch also solves a problem where the prot_stream would buffer encrypted data before the SASL context was hooked into the prot_stream.</thetext>
          </long_desc>
          <long_desc isprivate="0">
            <who name="Wes Craig">wes@umich.edu</who>
            <bug_when>2008-12-18 22:27:08 EDT</bug_when>
            <thetext>Some comments &amp; questions:

. Should the MITM syslog be LOG_AUTH?  Since you&apos;re dropping the connection, I would think it should be at least LOG_ERR as opposed to LOG_WARNING.  Lots of sites only log LOG_ERR or above.  I might argue that it&apos;s LOG_CRIT or LOG_ALERT.

. What provision is there for eventually removing the sieve autocapa detection hack?

Otherwise, the code changes look good.</thetext>
          </long_desc>
          <long_desc isprivate="0">
            <who name="Ken Murchison">murch@andrew.cmu.edu</who>
            <bug_when>2009-01-14 10:57:15 EDT</bug_when>
            <thetext>Change the syslog() to LOG_ERR and committed the patch.

I don&apos;t know what provision we can make unless we get a protocol change the explicitly tells us that the server does auto-capa.  Otherwise, we can probably remove the hack down the road when we feel that we only have auto-capa servers in the wild.</thetext>
          </long_desc>
      
          <attachment
              isobsolete="1"
              ispatch="1"
              isprivate="0"
          >
            <attachid>1030</attachid>
            <date>2008-10-06 11:57 EDT</date>
            <desc>make sieve sasl capability response optional</desc>
            <filename>cyrus-imapd-timesieved-capability.diff</filename>
            <type>text/plain</type>
            <size>1812</size>
            <attacher>wes@umich.edu</attacher>
            
              <data encoding="base64">LS0tIGxpYi9pbWFwb3B0aW9ucwkyNyBBdWcgMjAwOCAwODoyODo0NyAtMDAwMAkxLjU1CisrKyBs
aWIvaW1hcG9wdGlvbnMJMzAgU2VwIDIwMDggMjE6MjY6NTYgLTAwMDAKQEAgLTkyNyw3ICs5NDcs
MTUgQEAKIHsgInNpZXZlX21heHNjcmlwdHMiLCA1LCBJTlQgfQogLyogTWF4aW11bSBudW1iZXIg
b2Ygc2lldmUgc2NyaXB0cyBhbnkgdXNlciBtYXkgaGF2ZSwgZW5mb3JjZWQgYXQKICAgIHN1Ym1p
c3Npb24gYnkgdGltc2lldmVkKDgpLiAqLwotICAgCisKK3sgInNpZXZlX3Nhc2xfc2VuZF91bnNv
bGljaXRlZF9jYXBhYmlsaXR5IiwgMCwgU1dJVENIIH0KKy8qIElmIGVuYWJsZWQsIHRpbXNpZXZl
ZCB3aWxsIGVtaXQgYSBjYXBhYmlsaXR5IHJlc3BvbnNlIGFmdGVyIGEgc3VjY2Vzc2Z1bAorICAg
U0FTTCBhdXRoZW50aWNhdGlvbiwgcGVyIGRyYWZ0LW1hcnRpbi1tYW5hZ2VzaWV2ZS0xMi50eHQg
LiAqLworCit7ICJzaWV2ZV9zYXNsX2V4cGVjdF91bnNvbGljaXRlZF9jYXBhYmlsaXR5IiwgMCwg
U1dJVENIIH0KKy8qIElmIGVuYWJsZWQsIHRpbXNpZXZlZCB3aWxsIGV4cGVjdCBhIGNhcGFiaWxp
dHkgcmVzcG9uc2UgYWZ0ZXIgYSBzdWNjZXNzZnVsCisgICBTQVNMIGF1dGhlbnRpY2F0aW9uLCBw
ZXIgZHJhZnQtbWFydGluLW1hbmdlc2lldmUtMTIudHh0IC4gKi8KKwogeyAic2lldmVkaXIiLCAi
L3Vzci9zaWV2ZSIsIFNUUklORyB9CiAvKiBJZiBzaWV2ZXVzZWhvbWVkaXIgaXMgZmFsc2UsIHRo
aXMgZGlyZWN0b3J5IGlzIHNlYXJjaGVkIGZvciBTaWV2ZQogICAgc2NyaXB0cy4gKi8KLS0tIHRp
bXNpZXZlZC9wYXJzZXIuYwkyMiBBcHIgMjAwOCAxMzoxMToxOSAtMDAwMAkxLjUwCisrKyB0aW1z
aWV2ZWQvcGFyc2VyLmMJMzAgU2VwIDIwMDggMjE6MjY6NTcgLTAwMDAKQEAgLTc3MCw2ICs3NzAs
MTEgQEAKIAkJICBpZihjKSAqYyA9ICdcMCc7CiAJICAgICAgfQogCisJICAgICAgaWYgKGNvbmZp
Z19nZXRzd2l0Y2goSU1BUE9QVF9TSUVWRV9TQVNMX0VYUEVDVF9VTlNPTElDSVRFRF9DQVBBQklM
SVRZKSkgeworCQkgIHNpZXZlX3Byb3RvY29sLnNhc2xfY21kLmF1dG9fY2FwYSA9IDE7CisJICAg
ICAgfSBlbHNlIHsKKwkJICBzaWV2ZV9wcm90b2NvbC5zYXNsX2NtZC5hdXRvX2NhcGEgPSAwOwor
CSAgICAgIH0KIAkgICAgICBiYWNrZW5kID0gYmFja2VuZF9jb25uZWN0KE5VTEwsIHNlcnZlciwg
JnNpZXZlX3Byb3RvY29sLAogCQkJCQl1c2VybmFtZSwgTlVMTCwgJnN0YXR1c2xpbmUpOwogCkBA
IC04MjAsOSArODI1LDExIEBACiAgIHByb3Rfc2V0c2FzbChzaWV2ZWRfaW4sIHNpZXZlZF9zYXNs
Y29ubik7CiAgIHByb3Rfc2V0c2FzbChzaWV2ZWRfb3V0LCBzaWV2ZWRfc2FzbGNvbm4pOwogCi0g
IHNhc2xfZ2V0cHJvcChzaWV2ZWRfc2FzbGNvbm4sIFNBU0xfU1NGLCAmc2FzbF9zc2YpOwotICBp
ZiAoKigoc2FzbF9zc2ZfdCAqKSBzYXNsX3NzZikpIHsKLSAgICAgIGNhcGFiaWxpdGllcyhzaWV2
ZWRfb3V0LCBzaWV2ZWRfc2FzbGNvbm4sIHN0YXJ0dGxzX2RvbmUsIDIpOworICBpZiAoY29uZmln
X2dldHN3aXRjaChJTUFQT1BUX1NJRVZFX1NBU0xfU0VORF9VTlNPTElDSVRFRF9DQVBBQklMSVRZ
KSkgeworICAgICAgc2FzbF9nZXRwcm9wKHNpZXZlZF9zYXNsY29ubiwgU0FTTF9TU0YsICZzYXNs
X3NzZik7CisgICAgICBpZiAoKigoc2FzbF9zc2ZfdCAqKSBzYXNsX3NzZikpIHsKKwkgIGNhcGFi
aWxpdGllcyhzaWV2ZWRfb3V0LCBzaWV2ZWRfc2FzbGNvbm4sIHN0YXJ0dGxzX2RvbmUsIDIpOwor
ICAgICAgfQogICB9CiAKICAgLyogQ3JlYXRlIHRlbGVtZXRyeSBsb2cgKi8K
</data>        

          </attachment>
          <attachment
              isobsolete="0"
              ispatch="1"
              isprivate="0"
          >
            <attachid>1048</attachid>
            <date>2008-12-11 17:42 EDT</date>
            <desc>client side auto-detect of ManageSieve auto-capability response</desc>
            <filename>managesieve_autocapa.diff</filename>
            <type>text/plain</type>
            <size>15672</size>
            <attacher>murch@andrew.cmu.edu</attacher>
            
              <data encoding="base64">SW5kZXg6IGltYXAvYmFja2VuZC5jCj09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KUkNTIGZpbGU6IC9hZnMvYW5kcmV3L3N5
c3RlbS9jdnMvc3JjL2N5cnVzL2ltYXAvYmFja2VuZC5jLHYKcmV0cmlldmluZyByZXZpc2lvbiAx
LjU3CmRpZmYgLXUgLXIxLjU3IGJhY2tlbmQuYwotLS0gaW1hcC9iYWNrZW5kLmMJOCBPY3QgMjAw
OCAxMzoxMjo0MSAtMDAwMAkxLjU3CisrKyBpbWFwL2JhY2tlbmQuYwkxMSBEZWMgMjAwOCAyMjoz
Mjo1MCAtMDAwMApAQCAtMjcwLDE2ICsyNzAsOCBAQAogICAgIGlmIChsb2NhbF9jYikgZnJlZV9j
YWxsYmFja3MoY2IpOwogCiAgICAgaWYgKHIgPT0gU0FTTF9PSykgewotCWNvbnN0IHZvaWQgKnNz
ZjsKLQogCXByb3Rfc2V0c2FzbChzLT5pbiwgcy0+c2FzbGNvbm4pOwogCXByb3Rfc2V0c2FzbChz
LT5vdXQsIHMtPnNhc2xjb25uKTsKLQotCXNhc2xfZ2V0cHJvcChzLT5zYXNsY29ubiwgU0FTTF9T
U0YsICZzc2YpOwotCWlmICgqKChzYXNsX3NzZl90ICopIHNzZikgJiYgcHJvdC0+c2FzbF9jbWQu
YXV0b19jYXBhKSB7Ci0JICAgIGZyZWUoKm1lY2hsaXN0KTsKLQkgICAgKm1lY2hsaXN0ID0gYXNr
X2NhcGFiaWxpdHkocy0+b3V0LCBzLT5pbiwgcHJvdCwgJnMtPmNhcGFiaWxpdHksIDEpOwotCX0K
ICAgICB9CiAKICAgICAvKiByID09IFNBU0xfT0sgb24gc3VjY2VzcyAqLwpAQCAtNDMxLDcgKzQy
Myw5IEBACiAgICAgaWYgKChzZXJ2ZXJbMF0gIT0gJy8nKSB8fAogCShzdHJjbXAocHJvdC0+c2Fz
bF9zZXJ2aWNlLCAibG10cCIpICYmCiAJIHN0cmNtcChwcm90LT5zYXNsX3NlcnZpY2UsICJjc3lu
YyIpKSkgewotCWlmICgociA9IGJhY2tlbmRfYXV0aGVudGljYXRlKHJldCwgcHJvdCwgJm1lY2hs
aXN0LCB1c2VyaWQsCisJY2hhciAqbWxpc3QgPSB4c3RyZHVwKG1lY2hsaXN0KTsgLyogYmFja2Vu
ZF9hdXRoIGlzIGRlc3RydWN0aXZlICovCisKKwlpZiAoKHIgPSBiYWNrZW5kX2F1dGhlbnRpY2F0
ZShyZXQsIHByb3QsICZtbGlzdCwgdXNlcmlkLAogCQkJCSAgICAgIGNiLCBhdXRoX3N0YXR1cykp
KSB7CiAJICAgIHN5c2xvZyhMT0dfRVJSLCAiY291bGRuJ3QgYXV0aGVudGljYXRlIHRvIGJhY2tl
bmQgc2VydmVyOiAlcyIsCiAJCSAgIHNhc2xfZXJyc3RyaW5nKHIsIE5VTEwsIE5VTEwpKTsKQEAg
LTQzOSw2ICs0MzMsNTAgQEAKIAkgICAgY2xvc2Uoc29jayk7CiAJICAgIHJldCA9IE5VTEw7CiAJ
fQorCWVsc2UgeworCSAgICBjb25zdCB2b2lkICpzc2Y7CisKKwkgICAgc2FzbF9nZXRwcm9wKHJl
dC0+c2FzbGNvbm4sIFNBU0xfU1NGLCAmc3NmKTsKKwkgICAgaWYgKCooKHNhc2xfc3NmX3QgKikg
c3NmKSkgeworCQkvKiBpZiB3ZSBoYXZlIGEgU0FTTCBzZWN1cml0eSBsYXllciwgY29tcGFyZSBT
QVNMIG1lY2ggbGlzdHMKKwkJICAgdG8gY2hlY2sgZm9yIGEgTUlUTSBhdHRhY2sgKi8KKwkJY2hh
ciAqbmV3X21lY2hsaXN0OworCQlpbnQgYXV0b19jYXBhID0gcHJvdC0+c2FzbF9jbWQuYXV0b19j
YXBhOworCisJCWlmICghc3RyY21wKHByb3QtPnNlcnZpY2UsICJzaWV2ZSIpKSB7CisJCSAgICAv
KiBYWFggIEhhY2sgdG8gaGFuZGxlIE1hbmFnZVNpZXZlIHNlcnZlcnMuCisJCSAgICAgKiBObyB3
YXkgdG8gdGVsbCBmcm9tIHByb3RvY29sIGlmIHNlcnZlciB3aWxsCisJCSAgICAgKiBhdXRvbWF0
aWNhbGx5IHNlbmQgY2FwYWJpbGl0aWVzLCBzbyB3ZSB0cmVhdCBpdAorCQkgICAgICogYXMgb3B0
aW9uYWwuCisJCSAgICAgKi8KKwkJICAgIGNoYXIgY2g7CisKKwkJICAgIC8qIHdhaXQgYW5kIHBy
b2JlIGZvciBwb3NzaWJsZSBhdXRvLWNhcGFiaWxpdHkgcmVzcG9uc2UgKi8KKwkJICAgIHVzbGVl
cCgyNTAwMDApOworCQkgICAgcHJvdF9OT05CTE9DSyhyZXQtPmluKTsKKwkJICAgIGlmICgoY2gg
PSBwcm90X2dldGMocmV0LT5pbikpICE9IEVPRikgeworCQkJcHJvdF91bmdldGMoY2gsIHJldC0+
aW4pOworCQkgICAgfSBlbHNlIHsKKwkJCWF1dG9fY2FwYSA9IEFVVE9fTk87CisJCSAgICB9CisJ
CSAgICBwcm90X0JMT0NLKHJldC0+aW4pOworCQl9CisKKwkJbmV3X21lY2hsaXN0ID0gYXNrX2Nh
cGFiaWxpdHkocmV0LT5vdXQsIHJldC0+aW4sIHByb3QsCisJCQkJCSAgICAgICZyZXQtPmNhcGFi
aWxpdHksIGF1dG9fY2FwYSk7CisJCWlmIChuZXdfbWVjaGxpc3QgJiYgc3RyY21wKG5ld19tZWNo
bGlzdCwgbWVjaGxpc3QpKSB7CisJCSAgICBzeXNsb2coTE9HX1dBUk5JTkcsICJwb3NzaWJsZSBN
SVRNIGF0dGFjaDoiCisJCQkgICAibGlzdCBvZiBhdmFpbGFibGUgU0FTTCBtZWNoYW5pc21zIGNo
YW5nZWQiKTsKKwkJICAgIGlmICghcmV0X2JhY2tlbmQpIGZyZWUocmV0KTsKKwkJICAgIGNsb3Nl
KHNvY2spOworCQkgICAgcmV0ID0gTlVMTDsKKwkJfQorCisJCWZyZWUobmV3X21lY2hsaXN0KTsK
KwkgICAgfQorCX0KKworCWlmIChtbGlzdCkgZnJlZShtbGlzdCk7CiAgICAgfQogCiAgICAgaWYg
KG1lY2hsaXN0KSBmcmVlKG1lY2hsaXN0KTsKSW5kZXg6IGltdGVzdC9pbXRlc3QuYwo9PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09ClJDUyBmaWxlOiAvYWZzL2FuZHJldy9zeXN0ZW0vY3ZzL3NyYy9jeXJ1cy9pbXRlc3QvaW10
ZXN0LmMsdgpyZXRyaWV2aW5nIHJldmlzaW9uIDEuMTIzCmRpZmYgLXUgLXIxLjEyMyBpbXRlc3Qu
YwotLS0gaW10ZXN0L2ltdGVzdC5jCTI1IE5vdiAyMDA4IDE1OjE3OjE0IC0wMDAwCTEuMTIzCisr
KyBpbXRlc3QvaW10ZXN0LmMJMTEgRGVjIDIwMDggMjI6MzI6NTAgLTAwMDAKQEAgLTI2MzAsNyAr
MjYzMCw2IEBACiAJfQogCQogCWlmIChyb2NrKSBmcmVlKHJvY2spOwotCWlmIChtZWNobGlzdCkg
ZnJlZShtZWNobGlzdCk7CiAJCiAJaWYgKHJlc3VsdCA9PSBJTVRFU1RfT0spIHsKIAkgICAgcHJp
bnRmKCJBdXRoZW50aWNhdGVkLlxuIik7CkBAIC0yNjUxLDE1ICsyNjUwLDQxIEBACiAJfSBlbHNl
IHsKIAkgICAgcHJpbnRmKCJTZWN1cml0eSBzdHJlbmd0aCBmYWN0b3I6ICVkXG4iLCBleHRfc3Nm
ICsgc3NmKTsKIAotCSAgICBpZiAoc3NmICYmIHByb3RvY29sLT5zYXNsX2NtZC5hdXRvX2NhcGEp
IHsKKwkgICAgaWYgKHNzZikgewogCQkvKiBhc2sgZm9yIHRoZSBjYXBhYmlsaXRpZXMgYWdhaW4g
Ki8KKwkJY2hhciAqbmV3X21lY2hsaXN0OworCiAJCWlmICh2ZXJib3NlPT0xKQogCQkgICAgcHJp
bnRmKCJBc2tpbmcgZm9yIGNhcGFiaWxpdGllcyBhZ2FpbiAiCiAJCQkgICAic2luY2UgdGhleSBt
aWdodCBoYXZlIGNoYW5nZWRcbiIpOwotCQltZWNobGlzdCA9IGFza19jYXBhYmlsaXR5KHByb3Rv
Y29sLCAmc2VydmVyX3N1cHBvcnRzX3RscywgMSk7Ci0JCWlmIChtZWNobGlzdCkgZnJlZShtZWNo
bGlzdCk7CisJCWlmICghc3RyY21wKHByb3RvY29sLT5wcm90b2NvbCwgInNpZXZlIikpIHsKKwkJ
ICAgIC8qIFhYWCAgSGFjayB0byBoYW5kbGUgTWFuYWdlU2lldmUgc2VydmVycy4KKwkJICAgICAq
IE5vIHdheSB0byB0ZWxsIGZyb20gcHJvdG9jb2wgaWYgc2VydmVyIHdpbGwKKwkJICAgICAqIGF1
dG9tYXRpY2FsbHkgc2VuZCBjYXBhYmlsaXRpZXMsIHNvIHdlIHRyZWF0IGl0CisJCSAgICAgKiBh
cyBvcHRpb25hbC4KKwkJICAgICAqLworCQkgICAgY2hhciBjaDsKKworCQkgICAgLyogd2FpdCBh
bmQgcHJvYmUgZm9yIHBvc3NpYmxlIGF1dG8tY2FwYWJpbGl0eSByZXNwb25zZSovCisJCSAgICB1
c2xlZXAoMjUwMDAwKTsKKwkJICAgIHByb3RfTk9OQkxPQ0socGluKTsKKwkJICAgIGlmICgoY2gg
PSBwcm90X2dldGMocGluKSkgIT0gRU9GKSB7CisJCQlwcm90X3VuZ2V0YyhjaCwgcGluKTsKKwkJ
ICAgIH0gZWxzZSB7CisJCQlwcm90b2NvbC0+c2FzbF9jbWQuYXV0b19jYXBhID0gMDsKKwkJICAg
IH0KKwkJICAgIHByb3RfQkxPQ0socGluKTsKKwkJfQorCQluZXdfbWVjaGxpc3QgPSBhc2tfY2Fw
YWJpbGl0eShwcm90b2NvbCwgJnNlcnZlcl9zdXBwb3J0c190bHMsCisJCQkJCSAgICAgIHByb3Rv
Y29sLT5zYXNsX2NtZC5hdXRvX2NhcGEpOworCQlpZiAobmV3X21lY2hsaXN0ICYmIHN0cmNtcChu
ZXdfbWVjaGxpc3QsIG1lY2hsaXN0KSkgeworCQkgICAgcHJpbnRmKCJXQVJOSU5HOiBwb3NzaWJs
ZSBNSVRNIGF0dGFjazogIgorCQkJICAgImxpc3Qgb2YgYXZhaWxhYmxlIFNBU0wgbWVjaGFuaXNt
cyBjaGFuZ2VkXG4iKTsKKwkJICAgIGZyZWUobmV3X21lY2hsaXN0KTsKKwkJfQogCSAgICB9CiAJ
fQorCWlmIChtZWNobGlzdCkgZnJlZShtZWNobGlzdCk7CiAKICAgICB9IHdoaWxlICgtLXJlYXV0
aCk7CiAKSW5kZXg6IGxpYi9pbWFwb3B0aW9ucwo9PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09ClJDUyBmaWxlOiAvYWZzL2Fu
ZHJldy9zeXN0ZW0vY3ZzL3NyYy9jeXJ1cy9saWIvaW1hcG9wdGlvbnMsdgpyZXRyaWV2aW5nIHJl
dmlzaW9uIDEuNTkKZGlmZiAtdSAtcjEuNTkgaW1hcG9wdGlvbnMKLS0tIGxpYi9pbWFwb3B0aW9u
cwk4IE9jdCAyMDA4IDE3OjE4OjEyIC0wMDAwCTEuNTkKKysrIGxpYi9pbWFwb3B0aW9ucwkxMSBE
ZWMgMjAwOCAyMjozMjo1MCAtMDAwMApAQCAtOTQ0LDEwICs5NDQsNiBAQAogLyogSWYgZW5hYmxl
ZCwgdGltc2lldmVkIHdpbGwgZW1pdCBhIGNhcGFiaWxpdHkgcmVzcG9uc2UgYWZ0ZXIgYSBzdWNj
ZXNzZnVsCiAgICBTQVNMIGF1dGhlbnRpY2F0aW9uLCBwZXIgZHJhZnQtbWFydGluLW1hbmFnZXNp
ZXZlLTEyLnR4dCAuICovCiAKLXsgInNpZXZlX3Nhc2xfZXhwZWN0X3Vuc29saWNpdGVkX2NhcGFi
aWxpdHkiLCAwLCBTV0lUQ0ggfQotLyogSWYgZW5hYmxlZCwgdGltc2lldmVkIHdpbGwgZXhwZWN0
IGEgY2FwYWJpbGl0eSByZXNwb25zZSBhZnRlciBhIHN1Y2Nlc3NmdWwKLSAgIFNBU0wgYXV0aGVu
dGljYXRpb24sIHBlciBkcmFmdC1tYXJ0aW4tbWFuZ2VzaWV2ZS0xMi50eHQgLiAqLwotCiB7ICJz
aWV2ZWRpciIsICIvdXNyL3NpZXZlIiwgU1RSSU5HIH0KIC8qIElmIHNpZXZldXNlaG9tZWRpciBp
cyBmYWxzZSwgdGhpcyBkaXJlY3RvcnkgaXMgc2VhcmNoZWQgZm9yIFNpZXZlCiAgICBzY3JpcHRz
LiAqLwpJbmRleDogbGliL3Byb3QuYwo9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09ClJDUyBmaWxlOiAvYWZzL2FuZHJldy9z
eXN0ZW0vY3ZzL3NyYy9jeXJ1cy9saWIvcHJvdC5jLHYKcmV0cmlldmluZyByZXZpc2lvbiAxLjk0
CmRpZmYgLXUgLXIxLjk0IHByb3QuYwotLS0gbGliL3Byb3QuYwkyNCBNYXIgMjAwOCAxNzo0Mzow
OSAtMDAwMAkxLjk0CisrKyBsaWIvcHJvdC5jCTExIERlYyAyMDA4IDIyOjMyOjUwIC0wMDAwCkBA
IC0xNTQsNiArMTU0LDUwIEBACiAjZW5kaWYgLyogSEFWRV9TU0wgKi8KIAogLyoKKyAqIERlY29k
ZSBkYXRhIHNlbnQgdmlhIGEgU0FTTCBzZWN1cml0eSBsYXllci4gUmV0dXJucyBFT0Ygb24gZXJy
b3IuCisgKi8KK2ludCBwcm90X3Nhc2xkZWNvZGUoc3RydWN0IHByb3RzdHJlYW0gKnMsIGludCBu
KQoreworICAgIGludCByZXN1bHQ7CisgICAgY29uc3QgY2hhciAqb3V0OworICAgIHVuc2lnbmVk
IG91dGxlbjsKKyAgICAKKyAgICBhc3NlcnQoIXMtPndyaXRlKTsKKworICAgIC8qIGRlY29kZSB0
aGUgaW5wdXQgKi8KKyAgICByZXN1bHQgPSBzYXNsX2RlY29kZShzLT5jb25uLCAoY29uc3QgY2hh
ciAqKSBzLT5idWYsIG4sIAorCQkJICZvdXQsICZvdXRsZW4pOworCisgICAgaWYgKHJlc3VsdCAh
PSBTQVNMX09LKSB7CisJY2hhciBlcnJidWZbMjU2XTsKKwljb25zdCBjaGFyICplZCA9IHNhc2xf
ZXJyZGV0YWlsKHMtPmNvbm4pOworCisJc25wcmludGYoZXJyYnVmLCAyNTYsICJkZWNvZGluZyBl
cnJvcjogJXM7ICVzIiwKKwkJIHNhc2xfZXJyc3RyaW5nKHJlc3VsdCwgTlVMTCwgTlVMTCksCisJ
CSBlZCA/IGVkIDogIm5vIGRldGFpbCIpOworCXMtPmVycm9yID0geHN0cmR1cChlcnJidWYpOwor
CXJldHVybiBFT0Y7CisgICAgfQorICAgCisgICAgaWYgKG91dGxlbiA+IDApIHsKKwkvKiBYWFgg
Y2FuIHdlIGp1c3Qgc2VydmUgZGF0YSBmcm9tICdvdXQnIHdpdGhvdXQgY29weWluZworCSAgIGl0
IHRvIHMtPmJ1ZiA/ICovCisJaWYgKG91dGxlbiA+IHMtPmJ1Zl9zaXplKSB7CisJICAgIHMtPmJ1
ZiA9ICh1bnNpZ25lZCBjaGFyICopIAorCQl4cmVhbGxvYyhzLT5idWYsIHNpemVvZihjaGFyKSAq
IChvdXRsZW4gKyA0KSk7CisJICAgIHMtPmJ1Zl9zaXplID0gb3V0bGVuOworCX0KKwltZW1jcHko
cy0+YnVmLCBvdXQsIG91dGxlbik7CisJcy0+cHRyID0gcy0+YnVmOworCXMtPmNudCA9IG91dGxl
bjsKKyAgICB9IGVsc2UgewkJLyogZGlkbid0IGRlY29kZSBhbnl0aGluZyAqLworCXMtPmNudCA9
IDA7CisgICAgfQorCisgICAgcmV0dXJuIDA7Cit9CisKKy8qCiAgKiBUdXJuIG9uIFNBU0wgZm9y
IHRoaXMgY29ubmVjdGlvbgogICovCiAKQEAgLTE3OSw3ICsyMjMsNiBAQAogICAgIHMtPnNhc2xz
c2YgPSAqKChjb25zdCBpbnQgKikgc3NmcCk7CiAKICAgICBpZiAocy0+d3JpdGUpIHsKLQlpbnQg
cmVzdWx0OwogCWNvbnN0IHZvaWQgKm1heHA7CiAJdW5zaWduZWQgaW50IG1heDsKIApAQCAtMTk5
LDggKzI0Miw4IEBACiAJcy0+Y250ID0gbWF4OwogICAgIH0KICAgICBlbHNlIGlmIChzLT5jbnQp
IHsgIAotCS8qIGZsdXNoIGFueSBwZW5kaW5nIGlucHV0ICovCi0Jcy0+Y250ID0gMDsKKwkvKiBk
ZWNvZGUgYW55IHBlbmRpbmcgaW5wdXQgKi8KKwlpZiAocHJvdF9zYXNsZGVjb2RlKHMsIHMtPmNu
dCkgPT0gRU9GKSByZXR1cm4gRU9GOwogICAgIH0KIAogICAgIHJldHVybiAwOwpAQCAtNDgxLDQz
ICs1MjQsMTAgQEAKIAl9CiAJCiAJaWYgKHMtPnNhc2xzc2YpIHsgLyogZGVjb2RlIGl0ICovCi0J
ICAgIGludCByZXN1bHQ7Ci0JICAgIGNvbnN0IGNoYXIgKm91dDsKLQkgICAgdW5zaWduZWQgb3V0
bGVuOwotCSAgICAKLQkgICAgLyogRGVjb2RlIHRoZSBpbnB1dCB0b2tlbiAqLwotCSAgICByZXN1
bHQgPSBzYXNsX2RlY29kZShzLT5jb25uLCAoY29uc3QgY2hhciAqKSBzLT5idWYsIG4sIAotCQkJ
CSAmb3V0LCAmb3V0bGVuKTsKLQkgICAgCi0JICAgIGlmIChyZXN1bHQgIT0gU0FTTF9PSykgewot
CQljaGFyIGVycmJ1ZlsyNTZdOwotCQljb25zdCBjaGFyICplZCA9IHNhc2xfZXJyZGV0YWlsKHMt
PmNvbm4pOwotCi0JCXNucHJpbnRmKGVycmJ1ZiwgMjU2LCAiZGVjb2RpbmcgZXJyb3I6ICVzOyAl
cyIsCi0JCQkgc2FzbF9lcnJzdHJpbmcocmVzdWx0LCBOVUxMLCBOVUxMKSwKLQkJCSBlZCA/IGVk
IDogIm5vIGRldGFpbCIpOwotCQlzLT5lcnJvciA9IHhzdHJkdXAoZXJyYnVmKTsKLQkJcmV0dXJu
IEVPRjsKLQkgICAgfQotCSAgICAKLQkgICAgaWYgKG91dGxlbiA+IDApIHsKLQkJLyogWFhYIGNh
biB3ZSBqdXN0IHNlcnZlIGRhdGEgZnJvbSAnb3V0JyB3aXRob3V0IGNvcHlpbmcKLQkJICAgaXQg
dG8gcy0+YnVmID8gKi8KLQkJaWYgKG91dGxlbiA+IHMtPmJ1Zl9zaXplKSB7Ci0JCSAgICBzLT5i
dWYgPSAodW5zaWduZWQgY2hhciAqKSAKLQkJCXhyZWFsbG9jKHMtPmJ1Ziwgc2l6ZW9mKGNoYXIp
ICogKG91dGxlbiArIDQpKTsKLQkJICAgIHMtPmJ1Zl9zaXplID0gb3V0bGVuOwotCQl9Ci0JCW1l
bWNweShzLT5idWYsIG91dCwgb3V0bGVuKTsKLQkJcy0+cHRyID0gcy0+YnVmICsgMTsKLQkJcy0+
Y250ID0gb3V0bGVuOwotCSAgICB9IGVsc2UgewkJLyogZGlkbid0IGRlY29kZSBhbnl0aGluZyAq
LwotCQlzLT5jbnQgPSAwOwotCSAgICB9Ci0JICAgIAorCSAgICBpZiAocHJvdF9zYXNsZGVjb2Rl
KHMsIG4pID09IEVPRikgcmV0dXJuIEVPRjsKIAl9IGVsc2UgewogCSAgICAvKiBObyBwcm90ZWN0
aW9uIGZ1bmN0aW9uLCBqdXN0IHVzZSB0aGUgcmF3IGRhdGEgKi8KLQkgICAgcy0+cHRyID0gcy0+
YnVmKzE7CisJICAgIHMtPnB0ciA9IHMtPmJ1ZjsKIAkgICAgcy0+Y250ID0gbjsKIAl9CiAJCkBA
IC01NDUsNyArNTU1LDcgQEAKIAkgICAgfQogCiAJICAgIHMtPmNudC0tOwkJLyogd2UgcmV0dXJu
IHRoZSBmaXJzdCBjaGFyICovCi0JICAgIHJldHVybiAqcy0+YnVmOworCSAgICByZXR1cm4gKnMt
PnB0cisrOwogCX0KICAgICB9IHdoaWxlICgxKTsKIH0KSW5kZXg6IHBlcmwvc2lldmUvbGliL2lz
aWV2ZS5jCj09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT0KUkNTIGZpbGU6IC9hZnMvYW5kcmV3L3N5c3RlbS9jdnMvc3JjL2N5
cnVzL3Blcmwvc2lldmUvbGliL2lzaWV2ZS5jLHYKcmV0cmlldmluZyByZXZpc2lvbiAxLjM0CmRp
ZmYgLXUgLXIxLjM0IGlzaWV2ZS5jCi0tLSBwZXJsL3NpZXZlL2xpYi9pc2lldmUuYwkyMiBBcHIg
MjAwOCAxMzoxMToxOCAtMDAwMAkxLjM0CisrKyBwZXJsL3NpZXZlL2xpYi9pc2lldmUuYwkxMSBE
ZWMgMjAwOCAyMjozMjo1MCAtMDAwMApAQCAtNTUsNiArNTUsNyBAQAogI2luY2x1ZGUgPG5ldGlu
ZXQvaW4uaD4KICNpbmNsdWRlIDxuZXRkYi5oPgogI2luY2x1ZGUgPHN0cmluZy5oPgorI2luY2x1
ZGUgPHVuaXN0ZC5oPgogCiAjaW5jbHVkZSA8c2FzbC9zYXNsLmg+CiAjaW5jbHVkZSA8c2FzbC9z
YXNsdXRpbC5oPgpAQCAtMjk5LDYgKzMwMCwzMyBAQAogICByZXR1cm4gY2FwOwogfQogCitpbnQg
ZGV0ZWN0X21pdG0oaXNpZXZlX3QgKm9iaiwgY2hhciAqbWVjaGxpc3QpCit7CisgICAgY2hhciAq
bmV3X21lY2hsaXN0OworICAgIGludCBjaCwgciA9IDA7CisKKyAgICAvKiB3YWl0IGFuZCBwcm9i
ZSBmb3IgcG9zc2libGUgYXV0b21hdGljIGNhcGFiaWxpdHkgcmVzcG9uc2UgKi8KKyAgICB1c2xl
ZXAoMjUwMDAwKTsKKyAgICBwcm90X05PTkJMT0NLKG9iai0+cGluKTsKKyAgICBpZiAoKGNoID0g
cHJvdF9nZXRjKG9iai0+cGluKSkgIT0gRU9GKSB7CisJLyogYXV0b21hdGljIGNhcGFiaWxpdHkg
cmVzcG9uc2UgKi8KKwlwcm90X3VuZ2V0YyhjaCwgb2JqLT5waW4pOworICAgIH0gZWxzZSB7CisJ
LyogbWFudWFsbHkgYXNrIGZvciBjYXBhYmlsaXRpZXMgKi8KKwlwcm90X3ByaW50ZihvYmotPnBv
dXQsICJDQVBBQklMSVRZXHJcbiIpOworCXByb3RfZmx1c2gob2JqLT5wb3V0KTsKKyAgICB9Cisg
ICAgcHJvdF9CTE9DSyhvYmotPnBpbik7CisKKyAgICBpZiAoKG5ld19tZWNobGlzdCA9IHJlYWRf
Y2FwYWJpbGl0eShvYmopKSkgeworCS8qIGlmIHRoZSBzZXJ2ZXIgc3RpbGwgYWR2ZXJ0aXNlcyBT
QVNMIG1lY2hzLCBjb21wYXJlIGxpc3RzICovCisJciA9IHN0cmNtcChuZXdfbWVjaGxpc3QsIG1l
Y2hsaXN0KTsKKwlmcmVlKG5ld19tZWNobGlzdCk7CisgICAgfQorCisgICAgcmV0dXJuIHI7Cit9
CisKIHN0YXRpYyBpbnQgZ2V0YXV0aGxpbmUoaXNpZXZlX3QgKm9iaiwgY2hhciAqKmxpbmUsIHVu
c2lnbmVkIGludCAqbGluZWxlbiwKIAkJICAgICAgIGNoYXIgKiplcnJzdHJwKQogewpAQCAtNjMx
LDEwICs2NTksMTIgQEAKICAgICBpZihyZXQpIHJldHVybiBTVEFUX05POwogCiAgICAgaWYgKHNz
ZikgewotCS8qIFNBU0wgc2VjdXJpdHkgbGF5ZXIgbmVnb3RpYXRlZCAtLQotCSAgIHNlcnZlciB3
aWxsIGF1dG9tYXRpY2FsbHkgc2VuZCBjYXBhYmlsaXRlcyAqLwotCWZyZWUobWVjaGxpc3QpOwot
CW1lY2hsaXN0ID0gcmVhZF9jYXBhYmlsaXR5KG9ial9uZXcpOworICAgICAgICAvKiBTQVNMIHNl
Y3VyaXR5IGxheWVyIG5lZ290aWF0ZWQgLS0KKwkgICBjaGVjayBpZiBTQVNMIG1lY2ggbGlzdCBj
aGFuZ2VkICovCisgICAgICAgIGlmIChkZXRlY3RfbWl0bShvYmpfbmV3LCBtZWNobGlzdCkpIHsK
KwkgICAgZnJlZShtZWNobGlzdCk7CisJICAgIHJldHVybiBTVEFUX05POworCX0KICAgICB9CiAg
ICAgZnJlZShtZWNobGlzdCk7CiAKSW5kZXg6IHBlcmwvc2lldmUvbGliL2lzaWV2ZS5oCj09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT0KUkNTIGZpbGU6IC9hZnMvYW5kcmV3L3N5c3RlbS9jdnMvc3JjL2N5cnVzL3Blcmwvc2ll
dmUvbGliL2lzaWV2ZS5oLHYKcmV0cmlldmluZyByZXZpc2lvbiAxLjEyCmRpZmYgLXUgLXIxLjEy
IGlzaWV2ZS5oCi0tLSBwZXJsL3NpZXZlL2xpYi9pc2lldmUuaAkyMiBBcHIgMjAwOCAxMzoxMTox
OSAtMDAwMAkxLjEyCisrKyBwZXJsL3NpZXZlL2xpYi9pc2lldmUuaAkxMSBEZWMgMjAwOCAyMjoz
Mjo1MCAtMDAwMApAQCAtNjAsNiArNjAsNyBAQAogCSAgICAgIHNhc2xfY2FsbGJhY2tfdCAqY2Fs
bGJhY2tzKTsKIAogY2hhciAqIHJlYWRfY2FwYWJpbGl0eShpc2lldmVfdCAqb2JqKTsKK2ludCBk
ZXRlY3RfbWl0bShpc2lldmVfdCAqb2JqLCBjaGFyICptZWNobGlzdCk7CiAKIHR5cGVkZWYgZW51
bSB7CiAgICAgU1RBVF9DT05UID0gMCwKSW5kZXg6IHBlcmwvc2lldmUvbWFuYWdlc2lldmUvbWFu
YWdlc2lldmUueHMKPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PQpSQ1MgZmlsZTogL2Fmcy9hbmRyZXcvc3lzdGVtL2N2cy9z
cmMvY3lydXMvcGVybC9zaWV2ZS9tYW5hZ2VzaWV2ZS9tYW5hZ2VzaWV2ZS54cyx2CnJldHJpZXZp
bmcgcmV2aXNpb24gMS4yOApkaWZmIC11IC1yMS4yOCBtYW5hZ2VzaWV2ZS54cwotLS0gcGVybC9z
aWV2ZS9tYW5hZ2VzaWV2ZS9tYW5hZ2VzaWV2ZS54cwkyMiBBcHIgMjAwOCAxMzoxMToxOSAtMDAw
MAkxLjI4CisrKyBwZXJsL3NpZXZlL21hbmFnZXNpZXZlL21hbmFnZXNpZXZlLnhzCTExIERlYyAy
MDA4IDIyOjMyOjUwIC0wMDAwCkBAIC0zMTIsMTAgKzMxMiwxNCBAQAogICB9CiAKICAgaWYgKHNz
ZikgewotCS8qIFNBU0wgc2VjdXJpdHkgbGF5ZXIgbmVnb3RpYXRlZCAtLQotCSAgIHNlcnZlciB3
aWxsIGF1dG9tYXRpY2FsbHkgc2VuZCBjYXBhYmlsaXRlcyAqLwotCWZyZWUobWVjaGxpc3QpOwot
CW1lY2hsaXN0PXJlYWRfY2FwYWJpbGl0eShvYmopOworICAgICAgICAvKiBTQVNMIHNlY3VyaXR5
IGxheWVyIG5lZ290aWF0ZWQgLS0KKwkgICBjaGVjayBpZiBTQVNMIG1lY2ggbGlzdCBjaGFuZ2Vk
ICovCisgICAgICAgIGlmIChkZXRlY3RfbWl0bShvYmosIG1lY2hsaXN0KSkgeworCSAgICBnbG9i
YWxlcnIgPSAicG9zc2libGUgTUlUTSBhdHRhY2s6ICIKKwkJImxpc3Qgb2YgYXZhaWxhYmxlIFNB
U0wgbWVjaGFtaXNtcyBjaGFuZ2VkIjsKKwkgICAgZnJlZShtZWNobGlzdCk7CisJICAgIFhTUkVU
VVJOX1VOREVGOworCX0KICAgfQogICBmcmVlKG1lY2hsaXN0KTsKIApJbmRleDogdGltc2lldmVk
L2FjdGlvbnMuYwo9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09ClJDUyBmaWxlOiAvYWZzL2FuZHJldy9zeXN0ZW0vY3ZzL3Ny
Yy9jeXJ1cy90aW1zaWV2ZWQvYWN0aW9ucy5jLHYKcmV0cmlldmluZyByZXZpc2lvbiAxLjQ1CmRp
ZmYgLXUgLXIxLjQ1IGFjdGlvbnMuYwotLS0gdGltc2lldmVkL2FjdGlvbnMuYwk4IE9jdCAyMDA4
IDE1OjQ3OjA4IC0wMDAwCTEuNDUKKysrIHRpbXNpZXZlZC9hY3Rpb25zLmMJMTEgRGVjIDIwMDgg
MjI6MzI6NTAgLTAwMDAKQEAgLTE3OSw3ICsxNzksNyBAQAogfQogCiBpbnQgY2FwYWJpbGl0aWVz
KHN0cnVjdCBwcm90c3RyZWFtICpjb25uLCBzYXNsX2Nvbm5fdCAqc2FzbGNvbm4sCi0JCSBpbnQg
c3RhcnR0bHNfZG9uZSwgaW50IGF1dGhlbnRpY2F0ZWQpCisJCSBpbnQgc3RhcnR0bHNfZG9uZSwg
aW50IGF1dGhlbnRpY2F0ZWQsIHNhc2xfc3NmX3Qgc2FzbF9zc2YpCiB7CiAgICAgY29uc3QgY2hh
ciAqc2FzbGxpc3Q7CiAgICAgaW50IG1lY2hjb3VudDsKQEAgLTE5MCw3ICsxOTAsNyBAQAogCQlj
b25maWdfbXVwZGF0ZV9zZXJ2ZXIgPyAiIChNdXJkZXIpIiA6ICIiLCBDWVJVU19WRVJTSU9OKTsK
ICAgICAKICAgICAvKiBTQVNMICovCi0gICAgaWYgKGF1dGhlbnRpY2F0ZWQgIT0gMSAmJgorICAg
IGlmICgoIWF1dGhlbnRpY2F0ZWQgfHwgc2FzbF9zc2YpICYmCiAJc2FzbF9saXN0bWVjaChzYXNs
Y29ubiwgTlVMTCwgCiAJCSAgICAiXCJTQVNMXCIgXCIiLCAiICIsICJcIlxyXG4iLAogCQkgICAg
JnNhc2xsaXN0LApJbmRleDogdGltc2lldmVkL2FjdGlvbnMuaAo9PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09ClJDUyBmaWxl
OiAvYWZzL2FuZHJldy9zeXN0ZW0vY3ZzL3NyYy9jeXJ1cy90aW1zaWV2ZWQvYWN0aW9ucy5oLHYK
cmV0cmlldmluZyByZXZpc2lvbiAxLjEyCmRpZmYgLXUgLXIxLjEyIGFjdGlvbnMuaAotLS0gdGlt
c2lldmVkL2FjdGlvbnMuaAkyNCBNYXIgMjAwOCAyMDoyMDo1NyAtMDAwMAkxLjEyCisrKyB0aW1z
aWV2ZWQvYWN0aW9ucy5oCTExIERlYyAyMDA4IDIyOjMyOjUxIC0wMDAwCkBAIC01Nyw3ICs1Nyw3
IEBACiAgKi8KIAogaW50IGNhcGFiaWxpdGllcyhzdHJ1Y3QgcHJvdHN0cmVhbSAqY29ubiwgc2Fz
bF9jb25uX3QgKnNhc2xjb25uLAotCQkgaW50IHN0YXJ0dGxzX2RvbmUsIGludCBhdXRoZW50aWNh
dGVkKTsKKwkJIGludCBzdGFydHRsc19kb25lLCBpbnQgYXV0aGVudGljYXRlZCwgc2FzbF9zc2Zf
dCBzYXNsX3NzZik7CiAKIC8qCiAgKiBHZXQgYSBzaWV2ZSBzY3JpcGUgd2l0aCBuYW1lICJuYW1l
IiBhbmQgb3V0cHV0IGl0J3MgY29udGVudHMKSW5kZXg6IHRpbXNpZXZlZC9wYXJzZXIuYwo9PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09ClJDUyBmaWxlOiAvYWZzL2FuZHJldy9zeXN0ZW0vY3ZzL3NyYy9jeXJ1cy90aW1zaWV2
ZWQvcGFyc2VyLmMsdgpyZXRyaWV2aW5nIHJldmlzaW9uIDEuNTEKZGlmZiAtdSAtcjEuNTEgcGFy
c2VyLmMKLS0tIHRpbXNpZXZlZC9wYXJzZXIuYwk4IE9jdCAyMDA4IDE3OjE4OjEzIC0wMDAwCTEu
NTEKKysrIHRpbXNpZXZlZC9wYXJzZXIuYwkxMSBEZWMgMjAwOCAyMjozMjo1MSAtMDAwMApAQCAt
ODQsNiArODQsNyBAQAogaW50IGF1dGhlbnRpY2F0ZWQgPSAwOwogaW50IHZlcmlmeV9vbmx5ID0g
MDsKIGludCBzdGFydHRsc19kb25lID0gMDsKK3Nhc2xfc3NmX3Qgc2FzbF9zc2YgPSAwOwogI2lm
ZGVmIEhBVkVfU1NMCiAvKiBvdXIgdGxzIGNvbm5lY3Rpb24sIGlmIGFueSAqLwogc3RhdGljIFNT
TCAqdGxzX2Nvbm4gPSBOVUxMOwpAQCAtMjQxLDcgKzI0Miw4IEBACiAgICAgICBpZihyZWZlcnJh
bF9ob3N0KQogCSAgZ290byBkb19yZWZlcnJhbDsKIAotICAgICAgY2FwYWJpbGl0aWVzKHNpZXZl
ZF9vdXQsIHNpZXZlZF9zYXNsY29ubiwgc3RhcnR0bHNfZG9uZSwgYXV0aGVudGljYXRlZCk7Cisg
ICAgICBjYXBhYmlsaXRpZXMoc2lldmVkX291dCwgc2lldmVkX3Nhc2xjb25uLCBzdGFydHRsc19k
b25lLCBhdXRoZW50aWNhdGVkLAorCQkgICBzYXNsX3NzZik7CiAgICAgICBicmVhazsKIAogICBj
YXNlIEhBVkVTUEFDRToKQEAgLTUyNyw3ICs1MjksNyBAQAogICBjb25zdCBjaGFyICpzZXJ2ZXJv
dXQ9TlVMTDsKICAgdW5zaWduZWQgaW50IHNlcnZlcm91dGxlbjsKICAgY29uc3QgY2hhciAqZXJy
c3RyPU5VTEw7Ci0gIGNvbnN0IHZvaWQgKmNhbm9uX3VzZXIsICpzYXNsX3NzZjsKKyAgY29uc3Qg
dm9pZCAqY2Fub25fdXNlciwgKnZhbDsKICAgY2hhciAqdXNlcm5hbWU7CiAgIGludCByZXQgPSBU
UlVFOwogCkBAIC03NzAsMTEgKzc3Miw2IEBACiAJCSAgaWYoYykgKmMgPSAnXDAnOwogCSAgICAg
IH0KIAotCSAgICAgIGlmIChjb25maWdfZ2V0c3dpdGNoKElNQVBPUFRfU0lFVkVfU0FTTF9FWFBF
Q1RfVU5TT0xJQ0lURURfQ0FQQUJJTElUWSkpIHsKLQkJICBzaWV2ZV9wcm90b2NvbC5zYXNsX2Nt
ZC5hdXRvX2NhcGEgPSAxOwotCSAgICAgIH0gZWxzZSB7Ci0JCSAgc2lldmVfcHJvdG9jb2wuc2Fz
bF9jbWQuYXV0b19jYXBhID0gMDsKLQkgICAgICB9CiAJICAgICAgYmFja2VuZCA9IGJhY2tlbmRf
Y29ubmVjdChOVUxMLCBzZXJ2ZXIsICZzaWV2ZV9wcm90b2NvbCwKIAkJCQkJdXNlcm5hbWUsIE5V
TEwsICZzdGF0dXNsaW5lKTsKIApAQCAtODI1LDExICs4MjIsMTQgQEAKICAgcHJvdF9zZXRzYXNs
KHNpZXZlZF9pbiwgc2lldmVkX3Nhc2xjb25uKTsKICAgcHJvdF9zZXRzYXNsKHNpZXZlZF9vdXQs
IHNpZXZlZF9zYXNsY29ubik7CiAKLSAgaWYgKGNvbmZpZ19nZXRzd2l0Y2goSU1BUE9QVF9TSUVW
RV9TQVNMX1NFTkRfVU5TT0xJQ0lURURfQ0FQQUJJTElUWSkpIHsKLSAgICAgIHNhc2xfZ2V0cHJv
cChzaWV2ZWRfc2FzbGNvbm4sIFNBU0xfU1NGLCAmc2FzbF9zc2YpOwotICAgICAgaWYgKCooKHNh
c2xfc3NmX3QgKikgc2FzbF9zc2YpKSB7Ci0JICBjYXBhYmlsaXRpZXMoc2lldmVkX291dCwgc2ll
dmVkX3Nhc2xjb25uLCBzdGFydHRsc19kb25lLCAyKTsKLSAgICAgIH0KKyAgc2FzbF9nZXRwcm9w
KHNpZXZlZF9zYXNsY29ubiwgU0FTTF9TU0YsICZ2YWwpOworICBzYXNsX3NzZiA9ICooKHNhc2xf
c3NmX3QgKikgdmFsKTsKKworICBpZiAoc2FzbF9zc2YgJiYKKyAgICAgIGNvbmZpZ19nZXRzd2l0
Y2goSU1BUE9QVF9TSUVWRV9TQVNMX1NFTkRfVU5TT0xJQ0lURURfQ0FQQUJJTElUWSkpIHsKKyAg
ICAgIGNhcGFiaWxpdGllcyhzaWV2ZWRfb3V0LCBzaWV2ZWRfc2FzbGNvbm4sIHN0YXJ0dGxzX2Rv
bmUsIGF1dGhlbnRpY2F0ZWQsCisJCSAgIHNhc2xfc3NmKTsKKyAgICAgIHByb3RfZmx1c2goc2ll
dmVkX291dCk7CiAgIH0KIAogICAvKiBDcmVhdGUgdGVsZW1ldHJ5IGxvZyAqLwpAQCAtOTA4LDcg
KzkwOCw4IEBACiAKICAgICBzdGFydHRsc19kb25lID0gMTsKIAotICAgIHJldHVybiBjYXBhYmls
aXRpZXMoc2lldmVkX291dCwgc2lldmVkX3Nhc2xjb25uLCBzdGFydHRsc19kb25lLCBhdXRoZW50
aWNhdGVkKTsKKyAgICByZXR1cm4gY2FwYWJpbGl0aWVzKHNpZXZlZF9vdXQsIHNpZXZlZF9zYXNs
Y29ubiwgc3RhcnR0bHNfZG9uZSwKKwkJCWF1dGhlbnRpY2F0ZWQsIHNhc2xfc3NmKTsKIH0KICNl
bHNlCiBzdGF0aWMgaW50IGNtZF9zdGFydHRscyhzdHJ1Y3QgcHJvdHN0cmVhbSAqc2lldmVkX291
dCwgc3RydWN0IHByb3RzdHJlYW0gKnNpZXZlZF9pbikKSW5kZXg6IHRpbXNpZXZlZC90aW1zaWV2
ZWQuYwo9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09ClJDUyBmaWxlOiAvYWZzL2FuZHJldy9zeXN0ZW0vY3ZzL3NyYy9jeXJ1
cy90aW1zaWV2ZWQvdGltc2lldmVkLmMsdgpyZXRyaWV2aW5nIHJldmlzaW9uIDEuNjIKZGlmZiAt
dSAtcjEuNjIgdGltc2lldmVkLmMKLS0tIHRpbXNpZXZlZC90aW1zaWV2ZWQuYwkyNCBNYXIgMjAw
OCAyMDoyMDo1NyAtMDAwMAkxLjYyCisrKyB0aW1zaWV2ZWQvdGltc2lldmVkLmMJMTEgRGVjIDIw
MDggMjI6MzI6NTEgLTAwMDAKQEAgLTE4Miw3ICsxODIsNyBAQAogICAgIAogICAgIGNoZGlyKCIv
dG1wLyIpOwogCi0gICAgY2FwYWJpbGl0aWVzKHNpZXZlZF9vdXQsIHNpZXZlZF9zYXNsY29ubiwg
MCwgMCk7CisgICAgY2FwYWJpbGl0aWVzKHNpZXZlZF9vdXQsIHNpZXZlZF9zYXNsY29ubiwgMCwg
MCwgMCk7CiAKICAgICAvKiBpbml0aWFsaXplIGxleGVyICovCiAgICAgbGV4X2luaXQoKTsK
</data>        

          </attachment>
      

    </bug>

</bugzilla>