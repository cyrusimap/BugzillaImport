<?xml version="1.0" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugzilla.cyrusimap.org/bugzilla.dtd">

<bugzilla version="3.2.5.1-2"
          urlbase="https://bugzilla.cyrusimap.org/"
          maintainer="Dave McMurtrie &lt;dave64@andrew.cmu.edu&gt;"
>

    <bug>
          <bug_id>3893</bug_id>
          
          <creation_ts>2015-04-24 10:41 EDT</creation_ts>
          <short_desc>SIGFPE in digestmd5.c using cyrus-imapd 2.5.x httpd</short_desc>
          <delta_ts>2015-04-24 19:09:26 EDT</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Cyrus SASL</product>
          <component>digestmd5</component>
          <version>2.1.x</version>
          <rep_platform>PC</rep_platform>
          <op_sys>Linux</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          
          
          <priority>P3</priority>
          <bug_severity>bug</bug_severity>
          <target_milestone>Future</target_milestone>
          
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Wolfgang Breyha">wbreyha@gmx.net</reporter>
          <assigned_to name="Ken Murchison">murch@andrew.cmu.edu</assigned_to>
          <cc>murch@andrew.cmu.edu</cc>
          <qa_contact name="The Cyrus Bugzilla List">cyrus-bugzilla@lists.andrew.cmu.edu</qa_contact>

      

      

      
          <long_desc isprivate="0">
            <who name="Wolfgang Breyha">wbreyha@gmx.net</who>
            <bug_when>2015-04-24 10:41:11 EDT</bug_when>
            <thetext>Hi!

I built cyrus-imapd-2.5.[01] with httpd support on CentOS 7(.1) which ships with cyrus-sasl 2.1.26 (cyrus-sasl-2.1.26-17.el7.x86_64, and modules).

I have 
sasl_pwcheck_method: auxprop
sasl_mech_list: PLAIN CRAM-MD5 DIGEST-MD5
sasl_auxprop_plugin: sasldb
sasl_local_domain: &lt;hostname&gt;
servername: &lt;hostname&gt;
set in imapd.conf. I force &lt;hostname&gt; because I&apos;m migrating to a new host which gets the old realm/hostname used in sasldb after migration is finished.

cyrus.conf includes:
https         cmd=&quot;httpd -s&quot; listen=&quot;https&quot; prefork=1

accessing it with eg:
wget https://&lt;new-hostname&gt;/dav/calendars/user/&lt;login&gt;/Default
immediately causes SIGFPE in httpd every time a request is received.

gdb shows the following bt:
Core was generated by `httpd -s&apos;.
Program terminated with signal 8, Arithmetic exception.
#0  digestmd5_server_mech_step1 (stext=0x237a410, sparams=0x2345c90, serverout=0x7fffb413d4e0, 
    serveroutlen=0x7fffb413d4d8, oparams=&lt;optimized out&gt;, clientinlen=&lt;optimized out&gt;, 
    clientin=&lt;optimized out&gt;) at digestmd5.c:2119
2119		unsigned val = hash((char *) nonce) % text-&gt;reauth-&gt;size;
Missing separate debuginfos, use: debuginfo-install jansson-2.4-6.el7.x86_64 keyutils-libs-1.5.8-3.el7.x86_64 krb5-libs-1.12.2-14.el7.x86_64 libcom_err-1.42.9-7.el7.x86_64 libical-0.48-6.el7.x86_64 libselinux-2.2.2-6.el7.x86_64 libxml2-2.9.1-5.el7_1.2.x86_64 nss-softokn-freebl-3.16.2.3-9.el7.x86_64 pcre-8.32-14.el7.x86_64 sqlite-3.7.17-4.el7.x86_64 tcp_wrappers-libs-7.6-77.el7.x86_64 xz-libs-5.1.2-9alpha.el7.x86_64 zlib-1.2.7-13.el7.x86_64
(gdb) bt
#0  digestmd5_server_mech_step1 (stext=0x237a410, sparams=0x2345c90, serverout=0x7fffb413d4e0, 
    serveroutlen=0x7fffb413d4d8, oparams=&lt;optimized out&gt;, clientinlen=&lt;optimized out&gt;, 
    clientin=&lt;optimized out&gt;) at digestmd5.c:2119
#1  0x00007fa85ed49b88 in sasl_server_step (conn=0x234d700, clientin=0x0, clientinlen=0, 
    serverout=0x7fffb413d4e0, serveroutlen=0x0) at server.c:1618
#2  0x00007fa85ed4a09a in sasl_server_start (conn=&lt;optimized out&gt;, mech=&lt;optimized out&gt;, 
    clientin=clientin@entry=0x0, clientinlen=0, serverout=serverout@entry=0x7fffb413d4e0, 
    serveroutlen=serveroutlen@entry=0x7fffb413d4d8) at server.c:1547
#3  0x000000000043b5c0 in http_auth (creds=&lt;optimized out&gt;, txn=txn@entry=0x7fffb413d790) at imap/httpd.c:2992
#4  0x000000000043d31c in response_header (code=code@entry=-1964266995, txn=txn@entry=0x7fffb413d790)
    at imap/httpd.c:2015
#5  0x000000000043d91c in write_body (code=-1964266995, txn=0x7fffb413d790, 
    buf=0x238d8e0 &quot;&lt;!DOCTYPE HTML PUBLIC \&quot;-//W3C//DTD HTML 4.01 Transitional//EN\&quot; \&quot;http://www.w3.org/TR/html4/loose.dtd\&quot;&gt;&lt;html&gt;&lt;head&gt;&lt;title&gt;401 Unauthorized&lt;/title&gt;&lt;/head&gt;&lt;body&gt;&lt;h1&gt;Unauthorized&lt;/h1&gt;&lt;p&gt;Must authenticate &quot;..., len=426) at imap/httpd.c:2470
#6  0x000000000043ec9f in cmdloop () at imap/httpd.c:1425
#7  0x00000000004404b6 in service_main (argc=&lt;optimized out&gt;, argv=&lt;optimized out&gt;, 
    envp=envp@entry=0x7fffb41429e0) at imap/httpd.c:638
#8  0x00000000004111e0 in main (argc=&lt;optimized out&gt;, argv=&lt;optimized out&gt;, envp=0x7fffb41429e0)
    at master/service.c:622

If you need further information or access to core/httpd let me know.</thetext>
          </long_desc>
          <long_desc isprivate="0">
            <who name="Ken Murchison">murch@andrew.cmu.edu</who>
            <bug_when>2015-04-24 11:16:12 EDT</bug_when>
            <thetext>I believe this has been fixed in Git.  To verify, can you set the following in imapd,conf:

sasl_reauth_timeout: 1</thetext>
          </long_desc>
          <long_desc isprivate="0">
            <who name="Wolfgang Breyha">wbreyha@gmx.net</who>
            <bug_when>2015-04-24 18:15:41 EDT</bug_when>
            <thetext>Yes, that works as well.</thetext>
          </long_desc>
          <long_desc isprivate="0">
            <who name="Ken Murchison">murch@andrew.cmu.edu</who>
            <bug_when>2015-04-24 19:09:26 EDT</bug_when>
            <thetext>This was fixed with commit 
https://git.cyrus.foundation/rS76ce885a44e7cb511ba54ceae46349036abb9cc8</thetext>
          </long_desc>
      
      

    </bug>

</bugzilla>