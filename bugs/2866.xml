<?xml version="1.0" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugzilla.cyrusimap.org/bugzilla.dtd">

<bugzilla version="3.2.5.1-2"
          urlbase="https://bugzilla.cyrusimap.org/"
          maintainer="Dave McMurtrie &lt;dave64@andrew.cmu.edu&gt;"
>

    <bug>
          <bug_id>2866</bug_id>
          
          <creation_ts>2006-08-08 09:54 EDT</creation_ts>
          <short_desc>reconstruct deletes cyrus.expunge and all the messages it lists.</short_desc>
          <delta_ts>2010-10-25 18:46:39 EDT</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Cyrus IMAP</product>
          <component>IMAP</component>
          <version>2.3.x</version>
          <rep_platform>Other</rep_platform>
          <op_sys>other</op_sys>
          <bug_status>CLOSED</bug_status>
          <resolution>FIXED</resolution>
          
          
          
          
          <priority>P4</priority>
          <bug_severity>bug</bug_severity>
          <target_milestone>Future</target_milestone>
          
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="paul r turgyan">pturgyan@umich.edu</reporter>
          <assigned_to name="Ken Murchison">murch@andrew.cmu.edu</assigned_to>
          
          <qa_contact name="The Cyrus Bugzilla List">cyrus-bugzilla@lists.andrew.cmu.edu</qa_contact>

      

      

      
          <long_desc isprivate="0">
            <who name="paul r turgyan">pturgyan@umich.edu</who>
            <bug_when>2006-08-08 09:54:39 EDT</bug_when>
            <thetext>When reconstruct runs,  if it can read the cyrus.expunge file,  it deletes all the referenced
messages,  and then deletes the cyrus.expunge file.  

I think if the cyrus.expunge file can be read,  and you are going to delete the cyrus.expunge file,
then you should unexpunge the files referenced in cyrus.expunge</thetext>
          </long_desc>
          <long_desc isprivate="0">
            <who name="paul r turgyan">pturgyan@umich.edu</who>
            <bug_when>2006-08-08 09:56:34 EDT</bug_when>
            <thetext>Created an attachment (id=451)
unexpunges messages in cyrus.expunge
</thetext>
          </long_desc>
          <long_desc isprivate="0">
            <who name="Ken Murchison">murch@andrew.cmu.edu</who>
            <bug_when>2006-08-11 10:05:29 EDT</bug_when>
            <thetext>Is it safe to assume that your patch is inverted?</thetext>
          </long_desc>
          <long_desc isprivate="0">
            <who name="paul r turgyan">pturgyan@umich.edu</who>
            <bug_when>2006-08-22 11:21:51 EDT</bug_when>
            <thetext>Created an attachment (id=453)
optionally keeps a valid cyrus.expunge file and all expunged messages.	
Verifies that mailbox i.d.&apos;s are unique.  Optionally logs sync messages for
sync service
</thetext>
          </long_desc>
          <long_desc isprivate="0">
            <who name="paul r turgyan">pturgyan@umich.edu</who>
            <bug_when>2006-08-22 11:22:31 EDT</bug_when>
            <thetext>Created an attachment (id=454)
documentation update
</thetext>
          </long_desc>
          <long_desc isprivate="0">
            <who name="paul r turgyan">pturgyan@umich.edu</who>
            <bug_when>2006-08-22 11:24:21 EDT</bug_when>
            <thetext>Created an attachment (id=455)
documentation update for man page
</thetext>
          </long_desc>
          <long_desc isprivate="0">
            <who name="Ken Murchison">murch@andrew.cmu.edu</who>
            <bug_when>2006-08-30 13:42:21 EDT</bug_when>
            <thetext>I was getting ready to apply the patch, but it doesn&apos;t apply cleanly to CVS. 
There is a large if {} block that needs massaging, but I don&apos;t have time at the
moment to carefully apply it by hand.

I also can&apos;t figure out what the second patch is for.  If its for the HTML
manpage, that is generated, so we don&apos;t need a patch.</thetext>
          </long_desc>
          <long_desc isprivate="0">
            <who name="paul r turgyan">pturgyan@umich.edu</who>
            <bug_when>2006-10-16 15:38:23 EDT</bug_when>
            <thetext>Created an attachment (id=470)
Generated a unified diff instead of a context diff.

The previous context diff for reconstruct.c would not apply correctly using
patch,	so I&apos;ve generated a new unified diff.  This diff seems to apply
correctly.

The diff for reconstruct.html can be thrown away.  I didn&apos;t know that the html
pages were automatically generated.</thetext>
          </long_desc>
          <long_desc isprivate="0">
            <who name="Ken Murchison">murch@andrew.cmu.edu</who>
            <bug_when>2006-10-24 10:28:56 EDT</bug_when>
            <thetext>Applied to CVS</thetext>
          </long_desc>
      
          <attachment
              isobsolete="1"
              ispatch="1"
              isprivate="0"
          >
            <attachid>451</attachid>
            <date>2006-08-08 09:56 EDT</date>
            <desc>unexpunges messages in cyrus.expunge</desc>
            <filename>reconstruct.diff</filename>
            <type>text/plain</type>
            <size>2826</size>
            <attacher>pturgyan@umich.edu</attacher>
            
              <data encoding="base64">KioqIHJlY29uc3RydWN0LmMJRnJpIEF1ZyAgNCAxMjozODoxMSAyMDA2Ci0tLSByZWNvbnN0cnVj
dC5jLQlUaHUgQXVnICAzIDE1OjQxOjA4IDIwMDYKKioqKioqKioqKioqKioqCioqKiA0MzcsNDQ2
ICoqKioKICAgICAgdW5zaWduZWQgbG9uZyAqdWlkOwogICAgICBpbnQgdWlkX251bSwgdWlkX2Fs
bG9jOwogIAotICAgICB1bnNpZ25lZCBsb25nICpleHB1aWQ7Ci0gICAgIGludCBleHB1aWRfbnVt
LCBleHB1aWRfYWxsb2M7Ci0gICAgIGludCBleHBtc2c7Ci0gCiAgICAgIGludCBtc2csIG9sZF9t
c2cgPSAwOwogICAgICBpbnQgbmV3X2V4aXN0cyA9IDAsIAogIAluZXdfYW5zd2VyZWQgPSAwLAot
LS0gNDM3LDQ0MiAtLS0tCioqKioqKioqKioqKioqKgoqKiogNTg1LDU5NCAqKioqCiAgICAgIGZ3
cml0ZShidWYsIDEsIElOREVYX0hFQURFUl9TSVpFLCBuZXdpbmRleCk7CiAgICAgIHJldHJ5X3dy
aXRlKG5ld2NhY2hlX2ZkLCBidWYsIHNpemVvZihiaXQzMikpOwogIAotICAgICBleHB1aWQgPSAo
dW5zaWduZWQgbG9uZyAqKSB4bWFsbG9jKFVJREdST1cgKiBzaXplb2YodW5zaWduZWQgbG9uZykp
OwotICAgICBleHB1aWRfbnVtID0gMDsKLSAgICAgZXhwdWlkX2FsbG9jID0gVUlER1JPVzsKLSAK
ICAgICAgLyogUmVtb3ZlIGFueSBwcmV2aW91c2x5IGV4cHVuZ2VkIG1lc3NhZ2VzICovCiAgICAg
IC8qIFhYWCAgRm9yIHR3by1waGFzZSB3ZSB3aWxsIG5lZWQgdG8ga2VlcCB0aGUgbWVzc2FnZXMg
cmVmZXJlbmNlZAogICAgICAgICBpbiBjeXJ1cy5leHB1bmdlIGFuZCByZWZyZXNoIGl0cyBoZWFk
ZXIgYW5kIG9mZnNldHMgKi8KLS0tIDU4MSw1ODYgLS0tLQoqKioqKioqKioqKioqKioKKioqIDY0
MSw2NTYgKioqKgogIAkJICAgIG1haWxib3hfbWVzc2FnZV9nZXRfZm5hbWUoJm1haWxib3gsIHVp
ZCwKICAJCQkJCSAgbXNnZm5hbWUsIHNpemVvZihtc2dmbmFtZSkpOwogIAkJICAgIHVubGluayht
c2dmbmFtZSk7Ci0gCQl9IGVsc2UgewotIAotIAkJICAgIGlmIChleHB1aWRfbnVtID09IGV4cHVp
ZF9hbGxvYykgewotIAkJCWV4cHVpZF9hbGxvYyArPSBVSURHUk9XOwotIAkJCWV4cHVpZCA9ICh1
bnNpZ25lZCBsb25nICopCi0gCSAgICB4cmVhbGxvYygoY2hhciAqKWV4cHVpZCwgZXhwdWlkX2Fs
bG9jICogc2l6ZW9mKHVuc2lnbmVkIGxvbmcpKTsKLSAJCSAgICB9Ci0gCSAgICAJICAgIGV4cHVp
ZFtleHB1aWRfbnVtXSA9IDA7Ci0gCQkgICAgZXhwdWlkW2V4cHVpZF9udW1dID0gdWlkOwotIAkg
ICAgICAgICAgICBleHB1aWRfbnVtKys7CiAgCQl9CiAgCSAgICB9CiAgCX0KLS0tIDYzMyw2Mzgg
LS0tLQoqKioqKioqKioqKioqKioKKioqIDY1OSw2NjggKioqKgogIAljbG9zZShleHB1bmdlX2Zk
KTsKICAgICAgfQogICAgICB1bmxpbmsoZm5hbWVidWYpOwotICAgICBpZiAoZXhwdWlkX251bSA+
IDApIHsKLSAJcXNvcnQoKGNoYXIgKilleHB1aWQsIGV4cHVpZF9udW0sIHNpemVvZigqZXhwdWlk
KSwgY29tcGFyZV91aWQpOwotICAgICB9Ci0gCQogIAogICAgICAvKiBGaW5kIGFsbCBtZXNzYWdl
IGZpbGVzIGluIGRpcmVjdG9yeSAqLwogICAgICB1aWQgPSAodW5zaWduZWQgbG9uZyAqKSB4bWFs
bG9jKFVJREdST1cgKiBzaXplb2YodW5zaWduZWQgbG9uZykpOwotLS0gNjQxLDY0NiAtLS0tCioq
KioqKioqKioqKioqKgoqKiogNzY2LDc3OCAqKioqCiAgCSAgICAvKiBJZiB3ZSBhcmUgcmVjb3Zl
cmluZyBhIG1lc3NhZ2UsIHJlc2V0IE1PRFNFUSAqLwogIAkgICAgbWVzc2FnZV9pbmRleC5tb2Rz
ZXEgPSAxOwogIAl9Ci0gCi0gICAgIGZvciAoZXhwbXNnID0gMDsgZXhwbXNnIDwgZXhwdWlkX251
bTsgZXhwbXNnKyspIHsKLSAJaWYgKG1lc3NhZ2VfaW5kZXgudWlkID09IGV4cHVpZCBbZXhwbXNn
XSkgewotIAkgICAgbWVzc2FnZV9pbmRleC5zeXN0ZW1fZmxhZ3MgfD0gRkxBR19ERUxFVEVEOwot
IAkgICAgYnJlYWs7Ci0gICAgICAgICB9Ci0gICAgIH0KICAJbWVzc2FnZV9pbmRleC5sYXN0X3Vw
ZGF0ZWQgPSB0aW1lKDApOwogIAlpZiAobWVzc2FnZV9pbmRleC5tb2RzZXEgPiBtYWlsYm94Lmhp
Z2hlc3Rtb2RzZXEpIHsKICAJICAgIG1haWxib3guaGlnaGVzdG1vZHNlcSA9IG1lc3NhZ2VfaW5k
ZXgubW9kc2VxOwotLS0gNzQ0LDc0OSAtLS0tCioqKioqKioqKioqKioqKgoqKiogNzg0LDc5MCAq
KioqCiAgCSAgICBmY2xvc2UobmV3aW5kZXgpOwogIAkgICAgbWFpbGJveF9jbG9zZSgmbWFpbGJv
eCk7CiAgCSAgICBmcmVlKHVpZCk7Ci0gCSAgICBmcmVlKGV4cHVpZCk7CiAgCSAgICByZXR1cm4g
cjsKICAJfQogIAlmY2xvc2UobXNnZmlsZSk7Ci0tLSA3NTUsNzYwIC0tLS0KKioqKioqKioqKioq
KioqCioqKiA3OTgsODA0ICoqKioKICAJICAgIGZjbG9zZShuZXdpbmRleCk7CiAgCSAgICBtYWls
Ym94X2Nsb3NlKCZtYWlsYm94KTsKICAJICAgIGZyZWUodWlkKTsKLSAJICAgIGZyZWUoZXhwdWlk
KTsKICAJICAgIHJldHVybiBJTUFQX0lPRVJST1I7CiAgCX0KICAKLS0tIDc2OCw3NzMgLS0tLQoq
KioqKioqKioqKioqKioKKioqIDgyNCw4MzAgKioqKgogICAgICB9CiAgCiAgICAgIGZyZWUodWlk
KTsKLSAgICAgZnJlZShleHB1aWQpOwogICAgICAqKChiaXQzMiAqKShidWYrT0ZGU0VUX0dFTkVS
QVRJT05fTk8pKSA9IGh0b25sKG1haWxib3guZ2VuZXJhdGlvbl9ubyArIDEpOwogICAgICAqKChi
aXQzMiAqKShidWYrT0ZGU0VUX0ZPUk1BVCkpID0gaHRvbmwobWFpbGJveC5mb3JtYXQpOwogICAg
ICAqKChiaXQzMiAqKShidWYrT0ZGU0VUX01JTk9SX1ZFUlNJT04pKSA9IGh0b25sKE1BSUxCT1hf
TUlOT1JfVkVSU0lPTik7Ci0tLSA3OTMsNzk4IC0tLS0K
</data>        

          </attachment>
          <attachment
              isobsolete="0"
              ispatch="1"
              isprivate="0"
          >
            <attachid>453</attachid>
            <date>2006-08-22 11:21 EDT</date>
            <desc>optionally keeps a valid cyrus.expunge file and all expunged messages.   Verifies that mailbox i.d.&apos;s are unique.  Optionally logs sync messages for sync service</desc>
            <filename>reconstruct.c.diff</filename>
            <type>text/plain</type>
            <size>20061</size>
            <attacher>pturgyan@umich.edu</attacher>
            
              <data encoding="base64">KioqIHJlY29uc3RydWN0LmN+CUZyaSBKdW4gIDIgMTI6NDE6NTcgMjAwNgotLS0gcmVjb25zdHJ1
Y3QuYwlUdWUgQXVnIDIyIDExOjE1OjEwIDIwMDYKKioqKioqKioqKioqKioqCioqKiA5NCw5OSAq
KioqCi0tLSA5NCwxMDAgLS0tLQogICNpbmNsdWRlICJyZXRyeS5oIgogICNpbmNsdWRlICJjb252
ZXJ0X2NvZGUuaCIKICAjaW5jbHVkZSAidXRpbC5oIgorICNpbmNsdWRlICJzeW5jX2xvZy5oIgog
IAogIGV4dGVybiBpbnQgb3B0aW5kOwogIGV4dGVybiBjaGFyICpvcHRhcmc7CioqKioqKioqKioq
KioqKgoqKiogMTAyLDEwNyAqKioqCi0tLSAxMDMsMTE1IC0tLS0KICAgICAgY2hhciAqbmFtZTsK
ICAgICAgc3RydWN0IGRpc2NvdmVyZWQgKm5leHQ7CiAgfTsgICAgICAgCisgc3RydWN0IHVuaXFt
YWlsaWQgeworICAgICBjaGFyICogdW5pcW1ieGlkOworICAgICBjaGFyICp1bmlxbmFtZTsKKyAg
ICAgc3RydWN0IHVuaXFtYWlsaWQgKnVuaXFuZXh0OworIH07CisgCisgc3RydWN0IHVuaXFtYWls
aWQgKnVuaXFtaWRfaGVhZDsKICAKICAvKiBjdXJyZW50IG5hbWVzcGFjZSAqLwogIHN0YXRpYyBz
dHJ1Y3QgbmFtZXNwYWNlIHJlY29uX25hbWVzcGFjZTsKKioqKioqKioqKioqKioqCioqKiAxMTQs
MTIzICoqKioKLS0tIDEyMiwxMzYgLS0tLQogIGludCBkb19yZWNvbnN0cnVjdChjaGFyICpuYW1l
LCBpbnQgbWF0Y2hsZW4sIGludCBtYXljcmVhdGUsIHZvaWQgKnJvY2spOwogIGludCByZWNvbnN0
cnVjdChjaGFyICpuYW1lLCBzdHJ1Y3QgZGlzY292ZXJlZCAqbCk7CiAgdm9pZCB1c2FnZSh2b2lk
KTsKKyBjaGFyICogZ2V0bWFpbG5hbWUgKGNoYXIgKiBtYWlsYm94bmFtZSk7Cisgc3RydWN0IHVu
aXFtYWlsaWQgKiBhZGRfdW5pcWlkIChjaGFyICogbWFpbGJveG5hbWUsIGNoYXIgKiBtYWlsYm94
aWQpOworIHN0cnVjdCB1bmlxbWFpbGlkICogZmluZF91bmlxaWQgKGNoYXIgKiBtYWlsYm94bmFt
ZSwgY2hhciAqIG1haWxib3hpZCk7CiAgCiAgZXh0ZXJuIGN5cnVzX2FjbF9jYW5vbnByb2NfdCBt
Ym94bGlzdF9lbnN1cmVPd25lclJpZ2h0czsKICAKICBpbnQgY29kZSA9IDA7CisgaW50IGtlZXBm
bGFnID0gMDsKKyBpbnQgc3luY2ZsYWcgPSAwOwogIAogIGludCBtYWluKGludCBhcmdjLCBjaGFy
ICoqYXJndikKICB7CioqKioqKioqKioqKioqKgoqKiogMTQxLDE1MiAqKioqCiAgICAgIGFzc2Vy
dChJTkRFWF9IRUFERVJfU0laRSA9PSAoT0ZGU0VUX1NQQVJFNCs0KSk7CiAgICAgIGFzc2VydChJ
TkRFWF9SRUNPUkRfU0laRSA9PSAoT0ZGU0VUX01PRFNFUSs0KSk7CiAgCiEgICAgIHdoaWxlICgo
b3B0ID0gZ2V0b3B0KGFyZ2MsIGFyZ3YsICJDOnA6cm1meCIpKSAhPSBFT0YpIHsKICAJc3dpdGNo
IChvcHQpIHsKICAJY2FzZSAnQyc6IC8qIGFsdCBjb25maWcgZmlsZSAqLwogIAkgICAgYWx0X2Nv
bmZpZyA9IG9wdGFyZzsKICAJICAgIGJyZWFrOwogIAogIAljYXNlICdwJzoKICAJICAgIHN0YXJ0
X3BhcnQgPSBvcHRhcmc7CiAgCSAgICBicmVhazsKLS0tIDE1NCwxNjkgLS0tLQogICAgICBhc3Nl
cnQoSU5ERVhfSEVBREVSX1NJWkUgPT0gKE9GRlNFVF9TUEFSRTQrNCkpOwogICAgICBhc3NlcnQo
SU5ERVhfUkVDT1JEX1NJWkUgPT0gKE9GRlNFVF9NT0RTRVErNCkpOwogIAohICAgICB3aGlsZSAo
KG9wdCA9IGdldG9wdChhcmdjLCBhcmd2LCAiQzprcDpybWZzeCIpKSAhPSBFT0YpIHsKICAJc3dp
dGNoIChvcHQpIHsKICAJY2FzZSAnQyc6IC8qIGFsdCBjb25maWcgZmlsZSAqLwogIAkgICAgYWx0
X2NvbmZpZyA9IG9wdGFyZzsKICAJICAgIGJyZWFrOwogIAorIAljYXNlICdrJzoKKyAJICAgIGtl
ZXBmbGFnID0gMTsKKyAJICAgIGJyZWFrOworIAogIAljYXNlICdwJzoKICAJICAgIHN0YXJ0X3Bh
cnQgPSBvcHRhcmc7CiAgCSAgICBicmVhazsKKioqKioqKioqKioqKioqCioqKiAxNjMsMTY4ICoq
KioKLS0tIDE4MCwxODkgLS0tLQogIAkgICAgZmZsYWcgPSAxOwogIAkgICAgYnJlYWs7CiAgCisg
CWNhc2UgJ3MnOgorIAkgICAgc3luY2ZsYWcgPSAxOworIAkgICAgYnJlYWs7CisgCSAgICAKICAJ
Y2FzZSAneCc6CiAgCSAgICB4ZmxhZyA9IDE7CiAgCSAgICBicmVhazsKKioqKioqKioqKioqKioq
CioqKiAxODAsMTg1ICoqKioKLS0tIDIwMSwyMDggLS0tLQogIAlzeXNsb2coTE9HX0VSUiwgZXJy
b3JfbWVzc2FnZShyKSk7CiAgCWZhdGFsKGVycm9yX21lc3NhZ2UociksIEVDX0NPTkZJRyk7CiAg
ICAgIH0KKyAgICAgaWYgKHN5bmNmbGFnKQorIAlzeW5jX2xvZ19pbml0KCk7CiAgCiAgICAgIGlm
KHN0YXJ0X3BhcnQpIHsKICAgICAgCS8qIEdldCBwYXJ0aXRpb24ncyBwYXRoICovCioqKioqKioq
KioqKioqKgoqKiogMzUyLDM1OCAqKioqCiAgdm9pZCB1c2FnZSh2b2lkKQogIHsKICAgICAgZnBy
aW50ZihzdGRlcnIsCiEgCSAgICAidXNhZ2U6IHJlY29uc3RydWN0IFstQyA8YWx0X2NvbmZpZz5d
IFstcCBwYXJ0aXRpb25dIFstcmZ4XSBtYWlsYm94Li4uXG4iKTsKICAgICAgZnByaW50ZihzdGRl
cnIsICIgICAgICAgcmVjb25zdHJ1Y3QgWy1DIDxhbHRfY29uZmlnPl0gLW1cbiIpOwogICAgICBl
eGl0KEVDX1VTQUdFKTsKICB9ICAgIAotLS0gMzc1LDM4MSAtLS0tCiAgdm9pZCB1c2FnZSh2b2lk
KQogIHsKICAgICAgZnByaW50ZihzdGRlcnIsCiEgCSAgICAidXNhZ2U6IHJlY29uc3RydWN0IFst
QyA8YWx0X2NvbmZpZz5dIFstcCBwYXJ0aXRpb25dIFsta3NyZnhdIG1haWxib3guLi5cbiIpOwog
ICAgICBmcHJpbnRmKHN0ZGVyciwgIiAgICAgICByZWNvbnN0cnVjdCBbLUMgPGFsdF9jb25maWc+
XSAtbVxuIik7CiAgICAgIGV4aXQoRUNfVVNBR0UpOwogIH0gICAgCioqKioqKioqKioqKioqKgoq
KiogNDA0LDQwOSAqKioqCi0tLSA0MjcsNjkwIC0tLS0KICAgICAgcmV0dXJuIDA7CiAgfQogIAor
IGludCAKKyByZWNvbnN0cnVjdF9leHB1bmdlIChjaGFyICogcGF0aCwgc3RydWN0IG1haWxib3gg
KiBtYWlsYm94LCAKKyAJCQl1bnNpZ25lZCBsb25nICoqZXhwdWlkLCBpbnQgKmV4cHVpZF9udW0p
CisgeworICAgICBjaGFyIGZuYW1lYnVmW01BWF9NQUlMQk9YX1BBVEgrMV07CisgICAgIGNoYXIg
bmV3Zm5hbWVidWZbTUFYX01BSUxCT1hfUEFUSCsxXTsKKyAgICAgc3RydWN0IHN0YXQgc2J1ZjsK
KyAKKyAgICAgY2hhciBidWZbKChJTkRFWF9IRUFERVJfU0laRSA+IElOREVYX1JFQ09SRF9TSVpF
KSA/CisgICAgICAgICAgICAgIElOREVYX0hFQURFUl9TSVpFIDogSU5ERVhfUkVDT1JEX1NJWkUp
XTsKKyAKKyAgICAgaW50IGV4cHVuZ2VfZmQ7CisgICAgIEZJTEUgKmZleHB1bmdlOworIAorICAg
ICBjb25zdCBjaGFyICppbmRleF9iYXNlID0gTlVMTDsKKyAgICAgdW5zaWduZWQgbG9uZyBpbmRl
eF9sZW4gPSAwOwkvKiBtYXBwZWQgc2l6ZSAqLworICAgICBpbnQgZm9ybWF0OworICAgICBpbnQg
IG1pbm9yX3ZlcnNpb247CisgICAgIHVuc2lnbmVkIGxvbmcgc3RhcnRfb2Zmc2V0OworICAgICB1
bnNpZ25lZCBsb25nIHJlY29yZF9zaXplOworICAgICB1bnNpZ25lZCBsb25nICBleGlzdHM7Cisg
CisgICAgIHVuc2lnbmVkIGxvbmcgdWlkOworICAgICBjaGFyIG1zZ2ZuYW1lW01BSUxCT1hfRk5B
TUVfTEVOKzFdOworIAorICAgICB1bnNpZ25lZCBtc2dubzsKKyAgICAgY29uc3QgY2hhciAqcDsK
KyAgICAgaW50ICAgbjsKKyAKKyAgICAgdW5zaWduZWQgbG9uZyAqZXhwdWlkX2FycmF5ID0gTlVM
TDsKKyAgICAgaW50IGV4cHVpZF9pZHggPSAwOworICAgICBpbnQgZXhwdWlkX2FsbG9jID0gMDsK
KyAgICAgaW50IGV4cG1zZzsKKyAKKyAgICAgKmV4cHVpZCA9IE5VTEw7CisgICAgICpleHB1aWRf
bnVtID0gMDsKKyAKKyAgICAgLyogT3BlbiBhbmQgdmFsaWRhdGUgdGhlIGN5cnVzLmV4cHVuZ2Ug
ZmlsZSAqLworIAorICAgICBzdHJsY3B5KGZuYW1lYnVmLCBwYXRoLCBzaXplb2YoZm5hbWVidWYp
KTsKKyAgICAgc3RybGNhdChmbmFtZWJ1ZiwgRk5BTUVfRVhQVU5HRV9JTkRFWCwgc2l6ZW9mKGZu
YW1lYnVmKSk7CisgCisgICAgIGlmIChzdGF0KGZuYW1lYnVmLCAmc2J1ZikgPT0gLTEgfHwKKyAJ
c2J1Zi5zdF9zaXplIDw9IE9GRlNFVF9MRUFLRURfQ0FDSEUgfHwKKyAJKGV4cHVuZ2VfZmQgPSBv
cGVuKGZuYW1lYnVmLCBPX1JET05MWSwgMDY2NikpID09IC0xKSB7CisgCXVubGluayhmbmFtZWJ1
Zik7CisgICAgICAgICByZXR1cm4gKDApOworICAgICB9IAorIAorICAgICAvKiBNYXAgdGhlIGZp
bGUgKi8KKyAgICAgbWFwX3JlZnJlc2goZXhwdW5nZV9mZCwgMSwgJmluZGV4X2Jhc2UsCisgCQkg
ICAgJmluZGV4X2xlbiwgc2J1Zi5zdF9zaXplLCAiZXhwdW5nZSIsIG1haWxib3gtPm5hbWUpOwor
IAorICAgICBmb3JtYXQgPSBudG9obCgqKChiaXQzMiAqKShpbmRleF9iYXNlK09GRlNFVF9GT1JN
QVQpKSk7CisgICAgIG1pbm9yX3ZlcnNpb24gPSBudG9obCgqKChiaXQzMiAqKShpbmRleF9iYXNl
K09GRlNFVF9NSU5PUl9WRVJTSU9OKSkpOworICAgICBzdGFydF9vZmZzZXQgPSBudG9obCgqKChi
aXQzMiAqKShpbmRleF9iYXNlK09GRlNFVF9TVEFSVF9PRkZTRVQpKSk7CisgICAgIHJlY29yZF9z
aXplID0gbnRvaGwoKigoYml0MzIgKikoaW5kZXhfYmFzZStPRkZTRVRfUkVDT1JEX1NJWkUpKSk7
CisgICAgIGV4aXN0cyA9IG50b2hsKCooKGJpdDMyICopKGluZGV4X2Jhc2UrT0ZGU0VUX0VYSVNU
UykpKTsKKyAKKyAgICAgLyogU2FuaXR5IGNoZWNrIHRoZSBoZWFkZXIgYXMgYmVzdCB3ZSBjYW4g
Ki8KKyAgICAgaWYgKChmb3JtYXQgIT0gMCkgICAgICAgIHx8IChleGlzdHMgPT0gMCkgfHwgIAor
IAkobWlub3JfdmVyc2lvbiA9PSAwKSB8fCAobWlub3JfdmVyc2lvbiA+IE1BSUxCT1hfTUlOT1Jf
VkVSU0lPTikgfHwgCisgCShzdGFydF9vZmZzZXQgPT0gMCkgIHx8ICAoc3RhcnRfb2Zmc2V0ID4g
SU5ERVhfSEVBREVSX1NJWkUpIHx8CisgCShyZWNvcmRfc2l6ZSAgPT0gMCkgIHx8IChyZWNvcmRf
c2l6ZSA+IElOREVYX1JFQ09SRF9TSVpFKSB8fAorIAkoc2J1Zi5zdF9zaXplIDwgKHN0YXJ0X29m
ZnNldCArIGV4aXN0cyAqIHJlY29yZF9zaXplKSkpIHsKKyAKKyAJc3lzbG9nKExPR19FUlIsICJV
bmFibGUgdG8gdmVyaWZ5IGhlYWRlciAtIGRlbGV0aW5nOiAlcyIsIGZuYW1lYnVmKTsKKyAJY2xv
c2UgKGV4cHVuZ2VfZmQpOworIAltYXBfZnJlZSgmaW5kZXhfYmFzZSwgJmluZGV4X2xlbik7Cisg
CXVubGluayhmbmFtZWJ1Zik7CisgCXJldHVybiAoMCk7CisgICAgIH0KKyAKKyAgICAgLyogCisg
ICAgICAqIHZlcmlmeSB0aGUgbWVzc2FnZSBmaWxlcyBleGlzdCAtIAorICAgICAgKiBvcHRpb25h
bGx5IGRlbGV0aW5nIG1lc3NhZ2UgZmlsZXMgCisgICAgICAqLworICAgICBwID0gaW5kZXhfYmFz
ZSArIHN0YXJ0X29mZnNldDsKKyAgICAgZm9yIChtc2dubyA9IDE7IG1zZ25vIDw9IGV4aXN0czsg
bXNnbm8rKywgcCArPSByZWNvcmRfc2l6ZSkgeworIAl1aWQgPSBudG9obCgqKChiaXQzMiAqKShw
ICsgT0ZGU0VUX1VJRCkpKTsKKyAKKyAJLyogU2FuaXR5IGNoZWNrIFVJRCAqLworIAlpZiAodWlk
ID09IDApIHsKKyAJICAgIHN5c2xvZyhMT0dfRVJSLCAiSU9FUlJPUjogJXMgemVybyBleHB1bmdl
IHJlY29yZCAldS8lbHUiLAorIAkJCSAgIGZuYW1lYnVmLCBtc2dubywgZXhpc3RzKTsKKyAJICAg
IGJyZWFrOworIAl9CisgCW1haWxib3hfbWVzc2FnZV9nZXRfZm5hbWUobWFpbGJveCwgdWlkLCBt
c2dmbmFtZSwgc2l6ZW9mKG1zZ2ZuYW1lKSk7CisgCisgCWlmIChrZWVwZmxhZyA9PSAwKSB7Cisg
CSAgICB1bmxpbmsobXNnZm5hbWUpOworIAkgICAgY29udGludWU7CisgCX0KKyAKKyAJaWYgKCAo
c3RhdCAobXNnZm5hbWUsICZzYnVmKSkgIT0gMCkgeworIAkgICAgc3lzbG9nIChMT0dfRVJSLCAi
SU9FUlJPUjogJW0gd2hpbGUgc3RhdFwnaW5nIG1lc3NhZ2UgJXMiLCBtc2dmbmFtZSk7CisgCSAg
ICBjb250aW51ZTsKKyAJfQorIAlpZiAoc2J1Zi5zdF9zaXplID09IDApIHsKKyAJICAgIC8qIFpl
cm8tbGVuZ3RoIG1lc3NhZ2UgZmlsZS0tYmxvdyBpdCBhd2F5ICovCisgCSAgICB1bmxpbmsobXNn
Zm5hbWUpOworIAkgICAgY29udGludWU7CisgICAgICAgICB9CisgCisgCWlmIChleHB1aWRfaWR4
ID09IGV4cHVpZF9hbGxvYykgeworIAkgICAgZXhwdWlkX2FsbG9jICs9IFVJREdST1c7CisgCSAg
ICBleHB1aWRfYXJyYXkgPSAodW5zaWduZWQgbG9uZyAqKSB4cmVhbGxvYygoY2hhciAqKSpleHB1
aWQsCisgCSAgICAJCQlleHB1aWRfYWxsb2MgKiBzaXplb2YodW5zaWduZWQgbG9uZykpOworIAl9
CisgCWV4cHVpZF9hcnJheVtleHB1aWRfaWR4XSA9IHVpZDsKKyAJZXhwdWlkX2lkeCsrOworICAg
ICB9CisgICAgICpleHB1aWQgPSBleHB1aWRfYXJyYXk7CisgICAgICpleHB1aWRfbnVtID0gZXhw
dWlkX2lkeDsKKyAKKyAgICAgaWYgKGtlZXBmbGFnID09IDApIHsKKyAJbWFwX2ZyZWUoJmluZGV4
X2Jhc2UsICZpbmRleF9sZW4pOworIAljbG9zZSAoZXhwdW5nZV9mZCk7CisgCXVubGluayhmbmFt
ZWJ1Zik7CisgCXJldHVybiAoMCk7CisgICAgIH0KKyAKKyAgICAgLyoKKyAgICAgICogSWYgdGhl
IG51bWJlciBvZiBtZXNzYWdlIGZpbGVzIGluIHRoZSBvbGQgZXhwdW5nZSBmaWxlCisgICAgICAq
IGlzIG5vdCBlcXVhbCB0byB3aGF0IHdlIGp1c3QgY291bnRlZCwKKyAgICAgICogd2UnbGwgcmV3
cml0ZSB0aGUgZXhwdW5nZSBmaWxlLgorICAgICAgKiBJZiB3ZSBmb3VuZCBubyBtZXNzYWdlIGZp
bGVzIC0tIGJsb3cgYXdheSBjeXJ1cy5leHB1bmdlCisgICAgICAqLworICAgICBpZiAoZXhpc3Rz
ID09IGV4cHVpZF9pZHgpIHsKKyAJY2xvc2UoZXhwdW5nZV9mZCk7CisgCW1hcF9mcmVlKCZpbmRl
eF9iYXNlLCAmaW5kZXhfbGVuKTsKKyAgICAgfSBlbHNlIGlmICggZXhwdWlkX2lkeCA9PSAwKSB7
CisgCWNsb3NlKGV4cHVuZ2VfZmQpOworIAltYXBfZnJlZSgmaW5kZXhfYmFzZSwgJmluZGV4X2xl
bik7CisgCXVubGluayAoZm5hbWVidWYpOworICAgICB9IGVsc2UgeworIAkvKiB3ZSBtdXN0IHJl
d3JpdGUgdGhlIGN5cnVzLmV4cHVuZ2UgZmlsZSAqLworIAorIAlzdHJjcHkgKG5ld2ZuYW1lYnVm
LCBmbmFtZWJ1Zik7CisgCXN0cmNhdCAobmV3Zm5hbWVidWYsICAiLk5FVyIpOworIAlmZXhwdW5n
ZSA9IGZvcGVuKG5ld2ZuYW1lYnVmLCAidysiKTsKKyAJaWYgKGZleHB1bmdlID09IE5VTEwpIHsK
KyAJICAgIHN5c2xvZyAoTE9HX0VSUiwgIklPRVJST1I6ICVtIHdoaWxlIGNyZWF0aW5nOiAlcyIs
IG5ld2ZuYW1lYnVmKTsKKyAJICAgIGNsb3NlKGV4cHVuZ2VfZmQpOworIAkgICAgbWFwX2ZyZWUo
JmluZGV4X2Jhc2UsICZpbmRleF9sZW4pOworIAkgICAgZnJlZShleHB1aWQpOworIAkgICAgcmV0
dXJuIElNQVBfSU9FUlJPUjsKKyAgICAJfQorIAl1bnNpZ25lZCBtc2dubzsKKyAJY29uc3QgY2hh
ciAqcCA9IGluZGV4X2Jhc2UgKyBzdGFydF9vZmZzZXQ7CisgCisgCS8qIAorIAkqIHZlcmlmeSB0
aGUgbWVzc2FnZSBmaWxlcyBleGlzdCAtIAorIAkqIG9wdGlvbmFsbHkgZGVsZXRpbmcgbWVzc2Fn
ZSBmaWxlcyAKKyAJKi8KKyAJZm9yIChtc2dubyA9IDE7IG1zZ25vIDw9IGV4aXN0czsgbXNnbm8r
KywgcCArPSByZWNvcmRfc2l6ZSkgeworIAkgICAgdW5zaWduZWQgbG9uZyBmaWxldWlkID0gbnRv
aGwoKigoYml0MzIgKikocCArIE9GRlNFVF9VSUQpKSk7CisgCisgCSAgICBmb3IgKGV4cG1zZyA9
IDA7IGV4cG1zZyA8IGV4cHVpZF9pZHg7IGV4cG1zZysrKSB7CisgCQlpZiAoZmlsZXVpZCA9PSBl
eHB1aWRfYXJyYXkgW2V4cG1zZ10pIHsKKyAKKyAJCSAgICBuID0gZndyaXRlKGJ1ZiwgMSwgSU5E
RVhfUkVDT1JEX1NJWkUsIGZleHB1bmdlKTsKKyAJCSAgICBpZiAobiAhPSBJTkRFWF9SRUNPUkRf
U0laRSkgeworIAkgICAgCQlzeXNsb2cgKExPR19FUlIsIAorIAkJIklPRVJST1I6ICVtIHdyaXRp
bmcgY3lydXMuZXhwdW5nZSByZWNvcmQ6ICVzIiwgbmV3Zm5hbWVidWYpOworIAkJCWNsb3NlKGV4
cHVuZ2VfZmQpOworIAkJCW1hcF9mcmVlKCZpbmRleF9iYXNlLCAmaW5kZXhfbGVuKTsKKyAJCQlm
cmVlKGV4cHVpZCk7CisgCQkJZmNsb3NlKGZleHB1bmdlKTsKKyAJCQkKKyAJCQlyZXR1cm4gSU1B
UF9JT0VSUk9SOworIAkJICAgIH0KKyAJCSAgICBicmVhazsKKyAJCX0KKyAJICAgIH0KKyAJfQor
IAlyZXdpbmQgKGZleHB1bmdlKTsKKyAJKigoYml0MzIgKikoYnVmK09GRlNFVF9FWElTVFMpKSA9
IGh0b25sKCpleHB1aWRfbnVtKTsJCisgCW4gPSBmd3JpdGUoYnVmLCAxLCBJTkRFWF9IRUFERVJf
U0laRSwgZmV4cHVuZ2UpOworIAlpZiAobiAhPSBJTkRFWF9IRUFERVJfU0laRSB8fCBmZXJyb3Io
ZmV4cHVuZ2UpICkgeworIAkgICAgc3lzbG9nIChMT0dfRVJSLCAiSU9FUlJPUjogJW0gd3JpdGlu
ZyBleHB1bmdlIGhlYWRlcjogJXMiLCBuZXdmbmFtZWJ1Zik7CisgCSAgICBjbG9zZShleHB1bmdl
X2ZkKTsKKyAJICAgIG1hcF9mcmVlKCZpbmRleF9iYXNlLCAmaW5kZXhfbGVuKTsKKyAJICAgIGZy
ZWUoZXhwdWlkKTsKKyAJICAgIGZjbG9zZShmZXhwdW5nZSk7CisgCSAgICByZXR1cm4gSU1BUF9J
T0VSUk9SOworIAl9CisgCisgCWNsb3NlKGV4cHVuZ2VfZmQpOworIAltYXBfZnJlZSgmaW5kZXhf
YmFzZSwgJmluZGV4X2xlbik7CisgCXVubGluayhmbmFtZWJ1Zik7CisgCWZjaG1vZCAoZmlsZW5v
IChmZXhwdW5nZSksIAorIAkJU19JUlVTUiB8IFNfSVdVU1IgfCBTX0lSR1JQIHwgU19JV0dSUCB8
IFNfSVJPVEggfFNfSVdPVEgpOworIAlmY2xvc2UoZmV4cHVuZ2UpOworIAlpZiAocmVuYW1lKG5l
d2ZuYW1lYnVmLCBmbmFtZWJ1ZikpIHsKKyAJICAgIGZyZWUoZXhwdWlkKTsKKyAgICAgICAgICAg
ICByZXR1cm4gSU1BUF9JT0VSUk9SOworIAl9CisgICAgIH0KKyAgICAgCisgICAgIGlmIChleHB1
aWRfaWR4ID4gMCkgeworIAlxc29ydCgoY2hhciAqKWV4cHVpZF9hcnJheSwgZXhwdWlkX2lkeCwg
c2l6ZW9mKGV4cHVpZF9hcnJheSksIGNvbXBhcmVfdWlkKTsKKyAgICAgfQorIAorICAgICByZXR1
cm4gKDApOworIH0JCisgCisgY2hhciAqIAorIGdldG1haWxuYW1lIChjaGFyICogbWFpbGJveG5h
bWUpIAorIHsKKyAgICAgc3RhdGljIGNoYXIgICBuYW1lYnVmW01BWF9NQUlMQk9YX1BBVEggKyAx
XTsKKyAgICAgc3RhdGljIGludCAgICBuYW1lYnVmbGVuOworIAorICAgICBjaGFyICogcG5hbWU7
CisgCisgICAgIHN0cmxjcHkgKG5hbWVidWYsIG1haWxib3huYW1lLCBzaXplb2YgKG5hbWVidWYp
KTsKKyAgICAgcG5hbWUgPSBzdHJjaHIgKG5hbWVidWYsICcuJyk7CisgICAgIGlmIChwbmFtZSkg
eworIAlwbmFtZSA9IHN0cmNocihwbmFtZSArIDEsICcuJyk7CisgCWlmIChwbmFtZSkKKyAJICAg
ICpwbmFtZSA9ICdcMCc7CisgICAgIH0KKyAgICAgcmV0dXJuIChuYW1lYnVmKTsKKyB9CisgCisg
c3RydWN0IHVuaXFtYWlsaWQgKiAKKyBmaW5kX3VuaXFpZCAoIGNoYXIgKiBtYWlsYm94bmFtZSwg
Y2hhciAqIG1haWxib3hpZCkgCisgeworICAgICBzdHJ1Y3QgdW5pcW1haWxpZCAqcHVuaXE7Cisg
ICAgIGNoYXIgKiBuYW1lcHRyOworICAgICAKKyAgICAgbmFtZXB0ciA9IGdldG1haWxuYW1lICht
YWlsYm94bmFtZSk7CisgICAgIGZvciAocHVuaXEgPSB1bmlxbWlkX2hlYWQ7IHB1bmlxICE9IE5V
TEw7IHB1bmlxID0gcHVuaXEtPnVuaXFuZXh0KSB7CisgCWlmICAoc3RyY21wIChwdW5pcS0+dW5p
cW1ieGlkLCBtYWlsYm94aWQpID09IDApIHsKKyAJICAgIGlmIChzdHJjbXAgKHB1bmlxLT51bmlx
bmFtZSwgbmFtZXB0cikgPT0gMCkgeworIAkJcmV0dXJuIChwdW5pcSk7CisgCSAgICB9CisgCX0K
KyAgICAgfQorICAgICByZXR1cm4gTlVMTDsKKyB9Cisgc3RydWN0IHVuaXFtYWlsaWQgKiAKKyBh
ZGRfdW5pcWlkICggY2hhciAqIG1haWxib3huYW1lLCBjaGFyICogbWFpbGJveGlkKQorIHsKKyAg
ICAgc3RydWN0IHVuaXFtYWlsaWQgKnB1bmlxOworICAgICBjaGFyICpwYm94bmFtZTsKKyAKKyAg
ICAgcGJveG5hbWUgPSBnZXRtYWlsbmFtZSAobWFpbGJveG5hbWUpOworIAorICAgICBwdW5pcSA9
IHhtYWxsb2MgKHNpemVvZiAoc3RydWN0IHVuaXFtYWlsaWQpKTsKKyAgICAgcHVuaXEtPnVuaXFt
YnhpZCA9IHhzdHJkdXAobWFpbGJveGlkKTsKKyAgICAgcHVuaXEtPnVuaXFuYW1lID0geHN0cmR1
cChwYm94bmFtZSk7CisgICAgIAorICAgICBwdW5pcS0+dW5pcW5leHQgPSB1bmlxbWlkX2hlYWQ7
CisgICAgIHVuaXFtaWRfaGVhZCA9IHB1bmlxOworIAorICAgICByZXR1cm4gKHB1bmlxKTsKKyB9
CiAgLyoKICAgKiBSZWNvbnN0cnVjdCB0aGUgc2luZ2xlIG1haWxib3ggbmFtZWQgJ25hbWUnCiAg
ICovCioqKioqKioqKioqKioqKgoqKiogNDMyLDQzNyAqKioqCi0tLSA3MTMsNzIyIC0tLS0KICAg
ICAgdW5zaWduZWQgbG9uZyAqdWlkOwogICAgICBpbnQgdWlkX251bSwgdWlkX2FsbG9jOwogIAor
ICAgICB1bnNpZ25lZCBsb25nICpleHB1aWQ7CisgICAgIGludCBleHB1aWRfbnVtOworICAgICBp
bnQgZXhwbXNnOworIAogICAgICBpbnQgbXNnLCBvbGRfbXNnID0gMDsKICAgICAgaW50IG5ld19l
eGlzdHMgPSAwLCAKICAJbmV3X2Fuc3dlcmVkID0gMCwKKioqKioqKioqKioqKioqCioqKiA0NTEs
NDU3ICoqKioKICAgICAgaW50IG15dHlwZTsKICAgICAgY2hhciBtYnBhdGhbTUFYX01BSUxCT1hf
UEFUSCsxXSwgKnBhdGg7CiAgICAgIAohICAgICBpbnQgZXhwdW5nZV9mZCA9IC0xOwogIAogICAg
ICAvKiBTdGFydCBieSBsb29raW5nIHVwIGN1cnJlbnQgZGF0YSBpbiBtYWlsYm94IGxpc3QgKi8K
ICAgICAgciA9IG1ib3hsaXN0X2RldGFpbChuYW1lLCAmbXl0eXBlLCAmbXlwYXRoLCAmbXltcGF0
aCwKLS0tIDczNiw3NDMgLS0tLQogICAgICBpbnQgbXl0eXBlOwogICAgICBjaGFyIG1icGF0aFtN
QVhfTUFJTEJPWF9QQVRIKzFdLCAqcGF0aDsKICAgICAgCiEgICAgIGludCBleHB1bmdlX2ZvdW5k
OwohICAgICBjaGFyIHVuaXF1ZV9idWZbMzJdOwogIAogICAgICAvKiBTdGFydCBieSBsb29raW5n
IHVwIGN1cnJlbnQgZGF0YSBpbiBtYWlsYm94IGxpc3QgKi8KICAgICAgciA9IG1ib3hsaXN0X2Rl
dGFpbChuYW1lLCAmbXl0eXBlLCAmbXlwYXRoLCAmbXltcGF0aCwKKioqKioqKioqKioqKioqCioq
KiA1NzYsNjM5ICoqKioKICAgICAgZndyaXRlKGJ1ZiwgMSwgSU5ERVhfSEVBREVSX1NJWkUsIG5l
d2luZGV4KTsKICAgICAgcmV0cnlfd3JpdGUobmV3Y2FjaGVfZmQsIGJ1Ziwgc2l6ZW9mKGJpdDMy
KSk7CiAgCiEgICAgIC8qIFJlbW92ZSBhbnkgcHJldmlvdXNseSBleHB1bmdlZCBtZXNzYWdlcyAq
LwohICAgICAvKiBYWFggIEZvciB0d28tcGhhc2Ugd2Ugd2lsbCBuZWVkIHRvIGtlZXAgdGhlIG1l
c3NhZ2VzIHJlZmVyZW5jZWQKISAgICAgICAgaW4gY3lydXMuZXhwdW5nZSBhbmQgcmVmcmVzaCBp
dHMgaGVhZGVyIGFuZCBvZmZzZXRzICovCiEgICAgIHBhdGggPSAobWFpbGJveC5tcGF0aCAmJgoh
IAkgICAgKGNvbmZpZ19tZXRhcGFydGl0aW9uX2ZpbGVzICYKISAJICAgICBJTUFQX0VOVU1fTUVU
QVBBUlRJVElPTl9GSUxFU19FWFBVTkdFKSkgPwohIAltYWlsYm94Lm1wYXRoIDogbWFpbGJveC5w
YXRoOwohICAgICBzdHJsY3B5KGZuYW1lYnVmLCBwYXRoLCBzaXplb2YoZm5hbWVidWYpKTsKISAg
ICAgc3RybGNhdChmbmFtZWJ1ZiwgRk5BTUVfRVhQVU5HRV9JTkRFWCwgc2l6ZW9mKGZuYW1lYnVm
KSk7CiEgICAgIGlmIChzdGF0KGZuYW1lYnVmLCAmc2J1ZikgIT0gLTEgJiYKISAJc2J1Zi5zdF9z
aXplID4gT0ZGU0VUX0xFQUtFRF9DQUNIRSAmJgohIAkoZXhwdW5nZV9mZCA9IG9wZW4oZm5hbWVi
dWYsIE9fUkRPTkxZLCAwNjY2KSkgIT0gLTEpIHsKISAJY29uc3QgY2hhciAqaW5kZXhfYmFzZSA9
IE5VTEw7CiEgCXVuc2lnbmVkIGxvbmcgaW5kZXhfbGVuID0gMDsJLyogbWFwcGVkIHNpemUgKi8K
ISAJaW50IGZvcm1hdCwgbWlub3JfdmVyc2lvbjsKISAJdW5zaWduZWQgbG9uZyBzdGFydF9vZmZz
ZXQsIHJlY29yZF9zaXplLCBleGlzdHM7CiEgCiEgCS8qIE1hcCB0aGUgZmlsZSAqLwohIAltYXBf
cmVmcmVzaChleHB1bmdlX2ZkLCAxLCAmaW5kZXhfYmFzZSwKISAJCSAgICAmaW5kZXhfbGVuLCBz
YnVmLnN0X3NpemUsICJleHB1bmdlIiwgbWFpbGJveC5uYW1lKTsKISAKISAJZm9ybWF0ID0gbnRv
aGwoKigoYml0MzIgKikoaW5kZXhfYmFzZStPRkZTRVRfRk9STUFUKSkpOwohIAltaW5vcl92ZXJz
aW9uID0gbnRvaGwoKigoYml0MzIgKikoaW5kZXhfYmFzZStPRkZTRVRfTUlOT1JfVkVSU0lPTikp
KTsKISAJc3RhcnRfb2Zmc2V0ID0gbnRvaGwoKigoYml0MzIgKikoaW5kZXhfYmFzZStPRkZTRVRf
U1RBUlRfT0ZGU0VUKSkpOwohIAlyZWNvcmRfc2l6ZSA9IG50b2hsKCooKGJpdDMyICopKGluZGV4
X2Jhc2UrT0ZGU0VUX1JFQ09SRF9TSVpFKSkpOwohIAlleGlzdHMgPSBudG9obCgqKChiaXQzMiAq
KShpbmRleF9iYXNlK09GRlNFVF9FWElTVFMpKSk7CiEgCiEgCS8qIFNhbml0eSBjaGVjayB0aGUg
aGVhZGVyIGFzIGJlc3Qgd2UgY2FuICovCiEgCWlmIChmb3JtYXQgPT0gMCAmJiBleGlzdHMgJiYK
ISAJICAgIG1pbm9yX3ZlcnNpb24gJiYgbWlub3JfdmVyc2lvbiA8PSBNQUlMQk9YX01JTk9SX1ZF
UlNJT04gJiYKISAJICAgIHN0YXJ0X29mZnNldCAmJiBzdGFydF9vZmZzZXQgPD0gSU5ERVhfSEVB
REVSX1NJWkUgJiYKISAJICAgIHJlY29yZF9zaXplICYmIHJlY29yZF9zaXplIDw9IElOREVYX1JF
Q09SRF9TSVpFICYmCiEgCSAgICBzYnVmLnN0X3NpemUgPj0gKHN0YXJ0X29mZnNldCArIGV4aXN0
cyAqIHJlY29yZF9zaXplKSkgewohIAkgICAgdW5zaWduZWQgbXNnbm87CiEgCSAgICBjb25zdCBj
aGFyICpwID0gaW5kZXhfYmFzZSArIHN0YXJ0X29mZnNldDsKISAKISAJICAgIC8qIERlbGV0ZSBt
ZXNzYWdlIGZpbGVzICovCiEgCSAgICBmb3IgKG1zZ25vID0gMTsgbXNnbm8gPD0gZXhpc3RzOyBt
c2dubysrLCBwICs9IHJlY29yZF9zaXplKSB7CiEgCQl1bnNpZ25lZCBsb25nIHVpZCA9IG50b2hs
KCooKGJpdDMyICopKHAgKyBPRkZTRVRfVUlEKSkpOwohIAkJY2hhciBtc2dmbmFtZVtNQUlMQk9Y
X0ZOQU1FX0xFTisxXTsKISAKISAJCS8qIFNhbml0eSBjaGVjayBVSUQgKi8KISAJCWlmICh1aWQg
PT0gMCkgewohIAkJICAgIHN5c2xvZyhMT0dfRVJSLCAiSU9FUlJPUjogJXMgemVybyBleHB1bmdl
IHJlY29yZCAldS8lbHUiLAohIAkJCSAgIG1haWxib3gubmFtZSwgbXNnbm8sIGV4aXN0cyk7CiEg
CQkgICAgYnJlYWs7CiEgCQl9CiEgCiEgCQltYWlsYm94X21lc3NhZ2VfZ2V0X2ZuYW1lKCZtYWls
Ym94LCB1aWQsCiEgCQkJCQkgIG1zZ2ZuYW1lLCBzaXplb2YobXNnZm5hbWUpKTsKISAJCXVubGlu
ayhtc2dmbmFtZSk7CiEgCSAgICB9CiEgCX0KISAKISAJbWFwX2ZyZWUoJmluZGV4X2Jhc2UsICZp
bmRleF9sZW4pOwohIAljbG9zZShleHB1bmdlX2ZkKTsKICAgICAgfQotICAgICB1bmxpbmsoZm5h
bWVidWYpOwogIAogICAgICAvKiBGaW5kIGFsbCBtZXNzYWdlIGZpbGVzIGluIGRpcmVjdG9yeSAq
LwogICAgICB1aWQgPSAodW5zaWduZWQgbG9uZyAqKSB4bWFsbG9jKFVJREdST1cgKiBzaXplb2Yo
dW5zaWduZWQgbG9uZykpOwotLS0gODYyLDg3MiAtLS0tCiAgICAgIGZ3cml0ZShidWYsIDEsIElO
REVYX0hFQURFUl9TSVpFLCBuZXdpbmRleCk7CiAgICAgIHJldHJ5X3dyaXRlKG5ld2NhY2hlX2Zk
LCBidWYsIHNpemVvZihiaXQzMikpOwogIAohICAgICBpZiAocmVjb25zdHJ1Y3RfZXhwdW5nZSAo
IHBhdGgsICAmbWFpbGJveCwgJmV4cHVpZCwgJmV4cHVpZF9udW0pICE9IDApIHsKISAJZmNsb3Nl
KG5ld2luZGV4KTsKISAJbWFpbGJveF9jbG9zZSgmbWFpbGJveCk7CiEgCXJldHVybiBJTUFQX0lP
RVJST1I7CiAgICAgIH0KICAKICAgICAgLyogRmluZCBhbGwgbWVzc2FnZSBmaWxlcyBpbiBkaXJl
Y3RvcnkgKi8KICAgICAgdWlkID0gKHVuc2lnbmVkIGxvbmcgKikgeG1hbGxvYyhVSURHUk9XICog
c2l6ZW9mKHVuc2lnbmVkIGxvbmcpKTsKKioqKioqKioqKioqKioqCioqKiA2NDcsNjc1ICoqKioK
ICAJbWFpbGJveF9jbG9zZSgmbWFpbGJveCk7CiAgCWZyZWUodWlkKTsKICAJcmV0dXJuIElNQVBf
SU9FUlJPUjsKISAgICAgfSBlbHNlIHsKICAJd2hpbGUgKChkaXJlbnQgPSByZWFkZGlyKGRpcnAp
KSE9TlVMTCkgewohIAkgICAgaWYgKCFpc2RpZ2l0KChpbnQpIChkaXJlbnQtPmRfbmFtZVswXSkp
IHx8IGRpcmVudC0+ZF9uYW1lWzBdID09CiEgCQknMCcpCiAgCQljb250aW51ZTsKLSAJICAgIGlm
ICh1aWRfbnVtID09IHVpZF9hbGxvYykgewotIAkJdWlkX2FsbG9jICs9IFVJREdST1c7Ci0gCQl1
aWQgPSAodW5zaWduZWQgbG9uZyAqKQotIAkJICAgIHhyZWFsbG9jKChjaGFyICopdWlkLCB1aWRf
YWxsb2MgKiBzaXplb2YodW5zaWduZWQgbG9uZykpOwotIAkgICAgfQotIAkgICAgdWlkW3VpZF9u
dW1dID0gMDsKICAJICAgIHAgPSBkaXJlbnQtPmRfbmFtZTsKICAJICAgIHdoaWxlIChpc2RpZ2l0
KChpbnQpICpwKSkgewohIAkJdWlkW3VpZF9udW1dID0gdWlkW3VpZF9udW1dICogMTAgKyAqcCsr
IC0gJzAnOwogIAkgICAgfQogIAkgICAgaWYgKCpwKysgIT0gJy4nKSBjb250aW51ZTsKICAJICAg
IGlmICgqcCkgY29udGludWU7CiAgCSAgICAKICAJICAgIHVpZF9udW0rKzsKICAJfQogIAljbG9z
ZWRpcihkaXJwKTsKICAJcXNvcnQoKGNoYXIgKil1aWQsIHVpZF9udW0sIHNpemVvZigqdWlkKSwg
Y29tcGFyZV91aWQpOwotICAgICB9CiAgCiAgICAgIC8qIFB1dCBlYWNoIG1lc3NhZ2UgZmlsZSBp
biB0aGUgbmV3IGluZGV4L2NhY2hlICovCiAgICAgIG9sZF9tc2cgPSAwOwotLS0gODgwLDkwOCAt
LS0tCiAgCW1haWxib3hfY2xvc2UoJm1haWxib3gpOwogIAlmcmVlKHVpZCk7CiAgCXJldHVybiBJ
TUFQX0lPRVJST1I7CiEgICAgIH0gCiAgICAgIHdoaWxlICgoZGlyZW50ID0gcmVhZGRpcihkaXJw
KSkhPU5VTEwpIHsKISAJaWYgKCFpc2RpZ2l0KChpbnQpIChkaXJlbnQtPmRfbmFtZVswXSkpIHx8
IGRpcmVudC0+ZF9uYW1lWzBdID09ICcwJykKICAJICAgIGNvbnRpbnVlOwogIAlwID0gZGlyZW50
LT5kX25hbWU7CisgCW1zZyA9IDA7CiAgCXdoaWxlIChpc2RpZ2l0KChpbnQpICpwKSkgewohIAkg
ICAgbXNnID0gbXNnICogMTAgKyAqcCsrIC0gJzAnOwogIAl9CiAgCWlmICgqcCsrICE9ICcuJykg
Y29udGludWU7CiAgCWlmICgqcCkgY29udGludWU7CiAgCisgCWlmICh1aWRfbnVtID09IHVpZF9h
bGxvYykgeworIAkgICAgdWlkX2FsbG9jICs9IFVJREdST1c7CisgCSAgICB1aWQgPSAodW5zaWdu
ZWQgbG9uZyAqKQorIAkJIHhyZWFsbG9jKChjaGFyICopdWlkLCB1aWRfYWxsb2MgKiBzaXplb2Yo
dW5zaWduZWQgbG9uZykpOworIAl9CisgCXVpZFt1aWRfbnVtXSA9IG1zZzsKICAJdWlkX251bSsr
OwogICAgICB9CiAgICAgIGNsb3NlZGlyKGRpcnApOworIAogICAgICBxc29ydCgoY2hhciAqKXVp
ZCwgdWlkX251bSwgc2l6ZW9mKCp1aWQpLCBjb21wYXJlX3VpZCk7CiAgCiAgICAgIC8qIFB1dCBl
YWNoIG1lc3NhZ2UgZmlsZSBpbiB0aGUgbmV3IGluZGV4L2NhY2hlICovCiAgICAgIG9sZF9tc2cg
PSAwOwoqKioqKioqKioqKioqKioKKioqIDcwMyw3MDggKioqKgotLS0gOTM2LDk1NSAtLS0tCiAg
CSAgICBjb250aW51ZTsKICAJfQogICAgICAKKyAgICAgICAgIC8qIENoZWNrIGlmIHRoaXMgbWVz
c2FnZSBpcyBvbiB0aGUgZXhwdW5nZSBsaXN0ICovCisgICAgICAgICBleHB1bmdlX2ZvdW5kID0g
MDsKKyAgICAgICAgIGZvciAoZXhwbXNnID0gMDsgZXhwbXNnIDwgZXhwdWlkX251bTsgZXhwbXNn
KyspIHsKKyAgICAgICAgICAgICBpZiAodWlkW21zZ10gPT0gZXhwdWlkIFtleHBtc2ddKSB7Cisg
ICAgICAgICAgICAgICAgIGV4cHVuZ2VfZm91bmQgPSAxOworICAgICAgICAgICAgICAgICBicmVh
azsKKyAgICAgICAgICAgICB9CisgICAgICAgICAgICAgaWYgKHVpZFttc2ddID4gZXhwdWlkIFtl
eHBtc2ddKSB7CisgICAgICAgICAgICAgICAgIGJyZWFrOworICAgICAgICAgICAgIH0KKyAgICAg
ICAgIH0KKyAgICAgICAgIGlmICggZXhwdW5nZV9mb3VuZCA9PSAwICkgeworICAgICAgICAgICAg
IAorIAogIAkvKiBGaW5kIG9sZCBpbmRleCByZWNvcmQsIGlmIGl0IGV4aXN0cyAqLwogIAl3aGls
ZSAob2xkX21zZyA8IG1haWxib3guZXhpc3RzICYmIG9sZF9pbmRleC51aWQgPCB1aWRbbXNnXSkg
ewogIAkgICAgaWYgKG1haWxib3hfcmVhZF9pbmRleF9yZWNvcmQoJm1haWxib3gsICsrb2xkX21z
ZywgJm9sZF9pbmRleCkpIHsKKioqKioqKioqKioqKioqCioqKiA3MzcsNzU4ICoqKioKLS0tIDk4
NCwxMDExIC0tLS0KICAJICAgIC8qIElmIHdlIGFyZSByZWNvdmVyaW5nIGEgbWVzc2FnZSwgcmVz
ZXQgTU9EU0VRICovCiAgCSAgICBtZXNzYWdlX2luZGV4Lm1vZHNlcSA9IDE7CiAgCX0KKyAKICAJ
bWVzc2FnZV9pbmRleC5sYXN0X3VwZGF0ZWQgPSB0aW1lKDApOwogIAlpZiAobWVzc2FnZV9pbmRl
eC5tb2RzZXEgPiBtYWlsYm94LmhpZ2hlc3Rtb2RzZXEpIHsKICAJICAgIG1haWxib3guaGlnaGVz
dG1vZHNlcSA9IG1lc3NhZ2VfaW5kZXgubW9kc2VxOwogIAl9CiAgIAorIAl9CQogIAlpZiAoKChy
ID0gbWVzc2FnZV9wYXJzZV9maWxlKG1zZ2ZpbGUsIE5VTEwsIE5VTEwsICZib2R5KSkgIT0gMCkg
fHwKICAJICAgICgociA9IG1lc3NhZ2VfY3JlYXRlX3JlY29yZCgmbWFpbGJveCwgJm1lc3NhZ2Vf
aW5kZXgsIGJvZHkpKSAhPSAwKSkgewogIAkgICAgZmNsb3NlKG1zZ2ZpbGUpOwogIAkgICAgZmNs
b3NlKG5ld2luZGV4KTsKICAJICAgIG1haWxib3hfY2xvc2UoJm1haWxib3gpOwogIAkgICAgZnJl
ZSh1aWQpOworIAkgICAgaWYgKGV4cHVpZF9udW0pIHsgCisgCQlmcmVlKGV4cHVpZCk7CisgCSAg
ICB9CiAgCSAgICByZXR1cm4gcjsKICAJfQogIAlmY2xvc2UobXNnZmlsZSk7CiAgCWlmIChib2R5
KSBtZXNzYWdlX2ZyZWVfYm9keShib2R5KTsKICAKKyAJaWYgKGV4cHVuZ2VfZm91bmQgPT0gMCkg
ewkKICAJICAgIC8qIFdyaXRlIG91dCBuZXcgZW50cnkgaW4gaW5kZXggZmlsZSAqLwogIAkgICAg
bWFpbGJveF9pbmRleF9yZWNvcmRfdG9fYnVmKCZtZXNzYWdlX2luZGV4LCBidWYpOwogIAoqKioq
KioqKioqKioqKioKKioqIDc2MSw3NzUgKioqKgogIAkgICAgZmNsb3NlKG5ld2luZGV4KTsKICAJ
ICAgIG1haWxib3hfY2xvc2UoJm1haWxib3gpOwogIAkgICAgZnJlZSh1aWQpOwogIAkgICAgcmV0
dXJuIElNQVBfSU9FUlJPUjsKICAJfQotIAogIAluZXdfZXhpc3RzKys7CiAgCWlmIChtZXNzYWdl
X2luZGV4LnN5c3RlbV9mbGFncyAmIEZMQUdfQU5TV0VSRUQpIG5ld19hbnN3ZXJlZCsrOwogIAlp
ZiAobWVzc2FnZV9pbmRleC5zeXN0ZW1fZmxhZ3MgJiBGTEFHX0ZMQUdHRUQpIG5ld19mbGFnZ2Vk
Kys7CiAgCWlmIChtZXNzYWdlX2luZGV4LnN5c3RlbV9mbGFncyAmIEZMQUdfREVMRVRFRCkgbmV3
X2RlbGV0ZWQrKzsKICAJbmV3X3F1b3RhICs9IG1lc3NhZ2VfaW5kZXguc2l6ZTsKICAgICAgfQog
IAogICAgICBpZiAoYm9keSkgZnJlZShib2R5KTsKICAgICAgCi0tLSAxMDE0LDEwMzQgLS0tLQog
IAkJZmNsb3NlKG5ld2luZGV4KTsKICAJCW1haWxib3hfY2xvc2UoJm1haWxib3gpOwogIAkJZnJl
ZSh1aWQpOworIAkJaWYgKGV4cHVpZF9udW0pIHsgCisgCQkgICAgZnJlZShleHB1aWQpOworIAkJ
fQogIAkJcmV0dXJuIElNQVBfSU9FUlJPUjsKICAJICAgIH0KICAJICAgIG5ld19leGlzdHMrKzsK
ICAJICAgIGlmIChtZXNzYWdlX2luZGV4LnN5c3RlbV9mbGFncyAmIEZMQUdfQU5TV0VSRUQpIG5l
d19hbnN3ZXJlZCsrOwogIAkgICAgaWYgKG1lc3NhZ2VfaW5kZXguc3lzdGVtX2ZsYWdzICYgRkxB
R19GTEFHR0VEKSBuZXdfZmxhZ2dlZCsrOwogIAkgICAgaWYgKG1lc3NhZ2VfaW5kZXguc3lzdGVt
X2ZsYWdzICYgRkxBR19ERUxFVEVEKSBuZXdfZGVsZXRlZCsrOwogIAkgICAgbmV3X3F1b3RhICs9
IG1lc3NhZ2VfaW5kZXguc2l6ZTsKICAJfQorICAgICB9CisgICAgIGlmIChleHB1aWRfbnVtKSB7
CisgCWZyZWUgKGV4cHVpZCk7CisgICAgIH0KICAKICAgICAgaWYgKGJvZHkpIGZyZWUoYm9keSk7
CiAgICAgIAoqKioqKioqKioqKioqKioKKioqIDgzNSw4NDkgKioqKgogIAogICAgICAvKiB2YWxp
ZGF0ZSB1bmlxdWVpZCAqLwogICAgICBpZiAoIW1haWxib3gudW5pcXVlaWQpIHsKLSAJY2hhciBi
dWZbMzJdOwogIAogIAkvKiB0aGlzIG1heSBjaGFuZ2UgdW5pcXVlaWQsIGJ1dCBpZiBpdCBkb2Vz
LCBub3RoaW5nIHdlIGNhbiBkbwogICAgICAgICAgICAgYWJvdXQgaXQgKi8KISAJbWFpbGJveF9t
YWtlX3VuaXF1ZWlkKG1haWxib3gubmFtZSwgbWFpbGJveC51aWR2YWxpZGl0eSwgYnVmLAohIAkJ
CSAgICAgIHNpemVvZihidWYpKTsKISAJbWFpbGJveC51bmlxdWVpZCA9IHhzdHJkdXAoYnVmKTsK
ICAgICAgfQogICAgICAKICAgICAgLyogV3JpdGUgaGVhZGVyICovCiAgICAgIHIgPSBtYWlsYm94
X3dyaXRlX2hlYWRlcigmbWFpbGJveCk7CiAgICAgIGlmIChyKSB7Ci0tLSAxMDk0LDExMjAgLS0t
LQogIAogICAgICAvKiB2YWxpZGF0ZSB1bmlxdWVpZCAqLwogICAgICBpZiAoIW1haWxib3gudW5p
cXVlaWQpIHsKICAKICAJLyogdGhpcyBtYXkgY2hhbmdlIHVuaXF1ZWlkLCBidXQgaWYgaXQgZG9l
cywgbm90aGluZyB3ZSBjYW4gZG8KICAgICAgICAgICAgIGFib3V0IGl0ICovCiEgCW1haWxib3hf
bWFrZV91bmlxdWVpZChtYWlsYm94Lm5hbWUsIG1haWxib3gudWlkdmFsaWRpdHksIHVuaXF1ZV9i
dWYsCiEgCQkJICAgICAgc2l6ZW9mKHVuaXF1ZV9idWYpKTsKISAJbWFpbGJveC51bmlxdWVpZCA9
IHhzdHJkdXAodW5pcXVlX2J1Zik7CiEgICAgIH0gZWxzZSB7CiEgCWlmIChmaW5kX3VuaXFpZCAo
bWFpbGJveC5uYW1lLCBtYWlsYm94LnVuaXF1ZWlkKSAhPSBOVUxMICkgewohICAgICAKISAJICAg
IG1haWxib3hfbWFrZV91bmlxdWVpZChtYWlsYm94Lm5hbWUsIG1haWxib3gudWlkdmFsaWRpdHks
IHVuaXF1ZV9idWYsCiEgCQkJICAgICAgc2l6ZW9mKHVuaXF1ZV9idWYpKTsKISAJICAgIGZyZWUg
KG1haWxib3gudW5pcXVlaWQpOwohIAkgICAgbWFpbGJveC51bmlxdWVpZCA9IHhzdHJkdXAodW5p
cXVlX2J1Zik7CiEgCX0KISAgICAgfQohICAgICBpZiAoYWRkX3VuaXFpZCAobWFpbGJveC5uYW1l
LCAgbWFpbGJveC51bmlxdWVpZCkgPT0gTlVMTCkgewohIAlzeXNsb2cgKExPR19FUlIsICJGYWls
ZWQgYWRkaW5nIG1haWxib3g6ICVzIHVuaXF1ZSBpZDogJXNcbiIsCiEgCQkJIG1haWxib3gubmFt
ZSwgbWFpbGJveC51bmlxdWVpZCApOwogICAgICB9CiAgCisgICAgIAogICAgICAvKiBXcml0ZSBo
ZWFkZXIgKi8KICAgICAgciA9IG1haWxib3hfd3JpdGVfaGVhZGVyKCZtYWlsYm94KTsKICAgICAg
aWYgKHIpIHsKKioqKioqKioqKioqKioqCioqKiA4ODEsODg2ICoqKioKLS0tIDExNTIsMTE2MSAt
LS0tCiAgICAgIAogICAgICBmY2xvc2UobmV3aW5kZXgpOwogICAgICByID0gc2Vlbl9yZWNvbnN0
cnVjdCgmbWFpbGJveCwgKHRpbWVfdCkwLCAodGltZV90KTAsIChpbnQgKCopKCkpMCwgKHZvaWQg
KikwKTsKKyAgICAgaWYgKHN5bmNmbGFnKSB7CisgCXN5bmNfbG9nX21haWxib3gobWFpbGJveC5u
YW1lKTsKKyAgICAgfQorIAogICAgICBtYWlsYm94X2Nsb3NlKCZtYWlsYm94KTsKICAKICAgICAg
aWYgKGZvdW5kKSB7CioqKioqKioqKioqKioqKgoqKiogMTAyMSwxMDI3ICoqKioKICAJKmFjbCsr
ID0gJ1wwJzsKICAKICAJY3lydXNfYWNsX3NldCgmbmV3YWNsLCBpZGVudGlmaWVyLCBBQ0xfTU9E
RV9TRVQsCiEgCQkgICAgICBjeXJ1c19hY2xfc3RydG9tYXNrKHJpZ2h0cyksIGFjbGNhbm9ucHJv
YywKICAJCSAgICAgICh2b2lkICopb3duZXIpOwogICAgICB9CiAgCi0tLSAxMjk2LDEzMDIgLS0t
LQogIAkqYWNsKysgPSAnXDAnOwogIAogIAljeXJ1c19hY2xfc2V0KCZuZXdhY2wsIGlkZW50aWZp
ZXIsIEFDTF9NT0RFX1NFVCwKISAJCSAgICAgIGN5cnVzX2FjbF9zdHJ0b21hc2socmlnaHRzLCAw
KSwgYWNsY2Fub25wcm9jLAogIAkJICAgICAgKHZvaWQgKilvd25lcik7CiAgICAgIH0KICAK
</data>        

          </attachment>
          <attachment
              isobsolete="0"
              ispatch="1"
              isprivate="0"
          >
            <attachid>454</attachid>
            <date>2006-08-22 11:22 EDT</date>
            <desc>documentation update</desc>
            <filename>reconstruct.8.html.diff</filename>
            <type>text/plain</type>
            <size>761</size>
            <attacher>pturgyan@umich.edu</attacher>
            
              <data encoding="base64">NDFjNDEKPCA8Yj4mbWludXM7cjwvYj4gXSBbIDxiPiZtaW51cztmPC9iPiBdCi0tLQo+IDxiPiZt
aW51cztyPC9iPiBdIFsgPGI+Jm1pbnVzO2Y8L2I+IF0gWzxiPiZtaW51cztzPC9iPiBdIFsgPGI+
Jm1pbnVzO2s8L2I+IF0KMTY2YzE2NiwxNzgKPCA8cD48Yj4mbWludXM7bTwvYj48L3A+Ci0tLQo+
IDxwPjxiPiZtaW51cztrPC9iPjwvcD4KPiA8L3RkPgo+IDx0ZCB3aWR0aD0iNSUiPjwvdGQ+Cj4g
PHRkIHdpZHRoPSI3NyUiPgo+IAo+IDxwPlRoaXMgb3B0aW9uIHByZXNlcnZlcyB0aGUgY3lydXMu
ZXhwdW5nZSBmaWxlIGFuZCB0aGUgCj4gY29ycmVzcG9uZGluZyBtZXNzYWdlIGZpbGVzIGluc3Rl
YWQgb2YgZGVsZXRpbmcgdGhlbS48L3A+Cj4gPC90ZD4KPiA8dHIgdmFsaWduPSJ0b3AiIGFsaWdu
PSJsZWZ0Ij4KPiA8dGQgd2lkdGg9IjExJSI+PC90ZD4KPiA8dGQgd2lkdGg9IjQlIj4KPiAKPiA8
cD48Yj4mbWludXM7czwvYj48L3A+CjE3MGExODMsMTkzCj4gPHA+QWRkcyBzeW5jaHJvbml6YXRp
b24gcmVjb3JkcyB0byB0aGUgbG9nLCBzbyB0aGUgc3luY2hyb25pemF0aW9uCj4gc2VydmljZSBj
YW4gcmVwbGljYXRlIHRoZSBjaGFuZ2VzLjwvcD4KPiA8L3RkPgo+IDx0ciB2YWxpZ249InRvcCIg
YWxpZ249ImxlZnQiPgo+IDx0ZCB3aWR0aD0iMTElIj48L3RkPgo+IDx0ZCB3aWR0aD0iNCUiPgo+
IAo+IDxwPjxiPiZtaW51czttPC9iPjwvcD4KPiA8L3RkPgo+IDx0ZCB3aWR0aD0iNSUiPjwvdGQ+
Cj4gPHRkIHdpZHRoPSI3NyUiPgo=
</data>        

          </attachment>
          <attachment
              isobsolete="0"
              ispatch="1"
              isprivate="0"
          >
            <attachid>455</attachid>
            <date>2006-08-22 11:24 EDT</date>
            <desc>documentation update for man page</desc>
            <filename>reconstruct.8.diff</filename>
            <type>text/plain</type>
            <size>663</size>
            <attacher>pturgyan@umich.edu</attacher>
            
              <data encoding="base64">KioqIHJlY29uc3RydWN0Ljh+CU1vbiBKdW4gMTkgMDg6NTk6MzcgMjAwNgotLS0gcmVjb25zdHJ1
Y3QuOAlGcmkgQXVnIDE4IDExOjA0OjM0IDIwMDYKKioqKioqKioqKioqKioqCioqKiA2MSw2NiAq
KioqCi0tLSA2MSw3MyAtLS0tCiAgWwogIC5CIFwtZgogIF0KKyBbCisgLkIgXC1rICAKKyBdCisg
WworIC5CIFwtcworIF0KKyAKICAuSVIgbWFpbGJveCAuLi4KICAuYnIKICAuQiByZWNvbnN0cnVj
dAoqKioqKioqKioqKioqKioKKioqIDEzMCwxMzUgKioqKgotLS0gMTM3LDE1MCAtLS0tCiAgYSBj
eXJ1cy5oZWFkZXIgZm91bmQgdGhlcmUgYXMgbmV3IG1haWxib3hlcy4gIFVzZWZ1bCBmb3IKICBy
ZXN0b3JpbmcgbWFpbGJveGVzIGZyb20gYmFja3Vwcy4KICAuVFAKKyAuQiBcLWsKKyBQcmVzZXJ2
ZSB0aGUgY3lydXMuZXhwdW5nZSBmaWxlIGFuZCB0aGUgY29ycmVzcG9uZGluZyBtZXNzYWdlIGZp
bGVzIAorIGluc3RlYWQgb2YgZGVsZXRpbmcgdGhlbS4gCisgLlRQCisgLkIgXC1zCisgQWRkcyBz
eW5jaHJvbml6YXRpb24gcmVjb3JkcyB0byB0aGUgbG9nLCBzbyB0aGUgc3luY2hyb25pemF0aW9u
IAorIHNlcnZpY2UgY2FuIHJlcGxpY2F0ZSB0aGUgY2hhbmdlcy4KKyAuVFAKICAuQiBcLW0KICAu
QiBOT1RFOiBDVVJSRU5UTFkgVU5BVkFJTEFCTEUKICAuYnIK
</data>        

          </attachment>
          <attachment
              isobsolete="0"
              ispatch="1"
              isprivate="0"
          >
            <attachid>470</attachid>
            <date>2006-10-16 15:38 EDT</date>
            <desc>Generated a unified diff instead of a context diff.</desc>
            <filename>reconstruct.c.diff</filename>
            <type>text/plain</type>
            <size>16919</size>
            <attacher>pturgyan@umich.edu</attacher>
            
              <data encoding="base64">LS0tIHJlY29uc3RydWN0LmN+CTIwMDYtMTAtMTYgMTE6Mjc6MjQuMDAwMDAwMDAwIC0wNDAwCisr
KyByZWNvbnN0cnVjdC5jCTIwMDYtMTAtMTYgMTE6MzM6NDQuMDAwMDAwMDAwIC0wNDAwCkBAIC05
NCw2ICs5NCw3IEBACiAjaW5jbHVkZSAicmV0cnkuaCIKICNpbmNsdWRlICJjb252ZXJ0X2NvZGUu
aCIKICNpbmNsdWRlICJ1dGlsLmgiCisjaW5jbHVkZSAic3luY19sb2cuaCIKIAogZXh0ZXJuIGlu
dCBvcHRpbmQ7CiBleHRlcm4gY2hhciAqb3B0YXJnOwpAQCAtMTAyLDYgKzEwMywxMyBAQAogICAg
IGNoYXIgKm5hbWU7CiAgICAgc3RydWN0IGRpc2NvdmVyZWQgKm5leHQ7CiB9OyAgICAgICAKK3N0
cnVjdCB1bmlxbWFpbGlkIHsKKyAgICBjaGFyICogdW5pcW1ieGlkOworICAgIGNoYXIgKnVuaXFu
YW1lOworICAgIHN0cnVjdCB1bmlxbWFpbGlkICp1bmlxbmV4dDsKK307CisKK3N0cnVjdCB1bmlx
bWFpbGlkICp1bmlxbWlkX2hlYWQ7CiAKIC8qIGN1cnJlbnQgbmFtZXNwYWNlICovCiBzdGF0aWMg
c3RydWN0IG5hbWVzcGFjZSByZWNvbl9uYW1lc3BhY2U7CkBAIC0xMTQsMTAgKzEyMiwxNSBAQAog
aW50IGRvX3JlY29uc3RydWN0KGNoYXIgKm5hbWUsIGludCBtYXRjaGxlbiwgaW50IG1heWNyZWF0
ZSwgdm9pZCAqcm9jayk7CiBpbnQgcmVjb25zdHJ1Y3QoY2hhciAqbmFtZSwgc3RydWN0IGRpc2Nv
dmVyZWQgKmwpOwogdm9pZCB1c2FnZSh2b2lkKTsKK2NoYXIgKiBnZXRtYWlsbmFtZSAoY2hhciAq
IG1haWxib3huYW1lKTsKK3N0cnVjdCB1bmlxbWFpbGlkICogYWRkX3VuaXFpZCAoY2hhciAqIG1h
aWxib3huYW1lLCBjaGFyICogbWFpbGJveGlkKTsKK3N0cnVjdCB1bmlxbWFpbGlkICogZmluZF91
bmlxaWQgKGNoYXIgKiBtYWlsYm94bmFtZSwgY2hhciAqIG1haWxib3hpZCk7CiAKIGV4dGVybiBj
eXJ1c19hY2xfY2Fub25wcm9jX3QgbWJveGxpc3RfZW5zdXJlT3duZXJSaWdodHM7CiAKIGludCBj
b2RlID0gMDsKK2ludCBrZWVwZmxhZyA9IDA7CitpbnQgc3luY2ZsYWcgPSAwOwogCiBpbnQgbWFp
bihpbnQgYXJnYywgY2hhciAqKmFyZ3YpCiB7CkBAIC0xNDEsMTIgKzE1NCwxNiBAQAogICAgIGFz
c2VydChJTkRFWF9IRUFERVJfU0laRSA9PSAoT0ZGU0VUX1NQQVJFNCs0KSk7CiAgICAgYXNzZXJ0
KElOREVYX1JFQ09SRF9TSVpFID09IChPRkZTRVRfTU9EU0VRKzQpKTsKIAotICAgIHdoaWxlICgo
b3B0ID0gZ2V0b3B0KGFyZ2MsIGFyZ3YsICJDOnA6cm1meCIpKSAhPSBFT0YpIHsKKyAgICB3aGls
ZSAoKG9wdCA9IGdldG9wdChhcmdjLCBhcmd2LCAiQzprcDpybWZzeCIpKSAhPSBFT0YpIHsKIAlz
d2l0Y2ggKG9wdCkgewogCWNhc2UgJ0MnOiAvKiBhbHQgY29uZmlnIGZpbGUgKi8KIAkgICAgYWx0
X2NvbmZpZyA9IG9wdGFyZzsKIAkgICAgYnJlYWs7CiAKKwljYXNlICdrJzoKKwkgICAga2VlcGZs
YWcgPSAxOworCSAgICBicmVhazsKKwogCWNhc2UgJ3AnOgogCSAgICBzdGFydF9wYXJ0ID0gb3B0
YXJnOwogCSAgICBicmVhazsKQEAgLTE2Myw2ICsxODAsMTAgQEAKIAkgICAgZmZsYWcgPSAxOwog
CSAgICBicmVhazsKIAorCWNhc2UgJ3MnOgorCSAgICBzeW5jZmxhZyA9IDE7CisJICAgIGJyZWFr
OworCSAgICAKIAljYXNlICd4JzoKIAkgICAgeGZsYWcgPSAxOwogCSAgICBicmVhazsKQEAgLTE4
MCw2ICsyMDEsOCBAQAogCXN5c2xvZyhMT0dfRVJSLCBlcnJvcl9tZXNzYWdlKHIpKTsKIAlmYXRh
bChlcnJvcl9tZXNzYWdlKHIpLCBFQ19DT05GSUcpOwogICAgIH0KKyAgICBpZiAoc3luY2ZsYWcp
CisJc3luY19sb2dfaW5pdCgpOwogCiAgICAgaWYoc3RhcnRfcGFydCkgewogICAgIAkvKiBHZXQg
cGFydGl0aW9uJ3MgcGF0aCAqLwpAQCAtMzUyLDcgKzM3NSw3IEBACiB2b2lkIHVzYWdlKHZvaWQp
CiB7CiAgICAgZnByaW50ZihzdGRlcnIsCi0JICAgICJ1c2FnZTogcmVjb25zdHJ1Y3QgWy1DIDxh
bHRfY29uZmlnPl0gWy1wIHBhcnRpdGlvbl0gWy1yZnhdIG1haWxib3guLi5cbiIpOworCSAgICAi
dXNhZ2U6IHJlY29uc3RydWN0IFstQyA8YWx0X2NvbmZpZz5dIFstcCBwYXJ0aXRpb25dIFsta3Ny
ZnhdIG1haWxib3guLi5cbiIpOwogICAgIGZwcmludGYoc3RkZXJyLCAiICAgICAgIHJlY29uc3Ry
dWN0IFstQyA8YWx0X2NvbmZpZz5dIC1tXG4iKTsKICAgICBleGl0KEVDX1VTQUdFKTsKIH0gICAg
CkBAIC00MDQsNiArNDI3LDI2NCBAQAogICAgIHJldHVybiAwOwogfQogCitpbnQgCityZWNvbnN0
cnVjdF9leHB1bmdlIChjaGFyICogcGF0aCwgc3RydWN0IG1haWxib3ggKiBtYWlsYm94LCAKKwkJ
CXVuc2lnbmVkIGxvbmcgKipleHB1aWQsIGludCAqZXhwdWlkX251bSkKK3sKKyAgICBjaGFyIGZu
YW1lYnVmW01BWF9NQUlMQk9YX1BBVEgrMV07CisgICAgY2hhciBuZXdmbmFtZWJ1ZltNQVhfTUFJ
TEJPWF9QQVRIKzFdOworICAgIHN0cnVjdCBzdGF0IHNidWY7CisKKyAgICBjaGFyIGJ1ZlsoKElO
REVYX0hFQURFUl9TSVpFID4gSU5ERVhfUkVDT1JEX1NJWkUpID8KKyAgICAgICAgICAgICBJTkRF
WF9IRUFERVJfU0laRSA6IElOREVYX1JFQ09SRF9TSVpFKV07CisKKyAgICBpbnQgZXhwdW5nZV9m
ZDsKKyAgICBGSUxFICpmZXhwdW5nZTsKKworICAgIGNvbnN0IGNoYXIgKmluZGV4X2Jhc2UgPSBO
VUxMOworICAgIHVuc2lnbmVkIGxvbmcgaW5kZXhfbGVuID0gMDsJLyogbWFwcGVkIHNpemUgKi8K
KyAgICBpbnQgZm9ybWF0OworICAgIGludCAgbWlub3JfdmVyc2lvbjsKKyAgICB1bnNpZ25lZCBs
b25nIHN0YXJ0X29mZnNldDsKKyAgICB1bnNpZ25lZCBsb25nIHJlY29yZF9zaXplOworICAgIHVu
c2lnbmVkIGxvbmcgIGV4aXN0czsKKworICAgIHVuc2lnbmVkIGxvbmcgdWlkOworICAgIGNoYXIg
bXNnZm5hbWVbTUFJTEJPWF9GTkFNRV9MRU4rMV07CisKKyAgICB1bnNpZ25lZCBtc2dubzsKKyAg
ICBjb25zdCBjaGFyICpwOworICAgIGludCAgIG47CisKKyAgICB1bnNpZ25lZCBsb25nICpleHB1
aWRfYXJyYXkgPSBOVUxMOworICAgIGludCBleHB1aWRfaWR4ID0gMDsKKyAgICBpbnQgZXhwdWlk
X2FsbG9jID0gMDsKKyAgICBpbnQgZXhwbXNnOworCisgICAgKmV4cHVpZCA9IE5VTEw7CisgICAg
KmV4cHVpZF9udW0gPSAwOworCisgICAgLyogT3BlbiBhbmQgdmFsaWRhdGUgdGhlIGN5cnVzLmV4
cHVuZ2UgZmlsZSAqLworCisgICAgc3RybGNweShmbmFtZWJ1ZiwgcGF0aCwgc2l6ZW9mKGZuYW1l
YnVmKSk7CisgICAgc3RybGNhdChmbmFtZWJ1ZiwgRk5BTUVfRVhQVU5HRV9JTkRFWCwgc2l6ZW9m
KGZuYW1lYnVmKSk7CisKKyAgICBpZiAoc3RhdChmbmFtZWJ1ZiwgJnNidWYpID09IC0xIHx8CisJ
c2J1Zi5zdF9zaXplIDw9IE9GRlNFVF9MRUFLRURfQ0FDSEUgfHwKKwkoZXhwdW5nZV9mZCA9IG9w
ZW4oZm5hbWVidWYsIE9fUkRPTkxZLCAwNjY2KSkgPT0gLTEpIHsKKwl1bmxpbmsoZm5hbWVidWYp
OworICAgICAgICByZXR1cm4gKDApOworICAgIH0gCisKKyAgICAvKiBNYXAgdGhlIGZpbGUgKi8K
KyAgICBtYXBfcmVmcmVzaChleHB1bmdlX2ZkLCAxLCAmaW5kZXhfYmFzZSwKKwkJICAgICZpbmRl
eF9sZW4sIHNidWYuc3Rfc2l6ZSwgImV4cHVuZ2UiLCBtYWlsYm94LT5uYW1lKTsKKworICAgIGZv
cm1hdCA9IG50b2hsKCooKGJpdDMyICopKGluZGV4X2Jhc2UrT0ZGU0VUX0ZPUk1BVCkpKTsKKyAg
ICBtaW5vcl92ZXJzaW9uID0gbnRvaGwoKigoYml0MzIgKikoaW5kZXhfYmFzZStPRkZTRVRfTUlO
T1JfVkVSU0lPTikpKTsKKyAgICBzdGFydF9vZmZzZXQgPSBudG9obCgqKChiaXQzMiAqKShpbmRl
eF9iYXNlK09GRlNFVF9TVEFSVF9PRkZTRVQpKSk7CisgICAgcmVjb3JkX3NpemUgPSBudG9obCgq
KChiaXQzMiAqKShpbmRleF9iYXNlK09GRlNFVF9SRUNPUkRfU0laRSkpKTsKKyAgICBleGlzdHMg
PSBudG9obCgqKChiaXQzMiAqKShpbmRleF9iYXNlK09GRlNFVF9FWElTVFMpKSk7CisKKyAgICAv
KiBTYW5pdHkgY2hlY2sgdGhlIGhlYWRlciBhcyBiZXN0IHdlIGNhbiAqLworICAgIGlmICgoZm9y
bWF0ICE9IDApICAgICAgICB8fCAoZXhpc3RzID09IDApIHx8ICAKKwkobWlub3JfdmVyc2lvbiA9
PSAwKSB8fCAobWlub3JfdmVyc2lvbiA+IE1BSUxCT1hfTUlOT1JfVkVSU0lPTikgfHwgCisJKHN0
YXJ0X29mZnNldCA9PSAwKSAgfHwgIChzdGFydF9vZmZzZXQgPiBJTkRFWF9IRUFERVJfU0laRSkg
fHwKKwkocmVjb3JkX3NpemUgID09IDApICB8fCAocmVjb3JkX3NpemUgPiBJTkRFWF9SRUNPUkRf
U0laRSkgfHwKKwkoc2J1Zi5zdF9zaXplIDwgKHN0YXJ0X29mZnNldCArIGV4aXN0cyAqIHJlY29y
ZF9zaXplKSkpIHsKKworCXN5c2xvZyhMT0dfRVJSLCAiVW5hYmxlIHRvIHZlcmlmeSBoZWFkZXIg
LSBkZWxldGluZzogJXMiLCBmbmFtZWJ1Zik7CisJY2xvc2UgKGV4cHVuZ2VfZmQpOworCW1hcF9m
cmVlKCZpbmRleF9iYXNlLCAmaW5kZXhfbGVuKTsKKwl1bmxpbmsoZm5hbWVidWYpOworCXJldHVy
biAoMCk7CisgICAgfQorCisgICAgLyogCisgICAgICogdmVyaWZ5IHRoZSBtZXNzYWdlIGZpbGVz
IGV4aXN0IC0gCisgICAgICogb3B0aW9uYWxseSBkZWxldGluZyBtZXNzYWdlIGZpbGVzIAorICAg
ICAqLworICAgIHAgPSBpbmRleF9iYXNlICsgc3RhcnRfb2Zmc2V0OworICAgIGZvciAobXNnbm8g
PSAxOyBtc2dubyA8PSBleGlzdHM7IG1zZ25vKyssIHAgKz0gcmVjb3JkX3NpemUpIHsKKwl1aWQg
PSBudG9obCgqKChiaXQzMiAqKShwICsgT0ZGU0VUX1VJRCkpKTsKKworCS8qIFNhbml0eSBjaGVj
ayBVSUQgKi8KKwlpZiAodWlkID09IDApIHsKKwkgICAgc3lzbG9nKExPR19FUlIsICJJT0VSUk9S
OiAlcyB6ZXJvIGV4cHVuZ2UgcmVjb3JkICV1LyVsdSIsCisJCQkgICBmbmFtZWJ1ZiwgbXNnbm8s
IGV4aXN0cyk7CisJICAgIGJyZWFrOworCX0KKwltYWlsYm94X21lc3NhZ2VfZ2V0X2ZuYW1lKG1h
aWxib3gsIHVpZCwgbXNnZm5hbWUsIHNpemVvZihtc2dmbmFtZSkpOworCisJaWYgKGtlZXBmbGFn
ID09IDApIHsKKwkgICAgdW5saW5rKG1zZ2ZuYW1lKTsKKwkgICAgY29udGludWU7CisJfQorCisJ
aWYgKCAoc3RhdCAobXNnZm5hbWUsICZzYnVmKSkgIT0gMCkgeworCSAgICBzeXNsb2cgKExPR19F
UlIsICJJT0VSUk9SOiAlbSB3aGlsZSBzdGF0XCdpbmcgbWVzc2FnZSAlcyIsIG1zZ2ZuYW1lKTsK
KwkgICAgY29udGludWU7CisJfQorCWlmIChzYnVmLnN0X3NpemUgPT0gMCkgeworCSAgICAvKiBa
ZXJvLWxlbmd0aCBtZXNzYWdlIGZpbGUtLWJsb3cgaXQgYXdheSAqLworCSAgICB1bmxpbmsobXNn
Zm5hbWUpOworCSAgICBjb250aW51ZTsKKyAgICAgICAgfQorCisJaWYgKGV4cHVpZF9pZHggPT0g
ZXhwdWlkX2FsbG9jKSB7CisJICAgIGV4cHVpZF9hbGxvYyArPSBVSURHUk9XOworCSAgICBleHB1
aWRfYXJyYXkgPSAodW5zaWduZWQgbG9uZyAqKSB4cmVhbGxvYygoY2hhciAqKSpleHB1aWQsCisJ
ICAgIAkJCWV4cHVpZF9hbGxvYyAqIHNpemVvZih1bnNpZ25lZCBsb25nKSk7CisJfQorCWV4cHVp
ZF9hcnJheVtleHB1aWRfaWR4XSA9IHVpZDsKKwlleHB1aWRfaWR4Kys7CisgICAgfQorICAgICpl
eHB1aWQgPSBleHB1aWRfYXJyYXk7CisgICAgKmV4cHVpZF9udW0gPSBleHB1aWRfaWR4OworCisg
ICAgaWYgKGtlZXBmbGFnID09IDApIHsKKwltYXBfZnJlZSgmaW5kZXhfYmFzZSwgJmluZGV4X2xl
bik7CisJY2xvc2UgKGV4cHVuZ2VfZmQpOworCXVubGluayhmbmFtZWJ1Zik7CisJcmV0dXJuICgw
KTsKKyAgICB9CisKKyAgICAvKgorICAgICAqIElmIHRoZSBudW1iZXIgb2YgbWVzc2FnZSBmaWxl
cyBpbiB0aGUgb2xkIGV4cHVuZ2UgZmlsZQorICAgICAqIGlzIG5vdCBlcXVhbCB0byB3aGF0IHdl
IGp1c3QgY291bnRlZCwKKyAgICAgKiB3ZSdsbCByZXdyaXRlIHRoZSBleHB1bmdlIGZpbGUuCisg
ICAgICogSWYgd2UgZm91bmQgbm8gbWVzc2FnZSBmaWxlcyAtLSBibG93IGF3YXkgY3lydXMuZXhw
dW5nZQorICAgICAqLworICAgIGlmIChleGlzdHMgPT0gZXhwdWlkX2lkeCkgeworCWNsb3NlKGV4
cHVuZ2VfZmQpOworCW1hcF9mcmVlKCZpbmRleF9iYXNlLCAmaW5kZXhfbGVuKTsKKyAgICB9IGVs
c2UgaWYgKCBleHB1aWRfaWR4ID09IDApIHsKKwljbG9zZShleHB1bmdlX2ZkKTsKKwltYXBfZnJl
ZSgmaW5kZXhfYmFzZSwgJmluZGV4X2xlbik7CisJdW5saW5rIChmbmFtZWJ1Zik7CisgICAgfSBl
bHNlIHsKKwkvKiB3ZSBtdXN0IHJld3JpdGUgdGhlIGN5cnVzLmV4cHVuZ2UgZmlsZSAqLworCisJ
c3RyY3B5IChuZXdmbmFtZWJ1ZiwgZm5hbWVidWYpOworCXN0cmNhdCAobmV3Zm5hbWVidWYsICAi
Lk5FVyIpOworCWZleHB1bmdlID0gZm9wZW4obmV3Zm5hbWVidWYsICJ3KyIpOworCWlmIChmZXhw
dW5nZSA9PSBOVUxMKSB7CisJICAgIHN5c2xvZyAoTE9HX0VSUiwgIklPRVJST1I6ICVtIHdoaWxl
IGNyZWF0aW5nOiAlcyIsIG5ld2ZuYW1lYnVmKTsKKwkgICAgY2xvc2UoZXhwdW5nZV9mZCk7CisJ
ICAgIG1hcF9mcmVlKCZpbmRleF9iYXNlLCAmaW5kZXhfbGVuKTsKKwkgICAgZnJlZShleHB1aWQp
OworCSAgICByZXR1cm4gSU1BUF9JT0VSUk9SOworICAgCX0KKwl1bnNpZ25lZCBtc2dubzsKKwlj
b25zdCBjaGFyICpwID0gaW5kZXhfYmFzZSArIHN0YXJ0X29mZnNldDsKKworCS8qIAorCSogdmVy
aWZ5IHRoZSBtZXNzYWdlIGZpbGVzIGV4aXN0IC0gCisJKiBvcHRpb25hbGx5IGRlbGV0aW5nIG1l
c3NhZ2UgZmlsZXMgCisJKi8KKwlmb3IgKG1zZ25vID0gMTsgbXNnbm8gPD0gZXhpc3RzOyBtc2du
bysrLCBwICs9IHJlY29yZF9zaXplKSB7CisJICAgIHVuc2lnbmVkIGxvbmcgZmlsZXVpZCA9IG50
b2hsKCooKGJpdDMyICopKHAgKyBPRkZTRVRfVUlEKSkpOworCisJICAgIGZvciAoZXhwbXNnID0g
MDsgZXhwbXNnIDwgZXhwdWlkX2lkeDsgZXhwbXNnKyspIHsKKwkJaWYgKGZpbGV1aWQgPT0gZXhw
dWlkX2FycmF5IFtleHBtc2ddKSB7CisKKwkJICAgIG4gPSBmd3JpdGUoYnVmLCAxLCBJTkRFWF9S
RUNPUkRfU0laRSwgZmV4cHVuZ2UpOworCQkgICAgaWYgKG4gIT0gSU5ERVhfUkVDT1JEX1NJWkUp
IHsKKwkgICAgCQlzeXNsb2cgKExPR19FUlIsIAorCQkiSU9FUlJPUjogJW0gd3JpdGluZyBjeXJ1
cy5leHB1bmdlIHJlY29yZDogJXMiLCBuZXdmbmFtZWJ1Zik7CisJCQljbG9zZShleHB1bmdlX2Zk
KTsKKwkJCW1hcF9mcmVlKCZpbmRleF9iYXNlLCAmaW5kZXhfbGVuKTsKKwkJCWZyZWUoZXhwdWlk
KTsKKwkJCWZjbG9zZShmZXhwdW5nZSk7CisJCQkKKwkJCXJldHVybiBJTUFQX0lPRVJST1I7CisJ
CSAgICB9CisJCSAgICBicmVhazsKKwkJfQorCSAgICB9CisJfQorCXJld2luZCAoZmV4cHVuZ2Up
OworCSooKGJpdDMyICopKGJ1ZitPRkZTRVRfRVhJU1RTKSkgPSBodG9ubCgqZXhwdWlkX251bSk7
CQorCW4gPSBmd3JpdGUoYnVmLCAxLCBJTkRFWF9IRUFERVJfU0laRSwgZmV4cHVuZ2UpOworCWlm
IChuICE9IElOREVYX0hFQURFUl9TSVpFIHx8IGZlcnJvcihmZXhwdW5nZSkgKSB7CisJICAgIHN5
c2xvZyAoTE9HX0VSUiwgIklPRVJST1I6ICVtIHdyaXRpbmcgZXhwdW5nZSBoZWFkZXI6ICVzIiwg
bmV3Zm5hbWVidWYpOworCSAgICBjbG9zZShleHB1bmdlX2ZkKTsKKwkgICAgbWFwX2ZyZWUoJmlu
ZGV4X2Jhc2UsICZpbmRleF9sZW4pOworCSAgICBmcmVlKGV4cHVpZCk7CisJICAgIGZjbG9zZShm
ZXhwdW5nZSk7CisJICAgIHJldHVybiBJTUFQX0lPRVJST1I7CisJfQorCisJY2xvc2UoZXhwdW5n
ZV9mZCk7CisJbWFwX2ZyZWUoJmluZGV4X2Jhc2UsICZpbmRleF9sZW4pOworCXVubGluayhmbmFt
ZWJ1Zik7CisJZmNobW9kIChmaWxlbm8gKGZleHB1bmdlKSwgCisJCVNfSVJVU1IgfCBTX0lXVVNS
IHwgU19JUkdSUCB8IFNfSVdHUlAgfCBTX0lST1RIIHxTX0lXT1RIKTsKKwlmY2xvc2UoZmV4cHVu
Z2UpOworCWlmIChyZW5hbWUobmV3Zm5hbWVidWYsIGZuYW1lYnVmKSkgeworCSAgICBmcmVlKGV4
cHVpZCk7CisgICAgICAgICAgICByZXR1cm4gSU1BUF9JT0VSUk9SOworCX0KKyAgICB9CisgICAg
CisgICAgaWYgKGV4cHVpZF9pZHggPiAwKSB7CisJcXNvcnQoKGNoYXIgKilleHB1aWRfYXJyYXks
IGV4cHVpZF9pZHgsIHNpemVvZihleHB1aWRfYXJyYXkpLCBjb21wYXJlX3VpZCk7CisgICAgfQor
CisgICAgcmV0dXJuICgwKTsKK30JCisKK2NoYXIgKiAKK2dldG1haWxuYW1lIChjaGFyICogbWFp
bGJveG5hbWUpIAoreworICAgIHN0YXRpYyBjaGFyICAgbmFtZWJ1ZltNQVhfTUFJTEJPWF9QQVRI
ICsgMV07CisgICAgc3RhdGljIGludCAgICBuYW1lYnVmbGVuOworCisgICAgY2hhciAqIHBuYW1l
OworCisgICAgc3RybGNweSAobmFtZWJ1ZiwgbWFpbGJveG5hbWUsIHNpemVvZiAobmFtZWJ1Zikp
OworICAgIHBuYW1lID0gc3RyY2hyIChuYW1lYnVmLCAnLicpOworICAgIGlmIChwbmFtZSkgewor
CXBuYW1lID0gc3RyY2hyKHBuYW1lICsgMSwgJy4nKTsKKwlpZiAocG5hbWUpCisJICAgICpwbmFt
ZSA9ICdcMCc7CisgICAgfQorICAgIHJldHVybiAobmFtZWJ1Zik7Cit9CisKK3N0cnVjdCB1bmlx
bWFpbGlkICogCitmaW5kX3VuaXFpZCAoIGNoYXIgKiBtYWlsYm94bmFtZSwgY2hhciAqIG1haWxi
b3hpZCkgCit7CisgICAgc3RydWN0IHVuaXFtYWlsaWQgKnB1bmlxOworICAgIGNoYXIgKiBuYW1l
cHRyOworICAgIAorICAgIG5hbWVwdHIgPSBnZXRtYWlsbmFtZSAobWFpbGJveG5hbWUpOworICAg
IGZvciAocHVuaXEgPSB1bmlxbWlkX2hlYWQ7IHB1bmlxICE9IE5VTEw7IHB1bmlxID0gcHVuaXEt
PnVuaXFuZXh0KSB7CisJaWYgIChzdHJjbXAgKHB1bmlxLT51bmlxbWJ4aWQsIG1haWxib3hpZCkg
PT0gMCkgeworCSAgICBpZiAoc3RyY21wIChwdW5pcS0+dW5pcW5hbWUsIG5hbWVwdHIpID09IDAp
IHsKKwkJcmV0dXJuIChwdW5pcSk7CisJICAgIH0KKwl9CisgICAgfQorICAgIHJldHVybiBOVUxM
OworfQorc3RydWN0IHVuaXFtYWlsaWQgKiAKK2FkZF91bmlxaWQgKCBjaGFyICogbWFpbGJveG5h
bWUsIGNoYXIgKiBtYWlsYm94aWQpCit7CisgICAgc3RydWN0IHVuaXFtYWlsaWQgKnB1bmlxOwor
ICAgIGNoYXIgKnBib3huYW1lOworCisgICAgcGJveG5hbWUgPSBnZXRtYWlsbmFtZSAobWFpbGJv
eG5hbWUpOworCisgICAgcHVuaXEgPSB4bWFsbG9jIChzaXplb2YgKHN0cnVjdCB1bmlxbWFpbGlk
KSk7CisgICAgcHVuaXEtPnVuaXFtYnhpZCA9IHhzdHJkdXAobWFpbGJveGlkKTsKKyAgICBwdW5p
cS0+dW5pcW5hbWUgPSB4c3RyZHVwKHBib3huYW1lKTsKKyAgICAKKyAgICBwdW5pcS0+dW5pcW5l
eHQgPSB1bmlxbWlkX2hlYWQ7CisgICAgdW5pcW1pZF9oZWFkID0gcHVuaXE7CisKKyAgICByZXR1
cm4gKHB1bmlxKTsKK30KIC8qCiAgKiBSZWNvbnN0cnVjdCB0aGUgc2luZ2xlIG1haWxib3ggbmFt
ZWQgJ25hbWUnCiAgKi8KQEAgLTQzMiw2ICs3MTMsMTAgQEAKICAgICB1bnNpZ25lZCBsb25nICp1
aWQ7CiAgICAgaW50IHVpZF9udW0sIHVpZF9hbGxvYzsKIAorICAgIHVuc2lnbmVkIGxvbmcgKmV4
cHVpZDsKKyAgICBpbnQgZXhwdWlkX251bTsKKyAgICBpbnQgZXhwbXNnOworCiAgICAgaW50IG1z
Zywgb2xkX21zZyA9IDA7CiAgICAgaW50IG5ld19leGlzdHMgPSAwLCAKIAluZXdfYW5zd2VyZWQg
PSAwLApAQCAtNDUxLDcgKzczNiw4IEBACiAgICAgaW50IG15dHlwZTsKICAgICBjaGFyIG1icGF0
aFtNQVhfTUFJTEJPWF9QQVRIKzFdLCAqcGF0aDsKICAgICAKLSAgICBpbnQgZXhwdW5nZV9mZCA9
IC0xOworICAgIGludCBleHB1bmdlX2ZvdW5kOworICAgIGNoYXIgdW5pcXVlX2J1ZlszMl07CiAK
ICAgICAvKiBTdGFydCBieSBsb29raW5nIHVwIGN1cnJlbnQgZGF0YSBpbiBtYWlsYm94IGxpc3Qg
Ki8KICAgICByID0gbWJveGxpc3RfZGV0YWlsKG5hbWUsICZteXR5cGUsICZteXBhdGgsICZteW1w
YXRoLApAQCAtNTc2LDY0ICs4NjIsMTEgQEAKICAgICBmd3JpdGUoYnVmLCAxLCBJTkRFWF9IRUFE
RVJfU0laRSwgbmV3aW5kZXgpOwogICAgIHJldHJ5X3dyaXRlKG5ld2NhY2hlX2ZkLCBidWYsIHNp
emVvZihiaXQzMikpOwogCi0gICAgLyogUmVtb3ZlIGFueSBwcmV2aW91c2x5IGV4cHVuZ2VkIG1l
c3NhZ2VzICovCi0gICAgLyogWFhYICBGb3IgdHdvLXBoYXNlIHdlIHdpbGwgbmVlZCB0byBrZWVw
IHRoZSBtZXNzYWdlcyByZWZlcmVuY2VkCi0gICAgICAgaW4gY3lydXMuZXhwdW5nZSBhbmQgcmVm
cmVzaCBpdHMgaGVhZGVyIGFuZCBvZmZzZXRzICovCi0gICAgcGF0aCA9IChtYWlsYm94Lm1wYXRo
ICYmCi0JICAgIChjb25maWdfbWV0YXBhcnRpdGlvbl9maWxlcyAmCi0JICAgICBJTUFQX0VOVU1f
TUVUQVBBUlRJVElPTl9GSUxFU19FWFBVTkdFKSkgPwotCW1haWxib3gubXBhdGggOiBtYWlsYm94
LnBhdGg7Ci0gICAgc3RybGNweShmbmFtZWJ1ZiwgcGF0aCwgc2l6ZW9mKGZuYW1lYnVmKSk7Ci0g
ICAgc3RybGNhdChmbmFtZWJ1ZiwgRk5BTUVfRVhQVU5HRV9JTkRFWCwgc2l6ZW9mKGZuYW1lYnVm
KSk7Ci0gICAgaWYgKHN0YXQoZm5hbWVidWYsICZzYnVmKSAhPSAtMSAmJgotCXNidWYuc3Rfc2l6
ZSA+IE9GRlNFVF9MRUFLRURfQ0FDSEUgJiYKLQkoZXhwdW5nZV9mZCA9IG9wZW4oZm5hbWVidWYs
IE9fUkRPTkxZLCAwNjY2KSkgIT0gLTEpIHsKLQljb25zdCBjaGFyICppbmRleF9iYXNlID0gTlVM
TDsKLQl1bnNpZ25lZCBsb25nIGluZGV4X2xlbiA9IDA7CS8qIG1hcHBlZCBzaXplICovCi0JaW50
IGZvcm1hdCwgbWlub3JfdmVyc2lvbjsKLQl1bnNpZ25lZCBsb25nIHN0YXJ0X29mZnNldCwgcmVj
b3JkX3NpemUsIGV4aXN0czsKLQotCS8qIE1hcCB0aGUgZmlsZSAqLwotCW1hcF9yZWZyZXNoKGV4
cHVuZ2VfZmQsIDEsICZpbmRleF9iYXNlLAotCQkgICAgJmluZGV4X2xlbiwgc2J1Zi5zdF9zaXpl
LCAiZXhwdW5nZSIsIG1haWxib3gubmFtZSk7Ci0KLQlmb3JtYXQgPSBudG9obCgqKChiaXQzMiAq
KShpbmRleF9iYXNlK09GRlNFVF9GT1JNQVQpKSk7Ci0JbWlub3JfdmVyc2lvbiA9IG50b2hsKCoo
KGJpdDMyICopKGluZGV4X2Jhc2UrT0ZGU0VUX01JTk9SX1ZFUlNJT04pKSk7Ci0Jc3RhcnRfb2Zm
c2V0ID0gbnRvaGwoKigoYml0MzIgKikoaW5kZXhfYmFzZStPRkZTRVRfU1RBUlRfT0ZGU0VUKSkp
OwotCXJlY29yZF9zaXplID0gbnRvaGwoKigoYml0MzIgKikoaW5kZXhfYmFzZStPRkZTRVRfUkVD
T1JEX1NJWkUpKSk7Ci0JZXhpc3RzID0gbnRvaGwoKigoYml0MzIgKikoaW5kZXhfYmFzZStPRkZT
RVRfRVhJU1RTKSkpOwotCi0JLyogU2FuaXR5IGNoZWNrIHRoZSBoZWFkZXIgYXMgYmVzdCB3ZSBj
YW4gKi8KLQlpZiAoZm9ybWF0ID09IDAgJiYgZXhpc3RzICYmCi0JICAgIG1pbm9yX3ZlcnNpb24g
JiYgbWlub3JfdmVyc2lvbiA8PSBNQUlMQk9YX01JTk9SX1ZFUlNJT04gJiYKLQkgICAgc3RhcnRf
b2Zmc2V0ICYmIHN0YXJ0X29mZnNldCA8PSBJTkRFWF9IRUFERVJfU0laRSAmJgotCSAgICByZWNv
cmRfc2l6ZSAmJiByZWNvcmRfc2l6ZSA8PSBJTkRFWF9SRUNPUkRfU0laRSAmJgotCSAgICBzYnVm
LnN0X3NpemUgPj0gKHN0YXJ0X29mZnNldCArIGV4aXN0cyAqIHJlY29yZF9zaXplKSkgewotCSAg
ICB1bnNpZ25lZCBtc2dubzsKLQkgICAgY29uc3QgY2hhciAqcCA9IGluZGV4X2Jhc2UgKyBzdGFy
dF9vZmZzZXQ7Ci0KLQkgICAgLyogRGVsZXRlIG1lc3NhZ2UgZmlsZXMgKi8KLQkgICAgZm9yICht
c2dubyA9IDE7IG1zZ25vIDw9IGV4aXN0czsgbXNnbm8rKywgcCArPSByZWNvcmRfc2l6ZSkgewot
CQl1bnNpZ25lZCBsb25nIHVpZCA9IG50b2hsKCooKGJpdDMyICopKHAgKyBPRkZTRVRfVUlEKSkp
OwotCQljaGFyIG1zZ2ZuYW1lW01BSUxCT1hfRk5BTUVfTEVOKzFdOwotCi0JCS8qIFNhbml0eSBj
aGVjayBVSUQgKi8KLQkJaWYgKHVpZCA9PSAwKSB7Ci0JCSAgICBzeXNsb2coTE9HX0VSUiwgIklP
RVJST1I6ICVzIHplcm8gZXhwdW5nZSByZWNvcmQgJXUvJWx1IiwKLQkJCSAgIG1haWxib3gubmFt
ZSwgbXNnbm8sIGV4aXN0cyk7Ci0JCSAgICBicmVhazsKLQkJfQotCi0JCW1haWxib3hfbWVzc2Fn
ZV9nZXRfZm5hbWUoJm1haWxib3gsIHVpZCwKLQkJCQkJICBtc2dmbmFtZSwgc2l6ZW9mKG1zZ2Zu
YW1lKSk7Ci0JCXVubGluayhtc2dmbmFtZSk7Ci0JICAgIH0KLQl9Ci0KLQltYXBfZnJlZSgmaW5k
ZXhfYmFzZSwgJmluZGV4X2xlbik7Ci0JY2xvc2UoZXhwdW5nZV9mZCk7CisgICAgaWYgKHJlY29u
c3RydWN0X2V4cHVuZ2UgKCBwYXRoLCAgJm1haWxib3gsICZleHB1aWQsICZleHB1aWRfbnVtKSAh
PSAwKSB7CisJZmNsb3NlKG5ld2luZGV4KTsKKwltYWlsYm94X2Nsb3NlKCZtYWlsYm94KTsKKwly
ZXR1cm4gSU1BUF9JT0VSUk9SOwogICAgIH0KLSAgICB1bmxpbmsoZm5hbWVidWYpOwogCiAgICAg
LyogRmluZCBhbGwgbWVzc2FnZSBmaWxlcyBpbiBkaXJlY3RvcnkgKi8KICAgICB1aWQgPSAodW5z
aWduZWQgbG9uZyAqKSB4bWFsbG9jKFVJREdST1cgKiBzaXplb2YodW5zaWduZWQgbG9uZykpOwpA
QCAtNjQ3LDI5ICs4ODAsMjkgQEAKIAltYWlsYm94X2Nsb3NlKCZtYWlsYm94KTsKIAlmcmVlKHVp
ZCk7CiAJcmV0dXJuIElNQVBfSU9FUlJPUjsKLSAgICB9IGVsc2UgeworICAgIH0gCiAJd2hpbGUg
KChkaXJlbnQgPSByZWFkZGlyKGRpcnApKSE9TlVMTCkgewotCSAgICBpZiAoIWlzZGlnaXQoKGlu
dCkgKGRpcmVudC0+ZF9uYW1lWzBdKSkgfHwgZGlyZW50LT5kX25hbWVbMF0gPT0KLQkJJzAnKQor
CWlmICghaXNkaWdpdCgoaW50KSAoZGlyZW50LT5kX25hbWVbMF0pKSB8fCBkaXJlbnQtPmRfbmFt
ZVswXSA9PSAnMCcpCiAJCWNvbnRpbnVlOwotCSAgICBpZiAodWlkX251bSA9PSB1aWRfYWxsb2Mp
IHsKLQkJdWlkX2FsbG9jICs9IFVJREdST1c7Ci0JCXVpZCA9ICh1bnNpZ25lZCBsb25nICopCi0J
CSAgICB4cmVhbGxvYygoY2hhciAqKXVpZCwgdWlkX2FsbG9jICogc2l6ZW9mKHVuc2lnbmVkIGxv
bmcpKTsKLQkgICAgfQotCSAgICB1aWRbdWlkX251bV0gPSAwOwogCSAgICBwID0gZGlyZW50LT5k
X25hbWU7CisJbXNnID0gMDsKIAkgICAgd2hpbGUgKGlzZGlnaXQoKGludCkgKnApKSB7Ci0JCXVp
ZFt1aWRfbnVtXSA9IHVpZFt1aWRfbnVtXSAqIDEwICsgKnArKyAtICcwJzsKKwkgICAgbXNnID0g
bXNnICogMTAgKyAqcCsrIC0gJzAnOwogCSAgICB9CiAJICAgIGlmICgqcCsrICE9ICcuJykgY29u
dGludWU7CiAJICAgIGlmICgqcCkgY29udGludWU7CiAJICAgIAorCWlmICh1aWRfbnVtID09IHVp
ZF9hbGxvYykgeworCSAgICB1aWRfYWxsb2MgKz0gVUlER1JPVzsKKwkgICAgdWlkID0gKHVuc2ln
bmVkIGxvbmcgKikKKwkJIHhyZWFsbG9jKChjaGFyICopdWlkLCB1aWRfYWxsb2MgKiBzaXplb2Yo
dW5zaWduZWQgbG9uZykpOworCX0KKwl1aWRbdWlkX251bV0gPSBtc2c7CiAJICAgIHVpZF9udW0r
KzsKIAl9CiAJY2xvc2VkaXIoZGlycCk7CisKIAlxc29ydCgoY2hhciAqKXVpZCwgdWlkX251bSwg
c2l6ZW9mKCp1aWQpLCBjb21wYXJlX3VpZCk7Ci0gICAgfQogCiAgICAgLyogUHV0IGVhY2ggbWVz
c2FnZSBmaWxlIGluIHRoZSBuZXcgaW5kZXgvY2FjaGUgKi8KICAgICBvbGRfbXNnID0gMDsKQEAg
LTcwMyw2ICs5MzYsMjAgQEAKIAkgICAgY29udGludWU7CiAJfQogCisgICAgICAgIC8qIENoZWNr
IGlmIHRoaXMgbWVzc2FnZSBpcyBvbiB0aGUgZXhwdW5nZSBsaXN0ICovCisgICAgICAgIGV4cHVu
Z2VfZm91bmQgPSAwOworICAgICAgICBmb3IgKGV4cG1zZyA9IDA7IGV4cG1zZyA8IGV4cHVpZF9u
dW07IGV4cG1zZysrKSB7CisgICAgICAgICAgICBpZiAodWlkW21zZ10gPT0gZXhwdWlkIFtleHBt
c2ddKSB7CisgICAgICAgICAgICAgICAgZXhwdW5nZV9mb3VuZCA9IDE7CisgICAgICAgICAgICAg
ICAgYnJlYWs7CisgICAgICAgICAgICB9CisgICAgICAgICAgICBpZiAodWlkW21zZ10gPiBleHB1
aWQgW2V4cG1zZ10pIHsKKyAgICAgICAgICAgICAgICBicmVhazsKKyAgICAgICAgICAgIH0KKyAg
ICAgICAgfQorICAgICAgICBpZiAoIGV4cHVuZ2VfZm91bmQgPT0gMCApIHsKKyAgICAgICAgICAg
IAorCiAJLyogRmluZCBvbGQgaW5kZXggcmVjb3JkLCBpZiBpdCBleGlzdHMgKi8KIAl3aGlsZSAo
b2xkX21zZyA8IG1haWxib3guZXhpc3RzICYmIG9sZF9pbmRleC51aWQgPCB1aWRbbXNnXSkgewog
CSAgICBpZiAobWFpbGJveF9yZWFkX2luZGV4X3JlY29yZCgmbWFpbGJveCwgKytvbGRfbXNnLCAm
b2xkX2luZGV4KSkgewpAQCAtNzM3LDIyICs5ODQsMjggQEAKIAkgICAgLyogSWYgd2UgYXJlIHJl
Y292ZXJpbmcgYSBtZXNzYWdlLCByZXNldCBNT0RTRVEgKi8KIAkgICAgbWVzc2FnZV9pbmRleC5t
b2RzZXEgPSAxOwogCX0KKwogCW1lc3NhZ2VfaW5kZXgubGFzdF91cGRhdGVkID0gdGltZSgwKTsK
IAlpZiAobWVzc2FnZV9pbmRleC5tb2RzZXEgPiBtYWlsYm94LmhpZ2hlc3Rtb2RzZXEpIHsKIAkg
ICAgbWFpbGJveC5oaWdoZXN0bW9kc2VxID0gbWVzc2FnZV9pbmRleC5tb2RzZXE7CiAJfQogCQor
CX0JCiAJaWYgKCgociA9IG1lc3NhZ2VfcGFyc2VfZmlsZShtc2dmaWxlLCBOVUxMLCBOVUxMLCAm
Ym9keSkpICE9IDApIHx8CiAJICAgICgociA9IG1lc3NhZ2VfY3JlYXRlX3JlY29yZCgmbWFpbGJv
eCwgJm1lc3NhZ2VfaW5kZXgsIGJvZHkpKSAhPSAwKSkgewogCSAgICBmY2xvc2UobXNnZmlsZSk7
CiAJICAgIGZjbG9zZShuZXdpbmRleCk7CiAJICAgIG1haWxib3hfY2xvc2UoJm1haWxib3gpOwog
CSAgICBmcmVlKHVpZCk7CisJICAgIGlmIChleHB1aWRfbnVtKSB7IAorCQlmcmVlKGV4cHVpZCk7
CisJICAgIH0KIAkgICAgcmV0dXJuIHI7CiAJfQogCWZjbG9zZShtc2dmaWxlKTsKIAlpZiAoYm9k
eSkgbWVzc2FnZV9mcmVlX2JvZHkoYm9keSk7CiAJCisJaWYgKGV4cHVuZ2VfZm91bmQgPT0gMCkg
ewkKIAkvKiBXcml0ZSBvdXQgbmV3IGVudHJ5IGluIGluZGV4IGZpbGUgKi8KIAltYWlsYm94X2lu
ZGV4X3JlY29yZF90b19idWYoJm1lc3NhZ2VfaW5kZXgsIGJ1Zik7CiAKQEAgLTc2MSwxNSArMTAx
NCwyMSBAQAogCSAgICBmY2xvc2UobmV3aW5kZXgpOwogCSAgICBtYWlsYm94X2Nsb3NlKCZtYWls
Ym94KTsKIAkgICAgZnJlZSh1aWQpOworCQlpZiAoZXhwdWlkX251bSkgeyAKKwkJICAgIGZyZWUo
ZXhwdWlkKTsKKwkJfQogCSAgICByZXR1cm4gSU1BUF9JT0VSUk9SOwogCX0KLQogCW5ld19leGlz
dHMrKzsKIAlpZiAobWVzc2FnZV9pbmRleC5zeXN0ZW1fZmxhZ3MgJiBGTEFHX0FOU1dFUkVEKSBu
ZXdfYW5zd2VyZWQrKzsKIAlpZiAobWVzc2FnZV9pbmRleC5zeXN0ZW1fZmxhZ3MgJiBGTEFHX0ZM
QUdHRUQpIG5ld19mbGFnZ2VkKys7CiAJaWYgKG1lc3NhZ2VfaW5kZXguc3lzdGVtX2ZsYWdzICYg
RkxBR19ERUxFVEVEKSBuZXdfZGVsZXRlZCsrOwogCW5ld19xdW90YSArPSBtZXNzYWdlX2luZGV4
LnNpemU7CiAgICAgfQorICAgIH0KKyAgICBpZiAoZXhwdWlkX251bSkgeworCWZyZWUgKGV4cHVp
ZCk7CisgICAgfQogCiAgICAgaWYgKGJvZHkpIGZyZWUoYm9keSk7CiAgICAgCkBAIC04MzUsMTUg
KzEwOTQsMjcgQEAKIAogICAgIC8qIHZhbGlkYXRlIHVuaXF1ZWlkICovCiAgICAgaWYgKCFtYWls
Ym94LnVuaXF1ZWlkKSB7Ci0JY2hhciBidWZbMzJdOwogCiAJLyogdGhpcyBtYXkgY2hhbmdlIHVu
aXF1ZWlkLCBidXQgaWYgaXQgZG9lcywgbm90aGluZyB3ZSBjYW4gZG8KICAgICAgICAgICAgYWJv
dXQgaXQgKi8KLQltYWlsYm94X21ha2VfdW5pcXVlaWQobWFpbGJveC5uYW1lLCBtYWlsYm94LnVp
ZHZhbGlkaXR5LCBidWYsCi0JCQkgICAgICBzaXplb2YoYnVmKSk7Ci0JbWFpbGJveC51bmlxdWVp
ZCA9IHhzdHJkdXAoYnVmKTsKKwltYWlsYm94X21ha2VfdW5pcXVlaWQobWFpbGJveC5uYW1lLCBt
YWlsYm94LnVpZHZhbGlkaXR5LCB1bmlxdWVfYnVmLAorCQkJICAgICAgc2l6ZW9mKHVuaXF1ZV9i
dWYpKTsKKwltYWlsYm94LnVuaXF1ZWlkID0geHN0cmR1cCh1bmlxdWVfYnVmKTsKKyAgICB9IGVs
c2UgeworCWlmIChmaW5kX3VuaXFpZCAobWFpbGJveC5uYW1lLCBtYWlsYm94LnVuaXF1ZWlkKSAh
PSBOVUxMICkgeworICAgIAorCSAgICBtYWlsYm94X21ha2VfdW5pcXVlaWQobWFpbGJveC5uYW1l
LCBtYWlsYm94LnVpZHZhbGlkaXR5LCB1bmlxdWVfYnVmLAorCQkJICAgICAgc2l6ZW9mKHVuaXF1
ZV9idWYpKTsKKwkgICAgZnJlZSAobWFpbGJveC51bmlxdWVpZCk7CisJICAgIG1haWxib3gudW5p
cXVlaWQgPSB4c3RyZHVwKHVuaXF1ZV9idWYpOworCX0KKyAgICB9CisgICAgaWYgKGFkZF91bmlx
aWQgKG1haWxib3gubmFtZSwgIG1haWxib3gudW5pcXVlaWQpID09IE5VTEwpIHsKKwlzeXNsb2cg
KExPR19FUlIsICJGYWlsZWQgYWRkaW5nIG1haWxib3g6ICVzIHVuaXF1ZSBpZDogJXNcbiIsCisJ
CQkgbWFpbGJveC5uYW1lLCBtYWlsYm94LnVuaXF1ZWlkICk7CiAgICAgfQogICAgIAorICAgIAog
ICAgIC8qIFdyaXRlIGhlYWRlciAqLwogICAgIHIgPSBtYWlsYm94X3dyaXRlX2hlYWRlcigmbWFp
bGJveCk7CiAgICAgaWYgKHIpIHsKQEAgLTg4MSw2ICsxMTUyLDEwIEBACiAgICAgCiAgICAgZmNs
b3NlKG5ld2luZGV4KTsKICAgICByID0gc2Vlbl9yZWNvbnN0cnVjdCgmbWFpbGJveCwgKHRpbWVf
dCkwLCAodGltZV90KTAsIChpbnQgKCopKCkpMCwgKHZvaWQgKikwKTsKKyAgICBpZiAoc3luY2Zs
YWcpIHsKKwlzeW5jX2xvZ19tYWlsYm94KG1haWxib3gubmFtZSk7CisgICAgfQorCiAgICAgbWFp
bGJveF9jbG9zZSgmbWFpbGJveCk7CiAKICAgICBpZiAoZm91bmQpIHsKQEAgLTEwMjEsNyArMTI5
Niw3IEBACiAJKmFjbCsrID0gJ1wwJzsKIAogCWN5cnVzX2FjbF9zZXQoJm5ld2FjbCwgaWRlbnRp
ZmllciwgQUNMX01PREVfU0VULAotCQkgICAgICBjeXJ1c19hY2xfc3RydG9tYXNrKHJpZ2h0cyks
IGFjbGNhbm9ucHJvYywKKwkJICAgICAgY3lydXNfYWNsX3N0cnRvbWFzayhyaWdodHMsIDApLCBh
Y2xjYW5vbnByb2MsCiAJCSAgICAgICh2b2lkICopb3duZXIpOwogICAgIH0KIAo=
</data>        

          </attachment>
      

    </bug>

</bugzilla>