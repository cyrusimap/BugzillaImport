<?xml version="1.0" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugzilla.cyrusimap.org/bugzilla.dtd">

<bugzilla version="3.2.5.1-2"
          urlbase="https://bugzilla.cyrusimap.org/"
          maintainer="Dave McMurtrie &lt;dave64@andrew.cmu.edu&gt;"
>

    <bug>
          <bug_id>1409</bug_id>
          
          <creation_ts>2002-09-16 15:01 EDT</creation_ts>
          <short_desc>support for PgSQL as well as mysql</short_desc>
          <delta_ts>2010-10-25 18:46:30 EDT</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Cyrus SASL</product>
          <component>plugins</component>
          <version>2.1.x</version>
          <rep_platform>Other</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>CLOSED</bug_status>
          <resolution>FIXED</resolution>
          
          
          
          
          <priority>P2</priority>
          <bug_severity>enhancement</bug_severity>
          <target_milestone>Future</target_milestone>
          
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Rob Siemborski">rjs3@andrew.cmu.edu</reporter>
          <assigned_to name="Rob Siemborski">rjs3@andrew.cmu.edu</assigned_to>
          <cc>scrappy@hub.org</cc>
          

      

      

      
          <long_desc isprivate="0">
            <who name="Rob Siemborski">rjs3@andrew.cmu.edu</who>
            <bug_when>2002-09-16 15:01:34 EDT</bug_when>
            <thetext>this bug is to track the progress of unifying several SQL backends into a single
plugin.</thetext>
          </long_desc>
          <long_desc isprivate="0">
            <who name="Rob Siemborski">rjs3@andrew.cmu.edu</who>
            <bug_when>2002-09-16 15:02:38 EDT</bug_when>
            <thetext>Created an attachment (id=78)
sample sql.c #ifdef implementation for MySQL and PgSQL

attached sql.c.  Not sure if we want to go to this, since it isn&apos;t runtime
configurable, though there are arguments for and against.</thetext>
          </long_desc>
          <long_desc isprivate="0">
            <who name="Rob Siemborski">rjs3@andrew.cmu.edu</who>
            <bug_when>2002-09-16 15:03:12 EDT</bug_when>
            <thetext>note that the above attachment requires changes to configure which I don&apos;t have.</thetext>
          </long_desc>
          <long_desc isprivate="0">
            <who name="Rob Siemborski">rjs3@andrew.cmu.edu</who>
            <bug_when>2003-08-08 14:37:37 EDT</bug_when>
            <thetext>pgsql support is in cvs</thetext>
          </long_desc>
      
          <attachment
              isobsolete="0"
              ispatch="0"
              isprivate="0"
          >
            <attachid>78</attachid>
            <date>2002-09-16 15:02 EDT</date>
            <desc>sample sql.c #ifdef implementation for MySQL and PgSQL</desc>
            <filename>sql.c</filename>
            <type>text/plain</type>
            <size>14612</size>
            <attacher>rjs3@andrew.cmu.edu</attacher>
            
              <data encoding="base64">LyoKKioKKiogc3FsIEF1eHByb3AgcGx1Z2luCioqICAgYnkgTWFyYyBHLiBGb3VybmllciA8c2Ny
YXBweUBodWIub3JnPgoqKiAgIGJhc2VkIG9uIGNvZGUgYnkgU2ltb24gTG9hZGVyCioqCioqICRJ
ZDokCioqCioqICBBdXhpbGlhcnkgcHJvcGVydHkgcGx1Z2luIGZvciBTYXNsIDIuMS54CioqCioq
ICAgVGhlIHBsdWdpbiB1c2VzIHRoZSBmb2xsb3dpbmcgb3B0aW9ucyBpbiB0aGUKKiogc2FzbCBh
cHBsaWNhdGlvbiBjb25maWcgZmlsZSAoIHVzdWFsbHkgaW4gL3Vzci9saWIvc2FzbDIgKQoqKgoq
KiAgc3FsX3VzZXI6IDx1c2VybmFtZSB0byBsb2dpbiBhcz4KKiogIHNxbF9wYXNzd2Q6IDxwYXNz
d29yZCB0byB1c2U+CioqICBzcWxfaG9zdG5hbWVzOiA8IGNvbW1hIHNlcHJhdGVkIGhvc3QgbGlz
dCA+CioqICBzcWxfZGF0YWJhc2U6IDxkYXRhYmFzZSB0byBjb25uZWN0IHRvPgoqKiAgc3FsX3N0
YXRlbWVudDogPHNlbGVjdCBzdGF0ZW1lbnQgdG8gdXNlPgoqKiAgc3FsX3ZlcmJvc2U6ICAoIGlm
IGl0IGV4aXN0cyB3aWxsIHByaW50IHNlbGVjdCBzdGF0ZW1lbnQgdG8gc3lzbG9nICkKKioKKiog
ICBUaGUgc2VsZWN0IHN0YXRlbWVudCB1c2VkIGluIHRoZSBvcHRpb24gc3FsX3N0YXRlbWVudCBp
cyBwYXJzZWQKKiogZm9yIDMgcGxhY2UgaG9sZGVycyAldSAlciBhbmQgJXAgdGhleSBhcmUgcmVw
bGFjZWQgd2l0aCB1c2VybmFtZQoqKiByZWFsbSBhbmQgcHJvcGVydHkgcmVxdWlyZWQgcmVzcGVj
dGl2ZWx5LgoqKgoqKiAgZS5nCioqICAgIHNxbF9zdGF0ZW1lbnQ6IHNlbGVjdCAlcCBmcm9tIHVz
ZXJfdGFibGUgd2hlcmUgdXNlcm5hbWUgPSAldSBhbmQKKiogICAgcmVhbG0gPSAlcgoqKiAgd291
bGQgcHJvZHVjZSBhIHN0YXRlbWVudCBsaWtlIHRoaXMgOi0KKioKKiogICAgIHNlbGVjdCB1c2Vy
UGFzc3dvcmQgZnJvbSB1c2VyX3RhYmxlIHdoZXJlIHVzZXJuYW1lID0gc2ltb24KKiogICAgIGFu
ZCByZWFsbSA9IG1hZG9rYS5zdXJmLm9yZy51awoqKgoqKiAgIFByZXN1bWluZyB1c2VybmFtZSBp
cyBzaW1vbiwgdGhlIHNhc2wgYXBwbGljYXRpb24gaXMgdHJ5aW5nIHRvCioqICAgYXV0aGVudGlj
YXRlIGFuZCB5b3UgZGlkbid0IGhhdmUgYSByZWFsbSB0byBzdGFydCB3aXRoIChhbmQgaXQgd2Fz
CioqICAgbXkgY29tcHV0ZXIpLgoqKgoqKiBPSyBzbyB0aGF0cyBhIGJpdCBjb21wbGV4IGJ1dCBl
c3NlbnRpYWwKKiogICAldSBpcyB0aGUgdXNlcm5hbWUgdGhlIHVzZXIgbG9nZ2VkIGluIGFzCioq
ICAgJXAgaXMgdGhlIHByb3BlcnR5IHJlcXVlc3RlZCB0aGlzIGNvdWxkIHRlY2huaWNhbGx5IGJl
IGFueXRoaW5nCioqICAgICBidXQgc2FzbCBhdXRoZW50aWNhdGlvbiB3aWxsIHRyeSB1c2VyUGFz
c3dvcmQgYW5kCioqICAgICBjbXVzYXNsc2VjcmV0TUVDSE5BTUUgKHdoZXJlIE1FQ0hOQU1FIGlz
IHRoZSBuYW1lIG9mIGEgbWVjaGFuaXNtKS4KKiogICAlciBpcyB0aGUgcmVhbG0gd2hpY2ggY291
bGQgYmUgdGhlIGtlcmJyb3MgcmVhbG0sIHRoZSBGUUROIG9mIHRoZSAKKiogICAgIGNvbXB1dGVy
IHRoZSBzYXNsIGFwcCBpcyBvbiBvciB3aGF0IGV2ZXIgaXMgYWZ0ZXIgdGhlIEAgb24gYSB1c2Vy
bmFtZS4KKiogCioqICAgVGhlc2UgZG8gbm90IGhhdmUgdG8gYmUgYWxsIHVzZWQgb3IgdXNlZCBh
dCBhbGwKKiogaW4gdGVzdGluZyBJIHVzZWQgc2VsZWN0IHBhc3N3b3JkIGZyb20gYXV0aCB3aGVy
ZSB1c2VybmFtZSA9ICcldScKKiogICAgIAoqLwoKI2luY2x1ZGUgPGNvbmZpZy5oPgoKLyogY2hl
Y2twdyBzdHVmZiAqLwoKI2luY2x1ZGUgPHN0ZGlvLmg+CiNpbmNsdWRlIDxhc3NlcnQuaD4KCiNp
bmNsdWRlICJzYXNsLmgiCiNpbmNsdWRlICJzYXNsdXRpbC5oIgojaW5jbHVkZSAic2FzbHBsdWcu
aCIKCiNpZmRlZiBVU0VfUEdTUUwKIyBpbmNsdWRlIDxsaWJwcS1mZS5oPgojZWxzZQojIGlmZGVm
IFVTRV9NWVNRTAojICBpbmNsdWRlIDxteXNxbC5oPgojIGVsc2UKIyAgZXJyb3IgIk9ubHkgUGdT
UUwgYW5kIE15U1FMIGN1cnJlbnRseSBzdXBwb3J0ZWQiCiMgZW5kaWYKI2VuZGlmCgojaW5jbHVk
ZSA8Y3R5cGUuaD4KCiNpbmNsdWRlICJwbHVnaW5fY29tbW9uLmgiCgp0eXBlZGVmIHN0cnVjdCBz
cWxfc2V0dGluZ3MgewogICAgY29uc3QgY2hhciAqc3FsX3VzZXI7CiAgICBjb25zdCBjaGFyICpz
cWxfcGFzc3dkOwogICAgY29uc3QgY2hhciAqc3FsX2hvc3RuYW1lczsKICAgIGNvbnN0IGNoYXIg
KnNxbF9kYXRhYmFzZTsKICAgIGNvbnN0IGNoYXIgKnNxbF9zdGF0ZW1lbnQ7CiAgICBpbnQgc3Fs
X3ZlcmJvc2U7CiAgICBpbnQgaGF2ZV9zZXR0aW5nczsKfSBzcWxfc2V0dGluZ3NfdDsKCnN0YXRp
YyBjb25zdCBjaGFyICogU1FMX0JMQU5LX1NUUklORyA9ICIiOwoKLyoKKiogIHNxbF9jcmVhdGVf
c3RhdGVtbmV0CioqICAgdXNlcyBzZWxlY3QgbGluZSBhbmQgYWxsb2NhdGUgbWVtb3J5IHRvIHJl
cGxhY2UKKiogIFBhcnRzIHdpdGggdGhlIHN0cmluZ3MgcHJvdmlkZWQuCioqICAgJTxjaGFyPiA9
ICBubyBjaGFuZ2UKKiogICAlJSA9ICUKKiogICAldSA9IHVzZXIKKiogICAlcCA9IHByb3AKKiog
ICAlciA9IHJlYWxtCioqICBlLmcgc2VsZWN0ICVwIGZyb20gYXV0aCB3aGVyZSB1c2VyID0gJXAg
YW5kIGRvbWFpbiA9ICVyOwoqKiAgTm90ZTogY2FsbGluZyBmdW5jdGlvbiBtdXN0IGZyZWUgbWVt
b3J5LgoqKgoqLwpzdGF0aWMgY2hhciAqc3FsX2NyZWF0ZV9zdGF0ZW1lbnQoc2FzbF9zZXJ2ZXJf
cGFyYW1zX3QgKnNwYXJhbXMsCgkJCQkgICAgY29uc3QgY2hhciAqc2VsZWN0X2xpbmUsIGNvbnN0
IGNoYXIgKnByb3AsCgkJCQkgICAgY29uc3QgY2hhciAqdXNlciwgY29uc3QgY2hhciAqcmVhbG0p
CnsKICAgIGNvbnN0IGNoYXIgKnB0ciwqbGluZV9wdHI7CiAgICBjaGFyICpidWYsKmJ1Zl9wdHI7
CiAgICBpbnQgZmlsdGVyc2l6ZSA9IDA7CiAgICBpbnQgdWxlbiA9IDAsIHBsZW4gPSAwLCBybGVu
ID0gMDsKICAgIAogICAgLyogKysrKyB0aGlzIGNvdWxkIGJlIG1vZHVsaXNlZCBtb3JlICovCiAg
ICAvKiBjYWxjdWxhdGUgbWVtb3J5IG5lZWRlZCBmb3IgY3JlYXRpbmcgCiAgICAgICB0aGUgY29t
cGxldGUgZmlsdGVyIHN0cmluZy4gKi8KICAgIHB0ciA9IHNlbGVjdF9saW5lOwogICAgCiAgICAv
KiB3ZSBjYW4gdXNlIHN0cnRvayB0byBnZXQgYWxsIHZhcnMgKi8KICAgIHdoaWxlICggKHB0ciA9
IHN0cmNocihwdHIsJyUnKSkgKSB7CglwdHIrKzsKCXN3aXRjaCAoICpwdHIgKSB7CgljYXNlICcl
JzoKCSAgICBmaWx0ZXJzaXplLS07ICAvKiB3ZSBhcmUgYWN0dWxseSBkZWxldGluZyBhIGNoYXJh
Y3RlciAqLwoJICAgIGJyZWFrOwoJY2FzZSAndSc6CgkgICAgdWxlbiA9IHN0cmxlbih1c2VyKTsK
CSAgICBmaWx0ZXJzaXplICs9IHVsZW4tMjsKCSAgICBicmVhazsKCWNhc2UgJ3InOgoJICAgIHJs
ZW4gPSBzdHJsZW4ocmVhbG0pOwoJICAgIGZpbHRlcnNpemUgKz0gcmxlbi0yOwoJICAgIGJyZWFr
OwoJY2FzZSAncCc6CgkgICAgcGxlbiA9IHN0cmxlbihwcm9wKTsKCSAgICBmaWx0ZXJzaXplICs9
IHBsZW4tMjsKCSAgICBicmVhazsKCWRlZmF1bHQ6CgkgICAgYnJlYWs7Cgl9CiAgICB9CiAgICAK
ICAgIC8qIGRvbid0IGZvcmdldCB0aGUgdHJhaWxpbmcgMHgwICovCiAgICBmaWx0ZXJzaXplID0g
ZmlsdGVyc2l6ZStzdHJsZW4oc2VsZWN0X2xpbmUpKzE7CiAgICAKICAgIC8qIG9rLCBub3cgdHJ5
IHRvIGFsbG9jYXRlIGEgY2h1bmsgb2YgdGhhdCBzaXplICovCiAgICBidWYgPSAoY2hhciAqKXNw
YXJhbXMtPnV0aWxzLT5tYWxsb2MoZmlsdGVyc2l6ZSk7CiAgICBpZiAoIWJ1ZikKCXJldHVybiBO
VUxMOwogICAgCiAgICBidWZfcHRyID0gYnVmOwogICAgbGluZV9wdHIgPSBzZWxlY3RfbGluZTsK
ICAgIAogICAgLyogcmVwbGFjZSB0aGUgc3RyaW5ncyAqLwogICAgd2hpbGUgKCAocHRyID0gc3Ry
Y2hyKGxpbmVfcHRyLCclJykpICkgewoJLyogY29weSB1cCB0byBidXQgbm90IGluY2x1ZGluZyB0
aGUgbmV4dCAlICovCgltZW1jcHkoYnVmX3B0cixsaW5lX3B0cixwdHIgLSBsaW5lX3B0cik7IAoJ
YnVmX3B0ciArPSBwdHIgLSBsaW5lX3B0cjsKCXB0cisrOwoJc3dpdGNoIChwdHJbMF0pIHsKCWNh
c2UgJyUnOgoJICAgIGJ1Zl9wdHJbMF0gPSAnJSc7CgkgICAgYnVmX3B0cisrOwoJICAgIGJyZWFr
OwoJY2FzZSAndSc6CgkgICAgbWVtY3B5KGJ1Zl9wdHIsdXNlcix1bGVuKTsKCSAgICBidWZfcHRy
ICs9IHVsZW47CgkgICAgYnJlYWs7CgljYXNlICdyJzoKCSAgICBtZW1jcHkoYnVmX3B0cixyZWFs
bSxybGVuKTsKCSAgICBidWZfcHRyICs9IHJsZW47CgkgICAgYnJlYWs7CgljYXNlICdwJzoKCSAg
ICBtZW1jcHkoYnVmX3B0cixwcm9wLHBsZW4pOwoJICAgIGJ1Zl9wdHIgKz0gcGxlbjsKCSAgICBi
cmVhazsKCWRlZmF1bHQ6CgkgICAgYnVmX3B0clswXSA9ICclJzsKCSAgICBidWZfcHRyWzFdID0g
cHRyWzBdOwoJICAgIGJ1Zl9wdHIgKz0gMjsKCSAgICBicmVhazsKCX0KCXB0cisrOwoJbGluZV9w
dHIgPSBwdHI7CiAgICB9CiAgICAvKiBub3cgY29weSB0aGUgbGFzdCBiaXQgKi8KICAgIG1lbWNw
eShidWZfcHRyLGxpbmVfcHRyLHN0cmxlbihsaW5lX3B0cikrMSk7IC8qIHdlIG5lZWQgdGhlIG51
bGwgKi8KICAgIHJldHVybihidWYpOwp9CgovKiBzcWxfZ2V0X3NldHRpbmdzCioqCioqICBHZXQg
dGhlIGF1eHByb3Agc2V0dGluZ3MgYW5kIHB1dCB0aGVtIGluIAoqKiBUaGUgZ2xvYmFsIGNvbnRl
eHQgYXJyYXkKKi8Kdm9pZCBzcWxfZ2V0X3NldHRpbmdzKGNvbnN0IHNhc2xfdXRpbHNfdCAqdXRp
bHMsdm9pZCAqZ2xvYl9jb250ZXh0KSB7CiAgICBzdHJ1Y3Qgc3FsX3NldHRpbmdzICpzZXR0aW5n
czsKICAgIGludCByOwogICAgY2hhciAqdmVyYm9zZV90ZXN0OwogICAgCiAgICBzZXR0aW5ncyA9
IChzdHJ1Y3Qgc3FsX3NldHRpbmdzICopZ2xvYl9jb250ZXh0OwogICAgLyogZG8gSSBoYXZlIHRv
IGFsbG9jYXRlIG1lbW9yeSBmb3IgdGhlIHZhcnMgb25seSB0ZXN0aW5nIHdpbGwgdGVsbCAqLwog
ICAgLyooIHByb2JhYmx5ICkqLwogICAgaWYgKCBzZXR0aW5ncy0+aGF2ZV9zZXR0aW5ncyA9PSAw
ICkgewoJdXRpbHMtPmdldG9wdCh1dGlscy0+Z2V0b3B0X2NvbnRleHQsCgkJICAgICAgIlNRTCIs
InNxbF92ZXJib3NlIiwKCQkgICAgICAoY29uc3QgY2hhciAqKikmdmVyYm9zZV90ZXN0LE5VTEwp
OwoJaWYgKCB2ZXJib3NlX3Rlc3QgIT0gTlVMTCApIHsKCSAgICBzZXR0aW5ncy0+c3FsX3ZlcmJv
c2UgPSAxOwoJICAgIHV0aWxzLT5sb2coTlVMTCwgU0FTTF9MT0dfV0FSTiwKCQkgICAgICAgInNx
bCBhdXhwcm9wIHBsdWdpbiBoYXMgYmVlbiByZXF1ZXN0ZWRcbiIpOwoJfSBlbHNlIHsKCSAgICBz
ZXR0aW5ncy0+c3FsX3ZlcmJvc2UgPSAwOwoJfQoJCglyID0gdXRpbHMtPmdldG9wdCh1dGlscy0+
Z2V0b3B0X2NvbnRleHQsIlNRTCIsInNxbF91c2VyIiwKCQkJICAmc2V0dGluZ3MtPnNxbF91c2Vy
LE5VTEwpOwoJaWYgKCByIHx8ICFzZXR0aW5ncy0+c3FsX3VzZXIgKSB7CgkgICAgLyogc2V0IGl0
IHRvIGEgYmxhbmsgc3RyaW5nICovCgkgICAgc2V0dGluZ3MtPnNxbF91c2VyID0gU1FMX0JMQU5L
X1NUUklORzsKCX0KICAJciA9IHV0aWxzLT5nZXRvcHQodXRpbHMtPmdldG9wdF9jb250ZXh0LCJT
UUwiLCAic3FsX3Bhc3N3ZCIsCgkJCSAgJnNldHRpbmdzLT5zcWxfcGFzc3dkLCBOVUxMKTsKICAJ
aWYgKCByIHx8ICFzZXR0aW5ncy0+c3FsX3Bhc3N3ZCApIHsKCSAgICBzZXR0aW5ncy0+c3FsX3Bh
c3N3ZCA9IFNRTF9CTEFOS19TVFJJTkc7CiAgCX0KCXIgPSB1dGlscy0+Z2V0b3B0KHV0aWxzLT5n
ZXRvcHRfY29udGV4dCwiU1FMIiwgInNxbF9ob3N0bmFtZXMiLAoJCQkgICZzZXR0aW5ncy0+c3Fs
X2hvc3RuYW1lcywgTlVMTCk7CglpZiAoIHIgfHwgIXNldHRpbmdzLT5zcWxfaG9zdG5hbWVzICkg
ewoJICAgIHNldHRpbmdzLT5zcWxfaG9zdG5hbWVzID0gU1FMX0JMQU5LX1NUUklORzsKCX0KCXIg
PSB1dGlscy0+Z2V0b3B0KHV0aWxzLT5nZXRvcHRfY29udGV4dCwiU1FMIiwgInNxbF9kYXRhYmFz
ZSIsCgkJCSAgJnNldHRpbmdzLT5zcWxfZGF0YWJhc2UsIE5VTEwpOwoJaWYgKCByIHx8ICFzZXR0
aW5ncy0+c3FsX2RhdGFiYXNlICkgewoJICAgIHNldHRpbmdzLT5zcWxfZGF0YWJhc2UgPSBTUUxf
QkxBTktfU1RSSU5HOwoJfQoJciA9IHV0aWxzLT5nZXRvcHQodXRpbHMtPmdldG9wdF9jb250ZXh0
LCJTUUwiLCAic3FsX3N0YXRlbWVudCIsCgkJICAgICAgICAgICZzZXR0aW5ncy0+c3FsX3N0YXRl
bWVudCwgTlVMTCk7CglpZiAoIHIgfHwgIXNldHRpbmdzLT5zcWxfc3RhdGVtZW50ICkgewoJICAg
IHNldHRpbmdzLT5zcWxfc3RhdGVtZW50ID0gU1FMX0JMQU5LX1NUUklORzsKCX0KCXNldHRpbmdz
LT5oYXZlX3NldHRpbmdzID0gMTsKICAgIH0KfQoKc3RhdGljIHZvaWQgc3FsX2F1eHByb3BfbG9v
a3VwKHZvaWQgKmdsb2JfY29udGV4dCwKCQkJCSBzYXNsX3NlcnZlcl9wYXJhbXNfdCAqc3BhcmFt
cywKCQkJCSB1bnNpZ25lZCBmbGFncywKCQkJCSBjb25zdCBjaGFyICp1c2VyLAoJCQkJIHVuc2ln
bmVkIHVsZW4pIAp7CiAgICBjaGFyICp1c2VyaWQgPSBOVUxMOwogICAgLyogcmVhbG0gY291bGQg
YmUgdXNlZCBmb3Igc29tZXRoaW5nIGNsZXZlciAqLwogICAgY2hhciAqcmVhbG0gPSBOVUxMOwog
ICAgY29uc3QgY2hhciAqdXNlcl9yZWFsbSA9IE5VTEw7CiAgICBjb25zdCBzdHJ1Y3QgcHJvcHZh
bCAqdG9fZmV0Y2gsICpjdXI7CiAgICBjaGFyIHZhbHVlWzgxOTJdOwogICAgc2l6ZV90IHZhbHVl
X2xlbjsKICAgIAogICAgaW50IHJvd19jb3VudDsKICAgIGNoYXIgKnVzZXJfYnVmOwogICAgY2hh
ciAqZGJfaG9zdF9wdHIgPSBOVUxMOwogICAgY2hhciAqZGJfaG9zdCA9IE5VTEw7CiAgICBjaGFy
ICpjdXJfaG9zdDsKICAgIGNoYXIgKnF1ZXJ5ID0gTlVMTDsKICAgIGNoYXIgKmVzY2FwX3VzZXJp
ZCA9IE5VTEw7CiAgICBjaGFyICplc2NhcF9yZWFsbSA9IE5VTEw7CiAgICBzdHJ1Y3Qgc3FsX3Nl
dHRpbmdzICpzZXR0aW5nczsKI2lmZGVmIFVTRV9QR1NRTAogICAgUEdjb25uICpjb25uID0gTlVM
TDsKICAgIFBHcmVzdWx0ICpyZXN1bHQ7CiNlbHNlCiMgaWZkZWYgVVNFX01ZU1FMCiAgICBNWVNR
TCBteXNxbCwqY29ubj0gTlVMTDsKICAgIE1ZU1FMX1JFUyAqcmVzdWx0OwogICAgTVlTUUxfUk9X
IHJvdzsKIyBlbmRpZgojZW5kaWYKICAgIAogICAgLyogc2V0dXAgdGhlIHNldHRpbmdzICovCiAg
ICBzZXR0aW5ncyA9IChzdHJ1Y3Qgc3FsX3NldHRpbmdzICopZ2xvYl9jb250ZXh0OwogICAgc3Fs
X2dldF9zZXR0aW5ncyhzcGFyYW1zLT51dGlscyxnbG9iX2NvbnRleHQpOwogICAgCiAgICBpZigh
c3BhcmFtcyB8fCAhdXNlcikgcmV0dXJuOwogICAgCiAgICBpZiAoIHNldHRpbmdzLT5zcWxfdmVy
Ym9zZSApCglzcGFyYW1zLT51dGlscy0+bG9nKE5VTEwsIFNBU0xfTE9HX1dBUk4sCgkJCSAgICAi
c3FsIHBsdWdpbiBQYXJzZSB0aGUgdXNlcm5hbWUgJXNcbiIsIHVzZXIpOwogICAgCiAgICB1c2Vy
X2J1ZiA9IHNwYXJhbXMtPnV0aWxzLT5tYWxsb2ModWxlbiArIDEpOwogICAgaWYoIXVzZXJfYnVm
KQoJZ290byBkb25lOwogICAgCiAgICBtZW1jcHkodXNlcl9idWYsIHVzZXIsIHVsZW4pOwogICAg
dXNlcl9idWZbdWxlbl0gPSAnXDAnOwogICAgCiAgICBpZihzcGFyYW1zLT51c2VyX3JlYWxtKSB7
Cgl1c2VyX3JlYWxtID0gc3BhcmFtcy0+dXNlcl9yZWFsbTsKICAgIH0gZWxzZSB7Cgl1c2VyX3Jl
YWxtID0gc3BhcmFtcy0+c2VydmVyRlFETjsKICAgIH0KICAgIAogICAgaWYgKF9wbHVnX3BhcnNl
dXNlcihzcGFyYW1zLT51dGlscywgJnVzZXJpZCwgJnJlYWxtLCB1c2VyX3JlYWxtLAoJCQlzcGFy
YW1zLT5zZXJ2ZXJGUUROLCB1c2VyX2J1ZikgIT0gU0FTTF9PSyApCglnb3RvIGRvbmU7CiAgICAK
ICAgIC8qIGp1c3QgbmVlZCB0byBlc2NhcGUgdXNlcmlkIGFuZCByZWFsbSBub3cgKi8KICAgIC8q
IGFsbG9jYXRlIHNvbWUgbWVtb3J5ICovCiAgICBlc2NhcF91c2VyaWQgPSAoY2hhciAqKXNwYXJh
bXMtPnV0aWxzLT5tYWxsb2Moc3RybGVuKHVzZXJpZCkqMisxKTsKICAgIGVzY2FwX3JlYWxtID0g
KGNoYXIgKilzcGFyYW1zLT51dGlscy0+bWFsbG9jKHN0cmxlbihyZWFsbSkqMisxKTsKICAgIAog
ICAgaWYgKCFlc2NhcF91c2VyaWQgfHwgIWVzY2FwX3JlYWxtKSB7CglNRU1FUlJPUihzcGFyYW1z
LT51dGlscyk7Cglnb3RvIGRvbmU7CiAgICB9CiAgICAKICAgIC8qKioqKioqKioqKioqKioqKioq
KioqKioqKioqKioqKioqKioqLwogICAgCiAgICAvKiBmaW5kIG91dCB3aGF0IHdlIG5lZWQgdG8g
Z2V0ICovCiAgICAvKiB0aGlzIGNvcnJ1cHRzIGNvbnN0IGNoYXIgKnVzZXIgKi8KICAgIHRvX2Zl
dGNoID0gc3BhcmFtcy0+dXRpbHMtPnByb3BfZ2V0KHNwYXJhbXMtPnByb3BjdHgpOwogICAgaWYo
IXRvX2ZldGNoKSBnb3RvIGRvbmU7CiAgICAKICAgIC8qIG5vdyBsb29wIGFyb3VuZCBob3N0bmFt
ZXMgdGlsbCB3ZSBnZXQgYSBjb25uZWN0aW9uIAogICAgKiogaXQgc2hvdWxkIHByb2JhYmx5IHNh
dmUgdGhlIGNvbm5lY3Rpb24gYnV0IGZvciAKICAgICoqIG5vdyB3ZSB3aWxsIGp1c3QgZGlzY29u
bmVjdCBldmV5cnRpbWUKICAgICovCiAgICBpZiAoIHNldHRpbmdzLT5zcWxfdmVyYm9zZSApCglz
cGFyYW1zLT51dGlscy0+bG9nKE5VTEwsIFNBU0xfTE9HX1dBUk4sCgkJCSAgICAic3FsIHBsdWdp
biB0cnkgYW5kIGNvbm5lY3QgdG8gYSBob3N0XG4iKTsKICAgIAogICAgLyogY3JlYXRlIGEgd29y
a2luZyB2ZXJzaW9uIG9mIHRoZSBob3N0bmFtZXMgKi8KICAgIF9wbHVnX3N0cmR1cChzcGFyYW1z
LT51dGlscywgc2V0dGluZ3MtPnNxbF9ob3N0bmFtZXMsCgkJICZkYl9ob3N0X3B0ciwgTlVMTCk7
CiAgICBkYl9ob3N0ID0gZGJfaG9zdF9wdHI7CiAgICBjdXJfaG9zdCA9IGRiX2hvc3Q7CiAgICB3
aGlsZSAoIGN1cl9ob3N0ICE9IE5VTEwgKSB7CglkYl9ob3N0ID0gc3RyY2hyKGRiX2hvc3QsJywn
KTsKCWlmICggZGJfaG9zdCAhPSBOVUxMICkgeyAgCgkgICAgZGJfaG9zdFswXSA9ICdcMCc7Cgkg
ICAgLyogbG9vcCB0aWxsIHdlIGZpbmQgc29tZSB0ZXh0ICovCgkgICAgd2hpbGUgKCFpc2FsbnVt
KGRiX2hvc3RbMF0pKQoJCWRiX2hvc3QrKzsKCX0KCQoJaWYgKHNldHRpbmdzLT5zcWxfdmVyYm9z
ZSkKCSAgICBzcGFyYW1zLT51dGlscy0+bG9nKE5VTEwsIFNBU0xfTE9HX1dBUk4sCgkJCQkic3Fs
IHBsdWdpbiB0cnkgYW5kIGNvbm5lY3QgdG8gJXNcbiIsCgkJCQljdXJfaG9zdCk7CgojaWZkZWYg
VVNFX1BHU1FMCiAgICAgICAgY29ubiA9IFBRc2V0ZGIoY3VyX2hvc3QsICI1NDMyIiwgIiIsICIi
LCBzZXR0aW5ncy0+c3FsX2RhdGFiYXNlKTsKCWlmIChQUXN0YXR1cyhjb25uKSA9PSBDT05ORUNU
SU9OX0JBRCkgYnJlYWs7CiNlbHNlCiMgaWZkZWYgVVNFX01ZU1FMCiAgICAgICAgY29ubiA9IG15
c3FsX2Nvbm5lY3QoJm15c3FsLGN1cl9ob3N0LHNldHRpbmdzLT5teXNxbF91c2VyLAogICAgICAg
ICAgICAgICAgICAgICAgICAgICAgIHNldHRpbmdzLT5teXNxbF9wYXNzd2QpOwogICAgICAgIGlm
ICghY29ubikgYnJlYWs7CiMgZW5kaWYKI2VuZGlmCgkKCWN1cl9ob3N0ID0gZGJfaG9zdDsKICAg
IH0KCiNpZmRlZiBVU0VfUEdTUUwgICAgCiAgICBpZiAoUFFzdGF0dXMoY29ubikgPT0gQ09OTkVD
VElPTl9CQUQpIHsKI2Vsc2UKIyBpZmRlZiBVU0VfTVlTUUwKICAgIGlmICggIXNvY2sgKSB7CiMg
ZW5kaWYKI2VuZGlmCglzcGFyYW1zLT51dGlscy0+bG9nKE5VTEwsIFNBU0xfTE9HX0VSUiwKCQkJ
ICAgICJzcWwgcGx1Z2luIGNvdWxkbnQgY29ubmVjdCB0byBhbnkgaG9zdFxuIik7Cglnb3RvIGRv
bmU7CiAgICB9CiAgICAvKiBlc2NhcGUgb3V0ICovCiNpZmRlZiBVU0VfUEdTUUwKICAgIFBRZXNj
YXBlU3RyaW5nKGVzY2FwX3VzZXJpZCx1c2VyaWQsc3RybGVuKHVzZXJpZCkpOwogICAgUFFlc2Nh
cGVTdHJpbmcoZXNjYXBfcmVhbG0scmVhbG0sc3RybGVuKHJlYWxtKSk7CiNlbHNlCiMgaWZkZWYg
VVNFX01ZU1FMCiAgICBteXNxbF9yZWFsX2VzY2FwZV9zdHJpbmcoJm15c3FsLGVzY2FwX3VzZXJp
ZCx1c2VyaWQsc3RybGVuKHVzZXJpZCkpOwogICAgbXlzcWxfcmVhbF9lc2NhcGVfc3RyaW5nKCZt
eXNxbCxlc2NhcF9yZWFsbSxyZWFsbSxzdHJsZW4ocmVhbG0pKTsKICAgIC8qIGNvbm5lY3QgdG8g
ZGF0YWJhc2UgKi8KICAgIGlmIChteXNxbF9zZWxlY3RfZGIoc29jayxzZXR0aW5ncy0+bXlzcWxf
ZGF0YWJhc2UpIDwgMCkgewogICAgICAgIGdvdG8gZG9uZTsKICAgIH0KIyBlbmRpZgojZW5kaWYK
ICAgIAogICAgZm9yKGN1ciA9IHRvX2ZldGNoOyBjdXItPm5hbWU7IGN1cisrKSB7CgljaGFyICpy
ZWFsbmFtZSA9IChjaGFyICopY3VyLT5uYW1lOwoJLyogT25seSBsb29rIHVwIHByb3BlcnRpZXMg
dGhhdCBhcHBseSB0byB0aGlzIGxvb2t1cCEgKi8KCWlmIChjdXItPm5hbWVbMF0gPT0gJyonCgkg
ICAgJiYgKGZsYWdzICYgU0FTTF9BVVhQUk9QX0FVVEhaSUQpKQoJICAgIGNvbnRpbnVlOwoJaWYo
IShmbGFncyAmIFNBU0xfQVVYUFJPUF9BVVRIWklEKSkgewoJICAgIGlmKGN1ci0+bmFtZVswXSAh
PSAnKicpCgkJY29udGludWU7CgkgICAgZWxzZQoJCXJlYWxuYW1lID0gKGNoYXIqKWN1ci0+bmFt
ZSArIDE7Cgl9CgkKCS8qIElmIGl0J3MgdGhlcmUgYWxyZWFkeSwgd2Ugd2FudCB0byBzZWUgaWYg
aXQgbmVlZHMgdG8gYmUKCSAqIG92ZXJyaWRkZW4gKi8KCWlmKGN1ci0+dmFsdWVzICYmICEoZmxh
Z3MgJiBTQVNMX0FVWFBST1BfT1ZFUlJJREUpKQoJICAgIGNvbnRpbnVlOwoJZWxzZSBpZihjdXIt
PnZhbHVlcykKCSAgICBzcGFyYW1zLT51dGlscy0+cHJvcF9lcmFzZShzcGFyYW1zLT5wcm9wY3R4
LCBjdXItPm5hbWUpOwoJCglpZiAoIHNldHRpbmdzLT5zcWxfdmVyYm9zZSApCgkgICAgc3BhcmFt
cy0+dXRpbHMtPmxvZyhOVUxMLCBTQVNMX0xPR19XQVJOLAoJCQkgICAgICAgInNxbCBwbHVnaW4g
Y3JlYXRlIHN0YXRlbWVudCBmcm9tICVzICVzICVzXG4iLAoJCQkgICAgICAgcmVhbG5hbWUsZXNj
YXBfdXNlcmlkLGVzY2FwX3JlYWxtKTsKCQoJLyogY3JlYXRlIGEgc3RhdG1lbnQgdGhhdCB3ZSB3
aWxsIHVzZSAqLwoJcXVlcnkgPSBzcWxfY3JlYXRlX3N0YXRlbWVudChzcGFyYW1zLAoJCQkJICAg
ICAgIHNldHRpbmdzLT5zcWxfc3RhdGVtZW50LAoJCQkJICAgICAgIHJlYWxuYW1lLGVzY2FwX3Vz
ZXJpZCwKCQkJCSAgICAgICBlc2NhcF9yZWFsbSk7CgkKCWlmIChzZXR0aW5ncy0+c3FsX3ZlcmJv
c2UpCgkgICAgc3BhcmFtcy0+dXRpbHMtPmxvZyhOVUxMLCBTQVNMX0xPR19XQVJOLAoJCQkJInNx
bCBwbHVnaW4gZG9pbmcgcXVlcnkgJXNcbiIsCgkJCQlxdWVyeSk7CgkKCS8qIHJ1biB0aGUgcXVl
cnkgKi8KI2lmZGVmIFVTRV9QR1NRTAogICAgICAgIHJlc3VsdCA9IFBRZXhlYyhjb25uLCBxdWVy
eSk7CiAgICAgICAgaWYgKCFyZXN1bHQgfHwgUFFyZXN1bHRTdGF0dXMocmVzdWx0KSAhPSBQR1JF
U19DT01NQU5EX09LKQojZWxzZQojIGlmZGVmIFVTRV9NWVNRTAogICAgICAgIGlmIChteXNxbF9x
dWVyeShzb2NrLHF1ZXJ5KSA8IDAKICAgICAgICAgICAgfHwgIShyZXN1bHQ9bXlzcWxfc3RvcmVf
cmVzdWx0KHNvY2spKSkgCiMgZW5kaWYKI2VuZGlmCiAgICAgICAgewoJICAgIHNwYXJhbXMtPnV0
aWxzLT5mcmVlKHF1ZXJ5KTsKICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgfQoKCS8qIHF1
aWNrIHJvdyBjaGVjayAqLwojaWZkZWYgVVNFX1BHU1FMCglyb3dfY291bnQgPSBQUW50dXBsZXMo
cmVzdWx0KTsKI2Vsc2UKIyBpZmRlZiBVU0VfTVlTUUwKICAgICAgICByb3dfY291bnQgPSBteXNx
bF9hZmZlY3RlZF9yb3dzKCZteXNxbCk7CiMgZW5kaWYKI2VuZGlmCglpZiAoIHJvd19jb3VudCA9
PSAwKSB7CgkgICAgLyogdW1tIG5vdGhpbmcgZm91bmQgKi8KCSAgICBzcGFyYW1zLT51dGlscy0+
ZnJlZShxdWVyeSk7CiNpZmRlZiBVU0VfUEdTUUwKCSAgICBQUWNsZWFyKHJlc3VsdCk7CiNlbHNl
CiMgaWZkZWYgVVNFX01ZU1FMCiAgICAgICAgICAgIG15c3FsX2ZyZWVfcmVzdWx0KHJlc3VsdCk7
CiMgZW5kaWYKI2VuZGlmCgkgICAgY29udGludWU7Cgl9CglpZiAoIHJvd19jb3VudCA+IDEgKSB7
CgkgICAgc3BhcmFtcy0+dXRpbHMtPmxvZyhOVUxMLCBTQVNMX0xPR19XQVJOLAoJCQkJInNxbCBw
bHVnaW4gZm91bmQgZHVwbGljYXRlICh3aWxsIHRha2UgZmlyc3QpIGRvaW5nIHF1ZXJ5ICVzIFxu
IiwKCQkJCXF1ZXJ5KTsKCX0KCQoJLyogbm93IGdldCB0aGUgcmVzdWx0IHNldCB2YWx1ZSBhbmQg
dmFsdWVfbGVuICovCgkvKiB3ZSBvbmx5IGZldGNoIG9uZSBiZWN1c2Ugd2UgZG9udCBjYXIgYWJv
dXQgdGhlIHJlc3QgKi8KCXN0cm5jcHkodmFsdWUsUFFnZXR2YWx1ZShyZXN1bHQsMCwwKSw4MTkw
KTsKCXZhbHVlX2xlbiA9IHN0cmxlbih2YWx1ZSk7CgkKCXNwYXJhbXMtPnV0aWxzLT5wcm9wX3Nl
dChzcGFyYW1zLT5wcm9wY3R4LCBjdXItPm5hbWUsCgkJCQkgdmFsdWUsIHZhbHVlX2xlbik7CgkK
CS8qIGZyZWUgcmVzdWx0Ki8KCXNwYXJhbXMtPnV0aWxzLT5mcmVlKHF1ZXJ5KTsKI2lmZGVmIFVT
RV9QR1NRTAoJUFFjbGVhcihyZXN1bHQpOwojZWxzZQojIGlmZGVmIFVTRV9NWVNRTAogICAgICAg
IG15c3FsX2ZyZWVfcmVzdWx0KHJlc3VsdCk7CiMgZW5kaWYKI2VuZGlmCiAgICB9CiAgICAKIGRv
bmU6CiAgICBpZiAoZXNjYXBfdXNlcmlkKSBzcGFyYW1zLT51dGlscy0+ZnJlZShlc2NhcF91c2Vy
aWQpOwogICAgaWYgKGVzY2FwX3JlYWxtKSBzcGFyYW1zLT51dGlscy0+ZnJlZShlc2NhcF9yZWFs
bSk7CiAgICBpZiAoY29ubikgIAojaWZkZWYgVVNFX1BHU1FMCiAgICAgIFBRZmluaXNoKGNvbm4p
OwojZWxzZQojIGlmZGVmIFVTRV9NWVNRTAogICAgICBteXNxbF9jbG9zZShzb2NrKTsKIyBlbmRp
ZgojZW5kaWYKICAgIGlmIChkYl9ob3N0X3B0cikgIHNwYXJhbXMtPnV0aWxzLT5mcmVlKGRiX2hv
c3RfcHRyKTsKICAgIGlmICh1c2VyaWQpIHNwYXJhbXMtPnV0aWxzLT5mcmVlKHVzZXJpZCk7CiAg
ICBpZiAocmVhbG0pICBzcGFyYW1zLT51dGlscy0+ZnJlZShyZWFsbSk7CiAgICBpZiAodXNlcl9i
dWYpIHNwYXJhbXMtPnV0aWxzLT5mcmVlKHVzZXJfYnVmKTsKfQoKc3RhdGljIHZvaWQgc3FsX2F1
eHByb3BfZnJlZSh2b2lkICpnbG9iX2NvbnRleHQsIGNvbnN0IHNhc2xfdXRpbHNfdCAqdXRpbHMp
IHsKICAgIHN0cnVjdCBzcWxfc2V0dGluZ3MgKnNldHRpbmdzOwoKICAgIHNldHRpbmdzID0gKHN0
cnVjdCBzcWxfc2V0dGluZ3MgKilnbG9iX2NvbnRleHQ7CgogICAgaWYoIXNldHRpbmdzKSByZXR1
cm47CgogICAgaWYoc2V0dGluZ3MtPnNxbF92ZXJib3NlKQoJdXRpbHMtPmxvZyhOVUxMLCBTQVNM
X0xPR19ERUJVRywgInNxbCBmcmVlaW5nIG1lbWVcbiIpOwoKICAgIHV0aWxzLT5mcmVlKHNldHRp
bmdzKTsKfQoKc3RhdGljIHNhc2xfYXV4cHJvcF9wbHVnX3Qgc3FsX2F1eHByb3BfcGx1Z2luID0g
ewogICAgMCwgICAgICAgICAgIC8qIEZlYXR1cmVzICovCiAgICAwLCAgICAgICAgICAgLyogc3Bh
cmUgKi8KICAgIE5VTEwsICAgICAgICAvKiBnbG9iX2NvbnRleHQgKi8KICAgIHNxbF9hdXhwcm9w
X2ZyZWUsICAgICAgICAvKiBhdXhwcm9wX2ZyZWUgKi8KICAgIHNxbF9hdXhwcm9wX2xvb2t1cCwg
LyogYXV4cHJvcF9sb29rdXAgKi8KICAgICJTUUwiLCAgICAgLyogbmFtZSAqLwogICAgTlVMTCAg
ICAgICAgIC8qIHNwYXJlICovCn07CgppbnQgc3FsX2F1eHByb3BfcGx1Z19pbml0KGNvbnN0IHNh
c2xfdXRpbHNfdCAqdXRpbHMsCgkJCSAgICBpbnQgbWF4X3ZlcnNpb24sCgkJCSAgICBpbnQgKm91
dF92ZXJzaW9uLAoJCQkgICAgc2FzbF9hdXhwcm9wX3BsdWdfdCAqKnBsdWcsCgkJCSAgICBjb25z
dCBjaGFyICpwbHVnbmFtZSBfX2F0dHJpYnV0ZV9fKCh1bnVzZWQpKSkgCnsKICAgIHN0cnVjdCBz
cWxfc2V0dGluZ3MgKnNldHRpbmdzOwogICAgaWYoIW91dF92ZXJzaW9uIHx8ICFwbHVnKSByZXR1
cm4gU0FTTF9CQURQQVJBTTsKICAgIAogICAgaWYobWF4X3ZlcnNpb24gPCBTQVNMX0FVWFBST1Bf
UExVR19WRVJTSU9OKSByZXR1cm4gU0FTTF9CQURWRVJTOwogICAgKm91dF92ZXJzaW9uID0gU0FT
TF9BVVhQUk9QX1BMVUdfVkVSU0lPTjsKICAgIAogICAgKnBsdWcgPSAmc3FsX2F1eHByb3BfcGx1
Z2luOwogICAgCiAgICAvKiBzaG91bGQgSSBnZXQgY29uZmlnIHZhbHVlcyBoZXJlIG9yIG5vdCAK
ICAgICoqIG9ubHkgdGVzdGluZyB3aWxsIHRlbGwKICAgICoqIG9rIHdlIG5lZWQgdG8gZ2V0IHNv
bWUgb3B0aW9ucwogICAgKi8KICAgIAogICAgc2V0dGluZ3MgPQoJKHN0cnVjdCBzcWxfc2V0dGlu
Z3MgKil1dGlscy0+bWFsbG9jKHNpemVvZihzdHJ1Y3Qgc3FsX3NldHRpbmdzKSk7CgogICAgaWYo
IXNldHRpbmdzKSB7CglNRU1FUlJPUih1dGlscyk7CglyZXR1cm4gU0FTTF9OT01FTTsKICAgIH0K
CiAgICBzcWxfYXV4cHJvcF9wbHVnaW4uZ2xvYl9jb250ZXh0ID0gc2V0dGluZ3M7CgogICAgbWVt
c2V0KHNldHRpbmdzLCAwLCBzaXplb2Yoc3RydWN0IHNxbF9zZXR0aW5ncykpOwogICAgCiAgICBy
ZXR1cm4gU0FTTF9PSzsKfQoKCgo=
</data>        

          </attachment>
      

    </bug>

</bugzilla>