<?xml version="1.0" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugzilla.cyrusimap.org/bugzilla.dtd">

<bugzilla version="3.2.5.1-2"
          urlbase="https://bugzilla.cyrusimap.org/"
          maintainer="Dave McMurtrie &lt;dave64@andrew.cmu.edu&gt;"
>

    <bug>
          <bug_id>3395</bug_id>
          
          <creation_ts>2011-02-03 11:47 EDT</creation_ts>
          <short_desc>cvt_cyrusdb segfaults converting skiplist to quotalegacy</short_desc>
          <delta_ts>2011-03-25 10:16:23 EDT</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Cyrus IMAP</product>
          <component>IMAP</component>
          <version>2.3.16</version>
          <rep_platform>PC</rep_platform>
          <op_sys>Linux</op_sys>
          <bug_status>CLOSED</bug_status>
          <resolution>DUPLICATE</resolution>
          <dup_id>3417</dup_id>
          
          
          
          <priority>P3</priority>
          <bug_severity>bug</bug_severity>
          <target_milestone>2.4.7</target_milestone>
          
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Deniss Gaplevsky">slim@inbox.lv</reporter>
          <assigned_to name="Bron Gondwana">brong@fastmail.fm</assigned_to>
          <cc>brong@fastmail.fm</cc>
          <qa_contact name="The Cyrus Bugzilla List">cyrus-bugzilla@lists.andrew.cmu.edu</qa_contact>

      

      

      
          <long_desc isprivate="0">
            <who name="Deniss Gaplevsky">slim@inbox.lv</who>
            <bug_when>2011-02-03 11:47:27 EDT</bug_when>
            <thetext>Reading symbols from /Cyrus3/cyrus-imapd-2.3.16/imap/cvt_cyrusdb...done.
[New Thread 19151]

warning: Can&apos;t read pathname for load map: Input/output error.
Reading symbols from /C3/sasl2//lib/libsasl2.so.2...done.
Loaded symbols for /C3/sasl2//lib/libsasl2.so.2
Reading symbols from /usr/lib/libssl.so.1.0.0...(no debugging symbols found)...done.
Loaded symbols for /usr/lib/libssl.so.1.0.0
Reading symbols from /usr/lib/libcrypto.so.1.0.0...(no debugging symbols found)...done.
Loaded symbols for /usr/lib/libcrypto.so.1.0.0
Reading symbols from /lib/libresolv.so.2...(no debugging symbols found)...done.
Loaded symbols for /lib/libresolv.so.2
Reading symbols from /usr/lib/libdb-4.8.so...(no debugging symbols found)...done.
Loaded symbols for /usr/lib/libdb-4.8.so
Reading symbols from /lib/libpcre.so.0...(no debugging symbols found)...done.
Loaded symbols for /lib/libpcre.so.0
Reading symbols from /usr/lib/libpcreposix.so.0...(no debugging symbols found)...done.
Loaded symbols for /usr/lib/libpcreposix.so.0
Reading symbols from /lib/libz.so.1...(no debugging symbols found)...done.
Loaded symbols for /lib/libz.so.1
Reading symbols from /lib/libcom_err.so.2...(no debugging symbols found)...done.
Loaded symbols for /lib/libcom_err.so.2
Reading symbols from /lib/libc.so.6...(no debugging symbols found)...done.
Loaded symbols for /lib/libc.so.6
Reading symbols from /lib/libdl.so.2...(no debugging symbols found)...done.
Loaded symbols for /lib/libdl.so.2
Reading symbols from /lib/libpthread.so.0...(no debugging symbols found)...done.
Loaded symbols for /lib/libpthread.so.0
Reading symbols from /lib64/ld-linux-x86-64.so.2...(no debugging symbols found)...done.
Loaded symbols for /lib64/ld-linux-x86-64.so.2
Core was generated by `imap/cvt_cyrusdb -C /C3/cyrus/etc/imapd.conf /var/imap/quotas.db skiplist /tmp/&apos;.
Program terminated with signal 11, Segmentation fault.
#0  mystore (db=0x6e7690, key=&lt;value optimized out&gt;, keylen=&lt;value optimized out&gt;, 
    data=0x320becadddc &lt;Address 0x320becadddc out of bounds&gt;, datalen=&lt;value optimized out&gt;, tid=0x6cb260, overwrite=1)
    at cyrusdb_quotalegacy.c:771
771             *p = &apos;\n&apos;;
(gdb) bt
#0  mystore (db=0x6e7690, key=&lt;value optimized out&gt;, keylen=&lt;value optimized out&gt;, 
    data=0x320becadddc &lt;Address 0x320becadddc out of bounds&gt;, datalen=&lt;value optimized out&gt;, tid=0x6cb260, overwrite=1)
    at cyrusdb_quotalegacy.c:771
#1  0x00000000004328e0 in store (db=0x702c90, key=0x10 &lt;Address 0x10 out of bounds&gt;, keylen=10, data=0x0, datalen=-1029243192, 
    tid=0xfefeffffffffff00) at cyrusdb_quotalegacy.c:820
#2  0x00000000004302b5 in myforeach (db=0x6e75e0, prefix=&lt;value optimized out&gt;, prefixlen=0, goodp=&lt;value optimized out&gt;, 
    cb=&lt;value optimized out&gt;, rock=&lt;value optimized out&gt;, tidptr=0x0) at cyrusdb_skiplist.c:1117
#3  0x0000000000405bab in main (argc=&lt;value optimized out&gt;, argv=0x6) at cvt_cyrusdb.c:171
(gdb)</thetext>
          </long_desc>
          <long_desc isprivate="0">
            <who name="Deniss Gaplevsky">slim@inbox.lv</who>
            <bug_when>2011-02-03 11:53:12 EDT</bug_when>
            <thetext>same on /cyrus-imapd-2.4.6:

Reading symbols from /Cyrus3/cyrus-imapd-2.4.6/imap/cvt_cyrusdb...done.
[New Thread 18101]

warning: Can&apos;t read pathname for load map: Input/output error.
Reading symbols from /C3/sasl2//lib/libsasl2.so.2...done.
Loaded symbols for /C3/sasl2//lib/libsasl2.so.2
Reading symbols from /usr/lib/libssl.so.1.0.0...(no debugging symbols found)...done.
Loaded symbols for /usr/lib/libssl.so.1.0.0
Reading symbols from /usr/lib/libcrypto.so.1.0.0...(no debugging symbols found)...done.
Loaded symbols for /usr/lib/libcrypto.so.1.0.0
Reading symbols from /usr/lib/libdb-4.8.so...(no debugging symbols found)...done.
Loaded symbols for /usr/lib/libdb-4.8.so
Reading symbols from /lib/libpcre.so.0...(no debugging symbols found)...done.
Loaded symbols for /lib/libpcre.so.0
Reading symbols from /usr/lib/libpcreposix.so.0...(no debugging symbols found)...done.
Loaded symbols for /usr/lib/libpcreposix.so.0
Reading symbols from /lib/libz.so.1...(no debugging symbols found)...done.
Loaded symbols for /lib/libz.so.1
Reading symbols from /lib/libcom_err.so.2...(no debugging symbols found)...done.
Loaded symbols for /lib/libcom_err.so.2
Reading symbols from /lib/libc.so.6...(no debugging symbols found)...done.
Loaded symbols for /lib/libc.so.6
Reading symbols from /lib/libdl.so.2...(no debugging symbols found)...done.
Loaded symbols for /lib/libdl.so.2
Reading symbols from /lib/libresolv.so.2...(no debugging symbols found)...done.
Loaded symbols for /lib/libresolv.so.2
Reading symbols from /lib/libpthread.so.0...(no debugging symbols found)...done.
Loaded symbols for /lib/libpthread.so.0
Reading symbols from /lib64/ld-linux-x86-64.so.2...(no debugging symbols found)...done.
Loaded symbols for /lib64/ld-linux-x86-64.so.2
Core was generated by `imap/cvt_cyrusdb -C /C3/cyrus/etc/imapd.conf /var/imap/quotas.db skiplist /tmp/&apos;.
Program terminated with signal 11, Segmentation fault.
#0  mystore (db=0x766a00, key=&lt;value optimized out&gt;, keylen=&lt;value optimized out&gt;, 
    data=0x378c2546ddc &lt;Address 0x378c2546ddc out of bounds&gt;, datalen=&lt;value optimized out&gt;, tid=0x3f7f437c2e0, overwrite=1)
    at cyrusdb_quotalegacy.c:768
768             *p = &apos;\n&apos;;
(gdb) bt
#0  mystore (db=0x766a00, key=&lt;value optimized out&gt;, keylen=&lt;value optimized out&gt;, 
    data=0x378c2546ddc &lt;Address 0x378c2546ddc out of bounds&gt;, datalen=&lt;value optimized out&gt;, tid=0x3f7f437c2e0, overwrite=1)
    at cyrusdb_quotalegacy.c:768
#1  0x000000000043c4c0 in store (db=0x782030, key=0x10 &lt;Address 0x10 out of bounds&gt;, keylen=10, data=0x0, datalen=-967708984, 
    tid=0xfefeffffffffff00) at cyrusdb_quotalegacy.c:817
#2  0x0000000000439e8e in myforeach (db=0x766950, prefix=&lt;value optimized out&gt;, prefixlen=0, goodp=&lt;value optimized out&gt;, 
    cb=&lt;value optimized out&gt;, rock=&lt;value optimized out&gt;, tidptr=0x3f7f437c2e8) at cyrusdb_skiplist.c:1122
#3  0x00000000004333e4 in cyrusdb_convert (fromfname=&lt;value optimized out&gt;, tofname=0x3f7f437c711 &quot;/tmp/aaa/&quot;, frombackend=0x735220, 
    tobackend=0x7352c0) at cyrusdb.c:204
#4  0x000000000040608a in main (argc=&lt;value optimized out&gt;, argv=&lt;value optimized out&gt;) at cvt_cyrusdb.c:153</thetext>
          </long_desc>
          <long_desc isprivate="0">
            <who name="Bron Gondwana">brong@fastmail.fm</who>
            <bug_when>2011-03-16 06:08:51 EDT</bug_when>
            <thetext>Ok, this sucks.  Going to test if I can reproduce in 2.4, and if so, fix.</thetext>
          </long_desc>
          <long_desc isprivate="0">
            <who name="Bron Gondwana">brong@fastmail.fm</who>
            <bug_when>2011-03-25 10:16:23 EDT</bug_when>
            <thetext>Well, looks like I actually fixed this accidentally fixing a different bug!  The underlying issue was that bogus data was being passed back up by the foreach on the quotalegacy database.

Fix will be in 2.4.7

*** This bug has been marked as a duplicate of bug 3417 ***</thetext>
          </long_desc>
      
      

    </bug>

</bugzilla>