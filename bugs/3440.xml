<?xml version="1.0" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugzilla.cyrusimap.org/bugzilla.dtd">

<bugzilla version="3.2.5.1-2"
          urlbase="https://bugzilla.cyrusimap.org/"
          maintainer="Dave McMurtrie &lt;dave64@andrew.cmu.edu&gt;"
>

    <bug>
          <bug_id>3440</bug_id>
          
          <creation_ts>2011-04-13 05:17 EDT</creation_ts>
          <short_desc>cyr_expire  segfault when using -x</short_desc>
          <delta_ts>2011-04-13 11:01:22 EDT</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Cyrus IMAP</product>
          <component>IMAP</component>
          <version>2.4.6</version>
          <rep_platform>PC</rep_platform>
          <op_sys>Linux</op_sys>
          <bug_status>CLOSED</bug_status>
          <resolution>FIXED</resolution>
          
          
          
          
          <priority>P3</priority>
          <bug_severity>blocker</bug_severity>
          <target_milestone>2.4.8</target_milestone>
          
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Rudy Gevaert">rudy.gevaert@ugent.be</reporter>
          <assigned_to name="Bron Gondwana">brong@fastmail.fm</assigned_to>
          <cc>vanmeeuwen@kolabsys.com</cc>
          <qa_contact name="The Cyrus Bugzilla List">cyrus-bugzilla@lists.andrew.cmu.edu</qa_contact>

      

      

      
          <long_desc isprivate="0">
            <who name="Rudy Gevaert">rudy.gevaert@ugent.be</who>
            <bug_when>2011-04-13 05:17:17 EDT</bug_when>
            <thetext>See the mailinglist cyrus-devel too.

Hi,

I&apos;m seeing the following message in my kern.log every morning when cyr_expire is run:

cyr_expire[14157] trap divide error ip:4432d5 sp:7fff96f38c90 error:0 in cyr_expire[400000+136000]

When I run gdb with the core file I see:

Core was generated by `/usr/cyrus-2.4.6/bin/cyr_expire -C /etc/cyrus-ugent/conf/mail21/imapd.conf -D 3&apos;.
Program terminated with signal 8, Arithmetic exception.
#0  0x00000000004432d5 in hash_lookup (key=0x7f330b5050a9 &lt;Address 0x7f330b5050a9 out of bounds&gt;, table=0x7fff96f38fd0) at hash.c:163
163    hash.c: No such file or directory.
    in hash.c
(gdb) backtrace
#0  0x00000000004432d5 in hash_lookup (key=0x7f330b5050a9 &lt;Address 0x7f330b5050a9 out of bounds&gt;, table=0x7fff96f38fd0) at hash.c:163
#1  0x0000000000420a56 in prune_p (rock=0x7fff96f38d70, id=0x7f330b505098 &lt;Address 0x7f330b505098 out of bounds&gt;, idlen=&lt;value optimized out&gt;, data=0x7f330b5050c4 &lt;Address 0x7f330b5050c4 out of bounds&gt;,
    datalen=&lt;value optimized out&gt;) at duplicate.c:281
#2  0x000000000043ccda in myforeach (db=0x16b2b90, prefix=&lt;value optimized out&gt;, prefixlen=0, goodp=&lt;value optimized out&gt;, cb=&lt;value optimized out&gt;, rock=&lt;value optimized out&gt;, tidptr=0x0)
    at cyrusdb_skiplist.c:1101
#3  0x00000000004209c2 in duplicate_prune (days=8, expire_table=0x7fff96f38fd0) at duplicate.c:321
#4  0x0000000000407662 in main (argc=&lt;value optimized out&gt;, argv=0x0) at cyr_expire.c:496


I provide the full core dump uppon request.

Thanks!

Rudy 



Hi,

It als seems that our squatter is having problems:

Core was generated by `/usr/cyrus-2.4.6/bin/squatter -C /etc/cyrus-ugent/conf/mail12/imapd.conf -s -i&apos;.
Program terminated with signal 7, Bus error.
#0  squat_scan_recurse (s=0x7f2afed135fe &lt;Address 0x7f2afed135fe out of bounds&gt;, data_end=0x7f2afed1b0cc &lt;Address 0x7f2afed1b0cc out of bounds&gt;, name=0x7fff32e33b30 &quot;9 &amp;i&quot;, level=3,
    handler=0x431260 &lt;squat_count_docs_callback&gt;, closure=0x7fff32e33fec) at squat.c:687
687    squat.c: No such file or directory.
    in squat.c
(gdb) bt
#0  squat_scan_recurse (s=0x7f2afed135fe &lt;Address 0x7f2afed135fe out of bounds&gt;, data_end=0x7f2afed1b0cc &lt;Address 0x7f2afed1b0cc out of bounds&gt;, name=0x7fff32e33b30 &quot;9 &amp;i&quot;, level=3,
    handler=0x431260 &lt;squat_count_docs_callback&gt;, closure=0x7fff32e33fec) at squat.c:687
#1  0x0000000000431809 in squat_scan_recurse (s=0x7f2afed135fe &lt;Address 0x7f2afed135fe out of bounds&gt;, data_end=&lt;value optimized out&gt;, name=0x7fff32e33b30 &quot;9 &amp;i&quot;, level=&lt;value optimized out&gt;,
    handler=&lt;value optimized out&gt;, closure=&lt;value optimized out&gt;) at squat.c:749
#2  0x0000000000431809 in squat_scan_recurse (s=0x7f2afed135fe &lt;Address 0x7f2afed135fe out of bounds&gt;, data_end=&lt;value optimized out&gt;, name=0x7fff32e33b30 &quot;9 &amp;i&quot;, level=&lt;value optimized out&gt;,
    handler=&lt;value optimized out&gt;, closure=&lt;value optimized out&gt;) at squat.c:749
#3  0x0000000000431d34 in squat_count_docs (index=0x27d1b10, first_char=57 &apos;9&apos;, counter=0x7fff32e33fec) at squat.c:952
#4  0x000000000041221b in dump_index_trie_words (index=0x27ae270, OK=&lt;value optimized out&gt;) at squat_build.c:1375
#5  index_close_internal (index=0x27ae270, OK=&lt;value optimized out&gt;) at squat_build.c:1545
#6  0x00000000004076e8 in squat_single (state=0x279e030, incremental=1) at squatter.c:482
#7  0x0000000000407c9f in index_me (name=0x2635cc0 &quot;ugent.be!user.els^baerten.Drafts&quot;, matchlen=&lt;value optimized out&gt;, maycreate=&lt;value optimized out&gt;, rock=&lt;value optimized out&gt;) at squatter.c:623
#8  0x0000000000408104 in main (argc=5, argv=0x7fff32e35c38) at squatter.c:745</thetext>
          </long_desc>
          <long_desc isprivate="0">
            <who name="Rudy Gevaert">rudy.gevaert@ugent.be</who>
            <bug_when>2011-04-13 09:34:07 EDT</bug_when>
            <thetext>please discard the bug about squatter (it is in a new report)</thetext>
          </long_desc>
          <long_desc isprivate="0">
            <who name="Bron Gondwana">brong@fastmail.fm</who>
            <bug_when>2011-04-13 09:34:32 EDT</bug_when>
            <thetext>This is now resolved on -2.4</thetext>
          </long_desc>
      
      

    </bug>

</bugzilla>