<?xml version="1.0" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugzilla.cyrusimap.org/bugzilla.dtd">

<bugzilla version="3.2.5.1-2"
          urlbase="https://bugzilla.cyrusimap.org/"
          maintainer="Dave McMurtrie &lt;dave64@andrew.cmu.edu&gt;"
>

    <bug>
          <bug_id>2859</bug_id>
          
          <creation_ts>2006-07-05 09:39 EDT</creation_ts>
          <short_desc>Replicate or append or copy requires reconstruct</short_desc>
          <delta_ts>2010-10-25 18:46:39 EDT</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Cyrus IMAP</product>
          <component>Replication</component>
          <version>2.3.x</version>
          <rep_platform>Other</rep_platform>
          <op_sys>FreeBSD</op_sys>
          <bug_status>CLOSED</bug_status>
          <resolution>FIXED</resolution>
          
          
          
          
          <priority>P2</priority>
          <bug_severity>bug</bug_severity>
          <target_milestone>Future</target_milestone>
          
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="David S. Madole">david@madole.net</reporter>
          <assigned_to name="Ken Murchison">murch@andrew.cmu.edu</assigned_to>
          
          <qa_contact name="The Cyrus Bugzilla List">cyrus-bugzilla@lists.andrew.cmu.edu</qa_contact>

      

      

      
          <long_desc isprivate="0">
            <who name="David S. Madole">david@madole.net</who>
            <bug_when>2006-07-05 09:39:52 EDT</bug_when>
            <thetext>Replication of new messages requires reconstruct to be run on the replica before
the new messages are visible. The problem is the same as what prompted the 2.3.5
and 2.3.6 releases -- the modseq of the new messages is left uninitialized.</thetext>
          </long_desc>
          <long_desc isprivate="0">
            <who name="David S. Madole">david@madole.net</who>
            <bug_when>2006-07-05 09:41:46 EDT</bug_when>
            <thetext>Created an attachment (id=443)
Updates replication to propagate modseq value

This patch corrects the replication issue in 2.3.6 by causing the modseq value
to be propagated to the replica for new objects.</thetext>
          </long_desc>
          <long_desc isprivate="0">
            <who name="Ken Murchison">murch@andrew.cmu.edu</who>
            <bug_when>2006-07-05 16:24:54 EDT</bug_when>
            <thetext>Applied patch with fixes for using network byte order
</thetext>
          </long_desc>
          <long_desc isprivate="0">
            <who name="David S. Madole">david@madole.net</who>
            <bug_when>2006-07-06 17:10:29 EDT</bug_when>
            <thetext>Created an attachment (id=444)
Endian-fixed modseq replication patch

As Ken pointed out, my original patch is unsuitable for running on x86 machines
because I neglected to convert byte ordering to network order as used in the
index files. Although Ken already fixed it and put it into CVS, here is a fixed
version fof the patch for anyone looking for it stand-alone in the interim. I
really think this one is right!</thetext>
          </long_desc>
      
          <attachment
              isobsolete="0"
              ispatch="1"
              isprivate="0"
          >
            <attachid>443</attachid>
            <date>2006-07-05 09:41 EDT</date>
            <desc>Updates replication to propagate modseq value</desc>
            <filename>replicate_modseq.patch</filename>
            <type>text/plain</type>
            <size>6482</size>
            <attacher>david@madole.net</attacher>
            
              <data encoding="base64">ZGlmZiAtciAtYyBjeXJ1cy1pbWFwZC0yLjMuNi1vcmlnL2ltYXAvc3luY19jbGllbnQuYyBjeXJ1
cy1pbWFwZC0yLjMuNi9pbWFwL3N5bmNfY2xpZW50LmMKKioqIGN5cnVzLWltYXBkLTIuMy42LW9y
aWcvaW1hcC9zeW5jX2NsaWVudC5jCVR1ZSBBcHIgIDQgMTg6MTA6NTQgMjAwNgotLS0gY3lydXMt
aW1hcGQtMi4zLjYvaW1hcC9zeW5jX2NsaWVudC5jCVR1ZSBKdWwgIDQgMjA6MzI6NDMgMjAwNgoq
KioqKioqKioqKioqKioKKioqIDExMTgsMTEyNSAqKioqCiAgICAgIHVuc2lnbmVkIGxvbmcgbXNn
X3NpemUgPSAwOwogIAogICAgICAvKiBQcm90b2NvbCBmb3IgUEFSU0VEIGl0ZW1zOgohICAgICAg
KiBDOiAgUEFSU0VEICA8bXNnaWQ+IDx1aWQ+IAohICAgICAgKiAgICAgICAgICAgICA8aW50ZXJu
YWxkYXRlPiA8c2VudC1kYXRlPiA8bGFzdC11cGRhdGVkPiA8ZmxhZ3M+CiAgICAgICAqICAgICAg
ICAgICAgIDxoZHIgc2l6ZT4gPGNvbnRlbnRfbGluZXM+CiAgICAgICAqICAgICAgICAgICAgIDxj
YWNoZSBsaXRlcmFsIChpbmNsdWRlcyBjYWNoZSBzaXplISk+CiAgICAgICAqIDxtc2cgbGl0ZXJh
bCAoaW5jbHVkZXMgbXNnIHNpemUhKT4KLS0tIDExMjgsMTEzNSAtLS0tCiAgICAgIHVuc2lnbmVk
IGxvbmcgbXNnX3NpemUgPSAwOwogIAogICAgICAvKiBQcm90b2NvbCBmb3IgUEFSU0VEIGl0ZW1z
OgohICAgICAgKiBDOiAgUEFSU0VEICA8bXNnaWQ+IDx1aWQ+CiEgICAgICAqICAgICAgICAgICAg
IDxpbnRlcm5hbGRhdGU+IDxzZW50LWRhdGU+IDxsYXN0LXVwZGF0ZWQ+IDxtb2RzZXE+IDxmbGFn
cz4KICAgICAgICogICAgICAgICAgICAgPGhkciBzaXplPiA8Y29udGVudF9saW5lcz4KICAgICAg
ICogICAgICAgICAgICAgPGNhY2hlIGxpdGVyYWwgKGluY2x1ZGVzIGNhY2hlIHNpemUhKT4KICAg
ICAgICogPG1zZyBsaXRlcmFsIChpbmNsdWRlcyBtc2cgc2l6ZSEpPgoqKioqKioqKioqKioqKioK
KioqIDExMjcsMTEzMyAqKioqCiAgCiAgICAgIC8qIFByb3RvY29sIGZvciBDT1BZIGl0ZW1zOgog
ICAgICAgKiBDOiAgQ09QWSA8bXNnaWQ+IDx1aWQ+CiEgICAgICAqICAgICAgICAgICA8aW50ZXJu
YWxkYXRlPiA8c2VudC1kYXRlPiA8bGFzdC11cGRhdGVkPiA8ZmxhZ3M+CiAgICAgICAqLwogIAog
ICAgICBpZiAoc3luY19tc2dpZF9sb29rdXAobXNnaWRfb25zZXJ2ZXIsICZyZWNvcmQtPnV1aWQp
KSB7Ci0tLSAxMTM3LDExNDMgLS0tLQogIAogICAgICAvKiBQcm90b2NvbCBmb3IgQ09QWSBpdGVt
czoKICAgICAgICogQzogIENPUFkgPG1zZ2lkPiA8dWlkPgohICAgICAgKiAgICAgICAgICAgPGlu
dGVybmFsZGF0ZT4gPHNlbnQtZGF0ZT4gPGxhc3QtdXBkYXRlZD4gPG1vZHNlcT4gPGZsYWdzPgog
ICAgICAgKi8KICAKICAgICAgaWYgKHN5bmNfbXNnaWRfbG9va3VwKG1zZ2lkX29uc2VydmVyLCAm
cmVjb3JkLT51dWlkKSkgewoqKioqKioqKioqKioqKioKKioqIDExMzksMTE0OCAqKioqCiAgICAg
ICAgICBuZWVkX2JvZHkgPSAxOwogICAgICB9CiAgCiEgICAgIHByb3RfcHJpbnRmKHRvc2VydmVy
LCAiICVzICVsdSAlbHUgJWx1ICVsdSAoIiwKICAgICAgICAgICAgICAgbWVzc2FnZV91dWlkX3Rl
eHQoJnJlY29yZC0+dXVpZCksCiAgICAgICAgICAgICAgIHJlY29yZC0+dWlkLCByZWNvcmQtPmlu
dGVybmFsZGF0ZSwKISAgICAgICAgICAgICAgcmVjb3JkLT5zZW50ZGF0ZSwgcmVjb3JkLT5sYXN0
X3VwZGF0ZWQpOwogIAogICAgICBmbGFnc19wcmludGVkID0gMDsKICAKLS0tIDExNDksMTE1OCAt
LS0tCiAgICAgICAgICBuZWVkX2JvZHkgPSAxOwogICAgICB9CiAgCiEgICAgIHByb3RfcHJpbnRm
KHRvc2VydmVyLCAiICVzICVsdSAlbHUgJWx1ICVsdSAiIE1PRFNFUV9GTVQgIiAoIiwKICAgICAg
ICAgICAgICAgbWVzc2FnZV91dWlkX3RleHQoJnJlY29yZC0+dXVpZCksCiAgICAgICAgICAgICAg
IHJlY29yZC0+dWlkLCByZWNvcmQtPmludGVybmFsZGF0ZSwKISAgICAgICAgICAgICAgcmVjb3Jk
LT5zZW50ZGF0ZSwgcmVjb3JkLT5sYXN0X3VwZGF0ZWQsIHJlY29yZC0+bW9kc2VxKTsKICAKICAg
ICAgZmxhZ3NfcHJpbnRlZCA9IDA7CiAgCmRpZmYgLXIgLWMgY3lydXMtaW1hcGQtMi4zLjYtb3Jp
Zy9pbWFwL3N5bmNfY29tbWl0LmMgY3lydXMtaW1hcGQtMi4zLjYvaW1hcC9zeW5jX2NvbW1pdC5j
CioqKiBjeXJ1cy1pbWFwZC0yLjMuNi1vcmlnL2ltYXAvc3luY19jb21taXQuYwlUdWUgRGVjIDEz
IDE1OjMxOjEwIDIwMDUKLS0tIGN5cnVzLWltYXBkLTIuMy42L2ltYXAvc3luY19jb21taXQuYwlU
dWUgSnVsICA0IDIwOjUwOjQ3IDIwMDYKKioqKioqKioqKioqKioqCioqKiAxMDgsMTEzICoqKioK
LS0tIDEwOCwxMTQgLS0tLQogICAgICBzdHJ1Y3QgaW5kZXhfcmVjb3JkIHJlY29yZDsKICAgICAg
aW50ICAgbiwgciA9IDAsIHJjOwogICAgICBzdHJ1Y3QgdHhuICp0aWQgPSBOVUxMOworICAgICBt
b2RzZXFfdCBoaWdoZXN0bW9kc2VxID0gMDsKICAKICAgICAgaWYgKHVwbG9hZF9saXN0LT5jb3Vu
dCA9PSAwKSByZXR1cm4oMCk7ICAgLyogTk9PUCAqLwogIAoqKioqKioqKioqKioqKioKKioqIDIz
MywyMzggKioqKgotLS0gMjM0LDI0OCAtLS0tCiAgCQk9IGh0b25sKG1lc3NhZ2UtPmNhY2hlX3Zl
cnNpb24pOwogIAogICAgICAgICAgICAgIG1lc3NhZ2VfdXVpZF9wYWNrKCZpdGVtLT51dWlkLCBi
dWYrT0ZGU0VUX01FU1NBR0VfVVVJRCk7CisgCisgI2lmZGVmIEhBVkVfTE9OR19MT05HX0lOVAor
ICAgICAgICAgICAgICooKGJpdDY0ICopKGJ1ZitPRkZTRVRfTU9EU0VRXzY0KSkgPSBpdGVtLT5t
b2RzZXE7CisgI2Vsc2UKKyAgICAgICAgICAgICAqKChiaXQzMiAqKShidWYrT0ZGU0VUX01PRFNF
USkpID0gaXRlbS0+bW9kc2VxOworICNlbmRpZgorIAorIAkgICAgaWYgKGl0ZW0tPm1vZHNlcSA+
IGhpZ2hlc3Rtb2RzZXEpIGhpZ2hlc3Rtb2RzZXEgPSBpdGVtLT5tb2RzZXE7CisgCiAgICAgICAg
ICAgICAgcXVvdGFfYWRkICArPSBtZXNzYWdlLT5tc2dfc2l6ZTsKICAKICAgICAgICAgICAgICBp
ZiAoaXRlbS0+ZmxhZ3Muc3lzdGVtX2ZsYWdzICYgRkxBR19BTlNXRVJFRCkgbnVtYW5zd2VyZWRm
bGFnKys7CioqKioqKioqKioqKioqKgoqKiogMjk3LDMwMiAqKioqCi0tLSAzMDcsMzIzIC0tLS0K
ICAgICAgLyogRml4IHVwIGxhc3RfYXBwZW5kIHRpbWUgKi8KICAgICAgKigoYml0MzIgKikoYnVm
K09GRlNFVF9MQVNUX0FQUEVORERBVEUpKSA9IGh0b25sKGxhc3RfYXBwZW5kZGF0ZSk7CiAgCisg
ICAgIC8qIEZpeCB1cCBoaWdoZXN0IG1vZHNlcSAqLworICNpZmRlZiBIQVZFX0xPTkdfTE9OR19J
TlQKKyAgICAgaWYgKGhpZ2hlc3Rtb2RzZXEgPiAqKChiaXQ2NCAqKShidWYrT0ZGU0VUX0hJR0hF
U1RNT0RTRVFfNjQpKSkgeworIAkqKChiaXQ2NCAqKShidWYrT0ZGU0VUX0hJR0hFU1RNT0RTRVFf
NjQpKSA9IGhpZ2hlc3Rtb2RzZXE7CisgICAgIH0KKyAjZWxzZQorICAgICBpZiAoaGlnaGVzdG1v
ZHNlcSA+ICooKGJpdDMyICopKGJ1ZitPRkZTRVRfSElHSEVTVE1PRFNFUSkpKSB7CisgCSooKGJp
dDMyICopKGJ1ZitPRkZTRVRfSElHSEVTVE1PRFNFUSkpID0gaGlnaGVzdG1vZHNlcTsKKyAgICAg
fQorICNlbmRpZgorIAogICAgICByZXdpbmQobmV3aW5kZXgpOwogICAgICBmd3JpdGUoYnVmLCAx
LCBtYWlsYm94LT5zdGFydF9vZmZzZXQsIG5ld2luZGV4KTsKICAKKioqKioqKioqKioqKioqCioq
KiA0NTEsNDU2ICoqKioKLS0tIDQ3Miw0NzggLS0tLQogICAgICBjaGFyICB0YXJnZXRbTUFYX01B
SUxCT1hfUEFUSF07CiAgICAgIGludCAgIG4sIHIgPSAwOwogICAgICBzdHJ1Y3QgdHhuICp0aWQg
PSBOVUxMOworICAgICBtb2RzZXFfdCBoaWdoZXN0bW9kc2VxID0gMDsKICAKICAgICAgaWYgKHVw
bG9hZF9saXN0LT5jb3VudCA9PSAwKSByZXR1cm4oMCk7ICAgLyogTk9PUCAqLwogIAoqKioqKioq
KioqKioqKioKKioqIDQ5Myw0OTggKioqKgotLS0gNTE1LDUyOCAtLS0tCiAgCSAgICA9IGh0b25s
KG1lc3NhZ2UtPmNhY2hlX3ZlcnNpb24pOwogICAgICAgICAgbWVzc2FnZV91dWlkX3BhY2soJml0
ZW0tPnV1aWQsIHJlY29yZCtPRkZTRVRfTUVTU0FHRV9VVUlEKTsKICAKKyAjaWZkZWYgSEFWRV9M
T05HX0xPTkdfSU5UCisgICAgICAgICAqKChiaXQ2NCAqKShyZWNvcmQrT0ZGU0VUX01PRFNFUV82
NCkpID0gaXRlbS0+bW9kc2VxOworICNlbHNlCisgICAgICAgICAqKChiaXQzMiAqKShyZWNvcmQr
T0ZGU0VUX01PRFNFUSkpID0gaXRlbS0+bW9kc2VxOworICNlbmRpZgorIAorIAlpZiAoaXRlbS0+
bW9kc2VxID4gaGlnaGVzdG1vZHNlcSkgaGlnaGVzdG1vZHNlcSA9IGl0ZW0tPm1vZHNlcTsKKyAK
ICAgICAgICAgIGNhY2hlX3NpemUgKz0gbWVzc2FnZS0+Y2FjaGVfc2l6ZTsKICAgICAgICAgIHF1
b3RhX2FkZCAgKz0gbWVzc2FnZS0+bXNnX3NpemU7CiAgCioqKioqKioqKioqKioqKgoqKiogNTc5
LDU4NCAqKioqCi0tLSA2MDksNjI1IC0tLS0KICAgICAgLyogRml4IHVwIGxhc3RfYXBwZW5kIHRp
bWUgKi8KICAgICAgKigoYml0MzIgKikoaGJ1ZitPRkZTRVRfTEFTVF9BUFBFTkREQVRFKSkgPSBo
dG9ubChsYXN0X2FwcGVuZGRhdGUpOwogIAkKKyAgICAgLyogRml4IHVwIGhpZ2hlc3QgbW9kc2Vx
ICovCisgI2lmZGVmIEhBVkVfTE9OR19MT05HX0lOVAorICAgICBpZiAoaGlnaGVzdG1vZHNlcSA+
ICooKGJpdDY0ICopKGhidWYrT0ZGU0VUX0hJR0hFU1RNT0RTRVFfNjQpKSkgeworIAkqKChiaXQ2
NCAqKShoYnVmK09GRlNFVF9ISUdIRVNUTU9EU0VRXzY0KSkgPSBoaWdoZXN0bW9kc2VxOworICAg
ICB9CisgI2Vsc2UKKyAgICAgaWYgKGhpZ2hlc3Rtb2RzZXEgPiAqKChiaXQzMiAqKShoYnVmK09G
RlNFVF9ISUdIRVNUTU9EU0VRKSkpIHsKKyAJKigoYml0MzIgKikoaGJ1ZitPRkZTRVRfSElHSEVT
VE1PRFNFUSkpID0gaGlnaGVzdG1vZHNlcTsKKyAgICAgfQorICNlbmRpZgorIAogICAgICAvKiBB
bmQgd3JpdGUgaXQgYmFjayBvdXQgKi8KICAgICAgbHNlZWsobWFpbGJveC0+aW5kZXhfZmQsIDBM
LCBTRUVLX1NFVCk7CiAgCmRpZmYgLXIgLWMgY3lydXMtaW1hcGQtMi4zLjYtb3JpZy9pbWFwL3N5
bmNfc2VydmVyLmMgY3lydXMtaW1hcGQtMi4zLjYvaW1hcC9zeW5jX3NlcnZlci5jCioqKiBjeXJ1
cy1pbWFwZC0yLjMuNi1vcmlnL2ltYXAvc3luY19zZXJ2ZXIuYwlUdWUgRGVjIDIwIDE1OjU0OjQz
IDIwMDUKLS0tIGN5cnVzLWltYXBkLTIuMy42L2ltYXAvc3luY19zZXJ2ZXIuYwlUdWUgSnVsICA0
IDIwOjU1OjU3IDIwMDYKKioqKioqKioqKioqKioqCioqKiAxODMxLDE4MzYgKioqKgotLS0gMTgz
MSwxODQ3IC0tLS0KICAgICAgICAgICAgICBnb3RvIHBhcnNlX2VycjsKICAgICAgICAgIH0KICAK
KyAgICAgICAgIC8qIFBhcnNlIG1vZHNlcSAqLworICAgICAgICAgaWYgKChjID0gZ2V0YXN0cmlu
ZyhzeW5jX2luLCBzeW5jX291dCwgJmFyZykpICE9ICcgJykgeworICAgICAgICAgICAgIGVyciA9
ICJJbnZhbGlkIG1vZHNlcSI7CisgICAgICAgICAgICAgZ290byBwYXJzZV9lcnI7CisgICAgICAg
ICB9CisgI2lmZGVmIEhBVkVfTE9OR19MT05HX0lOVAorICAgICAgICAgaXRlbS0+bW9kc2VxID0g
c3luY19hdG91bGwoYXJnLnMpOworICNlbHNlCisgICAgICAgICBpdGVtLT5tb2RzZXEgPSBzeW5j
X2F0b3VsKGFyZy5zKTsKKyAjZW5kaWYKKyAgICAgICAgIAogICAgICAgICAgLyogUGFyc2UgRmxh
Z3MgKi8KICAgICAgICAgIGMgPSBzeW5jX2dldGZsYWdzKHN5bmNfaW4sICZpdGVtLT5mbGFncywg
JnVwbG9hZF9saXN0LT5tZXRhKTsKICAKZGlmZiAtciAtYyBjeXJ1cy1pbWFwZC0yLjMuNi1vcmln
L2ltYXAvc3luY19zdXBwb3J0LmggY3lydXMtaW1hcGQtMi4zLjYvaW1hcC9zeW5jX3N1cHBvcnQu
aAoqKiogY3lydXMtaW1hcGQtMi4zLjYtb3JpZy9pbWFwL3N5bmNfc3VwcG9ydC5oCVRodSBKdW4g
MTYgMDA6MDI6MTAgMjAwNQotLS0gY3lydXMtaW1hcGQtMi4zLjYvaW1hcC9zeW5jX3N1cHBvcnQu
aAlUdWUgSnVsICA0IDIwOjUyOjI0IDIwMDYKKioqKioqKioqKioqKioqCioqKiA1NCw1OSAqKioq
Ci0tLSA1NCw2MCAtLS0tCiAgI2RlZmluZSBTWU5DX01FU1NBR0VfTElTVF9NQVhfT1BFTl9GSUxF
UyAoNjQpCiAgCiAgI2RlZmluZSBzeW5jX2F0b3VsKHMpIHN0cnRvdWwocywgTlVMTCwgMTApCisg
I2RlZmluZSBzeW5jX2F0b3VsbChzKSBzdHJ0b3VsbChzLCBOVUxMLCAxMCkKICAKICBpbnQgc3lu
Y19lYXRsaW5lc191bnNvbGljaXRlZChzdHJ1Y3QgcHJvdHN0cmVhbSAqcGluLCBpbnQgYyk7CiAg
CioqKioqKioqKioqKioqKgoqKiogMzIzLDMyOCAqKioqCi0tLSAzMjQsMzMwIC0tLS0KICAgICAg
dGltZV90IGxhc3RfdXBkYXRlZDsKICAgICAgc3RydWN0IHN5bmNfZmxhZ3MgICAgZmxhZ3M7CiAg
ICAgIHN0cnVjdCBtZXNzYWdlX3V1aWQgIHV1aWQ7CisgICAgIG1vZHNlcV90IG1vZHNlcTsKICAg
ICAgc3RydWN0IHN5bmNfbWVzc2FnZSAqbWVzc2FnZTsKICB9OwogIAo=
</data>        

          </attachment>
          <attachment
              isobsolete="0"
              ispatch="1"
              isprivate="0"
          >
            <attachid>444</attachid>
            <date>2006-07-06 17:10 EDT</date>
            <desc>Endian-fixed modseq replication patch</desc>
            <filename>replicate_modseq.patch</filename>
            <type>text/plain</type>
            <size>6572</size>
            <attacher>david@madole.net</attacher>
            
              <data encoding="base64">ZGlmZiAtciAtYyBjeXJ1cy1pbWFwZC0yLjMuNi1vcmlnL2ltYXAvc3luY19jbGllbnQuYyBjeXJ1
cy1pbWFwZC0yLjMuNi9pbWFwL3N5bmNfY2xpZW50LmMKKioqIGN5cnVzLWltYXBkLTIuMy42LW9y
aWcvaW1hcC9zeW5jX2NsaWVudC5jCVR1ZSBBcHIgIDQgMTg6MTA6NTQgMjAwNgotLS0gY3lydXMt
aW1hcGQtMi4zLjYvaW1hcC9zeW5jX2NsaWVudC5jCVR1ZSBKdWwgIDQgMjA6MzI6NDMgMjAwNgoq
KioqKioqKioqKioqKioKKioqIDExMTgsMTEyNSAqKioqCiAgICAgIHVuc2lnbmVkIGxvbmcgbXNn
X3NpemUgPSAwOwogIAogICAgICAvKiBQcm90b2NvbCBmb3IgUEFSU0VEIGl0ZW1zOgohICAgICAg
KiBDOiAgUEFSU0VEICA8bXNnaWQ+IDx1aWQ+IAohICAgICAgKiAgICAgICAgICAgICA8aW50ZXJu
YWxkYXRlPiA8c2VudC1kYXRlPiA8bGFzdC11cGRhdGVkPiA8ZmxhZ3M+CiAgICAgICAqICAgICAg
ICAgICAgIDxoZHIgc2l6ZT4gPGNvbnRlbnRfbGluZXM+CiAgICAgICAqICAgICAgICAgICAgIDxj
YWNoZSBsaXRlcmFsIChpbmNsdWRlcyBjYWNoZSBzaXplISk+CiAgICAgICAqIDxtc2cgbGl0ZXJh
bCAoaW5jbHVkZXMgbXNnIHNpemUhKT4KLS0tIDExMjgsMTEzNSAtLS0tCiAgICAgIHVuc2lnbmVk
IGxvbmcgbXNnX3NpemUgPSAwOwogIAogICAgICAvKiBQcm90b2NvbCBmb3IgUEFSU0VEIGl0ZW1z
OgohICAgICAgKiBDOiAgUEFSU0VEICA8bXNnaWQ+IDx1aWQ+CiEgICAgICAqICAgICAgICAgICAg
IDxpbnRlcm5hbGRhdGU+IDxzZW50LWRhdGU+IDxsYXN0LXVwZGF0ZWQ+IDxtb2RzZXE+IDxmbGFn
cz4KICAgICAgICogICAgICAgICAgICAgPGhkciBzaXplPiA8Y29udGVudF9saW5lcz4KICAgICAg
ICogICAgICAgICAgICAgPGNhY2hlIGxpdGVyYWwgKGluY2x1ZGVzIGNhY2hlIHNpemUhKT4KICAg
ICAgICogPG1zZyBsaXRlcmFsIChpbmNsdWRlcyBtc2cgc2l6ZSEpPgoqKioqKioqKioqKioqKioK
KioqIDExMjcsMTEzMyAqKioqCiAgCiAgICAgIC8qIFByb3RvY29sIGZvciBDT1BZIGl0ZW1zOgog
ICAgICAgKiBDOiAgQ09QWSA8bXNnaWQ+IDx1aWQ+CiEgICAgICAqICAgICAgICAgICA8aW50ZXJu
YWxkYXRlPiA8c2VudC1kYXRlPiA8bGFzdC11cGRhdGVkPiA8ZmxhZ3M+CiAgICAgICAqLwogIAog
ICAgICBpZiAoc3luY19tc2dpZF9sb29rdXAobXNnaWRfb25zZXJ2ZXIsICZyZWNvcmQtPnV1aWQp
KSB7Ci0tLSAxMTM3LDExNDMgLS0tLQogIAogICAgICAvKiBQcm90b2NvbCBmb3IgQ09QWSBpdGVt
czoKICAgICAgICogQzogIENPUFkgPG1zZ2lkPiA8dWlkPgohICAgICAgKiAgICAgICAgICAgPGlu
dGVybmFsZGF0ZT4gPHNlbnQtZGF0ZT4gPGxhc3QtdXBkYXRlZD4gPG1vZHNlcT4gPGZsYWdzPgog
ICAgICAgKi8KICAKICAgICAgaWYgKHN5bmNfbXNnaWRfbG9va3VwKG1zZ2lkX29uc2VydmVyLCAm
cmVjb3JkLT51dWlkKSkgewoqKioqKioqKioqKioqKioKKioqIDExMzksMTE0OCAqKioqCiAgICAg
ICAgICBuZWVkX2JvZHkgPSAxOwogICAgICB9CiAgCiEgICAgIHByb3RfcHJpbnRmKHRvc2VydmVy
LCAiICVzICVsdSAlbHUgJWx1ICVsdSAoIiwKICAgICAgICAgICAgICAgbWVzc2FnZV91dWlkX3Rl
eHQoJnJlY29yZC0+dXVpZCksCiAgICAgICAgICAgICAgIHJlY29yZC0+dWlkLCByZWNvcmQtPmlu
dGVybmFsZGF0ZSwKISAgICAgICAgICAgICAgcmVjb3JkLT5zZW50ZGF0ZSwgcmVjb3JkLT5sYXN0
X3VwZGF0ZWQpOwogIAogICAgICBmbGFnc19wcmludGVkID0gMDsKICAKLS0tIDExNDksMTE1OCAt
LS0tCiAgICAgICAgICBuZWVkX2JvZHkgPSAxOwogICAgICB9CiAgCiEgICAgIHByb3RfcHJpbnRm
KHRvc2VydmVyLCAiICVzICVsdSAlbHUgJWx1ICVsdSAiIE1PRFNFUV9GTVQgIiAoIiwKICAgICAg
ICAgICAgICAgbWVzc2FnZV91dWlkX3RleHQoJnJlY29yZC0+dXVpZCksCiAgICAgICAgICAgICAg
IHJlY29yZC0+dWlkLCByZWNvcmQtPmludGVybmFsZGF0ZSwKISAgICAgICAgICAgICAgcmVjb3Jk
LT5zZW50ZGF0ZSwgcmVjb3JkLT5sYXN0X3VwZGF0ZWQsIHJlY29yZC0+bW9kc2VxKTsKICAKICAg
ICAgZmxhZ3NfcHJpbnRlZCA9IDA7CiAgCmRpZmYgLXIgLWMgY3lydXMtaW1hcGQtMi4zLjYtb3Jp
Zy9pbWFwL3N5bmNfY29tbWl0LmMgY3lydXMtaW1hcGQtMi4zLjYvaW1hcC9zeW5jX2NvbW1pdC5j
CioqKiBjeXJ1cy1pbWFwZC0yLjMuNi1vcmlnL2ltYXAvc3luY19jb21taXQuYwlUdWUgRGVjIDEz
IDE1OjMxOjEwIDIwMDUKLS0tIGN5cnVzLWltYXBkLTIuMy42L2ltYXAvc3luY19jb21taXQuYwlU
dWUgSnVsICA0IDIwOjUwOjQ3IDIwMDYKKioqKioqKioqKioqKioqCioqKiAxMDgsMTEzICoqKioK
LS0tIDEwOCwxMTQgLS0tLQogICAgICBzdHJ1Y3QgaW5kZXhfcmVjb3JkIHJlY29yZDsKICAgICAg
aW50ICAgbiwgciA9IDAsIHJjOwogICAgICBzdHJ1Y3QgdHhuICp0aWQgPSBOVUxMOworICAgICBt
b2RzZXFfdCBoaWdoZXN0bW9kc2VxID0gMDsKICAKICAgICAgaWYgKHVwbG9hZF9saXN0LT5jb3Vu
dCA9PSAwKSByZXR1cm4oMCk7ICAgLyogTk9PUCAqLwogIAoqKioqKioqKioqKioqKioKKioqIDIz
MywyMzggKioqKgotLS0gMjM0LDI0OCAtLS0tCiAgCQk9IGh0b25sKG1lc3NhZ2UtPmNhY2hlX3Zl
cnNpb24pOwogIAogICAgICAgICAgICAgIG1lc3NhZ2VfdXVpZF9wYWNrKCZpdGVtLT51dWlkLCBi
dWYrT0ZGU0VUX01FU1NBR0VfVVVJRCk7CisgCisgI2lmZGVmIEhBVkVfTE9OR19MT05HX0lOVAor
ICAgICAgICAgICAgICooKGJpdDY0ICopKGJ1ZitPRkZTRVRfTU9EU0VRXzY0KSkgPSBodG9ubGwo
aXRlbS0+bW9kc2VxKTsKKyAjZWxzZQorICAgICAgICAgICAgICooKGJpdDMyICopKGJ1ZitPRkZT
RVRfTU9EU0VRKSkgPSBodG9ubChpdGVtLT5tb2RzZXEpOworICNlbmRpZgorIAorIAkgICAgaWYg
KGl0ZW0tPm1vZHNlcSA+IGhpZ2hlc3Rtb2RzZXEpIGhpZ2hlc3Rtb2RzZXEgPSBpdGVtLT5tb2Rz
ZXE7CisgCiAgICAgICAgICAgICAgcXVvdGFfYWRkICArPSBtZXNzYWdlLT5tc2dfc2l6ZTsKICAK
ICAgICAgICAgICAgICBpZiAoaXRlbS0+ZmxhZ3Muc3lzdGVtX2ZsYWdzICYgRkxBR19BTlNXRVJF
RCkgbnVtYW5zd2VyZWRmbGFnKys7CioqKioqKioqKioqKioqKgoqKiogMjk3LDMwMiAqKioqCi0t
LSAzMDcsMzIzIC0tLS0KICAgICAgLyogRml4IHVwIGxhc3RfYXBwZW5kIHRpbWUgKi8KICAgICAg
KigoYml0MzIgKikoYnVmK09GRlNFVF9MQVNUX0FQUEVORERBVEUpKSA9IGh0b25sKGxhc3RfYXBw
ZW5kZGF0ZSk7CiAgCisgICAgIC8qIEZpeCB1cCBoaWdoZXN0IG1vZHNlcSAqLworICNpZmRlZiBI
QVZFX0xPTkdfTE9OR19JTlQKKyAgICAgaWYgKGhpZ2hlc3Rtb2RzZXEgPiBudG9obGwoKigoYml0
NjQgKikoYnVmK09GRlNFVF9ISUdIRVNUTU9EU0VRXzY0KSkpKSB7CisgCSooKGJpdDY0ICopKGJ1
ZitPRkZTRVRfSElHSEVTVE1PRFNFUV82NCkpID0gaHRvbmxsKGhpZ2hlc3Rtb2RzZXEpOworICAg
ICB9CisgI2Vsc2UKKyAgICAgaWYgKGhpZ2hlc3Rtb2RzZXEgPiBudG9obCgqKChiaXQzMiAqKShi
dWYrT0ZGU0VUX0hJR0hFU1RNT0RTRVEpKSkpIHsKKyAJKigoYml0MzIgKikoYnVmK09GRlNFVF9I
SUdIRVNUTU9EU0VRKSkgPSBodG9ubChoaWdoZXN0bW9kc2VxKTsKKyAgICAgfQorICNlbmRpZgor
IAogICAgICByZXdpbmQobmV3aW5kZXgpOwogICAgICBmd3JpdGUoYnVmLCAxLCBtYWlsYm94LT5z
dGFydF9vZmZzZXQsIG5ld2luZGV4KTsKICAKKioqKioqKioqKioqKioqCioqKiA0NTEsNDU2ICoq
KioKLS0tIDQ3Miw0NzggLS0tLQogICAgICBjaGFyICB0YXJnZXRbTUFYX01BSUxCT1hfUEFUSF07
CiAgICAgIGludCAgIG4sIHIgPSAwOwogICAgICBzdHJ1Y3QgdHhuICp0aWQgPSBOVUxMOworICAg
ICBtb2RzZXFfdCBoaWdoZXN0bW9kc2VxID0gMDsKICAKICAgICAgaWYgKHVwbG9hZF9saXN0LT5j
b3VudCA9PSAwKSByZXR1cm4oMCk7ICAgLyogTk9PUCAqLwogIAoqKioqKioqKioqKioqKioKKioq
IDQ5Myw0OTggKioqKgotLS0gNTE1LDUyOCAtLS0tCiAgCSAgICA9IGh0b25sKG1lc3NhZ2UtPmNh
Y2hlX3ZlcnNpb24pOwogICAgICAgICAgbWVzc2FnZV91dWlkX3BhY2soJml0ZW0tPnV1aWQsIHJl
Y29yZCtPRkZTRVRfTUVTU0FHRV9VVUlEKTsKICAKKyAjaWZkZWYgSEFWRV9MT05HX0xPTkdfSU5U
CisgICAgICAgICAqKChiaXQ2NCAqKShyZWNvcmQrT0ZGU0VUX01PRFNFUV82NCkpID0gaHRvbmxs
KGl0ZW0tPm1vZHNlcSk7CisgI2Vsc2UKKyAgICAgICAgICooKGJpdDMyICopKHJlY29yZCtPRkZT
RVRfTU9EU0VRKSkgPSBodG9ubChpdGVtLT5tb2RzZXEpOworICNlbmRpZgorIAorIAlpZiAoaXRl
bS0+bW9kc2VxID4gaGlnaGVzdG1vZHNlcSkgaGlnaGVzdG1vZHNlcSA9IGl0ZW0tPm1vZHNlcTsK
KyAKICAgICAgICAgIGNhY2hlX3NpemUgKz0gbWVzc2FnZS0+Y2FjaGVfc2l6ZTsKICAgICAgICAg
IHF1b3RhX2FkZCAgKz0gbWVzc2FnZS0+bXNnX3NpemU7CiAgCioqKioqKioqKioqKioqKgoqKiog
NTc5LDU4NCAqKioqCi0tLSA2MDksNjI1IC0tLS0KICAgICAgLyogRml4IHVwIGxhc3RfYXBwZW5k
IHRpbWUgKi8KICAgICAgKigoYml0MzIgKikoaGJ1ZitPRkZTRVRfTEFTVF9BUFBFTkREQVRFKSkg
PSBodG9ubChsYXN0X2FwcGVuZGRhdGUpOwogIAkKKyAgICAgLyogRml4IHVwIGhpZ2hlc3QgbW9k
c2VxICovCisgI2lmZGVmIEhBVkVfTE9OR19MT05HX0lOVAorICAgICBpZiAoaGlnaGVzdG1vZHNl
cSA+IG50b2hsbCgqKChiaXQ2NCAqKShoYnVmK09GRlNFVF9ISUdIRVNUTU9EU0VRXzY0KSkpKSB7
CisgCSooKGJpdDY0ICopKGhidWYrT0ZGU0VUX0hJR0hFU1RNT0RTRVFfNjQpKSA9IGh0b25sbCho
aWdoZXN0bW9kc2VxKTsKKyAgICAgfQorICNlbHNlCisgICAgIGlmIChoaWdoZXN0bW9kc2VxID4g
bnRvaGwoKigoYml0MzIgKikoaGJ1ZitPRkZTRVRfSElHSEVTVE1PRFNFUSkpKSkgeworIAkqKChi
aXQzMiAqKShoYnVmK09GRlNFVF9ISUdIRVNUTU9EU0VRKSkgPSBodG9ubChoaWdoZXN0bW9kc2Vx
KTsKKyAgICAgfQorICNlbmRpZgorIAogICAgICAvKiBBbmQgd3JpdGUgaXQgYmFjayBvdXQgKi8K
ICAgICAgbHNlZWsobWFpbGJveC0+aW5kZXhfZmQsIDBMLCBTRUVLX1NFVCk7CiAgCmRpZmYgLXIg
LWMgY3lydXMtaW1hcGQtMi4zLjYtb3JpZy9pbWFwL3N5bmNfc2VydmVyLmMgY3lydXMtaW1hcGQt
Mi4zLjYvaW1hcC9zeW5jX3NlcnZlci5jCioqKiBjeXJ1cy1pbWFwZC0yLjMuNi1vcmlnL2ltYXAv
c3luY19zZXJ2ZXIuYwlUdWUgRGVjIDIwIDE1OjU0OjQzIDIwMDUKLS0tIGN5cnVzLWltYXBkLTIu
My42L2ltYXAvc3luY19zZXJ2ZXIuYwlUdWUgSnVsICA0IDIwOjU1OjU3IDIwMDYKKioqKioqKioq
KioqKioqCioqKiAxODMxLDE4MzYgKioqKgotLS0gMTgzMSwxODQ3IC0tLS0KICAgICAgICAgICAg
ICBnb3RvIHBhcnNlX2VycjsKICAgICAgICAgIH0KICAKKyAgICAgICAgIC8qIFBhcnNlIG1vZHNl
cSAqLworICAgICAgICAgaWYgKChjID0gZ2V0YXN0cmluZyhzeW5jX2luLCBzeW5jX291dCwgJmFy
ZykpICE9ICcgJykgeworICAgICAgICAgICAgIGVyciA9ICJJbnZhbGlkIG1vZHNlcSI7CisgICAg
ICAgICAgICAgZ290byBwYXJzZV9lcnI7CisgICAgICAgICB9CisgI2lmZGVmIEhBVkVfTE9OR19M
T05HX0lOVAorICAgICAgICAgaXRlbS0+bW9kc2VxID0gc3luY19hdG91bGwoYXJnLnMpOworICNl
bHNlCisgICAgICAgICBpdGVtLT5tb2RzZXEgPSBzeW5jX2F0b3VsKGFyZy5zKTsKKyAjZW5kaWYK
KyAgICAgICAgIAogICAgICAgICAgLyogUGFyc2UgRmxhZ3MgKi8KICAgICAgICAgIGMgPSBzeW5j
X2dldGZsYWdzKHN5bmNfaW4sICZpdGVtLT5mbGFncywgJnVwbG9hZF9saXN0LT5tZXRhKTsKICAK
ZGlmZiAtciAtYyBjeXJ1cy1pbWFwZC0yLjMuNi1vcmlnL2ltYXAvc3luY19zdXBwb3J0LmggY3ly
dXMtaW1hcGQtMi4zLjYvaW1hcC9zeW5jX3N1cHBvcnQuaAoqKiogY3lydXMtaW1hcGQtMi4zLjYt
b3JpZy9pbWFwL3N5bmNfc3VwcG9ydC5oCVRodSBKdW4gMTYgMDA6MDI6MTAgMjAwNQotLS0gY3ly
dXMtaW1hcGQtMi4zLjYvaW1hcC9zeW5jX3N1cHBvcnQuaAlUdWUgSnVsICA0IDIwOjUyOjI0IDIw
MDYKKioqKioqKioqKioqKioqCioqKiA1NCw1OSAqKioqCi0tLSA1NCw2MCAtLS0tCiAgI2RlZmlu
ZSBTWU5DX01FU1NBR0VfTElTVF9NQVhfT1BFTl9GSUxFUyAoNjQpCiAgCiAgI2RlZmluZSBzeW5j
X2F0b3VsKHMpIHN0cnRvdWwocywgTlVMTCwgMTApCisgI2RlZmluZSBzeW5jX2F0b3VsbChzKSBz
dHJ0b3VsbChzLCBOVUxMLCAxMCkKICAKICBpbnQgc3luY19lYXRsaW5lc191bnNvbGljaXRlZChz
dHJ1Y3QgcHJvdHN0cmVhbSAqcGluLCBpbnQgYyk7CiAgCioqKioqKioqKioqKioqKgoqKiogMzIz
LDMyOCAqKioqCi0tLSAzMjQsMzMwIC0tLS0KICAgICAgdGltZV90IGxhc3RfdXBkYXRlZDsKICAg
ICAgc3RydWN0IHN5bmNfZmxhZ3MgICAgZmxhZ3M7CiAgICAgIHN0cnVjdCBtZXNzYWdlX3V1aWQg
IHV1aWQ7CisgICAgIG1vZHNlcV90IG1vZHNlcTsKICAgICAgc3RydWN0IHN5bmNfbWVzc2FnZSAq
bWVzc2FnZTsKICB9OwogIAo=
</data>        

          </attachment>
      

    </bug>

</bugzilla>