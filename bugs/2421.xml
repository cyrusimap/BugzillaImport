<?xml version="1.0" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugzilla.cyrusimap.org/bugzilla.dtd">

<bugzilla version="3.2.5.1-2"
          urlbase="https://bugzilla.cyrusimap.org/"
          maintainer="Dave McMurtrie &lt;dave64@andrew.cmu.edu&gt;"
>

    <bug>
          <bug_id>2421</bug_id>
          
          <creation_ts>2004-04-20 10:26 EDT</creation_ts>
          <short_desc>lmtpd and pop3d segfault when using krb5 auth</short_desc>
          <delta_ts>2010-10-18 12:43:05 EDT</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Cyrus IMAP</product>
          <component>lib</component>
          <version>2.2.x</version>
          <rep_platform>PC</rep_platform>
          <op_sys>other</op_sys>
          <bug_status>CLOSED</bug_status>
          <resolution>FIXED</resolution>
          
          
          
          
          <priority>P2</priority>
          <bug_severity>bug</bug_severity>
          <target_milestone>Future</target_milestone>
          
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Jukka Salmi">j+asg@salmi.ch</reporter>
          <assigned_to name="Rob Siemborski">rjs3@andrew.cmu.edu</assigned_to>
          
          <qa_contact name="The Cyrus Bugzilla List">cyrus-bugzilla@lists.andrew.cmu.edu</qa_contact>

      

      

      
          <long_desc isprivate="0">
            <who name="Jukka Salmi">j+asg@salmi.ch</who>
            <bug_when>2004-04-20 10:26:13 EDT</bug_when>
            <thetext>When using the Kerberos 5 authorisation module (i.e. &apos;./configure
--with-auth=krb5&apos;) lmtpd and pop3d dump core. I tested this on NetBSD (1.6.2
stable and 2.0C current), and it&apos;s 100% reproduceable.

I&apos;m using the following software:
  cyrus-imapd-2.2.3
  cyrus-sasl-2.1.18
  heimdal-0.6.1

In cyrus-imapd-2.2.3/lib/auth_krb5.c, line 77, auth_state-&gt;userid is referenced.
However, auth_state is NULL, so this causes the SIGSEGV. A complete backtrace
follows:

$ gdb -c lmtpd.core /usr/pkg/cyrus/bin/lmtpd 
GNU gdb 5.0nb1
Copyright 2000 Free Software Foundation, Inc.
GDB is free software, covered by the GNU General Public License, and you are
welcome to change it and/or distribute copies of it under certain conditions.
Type &quot;show copying&quot; to see the conditions.
There is absolutely no warranty for GDB.  Type &quot;show warranty&quot; for details.
This GDB was configured as &quot;i386--netbsdelf&quot;...
Core was generated by `lmtpd&apos;.
Program terminated with signal 11, Segmentation fault.
Reading symbols from /usr/libexec/ld.elf_so...done.
Loaded symbols for /usr/libexec/ld.elf_so
Reading symbols from /usr/pkg/lib/libsasl2.so.2...done.
Loaded symbols for /usr/pkg/lib/libsasl2.so.2
Reading symbols from /usr/pkg/lib/libgssapi.so.5...done.
Loaded symbols for /usr/pkg/lib/libgssapi.so.5
Reading symbols from /usr/pkg/lib/libkrb5.so.20...done.
Loaded symbols for /usr/pkg/lib/libkrb5.so.20
Reading symbols from /usr/pkg/lib/libasn1.so.6...done.
Loaded symbols for /usr/pkg/lib/libasn1.so.6
Reading symbols from /usr/pkg/lib/libroken.so.16...done.
Loaded symbols for /usr/pkg/lib/libroken.so.16
Reading symbols from /usr/pkg/lib/libcom_err.so.2...done.
Loaded symbols for /usr/pkg/lib/libcom_err.so.2
Reading symbols from /usr/lib/libresolv.so.1...done.
Loaded symbols for /usr/lib/libresolv.so.1
Reading symbols from /usr/pkg/lib/libdb4-4.2.so.2...done.
Loaded symbols for /usr/pkg/lib/libdb4-4.2.so.2
Reading symbols from /usr/lib/libssl.so.2...done.
Loaded symbols for /usr/lib/libssl.so.2
Reading symbols from /usr/lib/libcrypto.so.1...done.
Loaded symbols for /usr/lib/libcrypto.so.1
Reading symbols from /usr/lib/libwrap.so.0...done.
Loaded symbols for /usr/lib/libwrap.so.0
Reading symbols from /usr/lib/libc.so.12...done.
Loaded symbols for /usr/lib/libc.so.12
Reading symbols from /usr/lib/libcrypt.so.0...done.
Loaded symbols for /usr/lib/libcrypt.so.0
---Type &lt;return&gt; to continue, or q &lt;return&gt; to quit---
Reading symbols from /usr/pkg/lib/sasl2/libsasldb.so.2...done.
Loaded symbols for /usr/pkg/lib/sasl2/libsasldb.so.2
Reading symbols from /usr/pkg/lib/sasl2/libcrammd5.so.2...done.
Loaded symbols for /usr/pkg/lib/sasl2/libcrammd5.so.2
Reading symbols from /usr/pkg/lib/sasl2/libdigestmd5.so.2...done.
Loaded symbols for /usr/pkg/lib/sasl2/libdigestmd5.so.2
Reading symbols from /usr/pkg/lib/sasl2/libotp.so.2...done.
Loaded symbols for /usr/pkg/lib/sasl2/libotp.so.2
Reading symbols from /usr/pkg/lib/sasl2/libgssapiv2.so.2...done.
Loaded symbols for /usr/pkg/lib/sasl2/libgssapiv2.so.2
Reading symbols from /usr/pkg/lib/sasl2/libplain.so.2...done.
Loaded symbols for /usr/pkg/lib/sasl2/libplain.so.2
Reading symbols from /usr/pkg/lib/sasl2/libanonymous.so.2...done.
Loaded symbols for /usr/pkg/lib/sasl2/libanonymous.so.2
#0  0x80805a5 in auth_memberof (auth_state=0x0, identifier=0x8121820 &quot;jukka&quot;)
    at auth_krb5.c:77
77          if (strcmp(identifier,auth_state-&gt;userid) == 0) return 3;
(gdb) bt
#0  0x80805a5 in auth_memberof (auth_state=0x0, identifier=0x8121820 &quot;jukka&quot;)
    at auth_krb5.c:77
#1  0x80801da in cyrus_acl_myrights (auth_state=0x0, acl=0x8121820 &quot;jukka&quot;)
    at acl_afs.c:94
#2  0x8057717 in mailbox_open_header_path (name=0xbfbfabe0 &quot;user.jukka&quot;, 
    path=0x8112520 &quot;/var/spool/imap/user/jukka&quot;, 
    acl=0x8127400 &quot;jukka\tlrswipcda\t&quot;, auth_state=0x0, mailbox=0xbfbfa8cc, 
    suppresslog=0) at mailbox.c:450
#3  0x80575bc in mailbox_open_header (name=0xbfbfabe0 &quot;user.jukka&quot;, 
    auth_state=0x0, mailbox=0xbfbfa8cc) at mailbox.c:399
#4  0x805542a in append_check (name=0xbfbfabe0 &quot;user.jukka&quot;, format=0, 
    auth_state=0x0, aclcheck=0, quotacheck=0) at append.c:118
#5  0x804f59b in verify_user (user=0x81217c1 &quot;jukka&quot;, quotacheck=307, 
    authstate=0x0) at lmtpd.c:1342
#6  0x80508ce in process_recipient (addr=0x81217c0 &quot;&lt;jukka&quot;, ignorequota=0, 
    verify_user=0x804f398 &lt;verify_user&gt;, msg=0x8122340) at lmtpengine.c:816
#7  0x8051ad5 in lmtpmode (func=0x810e5a0, pin=0x8127280, pout=0x8127300, fd=0)
    at lmtpengine.c:1382
#8  0x804d496 in service_main (argc=1, argv=0x8122000, envp=0xbfbfda54)
    at lmtpd.c:276
#9  0x804d1de in main (argc=1, argv=0xbfbfda4c, envp=0xbfbfda54)
    at service.c:546
#10 0x804c380 in ___start ()
(gdb) quit</thetext>
          </long_desc>
          <long_desc isprivate="0">
            <who name="Rob Siemborski">rjs3@andrew.cmu.edu</who>
            <bug_when>2004-04-20 10:32:00 EDT</bug_when>
            <thetext>already fixed in cvs.</thetext>
          </long_desc>
      
      

    </bug>

</bugzilla>