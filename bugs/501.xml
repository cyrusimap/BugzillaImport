<?xml version="1.0" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugzilla.cyrusimap.org/bugzilla.dtd">

<bugzilla version="3.2.5.1-2"
          urlbase="https://bugzilla.cyrusimap.org/"
          maintainer="Dave McMurtrie &lt;dave64@andrew.cmu.edu&gt;"
>

    <bug>
          <bug_id>501</bug_id>
          
          <creation_ts>2001-06-28 18:22 EDT</creation_ts>
          <short_desc>static linking (continued)</short_desc>
          <delta_ts>2001-07-30 13:51:13 EDT</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Cyrus SASL</product>
          <component>SASL</component>
          <version>2.0</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>CLOSED</bug_status>
          <resolution>FIXED</resolution>
          
          
          
          
          <priority>P3</priority>
          <bug_severity>enhancement</bug_severity>
          <target_milestone>Future</target_milestone>
          
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Larry Greenfield">leg+cyrus@andrew.cmu.edu</reporter>
          <assigned_to name="Rob Siemborski">rjs3@andrew.cmu.edu</assigned_to>
          
          

      

      

      
          <long_desc isprivate="0">
            <who name="Larry Greenfield">leg+cyrus@andrew.cmu.edu</who>
            <bug_when>2001-06-28 18:22:50 EDT</bug_when>
            <thetext>it would be nice if we had the option of making everything statically linked
(all plugins are no longer plugins but built-in mechanisms).  this can be
painful from the configure script / Makefile.am way of thinking but should be
doable.</thetext>
          </long_desc>
          <long_desc isprivate="0">
            <who name="Larry Greenfield">leg+cyrus@andrew.cmu.edu</who>
            <bug_when>2001-06-28 18:23:28 EDT</bug_when>
            <thetext>Created an attachment (id=18)
tim&apos;s patch to libsasl v1
</thetext>
          </long_desc>
          <long_desc isprivate="0">
            <who name="Rob Siemborski">rjs3@andrew.cmu.edu</who>
            <bug_when>2001-06-29 21:45:03 EDT</bug_when>
            <thetext>I&apos;m pretty sure tim&apos;s patch breaks rather nastily with the new API in terms of
portability of the plugins, but it&apos;s certainly a place to start.</thetext>
          </long_desc>
          <long_desc isprivate="0">
            <who name="Rob Siemborski">rjs3@andrew.cmu.edu</who>
            <bug_when>2001-07-02 18:48:41 EDT</bug_when>
            <thetext>static linking seems to work nicely now (will be committed before 1930 today)

need to add some things:
  - make static linking optional
  - testsuite against staticly linked library.</thetext>
          </long_desc>
          <long_desc isprivate="0">
            <who name="Rob Siemborski">rjs3@andrew.cmu.edu</who>
            <bug_when>2001-07-02 18:51:50 EDT</bug_when>
            <thetext>Do we really want to build .a&apos;s of all the plugins?  This seems somewhat
pointless....</thetext>
          </long_desc>
          <long_desc isprivate="0">
            <who name="Rob Siemborski">rjs3@andrew.cmu.edu</who>
            <bug_when>2001-07-03 11:17:53 EDT</bug_when>
            <thetext>no, we don&apos;t (and don&apos;t anymore)</thetext>
          </long_desc>
          <long_desc isprivate="0">
            <who name="Rob Siemborski">rjs3@andrew.cmu.edu</who>
            <bug_when>2001-07-03 12:01:32 EDT</bug_when>
            <thetext>made --with-staticsasl configure flag</thetext>
          </long_desc>
      
          <attachment
              isobsolete="0"
              ispatch="1"
              isprivate="0"
          >
            <attachid>18</attachid>
            <date>2001-06-28 18:23 EDT</date>
            <desc>tim&apos;s patch to libsasl v1</desc>
            <filename>static_libsasl_and_srp.diff</filename>
            <type>text/plain</type>
            <size>138918</size>
            <attacher>leg+cyrus@andrew.cmu.edu</attacher>
            
              <data encoding="base64">PyBjbXVsb2NhbAo/IGNvbmZpZy5oLmluCj8gc3RhbXAtaC5pbgo/IE1ha2VmaWxlLmluCj8gY29u
ZmlndXJlCj8gY29uZmlnLmxvZwo/IGNvbmZpZy5oCj8gYWRpZmYKPyBsaWJ0b29sCj8gY29uZmln
LnN0YXR1cwo/IHN0YW1wLWgKPyBNYWtlZmlsZQo/IHN0YXRpYy5kaWZmCj8gYWNsb2NhbC5tNAo/
IGNvbmZpZy5jYWNoZQo/IGxpYi9NYWtlZmlsZQo/IGxpYi9NYWtlZmlsZS5pbgo/IGxpYi90ZXN0
LnMKPyBsaWIvdGVzdC5jCj8gbGliL2Eub3V0Cj8gbGliL3N0YXRpY29wZW4uYwo/IGxpYi9NYWtl
ZmlsZS5hbTIKPyBsaWIvY29tbW9uLmxvCj8gbGliL3Nhc2x1dGlsLmxvCj8gbGliL3NlcnZlci5s
bwo/IGxpYi9jbGllbnQubG8KPyBsaWIvbWQ1LmxvCj8gbGliL2Rsb3Blbi5sbwo/IGxpYi9jaGVj
a3B3LmxvCj8gbGliL2NvbmZpZy5sbwo/IGxpYi9kYl9nZGJtLmxvCj8gbGliLy5saWJzCj8gbGli
L2xpYnNhc2wubGEKPyBwbHVnaW5zL01ha2VmaWxlCj8gcGx1Z2lucy9jcmFtLmxvCj8gcGx1Z2lu
cy8ubGlicwo/IHBsdWdpbnMvcGxhaW4ubG8KPyBwbHVnaW5zL2xpYmNyYW1tZDUubGEKPyBwbHVn
aW5zL2RpZ2VzdG1kNS5sbwo/IHBsdWdpbnMvbGliZGlnZXN0bWQ1LmxhCj8gcGx1Z2lucy9saWJn
c3NhcGl2Mi5sYQo/IHBsdWdpbnMvYW5vbnltb3VzLmxvCj8gcGx1Z2lucy9saWJhbm9ueW1vdXMu
bGEKPyBwbHVnaW5zL2xpYnBsYWluLmxhCj8gcGx1Z2lucy9zcnAubG8KPyBwbHVnaW5zL2xpYnNy
cC5sYQo/IHBsdWdpbnMvTWFrZWZpbGUuaW4KPyBwbHVnaW5zL3N0azQ4NjcxCkluZGV4OiBDT1BZ
SU5HCj09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT0KUkNTIGZpbGU6IC9hZnMvYW5kcmV3L3N5c3RlbS9jdnMvc3JjL3Nhc2wv
Q09QWUlORyx2CnJldHJpZXZpbmcgcmV2aXNpb24gMS40CmRpZmYgLXUgLXIxLjQgQ09QWUlORwot
LS0gQ09QWUlORwkyMDAwLzAzLzA3IDA1OjE5OjUwCTEuNAorKysgQ09QWUlORwkyMDAxLzA0LzI1
IDAwOjMzOjI3CkBAIC0xLDQzICsxLDIwIEBACi0vKiBDTVUgbGlic2FzbAotICogVGltIE1hcnRp
bgotICogUm9iIEVhcmhhcnQKLSAqLwotLyogCi0gKiBDb3B5cmlnaHQgKGMpIDIwMDAgQ2FybmVn
aWUgTWVsbG9uIFVuaXZlcnNpdHkuICBBbGwgcmlnaHRzIHJlc2VydmVkLgotICoKLSAqIFJlZGlz
dHJpYnV0aW9uIGFuZCB1c2UgaW4gc291cmNlIGFuZCBiaW5hcnkgZm9ybXMsIHdpdGggb3Igd2l0
aG91dAotICogbW9kaWZpY2F0aW9uLCBhcmUgcGVybWl0dGVkIHByb3ZpZGVkIHRoYXQgdGhlIGZv
bGxvd2luZyBjb25kaXRpb25zCi0gKiBhcmUgbWV0OgotICoKLSAqIDEuIFJlZGlzdHJpYnV0aW9u
cyBvZiBzb3VyY2UgY29kZSBtdXN0IHJldGFpbiB0aGUgYWJvdmUgY29weXJpZ2h0Ci0gKiAgICBu
b3RpY2UsIHRoaXMgbGlzdCBvZiBjb25kaXRpb25zIGFuZCB0aGUgZm9sbG93aW5nIGRpc2NsYWlt
ZXIuIAotICoKLSAqIDIuIFJlZGlzdHJpYnV0aW9ucyBpbiBiaW5hcnkgZm9ybSBtdXN0IHJlcHJv
ZHVjZSB0aGUgYWJvdmUgY29weXJpZ2h0Ci0gKiAgICBub3RpY2UsIHRoaXMgbGlzdCBvZiBjb25k
aXRpb25zIGFuZCB0aGUgZm9sbG93aW5nIGRpc2NsYWltZXIgaW4KLSAqICAgIHRoZSBkb2N1bWVu
dGF0aW9uIGFuZC9vciBvdGhlciBtYXRlcmlhbHMgcHJvdmlkZWQgd2l0aCB0aGUKLSAqICAgIGRp
c3RyaWJ1dGlvbi4KLSAqCi0gKiAzLiBUaGUgbmFtZSAiQ2FybmVnaWUgTWVsbG9uIFVuaXZlcnNp
dHkiIG11c3Qgbm90IGJlIHVzZWQgdG8KLSAqICAgIGVuZG9yc2Ugb3IgcHJvbW90ZSBwcm9kdWN0
cyBkZXJpdmVkIGZyb20gdGhpcyBzb2Z0d2FyZSB3aXRob3V0Ci0gKiAgICBwcmlvciB3cml0dGVu
IHBlcm1pc3Npb24uIEZvciBwZXJtaXNzaW9uIG9yIGFueSBvdGhlciBsZWdhbAotICogICAgZGV0
YWlscywgcGxlYXNlIGNvbnRhY3QgIAotICogICAgICBPZmZpY2Ugb2YgVGVjaG5vbG9neSBUcmFu
c2ZlcgotICogICAgICBDYXJuZWdpZSBNZWxsb24gVW5pdmVyc2l0eQotICogICAgICA1MDAwIEZv
cmJlcyBBdmVudWUKLSAqICAgICAgUGl0dHNidXJnaCwgUEEgIDE1MjEzLTM4OTAKLSAqICAgICAg
KDQxMikgMjY4LTQzODcsIGZheDogKDQxMikgMjY4LTczOTUKLSAqICAgICAgdGVjaC10cmFuc2Zl
ckBhbmRyZXcuY211LmVkdQotICoKLSAqIDQuIFJlZGlzdHJpYnV0aW9ucyBvZiBhbnkgZm9ybSB3
aGF0c29ldmVyIG11c3QgcmV0YWluIHRoZSBmb2xsb3dpbmcKLSAqICAgIGFja25vd2xlZGdtZW50
OgotICogICAgIlRoaXMgcHJvZHVjdCBpbmNsdWRlcyBzb2Z0d2FyZSBkZXZlbG9wZWQgYnkgQ29t
cHV0aW5nIFNlcnZpY2VzCi0gKiAgICAgYXQgQ2FybmVnaWUgTWVsbG9uIFVuaXZlcnNpdHkgKGh0
dHA6Ly93d3cuY211LmVkdS9jb21wdXRpbmcvKS4iCi0gKgotICogQ0FSTkVHSUUgTUVMTE9OIFVO
SVZFUlNJVFkgRElTQ0xBSU1TIEFMTCBXQVJSQU5USUVTIFdJVEggUkVHQVJEIFRPCi0gKiBUSElT
IFNPRlRXQVJFLCBJTkNMVURJTkcgQUxMIElNUExJRUQgV0FSUkFOVElFUyBPRiBNRVJDSEFOVEFC
SUxJVFkKLSAqIEFORCBGSVRORVNTLCBJTiBOTyBFVkVOVCBTSEFMTCBDQVJORUdJRSBNRUxMT04g
VU5JVkVSU0lUWSBCRSBMSUFCTEUKLSAqIEZPUiBBTlkgU1BFQ0lBTCwgSU5ESVJFQ1QgT1IgQ09O
U0VRVUVOVElBTCBEQU1BR0VTIE9SIEFOWSBEQU1BR0VTCi0gKiBXSEFUU09FVkVSIFJFU1VMVElO
RyBGUk9NIExPU1MgT0YgVVNFLCBEQVRBIE9SIFBST0ZJVFMsIFdIRVRIRVIgSU4KLSAqIEFOIEFD
VElPTiBPRiBDT05UUkFDVCwgTkVHTElHRU5DRSBPUiBPVEhFUiBUT1JUSU9VUyBBQ1RJT04sIEFS
SVNJTkcKLSAqIE9VVCBPRiBPUiBJTiBDT05ORUNUSU9OIFdJVEggVEhFIFVTRSBPUiBQRVJGT1JN
QU5DRSBPRiBUSElTIFNPRlRXQVJFLgotICovCisgICAgICAgIENvcHlyaWdodCAxOTk4IGJ5IENh
cm5lZ2llIE1lbGxvbiBVbml2ZXJzaXR5CisKKyAgICAgICAgICAgICAgICAgICAgICBBbGwgUmln
aHRzIFJlc2VydmVkCisKK1Blcm1pc3Npb24gdG8gdXNlLCBjb3B5LCBtb2RpZnksIGFuZCBkaXN0
cmlidXRlIHRoaXMgc29mdHdhcmUgYW5kIGl0cworZG9jdW1lbnRhdGlvbiBmb3IgYW55IHB1cnBv
c2UgYW5kIHdpdGhvdXQgZmVlIGlzIGhlcmVieSBncmFudGVkLAorcHJvdmlkZWQgdGhhdCB0aGUg
YWJvdmUgY29weXJpZ2h0IG5vdGljZSBhcHBlYXIgaW4gYWxsIGNvcGllcyBhbmQgdGhhdAorYm90
aCB0aGF0IGNvcHlyaWdodCBub3RpY2UgYW5kIHRoaXMgcGVybWlzc2lvbiBub3RpY2UgYXBwZWFy
IGluCitzdXBwb3J0aW5nIGRvY3VtZW50YXRpb24sIGFuZCB0aGF0IHRoZSBuYW1lIG9mIENhcm5l
Z2llIE1lbGxvbiBVbml2ZXJzaXR5Citub3QgYmUgdXNlZCBpbiBhZHZlcnRpc2luZyBvciBwdWJs
aWNpdHkgcGVydGFpbmluZyB0byBkaXN0cmlidXRpb24gb2YgdGhlCitzb2Z0d2FyZSB3aXRob3V0
IHNwZWNpZmljLCB3cml0dGVuIHByaW9yIHBlcm1pc3Npb24uCisKK0NBUk5FR0lFIE1FTExPTiBV
TklWRVJTSVRZIERJU0NMQUlNUyBBTEwgV0FSUkFOVElFUyBXSVRIIFJFR0FSRCBUTyBUSElTCitT
T0ZUV0FSRSwgSU5DTFVESU5HIEFMTCBJTVBMSUVEIFdBUlJBTlRJRVMgT0YgTUVSQ0hBTlRBQklM
SVRZIEFORCBGSVRORVNTLAorSU4gTk8gRVZFTlQgU0hBTEwgQ0FSTkVHSUUgTUVMTE9OIFVOSVZF
UlNJVFkgQkUgTElBQkxFIEZPUiBBTlkgU1BFQ0lBTCwKK0lORElSRUNUIE9SIENPTlNFUVVFTlRJ
QUwgREFNQUdFUyBPUiBBTlkgREFNQUdFUyBXSEFUU09FVkVSIFJFU1VMVElORyBGUk9NCitMT1NT
IE9GIFVTRSwgREFUQSBPUiBQUk9GSVRTLCBXSEVUSEVSIElOIEFOIEFDVElPTiBPRiBDT05UUkFD
VCwgTkVHTElHRU5DRQorT1IgT1RIRVIgVE9SVElPVVMgQUNUSU9OLCBBUklTSU5HIE9VVCBPRiBP
UiBJTiBDT05ORUNUSU9OIFdJVEggVEhFIFVTRSBPUiAKK1BFUkZPUk1BTkNFIE9GIFRISVMgU09G
VFdBUkUuCisKSW5kZXg6IFJFQURNRS5hbmRyZXcKPT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQpSQ1MgZmlsZTogL2Fmcy9h
bmRyZXcvc3lzdGVtL2N2cy9zcmMvc2FzbC9SRUFETUUuYW5kcmV3LHYKcmV0cmlldmluZyByZXZp
c2lvbiAxLjEyCmRpZmYgLXUgLXIxLjEyIFJFQURNRS5hbmRyZXcKLS0tIFJFQURNRS5hbmRyZXcJ
MjAwMC8wNC8xMyAxOTo0OTo0MAkxLjEyCisrKyBSRUFETUUuYW5kcmV3CTIwMDEvMDQvMjUgMDA6
MzM6MjcKQEAgLTEsMTIyICsxLDcxIEBACi0jIS9iaW4vc2gKLXNtYWtlIC1nbnUgaW5pdCBpbnN0
YWxsCi1leGl0IDAKLQotVG8gd2FzaCwgInNtYWtlIC1nbnUgd2FzaCBpbnN0YWxsIi4KLQotVXNl
IHRoZSB2ZW5kb3IgY2MgaWYgcG9zc2libGUgb24gcGxhdGZvcm1zIHdoaWNoIGhhdmUgcHVyaWZ5
IChpdCBoYXMKLXByb2JsZW1zIGRlYWxpbmcgd2l0aCBjb2RlIHByb2R1Y2VkIGJ5IGdjYyAyLjgu
MSkuCi0KLQlPbiBJUklYLCBzZXRlbnYgQ0MgY2MgYW5kIHNldGVudiBDRkxBR1MgLU8yIC0gbm8g
LXNvcHQgZm9yIG5vdwotCU9uIFNvbGFyaXMsIHNldGVudiBDQyBjYyBhbmQgc2V0ZW52IENGTEFH
UyAtZmFzdAotCi0tLS0tCi1UbyByZWxlYXNlOgotLSBydW4gdGVzdHN1aXRlIHN1Y2Nlc3NmdWxs
eQotLSBpbmNyZW1lbnQgdmVyc2lvbiBpbiBjb25maWd1cmUuaW4KLS0gc3luY2hyb25pemUgdmVy
c2lvbiB3aXRoIGluY2x1ZGUvc2FzbC5oIGFuZCB3aW4zMi9pbmNsdWRlL2NvbmZpZy5oCi0tIG1v
ZGlmeSBsaWJyYXJ5IHZlcnNpb25zIGluIGxpYi9NYWtlZmlsZS5hbSBhbmQgcGx1Z2lucy9NYWtl
ZmlsZS5hbQotICBhY2NvcmRpbmdseSAoc2VlIGxpYnRvb2wgaW5mbyBmaWxlIGZvciBkZXRhaWxz
KQotLSBhZGQgcmVsZWFzZSBub3RpY2UgdG8gQ2hhbmdlTG9nCi0tIGFkZCB1c2VyIHZpc2libGUg
Y2hhbmdlcyB0byBORVdTCi0KLS0gdGFnIHRoZSBDVlMgcmVwb3NpdG9yeSB3aXRoIHNhc2wtTWFq
b3JfTWlub3JfUmV2aXNpb24KLS0gdG8gbWFrZSB0YXJiYWxsOiBtYWtlIGRpc3RjaGVjawotLSBj
b21waWxlIG9uIG5vbi1hbmRyZXcgbWFjaGluZQotCi0tIGNvcHkgdG8gL2Fmcy9hbmRyZXcvc3lz
dGVtL2FyY2hpdmUvY211L2Fub25mdHAvcHViL2N5cnVzLW1haWwKLS0gc2lnbiB0aGUgZGlzdHJp
YnV0aW9uIChwZ3AgLXNiIGZvby50YXIuZ3opCi0KLS0gdXBkYXRlIGFzZy53ZWIuY211LmVkdQot
LSBhbm5vdW5jZSB0bzoKLSAgICBpbmZvLWN5cnVzQGFuZHJldy5jbXUuZWR1Ci0gICAgY3lydXMt
c2FzbEBsaXN0cy5hbmRyZXcuY211LmVkdQotCi0gICAgY29tcC5vcy5saW51eC5hbm5vdW5jZQot
ICAgIGNvbXAubWFpbC5pbWFwCi0gICAgY29tcC5tYWlsLnNlbmRtYWlsIGFmdGVyIDguMTAgY29t
ZXMgb3V0Ci0gICAgCi0gICAgd3d3LmZyZXNobWVhdC5uZXQKLQotc2FtcGxlIGFubm91bmNlbWVu
dDoKLQotVG86IGN5cnVzLXNhc2xAbGlzdHMuYW5kcmV3LmNtdS5lZHUsIGluZm8tY3lydXNAYW5k
cmV3LmNtdS5lZHUKLVN1YmplY3Q6IEJldGEgcmVsZWFzZSBvZiBDeXJ1cyBTQVNMIDEuNS4xOAot
QkNDOiB0bWFydGluK3NlbnRAY3lydXMuYW5kcmV3LmNtdS5lZHUKLS0tdGV4dCBmb2xsb3dzIHRo
aXMgbGluZS0tCi0KLUknZCBsaWtlIHRvIGFubm91bmNlIHRoZSBiZXRhIHJlbGVhc2Ugb2YgQ3ly
dXMgU0FTTCAxLjUuMTggb24KLWZ0cC5hbmRyZXcuY211LmVkdS4gVGhpcyB2ZXJzaW9uIGluY2x1
ZGVzIGJ1ZyBmaXhlcywgYSBqYXZhIFNBU0wKLWxpYnJhcnkgdGhhdCBjb25mb3JtcyB0byBkcmFm
dC13ZWx0bWFuLWphdmEtc2FzbC0wMi50eHQsIGFuZCBtYW4gcGFnZXMKLWZvciBhbGwgZnVuY3Rp
b25zLiBUaGlzIGlzIGEgYmV0YSByZWxlYXNlIGJlY2F1c2UgaXQgaGFzIG5vdCBiZWVuCi10aG9y
b3VnaGx5IHRlc3RlZCBhZ2FpbnN0IGFsbCBhcHBsaWNhdGlvbnMgdGhhdCBtYWtlIHVzZSBvZiBp
dC4KLQotUGxlYXNlIHNlbmQgYW55IGZlZWRiYWNrIGVpdGhlciB0byBjeXJ1cy1zYXNsQGxpc3Rz
LmFuZHJldy5jbXUuZWR1Ci0ocHVibGljIGxpc3QpIG9yIHRvIGN5cnVzLWJ1Z3NAYW5kcmV3LmNt
dS5lZHUuCi0KLURvd25sb2FkIGF0OgotZnRwOi8vZnRwLmFuZHJldy5jbXUuZWR1L3B1Yi9jeXJ1
cy1tYWlsL0JFVEEvY3lydXMtc2FzbC0xLjUuMTgudGFyLmd6Ci0KLVRoYW5rcywKLVRpbSBNYXJ0
aW4KLQotCi1UbzogcG9zdCtjb21wLm1haWwuaW1hcEBhbmRyZXcuY211LmVkdQotU3ViamVjdDog
Q3lydXMgU0FTTCAxLjUuMTggcmVsZWFzZWQgKGF1dGhlbnRpY2F0aW9uIGxpYnJhcnkpCi1CQ0M6
IHRtYXJ0aW4rc2VudEBjeXJ1cy5hbmRyZXcuY211LmVkdQotLS10ZXh0IGZvbGxvd3MgdGhpcyBs
aW5lLS0KLQotSSdtIHBsZWFzZWQgdG8gYW5ub3VuY2UgdGhlIHJlbGVhc2Ugb2YgdGhlIEN5cnVz
IFNBU0wgbGlicmFyeSwgdmVyc2lvbgotMS41LjE4LiAgVGhpcyByZXByZXNlbnRzIHByaW1hcmls
eSBhIGJ1Z2ZpeCByZWxlYXNlIHdpdGggYSBmZXcgbmV3Ci1mZWF0dXJlcywgc3VjaCBhcyBhIGph
dmEgU0FTTCBsaWJyYXJ5IGNvbmZvcm1pbmcgdG8KLWRyYWZ0LXdlbHRtYW4tamF2YS1zYXNsLTAy
LnR4dCwgYW5kIG1hbiBwYWdlcyBmb3IgYWxsIGZ1bmN0aW9ucy4KLSAgCi1UaGUgQ3lydXMgU0FT
TCBsaWJyYXJ5IGlzIGEgZ2VuZXJpYyBsaWJyYXJ5IGZvciBTQVNMIGF1dGhlbnRpY2F0aW9uLAot
YXMgdXNlZCBpbiBTTVRQIGFuZCBJTUFQIHByb3RvY29scy4gIEl0J3MgdXNlZCBmb3IgYXV0aGVu
dGljYXRpb24gYnkKLXRoZSBDeXJ1cyBJTUFQIHNlcnZlciBhcyB3ZWxsIGFzIHRoZSBTZW5kbWFp
bCA4LjEwIHJlbGVhc2UuCi0gIAotTWFrZSBzdXJlIHlvdSByZWFkIHRoZSBSRUFETUUgZmlsZS4K
LQotRG93bmxvYWQgYXQ6Ci1mdHA6Ly9mdHAuYW5kcmV3LmNtdS5lZHUvcHViL2N5cnVzLW1haWwv
QkVUQS9jeXJ1cy1zYXNsLTEuNS4xOC50YXIuZ3oKLQotICAKLVBsZWFzZSByZXBvcnQgYnVncyB0
byBjeXJ1cy1idWdzQGFuZHJldy5jbXUuZWR1LgotICAKLUpvaW4gdGhlIGN5cnVzLXNhc2xAbGlz
dHMuYW5kcmV3LmNtdS5lZHUgbWFpbGluZyBsaXN0IGJ5Ci1jeXJ1cy1zYXNsLXJlcXVlc3RAbGlz
dHMuYW5kcmV3LmNtdS5lZHUKLSAgCi1UaGFua3MsCi1UaW0gTWFydGluCi0KLQotWC1NYWlsZXI6
IEJhdElNYWlsIHZlcnNpb24gMy4yCi1UbzogcG9zdCtjb21wLm1haWwuc2VuZG1haWxAYW5kcmV3
LmNtdS5lZHUKLVN1YmplY3Q6IEN5cnVzIFNBU0wgMS41LjE4IHJlbGVhc2VkIChhdXRoZW50aWNh
dGlvbiBsaWJyYXJ5KQotQkNDOiB0bWFydGluK3NlbnRAY3lydXMuYW5kcmV3LmNtdS5lZHUKLU1p
bWUtVmVyc2lvbjogMS4wIChnZW5lcmF0ZWQgYnkgdG0tZWRpdCA3LjEwOCkKLUNvbnRlbnQtVHlw
ZTogdGV4dC9wbGFpbjsgY2hhcnNldD1VUy1BU0NJSQotLS10ZXh0IGZvbGxvd3MgdGhpcyBsaW5l
LS0KLQotSSdtIHBsZWFzZWQgdG8gYW5ub3VuY2UgdGhlIHJlbGVhc2Ugb2YgdGhlIEN5cnVzIFNB
U0wgbGlicmFyeSwgdmVyc2lvbgotMS41LjE4LiAgVGhpcyByZXByZXNlbnRzIHByaW1hcmlseSBh
IGJ1Z2ZpeCByZWxlYXNlIHdpdGggYSBmZXcgbmV3Ci1mZWF0dXJlcywgc3VjaCBhcyBhIGphdmEg
U0FTTCBsaWJyYXJ5IGNvbmZvcm1pbmcgdG8KLWRyYWZ0LXdlbHRtYW4tamF2YS1zYXNsLTAyLnR4
dCwgYW5kIG1hbiBwYWdlcyBmb3IgYWxsIGZ1bmN0aW9ucy4gIAotICAKLVRoZSBDeXJ1cyBTQVNM
IGxpYnJhcnkgaXMgYSBnZW5lcmljIGxpYnJhcnkgZm9yIFNBU0wKLWF1dGhlbnRpY2F0aW9uLiBJ
dCdzIHVzZWQgZm9yIGF1dGhlbnRpY2F0aW9uIGJ5IHRoZSBTZW5kbWFpbCA4LjEwCi1yZWxlYXNl
IGFzIHdlbGwgYXMgdGhlIEN5cnVzIElNQVAgc2VydmVyLgotICAKLU1ha2Ugc3VyZSB5b3UgcmVh
ZCB0aGUgUkVBRE1FIGZpbGUgaWYgeW91IGFyZSB1cGdyYWRpbmcuCi0KLVBsZWFzZSByZXBvcnQg
YnVncyB0byBjeXJ1cy1idWdzQGFuZHJldy5jbXUuZWR1LgotICAKLUpvaW4gdGhlIGN5cnVzLXNh
c2xAbGlzdHMuYW5kcmV3LmNtdS5lZHUgbWFpbGluZyBsaXN0IGJ5Ci1jeXJ1cy1zYXNsLXJlcXVl
c3RAbGlzdHMuYW5kcmV3LmNtdS5lZHUKLQotRG93bmxvYWQgYXQ6Ci1mdHA6Ly9mdHAuYW5kcmV3
LmNtdS5lZHUvcHViL2N5cnVzLW1haWwvQkVUQS9jeXJ1cy1zYXNsLTEuNS4xOC50YXIuZ3oKLSAg
Ci0gIAotVGhhbmtzLAotVGltIE1hcnRpbgpcIE5vIG5ld2xpbmUgYXQgZW5kIG9mIGZpbGUKK1Ro
aXMgaXMgYSBjb2xsZWN0aW9uIG9mIGF1dG9jb25mIG1hY3JvcyB3aGljaCd2ZSBiZWVuIHdyaXR0
ZW4gYnkKK3ZhcmlvdXMgcGVvcGxlIGF0IENNVS4gIFRvIHVzZSBpdCwgdXNlICJhY2xvY2FsIC1J
IGNtdWxvY2FsIiAoYWZ0ZXIKK3RoZSBmaXJzdCB0aW1lLCBhdXRvbWFrZSBzaG91bGQgYXV0b21h
dGljYWxseSB1c2UgdGhlIC1JIGNtdWxvY2FsLCBpZgoreW91J3ZlIGNhbGxlZCBDTVVfSU5JVF9B
VVRPTUFLRSBpbiBjb25maWd1cmUuaW4pLgorCitDTVVfSU5JVF9BVVRPTUFLRQorICBJZiB5b3Ug
dXNlIGF1dG9tYWtlLCB5b3Ugc2hvdWxkIGNhbGwgdGhpcyBhZnRlciBBTV9JTklUX0FVVE9NQUtF
LgorICBJdCBhZGRzICItSSBjbXVsb2NhbCIgdG8gdGhlIGFjbG9jYWwgY29tbWFuZCBsaW5lLCBz
byB0aGF0IHdoZW4KKyAgYXV0b21ha2UgcnVucyBhY2xvY2FsLCBhY2xvY2FsJ2xsIGNvbnRpbnVl
IHRvIHBpY2sgdXAgdGhlc2UgbWFjcm9zLgorCitDTVVfQUREX0xJQlBBVEgKKyAgQWRkIC1MKGFy
ZyksIGFuZCBwb3NzaWJseSAtUihhcmcpIChvciB3aGF0ZXZlciB0aGUgcnVucGF0aCBpcykgdG8g
CisgIExERkxBR1MuCisKK0NNVV9BRERfTElCUEFUSF9UTworICBMaWtld2lzZSB0byBhYm92ZSwg
ZXhjZXB0IGFkZHMgaXQgdG8gdGhlIHNwZWNpZmllZCB2YXJpYWJsZSAoYXJnIDIpLgorCitDTVVf
R1VFU1NfUlVOUEFUSF9TV0lUQ0gKKyAgQXR0ZW1wdHMgdG8gZ3Vlc3Mgd2hhdCB0aGUgcnVucGF0
aCBzd2l0Y2ggaXMgKC1SIG9yIHdoYXRldmVyKS4KKworQ01VX0NPTUVSUgorICBSZXF1aXJlcyB0
aGF0IGNvbV9lcnIgZXhpc3QgaW4gdGhlIGNvbGxlY3Rpb24gKGF0IENNVSwgZG8gdGhpcyBieQor
ICBydW5uaW5nICJjdnMgY2hlY2tvdXQgY29tX2VyciIsIGFuZCBhZGRpbmcgY29tX2VyciB0byBE
SVNUX1NVQkRJUlMKKyAgaW4geW91ciBNYWtlZmlsZS5hbSkuCisKKyAgSXQgc2V0cyB0aGUgb3V0
cHV0IHZhcmlhYmxlIENPTVBJTEVfRVQgdG8gdGhlIGNvbXBpbGVfZXQgcHJvZ3JhbSB0bworICB1
c2UsIGFuZCBhZGRzIHRoZSBhcHByb3ByaWF0ZSBwYXRocyB0byBMREZMQUdTIGFuZCBDUFBGTEFH
Uy4KKworICBJdCBkb2VzICpub3QqIGFkZCAtbGNvbV9lcnIgdG8gTElCUyAodGhpcyB3b3VsZCBj
YXVzZSBsYXRlciBsaWJyYXJ5CisgIGNoZWNrcyB0byBmYWlsIGlmIGNvbV9lcnIgbmVlZHMgdG8g
YmUgYnVpbHQpLCBzbyBNYWtlZmlsZXMgbmVlZCB0bworICBleHBsaWNpdGx5IGFkZCAtbGNvbV9l
cnIgKHdoaWNoLCBhZnRlciBhbGwsIHNob3VsZCBhbHdheXMgZXhpc3QgYXMKKyAgbG9uZyBhcyB0
aGUgY29tX2VyciBjb21waWxlIGRvZXNuJ3QgYmxvdyB1cCkuICBNYWtlZmlsZXMgc2hvdWxkIGRv
CisgIHRoaXMgYnkgdXNpbmcgTElCX0NPTUVSUiwgd2hpY2ggd2lsbCBzdWJzdGl0dXRlIHRvIHRo
ZSBhcHByb3ByaWF0ZQorICBtYWdpYyB0byB1c2UgdG8gZ3JhYiB0aGUgbGlicmFyeS4gIChUaGlz
IG1heSBpbnZvbHZlIGEgbGlidG9vbCBhcmNoaXZlOworICB5b3Ugc2hvdWxkIGJlIHVzaW5nIGxp
YnRvb2wgdG8gbGluayB5b3VyIHByb2dyYW0gaWYgeW91IGRpc3RyaWJ1dGUKKyAgbGlicmFyaWVz
IHdpdGggaXQgdGhhdCB0aGUgcHJvZ3JhbSBtYXkgbGluayBhZ2FpbnN0KS4KKworICBOb3RlIHRo
YXQgY29tX2VyciB3aWxsIG9ubHkgYmUgY29tcGlsZWQgaWYgdGhlIGNvbmZpZ3VyZSBzY3JpcHQK
KyAgY2FuJ3QgZmluZCBjb21waWxlX2V0IG9yIGxpYmNvbV9lcnI7IGlmIHRoZSBzeXN0ZW0gYWxy
ZWFkeSBoYXMgdGhlbSwKKyAgdGhlIGNvbmZpZ3VyZSBzY3JpcHQgd2lsbCB1c2UgdGhlIHN5c3Rl
bSBpbnN0YWxsYXRpb24gKGFsdGhvdWdoLCBkdWUKKyAgdG8gc29tZSBhdXRvY29uZiB3b25raW5l
c3MsIGNvbV9lcnIgd2lsbCBzdGlsbCBiZSBjb25maWd1cmVkOyBpdCBqdXN0CisgIHdvbid0IHNo
b3cgdXAgaW4gdGhlIEBzdWJkaXJzQCBleHBhbnNpb24pLgorCitDTVVfTkFOQQorICBBZGRzIC0t
d2l0aC1uYW5hLCBzZXQgYnkgZGVmYXVsdDsgaWYgc2V0LCBhdHRlbXB0cyB0byBsaW5rIGFnYWlu
c3QKKyAgbGlibmFuYS4gIElmIG5vdCBzZXQsIG9yIGlmIGxpYm5hbmEgaXMgdW5hdmFpbGFibGUs
IG9yIGlmIHdlJ3JlIG5vdAorICB1c2luZyBnY2MsIGl0IGRlZmluZXMgV0lUSE9VVF9OQU5BLgor
CitDTVVfUFJPR19MSUJUT09MCisgIEp1c3QgbGlrZSBBTV9QUk9HX0xJQlRPT0wsIGV4Y2VwdCBp
dCBwZXJmb3JtcyBhIGNvdXBsZSBsaXR0bGUgaGFja3MKKyAgdG8gbWFrZSBzdXJlIHRoYXQgdGhp
bmdzIGRvbid0IGJyZWFrIG9uIHBpY2t5IHZlbmRvciBjb21waWxlcnMKKyAgd2hpY2ggd2hpbmUg
YWJvdXQgZW1wdHkgdHJhbnNsYXRpb24gdW5pdHMuCisKK0NNVV9QVEhSRUFEUworICBUaGlzIGF0
dGVtcHRzIHRvIGxpbmsgYWdhaW5zdCBsaWJwdGhyZWFkIChmYWlsaW5nIGlmIGl0IGNhbid0IGJl
IGZvdW5kKSwKKyAgYW5kIGF0dGVtcHRzIHRvIGRvIGFueSBzeXN0ZW0tc3BlY2lmaWMgc2V0dXAg
cmVxdWlyZWQgZm9yIHRocmVhZAorICBzdXBwb3J0IChmb3IgZXhhbXBsZSwgbW9zdCB0aGluZ3Mg
d2FudCBfUkVFTlRSQU5UIHRvIGJlIGRlZmluZWQsCisgIGJ1dCBTb2xhcmlzIHdhbnRzIF9QT1NJ
WF9QVEhSRUFEX1NFTUFOVElDUyBhbmQgX19FWFRFTlNJT05TX18sIElSSVgKKyAgd2FudHMgdG8g
c2VlIF9TR0lfUkVFTlRSQU5UX0ZVTkNUSU9OUywgZXRjKS4KKworQ01VX1NBU0wKKyAgVGhpcyB0
cmllcyB0byBmaW5kIGEgU0FTTCBsaWJyYXJ5LCBhbmQgY2FsbHMgQUNfU1VCU1Qgb24gTElCX1NB
U0wKKyAgaWYgaXQgZmluZHMgb25lLCBvciB0ZWxscyB0aGUgdXNlciB0byBnbyBmdHAgaXQgaWYg
aXQgZG9lc24ndCBleGlzdC4KKworICBQcm92aWRlcyAtLXdpdGgtc2FzbGRpci4KKworQ01VX0tS
QjQKKyAgVGhpcyBhdHRlbXB0cyB0byBmaW5kIEtlcmJlcm9zIDQgbGlicmFyaWVzIGFuZCBzZXQg
dXAgQ0ZMQUdTIGFuZCBMSUJTCisgIGFwcHJvcHJpYXRlbHkuIEl0IGFsc28gdXBkYXRlcyBhbmQg
c3Vic3RpdHV0ZXMgUlBBVEggZm9yIHNoYXJlZCBsaWJyYXJ5IAorICBzdHVmZi4KKwpJbmRleDog
YWNjb25maWcuaAo9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09ClJDUyBmaWxlOiAvYWZzL2FuZHJldy9zeXN0ZW0vY3ZzL3Ny
Yy9zYXNsL2FjY29uZmlnLmgsdgpyZXRyaWV2aW5nIHJldmlzaW9uIDEuMjUKZGlmZiAtdSAtcjEu
MjUgYWNjb25maWcuaAotLS0gYWNjb25maWcuaAkyMDAxLzAxLzA0IDIxOjIwOjQ1CTEuMjUKKysr
IGFjY29uZmlnLmgJMjAwMS8wNC8yNSAwMDozMzoyNwpAQCAtNjEsNiArNjEsMTYgQEAKICN1bmRl
ZiBTQVNMX05EQk0KICN1bmRlZiBTQVNMX0JFUktFTEVZREIKIAorLyogU0FTTCBtZWNoYW5pc21z
ICovCisjdW5kZWYgTUVDSF9FTkFCTEVEX0FOT05ZTU9VUworI3VuZGVmIE1FQ0hfRU5BQkxFRF9D
UkFNX01ENQorI3VuZGVmIE1FQ0hfRU5BQkxFRF9ESUdFU1RfTUQ1CisjdW5kZWYgTUVDSF9FTkFC
TEVEX0tFUkJFUk9TX1Y0CisjdW5kZWYgTUVDSF9FTkFCTEVEX0dTU0FQSQorI3VuZGVmIE1FQ0hf
RU5BQkxFRF9QTEFJTgorI3VuZGVmIE1FQ0hfRU5BQkxFRF9MT0dJTgorI3VuZGVmIE1FQ0hfRU5B
QkxFRF9TUlAKKwogLyogVGhpcyBpcyB3aGVyZSBwbHVnaW5zIHdpbGwgbGl2ZSBhdCBydW50aW1l
ICovCiAjdW5kZWYgUExVR0lORElSCiAKSW5kZXg6IGNvbmZpZ3VyZS5pbgo9PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09ClJD
UyBmaWxlOiAvYWZzL2FuZHJldy9zeXN0ZW0vY3ZzL3NyYy9zYXNsL2NvbmZpZ3VyZS5pbix2CnJl
dHJpZXZpbmcgcmV2aXNpb24gMS4xMDUKZGlmZiAtdSAtcjEuMTA1IGNvbmZpZ3VyZS5pbgotLS0g
Y29uZmlndXJlLmluCTIwMDEvMDMvMjQgMDE6NDc6MjcJMS4xMDUKKysrIGNvbmZpZ3VyZS5pbgky
MDAxLzA0LzI1IDAwOjMzOjI3CkBAIC0yMjAsMjMgKzIyMCwyOCBAQAogY2FzZSAiJGRibGliIiBp
bgogICBnZGJtKSAKICAgICBTQVNMX0RCX0JBQ0tFTkQ9ImRiXyR7ZGJsaWJ9LmxvIgorICAgIFNB
U0xfREJfQkFDS0VORF9TVEFUSUM9ImRiXyR7ZGJsaWJ9Lm8iCiAgICAgQUNfREVGSU5FKFNBU0xf
R0RCTSkKICAgICA7OwogICBuZGJtKQogICAgIFNBU0xfREJfQkFDS0VORD0iZGJfJHtkYmxpYn0u
bG8iCisgICAgU0FTTF9EQl9CQUNLRU5EX1NUQVRJQz0iZGJfJHtkYmxpYn0ubyIKICAgICBBQ19E
RUZJTkUoU0FTTF9OREJNKQogICAgIDs7CiAgIGJlcmtlbGV5KQogICAgIFNBU0xfREJfQkFDS0VO
RD0iZGJfJHtkYmxpYn0ubG8iCisgICAgU0FTTF9EQl9CQUNLRU5EX1NUQVRJQz0iZGJfJHtkYmxp
Yn0ubyIKICAgICBBQ19ERUZJTkUoU0FTTF9CRVJLRUxFWURCKQogICAgIDs7CiAgICopCiAgICAg
QUNfTVNHX1dBUk4oW0Rpc2FibGluZyBTQVNMIGF1dGhlbnRpY2F0aW9uIGRhdGFiYXNlIHN1cHBv
cnRdKQogICAgIFNBU0xfREJfQkFDS0VORD0iZGJfbm9uZS5sbyIKKyAgICBTQVNMX0RCX0JBQ0tF
TkRfU1RBVElDPSJkYl9ub25lLm8iCiAgICAgU0FTTF9EQl9MSUI9IiIKICAgICA7OwogZXNhYwog
QUNfU1VCU1QoU0FTTF9EQl9CQUNLRU5EKQorQUNfU1VCU1QoU0FTTF9EQl9CQUNLRU5EX1NUQVRJ
QykKIEFDX1NVQlNUKFNBU0xfREJfTElCKQogCiBBQ19DSEVDS19MSUIoZGwsIGRsb3BlbiwgU0FT
TF9ETF9MSUI9Ii1sZGwiLCBTQVNMX0RMX0xJQj0iIikKQEAgLTMzMSw2ICszMzYsOSBAQAogaWYg
dGVzdCAiJGNyYW0iICE9IG5vOyB0aGVuCiAgIEFDX01TR19SRVNVTFQoZW5hYmxlZCkKICAgU0FT
TF9NRUNIUz0iJFNBU0xfTUVDSFMgbGliY3JhbW1kNS5sYSIKKyAgU0FTTF9TVEFUSUNfTUVDSFM9
IiRTQVNMX1NUQVRJQ19NRUNIUyBsaWJjcmFtbWQ1LmEiCisgIFNBU0xfU1RBVElDX09CSlM9IiRT
QVNMX1NUQVRJQ19PQkpTIC4uL3BsdWdpbnMvY3JhbS5vIgorICBBQ19ERUZJTkUoTUVDSF9FTkFC
TEVEX0NSQU1fTUQ1KQogZWxzZQogICBBQ19NU0dfUkVTVUxUKGRpc2FibGVkKQogZmkKQEAgLTM0
NSw2ICszNTMsOCBAQAogaWYgdGVzdCAiJHNjcmFtIiAhPSBubzsgdGhlbgogICBBQ19NU0dfUkVT
VUxUKGVuYWJsZWQpCiAgIFNBU0xfTUVDSFM9IiRTQVNMX01FQ0hTIGxpYnNjcmFtbWQ1LmxhIgor
ICBTQVNMX1NUQVRJQ19NRUNIUz0iJFNBU0xfU1RBVElDX01FQ0hTIGxpYnNjcmFtbWQ1LmEiCisg
IFNBU0xfU1RBVElDX09CSlM9IiRTQVNMX1NUQVRJQ19PQkpTIC4uL3BsdWdpbnMvc2NyYW0ubyIK
IGVsc2UKICAgQUNfTVNHX1JFU1VMVChkaXNhYmxlZCkKIGZpCkBAIC00MTAsNiArNDIwLDkgQEAK
IGlmIHRlc3QgIiRkaWdlc3QiICE9IG5vOyB0aGVuCiAgIEFDX01TR19SRVNVTFQoZW5hYmxlZCkK
ICAgU0FTTF9NRUNIUz0iJFNBU0xfTUVDSFMgbGliZGlnZXN0bWQ1LmxhIgorICBTQVNMX1NUQVRJ
Q19NRUNIUz0iJFNBU0xfU1RBVElDX01FQ0hTIGxpYmRpZ2VzdG1kNS5hIgorICBTQVNMX1NUQVRJ
Q19PQkpTPSIkU0FTTF9TVEFUSUNfT0JKUyAuLi9wbHVnaW5zL2RpZ2VzdG1kNS5vIgorICBBQ19E
RUZJTkUoTUVDSF9FTkFCTEVEX0RJR0VTVF9NRDUpCiBlbHNlCiAgIEFDX01TR19SRVNVTFQoZGlz
YWJsZWQpCiBmaQpAQCAtNDYyLDYgKzQ3NSw5IEBACiBpZiB0ZXN0ICIka3JiNCIgIT0gbm87IHRo
ZW4KICAgQUNfTVNHX1JFU1VMVChlbmFibGVkKQogICBTQVNMX01FQ0hTPSIkU0FTTF9NRUNIUyBs
aWJrZXJiZXJvczQubGEiCisgIFNBU0xfU1RBVElDX01FQ0hTPSIkU0FTTF9TVEFUSUNfTUVDSFMg
bGlia2VyYmVyb3M0LmEiCisgIFNBU0xfU1RBVElDX09CSlM9IiRTQVNMX1NUQVRJQ19PQkpTIC4u
L3BsdWdpbnMva2VyYmVyb3M0Lm8iCisgIEFDX0RFRklORShNRUNIX0VOQUJMRURfS0VSQkVST1Nf
VjQpCiAgIEFDX0RFRklORShIQVZFX0tSQikKICAgU0FTTF9LUkJfTElCPSItbGtyYiAtbGRlcyAk
Q09NX0VSUiIKICAgQUNfU1VCU1QoU0FTTF9LUkJfTElCKQpAQCAtNTMxLDYgKzU0Nyw5IEBACiAg
IEFDX0NIRUNLX0xJQihuZGJtLGRibV9vcGVuLEdTU0FQSUJBU0VfTElCUz0iJEdTU0FQSUJBU0Vf
TElCUyAtbG5kYm0iKQogICBBQ19DSEVDS19MSUIocmVzb2x2LHJlc19zZWFyY2gsR1NTQVBJQkFT
RV9MSUJTPSIkR1NTQVBJQkFTRV9MSUJTIC1scmVzb2x2IikKICAgU0FTTF9NRUNIUz0iJFNBU0xf
TUVDSFMgbGliZ3NzYXBpdjIubGEiCisgIFNBU0xfU1RBVElDX01FQ0hTPSIkU0FTTF9TVEFUSUNf
TUVDSFMgbGliZ3NzYXBpdjIuYSIKKyAgU0FTTF9TVEFUSUNfT0JKUz0iJFNBU0xfU1RBVElDX09C
SlMgLi4vcGx1Z2lucy9nc3NhcGkubyIKKyAgQUNfREVGSU5FKE1FQ0hfRU5BQkxFRF9HU1NBUEkp
CiAKICAgY211X3NhdmVfTElCUz0iJExJQlMiCiAgIExJQlM9IiRMSUJTICRHU1NBUElCQVNFX0xJ
QlMiCkBAIC01NTEsNiArNTcwLDkgQEAKIGlmIHRlc3QgIiRhbm9uIiAhPSBubzsgdGhlbgogICBB
Q19NU0dfUkVTVUxUKGVuYWJsZWQpCiAgIFNBU0xfTUVDSFM9IiRTQVNMX01FQ0hTIGxpYmFub255
bW91cy5sYSIKKyAgU0FTTF9TVEFUSUNfTUVDSFM9IiRTQVNMX1NUQVRJQ19NRUNIUyBsaWJhbm9u
eW1vdXMuYSIKKyAgU0FTTF9TVEFUSUNfT0JKUz0iJFNBU0xfU1RBVElDX09CSlMgLi4vcGx1Z2lu
cy9hbm9ueW1vdXMubyIKKyAgQUNfREVGSU5FKE1FQ0hfRU5BQkxFRF9BTk9OWU1PVVMpCiBlbHNl
CiAgIEFDX01TR19SRVNVTFQoZGlzYWJsZWQpCiBmaQpAQCAtNTgzLDYgKzYwNSw5IEBACiBpZiB0
ZXN0ICIkcGxhaW4iICE9IG5vOyB0aGVuCiAgIEFDX01TR19SRVNVTFQoZW5hYmxlZCkKICAgU0FT
TF9NRUNIUz0iJFNBU0xfTUVDSFMgbGlicGxhaW4ubGEiCisgIFNBU0xfU1RBVElDX01FQ0hTPSIk
U0FTTF9TVEFUSUNfTUVDSFMgbGlicGxhaW4uYSIKKyAgU0FTTF9TVEFUSUNfT0JKUz0iJFNBU0xf
U1RBVElDX09CSlMgLi4vcGx1Z2lucy9wbGFpbi5vIgorICBBQ19ERUZJTkUoTUVDSF9FTkFCTEVE
X1BMQUlOKQogZWxzZQogICBBQ19NU0dfUkVTVUxUKGRpc2FibGVkKQogZmkKQEAgLTU5Niw2ICs2
MjEsOSBAQAogaWYgdGVzdCAiJGxvZ2luIiAhPSBubzsgdGhlbgogICBBQ19NU0dfUkVTVUxUKGVu
YWJsZWQpCiAgIFNBU0xfTUVDSFM9IiRTQVNMX01FQ0hTIGxpYmxvZ2luLmxhIgorICBTQVNMX1NU
QVRJQ19NRUNIUz0iJFNBU0xfU1RBVElDX01FQ0hTIGxpYmxvZ2luLmEiCisgIFNBU0xfU1RBVElD
X09CSlM9IiRTQVNMX1NUQVRJQ19PQkpTIC4uL3BsdWdpbnMvbG9naW4ubyIKKyAgQUNfREVGSU5F
KE1FQ0hfRU5BQkxFRF9MT0dJTikKIGVsc2UKICAgQUNfTVNHX1JFU1VMVChkaXNhYmxlZCkKIGZp
CkBAIC02MDMsMjAgKzYzMSwyNSBAQAogZG5sIFNSUAogQUNfQVJHX0VOQUJMRShzcnAsIFsgIC0t
ZW5hYmxlLXNycCAgICAgICAgICAgZW5hYmxlIFNSUCBhdXRoZW50aWNhdGlvbiBbbm9dIF0sCiAg
IHNycD0kZW5hYmxldmFsLAotICBzcnA9bm8pCisgIHNycD15ZXMpCiAKIEFDX01TR19DSEVDS0lO
RyhTUlApCiBpZiB0ZXN0ICIkc3JwIiAhPSBubzsgdGhlbgotICBBQ19FUlJPUihbVGhpcyBpcyBw
cmUtYWxwaGEuIFlvdSBwcm9iYWJseSBkb24ndCB3YW50IHRvIHVzZSB0aGlzXSkKKyMgIEFDX0VS
Uk9SKFtUaGlzIGlzIHByZS1hbHBoYS4gWW91IHByb2JhYmx5IGRvbid0IHdhbnQgdG8gdXNlIHRo
aXNdKQogICBBQ19NU0dfUkVTVUxUKGVuYWJsZWQpCiAgIFNSUF9MSUJTPSItbGdtcCAtbGNyeXB0
byIKICAgQUNfU1VCU1QoU1JQX0xJQlMpCiAgIFNBU0xfTUVDSFM9IiRTQVNMX01FQ0hTIGxpYnNy
cC5sYSIKKyAgU0FTTF9TVEFUSUNfTUVDSFM9IiRTQVNMX1NUQVRJQ19NRUNIUyBsaWJzcnAuYSIK
KyAgU0FTTF9TVEFUSUNfT0JKUz0iJFNBU0xfU1RBVElDX09CSlMgLi4vcGx1Z2lucy9zcnAubyIK
KyAgQUNfREVGSU5FKE1FQ0hfRU5BQkxFRF9TUlApCiBlbHNlCiAgIEFDX01TR19SRVNVTFQoZGlz
YWJsZWQpCiBmaQogCiBBQ19TVUJTVChTQVNMX01FQ0hTKQorQUNfU1VCU1QoU0FTTF9TVEFUSUNf
TUVDSFMpCitBQ19TVUJTVChTQVNMX1NUQVRJQ19PQkpTKQogCiAKIEFDX0FSR19XSVRIKHBsdWdp
bmRpciwgWyAgLS13aXRoLXBsdWdpbmRpcj1ESVIgICAgc2V0IHRoZSBkaXJlY3Rvcnkgd2hlcmUg
cGx1Z2lucyB3aWxsCkBAIC02ODgsOCArNzIxLDggQEAKIAogQUNfT1VUUFVUKE1ha2VmaWxlCiBp
bmNsdWRlL01ha2VmaWxlCi1saWIvTWFrZWZpbGUKIHBsdWdpbnMvTWFrZWZpbGUKK2xpYi9NYWtl
ZmlsZQogdXRpbHMvTWFrZWZpbGUKIGRvYy9NYWtlZmlsZQogc2FtcGxlL01ha2VmaWxlCkluZGV4
OiBsaWIvTWFrZWZpbGUuYW0KPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PQpSQ1MgZmlsZTogL2Fmcy9hbmRyZXcvc3lzdGVt
L2N2cy9zcmMvc2FzbC9saWIvTWFrZWZpbGUuYW0sdgpyZXRyaWV2aW5nIHJldmlzaW9uIDEuNDEK
ZGlmZiAtdSAtcjEuNDEgTWFrZWZpbGUuYW0KLS0tIE1ha2VmaWxlLmFtCTIwMDEvMDMvMjkgMjE6
NTg6NDkJMS40MQorKysgTWFrZWZpbGUuYW0JMjAwMS8wNC8yNSAwMDozMzoyNwpAQCAtNDcsNiAr
NDcsNyBAQAogCiBFWFRSQV9ESVNUID0gc2FzbGludC5oIHdpbmRsb3Blbi5jCiAKKyNzaGFyZWQg
dmVyc2lvbgogbGliX0xUTElCUkFSSUVTID0gbGlic2FzbC5sYQogCiBsaWJzYXNsX2xhX1NPVVJD
RVMgPSBjb21tb24uYyBzYXNsdXRpbC5jIHNlcnZlci5jIGNsaWVudC5jIG1kNS5jIGRsb3Blbi5j
IGNoZWNrcHcuYyBjb25maWcuYwpAQCAtNTUsNCArNTYsMTMgQEAKIGxpYnNhc2xfbGFfREVQRU5E
RU5DSUVTID0gJChTQVNMX0RCX0JBQ0tFTkQpIEBMVExJQk9CSlNACiBsaWJzYXNsX2xhX0xJQkFE
RCA9IEBMVExJQk9CSlNAICQoU0FTTF9EQl9CQUNLRU5EKSAkKFNBU0xfREJfTElCKSAkKFNBU0xf
RExfTElCKSAkKFBMQUlOX0xJQlMpICQoTElCX1NPQ0tFVCkKICMgUExBSU5fTElCUyBhcmUgbGlu
a2VkIGluIGZvciBzYXNsX2NoZWNrcGFzcworCisjc3RhdGljIHZlcnNpb24KK2xpYl9MSUJSQVJJ
RVMgPSBsaWJzYXNsLmEKKworbGlic2FzbF9hX1NPVVJDRVMgPSBjb21tb24uYyBzYXNsdXRpbC5j
IHNlcnZlci5jIGNsaWVudC5jIG1kNS5jIHN0YXRpY29wZW4uYyBjaGVja3B3LmMgY29uZmlnLmMK
K0VYVFJBX2xpYnNhc2xfYV9TT1VSQ0VTID0gZGJfbm9uZS5jIGRiX25kYm0uYyBkYl9nZGJtLmMg
ZGJfYmVya2VsZXkuYyBkYl90ZXN0dzMyLmMKK2xpYnNhc2xfYV9ERVBFTkRFTkNJRVMgPSAkKFNB
U0xfREJfQkFDS0VORF9TVEFUSUMpCisKK2xpYnNhc2xfYV9MSUJBREQgPSBAU0FTTF9TVEFUSUNf
T0JKU0AgJChTQVNMX0RCX0JBQ0tFTkRfU1RBVElDKQogCkluZGV4OiBsaWIvZGxvcGVuLmMKPT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PQpSQ1MgZmlsZTogL2Fmcy9hbmRyZXcvc3lzdGVtL2N2cy9zcmMvc2FzbC9saWIvZGxv
cGVuLmMsdgpyZXRyaWV2aW5nIHJldmlzaW9uIDEuMzIKZGlmZiAtdSAtcjEuMzIgZGxvcGVuLmMK
LS0tIGRsb3Blbi5jCTIwMDAvMDgvMTQgMDE6NDQ6MDIJMS4zMgorKysgZGxvcGVuLmMJMjAwMS8w
NC8yNSAwMDozMzoyNwpAQCAtMTUwLDYgKzE1MCw3IEBACiAvKiBsb2FkcyBhIHNpbmdsZSBtZWNo
YW5pc20gKi8KIGludCBfc2FzbF9nZXRfcGx1Z2luKGNvbnN0IGNoYXIgKmZpbGUsCiAJCSAgICAg
Y29uc3QgY2hhciAqZW50cnluYW1lLAorCQkgICAgIGNvbnN0IGNoYXIgKmFsdGVudHJ5bmFtZSwK
IAkJICAgICBjb25zdCBzYXNsX2NhbGxiYWNrX3QgKnZlcmlmeWZpbGVfY2IsCiAJCSAgICAgdm9p
ZCAqKmVudHJ5cG9pbnRwdHIsCiAJCSAgICAgdm9pZCAqKmxpYnJhcnlwdHIpCkBAIC0xNjAsOCAr
MTYxLDEwIEBACiAgICAgdm9pZCAqZW50cnlfcG9pbnQ7CiAjaWYgX19PcGVuQlNEX18KICAgICBj
aGFyIGFkal9lbnRyeW5hbWVbMTAyNF07CisgICAgY2hhciBhZGpfYWx0ZW50cnluYW1lWzEwMjRd
OwogI2Vsc2UKICNkZWZpbmUgYWRqX2VudHJ5bmFtZSBlbnRyeW5hbWUKKyNkZWZpbmUgYWRqX2Fs
dGVudHJ5bmFtZSBhbHRlbnRyeW5hbWUKICNlbmRpZgogCiAgICAgciA9ICgoc2FzbF92ZXJpZnlm
aWxlX3QgKikodmVyaWZ5ZmlsZV9jYi0+cHJvYykpCkBAIC0xODEsMTAgKzE4NCwxOSBAQAogCiAj
aWYgX19PcGVuQlNEX18KICAgICBzbnByaW50ZihhZGpfZW50cnluYW1lLCBzaXplb2YgYWRqX2Vu
dHJ5bmFtZSwgIl8lcyIsIGVudHJ5bmFtZSk7CisgICAgc25wcmludGYoYWRqX2FsdGVudHJ5bmFt
ZSwgc2l6ZW9mIGFkal9hbHRlbnRyeW5hbWUsICJfJXMiLCBhbHRlbnRyeW5hbWUpOwogI2VuZGlm
CiAKKyAgICAvKiBmaXJzdCB0aGUgc3RhbmRhcmQgZW50cnkgcG9pbnQgKi8KICAgICBlbnRyeV9w
b2ludCA9IE5VTEw7CiAgICAgZW50cnlfcG9pbnQgPSBkbHN5bShsaWJyYXJ5LCBhZGpfZW50cnlu
YW1lKTsKKworICAgIC8qIGlmIHRoYXQgZmFpbHMgYW5kIHdlIGhhdmUgYW4gYWx0ZXJuYXRlIHBv
aW50IHRyeSB0aGF0ICovCisgICAgaWYgKChlbnRyeV9wb2ludCA9PSBOVUxMKSAmJiAoYWRqX2Fs
dGVudHJ5bmFtZSkpIHsKKwllbnRyeV9wb2ludCA9IE5VTEw7CisJZW50cnlfcG9pbnQgPSBkbHN5
bShsaWJyYXJ5LCBhZGpfYWx0ZW50cnluYW1lKTsKKyAgICB9CisKICAgICBpZiAoZW50cnlfcG9p
bnQgPT0gTlVMTCkgewogCV9zYXNsX2xvZyhOVUxMLCBTQVNMX0xPR19FUlIsIE5VTEwsIDAsIDAs
CiAJCSAgInVuYWJsZSB0byBnZXQgZW50cnkgcG9pbnQgJXMgaW4gJXM6ICVzIiwgYWRqX2VudHJ5
bmFtZSwKQEAgLTI1Niw2ICsyNjgsOCBAQAogCQl2b2lkICpsaWJyYXJ5OwogCQl2b2lkICplbnRy
eV9wb2ludDsKIAkJY2hhciBuYW1lW1BBVEhfTUFYXTsKKwkJY2hhciBhbHRlbnRyeXBvaW50WzEw
MjRdOworCQljaGFyICpkb3Q7CiAKIAkJbGVuZ3RoID0gTkFNTEVOKGRpcik7CiAJCWlmIChsZW5n
dGggPCA0KSAKQEAgLTI3MCw4ICsyODQsMTkgQEAKIAkKIAkJc3RyY3B5KHRtcCxwcmVmaXgpOwog
CQlzdHJjYXQodG1wLG5hbWUpOwotCQotCQlyZXN1bHQgPSBfc2FzbF9nZXRfcGx1Z2luKHRtcCwg
ZW50cnluYW1lLAorCisJCS8qIGNyZWF0ZSB0aGUgYWx0ZXJuYXRlIGVudHJ5IHBvaW50ICovCisJ
CXN0cm5jcHkoYWx0ZW50cnlwb2ludCxuYW1lKzMsIHNpemVvZihhbHRlbnRyeXBvaW50KS0xKTsK
KwkJZG90ID0gc3RyY2hyKGFsdGVudHJ5cG9pbnQsJy4nKTsKKwkJaWYgKGRvdCkgKmRvdCA9ICdc
MCc7CisJCXN0cmNhdChhbHRlbnRyeXBvaW50LCJfIik7CisJCXN0cmNhdChhbHRlbnRyeXBvaW50
LGVudHJ5bmFtZSk7CQkKKworCQkvKiBMb29rIGZvciB0d28gZW50cnkgcG9pbnRzOgorCQkgKiBz
YXNsXyhzZXJ2ZXJ8Y2xpZW50KV9wbHVnX2luaXQKKwkJICogPG1lY2g+X3Nhc2xfKHNlcnZlcnxj
bGllbnQpX3BsdWdfaW5pdAorCQkgKi8KKwkJcmVzdWx0ID0gX3Nhc2xfZ2V0X3BsdWdpbih0bXAs
IGVudHJ5bmFtZSwgYWx0ZW50cnlwb2ludCwKIAkJCQkJICB2ZXJpZnlmaWxlX2NiLAogCQkJCQkg
ICZlbnRyeV9wb2ludCwgJmxpYnJhcnkpOwogCkluZGV4OiBsaWIvbWQ1LmMKPT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQpS
Q1MgZmlsZTogL2Fmcy9hbmRyZXcvc3lzdGVtL2N2cy9zcmMvc2FzbC9saWIvbWQ1LmMsdgpyZXRy
aWV2aW5nIHJldmlzaW9uIDEuNwpkaWZmIC11IC1yMS43IG1kNS5jCi0tLSBtZDUuYwkxOTk5LzAz
LzI5IDIxOjI2OjE0CTEuNworKysgbWQ1LmMJMjAwMS8wNC8yNSAwMDozMzoyOApAQCAtMTUzLDgg
KzE1Myw3IEBACiAKIC8qIE1ENSBmaW5hbGl6YXRpb24uIEVuZHMgYW4gTUQ1IG1lc3NhZ2UtZGln
ZXN0IG9wZXJhdGlvbiwgd3JpdGluZyB0aGUKICAgICAgICB0aGUgbWVzc2FnZSBkaWdlc3QgYW5k
IHplcm9pemluZyB0aGUgY29udGV4dC4gCi0KLSAgICAgICAgKi8KKyovCiAKIHZvaWQgTUQ1Rmlu
YWwgKGRpZ2VzdCwgY29udGV4dCkKIHVuc2lnbmVkIGNoYXIgZGlnZXN0WzE2XTsgLyogbWVzc2Fn
ZSBkaWdlc3QgKi8KQEAgLTE4Miw3ICsxODEsNyBAQAogICAgICAgICAgLyogWmVyb2l6ZSBzZW5z
aXRpdmUgaW5mb3JtYXRpb24uCiAKICovCi0gICAgICAgTUQ1X21lbXNldCAoKFBPSU5URVIpY29u
dGV4dCwgMCwgc2l6ZW9mICgqY29udGV4dCkpOyAKKwkgTUQ1X21lbXNldCAoKFBPSU5URVIpY29u
dGV4dCwgMCwgc2l6ZW9mICgqY29udGV4dCkpOwogfQogCiAvKiBNRDUgYmFzaWMgdHJhbnNmb3Jt
YXRpb24uIFRyYW5zZm9ybXMgc3RhdGUgYmFzZWQgb24gYmxvY2suCkluZGV4OiBsaWIvc2FzbGlu
dC5oCj09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT0KUkNTIGZpbGU6IC9hZnMvYW5kcmV3L3N5c3RlbS9jdnMvc3JjL3Nhc2wv
bGliL3Nhc2xpbnQuaCx2CnJldHJpZXZpbmcgcmV2aXNpb24gMS4zMwpkaWZmIC11IC1yMS4zMyBz
YXNsaW50LmgKLS0tIHNhc2xpbnQuaAkyMDAwLzA4LzE3IDIyOjE0OjI1CTEuMzMKKysrIHNhc2xp
bnQuaAkyMDAxLzA0LzI1IDAwOjMzOjI4CkBAIC01Nyw2ICs1Nyw3IEBACiAJCQkgICAgICAgaW50
ICgqYWRkX3BsdWdpbikodm9pZCAqLHZvaWQgKikpOwogZXh0ZXJuIGludCBfc2FzbF9nZXRfcGx1
Z2luKGNvbnN0IGNoYXIgKmZpbGUsCiAJCQkgICAgY29uc3QgY2hhciAqZW50cnluYW1lLAorCQkJ
ICAgIGNvbnN0IGNoYXIgKmFsdGVudHJ5bmFtZSwKIAkJCSAgICBjb25zdCBzYXNsX2NhbGxiYWNr
X3QgKnZlcmlmeWZpbGVfY2FsbGJhY2ssCiAJCQkgICAgdm9pZCAqKmVudHJ5cG9pbnQsCiAJCQkg
ICAgdm9pZCAqKmxpYnJhcnkpOwpAQCAtMjExLDUgKzIxMiwzNCBAQAogCQkJCSBjb25zdCBjaGFy
ICp1c2VyX3JlYWxtLAogCQkJCSBpbnQgZmxhZ3MsCiAJCQkJIGNvbnN0IGNoYXIgKiplcnJzdHIp
OworCisjZGVmaW5lIENMSUVOVF9QTFVHX0RFRiggeCApIGludCB4ICMjIF9zYXNsX2NsaWVudF9w
bHVnX2luaXQoc2FzbF91dGlsc190ICp1dGlscywgaW50IG1heHZlcnNpb24sIGludCAqb3V0X3Zl
cnNpb24sIGNvbnN0IHNhc2xfY2xpZW50X3BsdWdfdCAqKnBsdWdsaXN0LCBpbnQgKnBsdWdjb3Vu
dCk7CisKKyNkZWZpbmUgU0VSVkVSX1BMVUdfREVGKCB4ICkgaW50IHggIyMgX3Nhc2xfc2VydmVy
X3BsdWdfaW5pdChzYXNsX3V0aWxzX3QgKnV0aWxzLCBpbnQgbWF4dmVyc2lvbiwgaW50ICpvdXRf
dmVyc2lvbiwgY29uc3Qgc2FzbF9zZXJ2ZXJfcGx1Z190ICoqcGx1Z2xpc3QsIGludCAqcGx1Z2Nv
dW50KTsKKworCitleHRlcm4gQ0xJRU5UX1BMVUdfREVGKGNyYW1tZDUpCitleHRlcm4gU0VSVkVS
X1BMVUdfREVGKGNyYW1tZDUpCisKK2V4dGVybiBDTElFTlRfUExVR19ERUYoZGlnZXN0bWQ1KQor
ZXh0ZXJuIFNFUlZFUl9QTFVHX0RFRihkaWdlc3RtZDUpCisKK2V4dGVybiBDTElFTlRfUExVR19E
RUYoYW5vbnltb3VzKQorZXh0ZXJuIFNFUlZFUl9QTFVHX0RFRihhbm9ueW1vdXMpCisKK2V4dGVy
biBDTElFTlRfUExVR19ERUYoa2VyYmVyb3M0KQorZXh0ZXJuIFNFUlZFUl9QTFVHX0RFRihrZXJi
ZXJvczQpCisKK2V4dGVybiBDTElFTlRfUExVR19ERUYoZ3NzYXBpdjIpCitleHRlcm4gU0VSVkVS
X1BMVUdfREVGKGdzc2FwaXYyKQorCitleHRlcm4gQ0xJRU5UX1BMVUdfREVGKHBsYWluKQorZXh0
ZXJuIFNFUlZFUl9QTFVHX0RFRihwbGFpbikKKworZXh0ZXJuIENMSUVOVF9QTFVHX0RFRihsb2dp
bikKK2V4dGVybiBTRVJWRVJfUExVR19ERUYobG9naW4pCisKK2V4dGVybiBDTElFTlRfUExVR19E
RUYoc3JwKQorZXh0ZXJuIFNFUlZFUl9QTFVHX0RFRihzcnApCiAKICNlbmRpZiAvKiBTQVNMSU5U
X0ggKi8KSW5kZXg6IGxpYi9zZXJ2ZXIuYwo9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09ClJDUyBmaWxlOiAvYWZzL2FuZHJl
dy9zeXN0ZW0vY3ZzL3NyYy9zYXNsL2xpYi9zZXJ2ZXIuYyx2CnJldHJpZXZpbmcgcmV2aXNpb24g
MS44NApkaWZmIC11IC1yMS44NCBzZXJ2ZXIuYwotLS0gc2VydmVyLmMJMjAwMS8wMi8wNiAyMDo1
NDoyOAkxLjg0CisrKyBzZXJ2ZXIuYwkyMDAxLzA0LzI1IDAwOjMzOjI4CkBAIC0xMDg2LDcgKzEw
ODYsNyBAQAogCWludCBsID0gMDsKIAogCS8qIG5lZWQgdG8gbG9hZCB0aGlzIHBsdWdpbiAqLwot
CXJlc3VsdCA9IF9zYXNsX2dldF9wbHVnaW4obS0+dS5mLCAic2FzbF9zZXJ2ZXJfcGx1Z19pbml0
IiwKKwlyZXN1bHQgPSBfc2FzbF9nZXRfcGx1Z2luKG0tPnUuZiwgInNhc2xfc2VydmVyX3BsdWdf
aW5pdCIsIE5VTEwsCiAJCSAgICBfc2FzbF9maW5kX3ZlcmlmeWZpbGVfY2FsbGJhY2soZ2xvYmFs
X2NhbGxiYWNrcy5jYWxsYmFja3MpLAogCQkJCSAgKHZvaWQgKiopICZlbnRyeV9wb2ludCwgJmxp
YnJhcnkpOwogCWlmIChyZXN1bHQgPT0gU0FTTF9PSykgewpJbmRleDogbGliL3dpbmRsb3Blbi5j
Cj09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT0KUkNTIGZpbGU6IC9hZnMvYW5kcmV3L3N5c3RlbS9jdnMvc3JjL3Nhc2wvbGli
L3dpbmRsb3Blbi5jLHYKcmV0cmlldmluZyByZXZpc2lvbiAxLjEwCmRpZmYgLXUgLXIxLjEwIHdp
bmRsb3Blbi5jCi0tLSB3aW5kbG9wZW4uYwkyMDAwLzA4LzEzIDIzOjIxOjU1CTEuMTAKKysrIHdp
bmRsb3Blbi5jCTIwMDEvMDQvMjUgMDA6MzM6MjgKQEAgLTQ4LDYgKzQ4LDcgQEAKIAogaW50IF9z
YXNsX2dldF9wbHVnaW4oY29uc3QgY2hhciAqZmlsZSwKIAkJICAgICBjb25zdCBjaGFyICplbnRy
eW5hbWUsCisJCSAgICAgY29uc3QgY2hhciAqYWx0ZW50cnluYW1lLAogCQkgICAgIGNvbnN0IHNh
c2xfY2FsbGJhY2tfdCAqZ2V0cGF0aF9jYWxsYmFjaywKIAkJICAgICBjb25zdCBzYXNsX2NhbGxi
YWNrX3QgKnZlcmlmeWZpbGVfY2FsbGJhY2ssCiAJCSAgICAgdm9pZCAqKmVudHJ5cG9pbnQsCklu
ZGV4OiBwbHVnaW5zL01ha2VmaWxlLmFtCj09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KUkNTIGZpbGU6IC9hZnMvYW5kcmV3
L3N5c3RlbS9jdnMvc3JjL3Nhc2wvcGx1Z2lucy9NYWtlZmlsZS5hbSx2CnJldHJpZXZpbmcgcmV2
aXNpb24gMS4zOQpkaWZmIC11IC1yMS4zOSBNYWtlZmlsZS5hbQotLS0gTWFrZWZpbGUuYW0JMjAw
MS8wMi8xOSAxOTozMDowNAkxLjM5CisrKyBNYWtlZmlsZS5hbQkyMDAxLzA0LzI1IDAwOjMzOjI4
CkBAIC02NiwyNCArNjYsMzcgQEAKIHNhc2xfTFRMSUJSQVJJRVMgPSBAU0FTTF9NRUNIU0AKIEVY
VFJBX0xUTElCUkFSSUVTID0gbGlicGxhaW4ubGEgbGliYW5vbnltb3VzLmxhIGxpYmtlcmJlcm9z
NC5sYSBsaWJjcmFtbWQ1LmxhIGxpYnNjcmFtbWQ1LmxhIGxpYmdzc2FwaXYyLmxhIGxpYmRpZ2Vz
dG1kNS5sYSBsaWJsb2dpbi5sYSBsaWJzcnAubGEKIAorc2FzbF9MSUJSQVJJRVMgPSBAU0FTTF9T
VEFUSUNfTUVDSFNACitFWFRSQV9MSUJSQVJJRVMgPSBsaWJwbGFpbi5hIGxpYmFub255bW91cy5h
IGxpYmtlcmJlcm9zNC5hIGxpYmNyYW1tZDUuYSBsaWJzY3JhbW1kNS5hIGxpYmdzc2FwaXYyLmEg
bGliZGlnZXN0bWQ1LmEgbGlibG9naW4uYSBsaWJzcnAuYQorCiBsaWJwbGFpbl9sYV9TT1VSQ0VT
ID0gcGxhaW4uYwogbGlicGxhaW5fbGFfTERGTEFHUyA9IC12ZXJzaW9uLWluZm8gJChwbGFpbl92
ZXJzaW9uKQogbGlicGxhaW5fbGFfTElCQUREID0gJChQTEFJTl9MSUJTKQogCitsaWJwbGFpbl9h
X1NPVVJDRVMgPSBwbGFpbi5jCisKIGxpYmFub255bW91c19sYV9TT1VSQ0VTID0gYW5vbnltb3Vz
LmMKIGxpYmFub255bW91c19sYV9MREZMQUdTID0gLXZlcnNpb24taW5mbyAkKGFub255bW91c192
ZXJzaW9uKQogCitsaWJhbm9ueW1vdXNfYV9TT1VSQ0VTID0gYW5vbnltb3VzLmMKKwogbGlia2Vy
YmVyb3M0X2xhX1NPVVJDRVMgPSBrZXJiZXJvczQuYwogbGlia2VyYmVyb3M0X2xhX0xERkxBR1Mg
PSAtdmVyc2lvbi1pbmZvICQoa2VyYmVyb3M0X3ZlcnNpb24pCiBsaWJrZXJiZXJvczRfbGFfTElC
QUREID0gJChTQVNMX0tSQl9MSUIpICQoTElCX1NPQ0tFVCkKIAorbGlia2VyYmVyb3M0X2FfU09V
UkNFUyA9IGtlcmJlcm9zNC5jCisKIGxpYmdzc2FwaXYyX2xhX1NPVVJDRVMgPSBnc3NhcGkuYwog
bGliZ3NzYXBpdjJfbGFfTERGTEFHUyA9IC12ZXJzaW9uLWluZm8gJChnc3NhcGl2Ml92ZXJzaW9u
KQogbGliZ3NzYXBpdjJfbGFfTElCQUREID0gJChHU1NBUElCQVNFX0xJQlMpICQoR1NTQVBJX0xJ
QlMpICQoTElCX1NPQ0tFVCkKIAorbGliZ3NzYXBpdjJfYV9TT1VSQ0VTID0gZ3NzYXBpLmMKKwog
bGliY3JhbW1kNV9sYV9TT1VSQ0VTID0gY3JhbS5jCiBsaWJjcmFtbWQ1X2xhX0xERkxBR1MgPSAt
dmVyc2lvbi1pbmZvICQoY3JhbW1kNV92ZXJzaW9uKQogCitsaWJjcmFtbWQ1X2FfU09VUkNFUyA9
IGNyYW0uYworCiBsaWJzY3JhbW1kNV9sYV9TT1VSQ0VTID0gc2NyYW0uYwogbGlic2NyYW1tZDVf
bGFfTERGTEFHUyA9IC12ZXJzaW9uLWluZm8gJChzY3JhbW1kNV92ZXJzaW9uKQogCkBAIC05MSwx
MyArMTA0LDE5IEBACiBsaWJkaWdlc3RtZDVfbGFfTERGTEFHUyA9IC12ZXJzaW9uLWluZm8gJChk
aWdlc3RtZDVfdmVyc2lvbikKIGxpYmRpZ2VzdG1kNV9sYV9MSUJBREQgPSAkKExJQl9ERVMpICQo
TElCX1NPQ0tFVCkKIAorbGliZGlnZXN0bWQ1X2FfU09VUkNFUyA9IGRpZ2VzdG1kNS5jCisKIGxp
YmxvZ2luX2xhX1NPVVJDRVMgPSBsb2dpbi5jCiBsaWJsb2dpbl9sYV9MREZMQUdTID0gLXZlcnNp
b24taW5mbyAkKGxvZ2luX3ZlcnNpb24pCiBsaWJsb2dpbl9sYV9MSUJBREQgPSAkKFBMQUlOX0xJ
QlMpCiAKK2xpYmxvZ2luX2FfU09VUkNFUyA9IGxvZ2luLmMKKwogbGlic3JwX2xhX1NPVVJDRVMg
PSBzcnAuYwogbGlic3JwX2xhX0xERkxBR1MgPSAtdmVyc2lvbi1pbmZvICQoc3JwX3ZlcnNpb24p
CiBsaWJzcnBfbGFfTElCQUREID0gJChTUlBfTElCUykKKworbGlic3JwX2FfU09VUkNFUyA9IHNy
cC5jCiAKICMgbGlieDUwOV9sYV9TT1VSQ0VTID0geDUwOS5jCiAjIGxpYng1MDlfbGFfTERGTEFH
UyA9IC12ZXJzaW9uLWluZm8gJCh4NTA5X3ZlcnNpb24pCkluZGV4OiBwbHVnaW5zL2Fub255bW91
cy5jCj09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT0KUkNTIGZpbGU6IC9hZnMvYW5kcmV3L3N5c3RlbS9jdnMvc3JjL3Nhc2wv
cGx1Z2lucy9hbm9ueW1vdXMuYyx2CnJldHJpZXZpbmcgcmV2aXNpb24gMS4zNApkaWZmIC11IC1y
MS4zNCBhbm9ueW1vdXMuYwotLS0gYW5vbnltb3VzLmMJMjAwMS8wMi8xOSAxOTowMTo1NAkxLjM0
CisrKyBhbm9ueW1vdXMuYwkyMDAxLzA0LzI1IDAwOjMzOjI4CkBAIC0xOTksMTEgKzE5OSwxMSBA
QAogICB9CiB9OwogCi1pbnQgc2FzbF9zZXJ2ZXJfcGx1Z19pbml0KHNhc2xfdXRpbHNfdCAqdXRp
bHMgX19hdHRyaWJ1dGVfXygodW51c2VkKSksCi0JCQkgIGludCBtYXh2ZXJzaW9uLAotCQkJICBp
bnQgKm91dF92ZXJzaW9uLAotCQkJICBjb25zdCBzYXNsX3NlcnZlcl9wbHVnX3QgKipwbHVnbGlz
dCwKLQkJCSAgaW50ICpwbHVnY291bnQpCitpbnQgYW5vbnltb3VzX3Nhc2xfc2VydmVyX3BsdWdf
aW5pdChzYXNsX3V0aWxzX3QgKnV0aWxzIF9fYXR0cmlidXRlX18oKHVudXNlZCkpLAorCQkJCSAg
ICBpbnQgbWF4dmVyc2lvbiwKKwkJCQkgICAgaW50ICpvdXRfdmVyc2lvbiwKKwkJCQkgICAgY29u
c3Qgc2FzbF9zZXJ2ZXJfcGx1Z190ICoqcGx1Z2xpc3QsCisJCQkJICAgIGludCAqcGx1Z2NvdW50
KQogewogICBpZiAobWF4dmVyc2lvbjxBTk9OWU1PVVNfVkVSU0lPTikKICAgICByZXR1cm4gU0FT
TF9CQURWRVJTOwpAQCAtNDEyLDExICs0MTIsMTEgQEAKICAgfQogfTsKIAotaW50IHNhc2xfY2xp
ZW50X3BsdWdfaW5pdChzYXNsX3V0aWxzX3QgKnV0aWxzIF9fYXR0cmlidXRlX18oKHVudXNlZCkp
LAotCQkJICBpbnQgbWF4dmVyc2lvbiwKLQkJCSAgaW50ICpvdXRfdmVyc2lvbiwKLQkJCSAgY29u
c3Qgc2FzbF9jbGllbnRfcGx1Z190ICoqcGx1Z2xpc3QsCi0JCQkgIGludCAqcGx1Z2NvdW50KQor
aW50IGFub255bW91c19zYXNsX2NsaWVudF9wbHVnX2luaXQoc2FzbF91dGlsc190ICp1dGlscyBf
X2F0dHJpYnV0ZV9fKCh1bnVzZWQpKSwKKwkJCQkgICAgaW50IG1heHZlcnNpb24sCisJCQkJICAg
IGludCAqb3V0X3ZlcnNpb24sCisJCQkJICAgIGNvbnN0IHNhc2xfY2xpZW50X3BsdWdfdCAqKnBs
dWdsaXN0LAorCQkJCSAgICBpbnQgKnBsdWdjb3VudCkKIHsKICAgaWYgKG1heHZlcnNpb24gPCBB
Tk9OWU1PVVNfVkVSU0lPTikKICAgICByZXR1cm4gU0FTTF9CQURWRVJTOwpJbmRleDogcGx1Z2lu
cy9jcmFtLmMKPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PQpSQ1MgZmlsZTogL2Fmcy9hbmRyZXcvc3lzdGVtL2N2cy9zcmMv
c2FzbC9wbHVnaW5zL2NyYW0uYyx2CnJldHJpZXZpbmcgcmV2aXNpb24gMS41NQpkaWZmIC11IC1y
MS41NSBjcmFtLmMKLS0tIGNyYW0uYwkyMDAxLzAyLzE5IDE5OjAxOjU0CTEuNTUKKysrIGNyYW0u
YwkyMDAxLzA0LzI1IDAwOjMzOjI5CkBAIC03OTYsMTEgKzc5NiwxMSBAQAogICB9CiB9OwogCi1p
bnQgc2FzbF9zZXJ2ZXJfcGx1Z19pbml0KHNhc2xfdXRpbHNfdCAqdXRpbHMsCi0JCQkgIGludCBt
YXh2ZXJzaW9uLAotCQkJICBpbnQgKm91dF92ZXJzaW9uLAotCQkJICBjb25zdCBzYXNsX3NlcnZl
cl9wbHVnX3QgKipwbHVnbGlzdCwKLQkJCSAgaW50ICpwbHVnY291bnQpCitpbnQgY3JhbW1kNV9z
YXNsX3NlcnZlcl9wbHVnX2luaXQoc2FzbF91dGlsc190ICp1dGlscywKKwkJCQkgIGludCBtYXh2
ZXJzaW9uLAorCQkJCSAgaW50ICpvdXRfdmVyc2lvbiwKKwkJCQkgIGNvbnN0IHNhc2xfc2VydmVy
X3BsdWdfdCAqKnBsdWdsaXN0LAorCQkJCSAgaW50ICpwbHVnY291bnQpCiB7CiAgIGlmIChtYXh2
ZXJzaW9uPENSQU1fTUQ1X1ZFUlNJT04pCiAgICAgcmV0dXJuIFNBU0xfQkFEVkVSUzsKQEAgLTEy
MjUsMTEgKzEyMjUsMTEgQEAKICAgfQogfTsKIAotaW50IHNhc2xfY2xpZW50X3BsdWdfaW5pdChz
YXNsX3V0aWxzX3QgKnV0aWxzIF9fYXR0cmlidXRlX18oKHVudXNlZCkpLAotCQkJICBpbnQgbWF4
dmVyc2lvbiwKLQkJCSAgaW50ICpvdXRfdmVyc2lvbiwKLQkJCSAgY29uc3Qgc2FzbF9jbGllbnRf
cGx1Z190ICoqcGx1Z2xpc3QsCi0JCQkgIGludCAqcGx1Z2NvdW50KQoraW50IGNyYW1tZDVfc2Fz
bF9jbGllbnRfcGx1Z19pbml0KHNhc2xfdXRpbHNfdCAqdXRpbHMgX19hdHRyaWJ1dGVfXygodW51
c2VkKSksCisJCQkJICBpbnQgbWF4dmVyc2lvbiwKKwkJCQkgIGludCAqb3V0X3ZlcnNpb24sCisJ
CQkJICBjb25zdCBzYXNsX2NsaWVudF9wbHVnX3QgKipwbHVnbGlzdCwKKwkJCQkgIGludCAqcGx1
Z2NvdW50KQogewogICBpZiAobWF4dmVyc2lvbjxDUkFNX01ENV9WRVJTSU9OKQogICAgIHJldHVy
biBTQVNMX0JBRFZFUlM7CkluZGV4OiBwbHVnaW5zL2RpZ2VzdG1kNS5jCj09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KUkNT
IGZpbGU6IC9hZnMvYW5kcmV3L3N5c3RlbS9jdnMvc3JjL3Nhc2wvcGx1Z2lucy9kaWdlc3RtZDUu
Yyx2CnJldHJpZXZpbmcgcmV2aXNpb24gMS45NwpkaWZmIC11IC1yMS45NyBkaWdlc3RtZDUuYwot
LS0gZGlnZXN0bWQ1LmMJMjAwMS8wMy8yMiAyMToyNjoyMQkxLjk3CisrKyBkaWdlc3RtZDUuYwky
MDAxLzA0LzI1IDAwOjMzOjMwCkBAIC0yOTMzLDExICsyOTMzLDExIEBACiAgIH0KIH07CiAKLWlu
dCBzYXNsX3NlcnZlcl9wbHVnX2luaXQoc2FzbF91dGlsc190ICogdXRpbHMgX19hdHRyaWJ1dGVf
XygodW51c2VkKSksCi0JCQkgIGludCBtYXh2ZXJzaW9uIF9fYXR0cmlidXRlX18oKHVudXNlZCkp
LAotCQkJICBpbnQgKm91dF92ZXJzaW9uLAotCQkJICBjb25zdCBzYXNsX3NlcnZlcl9wbHVnX3Qg
KiogcGx1Z2xpc3QsCi0JCQkgIGludCAqcGx1Z2NvdW50KSAKK2ludCBkaWdlc3RtZDVfc2FzbF9z
ZXJ2ZXJfcGx1Z19pbml0KHNhc2xfdXRpbHNfdCAqIHV0aWxzIF9fYXR0cmlidXRlX18oKHVudXNl
ZCkpLAorCQkJCSAgICBpbnQgbWF4dmVyc2lvbiBfX2F0dHJpYnV0ZV9fKCh1bnVzZWQpKSwKKwkJ
CQkgICAgaW50ICpvdXRfdmVyc2lvbiwKKwkJCQkgICAgY29uc3Qgc2FzbF9zZXJ2ZXJfcGx1Z190
ICoqIHBsdWdsaXN0LAorCQkJCSAgICBpbnQgKnBsdWdjb3VudCkgCiB7CiAgIC8qICBpZiAobWF4
dmVyc2lvbiA8IERJR0VTVE1ENV9WRVJTSU9OKQogICAgICAgcmV0dXJuIFNBU0xfQkFEVkVSUzsq
LwpAQCAtNDEzNCwxMSArNDEzNCwxMSBAQAogICB9CiB9OwogCi1pbnQgICAgICAgICAgICAgc2Fz
bF9jbGllbnRfcGx1Z19pbml0KHNhc2xfdXRpbHNfdCAqIHV0aWxzIF9fYXR0cmlidXRlX18oKHVu
dXNlZCkpLAotCQkJCSAgICAgIGludCBtYXh2ZXJzaW9uLAotCQkJCSAgICAgIGludCAqb3V0X3Zl
cnNpb24sCi0JCQkJICAgICAgY29uc3Qgc2FzbF9jbGllbnRfcGx1Z190ICoqIHBsdWdsaXN0LAot
CQkJCSAgICAgIGludCAqcGx1Z2NvdW50KSB7CitpbnQgZGlnZXN0bWQ1X3Nhc2xfY2xpZW50X3Bs
dWdfaW5pdChzYXNsX3V0aWxzX3QgKiB1dGlscyBfX2F0dHJpYnV0ZV9fKCh1bnVzZWQpKSwKKwkJ
CQkgICAgaW50IG1heHZlcnNpb24sCisJCQkJICAgIGludCAqb3V0X3ZlcnNpb24sCisJCQkJICAg
IGNvbnN0IHNhc2xfY2xpZW50X3BsdWdfdCAqKiBwbHVnbGlzdCwKKwkJCQkgICAgaW50ICpwbHVn
Y291bnQpIHsKICAgaWYgKG1heHZlcnNpb24gPCBESUdFU1RfTUQ1X1ZFUlNJT04pCiAgICAgcmV0
dXJuIFNBU0xfQkFEVkVSUzsKIApJbmRleDogcGx1Z2lucy9nc3NhcGkuYwo9PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09ClJD
UyBmaWxlOiAvYWZzL2FuZHJldy9zeXN0ZW0vY3ZzL3NyYy9zYXNsL3BsdWdpbnMvZ3NzYXBpLmMs
dgpyZXRyaWV2aW5nIHJldmlzaW9uIDEuNDEKZGlmZiAtdSAtcjEuNDEgZ3NzYXBpLmMKLS0tIGdz
c2FwaS5jCTIwMDEvMDIvMTkgMTk6MDE6NTQJMS40MQorKysgZ3NzYXBpLmMJMjAwMS8wNC8yNSAw
MDozMzozMQpAQCAtODc5LDExICs4NzksMTEgQEAKIH07CiAKIGludCAKLXNhc2xfc2VydmVyX3Bs
dWdfaW5pdChzYXNsX3V0aWxzX3QgKnV0aWxzIF9fYXR0cmlidXRlX18oKHVudXNlZCkpLCAKLQkJ
ICAgICAgaW50IG1heHZlcnNpb24sCi0JCSAgICAgIGludCAqb3V0X3ZlcnNpb24sCi0JCSAgICAg
IGNvbnN0IHNhc2xfc2VydmVyX3BsdWdfdCAqKnBsdWdsaXN0LAotCQkgICAgICBpbnQgKnBsdWdj
b3VudCkKK2dzc2FwaXYyX3Nhc2xfc2VydmVyX3BsdWdfaW5pdChzYXNsX3V0aWxzX3QgKnV0aWxz
IF9fYXR0cmlidXRlX18oKHVudXNlZCkpLCAKKwkJCSAgICAgICBpbnQgbWF4dmVyc2lvbiwKKwkJ
CSAgICAgICBpbnQgKm91dF92ZXJzaW9uLAorCQkJICAgICAgIGNvbnN0IHNhc2xfc2VydmVyX3Bs
dWdfdCAqKnBsdWdsaXN0LAorCQkJICAgICAgIGludCAqcGx1Z2NvdW50KQogewogI2lmZGVmIEhB
VkVfR1NTS1JCNV9SRUdJU1RFUl9BQ0NFUFRPUl9JREVOVElUWQogICAgIGNvbnN0IGNoYXIgKmtl
eXRhYjsKQEAgLTE0MDksMTEgKzE0MDksMTEgQEAKIH07CiAKIGludCAKLXNhc2xfY2xpZW50X3Bs
dWdfaW5pdChzYXNsX3V0aWxzX3QgKnV0aWxzIF9fYXR0cmlidXRlX18oKHVudXNlZCkpLCAKLQkJ
ICAgICAgaW50IG1heHZlcnNpb24sCi0JCSAgICAgIGludCAqb3V0X3ZlcnNpb24sIAotCQkgICAg
ICBjb25zdCBzYXNsX2NsaWVudF9wbHVnX3QgKipwbHVnbGlzdCwKLQkJICAgICAgaW50ICpwbHVn
Y291bnQpCitnc3NhcGl2Ml9zYXNsX2NsaWVudF9wbHVnX2luaXQoc2FzbF91dGlsc190ICp1dGls
cyBfX2F0dHJpYnV0ZV9fKCh1bnVzZWQpKSwgCisJCQkgICAgICAgaW50IG1heHZlcnNpb24sCisJ
CQkgICAgICAgaW50ICpvdXRfdmVyc2lvbiwgCisJCQkgICAgICAgY29uc3Qgc2FzbF9jbGllbnRf
cGx1Z190ICoqcGx1Z2xpc3QsCisJCQkgICAgICAgaW50ICpwbHVnY291bnQpCiB7CiAgIGlmICht
YXh2ZXJzaW9uPEdTU0FQSV9WRVJTSU9OKQogICAgIHJldHVybiBTQVNMX0JBRFZFUlM7CkluZGV4
OiBwbHVnaW5zL2tlcmJlcm9zNC5jCj09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KUkNTIGZpbGU6IC9hZnMvYW5kcmV3L3N5
c3RlbS9jdnMvc3JjL3Nhc2wvcGx1Z2lucy9rZXJiZXJvczQuYyx2CnJldHJpZXZpbmcgcmV2aXNp
b24gMS42NQpkaWZmIC11IC1yMS42NSBrZXJiZXJvczQuYwotLS0ga2VyYmVyb3M0LmMJMjAwMS8w
Mi8xOSAxOTowMTo1NAkxLjY1CisrKyBrZXJiZXJvczQuYwkyMDAxLzA0LzI1IDAwOjMzOjMxCkBA
IC04NTAsMTEgKzg1MCwxMSBAQAogICB9CiB9OwogCi1pbnQgc2FzbF9zZXJ2ZXJfcGx1Z19pbml0
KHNhc2xfdXRpbHNfdCAqdXRpbHMsCi0JCQkgIGludCBtYXh2ZXJzaW9uLAotCQkJICBpbnQgKm91
dF92ZXJzaW9uLAotCQkJICBjb25zdCBzYXNsX3NlcnZlcl9wbHVnX3QgKipwbHVnbGlzdCwKLQkJ
CSAgaW50ICpwbHVnY291bnQpCitpbnQga2VyYmVyb3M0X3Nhc2xfc2VydmVyX3BsdWdfaW5pdChz
YXNsX3V0aWxzX3QgKnV0aWxzLAorCQkJCSAgICBpbnQgbWF4dmVyc2lvbiwKKwkJCQkgICAgaW50
ICpvdXRfdmVyc2lvbiwKKwkJCQkgICAgY29uc3Qgc2FzbF9zZXJ2ZXJfcGx1Z190ICoqcGx1Z2xp
c3QsCisJCQkJICAgIGludCAqcGx1Z2NvdW50KQogewogICAgIGNvbnN0IGNoYXIgKnJldDsKICAg
ICB1bnNpZ25lZCBpbnQgcmw7CkBAIC0xMzIzLDExICsxMzIzLDExIEBACiAgIH0KIH07CiAKLWlu
dCBzYXNsX2NsaWVudF9wbHVnX2luaXQoc2FzbF91dGlsc190ICp1dGlscyBfX2F0dHJpYnV0ZV9f
KCh1bnVzZWQpKSwKLQkJCSAgaW50IG1heHZlcnNpb24sCi0JCQkgIGludCAqb3V0X3ZlcnNpb24s
Ci0JCQkgIGNvbnN0IHNhc2xfY2xpZW50X3BsdWdfdCAqKnBsdWdsaXN0LAotCQkJICBpbnQgKnBs
dWdjb3VudCkKK2ludCBrZXJiZXJvczRfc2FzbF9jbGllbnRfcGx1Z19pbml0KHNhc2xfdXRpbHNf
dCAqdXRpbHMgX19hdHRyaWJ1dGVfXygodW51c2VkKSksCisJCQkJICAgIGludCBtYXh2ZXJzaW9u
LAorCQkJCSAgICBpbnQgKm91dF92ZXJzaW9uLAorCQkJCSAgICBjb25zdCBzYXNsX2NsaWVudF9w
bHVnX3QgKipwbHVnbGlzdCwKKwkJCQkgICAgaW50ICpwbHVnY291bnQpCiB7CiAgIGlmIChtYXh2
ZXJzaW9uPEtFUkJFUk9TX1ZFUlNJT04pCiAgICAgcmV0dXJuIFNBU0xfQkFEVkVSUzsKSW5kZXg6
IHBsdWdpbnMvbG9naW4uYwo9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09ClJDUyBmaWxlOiAvYWZzL2FuZHJldy9zeXN0ZW0v
Y3ZzL3NyYy9zYXNsL3BsdWdpbnMvbG9naW4uYyx2CnJldHJpZXZpbmcgcmV2aXNpb24gMS42CmRp
ZmYgLXUgLXIxLjYgbG9naW4uYwotLS0gbG9naW4uYwkyMDAxLzAyLzE5IDE5OjE1OjEyCTEuNgor
KysgbG9naW4uYwkyMDAxLzA0LzI1IDAwOjMzOjMxCkBAIC0zMjksMTEgKzMyOSwxMSBAQAogICB9
CiB9OwogCi1pbnQgc2FzbF9zZXJ2ZXJfcGx1Z19pbml0KHNhc2xfdXRpbHNfdCAqdXRpbHMgX19h
dHRyaWJ1dGVfXygodW51c2VkKSksCi0JCQkgIGludCBtYXh2ZXJzaW9uLAotCQkJICBpbnQgKm91
dF92ZXJzaW9uLAotCQkJICBjb25zdCBzYXNsX3NlcnZlcl9wbHVnX3QgKipwbHVnbGlzdCwKLQkJ
CSAgaW50ICpwbHVnY291bnQpCitpbnQgbG9naW5fc2FzbF9zZXJ2ZXJfcGx1Z19pbml0KHNhc2xf
dXRpbHNfdCAqdXRpbHMgX19hdHRyaWJ1dGVfXygodW51c2VkKSksCisJCQkJaW50IG1heHZlcnNp
b24sCisJCQkJaW50ICpvdXRfdmVyc2lvbiwKKwkJCQljb25zdCBzYXNsX3NlcnZlcl9wbHVnX3Qg
KipwbHVnbGlzdCwKKwkJCQlpbnQgKnBsdWdjb3VudCkKIHsKICAgaWYgKG1heHZlcnNpb248TE9H
SU5fVkVSU0lPTikKICAgICByZXR1cm4gU0FTTF9CQURWRVJTOwpAQCAtODMyLDExICs4MzIsMTEg
QEAKICAgfQogfTsKIAotaW50IHNhc2xfY2xpZW50X3BsdWdfaW5pdChzYXNsX3V0aWxzX3QgKnV0
aWxzIF9fYXR0cmlidXRlX18oKHVudXNlZCkpLAotCQkJICBpbnQgbWF4dmVyc2lvbiwKLQkJCSAg
aW50ICpvdXRfdmVyc2lvbiwKLQkJCSAgY29uc3Qgc2FzbF9jbGllbnRfcGx1Z190ICoqcGx1Z2xp
c3QsCi0JCQkgIGludCAqcGx1Z2NvdW50KQoraW50IGxvZ2luX3Nhc2xfY2xpZW50X3BsdWdfaW5p
dChzYXNsX3V0aWxzX3QgKnV0aWxzIF9fYXR0cmlidXRlX18oKHVudXNlZCkpLAorCQkJCWludCBt
YXh2ZXJzaW9uLAorCQkJCWludCAqb3V0X3ZlcnNpb24sCisJCQkJY29uc3Qgc2FzbF9jbGllbnRf
cGx1Z190ICoqcGx1Z2xpc3QsCisJCQkJaW50ICpwbHVnY291bnQpCiB7CiAgIGlmIChtYXh2ZXJz
aW9uPExPR0lOX1ZFUlNJT04pCiAgICAgcmV0dXJuIFNBU0xfQkFEVkVSUzsKSW5kZXg6IHBsdWdp
bnMvcGxhaW4uYwo9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09ClJDUyBmaWxlOiAvYWZzL2FuZHJldy9zeXN0ZW0vY3ZzL3Ny
Yy9zYXNsL3BsdWdpbnMvcGxhaW4uYyx2CnJldHJpZXZpbmcgcmV2aXNpb24gMS40MwpkaWZmIC11
IC1yMS40MyBwbGFpbi5jCi0tLSBwbGFpbi5jCTIwMDEvMDIvMTkgMTk6MDE6NTQJMS40MworKysg
cGxhaW4uYwkyMDAxLzA0LzI1IDAwOjMzOjMxCkBAIC0zMjQsMTEgKzMyNCwxMSBAQAogICB9CiB9
OwogCi1pbnQgc2FzbF9zZXJ2ZXJfcGx1Z19pbml0KHNhc2xfdXRpbHNfdCAqdXRpbHMgX19hdHRy
aWJ1dGVfXygodW51c2VkKSksCi0JCQkgIGludCBtYXh2ZXJzaW9uLAotCQkJICBpbnQgKm91dF92
ZXJzaW9uLAotCQkJICBjb25zdCBzYXNsX3NlcnZlcl9wbHVnX3QgKipwbHVnbGlzdCwKLQkJCSAg
aW50ICpwbHVnY291bnQpCitpbnQgcGxhaW5fc2FzbF9zZXJ2ZXJfcGx1Z19pbml0KHNhc2xfdXRp
bHNfdCAqdXRpbHMgX19hdHRyaWJ1dGVfXygodW51c2VkKSksCisJCQkJaW50IG1heHZlcnNpb24s
CisJCQkJaW50ICpvdXRfdmVyc2lvbiwKKwkJCQljb25zdCBzYXNsX3NlcnZlcl9wbHVnX3QgKipw
bHVnbGlzdCwKKwkJCQlpbnQgKnBsdWdjb3VudCkKIHsKICAgaWYgKG1heHZlcnNpb248UExBSU5f
VkVSU0lPTikKICAgICByZXR1cm4gU0FTTF9CQURWRVJTOwpAQCAtNzk0LDExICs3OTQsMTEgQEAK
ICAgfQogfTsKIAotaW50IHNhc2xfY2xpZW50X3BsdWdfaW5pdChzYXNsX3V0aWxzX3QgKnV0aWxz
IF9fYXR0cmlidXRlX18oKHVudXNlZCkpLAotCQkJICBpbnQgbWF4dmVyc2lvbiwKLQkJCSAgaW50
ICpvdXRfdmVyc2lvbiwKLQkJCSAgY29uc3Qgc2FzbF9jbGllbnRfcGx1Z190ICoqcGx1Z2xpc3Qs
Ci0JCQkgIGludCAqcGx1Z2NvdW50KQoraW50IHBsYWluX3Nhc2xfY2xpZW50X3BsdWdfaW5pdChz
YXNsX3V0aWxzX3QgKnV0aWxzIF9fYXR0cmlidXRlX18oKHVudXNlZCkpLAorCQkJCWludCBtYXh2
ZXJzaW9uLAorCQkJCWludCAqb3V0X3ZlcnNpb24sCisJCQkJY29uc3Qgc2FzbF9jbGllbnRfcGx1
Z190ICoqcGx1Z2xpc3QsCisJCQkJaW50ICpwbHVnY291bnQpCiB7CiAgIGlmIChtYXh2ZXJzaW9u
PFBMQUlOX1ZFUlNJT04pCiAgICAgcmV0dXJuIFNBU0xfQkFEVkVSUzsKSW5kZXg6IHBsdWdpbnMv
c3JwLmMKPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PQpSQ1MgZmlsZTogL2Fmcy9hbmRyZXcvc3lzdGVtL2N2cy9zcmMvc2Fz
bC9wbHVnaW5zL3NycC5jLHYKcmV0cmlldmluZyByZXZpc2lvbiAxLjIKZGlmZiAtdSAtcjEuMiBz
cnAuYwotLS0gc3JwLmMJMjAwMC8wNC8wOSAyMjo1NDoxMQkxLjIKKysrIHNycC5jCTIwMDEvMDQv
MjUgMDA6MzM6MzIKQEAgLTQ0LDYgKzQ0LDcgQEAKICNpbmNsdWRlIDxjb25maWcuaD4KICNpbmNs
dWRlIDxzYXNsLmg+CiAjaW5jbHVkZSA8c2FzbHBsdWcuaD4KKyNpbmNsdWRlIDxlcnJuby5oPgog
CiAjaW5jbHVkZSA8YXNzZXJ0Lmg+CiAjaW5jbHVkZSA8Y3R5cGUuaD4KQEAgLTUxLDkgKzUyLDYg
QEAKIC8qIGZvciBiaWcgbnVtYmVyIHN1cHBvcnQgKi8KICNpbmNsdWRlIDxnbXAuaD4KIAotLyog
Zm9yIFNIQTEgc3VwcG9ydCAqLwotI2luY2x1ZGUgPG9wZW5zc2wvc2hhLmg+Ci0KICNpZmRlZiBX
SU4zMgogLyogVGhpcyBtdXN0IGJlIGFmdGVyIHNhc2wuaCwgc2FzbHV0aWwuaCAqLwogLyogeHh4
ICAjIGluY2x1ZGUgInNhc2xBTk9OWU1PVVMuaCIgKi8KQEAgLTY4LDY2ICs2NiwxMDkgQEAKICMg
ZGVmaW5lIExfREVGQVVMVF9HVUFSRCAoMCkKICNlbmRpZgogCi0vKiBzZWN1cml0eSBiaXRzICov
Ci0jZGVmaW5lIFNSUF9TVVBQT1JUU19JTlRFR1JJVFkgMQotI2RlZmluZSBTUlBfU1VQUE9SVFNf
U0VRVUVOQ0VOVU1CRVJTIDIKLSNkZWZpbmUgU1JQX1NVUFBPUlRTX0NPTkZJREVOVElBTElUWSA0
Ci0KLQotI2RlZmluZSBIQVNITEVOIFNIQV9ESUdFU1RfTEVOR1RICi0jZGVmaW5lIE1BWEJJR05V
TUxFTiAxMDI0Ci0KIC8qIFNpemUgb2YgTiBpbiBiaXRzICovCiAjZGVmaW5lIEJJVFNGT1JOIDEy
OAogLyogU2l6ZSBvZiBkaWZmaWUtaGVsbG1hbiBzZWNyZXRzIGEgYW5kIGIgKi8KICNkZWZpbmUg
QklUU0ZPUmFiIDY0CisvKiBIb3cgbWFueSBieXRlcyBiaWcgc2hvdWxkIHRoZSBzYWx0IGJlPyAq
LworI2RlZmluZSBTUlBfU0FMVF9TSVpFIDE2CiAKLQogI2RlZmluZSBWTCh4KSBwcmludGYgeAog
CitleHRlcm4gaW50IGVycm5vOworCiAvKiBnbG9iYWw6IGlmIHdlJ3ZlIGFscmVhZHkgc2V0IGEg
cGFzcyBlbnRyeSAqLwogc3RhdGljIGludCBteWRiX2luaXRpYWxpemVkID0gMDsKIAotdHlwZWRl
ZiBzdHJ1Y3QgbmV0c3RyaW5nX3MgeworLyogR2VuZXJpYyBIYXNoIGZ1bmN0aW9uIGRlZmluaXRp
b25zICovCit0eXBlZGVmIGludCAgKCpzcnBfaGFzaF9sZW5fdCkoc2FzbF91dGlsc190ICp1dGls
cyk7Cit0eXBlZGVmIGludCAgKCpzcnBfaGFzaF9pbml0X3QpKHNhc2xfdXRpbHNfdCAqdXRpbHMs
IGNoYXIgKmtleSwgaW50IGtleWxlbiwgdm9pZCAqKmN0eCk7Cit0eXBlZGVmIHZvaWQgKCpzcnBf
aGFzaF91cGRhdGVfdCkoc2FzbF91dGlsc190ICp1dGlscywgdm9pZCAqY3R4LCBjaGFyICpkYXRh
LCBpbnQgZGF0YWxlbik7Cit0eXBlZGVmIHZvaWQgKCpzcnBfaGFzaF9maW5hbF90KShzYXNsX3V0
aWxzX3QgKnV0aWxzLCBjaGFyICpvdXRkYXRhLCB2b2lkICpjdHgpOworCisjZGVmaW5lIE9QVElP
Tl9SRVBMQVlfREVURUNUSU9OICJyZXBsYXkgZGV0ZWN0aW9uIgorI2RlZmluZSBPUFRJT05fSU5U
RUdSSVRZICJpbnRlZ3JpdHk9IgorI2RlZmluZSBPUFRJT05fQ09ORklERU5USUFMSVRZICJjb25m
aWRlbnRpYWxpdHk9IgogCi0gICAgaW50IHNpemU7Ci0gICAgCi0gICAgY2hhciBkYXRhWzFdOyAv
KiBhbGxvY2F0ZSB0byBzaXplIHlvdSBuZWVkICovCisvKiBGb3J3YXJkIGRlY2wgKi8KK3N0YXRp
YyBpbnQKK1JlYWRVc2VySW5mbyhzYXNsX3V0aWxzX3QgKnV0aWxzLCBjaGFyICphdXRoaWQsIGNo
YXIgKnJlYWxtLAorCSAgICAgbXB6X3QgKk4sIG1wel90ICpnLCBjaGFyICoqc2FsdCwgaW50ICpz
YWx0bGVuLCBtcHpfdCAqdiwgY29uc3QgY2hhciAqKmVycnN0cik7CiAKLX0gbmV0c3RyaW5nX3Q7
CisvKioqKioqKioqKioqKioqKiogTUQ1IEhhc2ggRnVuY3Rpb25zIGZvciBJbnRlZ3JpdHkgTGF5
ZXIgKioqKioqKioqKioqKioqKi8KIAotLyogZG9lc24ndCBjb250YWluIG5ldHN0cmluZyBmb3Jt
YXR0aW5nICovCi10eXBlZGVmIHN0cnVjdCBuZXRkYXRhX3Mgeworc3RhdGljIGludAorc3JwX21k
NUxlbihzYXNsX3V0aWxzX3QgKnV0aWxzIF9fYXR0cmlidXRlX18oKHVudXNlZCkpKQoreworICAg
IHJldHVybiAxNjsKK30KIAotICAgIGludCBzaXplOwotICAgIAotICAgIGNoYXIgZGF0YVsxXTsg
LyogYWxsb2NhdGUgdG8gc2l6ZSB5b3UgbmVlZCAqLworc3RhdGljIGludAorc3JwX21kNUluaXQo
c2FzbF91dGlsc190ICp1dGlscywgY2hhciAqa2V5LCBpbnQga2V5bGVuLCB2b2lkICoqY3R4KQor
eworICAgIEhNQUNfTUQ1X0NUWCAqcmV0OwogCi19IG5ldGRhdGFfdDsKKyAgICByZXQgPSB1dGls
cy0+bWFsbG9jKHNpemVvZihITUFDX01ENV9DVFgpKTsKKyAgICBpZiAoIXJldCkgcmV0dXJuIFNB
U0xfTk9NRU07CisKKyAgICB1dGlscy0+aG1hY19tZDVfaW5pdChyZXQsIGtleSwga2V5bGVuKTsK
IAorICAgICpjdHggPSByZXQ7CiAKKyAgICByZXR1cm4gU0FTTF9PSzsKK30KIAotdHlwZWRlZiBz
dHJ1Y3QgaGFzaF9zIHsKK3N0YXRpYyB2b2lkCitzcnBfbWQ1VXBkYXRlKHNhc2xfdXRpbHNfdCAq
dXRpbHMsIHZvaWQgKmNvbnRleHQsIGNoYXIgKmRhdGEsIGludCBkYXRhbGVuKQoreworICAgIEhN
QUNfTUQ1X0NUWCAqY3R4ID0gKEhNQUNfTUQ1X0NUWCAqKWNvbnRleHQ7CiAKLSAgICB1bnNpZ25l
ZCBjaGFyIGRhdGFbU0hBX0RJR0VTVF9MRU5HVEhdOwotICAgIGludCBsZW47CisgICAgdXRpbHMt
Pk1ENVVwZGF0ZSgmY3R4LT5pY3R4LCBkYXRhLCBkYXRhbGVuKTsgICAgCit9CisKK3N0YXRpYyB2
b2lkCitzcnBfbWQ1RmluYWwoc2FzbF91dGlsc190ICp1dGlscywgY2hhciAqb3V0ZGF0YSwgdm9p
ZCAqY29udGV4dCkKK3sKKyAgICBITUFDX01ENV9DVFggKmN0eCA9IChITUFDX01ENV9DVFggKilj
b250ZXh0OworCisgICAgdXRpbHMtPmhtYWNfbWQ1X2ZpbmFsKG91dGRhdGEsIGN0eCk7Cit9CisK
Ky8qKioqKioqKioqKioqKioqKioqKiBPcHRpb25zICoqKioqKioqKioqKioqKioqKioqKioqKiov
CisKK3R5cGVkZWYgc3RydWN0IGxheWVyX29wdGlvbl9zIHsKKyAgICBjaGFyICpuYW1lOworICAg
IGludCBiaXQ7CisgICAgaW50IHNzZjsKKworICAgIHNycF9oYXNoX2xlbl90ICAgIEhhc2hMZW47
CisgICAgc3JwX2hhc2hfaW5pdF90ICAgSGFzaEluaXQ7CisgICAgc3JwX2hhc2hfdXBkYXRlX3Qg
SGFzaFVwZGF0ZTsKKyAgICBzcnBfaGFzaF9maW5hbF90ICBIYXNoRmluYWw7CiAKLX0gaGFzaF90
OworfSBsYXllcl9vcHRpb25fdDsKIAotdHlwZWRlZiBzdHJ1Y3QgaW50ZXJsZWF2ZWRfcyB7Citz
dGF0aWMgbGF5ZXJfb3B0aW9uX3QgaW50ZWdyaXR5X29wdGlvbnNbXSA9IHsKKyAgICB7ImhtYWMt
bWQ1IiwgMHgxLCAwLCAmc3JwX21kNUxlbiwgJnNycF9tZDVJbml0LCAmc3JwX21kNVVwZGF0ZSwg
JnNycF9tZDVGaW5hbH0sCisgICAge05VTEwsICAgICAgIDB4MCwgMCwgICAgICAgIE5VTEwsICAg
ICAgICAgTlVMTCwgICAgICAgICAgIE5VTEwsICAgICAgICAgIE5VTEx9Cit9OwogCi0gICAgdW5z
aWduZWQgY2hhciBkYXRhW1NIQV9ESUdFU1RfTEVOR1RIKjJdOworc3RhdGljIGxheWVyX29wdGlv
bl90IGNvbmZpZGVudGlhbGl0eV9vcHRpb25zW10gPSB7CisgICAgLyogbm90aGluZyB5ZXQgKi8K
KyAgICB7TlVMTCwgICAgICAgMHgwLCAwLCAgICAgICAgTlVMTCwgICAgICAgICBOVUxMLCAgICAg
ICAgICAgTlVMTCwgICAgICAgICAgTlVMTH0KK307CiAKLX0gaW50ZXJsZWF2ZWRfdDsKIAotdHlw
ZWRlZiBzdHJ1Y3Qgc2F2ZWRpbmZvX3MgewordHlwZWRlZiBzdHJ1Y3Qgc3JwX29wdGlvbnNfcyB7
CiAKLSAgICBjaGFyIHNhbHRbMTZdOworICAgIGludCByZXBsYXlfZGV0ZWN0aW9uOwogCi0gICAg
bXB6X3QgdmVyaWZpZXI7CisgICAgaW50IGludGVncml0eTsKKyAgICBpbnQgY29uZmlkZW50aWFs
aXR5OwogCi19IHNhdmVkaW5mb190OworfSBzcnBfb3B0aW9uc190OwogCisvKiBUaGUgbWFpbiBT
UlAgY29udGV4dCAqLwogdHlwZWRlZiBzdHJ1Y3QgY29udGV4dF9zIHsKICAgICBpbnQgc3RhdGU7
CiAKQEAgLTE0NCwyNzMgKzE4NSwzMTEgQEAKICAgICBtcHpfdCBhOwogICAgIG1wel90IEE7CiAK
LSAgICBpbnRlcmxlYXZlZF90IHNoYXJlZHNlY3JldEs7CisgICAgY2hhciAqSzsKKyAgICBpbnQg
S2xlbjsKKworICAgIGNoYXIgKk0xOworICAgIGludCBNMWxlbjsKIAotICAgIGNoYXIgKmF1dGhp
ZDsKKyAgICBjaGFyICphdXRoaWQ7IC8qIGF1dGhlbnRpY2F0aW9uIGlkICovCisgICAgY2hhciAq
dXNlcmlkOyAvKiBhdXRob3JpemF0aW9uIGlkICovCiAgICAgY2hhciAqcmVhbG07CiAgICAgc2Fz
bF9zZWNyZXRfdCAqcGFzc3dvcmQ7CiAKLSAgICB1bnNpZ25lZCBjaGFyIGNsaWVudF9vcHRpb25z
OwotICAgIHVuc2lnbmVkIGNoYXIgc2VydmVyX29wdGlvbnM7CisgICAgY2hhciAqY2xpZW50X29w
dGlvbnM7CisgICAgY2hhciAqc2VydmVyX29wdGlvbnM7CiAKLSAgICBoYXNoX3QgTTE7IC8qIGNs
aWVudCBuZWVkcyB0byBzYXZlIGJldHdlZW4gc3RlcHMgMyBhbmQgNCAqLwotICAgIHNhdmVkaW5m
b190ICpzaW5mbzsKKyAgICBzcnBfb3B0aW9uc190IGNsaWVudF9vcHRzOwogCi19IGNvbnRleHRf
dDsKLQorICAgIGNoYXIgKnNhbHQ7CisgICAgaW50IHNhbHRsZW47CiAKLS8qIGZvcndhcmQgZGVj
bGFyYXRpb25zICovCi1zdGF0aWMgaW50IGNyZWF0ZV9wdWJsaWNfc2VydmVyKG1wel90IGcsIG1w
el90IE4sIG1wel90IHYsCi0JCQkJbXB6X3QgYiwgbXB6X3QgQik7Ci0KLXN0YXRpYyBjaGFyIGZy
b21iaXRzKHVuc2lnbmVkIGludCBpKQotewotICAgIGFzc2VydChpIDw9IDE1KTsKKyAgICAvKiBM
YXllciBmb28gKi8KKyAgICBpbnQgZW5hYmxlZF9pbnRlZ3JpdHlfbGF5ZXI7CisgICAgaW50IGVu
YWJsZWRfcmVwbGF5X2RldGVjdGlvbjsKKworICAgIGludCBzZXFudW1fb3V0OworICAgIGludCBz
ZXFudW1faW47CisKKyAgICBzcnBfaGFzaF9sZW5fdCAgICBIYXNoTGVuOworICAgIHNycF9oYXNo
X2luaXRfdCAgIEhhc2hJbml0OworICAgIHNycF9oYXNoX3VwZGF0ZV90IEhhc2hVcGRhdGU7Cisg
ICAgc3JwX2hhc2hfZmluYWxfdCAgSGFzaEZpbmFsOworCisgICAgLyogZW5jb2RlIGFuZCBkZWNv
ZGUgbmVlZCB0aGVzZSAqLworICAgIHNhc2xfdXRpbHNfdCAqdXRpbHM7CisgICAgY2hhciAqYnVm
ZmVyOyAgICAgICAgICAgICAgICAgICAgCisgICAgaW50IGJ1ZnNpemU7CisgICAgY2hhciBzaXpl
YnVmWzRdOworICAgIGludCBjdXJzaXplOworICAgIGludCBzaXplOworICAgIGludCBuZWVkc2l6
ZTsKIAotICAgIGlmIChpPD05KSByZXR1cm4gJzAnK2k7Cit9IGNvbnRleHRfdDsKIAotICAgIHJl
dHVybiAnYScrIChpLTEwKTsKLX0KKy8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioq
KioqKioqKioqCisgKglMYXllciBGdW5jdGlvbnMJIAkgICAgICAgICAgICoKKyAqICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqCisgKioqKioqKioqKioqKioqKioqKioq
KioqKioqKioqKioqKioqKioqKioqKi8KIAotc3RhdGljIGludCB0b2JpdHMoY2hhciBjKQorc3Rh
dGljIGludAorbGF5ZXJfZW5jb2RlKHZvaWQgKmNvbnRleHQsCisJCSBjb25zdCBjaGFyICppbnB1
dCwKKwkJIHVuc2lnbmVkIGlucHV0bGVuLAorCQkgY2hhciAqKm91dHB1dCwKKwkJIHVuc2lnbmVk
ICpvdXRwdXRsZW4pCiB7Ci0gICAgaWYgKChpbnQpIGlzZGlnaXQoYykpCi0JcmV0dXJuIGMtJzAn
OworICAgIGNvbnRleHRfdCAgICAgICp0ZXh0ID0gKGNvbnRleHRfdCAqKSBjb250ZXh0OworICAg
IGludCBoYXNobGVuID0gMDsKKyAgICBjaGFyIGhhc2hkYXRhWzE2XTsgLyogeHh4ICovCisgICAg
aW50IHRtcG51bTsKIAotICAgIGlmICgoYz49J2EnKSAmJiAoYzw9J2YnKSkKLQlyZXR1cm4gYy0n
YScrMTA7CisgIGFzc2VydChpbnB1dGxlbiA+IDApOwogCi0gICAgaWYgKChjPj0nQScpICYmIChj
PD0nRicpKQotCXJldHVybiBjLSdBJysxMDsKKyAgaWYgKHRleHQtPmVuYWJsZWRfaW50ZWdyaXR5
X2xheWVyKSB7CisgICAgICB2b2lkICpobWFjX2N0eCA9IE5VTEw7CiAKLSAgICByZXR1cm4gMDsK
LX0KKyAgICAgIHRleHQtPkhhc2hJbml0KHRleHQtPnV0aWxzLCB0ZXh0LT5LLCB0ZXh0LT5LbGVu
LCAmaG1hY19jdHgpOwogCisgICAgICB0ZXh0LT5IYXNoVXBkYXRlKHRleHQtPnV0aWxzLCBobWFj
X2N0eCwgKGNoYXIgKilpbnB1dCwgaW5wdXRsZW4pOwogCi0vKiBjb3B5IGEgc3RyaW5nICovCi1z
dGF0aWMgaW50Ci1zcnBfc3RyZHVwKHNhc2xfdXRpbHNfdCAqIHV0aWxzLCBjb25zdCBjaGFyICpp
biwgY2hhciAqKm91dCwgaW50ICpvdXRsZW4pCi17Ci0gIHNpemVfdCBsZW4gPSBzdHJsZW4oaW4p
OworICAgICAgaWYgKHRleHQtPmVuYWJsZWRfcmVwbGF5X2RldGVjdGlvbikgeworCSAgdG1wbnVt
ID0gaHRvbmwodGV4dC0+c2VxbnVtX291dCk7CisJICB0ZXh0LT5IYXNoVXBkYXRlKHRleHQtPnV0
aWxzLCBobWFjX2N0eCwgKGNoYXIgKikgJnRtcG51bSwgNCk7CisJICAgIAorCSAgdGV4dC0+c2Vx
bnVtX291dCsrOwkgIAorICAgICAgfQogCi0gIGlmIChvdXRsZW4hPU5VTEwpIHsKLSAgICAgICpv
dXRsZW4gPSBsZW47CisgICAgICB0ZXh0LT5IYXNoRmluYWwodGV4dC0+dXRpbHMsIGhhc2hkYXRh
LCBobWFjX2N0eCk7CisgICAgICBoYXNobGVuID0gMTY7IC8qIHh4eCAqLwogICB9CiAKLSAgKm91
dCA9IHV0aWxzLT5tYWxsb2MobGVuICsgMSk7Ci0gIGlmICghKm91dCkgewotICAgICAgcmV0dXJu
IFNBU0xfTk9NRU07Ci0gIH0KKyAgLyogNCBmb3IgbGVuZ3RoICsgaW5wdXQgc2l6ZSArIGhhc2hs
ZW4gZm9yIGludGVncml0eSAoY291bGQgYmUgemVybykgKi8KKyAgKm91dHB1dGxlbiA9IDQgKyBp
bnB1dGxlbiArIGhhc2hsZW47CiAKLSAgc3RyY3B5KChjaGFyICopICpvdXQsIGluKTsKKyAgKm91
dHB1dCA9IHRleHQtPnV0aWxzLT5tYWxsb2MoKm91dHB1dGxlbik7CisgIGlmICghKm91dHB1dCkg
cmV0dXJuIFNBU0xfTk9NRU07CisgIAorICB0bXBudW0gPSBpbnB1dGxlbitoYXNobGVuOworICB0
bXBudW0gPSBodG9ubCh0bXBudW0pOworICBtZW1jcHkoKm91dHB1dCwgICAgICZ0bXBudW0sIDQp
OworICBtZW1jcHkoKCpvdXRwdXQpKzQsIGlucHV0LCBpbnB1dGxlbik7CisgIG1lbWNweSgoKm91
dHB1dCkrNCtpbnB1dGxlbiwgaGFzaGRhdGEsIGhhc2hsZW4pOworICAKICAgcmV0dXJuIFNBU0xf
T0s7CiB9Ci0KLXN0YXRpYyBuZXRkYXRhX3QgKmNyZWF0ZV9uZXRkYXRhX2JpZ2ludChtcHpfdCBu
LCBzYXNsX3V0aWxzX3QgKnV0aWxzKQotewotICAgIGludCBzaXplOwotICAgIG5ldGRhdGFfdCAq
cmV0OwotICAgIGludCBwcmVmaXhsZW49MDsKLSAgICBpbnQgbHVwOwotICAgIGNoYXIgKnN0cjsK
LQotICAgIHNpemUgPSBtcHpfc2l6ZWluYmFzZSAobiwgMTYpOwotCi0gICAgc3RyID0gKGNoYXIg
KikgdXRpbHMtPm1hbGxvYyhzaXplKzEwKTsKLSAgICBpZiAoIXN0cikgcmV0dXJuIE5VTEw7Ci0g
ICAgbXB6X2dldF9zdHIgKHN0ciwgMTYsIG4pOwotCi0gICAgcmV0ID0gKG5ldGRhdGFfdCAqKSB1
dGlscy0+bWFsbG9jKHNpemVvZihuZXRkYXRhX3QpKzIwK3NpemUpOwotICAgIGlmICghcmV0KSBy
ZXR1cm4gTlVMTDsKLQotICAgIGlmIChzaXplJTIhPTApIHsKLQlyZXQtPmRhdGFbMF09dG9iaXRz
KHN0clswXSk7Ci0Jc2l6ZS0tOwotCXN0cisrOwotCXByZWZpeGxlbj0xOwotICAgIH0KLQotICAg
IGZvciAobHVwPTA7bHVwPHNpemUvMjtsdXArKykKLSAgICB7Ci0JcmV0LT5kYXRhW3ByZWZpeGxl
bitsdXBdID0gKHRvYml0cyhzdHJbbHVwKjJdKSA8PCA0KTsKLQlyZXQtPmRhdGFbcHJlZml4bGVu
K2x1cF0gfD0gdG9iaXRzKHN0cltsdXAqMisxXSk7Ci0gICAgfQotCi0gICAgcmV0LT5zaXplID0g
cHJlZml4bGVuKyhzaXplLzIpOwotCi0gICAgcmV0dXJuIHJldDsKLX0KLQotc3RhdGljIG5ldHN0
cmluZ190ICpjcmVhdGVfbmV0c3RyaW5nX2JpZ2ludChtcHpfdCBuLCBzYXNsX3V0aWxzX3QgKnV0
aWxzKQotewotICAgIGludCBzaXplOwotICAgIGludCBwcmVmaXhsZW47Ci0gICAgbmV0c3RyaW5n
X3QgKnJldDsKLSAgICBpbnQgbHVwOwotICAgIGNoYXIgKnN0cjsKLQotICAgIHNpemUgPSBtcHpf
c2l6ZWluYmFzZSAobiwgMTYpOwotCi0gICAgc3RyID0gKGNoYXIgKikgdXRpbHMtPm1hbGxvYyhz
aXplKzEwKTsKLSAgICBpZiAoIXN0cikgcmV0dXJuIE5VTEw7Ci0gICAgbXB6X2dldF9zdHIgKHN0
ciwgMTYsIG4pOwogCi0gICAgcmV0ID0gKG5ldHN0cmluZ190ICopIHV0aWxzLT5tYWxsb2Moc2l6
ZW9mKG5ldHN0cmluZ190KSsyMCtzaXplKTsKLSAgICBpZiAoIXJldCkgcmV0dXJuIE5VTEw7Citz
dGF0aWMgaW50CitkZWNvZGUoY29udGV4dF90ICp0ZXh0LAorICAgICAgIGNvbnN0IGNoYXIgKmlu
cHV0LAorICAgICAgIHVuc2lnbmVkIGlucHV0bGVuLAorICAgICAgIGNoYXIgKipvdXRwdXQsCisg
ICAgICAgdW5zaWduZWQgKm91dHB1dGxlbikKK3sKKyAgICBpbnQgaGFzaGxlbiA9IDA7CisKKyAg
ICBpZiAodGV4dC0+ZW5hYmxlZF9pbnRlZ3JpdHlfbGF5ZXIpIHsKKwlpbnQgdG1wbnVtOworCWNo
YXIgaGFzaGRhdGFbMTZdOworCWludCBpOworCXZvaWQgKmhtYWNfY3R4ID0gTlVMTDsKKworCXRl
eHQtPkhhc2hJbml0KHRleHQtPnV0aWxzLCB0ZXh0LT5LLCB0ZXh0LT5LbGVuLCAmaG1hY19jdHgp
OworCisJaGFzaGxlbiA9IDE2OyAvKiB4eHggKi8KKworCWlmICgoaW50KWlucHV0bGVuIDwgaGFz
aGxlbikgeworCSAgICBWTCgoIklucHV0IGlzIHNtYWxsZXIgdGhhbiBoYXNoIGxlbmd0aDogJWQg
dnMgJWRcbiIsaW5wdXRsZW4sIGhhc2hsZW4pKTsKKwkgICAgcmV0dXJuIFNBU0xfRkFJTDsKKwl9
CiAKLSAgICBzcHJpbnRmKHJldC0+ZGF0YSwiJWQ6Iiwoc2l6ZSsxKS8yKTsKLSAgICBwcmVmaXhs
ZW4gPSBzdHJsZW4ocmV0LT5kYXRhKTsKKwkvKiBjcmVhdGUgbXkgdmVyc2lvbiBvZiB0aGUgaGFz
aCAqLworCXRleHQtPkhhc2hVcGRhdGUodGV4dC0+dXRpbHMsIGhtYWNfY3R4LCAoY2hhciAqKWlu
cHV0LCBpbnB1dGxlbiAtIGhhc2hsZW4pOwogCi0gICAgaWYgKHNpemUlMiE9MCkgewotCXJldC0+
ZGF0YVtwcmVmaXhsZW5dPXRvYml0cyhzdHJbMF0pOwotCXNpemUtLTsKLQlzdHIrKzsKLQlwcmVm
aXhsZW4rKzsKLSAgICB9CisJaWYgKHRleHQtPmVuYWJsZWRfcmVwbGF5X2RldGVjdGlvbikgewor
CSAgICB0bXBudW0gPSBodG9ubCh0ZXh0LT5zZXFudW1faW4pOworCSAgICB0ZXh0LT5IYXNoVXBk
YXRlKHRleHQtPnV0aWxzLCBobWFjX2N0eCwgKGNoYXIgKikgJnRtcG51bSwgNCk7CisJICAgIAor
CSAgICB0ZXh0LT5zZXFudW1faW4gKys7CisJfQorCQorCXRleHQtPkhhc2hGaW5hbCh0ZXh0LT51
dGlscywgaGFzaGRhdGEsIGhtYWNfY3R4KTsKIAotICAgIGZvciAobHVwPTA7bHVwPHNpemUvMjts
dXArKykKLSAgICB7Ci0JcmV0LT5kYXRhW3ByZWZpeGxlbitsdXBdID0gKHRvYml0cyhzdHJbbHVw
KjJdKSA8PCA0KTsKLQlyZXQtPmRhdGFbcHJlZml4bGVuK2x1cF0gfD0gdG9iaXRzKHN0cltsdXAq
MisxXSk7CisJLyogY29tcGFyZSB0byBoYXNoIGdpdmVuICovCisJZm9yIChpID0gMDsgaSA8IGhh
c2hsZW47IGkrKykgeworCSAgICBpZiAoaGFzaGRhdGFbaV0gIT0gaW5wdXRbaW5wdXRsZW4gLSBo
YXNobGVuICsgaV0pIHsKKwkJVkwoKCJIYXNoIGlzIGluY29ycmVjdFxuIikpOworCQlyZXR1cm4g
U0FTTF9GQUlMOworCSAgICB9CisJfQogICAgIH0KLQotICAgIHJldC0+ZGF0YVtwcmVmaXhsZW4r
c2l6ZS8yXSA9ICcsJzsKLSAgICByZXQtPmRhdGFbcHJlZml4bGVuKyhzaXplLzIpKzFdID0gJ1ww
JzsKLQotICAgIHJldC0+c2l6ZSA9IHByZWZpeGxlbisoc2l6ZS8yKSsxOwotCi0gICAgcmV0dXJu
IHJldDsKLX0KLQotLyoKLSAqIENyZWF0ZSBhIG5ldHN0cmluZyBmcm9tIGEgY2hhcmFjdGVyIGFy
cmF5Ci0gKi8KLQotc3RhdGljIG5ldHN0cmluZ190ICpjcmVhdGVfbmV0c3RyaW5nX3N0cihjaGFy
ICpzdHIsIGludCBsZW4sIHNhc2xfdXRpbHNfdCAqdXRpbHMpCi17Ci0gICAgbmV0c3RyaW5nX3Qg
KnJldDsKLSAgICBpbnQgcHJlZml4bGVuOwotCi0gICAgcmV0ID0gKG5ldHN0cmluZ190ICopIHV0
aWxzLT5tYWxsb2Moc2l6ZW9mKG5ldHN0cmluZ190KSsxMCtsZW4pOwogCi0gICAgc3ByaW50Zihy
ZXQtPmRhdGEsIiVkOiIsbGVuKTsKLSAgICBwcmVmaXhsZW4gPSBzdHJsZW4ocmV0LT5kYXRhKTsK
KyAgICAqb3V0cHV0ID0gdGV4dC0+dXRpbHMtPm1hbGxvYyhpbnB1dGxlbiAtIGhhc2hsZW4pOwor
ICAgIGlmICghKm91dHB1dCkgcmV0dXJuIFNBU0xfTk9NRU07CiAKLSAgICBtZW1jcHkocmV0LT5k
YXRhK3ByZWZpeGxlbixzdHIsbGVuKTsKKyAgICAqb3V0cHV0bGVuID0gaW5wdXRsZW4gLSBoYXNo
bGVuOworICAgIG1lbWNweSgqb3V0cHV0LCBpbnB1dCwgKm91dHB1dGxlbik7CiAKLSAgICByZXQt
PmRhdGFbcHJlZml4bGVuK2xlbl09JywnOwotICAgIHJldC0+ZGF0YVtwcmVmaXhsZW4rbGVuKzFd
PSdcMCc7Ci0KLSAgICByZXQtPnNpemUgPSBwcmVmaXhsZW4rbGVuKzE7Ci0KLSAgICByZXR1cm4g
cmV0OworICAgIHJldHVybiBTQVNMX09LOwogfQogCi1zdGF0aWMgdm9pZCBIYXNoKHVuc2lnbmVk
IGNoYXIgKmRhdGEsIHVuc2lnbmVkIGxvbmcgbGVuLCBoYXNoX3QgKmhhc2gpCi17Ci0gICAgU0hB
X0NUWCBjOwotCi0gICAgU0hBMV9Jbml0KCZjKTsKK3N0YXRpYyBpbnQKK2xheWVyX2RlY29kZSh2
b2lkICpjb250ZXh0LAorCSAgICAgY29uc3QgY2hhciAqaW5wdXQsCisJICAgICB1bnNpZ25lZCBp
bnB1dGxlbiwKKwkgICAgIGNoYXIgKipvdXRwdXQsCisJICAgICB1bnNpZ25lZCAqb3V0cHV0bGVu
KQoreworICAgIGludCB0b2NvcHk7CisgICAgdW5zaWduZWQgZGlmZjsKKyAgICBjb250ZXh0X3Qg
KnRleHQ9Y29udGV4dDsKKyAgICBjaGFyICpleHRyYTsKKyAgICB1bnNpZ25lZCBpbnQgZXh0cmFs
ZW49MDsKKyAgICBpbnQgcjsKKworICAgIGlmICh0ZXh0LT5uZWVkc2l6ZT4wKSB7IC8qIDQgYnl0
ZXMgZm9yIGhvdyBsb25nIG1lc3NhZ2UgaXMgKi8KKwkvKiBpZiBsZXNzIHRoYW4gNCBieXRlcyBq
dXN0IGNvcHkgdGhvc2Ugd2UgaGF2ZSBpbnRvIHRleHQtPnNpemUgKi8KKwlpZiAoaW5wdXRsZW48
NCkgCisJICAgIHRvY29weT1pbnB1dGxlbjsKKwllbHNlCisJICB0b2NvcHk9NDsKKyAgICAgIAor
CWlmICh0b2NvcHk+dGV4dC0+bmVlZHNpemUpCisJICAgIHRvY29weT10ZXh0LT5uZWVkc2l6ZTsK
IAotICAgIFNIQTFfVXBkYXRlKCZjLGRhdGEsbGVuKTsKKwltZW1jcHkodGV4dC0+c2l6ZWJ1Zis0
LXRleHQtPm5lZWRzaXplLCBpbnB1dCwgdG9jb3B5KTsKKwl0ZXh0LT5uZWVkc2l6ZS09dG9jb3B5
OworCQorCWlucHV0Kz10b2NvcHk7CisJaW5wdXRsZW4tPXRvY29weTsKIAotICAgIFNIQTFfRmlu
YWwoJihoYXNoLT5kYXRhWzBdKSwmYyk7CisJaWYgKHRleHQtPm5lZWRzaXplPT0wKSAvKiBnb3Qg
YWxsIG9mIHNpemUgKi8KKwl7CisJICAgIG1lbWNweSgmKHRleHQtPnNpemUpLCB0ZXh0LT5zaXpl
YnVmLCA0KTsKKwkgICAgdGV4dC0+Y3Vyc2l6ZT0wOworCSAgICB0ZXh0LT5zaXplPW50b2hsKHRl
eHQtPnNpemUpOworCSAgICAKKwkgICAgLyogdG9vIGJpZz8gKi8KKwkgICAgaWYgKCh0ZXh0LT5z
aXplPjB4RkZGRikgfHwgKHRleHQtPnNpemUgPCAwKSkgeworCQlWTCgoIlNpemUgb3V0IG9mIHJh
bmdlOiAlZFxuIix0ZXh0LT5zaXplKSk7CisJCXJldHVybiBTQVNMX0ZBSUw7CisJICAgIH0KKwkg
ICAgCisJICAgIGlmICh0ZXh0LT5idWZzaXplIDwgdGV4dC0+c2l6ZSArIDUpIHsKKwkJdGV4dC0+
YnVmZmVyID0gdGV4dC0+dXRpbHMtPnJlYWxsb2ModGV4dC0+YnVmZmVyLCB0ZXh0LT5zaXplICsg
NSk7CisJCXRleHQtPmJ1ZnNpemUgPSB0ZXh0LT5zaXplICsgNTsKKwkgICAgfQorCSAgICBpZiAo
dGV4dC0+YnVmZmVyID09IE5VTEwpIHJldHVybiBTQVNMX05PTUVNOworCX0KKwkqb3V0cHV0bGVu
PTA7CisJKm91dHB1dD1OVUxMOworCWlmIChpbnB1dGxlbj09MCkgLyogaGF2ZSB0byB3YWl0IHVu
dGlsIG5leHQgdGltZSBmb3IgZGF0YSAqLworCSAgICByZXR1cm4gU0FTTF9PSzsKKwkKKwlpZiAo
dGV4dC0+c2l6ZT09MCkgIC8qIHNob3VsZCBuZXZlciBoYXBwZW4gKi8KKwkgICAgcmV0dXJuIFNB
U0xfRkFJTDsKKyAgICB9CiAgICAgCi0gICAgaGFzaC0+bGVuID0gU0hBX0RJR0VTVF9MRU5HVEg7
IAotCi0gICAgLyogICAgaW50IGx1cDsKLQotICAgIG1lbXNldChoYXNoLT5kYXRhLCAneicsIHNp
emVvZihoYXNoLT5kYXRhKSk7Ci0KLSAgICBpZiAobGVuID4gU0hBX0RJR0VTVF9MRU5HVEgpIGxl
biA9IFNIQV9ESUdFU1RfTEVOR1RIOwotCi0gICAgZm9yIChsdXA9MDtsdXA8KGludClsZW47bHVw
KyspCi0JaGFzaC0+ZGF0YVtsdXBdID0gZGF0YVtsdXBdOwotCi0JaGFzaC0+bGVuID0gU0hBX0RJ
R0VTVF9MRU5HVEg7Ki8KLX0KLQotc3RhdGljIGludCBIYXNoX2JpZ2ludChtcHpfdCBudW0sIGhh
c2hfdCAqaGFzaCwgc2FzbF91dGlsc190ICp1dGlscykKLXsgCi0gICAgaW50IHNpemU7Ci0gICAg
aW50IGx1cDsKLSAgICBjaGFyICpzdHI7Ci0gICAgY2hhciAqZGF0YTsKLQotICAgIHNpemUgPSBt
cHpfc2l6ZWluYmFzZSAobnVtLCAxNik7CisgICAgZGlmZj10ZXh0LT5zaXplIC0gdGV4dC0+Y3Vy
c2l6ZTsgLyogYnl0ZXMgbmVlZCBmb3IgZnVsbCBtZXNzYWdlICovCiAgICAgCi0gICAgc3RyID0g
KGNoYXIgKikgdXRpbHMtPm1hbGxvYyhzaXplKzEwKTsKLSAgICBpZiAoIXN0cikgcmV0dXJuIFNB
U0xfTk9NRU07Ci0gICAgbXB6X2dldF9zdHIgKHN0ciwgMTYsIG51bSk7CisgICAgaWYgKCEgdGV4
dC0+YnVmZmVyKQorCXJldHVybiBTQVNMX0ZBSUw7CiAgICAgCi0gICAgZGF0YSA9IChjaGFyICop
IHV0aWxzLT5tYWxsb2Moc2l6ZSsxMCk7Ci0gICAgaWYgKCFkYXRhKSByZXR1cm4gU0FTTF9OT01F
TTsKLQotICAgIGZvciAobHVwPTA7bHVwPHNpemUvMjtsdXArKykKLSAgICB7Ci0JZGF0YVtsdXBd
ID0gKHRvYml0cyhzdHJbbHVwKjJdKSA8PCA0KTsKLQlkYXRhW2x1cF0gPSB0b2JpdHMoc3RyW2x1
cCoyKzFdKTsKKyAgICBpZiAoaW5wdXRsZW4gPCBkaWZmKSB7IC8qIG5vdCBlbm91Z2ggZm9yIGEg
ZGVjb2RlICovCisJbWVtY3B5KHRleHQtPmJ1ZmZlcit0ZXh0LT5jdXJzaXplLCBpbnB1dCwgaW5w
dXRsZW4pOworCXRleHQtPmN1cnNpemUrPWlucHV0bGVuOworCSpvdXRwdXRsZW49MDsKKwkqb3V0
cHV0PU5VTEw7CisJcmV0dXJuIFNBU0xfT0s7CisgICAgfSBlbHNlIHsKKwltZW1jcHkodGV4dC0+
YnVmZmVyK3RleHQtPmN1cnNpemUsIGlucHV0LCBkaWZmKTsKKwlpbnB1dCs9ZGlmZjsgICAgICAK
KwlpbnB1dGxlbi09ZGlmZjsKKyAgICB9CisKKyAgICAvKiBXZSBoYXZlIGVub3VnaCBkYXRhIHRv
IHJldHVybiBzb21ldGhpbmcgKi8KKyAgICByID0gZGVjb2RlKHRleHQsIHRleHQtPmJ1ZmZlciwg
dGV4dC0+c2l6ZSwgb3V0cHV0LCBvdXRwdXRsZW4pOworICAgIGlmIChyKSByZXR1cm4gcjsKKwor
ICAgIHRleHQtPnNpemUgPSAtMTsKKyAgICB0ZXh0LT5uZWVkc2l6ZSA9IDQ7CisKKyAgICAvKiBp
ZiByZWNlaXZlZCBtb3JlIHRoYW4gdGhlIGVuZCBvZiBhIHBhY2tldCAqLworICAgIGlmIChpbnB1
dGxlbiE9MCkgeworCWV4dHJhID0gTlVMTDsKKwlsYXllcl9kZWNvZGUodGV4dCwgaW5wdXQsIGlu
cHV0bGVuLAorCQkgICAgICAgJmV4dHJhLCAmZXh0cmFsZW4pOworCWlmIChleHRyYSAhPSBOVUxM
KSB7CisJICAgIC8qIGlmIHJlY2VpdmVkIDIgcGFja2V0cyBtZXJnZSB0aGVtIHRvZ2V0aGVyICov
CisJICAgICpvdXRwdXQgPSB0ZXh0LT51dGlscy0+cmVhbGxvYygqb3V0cHV0LCAqb3V0cHV0bGVu
K2V4dHJhbGVuKTsKKwkgICAgbWVtY3B5KCpvdXRwdXQgKyAqb3V0cHV0bGVuLCBleHRyYSwgZXh0
cmFsZW4pOyAKKwkgICAgKm91dHB1dGxlbiArPSBleHRyYWxlbjsKKwkgICAgdGV4dC0+dXRpbHMt
PmZyZWUoZXh0cmEpOworCX0KICAgICB9Ci0KLSAgICBIYXNoKGRhdGEsIHNpemUvMiwgaGFzaCk7
Ci0KLSAgICB1dGlscy0+ZnJlZShzdHIpOwotICAgIHV0aWxzLT5mcmVlKGRhdGEpOwotCisgICAg
CiAgICAgcmV0dXJuIFNBU0xfT0s7CiB9CiAKLXN0YXRpYyBpbnQgU0hBX0ludGVybGVhdmUobXB6
X3QgbnVtLCBpbnRlcmxlYXZlZF90ICppbnRlciwgc2FzbF91dGlsc190ICp1dGlscykKLXsKLSAg
ICBuZXRzdHJpbmdfdCAqdG1wbnM7Ci0gICAgY2hhciAqVDsKLSAgICBpbnQgVGxlbjsKLSAgICBj
aGFyICpFLCAqRjsKLSAgICBpbnQgbHVwOwotICAgIGhhc2hfdCBHOwotICAgIGhhc2hfdCBIOwor
LyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioKKyAqCUhlbHBlciBG
dW5jdGlvbnMJCSAgICoKKyAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAqCisgKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi8KIAotICAg
IHRtcG5zID0gY3JlYXRlX25ldHN0cmluZ19iaWdpbnQobnVtLCB1dGlscyk7Ci0gICAgaWYgKCF0
bXBucykgcmV0dXJuIFNBU0xfTk9NRU07Ci0gICAgCi0gICAgLyogcmVtb3ZpbmcgbGVhZGluZyB6
ZXJvcyBpcyBhbHJlYWR5IGRvbmUgcmlnaHQ/ICovCisvKiBEaXNwb3NlIG9mIGEgU1JQIGNvbnRl
eHQgKGNvdWxkIGJlIHNlcnZlciBvciBjbGllbnQpCisgKgorICoKKyAqLyAKK3N0YXRpYyB2b2lk
IGRpc3Bvc2Uodm9pZCAqY29ubl9jb250ZXh0LCBzYXNsX3V0aWxzX3QgKnV0aWxzKQoreworICBj
b250ZXh0X3QgKnRleHQgPSBjb25uX2NvbnRleHQ7CiAKLSAgICAvKiBpZiBvZGQga2lsbCBmaXJz
dCBieXRlICovCi0gICAgVCA9IHRtcG5zLT5kYXRhOwotICAgIFRsZW4gPSB0bXBucy0+c2l6ZTsK
LSAgICBpZiAoVGxlbiAlIDIgIT0wKSB7IFQrKzsgVGxlbi0tOyB9CisgIGlmICghdGV4dCkKKyAg
ICByZXR1cm47CiAKLSAgICBFID0gKGNoYXIgKikgdXRpbHMtPm1hbGxvYyhUbGVuLzIrMSk7Ci0g
ICAgaWYgKCFFKSByZXR1cm4gU0FTTF9OT01FTTsKLSAgICBGID0gKGNoYXIgKikgdXRpbHMtPm1h
bGxvYyhUbGVuLzIrMSk7Ci0gICAgaWYgKCFGKSByZXR1cm4gU0FTTF9OT01FTTsKKyAgbXB6X2Ns
ZWFyKHRleHQtPk4pOworICBtcHpfY2xlYXIodGV4dC0+Zyk7CisgIG1wel9jbGVhcih0ZXh0LT5T
KTsKKyAgbXB6X2NsZWFyKHRleHQtPnYpOworICBtcHpfY2xlYXIodGV4dC0+Yik7CisgIG1wel9j
bGVhcih0ZXh0LT5CKTsKKyAgbXB6X2NsZWFyKHRleHQtPmEpOworICBtcHpfY2xlYXIodGV4dC0+
QSk7CisKKyAgaWYgKHRleHQtPkspICAgICAgICAgICAgICAgIHV0aWxzLT5mcmVlKHRleHQtPksp
OworICBpZiAodGV4dC0+TTEpICAgICAgICAgICAgICAgdXRpbHMtPmZyZWUodGV4dC0+TTEpOwor
CisgIGlmICh0ZXh0LT5hdXRoaWQpICAgICAgICAgICB1dGlscy0+ZnJlZSh0ZXh0LT5hdXRoaWQp
OworICBpZiAodGV4dC0+dXNlcmlkKSAgICAgICAgICAgdXRpbHMtPmZyZWUodGV4dC0+dXNlcmlk
KTsKKyAgaWYgKHRleHQtPnJlYWxtKSAgICAgICAgICAgIHV0aWxzLT5mcmVlKHRleHQtPnJlYWxt
KTsKKyAgaWYgKHRleHQtPnBhc3N3b3JkKSAgICAgICAgIHV0aWxzLT5mcmVlKHRleHQtPnBhc3N3
b3JkKTsKKyAgaWYgKHRleHQtPnNhbHQpICAgICAgICAgICAgIHV0aWxzLT5mcmVlKHRleHQtPnNh
bHQpOworCisgIGlmICh0ZXh0LT5jbGllbnRfb3B0aW9ucykgICB1dGlscy0+ZnJlZSh0ZXh0LT5j
bGllbnRfb3B0aW9ucyk7CisgIGlmICh0ZXh0LT5zZXJ2ZXJfb3B0aW9ucykgICB1dGlscy0+ZnJl
ZSh0ZXh0LT5zZXJ2ZXJfb3B0aW9ucyk7CisgIGlmICh0ZXh0LT5idWZmZXIpICAgICAgICAgICB1
dGlscy0+ZnJlZSh0ZXh0LT5idWZmZXIpOwogCi0gICAgLyogRSBnZXRzIGV2ZW4gYnl0ZXMuIEYg
Z2V0cyBvZGQgKi8KLSAgICBmb3IgKGx1cD0wO2x1cDxUbGVuLzI7bHVwKyspCi0gICAgewotCUVb
bHVwXT1UW2x1cCoyXTsKLQlGW2x1cF09VFtsdXAqMisxXTsKLSAgICB9CisgIHV0aWxzLT5mcmVl
KHRleHQpOworfQogCi0gICAgdXRpbHMtPmZyZWUodG1wbnMpOwogCi0gICAgLyogaGFzaCBFIGFu
ZCBGIGludG8gRyBhbmQgSCovCi0gICAgSGFzaChFLFRsZW4vMiwgJkcpOwotICAgIEhhc2goRixU
bGVuLzIsICZIKTsKKy8qIGNvcHkgYSBzdHJpbmcgKi8KK3N0YXRpYyBpbnQKK3NycF9zdHJkdXAo
c2FzbF91dGlsc190ICogdXRpbHMsIGNvbnN0IGNoYXIgKmluLCBjaGFyICoqb3V0LCBpbnQgKm91
dGxlbikKK3sKKyAgc2l6ZV90IGxlbiA9IHN0cmxlbihpbik7CiAKLSAgICB1dGlscy0+ZnJlZShF
KTsKLSAgICB1dGlscy0+ZnJlZShGKTsKKyAgaWYgKG91dGxlbiE9TlVMTCkgeworICAgICAgKm91
dGxlbiA9IGxlbjsKKyAgfQogCi0gICAgLyogaW50ZXJsZWF2ZSBoYXNoZXMgaW50byAnaW50ZXIn
ICovCi0gICAgZm9yIChsdXA9MDtsdXA8SEFTSExFTioyO2x1cCsrKQotICAgIHsKLQlpZiAobHVw
JTIgPT0gMCkKLQkgICAgaW50ZXItPmRhdGFbbHVwXT1HLmRhdGFbbHVwLzJdOwotCWVsc2UKLQkg
ICAgaW50ZXItPmRhdGFbbHVwXT1ILmRhdGFbKGx1cC0xKS8yXTsJCQotICAgIH0KKyAgKm91dCA9
IHV0aWxzLT5tYWxsb2MobGVuICsgMSk7CisgIGlmICghKm91dCkgeworICAgICAgcmV0dXJuIFNB
U0xfTk9NRU07CisgIH0KIAotICAgIHJldHVybiBTQVNMX09LOworICBzdHJjcHkoKGNoYXIgKikg
Km91dCwgaW4pOworICByZXR1cm4gU0FTTF9PSzsKIH0KIAogLyogcmV0dXJucyB0aGUgcmVhbG0g
d2Ugc2hvdWxkIHByZXRlbmQgdG8gYmUgaW4gKi8KQEAgLTQ2Niw2OSArNTQ1LDEyMDcgQEAKICAg
ICByZXR1cm4gcmV0OwogfQogCisjZGVmaW5lIE1BWF9CVUZGRVJfTEVOIDIxNDc0ODM2NDMKKyNk
ZWZpbmUgTUFYX1VURjhfTEVOIDY1NTM1CisjZGVmaW5lIE1BWF9PU19MRU4gMjU1CiAKIAorLyoK
KyAqIE1ha2UgYSBTUlAgYnVmZmVyCisgKgorICogaW4xIG11c3QgZXhpc3QgYnV0IHRoZSByZXN0
IG1heSBiZSBOVUxMCisgKgorICovCiBzdGF0aWMgaW50Ci1zZXJ2ZXJfc3RhcnQodm9pZCAqZ2xv
Yl9jb250ZXh0IF9fYXR0cmlidXRlX18oKHVudXNlZCkpLAotICAgICAgICAgICAgIHNhc2xfc2Vy
dmVyX3BhcmFtc190ICpwYXJhbXMsCi0JICAgICBjb25zdCBjaGFyICpjaGFsbGVuZ2UgX19hdHRy
aWJ1dGVfXygodW51c2VkKSksCi0JICAgICBpbnQgY2hhbGxlbiBfX2F0dHJpYnV0ZV9fKCh1bnVz
ZWQpKSwKLQkgICAgIHZvaWQgKipjb25uLAotCSAgICAgY29uc3QgY2hhciAqKmVycnN0cikKK01h
a2VCdWZmZXIoc2FzbF91dGlsc190ICp1dGlscywgCisJICAgY2hhciAqaW4xLCBpbnQgaW4xbGVu
LAorCSAgIGNoYXIgKmluMiwgaW50IGluMmxlbiwKKwkgICBjaGFyICppbjMsIGludCBpbjNsZW4s
CisJICAgY2hhciAqaW40LCBpbnQgaW40bGVuLAorCSAgIGNoYXIgKipvdXQsCisJICAgdW5zaWdu
ZWQgKm91dGxlbikKIHsKLSAgY29udGV4dF90ICp0ZXh0OworICAgIGludCBsZW47CisgICAgaW50
IGluYnl0ZW9yZGVyOwogCi0gIC8qIGhvbGRzIHN0YXRlIGFyZSBpbiAqLwotICBpZiAoIWNvbm4p
Ci0gICAgICByZXR1cm4gU0FTTF9CQURQQVJBTTsKKyAgICBpZiAoIWluMSkgeworCVZMKCgiQXQg
bGVhc3Qgb25lIGJ1ZmZlciBtdXN0IGJlIGFjdGl2ZVxuIikpOworCXJldHVybiBTQVNMX0ZBSUw7
CisgICAgfQogCi0gIC8qIGhvbGRzIHN0YXRlIGFyZSBpbiAqLwotICB0ZXh0ID0gcGFyYW1zLT51
dGlscy0+bWFsbG9jKHNpemVvZihjb250ZXh0X3QpKTsKLSAgaWYgKHRleHQ9PU5VTEwpIHJldHVy
biBTQVNMX05PTUVNOworICAgIGxlbiA9IGluMWxlbiArIGluMmxlbiArIGluM2xlbiArIGluNGxl
bjsKIAotICBtZW1zZXQodGV4dCwgJ1wwJywgc2l6ZW9mKGNvbnRleHRfdCkpOwotICB0ZXh0LT5z
dGF0ZT0xOwotICAqY29ubj10ZXh0OwotICAKLSAgaWYgKGVycnN0cikKLSAgICAgICplcnJzdHIg
PSBOVUxMOworICAgIGlmIChsZW4gPiBNQVhfQlVGRkVSX0xFTikgeworCVZMKCgiU3RyaW5nIHRv
byBsb25nIHRvIGNyZWF0ZSBTUlAgYnVmZmVyIHN0cmluZ1xuIikpOworCXJldHVybiBTQVNMX0ZB
SUw7CisgICAgfQogCi0gIHJldHVybiBTQVNMX09LOwotfQorICAgICpvdXQgPSB1dGlscy0+bWFs
bG9jKGxlbiArIDQpOworICAgIGlmICghKm91dCkgcmV0dXJuIFNBU0xfTk9NRU07CiAKKyAgICAv
KiBwdXQgbGVuZ3RoIGluICovCisgICAgaW5ieXRlb3JkZXIgPSBodG9ubChsZW4pOworICAgIG1l
bWNweSgqb3V0LCAmaW5ieXRlb3JkZXIsIDQpOwogCi1zdGF0aWMgaW50IGJpZ2ludF9mcm9tc3Ry
KHVuc2lnbmVkIGNoYXIgKmRhdGEsIGludCBsZW4sIHNhc2xfdXRpbHNfdCAqdXRpbHMsIG1wel90
IHJldCkKLXsKLSAgICBjaGFyICpzdHI7Ci0gICAgaW50IGx1cDsKKyAgICAvKiBjb3B5IGluIGRh
dGEgKi8KKyAgICBtZW1jcHkoKCpvdXQpKzQsIGluMSwgaW4xbGVuKTsKIAotICAgIG1wel9pbml0
KHJldCk7CisgICAgaWYgKGluMmxlbikKKwltZW1jcHkoKCpvdXQpKzQraW4xbGVuLCBpbjIsIGlu
Mmxlbik7CiAKLSAgICAvKiBjb252ZXJ0IHRvIGJhc2UgMTYgKi8KLSAgICBzdHIgPSAoY2hhciAq
KSB1dGlscy0+bWFsbG9jKGxlbioyKzEwKTsKLSAgICBpZiAoIXN0cikgcmV0dXJuIFNBU0xfTk9N
RU07CisgICAgaWYgKGluM2xlbikKKwltZW1jcHkoKCpvdXQpKzQraW4xbGVuK2luMmxlbiwgaW4z
LCBpbjNsZW4pOwogCi0gICAgZm9yIChsdXA9MDtsdXA8bGVuO2x1cCsrKQotICAgIHsKLQlzdHJb
bHVwKjJdICAgPSBmcm9tYml0cyhkYXRhW2x1cF0gPj4gNCk7Ci0Jc3RyW2x1cCoyKzFdID0gZnJv
bWJpdHMoZGF0YVtsdXBdICYgMTUpOworICAgIGlmIChpbjRsZW4pCisJbWVtY3B5KCgqb3V0KSs0
K2luMWxlbitpbjJsZW4raW4zbGVuLCBpbjQsIGluNGxlbik7CisKKyAgICAqb3V0bGVuID0gbGVu
ICsgNDsKKworICAgIHJldHVybiBTQVNMX09LOworfQorCisvKiBVbididWZmZXInIGEgc3RyaW5n
CisgKgorICogJ291dCcgYmVjb21lcyBhIHBvaW50ZXIgaW50byAnaW4nIG5vdCBhbiBhbGxvY2F0
aW9uCisgKi8KK3N0YXRpYyBpbnQKK1VuQnVmZmVyKGNoYXIgKmluLCBpbnQgaW5sZW4sIGNoYXIg
KipvdXQsIGludCAqb3V0bGVuKQoreworICAgIGludCBsZW5ieXRlb3JkZXI7CisgICAgaW50IGxl
bjsKKworICAgIGlmICgoIWluKSB8fCAoaW5sZW4gPCA0KSkgeworCVZMKCgiQnVmZmVyIGlzIG5v
dCBiaWcgZW5vdWdoIHRvIGJlIFNSUCBidWZmZXI6ICVkXG4iLCBpbmxlbikpOworCXJldHVybiBT
QVNMX0ZBSUw7CisgICAgfQorCisgICAgLyogZ2V0IHRoZSBsZW5ndGggKi8KKyAgICBtZW1jcHko
JmxlbmJ5dGVvcmRlciwgaW4sIDQpOworICAgIGxlbiA9IG50b2hsKGxlbmJ5dGVvcmRlcik7CisK
KyAgICAvKiBtYWtlIHN1cmUgaXQncyByaWdodCAqLworICAgIGlmIChsZW4gKyA0ICE9IGlubGVu
KSB7CisJVkwoKCJTUlAgQnVmZmVyIGlzbid0IG9mIHRoZSByaWdodCBsZW5ndGhcbiIpKTsKKwly
ZXR1cm4gU0FTTF9GQUlMOwogICAgIH0KKworICAgICpvdXQgPSBpbis0OworICAgICpvdXRsZW4g
PSBsZW47CiAgICAgCi0gICAgc3RyW2x1cCoyXT0nXDAnOworICAgIHJldHVybiBTQVNMX09LOwor
fQorCitzdGF0aWMgaW50CitNYWtlVVRGOChzYXNsX3V0aWxzX3QgKnV0aWxzLAorCSBjaGFyICpp
biwKKwkgY2hhciAqKm91dCwKKwkgaW50ICpvdXRsZW4pCit7CisgICAgaW50IGxsZW47CisgICAg
c2hvcnQgbGVuOworICAgIHNob3J0IGluYnl0ZW9yZGVyOworCisgICAgaWYgKCFpbikgeworCVZM
KCgiQ2FuJ3QgY3JlYXRlIHV0Zjggc3RyaW5nIGZyb20gbnVsbCIpKTsKKwlyZXR1cm4gU0FTTF9G
QUlMOworICAgIH0KKworICAgIC8qIHh4eCBhY3R1YWwgdXRmOCBjb252ZXJzaW9uICovCisKKyAg
ICBsbGVuID0gc3RybGVuKGluKTsKKworICAgIGlmIChsbGVuID4gTUFYX1VURjhfTEVOKSB7CisJ
VkwoKCJTdHJpbmcgdG9vIGxvbmcgdG8gY3JlYXRlIHV0Zjggc3RyaW5nXG4iKSk7CisJcmV0dXJu
IFNBU0xfRkFJTDsKKyAgICB9CisgICAgbGVuID0gKHNob3J0KWxsZW47CisKKyAgICAqb3V0ID0g
dXRpbHMtPm1hbGxvYyhsZW4rMik7CisgICAgaWYgKCEqb3V0KSByZXR1cm4gU0FTTF9OT01FTTsK
KworICAgIC8qIHB1dCBpbiBsZW4gKi8KKyAgICBpbmJ5dGVvcmRlciA9IGh0b25zKGxlbik7Cisg
ICAgbWVtY3B5KCpvdXQsICZpbmJ5dGVvcmRlciwgMik7CisKKyAgICAvKiBwdXQgaW4gZGF0YSAq
LworICAgIG1lbWNweSgoKm91dCkrMiwgaW4sIGxlbik7CiAKLSAgICBtcHpfc2V0X3N0ciAocmV0
LCBzdHIsIDE2KTsKKyAgICAqb3V0bGVuID0gbGVuKzI7CisKKyAgICByZXR1cm4gU0FTTF9PSzsK
K30KKworc3RhdGljIGludAorR2V0VVRGOChzYXNsX3V0aWxzX3QgKnV0aWxzLCBjaGFyICpkYXRh
LCBpbnQgZGF0YWxlbiwgY2hhciAqKm91dHN0ciwgY2hhciAqKmxlZnQsIGludCAqbGVmdGxlbikK
K3sKKyAgICBzaG9ydCBsZW5ieXRlb3JkZXI7CisgICAgaW50IGxlbjsKKworICAgIGlmICgoIWRh
dGEpIHx8IChkYXRhbGVuIDwgMikpIHsKKwlWTCgoIkJ1ZmZlciBpcyBub3QgYmlnIGVub3VnaCB0
byBiZSBTUlAgVVRGOFxuIikpOworCXJldHVybiBTQVNMX0ZBSUw7CisgICAgfQorCisgICAgLyog
Z2V0IHRoZSBsZW5ndGggKi8KKyAgICBtZW1jcHkoJmxlbmJ5dGVvcmRlciwgZGF0YSwgMik7Cisg
ICAgbGVuID0gbnRvaHMobGVuYnl0ZW9yZGVyKTsKKworICAgIC8qIG1ha2Ugc3VyZSBpdCdzIHJp
Z2h0ICovCisgICAgaWYgKGxlbiArIDIgPiBkYXRhbGVuKSB7CisJVkwoKCJOb3QgZW5vdWdoIGRh
dGEgZm9yIHRoaXMgU1JQIFVURjhcbiIpKTsKKwlyZXR1cm4gU0FTTF9GQUlMOworICAgIH0KKwor
ICAgICpvdXRzdHIgPSAoY2hhciAqKXV0aWxzLT5tYWxsb2MobGVuKzEpOworICAgIGlmICghKm91
dHN0cikgcmV0dXJuIFNBU0xfTk9NRU07CisKKyAgICBtZW1jcHkoKm91dHN0ciwgZGF0YSsyLCBs
ZW4pOworICAgICgqb3V0c3RyKVtsZW5dID0gJ1wwJzsKKyAgICAKKyAgICAqbGVmdCA9IGRhdGEr
bGVuKzI7CisgICAgKmxlZnRsZW4gPSBkYXRhbGVuIC0gKGxlbisyKTsKIAotICAgIHV0aWxzLT5m
cmVlKHN0cik7CisgICAgcmV0dXJuIFNBU0xfT0s7Cit9CisKK3N0YXRpYyBpbnQKK01ha2VPUyhz
YXNsX3V0aWxzX3QgKnV0aWxzLAorICAgICAgIGNoYXIgKmluLCAKKyAgICAgICBpbnQgaW5sZW4s
CisgICAgICAgY2hhciAqKm91dCwKKyAgICAgICBpbnQgKm91dGxlbikKK3sKKyAgICBpZiAoIWlu
KSB7CisJVkwoKCJDYW4ndCBjcmVhdGUgU1JQIG9zIHN0cmluZyBmcm9tIG51bGwiKSk7CisJcmV0
dXJuIFNBU0xfRkFJTDsKKyAgICB9CisKKyAgICBpZiAoaW5sZW4gPiBNQVhfT1NfTEVOKSB7CisJ
VkwoKCJTdHJpbmcgdG9vIGxvbmcgdG8gY3JlYXRlIFNSUCBvcyBzdHJpbmdcbiIpKTsKKwlyZXR1
cm4gU0FTTF9GQUlMOworICAgIH0KKworICAgICpvdXQgPSB1dGlscy0+bWFsbG9jKGlubGVuKzEp
OworICAgIGlmICghKm91dCkgcmV0dXJuIFNBU0xfTk9NRU07CisKKyAgICAvKiBwdXQgaW4gbGVu
ICovCisgICAgKCpvdXQpWzBdID0gaW5sZW4gJiAweEZGOworCisgICAgLyogcHV0IGluIGRhdGEg
Ki8KKyAgICBtZW1jcHkoKCpvdXQpKzEsIGluLCBpbmxlbik7CisKKyAgICAqb3V0bGVuID0gaW5s
ZW4rMTsKKworICAgIHJldHVybiBTQVNMX09LOworfQorCitzdGF0aWMgaW50CitHZXRPUyhzYXNs
X3V0aWxzX3QgKnV0aWxzLCBjaGFyICpkYXRhLCBpbnQgZGF0YWxlbiwgY2hhciAqKm91dHN0ciwg
aW50ICpvdXRsZW4sIGNoYXIgKipsZWZ0LCBpbnQgKmxlZnRsZW4pCit7CisgICAgaW50IGxlbjsK
KworICAgIGlmICgoIWRhdGEpIHx8IChkYXRhbGVuIDwgMSkpIHsKKwlWTCgoIkJ1ZmZlciBpcyBu
b3QgYmlnIGVub3VnaCB0byBiZSBTUlAgb3NcbiIpKTsKKwlyZXR1cm4gU0FTTF9GQUlMOworICAg
IH0KKworICAgIC8qIGdldCB0aGUgbGVuZ3RoICovCisgICAgbGVuID0gKHVuc2lnbmVkIGNoYXIp
ZGF0YVswXTsKKworICAgIC8qIG1ha2Ugc3VyZSBpdCdzIHJpZ2h0ICovCisgICAgaWYgKGxlbiAr
IDEgPiBkYXRhbGVuKSB7CisJVkwoKCJOb3QgZW5vdWdoIGRhdGEgZm9yIHRoaXMgU1JQIG9zXG4i
KSk7CisJcmV0dXJuIFNBU0xfRkFJTDsKKyAgICB9CisKKyAgICAqb3V0c3RyID0gKGNoYXIgKil1
dGlscy0+bWFsbG9jKGxlbisxKTsKKyAgICBpZiAoISpvdXRzdHIpIHJldHVybiBTQVNMX05PTUVN
OworCisgICAgbWVtY3B5KCpvdXRzdHIsIGRhdGErMSwgbGVuKTsKKyAgICAoKm91dHN0cilbbGVu
XSA9ICdcMCc7CisKKyAgICAqb3V0bGVuID0gbGVuOworICAgIAorICAgICpsZWZ0ID0gZGF0YSts
ZW4rMTsKKyAgICAqbGVmdGxlbiA9IGRhdGFsZW4gLSAobGVuKzEpOworCisgICAgcmV0dXJuIFNB
U0xfT0s7Cit9CisKK3N0YXRpYyBpbnQgCit0b2JpdHMoY2hhciBjKQoreworICAgIGlmICgoaW50
KSBpc2RpZ2l0KGMpKQorCXJldHVybiBjLScwJzsKKworICAgIGlmICgoYz49J2EnKSAmJiAoYzw9
J2YnKSkKKwlyZXR1cm4gYy0nYScrMTA7CisKKyAgICBpZiAoKGM+PSdBJykgJiYgKGM8PSdGJykp
CisJcmV0dXJuIGMtJ0EnKzEwOworCisgICAgcmV0dXJuIDA7Cit9CisKKy8qIENvbnZlcnQgYSBi
aWcgaW50ZWdlciB0byBpdCdzIGJ5dGUgcmVwcmVzZW50YXRpb24KKyAqCisgKgorICovCitzdGF0
aWMgaW50CitCaWdJbnRUb0J5dGVzKG1wel90IG51bSwgY2hhciAqb3V0LCBpbnQgbWF4b3V0bGVu
LCBpbnQgKm91dGxlbikKK3sKKyAgICBjaGFyIGJ1Zls0MDk2XTsKKyAgICBjaGFyICpidWZwID0g
YnVmOworICAgIGludCBsZW47CisgICAgaW50IHByZWZpeGxlbiA9IDA7CisgICAgaW50IGk7CisK
KyAgICBsZW4gPSBtcHpfc2l6ZWluYmFzZSAobnVtLCAxNik7CisKKyAgICBpZiAobGVuID4gbWF4
b3V0bGVuKSByZXR1cm4gU0FTTF9GQUlMOworCisgICAgbXB6X2dldF9zdHIgKGJ1ZiwgMTYsIG51
bSk7CisKKyAgICBpZiAobGVuJTIhPTApIHsKKwlvdXRbMF09dG9iaXRzKCpidWZwKTsKKwlidWZw
Kys7CisJbGVuLS07CisJcHJlZml4bGVuPTE7CisgICAgfQorCisgICAgZm9yIChpPTA7IGk8IGxl
bi8yOyBpKysgKQorICAgIHsKKwlvdXRbcHJlZml4bGVuK2ldID0gKHRvYml0cygqYnVmcCkgPDwg
NCk7CisJYnVmcCsrOworCW91dFtwcmVmaXhsZW4raV0gfD0gdG9iaXRzKCpidWZwKTsKKwlidWZw
Kys7CisgICAgfQorCisgICAgKm91dGxlbiA9IHByZWZpeGxlbisobGVuLzIpOworCisgICAgcmV0
dXJuIFNBU0xfT0s7ICAgIAorfQorCitzdGF0aWMgaW50CitNYWtlTVBJKHNhc2xfdXRpbHNfdCAq
dXRpbHMsCisJbXB6X3QgbnVtLAorCWNoYXIgKipvdXQsCisJaW50ICpvdXRsZW4pCit7CisgICAg
aW50IHNob3J0bGVuOworICAgIGludCBsZW47CisgICAgc2hvcnQgaW5ieXRlb3JkZXI7CisgICAg
aW50IGFsbG9jbGVuOworICAgIGludCByOworCisgICAgYWxsb2NsZW4gPSBtcHpfc2l6ZWluYmFz
ZSAobnVtLCAxNik7CisgICAKKyAgICAqb3V0ID0gdXRpbHMtPm1hbGxvYyhhbGxvY2xlbisyKTsK
KyAgICBpZiAoISpvdXQpIHJldHVybiBTQVNMX05PTUVNOworCisgICAgciA9IEJpZ0ludFRvQnl0
ZXMobnVtLCAoKm91dCkrMiwgYWxsb2NsZW4sICZsZW4pOworICAgIGlmIChyKSB7CisJdXRpbHMt
PmZyZWUoKm91dCk7CisJcmV0dXJuIHI7CisgICAgfQorCisgICAgKm91dGxlbiA9IDIrbGVuOwor
CisgICAgLyogcHV0IGluIGxlbiAqLworICAgIHNob3J0bGVuID0gbGVuOworICAgIGluYnl0ZW9y
ZGVyID0gaHRvbnMoc2hvcnRsZW4pOworICAgIG1lbWNweSgqb3V0LCAmaW5ieXRlb3JkZXIsIDIp
OworCisgICAgcmV0dXJuIFNBU0xfT0s7Cit9CisKK3N0YXRpYyBjaGFyIAorZnJvbWJpdHModW5z
aWduZWQgaW50IGkpCit7CisgICAgYXNzZXJ0KGkgPD0gMTUpOworCisgICAgaWYgKGk8PTkpIHJl
dHVybiAnMCcraTsKKworICAgIHJldHVybiAnYScrIChpLTEwKTsKK30KKworc3RhdGljIHZvaWQK
K0RhdGFUb0JpZ0ludCh1bnNpZ25lZCBjaGFyICppbiwgaW50IGlubGVuLCBtcHpfdCAqb3V0bnVt
KQoreworICAgIGludCBpOworICAgIGNoYXIgYnVmWzQwOTZdOworCisgICAgbXB6X2luaXQoKm91
dG51bSk7ICAgIAorCisgICAgbWVtc2V0KGJ1ZiwgJ1wwJywgc2l6ZW9mKGJ1ZikpOworCisgICAg
Zm9yIChpID0gMDsgaSA8IGlubGVuOyBpKyspIAorICAgIHsKKwlidWZbaSoyXSAgID0gZnJvbWJp
dHMoaW5baV0gPj4gNCk7CisJYnVmW2kqMisxXSA9IGZyb21iaXRzKGluW2ldICYgMTUpOworICAg
IH0KKyAgICAKKyAgICBtcHpfc2V0X3N0ciAoKm91dG51bSwgYnVmLCAxNik7Cit9CisKK3N0YXRp
YyBpbnQKK0dldE1QSSh1bnNpZ25lZCBjaGFyICpkYXRhLCBpbnQgZGF0YWxlbiwgbXB6X3QgKm91
dG51bSwgY2hhciAqKmxlZnQsIGludCAqbGVmdGxlbikKK3sKKworCisgICAgc2hvcnQgbGVuYnl0
ZW9yZGVyOworICAgIGludCBsZW47CisKKyAgICBpZiAoKCFkYXRhKSB8fCAoZGF0YWxlbiA8IDIp
KSB7CisJVkwoKCJCdWZmZXIgaXMgbm90IGJpZyBlbm91Z2ggdG8gYmUgU1JQIE1QSTogJWRcbiIs
IGRhdGFsZW4pKTsKKwlyZXR1cm4gU0FTTF9GQUlMOworICAgIH0KKworICAgIC8qIGdldCB0aGUg
bGVuZ3RoICovCisgICAgbWVtY3B5KCZsZW5ieXRlb3JkZXIsIGRhdGEsIDIpOworICAgIGxlbiA9
IG50b2hzKGxlbmJ5dGVvcmRlcik7CisKKyAgICAvKiBtYWtlIHN1cmUgaXQncyByaWdodCAqLwor
ICAgIGlmIChsZW4gKyAyID4gZGF0YWxlbikgeworCVZMKCgiTm90IGVub3VnaCBkYXRhIGZvciB0
aGlzIFNSUCBNUEk6IHdlIGhhdmUgJWQ7IGl0IHNheSBpdCdzICVkXG4iLGRhdGFsZW4sIGxlbisy
KSk7CisJcmV0dXJuIFNBU0xfRkFJTDsKKyAgICB9CisKKyAgICBEYXRhVG9CaWdJbnQoZGF0YSsy
LCBsZW4sIG91dG51bSk7CisKKyAgICAqbGVmdCA9IGRhdGErbGVuKzI7CisgICAgKmxlZnRsZW4g
PSBkYXRhbGVuIC0gKGxlbisyKTsKKworICAgIHJldHVybiBTQVNMX09LOworfQorCitzdGF0aWMg
dm9pZAorR2V0UmFuZEJpZ0ludChtcHpfdCBvdXQpCit7CisgICAgbXB6X2luaXQob3V0KTsKKwor
ICAgIC8qIHh4eCBsaWtlbHkgc2hvdWxkIHVzZSBzYXNsIHJhbmRvbSBmdW5jcyAqLworICAgIG1w
el9yYW5kb20ob3V0LCBCSVRTRk9SYWIvKDgqc2l6ZW9mKGludCkpKTsKK30KKworLyogQ2FsbCB0
aGUgaGFzaCBmdW5jdGlvbiBvbiB0aGUgZGF0YSBvZiBhIEJpZ0ludAorICoKKyAqLworc3RhdGlj
IHZvaWQKK0hhc2hEYXRhKHNhc2xfdXRpbHNfdCAqdXRpbHMsIGNoYXIgKmluLCBpbnQgaW5sZW4s
IHVuc2lnbmVkIGNoYXIgb3V0aGFzaFsxNl0pCit7CisgICAgTUQ1X0NUWCBtZDVjdHg7CisKKyAg
ICB1dGlscy0+TUQ1SW5pdCgmbWQ1Y3R4KTsKKyAgICB1dGlscy0+TUQ1VXBkYXRlKCZtZDVjdHgs
IGluLCBpbmxlbik7CisgICAgdXRpbHMtPk1ENUZpbmFsKG91dGhhc2gsICZtZDVjdHgpOworfQor
CisvKiBDYWxsIHRoZSBoYXNoIGZ1bmN0aW9uIG9uIHRoZSBkYXRhIG9mIGEgQmlnSW50CisgKgor
ICovCitzdGF0aWMgaW50CitIYXNoQmlnSW50KHNhc2xfdXRpbHNfdCAqdXRpbHMsIG1wel90IGlu
LCB1bnNpZ25lZCBjaGFyIG91dGhhc2hbMTZdKQoreworICAgIGludCByOworICAgIGNoYXIgYnVm
WzQwOTZdOworICAgIGludCBidWZsZW47CisgICAgTUQ1X0NUWCBtZDVjdHg7CisgICAgCisgICAg
ciA9IEJpZ0ludFRvQnl0ZXMoaW4sIGJ1Ziwgc2l6ZW9mKGJ1ZiktMSwgJmJ1Zmxlbik7CisgICAg
aWYgKHIpIHJldHVybiByOworCisgICAgdXRpbHMtPk1ENUluaXQoJm1kNWN0eCk7CisgICAgdXRp
bHMtPk1ENVVwZGF0ZSgmbWQ1Y3R4LCBidWYsIGJ1Zmxlbik7CisgICAgdXRpbHMtPk1ENUZpbmFs
KG91dGhhc2gsICZtZDVjdHgpOworCisgICAgcmV0dXJuIDA7Cit9CisKK3N0YXRpYyBpbnQKK0hh
c2hJbnRlcmxlYXZlQmlnSW50KHNhc2xfdXRpbHNfdCAqdXRpbHMsIG1wel90IG51bSwgY2hhciAq
Km91dCwgaW50ICpvdXRsZW4pCit7CisgICAgaW50IHI7CisgICAgY2hhciBidWZbNDA5Nl07Cisg
ICAgaW50IGJ1ZmxlbjsKKworICAgIGludCBrbGVuOworICAgIGludCBsaW1pdDsKKyAgICBpbnQg
aTsKKyAgICBpbnQgb2Zmc2V0OworICAgIGludCBqOworICAgIE1ENV9DVFggbWRFdmVuOworICAg
IE1ENV9DVFggbWRPZGQ7CisgICAgdW5zaWduZWQgY2hhciBFdmVuYlsxNl07CisgICAgdW5zaWdu
ZWQgY2hhciBPZGRiWzE2XTsKKworICAgIC8qIG1ha2UgYmlnaW50IGludG8gYnl0ZXMgKi8KKyAg
ICByID0gQmlnSW50VG9CeXRlcyhudW0sIGJ1Ziwgc2l6ZW9mKGJ1ZiktMSwgJmJ1Zmxlbik7Cisg
ICAgaWYgKHIpIHJldHVybiByOworCisgICAgbGltaXQgPSBidWZsZW47CisKKyAgICAvKiBza2lw
IGJ5IGxlYWRpbmcgemVybydzICovCisgICAgZm9yIChvZmZzZXQgPSAwOyBvZmZzZXQgPCBsaW1p
dCAmJiBidWZbb2Zmc2V0XSA9PSAweDAwOyBvZmZzZXQrKykgeworCS8qIG5hZGEgKi8KKyAgICB9
CisJCisgICAga2xlbiA9IChsaW1pdCAtIG9mZnNldCkgLyAyOworCisgICAgdXRpbHMtPk1ENUlu
aXQoJm1kRXZlbik7CisgICAgdXRpbHMtPk1ENUluaXQoJm1kT2RkKTsKKworICAgIGogPSBsaW1p
dCAtIDE7CisgICAgZm9yIChpID0gMDsgaSA8IGtsZW47IGkrKykgeworCXV0aWxzLT5NRDVVcGRh
dGUoJm1kRXZlbiwgYnVmICsgaiwgMSk7CisJai0tOworCXV0aWxzLT5NRDVVcGRhdGUoJm1kT2Rk
LCBidWYgKyBqLCAxKTsKKwlqLS07CisgICAgfQorCisgICAgdXRpbHMtPk1ENUZpbmFsKEV2ZW5i
LCAmbWRFdmVuKTsKKyAgICB1dGlscy0+TUQ1RmluYWwoT2RkYiwgJm1kT2RkKTsKKworICAgICpv
dXQgPSB1dGlscy0+bWFsbG9jKDMyKTsKKyAgICBpZiAoISpvdXQpIHJldHVybiBTQVNMX05PTUVN
OworICAgICpvdXRsZW4gPSAzMjsKKyAgICAgIAorICAgIGZvciAoaSA9IDAsIGogPSAwOyBpIDwg
MTY7IGkrKykKKyAgICB7CisJKCpvdXQpW2orK10gPSBFdmVuYltpXTsKKwkoKm91dClbaisrXSA9
IE9kZGJbaV07CisgICAgfQorCisgICAgcmV0dXJuIFNBU0xfT0s7Cit9CisKK3N0YXRpYyB2b2lk
CitQcmludEJpZ0ludChjaGFyICpzdHIsIG1wel90IG51bSkKK3sKKyAgICBjaGFyIGJ1Zls0MDk2
XTsKKworICAgIG1wel9nZXRfc3RyIChidWYsIDEwLCBudW0pOworCisgICAgVkwoKCIlcyBCaWcg
SW50IGlzICVzXG4iLHN0ciwgYnVmKSk7CisKK30KKworLyoKKyAqIENhbGN1bGF0ZSAneCcgd2hp
Y2ggaXMgbmVlZGVkIHRvIGNhbGN1bGF0ZSAnSycKKyAqCisgKi8KK3N0YXRpYyBpbnQKK0NhbGN1
bGF0ZVgoc2FzbF91dGlsc190ICp1dGlscywKKwkgICBjb25zdCBjaGFyICpzYWx0LCAKKwkgICBp
bnQgc2FsdGxlbiwgCisJICAgY29uc3QgY2hhciAqdXNlciwgCisJICAgY29uc3QgY2hhciAqcGFz
cywgCisJICAgaW50IHBhc3NsZW4sIAorCSAgIG1wel90ICp4KQoreworICAgIE1ENV9DVFggbWQ1
Y3R4OworICAgIGNoYXIgaGFzaFsxNl07IC8qIHh4eCAqLworCisgICAgLyogeCA9IEgoc2FsdCB8
IHVzZXIgfCAnOicgfCBwYXNzKQorICAgICAqCisgICAgICovICAgICAgCisKKyAgICB1dGlscy0+
TUQ1SW5pdCgmbWQ1Y3R4KTsKKworICAgIHV0aWxzLT5NRDVVcGRhdGUoJm1kNWN0eCwgc2FsdCwg
c2FsdGxlbik7CisKKyAgICB1dGlscy0+TUQ1VXBkYXRlKCZtZDVjdHgsIHVzZXIsIHN0cmxlbih1
c2VyKSk7CisgICAgdXRpbHMtPk1ENVVwZGF0ZSgmbWQ1Y3R4LCAiOiIsIDEpOworICAgIHV0aWxz
LT5NRDVVcGRhdGUoJm1kNWN0eCwgcGFzcywgcGFzc2xlbik7CisKKyAgICB1dGlscy0+TUQ1Rmlu
YWwoaGFzaCwgJm1kNWN0eCk7CisKKyAgICBEYXRhVG9CaWdJbnQoaGFzaCwgMTYsIHgpOworCisg
ICAgcmV0dXJuIFNBU0xfT0s7Cit9CisKKy8qIENhbGN1bGF0ZSBzaGFyZWQgY29udGV4dCBrZXkg
SworICoKKyAqIFVzZXI6ICB4ID0gSChzLCBwYXNzd29yZCkKKyAqIFVzZXI6ICBTID0gKEIgLSBn
XngpIF4gKGEgKyB1eCkKKyAqICAgICAgICAgICAgICAgICAgCisgKiBVc2VyOiAgSyA9IEgoUykK
KyAqCisgKi8KK3N0YXRpYyBpbnQKK0NhbGN1bGF0ZUtfY2xpZW50KHNhc2xfdXRpbHNfdCAqdXRp
bHMsCisJCSAgY2hhciAqc2FsdCwKKwkJICBpbnQgc2FsdGxlbiwKKwkJICBjb250ZXh0X3QgKnRl
eHQsCisJCSAgY2hhciAqdXNlciwKKwkJICBjaGFyICpwYXNzLAorCQkgIGludCBwYXNzbGVuLAor
CQkgIGNoYXIgKiprZXksCisJCSAgaW50ICprZXlsZW4pCit7CisgICAgaW50IHI7CisgICAgdW5z
aWduZWQgY2hhciBoYXNoWzE2XTsKKyAgICBtcHpfdCB4OworICAgIG1wel90IHU7CisgICAgbXB6
X3QgYXV4OworICAgIG1wel90IGd4OworICAgIG1wel90IGJhc2U7CisgICAgbXB6X3QgUzsKKwor
ICAgIHIgPSBDYWxjdWxhdGVYKHV0aWxzLCBzYWx0LCBzYWx0bGVuLCB1c2VyLCBwYXNzLCBwYXNz
bGVuLCAmeCk7CisgICAgaWYgKHIpIHJldHVybiByOworCisgICAgLyogZ3ggPSBnXnggKi8KKyAg
ICBtcHpfaW5pdChneCk7CisgICAgbXB6X3Bvd20gKGd4LCB0ZXh0LT5nLCB4LCB0ZXh0LT5OKTsK
KworICAgIC8qIGJhc2UgPSBCIC0gZ3ggKi8KKyAgICBtcHpfaW5pdChiYXNlKTsKKyAgICBtcHpf
c3ViKGJhc2UsIHRleHQtPkIsIGd4KTsKKworICAgIC8qIHUgaXMgZmlyc3QgMzIgYml0cyBvZiBC
IGhhc2hlZDsgTVNCIGZpcnN0ICovCisgICAgciA9IEhhc2hCaWdJbnQodXRpbHMsIHRleHQtPkIs
IGhhc2gpOworICAgIGlmIChyKSByZXR1cm4gcjsKKyAgICBtcHpfaW5pdCh1KTsKKyAgICBEYXRh
VG9CaWdJbnQoaGFzaCwgNCwgJnUpOworCisgICAgLyogYSArIHV4ICovCisgICAgbXB6X2luaXQo
YXV4KTsKKyAgICBtcHpfbXVsKGF1eCwgdSwgeCk7CisgICAgbXB6X2FkZChhdXgsIGF1eCwgdGV4
dC0+YSk7CisKKyAgICAvKiBTID0gYmFzZV5hdXggJSBOICovCisgICAgbXB6X2luaXQoUyk7Cisg
ICAgbXB6X3Bvd20gKFMsIGJhc2UsIGF1eCwgdGV4dC0+Tik7ICAgIAorCisgICAgLyogSyA9IEhp
KFMpICovCisgICAgciA9IEhhc2hJbnRlcmxlYXZlQmlnSW50KHV0aWxzLCBTLCBrZXksIGtleWxl
bik7CisgICAgaWYgKHIpIHJldHVybiByOworCisgICAgcmV0dXJuIFNBU0xfT0s7Cit9CisKKwor
CisvKgorICogIEgoCisgKiAgICAgICAgICAgIGJ5dGVzKEgoIGJ5dGVzKE4pICkpIF4gYnl0ZXMo
IEgoIGJ5dGVzKGcpICkpKQorICogICAgICAgICAgfCBieXRlcyhIKCBieXRlcyhVKSApKQorICog
ICAgICAgICAgfCBieXRlcyhzKQorICogICAgICAgICAgfCBieXRlcyhIKCBieXRlcyhMKSApKQor
ICogICAgICAgICAgfCBieXRlcyhBKQorICogICAgICAgICAgfCBieXRlcyhCKQorICogICAgICAg
ICAgfCBieXRlcyhLKQorICogICAgICApCisgKgorICogSCgpIGlzIHRoZSByZXN1bHQgb2YgZGln
ZXN0aW5nIHRoZSBkZXNpZ25hdGVkIGlucHV0L2RhdGEgd2l0aCB0aGUKKyAqIHVuZGVybHlpbmcg
TWVzc2FnZSBEaWdlc3QgQWxnb3JpdGhtIGZ1bmN0aW9uIChzZWUgU2VjdGlvbiAxKS4KKyAqCisg
KiBeIGlzIHRoZSBiaXR3aXNlIFhPUiBvcGVyYXRvci4KKyAqLworc3RhdGljIGludAorQ2FsY3Vs
YXRlTTEoc2FzbF91dGlsc190ICp1dGlscywKKwkgICAgbXB6X3QgTiwKKwkgICAgbXB6X3QgZywK
KwkgICAgY2hhciAqVSwgICAgIC8qIHVzZXJuYW1lICovCisJICAgIGNoYXIgKnNhbHQsIGludCBz
YWx0bGVuLCAgLyogc2FsdCAqLworCSAgICBjaGFyICpMLCAgICAgLyogc2VydmVyJ3Mgb3B0aW9u
cyAqLworCSAgICBtcHpfdCBBLCAgICAgLyogY2xpZW50J3MgcHVibGljIGtleSAqLworCSAgICBt
cHpfdCBCLCAgICAgLyogc2VydmVyJ3MgcHVibGljIGtleSAqLworCSAgICBjaGFyICpLLCBpbnQg
S2xlbiwKKwkgICAgY2hhciAqKm91dCwgaW50ICpvdXRsZW4pCit7CisgICAgaW50IGk7CisgICAg
aW50IHI7CisgICAgdW5zaWduZWQgY2hhciBwMWFbMTZdOworICAgIHVuc2lnbmVkIGNoYXIgcDFi
WzE2XTsKKyAgICB1bnNpZ25lZCBjaGFyIHAxWzE2XTsKKyAgICBpbnQgcDFsZW47CisgICAgY2hh
ciBwMlsxNl07CisgICAgaW50IHAybGVuOworICAgIGNoYXIgKnAzOworICAgIGludCBwM2xlbjsK
KyAgICBjaGFyIHA0WzE2XTsKKyAgICBpbnQgcDRsZW47CisgICAgY2hhciBwNVsxMDI0XTsKKyAg
ICBpbnQgcDVsZW47CisgICAgY2hhciBwNlsxMDI0XTsKKyAgICBpbnQgcDZsZW47CisgICAgY2hh
ciAqcDc7CisgICAgaW50IHA3bGVuOworICAgIGNoYXIgKnRvdDsKKyAgICBpbnQgdG90bGVuID0g
MDsKKyAgICBjaGFyICp0b3RwOworCisgICAgLyogcDEpIGJ5dGVzKEgoIGJ5dGVzKE4pICkpIF4g
Ynl0ZXMoIEgoIGJ5dGVzKGcpICkpICovCisgICAgciA9IEhhc2hCaWdJbnQodXRpbHMsIE4sIHAx
YSk7CisgICAgaWYgKHIpIHJldHVybiByOworICAgIHIgPSBIYXNoQmlnSW50KHV0aWxzLCBnLCBw
MWIpOworICAgIGlmIChyKSByZXR1cm4gcjsKKworICAgIGZvciAoaSA9IDA7IGkgPCAxNjsgaSsr
KSB7CisJcDFbaV0gPSAocDFhW2ldIF4gcDFiW2ldKTsKKyAgICB9CisgICAgcDFsZW4gPSAxNjsK
KworICAgIC8qIHAyKSBieXRlcyhIKCBieXRlcyhVKSApKSAqLworICAgIEhhc2hEYXRhKHV0aWxz
LCBVLCBzdHJsZW4oVSksIHAyKTsKKyAgICBwMmxlbiA9IDE2OworCisgICAgLyogcDMpIGJ5dGVz
KHMpICovCisgICAgcDMgPSBzYWx0OworICAgIHAzbGVuID0gc2FsdGxlbjsKKworICAgIC8qIHA0
KSBieXRlcyhIKCBieXRlcyhMKSApKSAqLworICAgIEhhc2hEYXRhKHV0aWxzLCBMLCBzdHJsZW4o
TCksIHA0KTsKKyAgICBwNGxlbiA9IDE2OworCisgICAgLyogcDUpIGJ5dGVzKEEpICovCisgICAg
ciA9IEJpZ0ludFRvQnl0ZXMoQSwgcDUsIHNpemVvZihwNSksICZwNWxlbik7CisgICAgaWYgKHIp
IHJldHVybiByOworICAgIAorICAgIC8qIHA2KSBieXRlcyhCKSAqLworICAgIHIgPSBCaWdJbnRU
b0J5dGVzKEIsIHA2LCBzaXplb2YocDYpLCAmcDZsZW4pOworICAgIGlmIChyKSByZXR1cm4gcjsK
KworICAgIC8qIHA3KSBieXRlcyhLKSAqLworICAgIHA3ID0gSzsKKyAgICBwN2xlbiA9IEtsZW47
CisKKyAgICAvKiBtZXJnZSBwMS1wNyB0b2dldGhlciAqLworICAgIHRvdGxlbiA9IHAxbGVuICsg
cDJsZW4gKyBwM2xlbiArIHA0bGVuICsgcDVsZW4gKyBwNmxlbiArIHA3bGVuOworICAgIHRvdCA9
IHV0aWxzLT5tYWxsb2ModG90bGVuKTsKKyAgICBpZiAoIXRvdCkgcmV0dXJuIFNBU0xfTk9NRU07
CisKKyAgICB0b3RwID0gdG90OworCisgICAgbWVtY3B5KHRvdHAsIHAxLCBwMWxlbik7IHRvdHAr
PXAxbGVuOworICAgIG1lbWNweSh0b3RwLCBwMiwgcDJsZW4pOyB0b3RwKz1wMmxlbjsKKyAgICBt
ZW1jcHkodG90cCwgcDMsIHAzbGVuKTsgdG90cCs9cDNsZW47CisgICAgbWVtY3B5KHRvdHAsIHA0
LCBwNGxlbik7IHRvdHArPXA0bGVuOworICAgIG1lbWNweSh0b3RwLCBwNSwgcDVsZW4pOyB0b3Rw
Kz1wNWxlbjsKKyAgICBtZW1jcHkodG90cCwgcDYsIHA2bGVuKTsgdG90cCs9cDZsZW47CisgICAg
bWVtY3B5KHRvdHAsIHA3LCBwN2xlbik7IHRvdHArPXA3bGVuOworCisgICAgLyogZG8gdGhlIGhh
c2ggb3ZlciB0aGUgd2hvbGUgdGhpbmcgKi8KKyAgICAqb3V0ID0gdXRpbHMtPm1hbGxvYygxNik7
CisgICAgaWYgKCEqb3V0KSB7CisJdXRpbHMtPmZyZWUodG90KTsKKwlyZXR1cm4gU0FTTF9OT01F
TTsKKyAgICB9CisgICAgKm91dGxlbiA9IDE2OworCisgICAgSGFzaERhdGEodXRpbHMsIHRvdCwg
dG90bGVuLCAqb3V0KTsKKyAgICB1dGlscy0+ZnJlZSh0b3QpOworCisgICAgcmV0dXJuIFNBU0xf
T0s7Cit9CisKKy8qCisgKiAgICAgICAgICBIKAorICogICAgICAgICAgICAgICAgICBieXRlcyhB
KQorICogICAgICAgICAgICAgICAgfCBieXRlcyhIKCBieXRlcyhVKSApKQorICogICAgICAgICAg
ICAgICAgfCBieXRlcyhIKCBieXRlcyhJKSApKQorICogICAgICAgICAgICAgICAgfCBieXRlcyhI
KCBieXRlcyhvKSApKQorICogICAgICAgICAgICAgICAgfCBieXRlcyhNMSkKKyAqICAgICAgICAg
ICAgICAgIHwgYnl0ZXMoSykKKyAqICAgICAgICAgICAgKQorICoKKyAqCisgKndoZXJlOiAKKyAq
CisgKiBIKCkgaXMgdGhlIHJlc3VsdCBvZiBkaWdlc3RpbmcgdGhlIGRlc2lnbmF0ZWQgaW5wdXQv
ZGF0YSB3aXRoIHRoZQorICogdW5kZXJseWluZyBNZXNzYWdlIERpZ2VzdCBBbGdvcml0aG0gZnVu
Y3Rpb24gKHNlZSBTZWN0aW9uIDEpCisgKgorICovCitzdGF0aWMgaW50CitDYWxjdWxhdGVNMihz
YXNsX3V0aWxzX3QgKnV0aWxzLAorCSAgICBtcHpfdCBBLAorCSAgICBjaGFyICpVLAorCSAgICBj
aGFyICpJLAorCSAgICBjaGFyICpvLAorCSAgICBjaGFyICpNMSwgaW50IE0xbGVuLAorCSAgICBj
aGFyICpLLCBpbnQgS2xlbiwKKwkgICAgY2hhciAqKm91dCwgaW50ICpvdXRsZW4pCit7CisgICAg
aW50IHI7CisgICAgdW5zaWduZWQgY2hhciBwMVsxMDI0XTsKKyAgICBpbnQgcDFsZW47CisgICAg
Y2hhciBwMlsxNl07CisgICAgaW50IHAybGVuOworICAgIGNoYXIgcDNbMTZdOworICAgIGludCBw
M2xlbjsKKyAgICBjaGFyIHA0WzE2XTsKKyAgICBpbnQgcDRsZW47CisgICAgY2hhciAqcDU7Cisg
ICAgaW50IHA1bGVuOworICAgIGNoYXIgKnA2OworICAgIGludCBwNmxlbjsKKyAgICBjaGFyICp0
b3Q7CisgICAgaW50IHRvdGxlbiA9IDA7CisgICAgY2hhciAqdG90cDsKKworICAgIC8qIHAxKSBi
eXRlcyhBKSAqLworICAgIHIgPSBCaWdJbnRUb0J5dGVzKEEsIHAxLCBzaXplb2YocDEpLCAmcDFs
ZW4pOworICAgIGlmIChyKSByZXR1cm4gcjsgICAgCisKKyAgICAvKiBwMikgYnl0ZXMoSCggYnl0
ZXMoVSkgKSkgKi8KKyAgICBIYXNoRGF0YSh1dGlscywgVSwgc3RybGVuKFUpLCBwMik7CisgICAg
cDJsZW4gPSAxNjsKKworICAgIC8qIHAzKSBieXRlcyhIKCBieXRlcyhJKSApKSAqLworICAgIEhh
c2hEYXRhKHV0aWxzLCBJLCBzdHJsZW4oSSksIHAzKTsKKyAgICBwM2xlbiA9IDE2OworCisgICAg
LyogcDQpIGJ5dGVzKEgoIGJ5dGVzKG8pICkpICovCisgICAgSGFzaERhdGEodXRpbHMsIG8sIHN0
cmxlbihvKSwgcDQpOworICAgIHA0bGVuID0gMTY7CisKKyAgICAvKiBwNSkgIGJ5dGVzKE0xKSAq
LworICAgIHA1ID0gTTE7CisgICAgcDVsZW4gPSBNMWxlbjsKKyAgICAKKyAgICAvKiBieXRlcyhL
KSAqLworICAgIHA2ID0gSzsKKyAgICBwNmxlbiA9IEtsZW47CisJCisgICAgLyogbWVyZ2UgcDEt
cDYgdG9nZXRoZXIgKi8KKyAgICB0b3RsZW4gPSBwMWxlbiArIHAybGVuICsgcDNsZW4gKyBwNGxl
biArIHA1bGVuICsgcDZsZW47CisgICAgdG90ID0gdXRpbHMtPm1hbGxvYyh0b3RsZW4pOworICAg
IGlmICghdG90KSByZXR1cm4gU0FTTF9OT01FTTsKKworICAgIHRvdHAgPSB0b3Q7CisKKyAgICBt
ZW1jcHkodG90cCwgcDEsIHAxbGVuKTsgdG90cCs9cDFsZW47CisgICAgbWVtY3B5KHRvdHAsIHAy
LCBwMmxlbik7IHRvdHArPXAybGVuOworICAgIG1lbWNweSh0b3RwLCBwMywgcDNsZW4pOyB0b3Rw
Kz1wM2xlbjsKKyAgICBtZW1jcHkodG90cCwgcDQsIHA0bGVuKTsgdG90cCs9cDRsZW47CisgICAg
bWVtY3B5KHRvdHAsIHA1LCBwNWxlbik7IHRvdHArPXA1bGVuOworICAgIG1lbWNweSh0b3RwLCBw
NiwgcDZsZW4pOyB0b3RwKz1wNmxlbjsKKworICAgIC8qIGRvIHRoZSBoYXNoIG92ZXIgdGhlIHdo
b2xlIHRoaW5nICovCisgICAgKm91dCA9IHV0aWxzLT5tYWxsb2MoMTYpOworICAgIGlmICghKm91
dCkgeworCXJldHVybiBTQVNMX05PTUVNOworCXV0aWxzLT5mcmVlKHRvdCk7CisgICAgfQorICAg
ICpvdXRsZW4gPSAxNjsKKworICAgIEhhc2hEYXRhKHV0aWxzLCB0b3QsIHRvdGxlbiwgKm91dCk7
CisgICAgdXRpbHMtPmZyZWUodG90KTsKKworICAgIHJldHVybiBTQVNMX09LOworfQorCisvKiBQ
YXJzZSBhbiBvcHRpb24gb3V0IG9mIGFuIG9wdGlvbiBzdHJpbmcKKyAqIFBsYWNlIGZvdW5kIG9w
dGlvbiBpbiAnb3B0aW9uJworICogJ25leHRwdHInIHBvaW50cyB0byByZXN0IG9mIHN0cmluZyBv
ciBOVUxMIGlmIGF0IGVuZAorICovCitzdGF0aWMgaW50CitQYXJzZU9wdGlvbihzYXNsX3V0aWxz
X3QgKnV0aWxzLCBjaGFyICppbiwgY2hhciAqKm9wdGlvbiwgY2hhciAqKm5leHRwdHIpCit7Cisg
ICAgY2hhciAqY29tbWE7CisgICAgaW50IGxlbjsKKyAgICBpbnQgaTsKKworICAgIGlmIChzdHJs
ZW4oaW4pID09IDApIHsKKwkqb3B0aW9uID0gTlVMTDsKKwlyZXR1cm4gU0FTTF9PSzsKKyAgICB9
CisKKyAgICBjb21tYSA9IHN0cmNocihpbiwnLCcpOyAgICAKKyAgICBpZiAoY29tbWEgPT0gTlVM
TCkgY29tbWEgPSBpbiArIHN0cmxlbihpbik7CisKKyAgICBsZW4gPSBjb21tYSAtIGluOworCisg
ICAgKm9wdGlvbiA9IHV0aWxzLT5tYWxsb2MobGVuICsgMSk7CisgICAgaWYgKCEqb3B0aW9uKSBy
ZXR1cm4gU0FTTF9OT01FTTsKKworICAgIC8qIGxvd2VyY2FzZSBzdHJpbmcgKi8KKyAgICBmb3Ig
KGkgPSAwOyBpIDwgbGVuOyBpKyspIHsKKwkoKm9wdGlvbilbaV0gPSB0b2xvd2VyKChpbnQpaW5b
aV0pOworICAgIH0KKyAgICAoKm9wdGlvbilbbGVuXSA9ICdcMCc7CisKKyAgICBpZiAoKmNvbW1h
KSB7CisJKm5leHRwdHIgPSBjb21tYSsxOworICAgIH0gZWxzZSB7CisJKm5leHRwdHIgPSBOVUxM
OworICAgIH0KKworICAgIHJldHVybiBTQVNMX09LOworfQorCitzdGF0aWMgaW50CitGaW5kQml0
KGNoYXIgKm5hbWUsIGxheWVyX29wdGlvbl90ICpvcHRzKQoreworICAgIHdoaWxlIChvcHRzLT5u
YW1lKSB7CisJVkwoKCJMb29raW5nIGZvciBbJXNdIHRoaXMgaXMgWyVzXVxuIixuYW1lLG9wdHMt
Pm5hbWUpKTsKKwlpZiAoc3RyY21wKG5hbWUsIG9wdHMtPm5hbWUpPT0wKSB7CisJICAgIHJldHVy
biBvcHRzLT5iaXQ7CisJfQorCisJb3B0cysrOworICAgIH0KKworICAgIHJldHVybiAwOworfQor
CitzdGF0aWMgbGF5ZXJfb3B0aW9uX3QgKgorRmluZE9wdGlvbkZyb21CaXQoaW50IGJpdCwgbGF5
ZXJfb3B0aW9uX3QgKm9wdHMpCit7CisgICAgd2hpbGUgKG9wdHMtPm5hbWUpIHsKKwlpZiAob3B0
cy0+Yml0ID09IGJpdCkgeworCSAgICByZXR1cm4gb3B0czsKKwl9CisKKwlvcHRzKys7CisgICAg
fQorCisgICAgcmV0dXJuIE5VTEw7Cit9CisKK3N0YXRpYyBpbnQKK1BhcnNlT3B0aW9uU3RyaW5n
KGNoYXIgKnN0ciwgc3JwX29wdGlvbnNfdCAqb3B0cykKK3sKKyAgICBpZiAoc3RyY21wKHN0cixP
UFRJT05fUkVQTEFZX0RFVEVDVElPTik9PTApIHsKKwlpZiAob3B0cy0+cmVwbGF5X2RldGVjdGlv
bikgeworCSAgICBWTCgoIlJlcGxheSBEZXRlY3Rpb24gb3B0aW9uIGFwcGVhcnMgdHdpY2VcbiIp
KTsKKwkgICAgcmV0dXJuIFNBU0xfRkFJTDsKKwl9CisJb3B0cy0+cmVwbGF5X2RldGVjdGlvbiA9
IDE7CisgICAgfSBlbHNlIGlmIChzdHJuY21wKHN0cixPUFRJT05fSU5URUdSSVRZLHN0cmxlbihP
UFRJT05fSU5URUdSSVRZKSk9PTApIHsKKworCWludCBiaXQgPSBGaW5kQml0KHN0citzdHJsZW4o
T1BUSU9OX0lOVEVHUklUWSksIGludGVncml0eV9vcHRpb25zKTsKKworCWlmIChiaXQgPT0gMCkg
cmV0dXJuIFNBU0xfT0s7CisKKwlpZiAoYml0ICYgb3B0cy0+aW50ZWdyaXR5KSB7CisJICAgIFZM
KCgiT3B0aW9uICVzIGV4aXN0cyBtdWx0aXBsZSB0aW1lc1xuIixzdHIpKTsKKwkgICAgcmV0dXJu
IFNBU0xfRkFJTDsKKwl9CisKKwlvcHRzLT5pbnRlZ3JpdHkgPSBvcHRzLT5pbnRlZ3JpdHkgfCBi
aXQ7CisKKyAgICB9IGVsc2UgaWYgKHN0cm5jbXAoc3RyLE9QVElPTl9DT05GSURFTlRJQUxJVFks
c3RybGVuKE9QVElPTl9DT05GSURFTlRJQUxJVFkpKT09MCkgeworCisJaW50IGJpdCA9IEZpbmRC
aXQoc3RyK3N0cmxlbihPUFRJT05fQ09ORklERU5USUFMSVRZKSwgY29uZmlkZW50aWFsaXR5X29w
dGlvbnMpOworCWlmIChiaXQgPT0gMCkgcmV0dXJuIFNBU0xfT0s7CisKKwlpZiAoYml0ICYgb3B0
cy0+Y29uZmlkZW50aWFsaXR5KSB7CisJICAgIFZMKCgiT3B0aW9uICVzIGV4aXN0cyBtdWx0aXBs
ZSB0aW1lc1xuIixzdHIpKTsKKwkgICAgcmV0dXJuIFNBU0xfRkFJTDsKKwl9CisKKwlvcHRzLT5j
b25maWRlbnRpYWxpdHkgPSBvcHRzLT5jb25maWRlbnRpYWxpdHkgfCBiaXQ7CisKKyAgICB9IGVs
c2UgeworCVZMKCgiT3B0aW9uIG5vdCB1bmRlcnNvb2Q6ICVzXG4iLHN0cikpOworCXJldHVybiBT
QVNMX0ZBSUw7CisgICAgfQorCisgICAgcmV0dXJuIFNBU0xfT0s7Cit9CisKK3N0YXRpYyBpbnQK
K1BhcnNlT3B0aW9ucyhzYXNsX3V0aWxzX3QgKnV0aWxzLCBjaGFyICppbiwgc3JwX29wdGlvbnNf
dCAqb3V0KQoreworICAgIGludCByOworCisgICAgbWVtc2V0KG91dCwgMCwgc2l6ZW9mKHNycF9v
cHRpb25zX3QpKTsKKworICAgIHdoaWxlIChpbikgeworCWNoYXIgKm9wdDsKKworCXIgPSBQYXJz
ZU9wdGlvbih1dGlscywgaW4sICZvcHQsICZpbik7CisJaWYgKHIpIHJldHVybiByOworCisJaWYg
KG9wdCA9PSBOVUxMKSByZXR1cm4gU0FTTF9PSzsKKworCVZMKCgiR290IG9wdGlvbjogWyVzXVxu
IixvcHQpKTsKKworCXIgPSBQYXJzZU9wdGlvblN0cmluZyhvcHQsIG91dCk7CisJaWYgKHIpIHJl
dHVybiByOworICAgIH0KKworICAgIHJldHVybiBTQVNMX09LOworfQorCitzdGF0aWMgbGF5ZXJf
b3B0aW9uX3QgKgorRmluZEJlc3QoaW50IGF2YWlsYWJsZSwgbGF5ZXJfb3B0aW9uX3QgKm9wdHMp
Cit7CisgICAgd2hpbGUgKG9wdHMtPm5hbWUpIHsKKwlWTCgoIkZpbmRCZXN0ICVkICVkXG4iLGF2
YWlsYWJsZSwgb3B0cy0+Yml0KSk7CisKKwlpZiAoYXZhaWxhYmxlICYgb3B0cy0+Yml0KSB7CisJ
ICAgIHJldHVybiBvcHRzOworCX0KKworCW9wdHMrKzsKKyAgICB9CisKKyAgICByZXR1cm4gTlVM
TDsKK30KKworc3RhdGljIGludAorT3B0aW9uc1RvU3RyaW5nKHNhc2xfdXRpbHNfdCAqdXRpbHMs
IHNycF9vcHRpb25zX3QgKm9wdHMsIGNoYXIgKipvdXQpCit7CisgICAgY2hhciAqcmV0ID0gTlVM
TDsKKyAgICBpbnQgYWxsb2NlZCA9IDA7CisgICAgaW50IGZpcnN0ID0gMTsKKyAgICBsYXllcl9v
cHRpb25fdCAqb3B0bGlzdDsKKworICAgIHJldCA9IHV0aWxzLT5tYWxsb2MoMSk7CisgICAgaWYg
KCFyZXQpIHJldHVybiBTQVNMX05PTUVNOworICAgIGFsbG9jZWQgPSAxOworICAgIHJldFswXSA9
ICdcMCc7CisKKyAgICBpZiAob3B0cy0+cmVwbGF5X2RldGVjdGlvbikgeworCWFsbG9jZWQgKz0g
c3RybGVuKE9QVElPTl9SRVBMQVlfREVURUNUSU9OKSsxOworCXJldCA9IHV0aWxzLT5yZWFsbG9j
KHJldCwgYWxsb2NlZCk7CisJaWYgKCFyZXQpIHJldHVybiBTQVNMX05PTUVNOworCisJaWYgKCFm
aXJzdCkgc3RyY2F0KHJldCwgIiwiKTsKKwlzdHJjYXQocmV0LCBPUFRJT05fUkVQTEFZX0RFVEVD
VElPTik7CisJZmlyc3QgPSAwOworICAgIH0KKworICAgIG9wdGxpc3QgPSBpbnRlZ3JpdHlfb3B0
aW9uczsKKyAgICB3aGlsZShvcHRsaXN0LT5uYW1lKSB7CisJaWYgKG9wdHMtPmludGVncml0eSAm
IG9wdGxpc3QtPmJpdCkgeworCSAgICBhbGxvY2VkICs9IHN0cmxlbihPUFRJT05fSU5URUdSSVRZ
KStzdHJsZW4ob3B0bGlzdC0+bmFtZSkrMTsKKwkgICAgcmV0ID0gdXRpbHMtPnJlYWxsb2MocmV0
LCBhbGxvY2VkKTsKKwkgICAgaWYgKCFyZXQpIHJldHVybiBTQVNMX05PTUVNOworCisJICAgIGlm
ICghZmlyc3QpIHN0cmNhdChyZXQsICIsIik7CisJICAgIHN0cmNhdChyZXQsIE9QVElPTl9JTlRF
R1JJVFkpOworCSAgICBzdHJjYXQocmV0LCBvcHRsaXN0LT5uYW1lKTsKKwkgICAgZmlyc3QgPSAw
OworCX0KKworCW9wdGxpc3QrKzsKKyAgICB9CisKKyAgICBvcHRsaXN0ID0gY29uZmlkZW50aWFs
aXR5X29wdGlvbnM7CisgICAgd2hpbGUob3B0bGlzdC0+bmFtZSkgeworCWlmIChvcHRzLT5jb25m
aWRlbnRpYWxpdHkgJiBvcHRsaXN0LT5iaXQpIHsKKwkgICAgYWxsb2NlZCArPSBzdHJsZW4oT1BU
SU9OX0NPTkZJREVOVElBTElUWSkrc3RybGVuKG9wdGxpc3QtPm5hbWUpKzE7CisJICAgIHJldCA9
IHV0aWxzLT5yZWFsbG9jKHJldCwgYWxsb2NlZCk7CisJICAgIGlmICghcmV0KSByZXR1cm4gU0FT
TF9OT01FTTsKKworCSAgICBpZiAoIWZpcnN0KSBzdHJjYXQocmV0LCAiLCIpOworCSAgICBzdHJj
YXQocmV0LCBPUFRJT05fQ09ORklERU5USUFMSVRZKTsKKwkgICAgc3RyY2F0KHJldCwgb3B0bGlz
dC0+bmFtZSk7CisJICAgIGZpcnN0ID0gMDsKKwl9CisKKwlvcHRsaXN0Kys7CisgICAgfQorICAg
IAorICAgICpvdXQgPSByZXQ7CisgICAgcmV0dXJuIFNBU0xfT0s7Cit9CisKK3N0YXRpYyBpbnQK
K0NyZWF0ZVNlcnZlck9wdGlvbnMoc2FzbF91dGlsc190ICp1dGlscywKKwkJICAgIHNhc2xfc2Vj
dXJpdHlfcHJvcGVydGllc190ICpwcm9wcywKKwkJICAgIGNoYXIgKipvdXQpCit7CisgICAgc3Jw
X29wdGlvbnNfdCBvcHRzOworICAgIGxheWVyX29wdGlvbl90ICpvcHRsaXN0OworCisgICAgLyog
emVybyBvdXQgb3B0aW9ucyAqLworICAgIG1lbXNldCgmb3B0cywwLHNpemVvZihzcnBfb3B0aW9u
c190KSk7CisKKworICAgIC8qIEFkZCBpbnRlZ3JpdHkgb3B0aW9ucyAqLworICAgIG9wdGxpc3Qg
PSBpbnRlZ3JpdHlfb3B0aW9uczsKKyAgICB3aGlsZShvcHRsaXN0LT5uYW1lKSB7CisJaWYgKChw
cm9wcy0+bWluX3NzZiA8PSAxKSAmJiAocHJvcHMtPm1heF9zc2YgPj0gMSkpIHsKKwkgICAgb3B0
cy5pbnRlZ3JpdHkgfD0gb3B0bGlzdC0+Yml0OworCX0KKwlvcHRsaXN0Kys7CisgICAgfQorCisg
ICAgLyogaWYgd2Ugc2V0IGFueSBpbnRlZ3JpdHkgb3B0aW9ucyB3ZSBjYW4gYWR2ZXJ0aXNlIHJl
cGxheSBkZXRlY3Rpb24gKi8KKyAgICBpZiAob3B0cy5pbnRlZ3JpdHkpIHsKKwlvcHRzLnJlcGxh
eV9kZXRlY3Rpb24gPSAxOworICAgIH0KKworICAgIC8qIEFkZCBpbnRlZ3JpdHkgb3B0aW9ucyAq
LworICAgIG9wdGxpc3QgPSBjb25maWRlbnRpYWxpdHlfb3B0aW9uczsKKyAgICB3aGlsZShvcHRs
aXN0LT5uYW1lKSB7CisJaWYgKCgoaW50KXByb3BzLT5taW5fc3NmIDw9IG9wdGxpc3QtPnNzZikg
JiYgKChpbnQpcHJvcHMtPm1heF9zc2YgPj0gb3B0bGlzdC0+c3NmKSkgeworCSAgICBvcHRzLmNv
bmZpZGVudGlhbGl0eSB8PSBvcHRsaXN0LT5iaXQ7CisJfQorCW9wdGxpc3QrKzsKKyAgICB9CisK
KyAgICByZXR1cm4gT3B0aW9uc1RvU3RyaW5nKHV0aWxzLCAmb3B0cywgb3V0KTsKK30KKwkJICAg
IAorCitzdGF0aWMgaW50CitDcmVhdGVDbGllbnRPcHRzKHNhc2xfY2xpZW50X3BhcmFtc190ICpw
YXJhbXMsIAorCQkgc3JwX29wdGlvbnNfdCAqYXZhaWxhYmxlLCAKKwkJIHNycF9vcHRpb25zX3Qg
Km91dCkKK3sKKyAgICBpbnQgZXh0ZXJuYWw7CisgICAgaW50IGxpbWl0OworICAgIGludCBtdXN0
aGF2ZTsKKworICAgIC8qIHplcm8gb3V0IG91dHB1dCAqLworICAgIG1lbXNldChvdXQsIDAsIHNp
emVvZihzcnBfb3B0aW9uc190KSk7CisKKyAgICAvKiBnZXQgcmVxdWVzdGVkIHNzZiAqLworICAg
IGV4dGVybmFsID0gcGFyYW1zLT5leHRlcm5hbF9zc2Y7CisKKyAgICAvKiB3aGF0IGRvIHdlIF9u
ZWVkXz8gIGhvdyBtdWNoIGlzIHRvbyBtdWNoPyAqLworICAgIGlmICgoaW50KXBhcmFtcy0+cHJv
cHMubWF4X3NzZiA+IGV4dGVybmFsKSB7CisJbGltaXQgPSBwYXJhbXMtPnByb3BzLm1heF9zc2Yg
LSBleHRlcm5hbDsKKyAgICB9IGVsc2UgeworCWxpbWl0ID0gMDsKKyAgICB9CisgICAgaWYgKChp
bnQpcGFyYW1zLT5wcm9wcy5taW5fc3NmID4gZXh0ZXJuYWwpIHsKKwltdXN0aGF2ZSA9IHBhcmFt
cy0+cHJvcHMubWluX3NzZiAtIGV4dGVybmFsOworICAgIH0gZWxzZSB7CisJbXVzdGhhdmUgPSAw
OworICAgIH0KKworICAgIC8qIHdlIG5vdyBnbyBzZWFyY2hpbmcgZm9yIGFuIG9wdGlvbiB0aGF0
IGdpdmVzIHVzIGF0IGxlYXN0ICJtdXN0aGF2ZSIKKyAgICAgICBhbmQgYXQgbW9zdCAibGltaXQi
IGJpdHMgb2Ygc3NmLiAqLworICAgIGlmICgobGltaXQgPiAxKSAmJiAoYXZhaWxhYmxlLT5jb25m
aWRlbnRpYWxpdHkpKSB7CisJVkwoKCJ4eHggTm8gZ29vZCBwcml2YWN5IGxheWVyc1xuIikpOwor
CXJldHVybiBTQVNMX0ZBSUw7CisgICAgfQorCisgICAgVkwoKCJBdmFpbGFibGUgaW50ZWdyaXR5
ID0gJWRcbiIsYXZhaWxhYmxlLT5pbnRlZ3JpdHkpKTsKKworICAgIGlmICgobGltaXQgPj0gMSkg
JiYgKG11c3RoYXZlIDw9IDEpICYmIChhdmFpbGFibGUtPmludGVncml0eSkpIHsKKwkvKiBpbnRl
Z3JpdHkgKi8KKwlsYXllcl9vcHRpb25fdCAqaW9wdDsKKwkKKwlpb3B0ID0gRmluZEJlc3QoYXZh
aWxhYmxlLT5pbnRlZ3JpdHksIGludGVncml0eV9vcHRpb25zKTsKKwkKKwlpZiAoaW9wdCkgewor
CSAgICBvdXQtPmludGVncml0eSA9IGlvcHQtPmJpdDsKKwkgICAgcmV0dXJuIFNBU0xfT0s7CisJ
fQorICAgIH0KKworICAgIGlmIChtdXN0aGF2ZSA8PSAwKSB7IC8qIHh4eCBob3cgZG8gd2Uga25v
dyBpZiBzZXJ2ZXIgZG9lc24ndCBzdXBwb3J0IG5vIGxheWVyPz8/ICovCisJLyogbm8gbGF5ZXIg
Ki8KKwlyZXR1cm4gU0FTTF9PSzsKKworICAgIH0KKworICAgIAorICAgIFZMKCgiQ2FuJ3QgZmlu
ZCBhbiBhY2NlcHRhYmxlIGxheWVyXG4iKSk7CisgICAgcmV0dXJuIFNBU0xfVE9PV0VBSzsKK30K
KworLyogU2V0IHRoZSBvcHRpb25zIChjYWxsZWQgbXkgY2xpZW50IGFuZCBzZXJ2ZXIpCisgKgor
ICogU2V0IHVwIHZhcmlhYmxlcy9oYXNoZXMvdGhhdCBzb3J0YSB0aGluZyBzbyBsYXllcnMKKyAq
IHdpbGwgb3BlcmF0ZSBwcm9wZXJseQorICovCitzdGF0aWMgaW50CitTZXRPcHRpb25zKHNycF9v
cHRpb25zX3QgKm9wdHMsCisJICAgY29udGV4dF90ICp0ZXh0LAorCSAgIHNhc2xfdXRpbHNfdCAq
dXRpbHMsCisJICAgc2FzbF9vdXRfcGFyYW1zX3QgKm9wYXJhbXMpCit7CisgICAgdGV4dC0+dXRp
bHMgPSB1dGlsczsKKyAgICB0ZXh0LT5zaXplPS0xOworICAgIHRleHQtPm5lZWRzaXplPTQ7CisK
KyAgICBpZiAoKG9wdHMtPmludGVncml0eSA9PSAwKSAmJiAob3B0cy0+Y29uZmlkZW50aWFsaXR5
ID09IDApKSB7CisJb3BhcmFtcy0+ZW5jb2RlID0gTlVMTDsKKwlvcGFyYW1zLT5kZWNvZGUgPSBO
VUxMOworCW9wYXJhbXMtPm1lY2hfc3NmID0gMDsKKwlWTCgoIlVzaW5nIG5vIGxheWVyXG4iKSk7
CQorCXJldHVybiBTQVNMX09LOworICAgIH0KKyAgICAKKyAgICBvcGFyYW1zLT5lbmNvZGUgPSAm
bGF5ZXJfZW5jb2RlOworICAgIG9wYXJhbXMtPmRlY29kZSA9ICZsYXllcl9kZWNvZGU7CisKKyAg
ICB0ZXh0LT5lbmFibGVkX3JlcGxheV9kZXRlY3Rpb24gPSBvcHRzLT5yZXBsYXlfZGV0ZWN0aW9u
OworCisgICAgaWYgKG9wdHMtPmludGVncml0eSkgeworCWxheWVyX29wdGlvbl90ICppb3B0Owor
CisJdGV4dC0+ZW5hYmxlZF9pbnRlZ3JpdHlfbGF5ZXIgPSAxOworCW9wYXJhbXMtPm1lY2hfc3Nm
ID0gMTsKKworCWlvcHQgPSBGaW5kT3B0aW9uRnJvbUJpdChvcHRzLT5pbnRlZ3JpdHksIGludGVn
cml0eV9vcHRpb25zKTsKKwlpZiAoIWlvcHQpIHsKKwkgICAgVkwoKCJVbmFibGUgdG8gZmluZCBp
bnRlZ3JpdHkgbGF5ZXIgb3B0aW9uIG5vd1xuIikpOworCSAgICByZXR1cm4gU0FTTF9GQUlMOwor
CX0KKworCXRleHQtPkhhc2hMZW4gICAgPSBpb3B0LT5IYXNoTGVuOworCXRleHQtPkhhc2hJbml0
ICAgPSBpb3B0LT5IYXNoSW5pdDsKKwl0ZXh0LT5IYXNoVXBkYXRlID0gaW9wdC0+SGFzaFVwZGF0
ZTsKKwl0ZXh0LT5IYXNoRmluYWwgID0gaW9wdC0+SGFzaEZpbmFsOworICAgIH0KKworICAgIC8q
IGNvbmYgZm9vICovCisKKyAgICByZXR1cm4gU0FTTF9PSzsKK30KKworCit0eXBlZGVmIHN0cnVj
dCBuZXRzdHJpbmdfcyB7CisKKyAgICBpbnQgc2l6ZTsKKyAgICAKKyAgICBjaGFyIGRhdGFbMV07
IC8qIGFsbG9jYXRlIHRvIHNpemUgeW91IG5lZWQgKi8KKworfSBuZXRzdHJpbmdfdDsKKworLyog
ZG9lc24ndCBjb250YWluIG5ldHN0cmluZyBmb3JtYXR0aW5nICovCit0eXBlZGVmIHN0cnVjdCBu
ZXRkYXRhX3MgeworCisgICAgaW50IHNpemU7CisgICAgCisgICAgY2hhciBkYXRhWzFdOyAvKiBh
bGxvY2F0ZSB0byBzaXplIHlvdSBuZWVkICovCisKK30gbmV0ZGF0YV90OworCisKKworCitzdGF0
aWMgaW50CitzZXJ2ZXJfc3RhcnQodm9pZCAqZ2xvYl9jb250ZXh0IF9fYXR0cmlidXRlX18oKHVu
dXNlZCkpLAorICAgICAgICAgICAgIHNhc2xfc2VydmVyX3BhcmFtc190ICpwYXJhbXMsCisJICAg
ICBjb25zdCBjaGFyICpjaGFsbGVuZ2UgX19hdHRyaWJ1dGVfXygodW51c2VkKSksCisJICAgICBp
bnQgY2hhbGxlbiBfX2F0dHJpYnV0ZV9fKCh1bnVzZWQpKSwKKwkgICAgIHZvaWQgKipjb25uLAor
CSAgICAgY29uc3QgY2hhciAqKmVycnN0cikKK3sKKyAgY29udGV4dF90ICp0ZXh0OworCisgIC8q
IGhvbGRzIHN0YXRlIGFyZSBpbiAqLworICBpZiAoIWNvbm4pCisgICAgICByZXR1cm4gU0FTTF9C
QURQQVJBTTsKKworICAvKiBob2xkcyBzdGF0ZSBhcmUgaW4gKi8KKyAgdGV4dCA9IHBhcmFtcy0+
dXRpbHMtPm1hbGxvYyhzaXplb2YoY29udGV4dF90KSk7CisgIGlmICh0ZXh0PT1OVUxMKSByZXR1
cm4gU0FTTF9OT01FTTsKIAotICAgIHJldHVybiBTQVNMX09LOwotfQorICBtZW1zZXQodGV4dCwg
J1wwJywgc2l6ZW9mKGNvbnRleHRfdCkpOworICB0ZXh0LT5zdGF0ZSA9IDA7CisgICpjb25uPXRl
eHQ7CisgIAorICBpZiAoZXJyc3RyKQorICAgICAgKmVycnN0ciA9IE5VTEw7CiAKLXN0YXRpYyBp
bnQgYmlnaW50X2Zyb21uZXRkYXRhKG5ldGRhdGFfdCAqbnMsIHNhc2xfdXRpbHNfdCAqdXRpbHMs
IG1wel90IHJldCkKLXsKLSAgICByZXR1cm4gYmlnaW50X2Zyb21zdHIobnMtPmRhdGEsIG5zLT5z
aXplLCB1dGlscyxyZXQpOworICByZXR1cm4gU0FTTF9PSzsKIH0KIAotCisjaWYgMAogLyogVGhl
IHByb2JhYmlsaXR5IG9mIGEKICAgIGZhbHNlIHBvc2l0aXZlIGlzICgxLzQpKipSRVBTLiAgQSBy
ZWFzb25hYmxlIHZhbHVlIG9mIHJlcHMgaXMgMjUuICovCiAjZGVmaW5lIFJFUFMgMjUKQEAgLTYw
MCw0MTUgKzE4MTcsNDY1IEBACiAgICAgcmV0dXJuIFNBU0xfRkFJTDsKIH0KIAorI2VuZGlmIC8q
IDAgKi8KKworLyogTiBpbiBiYXNlMTYgKi8KKyNkZWZpbmUgQklHTl9TVFJJTkcgIkFDNkJEQjQx
MzI0QTlBOUJGMTY2REU1RTEzODk1ODJGQUY3MkI2NjUxOTg3RUUwN0ZDMzE5Mjk0M0RCNTYwNTBB
MzczMjlDQkI0QTA5OUVEODE5M0UwNzU3NzY3QTEzREQ1MjMxMkFCNEIwMzMxMERDRDdGNDhBOURB
MDRGRDUwRTgwODM5NjlFREI3NjdCMENGNjA5NTE3OUExNjNBQjM2NjFBMDVGQkQ1RkFBQUU4Mjkx
OEE5OTYyRjBCOTNCODU1Rjk3OTkzRUM5NzVFRUFBODBENzQwQURCRjRGRjc0NzM1OUQwNDFENUMz
M0VBNzFEMjgxRTQ0NkIxNDc3M0JDQTk3QjQzQTIzRkI4MDE2NzZCRDIwN0E0MzZDNjQ4MUYxRDJC
OTA3ODcxNzQ2MUE1QjlEMzJFNjg4Rjg3NzQ4NTQ0NTIzQjUyNEIwRDU3RDVFQTc3QTI3NzVEMkVD
RkEwMzJDRkJEQkY1MkZCMzc4NjE2MDI3OTAwNEU1N0FFNkFGODc0RTczMDNDRTUzMjk5Q0NDMDQx
QzdCQzMwOEQ4MkE1Njk4RjNBOEQwQzM4MjcxQUUzNUY4RTlEQkZCQjY5NEI1QzgwM0Q4OUY3QUU0
MzVERTIzNkQ1MjVGNTQ3NTlCNjVFMzcyRkNENjhFRjIwRkE3MTExRjlFNEFGRjczIgogCiAvKiBB
IGxhcmdlIHNhZmUgcHJpbWUgKE4gPSAycSsxLCB3aGVyZSBxIGlzIHByaW1lKSBBbGwgYXJpdGht
ZXRpYyBpcyBkb25lIG1vZHVsbyBOICovCi1zdGF0aWMgaW50IGdlbmVyYXRlX05fYW5kX2cobXB6
X3QgTixtcHpfdCBiaWdnKQorc3RhdGljIGludCBnZW5lcmF0ZV9OX2FuZF9nKG1wel90IE4sIG1w
el90IGcpCiB7Ci0KLSNkZWZpbmUgQklHTlVNICIzS24vWVlpb21Ia0ZrZk0xeDRrYXlSMTI1TUdr
enBMVUR5M3kxNEZsVE13WW5oWmtqck1Ybm9DMlRjRkFlY05sVTVrRnpnY3BLWVViQk9QWkZSdHlm
MyIKLSAgICB7Ci0JY2hhciBkZWNbNDAwMF07Ci0JaW50IGRlY2xlbjsKLQlpbnQgbHVwOwotCi0J
bHVwID0gc2FzbF9kZWNvZGU2NChCSUdOVU0sc3RybGVuKEJJR05VTSksZGVjLCZkZWNsZW4pOwot
Ci0JcHJpbnRmKCJlcnJvciA9ICVkXG4iLGx1cCk7CisgICAgaW50IHJlc3VsdDsKKyAgICAKKyAg
ICBtcHpfaW5pdChOKTsKKyAgICByZXN1bHQgPSBtcHpfc2V0X3N0ciAoTiwgQklHTl9TVFJJTkcs
IDE2KTsKKyAgICBpZiAocmVzdWx0KSByZXR1cm4gU0FTTF9GQUlMOwogCi0JcHJpbnRmKCJsZW4g
PSAlZFxuIixzdHJsZW4oQklHTlVNKSk7Ci0JcHJpbnRmKCJkZWNsZW4gPSAlZFxuIixkZWNsZW4p
OworICAgIG1wel9pbml0KGcpOworICAgIG1wel9zZXRfdWkgKGcsIDIpOwogCi0JLyoJZm9yIChs
dXA9MDtsdXA8ZGVjbGVuO2x1cCsrKSB7Ci0JICAgIHByaW50ZigiJWQgJWRcbiIsbHVwLGRlY1ts
dXBdKTsKLQkgICAgfSovCisgICAgcmV0dXJuIFNBU0xfT0s7Cit9CiAKLQlmb3IgKGx1cD0wO2x1
cDwxMDtsdXArKykgewotCSAgICBwcmludGYoIiVjIixmcm9tYml0cyggKGRlY1tsdXBdID4+IDQp
ICYgMTUpKTsKLQkgICAgcHJpbnRmKCIlYyIsZnJvbWJpdHMoIGRlY1tsdXBdICYgMTUpKTsKLQl9
Ci0JcHJpbnRmKCJcbiIpOworc3RhdGljIGludAorU2VydmVyQ2FsY3VsYXRlSyhzYXNsX3V0aWxz
X3QgKnV0aWxzLCBtcHpfdCB2LAorCQkgbXB6X3QgTiwgbXB6X3QgZywgbXB6X3QgYiwgbXB6X3Qg
QiwgbXB6X3QgQSwKKwkJIGNoYXIgKiprZXksIGludCAqa2V5bGVuKQoreworICAgIHVuc2lnbmVk
IGNoYXIgaGFzaFsxNl07CisgICAgbXB6X3QgdTsKKyAgICBtcHpfdCBTOworICAgIGludCByOwog
CisgICAgLyogQiA9IHYgKyBnXmIgKi8KKyAgICBtcHpfaW5pdChCKTsKIAotICAgIH0KKyAgICBt
cHpfcG93bShCLCBnLCBiLCBOKTsKKyAgICBtcHpfYWRkKEIsIEIsIHYpOworICAgIG1wel9tb2Qo
QiwgQiwgTik7CiAKLSAgICAvKgotICAgICAqIDUxMiBiaXRzCi0gICAgICogIE4gPSBkY2E5ZmY2
MTg4YTg5ODc5MDU5MQotICAgICAqICBnID0gMgorICAgIC8qIGNhbGN1bGF0ZSBLCisgICAgICoK
KyAgICAgKiBIb3N0OiAgUyA9IChBdl51KSBeIGIgICAgICAgICAgICAgIChjb21wdXRlcyBzZXNz
aW9uIGtleSkKKyAgICAgKiBIb3N0OiAgSyA9IEhpKFMpCiAgICAgICovCi0KLSAgICB7Ci0JaW50
IHJlc3VsdDsKIAotCW1wel9pbml0KE4pOwotCXJlc3VsdCA9IG1wel9zZXRfc3RyIChOLCAiZGNh
OWZmNjE4OGE4OTg3OTA1OTEiLCAxNik7Ci0JaWYgKHJlc3VsdCkgcmV0dXJuIFNBU0xfRkFJTDsK
LQltcHpfaW5pdChiaWdnKTsKLQltcHpfc2V0X3VpIChiaWdnLCAyKTsKLSAgICB9CisgICAgLyog
dSBpcyBmaXJzdCAzMiBiaXRzIG9mIEIgaGFzaGVkOyBNU0IgZmlyc3QgKi8KKyAgICByID0gSGFz
aEJpZ0ludCh1dGlscywgQiwgaGFzaCk7CisgICAgaWYgKHIpIHJldHVybiByOworCisgICAgbXB6
X2luaXQodSk7CisgICAgRGF0YVRvQmlnSW50KGhhc2gsIDQsICZ1KTsKKworICAgIG1wel9pbml0
KFMpOworICAgIG1wel9wb3dtKFMsIHYsIHUsIE4pOworICAgIG1wel9tdWwoUywgUywgQSk7Cisg
ICAgbXB6X21vZChTLCBTLCBOKTsKKworICAgIG1wel9wb3dtKFMsIFMsIGIsIE4pOworCisgICAg
LyogSyA9IEhpKFMpICovCisgICAgciA9IEhhc2hJbnRlcmxlYXZlQmlnSW50KHV0aWxzLCBTLCBr
ZXksIGtleWxlbik7CisgICAgaWYgKHIpIHJldHVybiByOwogCiAgICAgcmV0dXJuIFNBU0xfT0s7
CiB9CiAKLXN0YXRpYyB2b2lkIG1lcmdlX25ldHN0cmluZ3Moc2FzbF91dGlsc190ICp1dGlscywK
LQkJCSAgICAgbmV0c3RyaW5nX3QgKm5zMSxuZXRzdHJpbmdfdCAqbnMyLG5ldHN0cmluZ190ICpu
czMsCi0JCQkgICAgIGNoYXIgKipvdXQsIGludCAqb3V0bGVuKQorc3RhdGljIGludAorc2VydmVy
X3N0ZXAxKGNvbnRleHRfdCAqdGV4dCwKKwkgICAgIHNhc2xfc2VydmVyX3BhcmFtc190ICpwYXJh
bXMsCisJICAgICBjb25zdCBjaGFyICpjbGllbnRpbiwKKwkgICAgIGludCBjbGllbnRpbmxlbiwK
KwkgICAgIGNoYXIgKipzZXJ2ZXJvdXQsCisJICAgICBpbnQgKnNlcnZlcm91dGxlbiwKKwkgICAg
IHNhc2xfb3V0X3BhcmFtc190ICpvcGFyYW1zIF9fYXR0cmlidXRlX18oKHVudXNlZCkpLAorCSAg
ICAgY29uc3QgY2hhciAqKmVycnN0cikKIHsKLSAgICBpbnQgdG90YWxsZW47Ci0gICAgY2hhciBs
ZW5zdHJbMzBdOwotICAgIGNoYXIgKnRtcDsKLQotICAgIC8qIGNhbGN1bGF0ZSB0b3RhbCBsZW5n
dGggb2Ygc3RyaW5ncyAqLwotICAgIHRvdGFsbGVuID0gMDsKLSAgICBpZiAobnMxKQotCXRvdGFs
bGVuKz1uczEtPnNpemU7Ci0gICAgaWYgKG5zMikKLQl0b3RhbGxlbis9bnMyLT5zaXplOwotICAg
IGlmIChuczMpCi0JdG90YWxsZW4rPW5zMy0+c2l6ZTsKLQotICAgIHNucHJpbnRmKGxlbnN0cixz
aXplb2YobGVuc3RyKSwiJWQ6Iix0b3RhbGxlbik7Ci0gICAgCi0gICAgKm91dGxlbiA9IHN0cmxl
bihsZW5zdHIpICsgdG90YWxsZW4gKyAxOwotICAgICpvdXQgPSB1dGlscy0+bWFsbG9jKCpvdXRs
ZW4pOwotICAgIAotICAgIHRtcCA9ICpvdXQ7Ci0gICAgbWVtY3B5KHRtcCxsZW5zdHIsIHN0cmxl
bihsZW5zdHIpKTsKLSAgICB0bXArPXN0cmxlbihsZW5zdHIpOworICAgIGNoYXIgKmRhdGE7Cisg
ICAgaW50IGRhdGFsZW47CisgICAgaW50IHI7ICAgIAorICAgIGNoYXIgKm1waU4gPSBOVUxMOwor
ICAgIGludCBtcGlObGVuOworICAgIGNoYXIgKm1waWcgPSBOVUxMOworICAgIGludCBtcGlnbGVu
OworICAgIGNoYXIgKnV0ZjhMID0gTlVMTDsKKyAgICBpbnQgdXRmOExsZW47CisgICAgY2hhciAq
cmVhbG0gPSBOVUxMOworICAgIGNoYXIgKnVzZXIgPSBOVUxMOwogCi0gICAgaWYgKG5zMSkgewot
CW1lbWNweSggdG1wLCBuczEtPmRhdGEsIG5zMS0+c2l6ZSk7Ci0JdG1wKz1uczEtPnNpemU7Ci0g
ICAgfQotICAgIGlmIChuczIpIHsKLQltZW1jcHkoIHRtcCwgbnMyLT5kYXRhLCBuczItPnNpemUp
OwotCXRtcCs9bnMyLT5zaXplOworICAgIC8qIGlmIG5vdGhpbmcgd2Ugc2VuZCBub3RoaW5nIGFu
ZCBleGNlcHQgZGF0YSBuZXh0IHRpbWUgKi8KKyAgICBpZiAoKGNsaWVudGlubGVuID09IDApICYm
ICh0ZXh0LT5zdGF0ZSA9PSAwKSkgeworCXRleHQtPnN0YXRlKys7CisJKnNlcnZlcm91dCA9IE5V
TEw7CisJKnNlcnZlcm91dGxlbiA9IDA7CisJcmV0dXJuIFNBU0xfQ09OVElOVUU7CiAgICAgfQot
ICAgIGlmIChuczMpIHsKLQltZW1jcHkoIHRtcCwgbnMzLT5kYXRhLCBuczMtPnNpemUpOwotCXRt
cCs9bnMzLT5zaXplOworCisgICAgLyogRXhwZWN0OgorICAgICAqICB7IHV0ZjgoVSkgfQorICAg
ICAqCisgICAgICovCisgICAgciA9IFVuQnVmZmVyKChjaGFyICopIGNsaWVudGluLCBjbGllbnRp
bmxlbiwgJmRhdGEsICZkYXRhbGVuKTsKKyAgICBpZiAocikgeworCSplcnJzdHIgPSAiRXJyb3Ig
J3VuYnVmZmVyJ2luZyBpbnB1dCBmb3Igc3RlcCAxIjsKKwlyZXR1cm4gcjsKICAgICB9Ci0gICAg
dG1wWzBdPScsJzsKLX0KIAotc3RhdGljIGludCBjaGVja3ZhbGlkX25ldHN0cmluZyhjaGFyICpp
biwgaW50IGlubGVuLCBjaGFyICoqZGF0YXN0YXJ0LCBpbnQgKmRhdGFsZW4pCi17Ci0gICAgY2hh
ciBsZW5zdHJbMjBdOwotICAgIGludCBwb3MgPSAwOwotICAgIAotICAgIC8qIHNlZSBob3cgYmln
IGl0IHNheXMgaXQgaXMgKi8KLSAgICB3aGlsZSAoKHBvczxpbmxlbikgJiYgKHBvcyA8IChpbnQp
IHNpemVvZihsZW5zdHIpKSAmJiAoaXNkaWdpdCgoaW50KSBpbltwb3NdKSkpIHsKLQlsZW5zdHJb
cG9zXSA9IGluW3Bvc107Ci0JcG9zKys7CisgICAgciA9IEdldFVURjgocGFyYW1zLT51dGlscywg
ZGF0YSwgZGF0YWxlbiwgJnRleHQtPmF1dGhpZCwgJmRhdGEsICZkYXRhbGVuKTsKKyAgICBpZiAo
cikgeworCSplcnJzdHIgPSAiRXJyb3IgZ2V0dGluZyBVVEY4IHN0cmluZyBmcm9tIGlucHV0IjsK
KwlyZXR1cm4gcjsKICAgICB9Ci0gICAgCi0gICAgaWYgKHBvcyA9PSAwKSB7Ci0JVkwgKCgibmV0
c3RyaW5nIGRvZXNuJ3QgY29udGFpbiBsZW5ndGggaW5kaWNhdG9yXG4iKSk7CisKKyAgICBpZiAo
ZGF0YWxlbiAhPSAwKSB7CisJKmVycnN0ciA9ICJFeHRyYSBkYXRhIHRvIFNSUCBzdGVwIDEiOwog
CXJldHVybiBTQVNMX0ZBSUw7CiAgICAgfQogCi0gICAgbGVuc3RyW3Bvc109J1wwJzsKLQotICAg
ICgqZGF0YWxlbikgPSBzdHJ0b2wobGVuc3RyLCBOVUxMLCAxMCk7CisgICAgLyogR2V0IHRoZSBy
ZWFsbSAqLworICAgIHIgPSBwYXJzZXVzZXIocGFyYW1zLT51dGlscywgJnVzZXIsICZyZWFsbSwg
cGFyYW1zLT51c2VyX3JlYWxtLAorCQkgIHBhcmFtcy0+c2VydmVyRlFETiwgdGV4dC0+YXV0aGlk
KTsKKyAgICBpZiAocikgeworCSplcnJzdHIgPSAiRXJyb3IgZ2V0dGluZyByZWFsbSI7CisJZ290
byBmYWlsOworICAgIH0KIAotICAgIGlmIChlcnJubyA9PSBFUkFOR0UpIHsKLQlWTCgoIlVuZGVy
ZmxvdyBvciBvdmVyZmxvdyBvY2N1cmVkXG4iKSk7Ci0JcmV0dXJuIFNBU0xfRkFJTDsKKyAgICAv
KiBHZXQgdXNlciBkYXRhICovCisgICAgciA9IFJlYWRVc2VySW5mbyhwYXJhbXMtPnV0aWxzLCB1
c2VyLCByZWFsbSwKKwkJICAgICAmdGV4dC0+TiwgJnRleHQtPmcsICZ0ZXh0LT5zYWx0LCAmdGV4
dC0+c2FsdGxlbiwgJnRleHQtPnYsIGVycnN0cik7CisgICAgaWYgKHIpIHsKKwkvKiByZWFkdXNl
cmluZm8gc2V0cyBlcnJzdHIgKi8KKwlnb3RvIGZhaWw7CiAgICAgfQogCi0gICAgaWYgKCgqZGF0
YWxlbikgPCAwKSB7Ci0JVkwoKCJOZWdhdGl2ZSBuZXRzdHJpbmcgbGVuZ3RoXG4iKSk7Ci0JcmV0
dXJuIFNBU0xfRkFJTDsKKyAgICByID0gQ3JlYXRlU2VydmVyT3B0aW9ucyhwYXJhbXMtPnV0aWxz
LCAmcGFyYW1zLT5wcm9wcywgJnRleHQtPnNlcnZlcl9vcHRpb25zKTsKKyAgICBpZiAocikgewor
CSplcnJzdHIgPSAiRXJyb3IgY3JlYXRpbmcgc2VydmVyIG9wdGlvbnMiOworCWdvdG8gZmFpbDsK
ICAgICB9CiAKLSAgICBpZiAoaW5sZW4gPCBwb3MrMSsoKmRhdGFsZW4pKzEpIHsKLQlWTCgoIk5l
dHNycmluZyB3cm9uZyBzaXplICglZCB2cyAlZClcbiIsIGlubGVuLCBwb3MrMSsoKmRhdGFsZW4p
KzEpKTsKLQlyZXR1cm4gU0FTTF9GQUlMOworICAgIC8qIFNlbmQgb3V0OgorICAgICAqCisgICAg
ICogTCA9IHNlcnZlcl9vcHRpb25zIChhdmFpYmxlIGxheWVycyBldGMpCisgICAgICoKKyAgICAg
KiB7IG1waShOKSBtcGkoZykgdXRmOChMKSB9CisgICAgICoKKyAgICAgKi8KKyAgICAKKyAgICBy
ID0gTWFrZU1QSShwYXJhbXMtPnV0aWxzLCB0ZXh0LT5OLCAmbXBpTiwgJm1waU5sZW4pOworICAg
IGlmIChyKSB7CisJKmVycnN0ciA9ICJFcnJvciBjcmVhdGluZyAnbXBpJyBzdHJpbmcgZm9yIE4i
OworCWdvdG8gZmFpbDsKICAgICB9CiAgICAgCi0gICAgaWYgKGluW3Bvc10hPSc6JykgewotCVZM
KCgiTmV0c3RyaW5nIG1pc3NpbmcgcmVxdWlyZWQgY29sb25cbiIpKTsKLQlyZXR1cm4gU0FTTF9G
QUlMOworICAgIHIgPSBNYWtlTVBJKHBhcmFtcy0+dXRpbHMsIHRleHQtPmcsICZtcGlnLCAmbXBp
Z2xlbik7CisgICAgaWYgKHIpIHsKKwkqZXJyc3RyID0gIkVycm9yIGNyZWF0aW5nICdtcGknIHN0
cmluZyBmb3IgZyI7CisJZ290byBmYWlsOwogICAgIH0KLQotICAgIGlmIChpbltwb3MrKCpkYXRh
bGVuKSsxXSE9JywnKSB7Ci0JVkwoKCJOZXRzdHJpbmcgbWlzc2luZyByZXF1aXJlZCBjb21tYVxu
IikpOwotCXJldHVybiBTQVNMX0ZBSUw7CisgICAgCisgICAgciA9IE1ha2VVVEY4KHBhcmFtcy0+
dXRpbHMsIHRleHQtPnNlcnZlcl9vcHRpb25zLCAmdXRmOEwsICZ1dGY4TGxlbik7CisgICAgaWYg
KHIpIHsKKwkqZXJyc3RyID0gIkVycm9yIGNyZWF0aW5nICdVVEY4JyBzdHJpbmcgZm9yIEwgKHNl
cnZlciBvcHRpb25zKSI7CisJZ290byBmYWlsOwogICAgIH0KLQotICAgICpkYXRhc3RhcnQgPSBp
bitwb3MrMTsKLQotICAgIHJldHVybiBTQVNMX09LOwotfQotCi1zdGF0aWMgaW50IHNwbGl0X25l
dHN0cmluZ3Moc2FzbF91dGlsc190ICp1dGlscywKLQkJCSAgICBuZXRkYXRhX3QgKipuZDEsIG5l
dGRhdGFfdCAqKm5kMiwgbmV0ZGF0YV90ICoqbmQzLAotCQkJICAgIGNoYXIgKmluLCBpbnQgaW5s
ZW4pCi17Ci0gICAgY2hhciAqZGF0YXN0YXJ0LCAqbnNfc3RyOwotICAgIGludCBkYXRhbGVuLCBu
c19sZW47Ci0gICAgaW50IHJlc3VsdDsKLQotICAgIC8qICAgIGludCBsdXA7CiAgICAgCi0gICAg
ICAgIGZvciAobHVwPTA7bHVwPGlubGVuO2x1cCsrKQotICAgIHsKLQlpZiAoaXNhbG51bShpblts
dXBdKSkKLQkgICAgcHJpbnRmKCIlZCAlYyAlZFxuIixsdXAsaW5bbHVwXSxpbltsdXBdKTsKLQll
bHNlCi0JICAgIHByaW50ZigiJWQgPyAlZFxuIixsdXAsaW5bbHVwXSk7Ci0JICAgIH0gKi8KLQot
ICAgIHJlc3VsdCA9IGNoZWNrdmFsaWRfbmV0c3RyaW5nKGluLCBpbmxlbiwgJmRhdGFzdGFydCwg
JmRhdGFsZW4pOwotICAgIGlmIChyZXN1bHQhPVNBU0xfT0spIHJldHVybiByZXN1bHQ7Ci0KLSAg
ICBpZiAobmQxKSB7Ci0JcmVzdWx0ID0gY2hlY2t2YWxpZF9uZXRzdHJpbmcoZGF0YXN0YXJ0LCBk
YXRhbGVuLCAmbnNfc3RyLCAmbnNfbGVuKTsKLQlpZiAocmVzdWx0IT1TQVNMX09LKSByZXR1cm4g
cmVzdWx0OwotCi0JKm5kMSA9IHV0aWxzLT5tYWxsb2Moc2l6ZW9mKG5ldHN0cmluZ190KStuc19s
ZW4rMSk7Ci0JaWYgKCEqbmQxKSByZXR1cm4gU0FTTF9OT01FTTsKLQotCSgqbmQxKS0+c2l6ZSA9
IG5zX2xlbjsKLQltZW1jcHkoKCpuZDEpLT5kYXRhLCBuc19zdHIsIG5zX2xlbik7Ci0JKCpuZDEp
LT5kYXRhW25zX2xlbl0gPSAnXDAnOwotCi0JZGF0YXN0YXJ0ID0gbnNfc3RyK25zX2xlbisxOwor
ICAgIHIgPSBNYWtlQnVmZmVyKHBhcmFtcy0+dXRpbHMsIG1waU4sIG1waU5sZW4sIG1waWcsIG1w
aWdsZW4sIHV0ZjhMLCB1dGY4TGxlbiwgTlVMTCwgMCwKKwkJICAgc2VydmVyb3V0LCBzZXJ2ZXJv
dXRsZW4pOworICAgIGlmIChyKSB7CisJKmVycnN0ciA9ICJFcnJvciBjcmVhdGluZyBTUlAgYnVm
ZmVyIGZyb20gZGF0YSBpbiBzdGVwIDEiOworCWdvdG8gZmFpbDsKICAgICB9CiAKLSAgICBpZiAo
bmQyKSB7Ci0KLQlyZXN1bHQgPSBjaGVja3ZhbGlkX25ldHN0cmluZyhkYXRhc3RhcnQsIGRhdGFs
ZW4sICZuc19zdHIsICZuc19sZW4pOwotCWlmIChyZXN1bHQhPVNBU0xfT0spIHJldHVybiByZXN1
bHQ7CisgICAgciA9IFNBU0xfQ09OVElOVUU7CisgICAgdGV4dC0+c3RhdGUgPSAyOwogCi0JKm5k
MiA9IHV0aWxzLT5tYWxsb2Moc2l6ZW9mKG5ldHN0cmluZ190KStuc19sZW4rMSk7Ci0JaWYgKCEq
bmQyKSByZXR1cm4gU0FTTF9OT01FTTsKKyBmYWlsOgogCi0JKCpuZDIpLT5zaXplID0gbnNfbGVu
OwotCW1lbWNweSgoKm5kMiktPmRhdGEsIG5zX3N0ciwgbnNfbGVuKTsKLQkoKm5kMiktPmRhdGFb
bnNfbGVuXSA9ICdcMCc7CisgICAgaWYgKHVzZXIpICAgcGFyYW1zLT51dGlscy0+ZnJlZSh1c2Vy
KTsKKyAgICBpZiAocmVhbG0pICBwYXJhbXMtPnV0aWxzLT5mcmVlKHJlYWxtKTsKKyAgICBpZiAo
bXBpTikgICBwYXJhbXMtPnV0aWxzLT5mcmVlKG1waU4pOworICAgIGlmIChtcGlnKSAgIHBhcmFt
cy0+dXRpbHMtPmZyZWUobXBpZyk7CisgICAgaWYgKHV0ZjhMKSAgcGFyYW1zLT51dGlscy0+ZnJl
ZSh1dGY4TCk7CiAKLQlkYXRhc3RhcnQgPSBuc19zdHIrbnNfbGVuKzE7Ci0gICAgfQorICAgIHJl
dHVybiByOworfQogCi0gICAgaWYgKG5kMykgewotCXJlc3VsdCA9IGNoZWNrdmFsaWRfbmV0c3Ry
aW5nKGRhdGFzdGFydCwgZGF0YWxlbiwgJm5zX3N0ciwgJm5zX2xlbik7Ci0JaWYgKHJlc3VsdCE9
U0FTTF9PSykgcmV0dXJuIHJlc3VsdDsKK3N0YXRpYyBpbnQKK3NlcnZlcl9zdGVwMihjb250ZXh0
X3QgKnRleHQsCisJICAgICBzYXNsX3NlcnZlcl9wYXJhbXNfdCAqcGFyYW1zLAorCSAgICAgY29u
c3QgY2hhciAqY2xpZW50aW4sCisJICAgICBpbnQgY2xpZW50aW5sZW4sCisJICAgICBjaGFyICoq
c2VydmVyb3V0LAorCSAgICAgaW50ICpzZXJ2ZXJvdXRsZW4sCisJICAgICBzYXNsX291dF9wYXJh
bXNfdCAqb3BhcmFtcyBfX2F0dHJpYnV0ZV9fKCh1bnVzZWQpKSwKKwkgICAgIGNvbnN0IGNoYXIg
KiplcnJzdHIpCit7CisgICAgY2hhciAqZGF0YTsKKyAgICBpbnQgZGF0YWxlbjsKKyAgICBpbnQg
cjsgICAgCisgICAgY2hhciAqb3NTID0gTlVMTDsKKyAgICBpbnQgb3NTbGVuOworICAgIGNoYXIg
Km1waUIgPSBOVUxMOworICAgIGludCBtcGlCbGVuOworICAgIHNycF9vcHRpb25zX3QgY2xpZW50
X29wdHM7CiAKLQkqbmQzID0gdXRpbHMtPm1hbGxvYyhzaXplb2YobmV0c3RyaW5nX3QpK25zX2xl
bisxKTsKLQlpZiAoISpuZDMpIHJldHVybiBTQVNMX05PTUVNOworICAgIC8qIEV4cGVjdDoKKyAg
ICAgKgorICAgICAqIG8gPSBjbGllbnQgb3B0aW9ucworICAgICAqCisgICAgICogeyB1dGY4KEkp
IG1waShBKSB1dGY4KG8pIH0KKyAgICAgKgorICAgICAqLworICAgIHIgPSBVbkJ1ZmZlcigoY2hh
ciAqKSBjbGllbnRpbiwgY2xpZW50aW5sZW4sICZkYXRhLCAmZGF0YWxlbik7CisgICAgaWYgKHIp
IHsKKwkqZXJyc3RyID0gIkVycm9yIFVuQnVmZmVyaW5nIGlucHV0IGluIHN0ZXAgMiI7CisJcmV0
dXJuIHI7CisgICAgfQogCi0JKCpuZDMpLT5zaXplID0gbnNfbGVuOwotCW1lbWNweSgoKm5kMykt
PmRhdGEsIG5zX3N0ciwgbnNfbGVuKTsKLQkoKm5kMyktPmRhdGFbbnNfbGVuXSA9ICdcMCc7Cisg
ICAgciA9IEdldFVURjgocGFyYW1zLT51dGlscywgZGF0YSwgZGF0YWxlbiwgJnRleHQtPnVzZXJp
ZCwgJmRhdGEsICZkYXRhbGVuKTsKKyAgICBpZiAocikgeworCSplcnJzdHIgPSAiRXJyb3IgcGFy
c2luZyBvdXQgdXNlcmlkIjsKKwlyZXR1cm4gcjsKKyAgICB9CiAKLQlkYXRhc3RhcnQgPSBuc19z
dHIrbnNfbGVuKzE7CisgICAgciA9IEdldE1QSShkYXRhLCBkYXRhbGVuLCAmdGV4dC0+QSwgJmRh
dGEsICZkYXRhbGVuKTsKKyAgICBpZiAocikgeworCSplcnJzdHIgPSAiRXJyb3IgcGFyc2luZyBv
dXQgJ0EnIjsKKwlyZXR1cm4gcjsKICAgICB9CiAKLSAgICBWTCgoIm5ldHN0cmluZyBzcGxpdCB3
b3JrZWRcbiIpKTsKLSAgICAKLSAgICByZXR1cm4gU0FTTF9PSzsKLX0KKyAgICByID0gR2V0VVRG
OChwYXJhbXMtPnV0aWxzLCBkYXRhLCBkYXRhbGVuLCAmdGV4dC0+Y2xpZW50X29wdGlvbnMsICZk
YXRhLCAmZGF0YWxlbik7CisgICAgaWYgKHIpIHsKKwkqZXJyc3RyID0gIkVycm9yIHBhcnNpbmcg
b3V0IGNsaWVudCBvcHRpb25zICdvJyI7CisJcmV0dXJuIHI7CisgICAgfQogCi1zdGF0aWMgaW50
IGNhbGN1bGF0ZV9zZXJ2ZXJfZXZpZGVuY2UoY2hhciAqYXV0aG5hbWUsCi0JCQkJICAgICBtcHpf
dCBBLAotCQkJCSAgICAgdW5zaWduZWQgY2hhciBjbGllbnRfb3B0aW9ucywKLQkJCQkgICAgIGhh
c2hfdCAqTTEsCi0JCQkJICAgICBpbnRlcmxlYXZlZF90ICpLLAotCQkJCSAgICAgaGFzaF90ICpv
dXQsCi0JCQkJICAgICBzYXNsX3V0aWxzX3QgKnV0aWxzKQotewotICAgIGNoYXIgKmNvbmNhdHN0
cjsKLSAgICBpbnQgbGVuOwotICAgIGNoYXIgKk0yOwotICAgIG5ldGRhdGFfdCAqdG1wbmQ7Cisg
ICAgaWYgKGRhdGFsZW4gIT0gMCkgeworCSplcnJzdHIgPSAiRXh0cmEgZGF0YSBpbiByZXF1ZXN0
IHN0ZXAgMiI7CisJcmV0dXJuIFNBU0xfRkFJTDsKKyAgICB9CiAKLSAgICB0bXBuZCA9IGNyZWF0
ZV9uZXRkYXRhX2JpZ2ludChBLCB1dGlscyk7Ci0gICAgaWYgKHRtcG5kPT1OVUxMKSByZXR1cm4g
U0FTTF9OT01FTTsKKyAgICAvKiBHZW5lcmF0ZSBiICovCisgICAgR2V0UmFuZEJpZ0ludCh0ZXh0
LT5iKTsKIAotICAgIGxlbiA9IHN0cmxlbihhdXRobmFtZSkgKyB0bXBuZC0+c2l6ZSArIDEgKyBI
QVNITEVOICsgc2l6ZW9mKEstPmRhdGEpOworICAgIC8qIENhbGN1bGF0ZSBLIChhbmQgQikgKi8K
KyAgICByID0gU2VydmVyQ2FsY3VsYXRlSyhwYXJhbXMtPnV0aWxzLCB0ZXh0LT52LAorCQkJIHRl
eHQtPk4sIHRleHQtPmcsIHRleHQtPmIsIHRleHQtPkIsIHRleHQtPkEsCisJCQkgJnRleHQtPkss
ICZ0ZXh0LT5LbGVuKTsKKyAgICBpZiAocikgeworCSplcnJzdHIgPSAiRXJyb3IgY2FsY3VsYXRp
bmcgSyI7CisJcmV0dXJuIHI7CisgICAgfQogCi0gICAgY29uY2F0c3RyID0gKGNoYXIgKikgdXRp
bHMtPm1hbGxvYyhsZW4rMSk7Ci0gICAgaWYgKCFjb25jYXRzdHIpIHJldHVybiBTQVNMX05PTUVN
OworICAgIC8qIHBhcnNlIGNsaWVudCBvcHRpb25zICovCisgICAgciA9IFBhcnNlT3B0aW9ucyhw
YXJhbXMtPnV0aWxzLCB0ZXh0LT5jbGllbnRfb3B0aW9ucywgJmNsaWVudF9vcHRzKTsKKyAgICBp
ZiAocikgeworCSplcnJzdHIgPSAiRXJyb3IgcGFyc2luZyB1c2VyJ3Mgb3B0aW9ucyI7CisJcmV0
dXJuIHI7CisgICAgfQogCi0gICAgLyogU2VydmVyIGNhbGN1bGF0ZSBldmlkZW5jZSBNMgotICAg
ICAqIE0yID0gSChVIHwgQSB8IG8gfCBNMSB8IEspCi0gICAgKi8KKyAgICByID0gU2V0T3B0aW9u
cygmY2xpZW50X29wdHMsIHRleHQsIHBhcmFtcy0+dXRpbHMsIG9wYXJhbXMpOworICAgIGlmIChy
KSB7CisJKmVycnN0ciA9ICJFcnJvciBzZXR0aW5nIG9wdGlvbnMiOworCXJldHVybiByOyAgIAor
ICAgIH0KIAotICAgIE0yID0gKGNoYXIgKikgY29uY2F0c3RyOworICAgIC8qIFNlbmQgb3V0Ogor
ICAgICAqCisgICAgICogcyAtIHNhbHQKKyAgICAgKiBCIC0gc2VydmVyJ3MgcHVibGljIGtleQor
ICAgICAqCisgICAgICogeyBvcyhzKSBtcGkoQikgfQorICAgICAqLwogICAgIAotICAgIC8qIGFk
ZCBVIChhdXRobmFtZSkgKi8KLSAgICBtZW1jcHkoTTIsIGF1dGhuYW1lLCBzdHJsZW4oYXV0aG5h
bWUpKTsKLSAgICBNMis9c3RybGVuKGF1dGhuYW1lKTsKLQotICAgIC8qIGFwcGVuZCBBICovCi0g
ICAgbWVtY3B5KE0yLHRtcG5kLT5kYXRhLCB0bXBuZC0+c2l6ZSk7Ci0gICAgTTIrPXRtcG5kLT5z
aXplOwotICAgIHV0aWxzLT5mcmVlKHRtcG5kKTsgICAgCi0KLSAgICAvKiBhcHBlbmQgbyAob3B0
aW9ucykgKi8KLSAgICBNMlswXSA9IGNsaWVudF9vcHRpb25zOwotICAgIE0yKz0xOwotCi0gICAg
LyogYXBwZW5kIE0xICovCi0gICAgbWVtY3B5KE0yLCBNMS0+ZGF0YSwgc2l6ZW9mKE0xLT5kYXRh
KSk7Ci0gICAgTTIrPXNpemVvZihNMS0+ZGF0YSk7Ci0KLSAgICAvKiBhcHBlbmQgSyAqLwotICAg
IG1lbWNweShNMiwgSy0+ZGF0YSwgc2l6ZW9mKEstPmRhdGEpKTsKKyAgICByID0gTWFrZU9TKHBh
cmFtcy0+dXRpbHMsIHRleHQtPnNhbHQsIHRleHQtPnNhbHRsZW4sICZvc1MsICZvc1NsZW4pOwor
ICAgIGlmIChyKSB7CisJKmVycnN0ciA9ICJFcnJvciB0dXJuaW5nIHNhbHQgaW50byAnb3MnIHN0
cmluZyI7CisJZ290byBlbmQ7CisgICAgfQogICAgIAotICAgIEhhc2goY29uY2F0c3RyLCBsZW4s
IG91dCk7Ci0KLSAgICByZXR1cm4gU0FTTF9PSzsKLX0KLQotc3RhdGljIGludCBjYWxjdWxhdGVf
Y2xpZW50X2V2aWRlbmNlKG1wel90IE4sIG1wel90IGcsCi0JCQkJICAgICBjaGFyICpzYWx0LCBp
bnQgc2FsdGxlbiwKLQkJCQkgICAgIHVuc2lnbmVkIGNoYXIgc2VydmVyX29wdGlvbnMsCi0JCQkJ
ICAgICBtcHpfdCBBLCBtcHpfdCBCLAotCQkJCSAgICAgaW50ZXJsZWF2ZWRfdCAqSywKLQkJCQkg
ICAgIGhhc2hfdCAqb3V0LAotCQkJCSAgICAgc2FzbF91dGlsc190ICp1dGlscykKLXsKLSAgICBo
YXNoX3QgSG47Ci0gICAgaGFzaF90IEhnOwotICAgIGNoYXIgY29uY2F0c3RyW0hBU0hMRU4rTUFY
QklHTlVNTEVOKzErTUFYQklHTlVNTEVOK01BWEJJR05VTUxFTitIQVNITEVOKjJdOwotICAgIGNo
YXIgKk0xOwotICAgIGludCBsdXA7Ci0gICAgbmV0ZGF0YV90ICp0bXBuZDsKLQotICAgIC8qIENs
aWVudCBjYWxjdWxhdGUgZXZpZGVuY2UgTTEKLSAgICAgICBNMSA9IEgoSChOKSBYT1IgSChnKSB8
IHMgfCBaIHwgQSB8IEIgfCBLKQotICAgICovCi0KLSAgICBIYXNoX2JpZ2ludChOLCAmSG4sIHV0
aWxzKTsKLSAgICBIYXNoX2JpZ2ludChnLCAmSGcsIHV0aWxzKTsKKyAgICByID0gTWFrZU1QSShw
YXJhbXMtPnV0aWxzLCB0ZXh0LT5CLCAmbXBpQiwgJm1waUJsZW4pOworICAgIGlmIChyKSB7CisJ
KmVycnN0ciA9ICJFcnJvciB0dXJuaW5nICdCJyBpbnRvICdtcGknIHN0cmluZyI7CisJZ290byBl
bmQ7CisgICAgfQogICAgIAotICAgIC8qIEhuIFhPUiBIZyBpbnRvIEhuKi8KLSAgICBmb3IgKGx1
cD0wO2x1cDxIQVNITEVOO2x1cCsrKQotCUhuLmRhdGFbbHVwXT1Ibi5kYXRhW2x1cF1eSGcuZGF0
YVtsdXBdOwotCi0gICAgTTEgPSAoY2hhciAqKSBjb25jYXRzdHI7Ci0gICAgbWVtY3B5KE0xLEhu
LmRhdGEsIEhBU0hMRU4pOwotICAgIE0xKz1IQVNITEVOOworICAgIHIgPSBNYWtlQnVmZmVyKHBh
cmFtcy0+dXRpbHMsIG9zUywgb3NTbGVuLCBtcGlCLCBtcGlCbGVuLCBOVUxMLCAwLCBOVUxMLCAw
LAorCQkgICBzZXJ2ZXJvdXQsIHNlcnZlcm91dGxlbik7CisgICAgaWYgKHIpIHsKKwkqZXJyc3Ry
ID0gIkVycm9yIHB1dHRpbmcgYWxsIHRoZSBkYXRhIHRvZ2V0aGVyIGluIHN0ZXAgMiI7CisJZ290
byBlbmQ7CisgICAgfQogICAgIAotCi0gICAgLyogYXBwZW5kIHNhbHQgKi8KLSAgICBtZW1jcHko
TTEsc2FsdCwgc2FsdGxlbik7Ci0gICAgTTErPXNhbHRsZW47Ci0KLSAgICAvKiBhcHBlbmQgWiAo
b3B0aW9ucykgKi8KLSAgICBNMVswXSA9IHNlcnZlcl9vcHRpb25zOwotICAgIE0xKz0xOwotCi0g
ICAgLyogYXBwZW5kIEEgKi8KLSAgICB0bXBuZCA9IGNyZWF0ZV9uZXRkYXRhX2JpZ2ludChBLCB1
dGlscyk7Ci0gICAgaWYgKHRtcG5kPT1OVUxMKSByZXR1cm4gU0FTTF9OT01FTTsKLSAgICBtZW1j
cHkoTTEsdG1wbmQtPmRhdGEsIHRtcG5kLT5zaXplKTsKLSAgICBNMSs9dG1wbmQtPnNpemU7Ci0g
ICAgdXRpbHMtPmZyZWUodG1wbmQpOwotCi0gICAgLyogYXBwZW5kIEIgKi8KLSAgICB0bXBuZCA9
IGNyZWF0ZV9uZXRkYXRhX2JpZ2ludChCLCB1dGlscyk7Ci0gICAgaWYgKHRtcG5kPT1OVUxMKSBy
ZXR1cm4gU0FTTF9OT01FTTsKLSAgICBtZW1jcHkoTTEsdG1wbmQtPmRhdGEsIHRtcG5kLT5zaXpl
KTsKLSAgICBNMSs9dG1wbmQtPnNpemU7Ci0gICAgdXRpbHMtPmZyZWUodG1wbmQpOwotCi0gICAg
LyogYXBwZW5kIEsgKi8KLSAgICBtZW1jcHkoTTEsIEstPmRhdGEsIHNpemVvZihLLT5kYXRhKSk7
Ci0gICAgTTErPXNpemVvZihLLT5kYXRhKTsKKyAgICB0ZXh0LT5zdGF0ZSArKzsKKyAgICByID0g
U0FTTF9DT05USU5VRTsKIAotICAgIEhhc2goY29uY2F0c3RyLCBNMS1jb25jYXRzdHIsIG91dCk7
CisgZW5kOgorICAgIGlmIChvc1MpICAgICBwYXJhbXMtPnV0aWxzLT5mcmVlKG9zUyk7CisgICAg
aWYgKG1waUIpICAgIHBhcmFtcy0+dXRpbHMtPmZyZWUobXBpQik7CiAKLSAgICByZXR1cm4gU0FT
TF9PSzsKKyAgICByZXR1cm4gcjsKIH0KIAotCiAKLQotc3RhdGljIGludCBnZXRfc2FsdF9hbmRf
dmVyaWZpZXIoY29uc3QgY2hhciAqdXNlcmlkLCBjb25zdCBjaGFyICpyZWFsbSwKLQkJCQkgc2Fz
bF91dGlsc190ICp1dGlscywgc2F2ZWRpbmZvX3QgKipzaW5mbywKLQkJCQkgY29uc3QgY2hhciAq
KmVycnN0cikKK3N0YXRpYyBpbnQKK3NlcnZlcl9zdGVwMyhjb250ZXh0X3QgKnRleHQsCisJICAg
ICBzYXNsX3NlcnZlcl9wYXJhbXNfdCAqcGFyYW1zLAorCSAgICAgY29uc3QgY2hhciAqY2xpZW50
aW4sCisJICAgICBpbnQgY2xpZW50aW5sZW4sCisJICAgICBjaGFyICoqc2VydmVyb3V0LAorCSAg
ICAgaW50ICpzZXJ2ZXJvdXRsZW4sCisJICAgICBzYXNsX291dF9wYXJhbXNfdCAqb3BhcmFtcyBf
X2F0dHJpYnV0ZV9fKCh1bnVzZWQpKSwKKwkgICAgIGNvbnN0IGNoYXIgKiplcnJzdHIpCiB7Ci0g
ICAgc2FzbF9zZXJ2ZXJfZ2V0c2VjcmV0X3QgKmdldHNlY3JldDsKLSAgICB2b2lkICpnZXRzZWNy
ZXRfY29udGV4dDsKLSAgICBzYXNsX3NlY3JldF90ICpzZWM9TlVMTDsKLSAgICBpbnQgcmVzdWx0
OwotICAgIGludCBzYWx0bGVuPTE2OwotICAgIGNoYXIgKnZzdHI7Ci0gICAgaW50IHZsZW47Ci0K
LSAgICAvKiBnZXQgY2FsbGJhY2sgc28gd2UgY2FuIHJlcXVlc3QgdGhlIHNlY3JldCAqLwotICAg
IHJlc3VsdCA9IHV0aWxzLT5nZXRjYWxsYmFjayh1dGlscy0+Y29ubiwKLQkJCQlTQVNMX0NCX1NF
UlZFUl9HRVRTRUNSRVQsCi0JCQkJJmdldHNlY3JldCwKLQkJCQkmZ2V0c2VjcmV0X2NvbnRleHQp
OwotICAgIGlmIChyZXN1bHQgIT0gU0FTTF9PSykgewotCVZMKCgicmVzdWx0ID0gJWkgdHJ5aW5n
IHRvIGdldCBzZWNyZXQgY2FsbGJhY2tcbiIscmVzdWx0KSk7Ci0JcmV0dXJuIHJlc3VsdDsKKyAg
ICBjaGFyICpkYXRhOworICAgIGludCBkYXRhbGVuOworICAgIGludCByOyAgICAKKyAgICBjaGFy
ICpNMSA9IE5VTEw7CisgICAgaW50IE0xbGVuOworICAgIGNoYXIgKm15TTEgPSBOVUxMOworICAg
IGludCBteU0xbGVuOworICAgIGNoYXIgKk0yID0gTlVMTDsKKyAgICBpbnQgTTJsZW47CisgICAg
aW50IGk7CisgICAgY2hhciAqb3NNMiA9IE5VTEw7CisgICAgaW50IG9zTTJsZW47CisgICAgCisg
ICAgLyogRXhwZWN0OgorICAgICAqCisgICAgICogTTEgPSBjbGllbnQgZXZpZGVuY2UKKyAgICAg
KgorICAgICAqIHsgb3MoTTEpIH0KKyAgICAgKgorICAgICAqLworICAgIHIgPSBVbkJ1ZmZlcigo
Y2hhciAqKSBjbGllbnRpbiwgY2xpZW50aW5sZW4sICZkYXRhLCAmZGF0YWxlbik7CisgICAgaWYg
KHIpIHsKKwkqZXJyc3RyID0gIkVycm9yIHBhcnNpbmcgaW5wdXQgYnVmZmVyIGluIHN0ZXAgMyI7
CisJZ290byBlbmQ7CiAgICAgfQotICAgIGlmICghIGdldHNlY3JldCkgewotCVZMKCgiUmVjZWl2
ZWQgTlVMTCBnZXRzZWNyZXQgY2FsbGJhY2tcbiIpKTsKLQlyZXR1cm4gU0FTTF9GQUlMOworCisg
ICAgciA9IEdldE9TKHBhcmFtcy0+dXRpbHMsIGRhdGEsIGRhdGFsZW4sICZNMSwmTTFsZW4sICZk
YXRhLCAmZGF0YWxlbik7CisgICAgaWYgKHIpIHsKKwkqZXJyc3RyID0gIkVycm9yIGdldHRpbmcg
J29zJyBNMSAoY2xpZW50IGV2aWRlbmljZSkiOworCWdvdG8gZW5kOwogICAgIH0KIAotICAgIC8q
IFJlcXVlc3Qgc2VjcmV0ICovCi0gICAgcmVzdWx0ID0gZ2V0c2VjcmV0KGdldHNlY3JldF9jb250
ZXh0LCAiU1JQIiwgdXNlcmlkLCByZWFsbSwgJnNlYyk7Ci0gICAgaWYgKHJlc3VsdCA9PSBTQVNM
X05PVVNFUiB8fCAhc2VjKSB7Ci0gICAgICBpZiAoZXJyc3RyKSAqZXJyc3RyID0gIm5vIHNlY3Jl
dCBpbiBkYXRhYmFzZSI7Ci0gICAgICByZXR1cm4gU0FTTF9OT1VTRVI7CisgICAgaWYgKGRhdGFs
ZW4gIT0gMCkgeworCXIgPSBTQVNMX0ZBSUw7CisJKmVycnN0ciA9ICJFeHRyYSBkYXRhIGluIGlu
cHV0IFNSUCBzdGVwIDMiOworCWdvdG8gZW5kOwogICAgIH0KLSAgICBpZiAocmVzdWx0ICE9IFNB
U0xfT0spIHsKLQlyZXR1cm4gcmVzdWx0OworCisgICAgLyogU2VlIGlmIE0xIGlzIGNvcnJlY3Qg
Ki8KKyAgICByID0gQ2FsY3VsYXRlTTEocGFyYW1zLT51dGlscywgdGV4dC0+TiwgdGV4dC0+Zywg
dGV4dC0+YXV0aGlkLCB0ZXh0LT5zYWx0LCB0ZXh0LT5zYWx0bGVuLAorCQkgICAgdGV4dC0+c2Vy
dmVyX29wdGlvbnMsIHRleHQtPkEsIHRleHQtPkIsIHRleHQtPkssIHRleHQtPktsZW4sCisJCSAg
ICAmbXlNMSwgJm15TTFsZW4pOworICAgIGlmIChyKSB7CQorCSplcnJzdHIgPSAiRXh0cmEgY2Fs
Y3VsYXRpbmcgTTEiOworCWdvdG8gZW5kOwogICAgIH0KIAotICAgIGlmIChzZWMtPmxlbiA8IHNh
bHRsZW4pIHsKLQlWTCgoIlNlY3JldCBkYXRhYmFzZSBjb3JydXB0aW9uIChzaXplICVkKVxuIixz
ZWMtPmxlbikpOwotCWlmIChlcnJzdHIpICplcnJzdHIgPSAic2VjcmV0IGRhdGFiYXNlIGNvcnJ1
cHRpb24iOwotCXJldHVybiBTQVNMX0ZBSUw7CisgICAgaWYgKG15TTFsZW4gIT0gTTFsZW4pIHsK
KwkqZXJyc3RyID0gIk0xIGxlbmd0aHMgZG8gbm90IG1hdGNoIjsKKwlWTCgoIk0xIGxlbmd0aHMg
ZG8gbm90IG1hdGNoOiAlZCB2cyAlZCIsTTFsZW4sIG15TTFsZW4pKTsKKwlnb3RvIGVuZDsKICAg
ICB9CiAKLSAgICAvKiBkYXRhIGlzIGluIGZvcm1hdAorICAgIGZvciAoaSA9IDA7IGkgPCBteU0x
bGVuOyBpKyspIHsKKwlpZiAobXlNMVtpXSAhPSBNMVtpXSkgeworCSAgICAqZXJyc3RyID0gImNs
aWVudCBldmlkZW5jZSBkb2VzIG5vdCBtYXRjaCB3aGF0IHdlIGNhbGN1bGF0ZWQuIFByb2JhYmx5
IGEgcGFzc3dvcmQgZXJyb3IiOworCSAgICByID0gU0FTTF9CQURBVVRIOworCSAgICBnb3RvIGVu
ZDsKKwl9CisgICAgfQorCisgICAgLyogY2FsY3VsYXRlIE0yIHRvIHNlbmQgKi8KKyAgICByID0g
Q2FsY3VsYXRlTTIocGFyYW1zLT51dGlscywgdGV4dC0+QSwgdGV4dC0+YXV0aGlkLCB0ZXh0LT51
c2VyaWQsCisJCSAgICB0ZXh0LT5jbGllbnRfb3B0aW9ucywgbXlNMSwgbXlNMWxlbiwgdGV4dC0+
SywgdGV4dC0+S2xlbiwKKwkJICAgICZNMiwgJk0ybGVuKTsKKyAgICBpZiAocikgeworCSplcnJz
dHIgPSAiRXJyb3IgY2FsY3VsYXRpbmcgTTIgKHNlcnZlciBldmlkZW5jZSkiOworCWdvdG8gZW5k
OworICAgIH0KKyAgICAKKyAgICAvKiBTZW5kIG91dDoKKyAgICAgKgorICAgICAqIE0yID0gCiAg
ICAgICoKLSAgICAgKiBzYWx0IC0gc2VyaWVzIG9mIGJ5dGVzCi0gICAgICogdmVyaWZpZXIgLSBu
ZXRzdHJpbmcKLSAgICAgKi8gICAgCi0gICAgKnNpbmZvID0gKHNhdmVkaW5mb190ICopIHV0aWxz
LT5tYWxsb2Moc2l6ZW9mKHNhdmVkaW5mb190KSk7Ci0gICAgaWYgKCEqc2luZm8pIHJldHVybiBT
QVNMX05PTUVNOworICAgICAqIHsgb3MoTTIpIH0KKyAgICAgKi8KKyAgICAKKyAgICByID0gTWFr
ZU9TKHBhcmFtcy0+dXRpbHMsIE0yLCBNMmxlbiwgJm9zTTIsICZvc00ybGVuKTsKKyAgICBpZiAo
cikgeworCSplcnJzdHIgPSAiRXJyb3IgbWFraW5nICdvcycgc3RyaW5nIGZyb20gTTIgKHNlcnZl
ciBldmlkZW5jZSkiOworCWdvdG8gZW5kOworICAgIH0KKyAgICAKKyAgICByID0gTWFrZUJ1ZmZl
cihwYXJhbXMtPnV0aWxzLCBvc00yLCBvc00ybGVuLCBOVUxMLCAwLCBOVUxMLCAwLCBOVUxMLCAw
LAorCQkgICBzZXJ2ZXJvdXQsIHNlcnZlcm91dGxlbik7CisgICAgaWYgKHIpIHsKKwkqZXJyc3Ry
ID0gIkVycm9yIG1ha2luZyBvdXRwdXQgYnVmZmVyIGluIFNSUCBzdGVwIDMiOworCWdvdG8gZW5k
OworICAgIH0KKyAgICAKKyAgICB0ZXh0LT5zdGF0ZSArKzsKKyAgICByID0gU0FTTF9DT05USU5V
RTsKKyBlbmQ6CiAKLSAgICBzYWx0bGVuID0gc2l6ZW9mKCAoKnNpbmZvKS0+c2FsdCk7CisgICAg
aWYgKG9zTTIpICAgcGFyYW1zLT51dGlscy0+ZnJlZShvc00yKTsKKyAgICBpZiAoTTIpICAgICBw
YXJhbXMtPnV0aWxzLT5mcmVlKE0yKTsKKyAgICBpZiAobXlNMSkgICBwYXJhbXMtPnV0aWxzLT5m
cmVlKG15TTEpOworICAgIGlmIChNMSkgICAgIHBhcmFtcy0+dXRpbHMtPmZyZWUoTTEpOwogCi0g
ICAgbWVtY3B5KCAoKnNpbmZvKS0+c2FsdCwgc2VjLT5kYXRhLCBzYWx0bGVuKTsKKyAgICByZXR1
cm4gcjsgICAgCit9CiAKLSAgICByZXN1bHQgPSBjaGVja3ZhbGlkX25ldHN0cmluZygoY2hhciAq
KSBzZWMtPmRhdGErc2FsdGxlbixzZWMtPmxlbi1zYWx0bGVuLCAmdnN0ciwgJnZsZW4pOwotICAg
IGlmIChyZXN1bHQhPVNBU0xfT0spIHsKLQlWTCgoIkludmFsaWQgbmV0c3RyaW5nIHNhdmVkLiBE
YXRhYmFzZSBjb3JydXB0ZWRcbiIpKTsKLQlyZXR1cm4gcmVzdWx0OyAgICAgICAgICAKK3N0YXRp
YyBpbnQKK3NlcnZlcl9zdGVwNChjb250ZXh0X3QgKnRleHQsCisJICAgICBzYXNsX3NlcnZlcl9w
YXJhbXNfdCAqcGFyYW1zIF9fYXR0cmlidXRlX18oKHVudXNlZCkpLAorCSAgICAgY29uc3QgY2hh
ciAqY2xpZW50aW4gX19hdHRyaWJ1dGVfXygodW51c2VkKSksCisJICAgICBpbnQgY2xpZW50aW5s
ZW4sCisJICAgICBjaGFyICoqc2VydmVyb3V0LAorCSAgICAgaW50ICpzZXJ2ZXJvdXRsZW4sCisJ
ICAgICBzYXNsX291dF9wYXJhbXNfdCAqb3BhcmFtcywKKwkgICAgIGNvbnN0IGNoYXIgKiplcnJz
dHIpCit7CisgICAgaWYgKGNsaWVudGlubGVuID4gMCkgeworCSplcnJzdHIgPSAiRGF0YSBpcyBu
b3QgdmFsaWQgaW4gU1JQIHN0ZXAgNCI7CisJcmV0dXJuIFNBU0xfRkFJTDsKICAgICB9CiAKLSAg
ICByZXN1bHQgPSBiaWdpbnRfZnJvbXN0cih2c3RyLCB2bGVuLCB1dGlscywgKCpzaW5mbyktPnZl
cmlmaWVyKTsKLSAgICBpZiAocmVzdWx0IT1TQVNMX09LKSB7Ci0JVkwoKCJVbmFibGUgdG8gbWFr
ZSBiaWdpbnQgZnJvbSBzdHJpbmdcbiIpKTsKLQlyZXR1cm4gcmVzdWx0OwotICAgIH0KKyAgICAv
KiBTZXQgb3BhcmFtcyAqLworICAgIG9wYXJhbXMtPmRvbmVmbGFnPTE7CisKKyAgICBvcGFyYW1z
LT5hdXRoaWQgPSB0ZXh0LT5hdXRoaWQ7CisgICAgdGV4dC0+YXV0aGlkID0gTlVMTDsgLyogc2V0
IHRvIG51bGwgc28gd2UgZG9uJ3QgZnJlZSAqLworICAgIG9wYXJhbXMtPnVzZXIgPSB0ZXh0LT51
c2VyaWQ7IC8qIHNldCB1c2VybmFtZSAqLworICAgIHRleHQtPnVzZXJpZCA9IE5VTEw7IC8qIHNl
dCB0byBudWxsIHNvIHdlIGRvbid0IGZyZWUgKi8KKyAgICBvcGFyYW1zLT5yZWFsbSA9IE5VTEw7
CiAgICAgCisgICAgb3BhcmFtcy0+cGFyYW1fdmVyc2lvbiA9IDA7CisKKyAgICAqc2VydmVyb3V0
ID0gTlVMTDsKKyAgICAqc2VydmVyb3V0bGVuID0gMDsKKworICAgIHRleHQtPnN0YXRlKys7CiAg
ICAgcmV0dXJuIFNBU0xfT0s7CiB9CiAKLQogc3RhdGljIGludAotc2VydmVyX2NvbnRpbnVlX3N0
ZXAgKHZvaWQgKmNvbm5fY29udGV4dCwKLQkgICAgICAgc2FzbF9zZXJ2ZXJfcGFyYW1zX3QgKnNw
YXJhbXMsCi0JICAgICAgIGNvbnN0IGNoYXIgKmNsaWVudGluLAotCSAgICAgICBpbnQgY2xpZW50
aW5sZW4sCi0JICAgICAgIGNoYXIgKipzZXJ2ZXJvdXQsCi0JICAgICAgIGludCAqc2VydmVyb3V0
bGVuLAotCSAgICAgICBzYXNsX291dF9wYXJhbXNfdCAqb3BhcmFtcywKLQkgICAgICAgY29uc3Qg
Y2hhciAqKmVycnN0cikKK3NlcnZlcl9jb250aW51ZV9zdGVwKHZvaWQgKmNvbm5fY29udGV4dCwK
KwkJICAgICBzYXNsX3NlcnZlcl9wYXJhbXNfdCAqc3BhcmFtcywKKwkJICAgICBjb25zdCBjaGFy
ICpjbGllbnRpbiwKKwkJICAgICBpbnQgY2xpZW50aW5sZW4sCisJCSAgICAgY2hhciAqKnNlcnZl
cm91dCwKKwkJICAgICBpbnQgKnNlcnZlcm91dGxlbiwKKwkJICAgICBzYXNsX291dF9wYXJhbXNf
dCAqb3BhcmFtcywKKwkJICAgICBjb25zdCBjaGFyICoqZXJyc3RyKQogewotICBpbnQgcmVzdWx0
OwogICBjb250ZXh0X3QgKnRleHQgPSAoY29udGV4dF90ICopIGNvbm5fY29udGV4dDsKKyAgY29u
c3QgY2hhciAqbXllcnJzdHI7CiAKICAgaWYgKCFzcGFyYW1zCiAgICAgICB8fCAhc2VydmVyb3V0
CkBAIC0xMDE5LDIxNiArMjI4NiwyNyBAQAogICBpZiAoY2xpZW50aW5sZW4gPCAwKQogICAgICAg
cmV0dXJuIFNBU0xfQkFEUEFSQU07CiAKLSAgaWYgKGVycnN0cikKLSAgICAgICplcnJzdHIgPSBO
VUxMOworICBpZiAoIWVycnN0cikgZXJyc3RyID0gJm15ZXJyc3RyOworICAqZXJyc3RyID0gTlVM
TDsKIAogICBWTCgoIlNSUCBzZXJ2ZXIgc3RlcCAlZFxuIix0ZXh0LT5zdGF0ZSkpOwotCi0gIGlm
ICh0ZXh0LT5zdGF0ZSA9PSAxKSB7Ci0gICAgICBuZXRzdHJpbmdfdCAqbnMxOwotICAgICAgbmV0
c3RyaW5nX3QgKm5zMjsKLSAgICAgIG5ldHN0cmluZ190ICpuczM7Ci0KLSAgICAgIC8qIFNlcnZl
ciBzZW5kcyBOLCBnLCBhbmQgWiAqLwotCi0gICAgICAvKgotICAgICAgICogTiAgLSBBIGxhcmdl
IHNhZmUgcHJpbWUgKE4gPSAycSsxLCB3aGVyZSBxIGlzIHByaW1lKSBBbGwgYXJpdGhtZXRpYyBp
cyBkb25lIG1vZHVsbyBOIAotICAgICAgICogZyAgLSBnZW5lcmF0b3IKLSAgICAgICAqLwotCi0g
ICAgICAgLyogZ2VuZXJhdGUgTiBhbmQgZyAqLwotICAgICAgIHJlc3VsdCA9IGdlbmVyYXRlX05f
YW5kX2codGV4dC0+Tix0ZXh0LT5nKTsKLSAgICAgICBpZiAocmVzdWx0IT1TQVNMX09LKSByZXR1
cm4gcmVzdWx0OwotCi0gICAgICAgLyogc2V0IFogKi8KLSAgICAgICAvKiB4eHggZXZlcnl0aGlu
ZyBvZmYgcmlnaHQgbm93ICovCi0gICAgICAgdGV4dC0+c2VydmVyX29wdGlvbnMgPSAwOwotICAg
ICAgIAotICAgICAgIG5zMSA9IGNyZWF0ZV9uZXRzdHJpbmdfYmlnaW50KHRleHQtPk4sc3BhcmFt
cy0+dXRpbHMpOwotICAgICAgIG5zMiA9IGNyZWF0ZV9uZXRzdHJpbmdfYmlnaW50KHRleHQtPmcs
c3BhcmFtcy0+dXRpbHMpOwotICAgICAgIG5zMyA9IGNyZWF0ZV9uZXRzdHJpbmdfc3RyKCYodGV4
dC0+c2VydmVyX29wdGlvbnMpLDEsc3BhcmFtcy0+dXRpbHMpOwotCi0gICAgICAgLyogcHV0IHRo
ZW0gYWxsIHRvZ2V0aGVyICovCi0gICAgICAgbWVyZ2VfbmV0c3RyaW5ncyhzcGFyYW1zLT51dGls
cyxuczEsbnMyLG5zMywgc2VydmVyb3V0LCBzZXJ2ZXJvdXRsZW4pOwogCi0gICAgICAgdGV4dC0+
c3RhdGUgPSAyOwotCi0gICAgICAgcmV0dXJuIFNBU0xfQ09OVElOVUU7Ci0gIH0KLSAgaWYgKHRl
eHQtPnN0YXRlID09IDIpIHsKLSAgICAgIG5ldGRhdGFfdCAqbmQxPU5VTEw7Ci0gICAgICBuZXRk
YXRhX3QgKm5kMj1OVUxMOwotICAgICAgbmV0ZGF0YV90ICpuZDM9TlVMTDsKLQotICAgICAgbmV0
c3RyaW5nX3QgKm5zMT1OVUxMOwotICAgICAgbmV0c3RyaW5nX3QgKm5zMj1OVUxMOwotICAgICAg
aW50IHJlc3VsdDsKLSAgICAgIGhhc2hfdCBoYXNoZWRCOwotICAgICAgdW5zaWduZWQgaW50IHU7
Ci0gICAgICBtcHpfdCB4OwotCi0gICAgICAvKiBXZSByZWNlaXZlZDoKLSAgICAgICAqCi0gICAg
ICAgKiBVIC0gYXV0aG5hbWUgCi0gICAgICAgKiBBIC0gY2xpZW50J3MgcHVibGljIGtleQotICAg
ICAgICogbyAtIG9wdGlvbnMKLSAgICAgICAqLwotCi0gICAgICByZXN1bHQgPSBzcGxpdF9uZXRz
dHJpbmdzKHNwYXJhbXMtPnV0aWxzLCAmbmQxLCZuZDIsJm5kMywKLQkJCQkoY2hhciAqKSBjbGll
bnRpbiwgY2xpZW50aW5sZW4pOwotICAgICAgaWYgKHJlc3VsdCE9U0FTTF9PSykgcmV0dXJuIHJl
c3VsdDsKLQotICAgICAgcmVzdWx0ID0gYmlnaW50X2Zyb21uZXRkYXRhKG5kMixzcGFyYW1zLT51
dGlscyAsdGV4dC0+QSk7Ci0gICAgICBpZiAocmVzdWx0IT1TQVNMX09LKSByZXR1cm4gcmVzdWx0
OwotCi0gICAgICBwcmludGYoInNlcnZlciBBOiAiKTsKLSAgICAgIG1wel9vdXRfc3RyIChzdGRv
dXQsIDEwLCB0ZXh0LT5BKTsKLSAgICAgIHByaW50ZigiXG4iKTsKKyAgc3dpdGNoKHRleHQtPnN0
YXRlKQorICAgICAgeworICAgICAgY2FzZSAwOgorICAgICAgY2FzZSAxOiByZXR1cm4gc2VydmVy
X3N0ZXAxKHRleHQsIHNwYXJhbXMsIGNsaWVudGluLCBjbGllbnRpbmxlbiwKKwkJCQkgIHNlcnZl
cm91dCwgc2VydmVyb3V0bGVuLCBvcGFyYW1zLCBlcnJzdHIpOworICAgICAgY2FzZSAyOiByZXR1
cm4gc2VydmVyX3N0ZXAyKHRleHQsIHNwYXJhbXMsIGNsaWVudGluLCBjbGllbnRpbmxlbiwKKwkJ
CQkgIHNlcnZlcm91dCwgc2VydmVyb3V0bGVuLCBvcGFyYW1zLCBlcnJzdHIpOworICAgICAgY2Fz
ZSAzOiByZXR1cm4gc2VydmVyX3N0ZXAzKHRleHQsIHNwYXJhbXMsIGNsaWVudGluLCBjbGllbnRp
bmxlbiwKKwkJCQkgIHNlcnZlcm91dCwgc2VydmVyb3V0bGVuLCBvcGFyYW1zLCBlcnJzdHIpOwor
ICAgICAgY2FzZSA0OiByZXR1cm4gc2VydmVyX3N0ZXA0KHRleHQsIHNwYXJhbXMsIGNsaWVudGlu
LCBjbGllbnRpbmxlbiwKKwkJCQkgIHNlcnZlcm91dCwgc2VydmVyb3V0bGVuLCBvcGFyYW1zLCBl
cnJzdHIpOwogCi0gICAgICBpZiAobmQzLT5zaXplIT0xKSB7Ci0JICBWTCgoIk9wdGlvbnMgaXMg
d3Jvbmcgc2l6ZVxuIikpOworICAgICAgZGVmYXVsdDoKKwkgICplcnJzdHIgPSAiSW52YWxpZCBT
UlAgc2VydmVyIHN0ZXAiOwogCSAgcmV0dXJuIFNBU0xfRkFJTDsKICAgICAgIH0KLSAgICAgIHRl
eHQtPmNsaWVudF9vcHRpb25zID0gbmQzLT5kYXRhWzBdOwotCi0gICAgICAvKiB4eHggZG8gc29t
ZXRoaW5nIHdpdGggb3B0aW9ucyAqLwotICAgICAgCi0gICAgICAvKiBXZSBzZW5kOgotICAgICAg
ICoKLSAgICAgICAqIHMgLSBzYWx0Ci0gICAgICAgKiBCIC0gc2VydmVyIHB1YmxpYyBrZXkKLSAg
ICAgICAqLwotCi0gICAgICByZXN1bHQgPSBwYXJzZXVzZXIoc3BhcmFtcy0+dXRpbHMsICZ0ZXh0
LT5hdXRoaWQsICZ0ZXh0LT5yZWFsbSwgc3BhcmFtcy0+dXNlcl9yZWFsbSwKLQkJCSBzcGFyYW1z
LT5zZXJ2ZXJGUUROLCBuZDEtPmRhdGEpOwotICAgICAgaWYgKHJlc3VsdCAhPSBTQVNMX09LKSB7
Ci0JICByZXR1cm4gcmVzdWx0OwotICAgICAgfQotCi0gICAgICBwcmludGYoImF1dGhpZCA9ICVz
IHJlYWxtID0gJXNcbiIsdGV4dC0+YXV0aGlkLHRleHQtPnJlYWxtKTsKLQotICAgICAgcmVzdWx0
ID0gZ2V0X3NhbHRfYW5kX3ZlcmlmaWVyKHRleHQtPmF1dGhpZCx0ZXh0LT5yZWFsbSwKLQkJCQkg
ICAgIHNwYXJhbXMtPnV0aWxzLCAmKHRleHQtPnNpbmZvKSwgZXJyc3RyKTsKLSAgICAgIGlmIChy
ZXN1bHQhPVNBU0xfT0spIHJldHVybiByZXN1bHQ7Ci0KLSAgICAgIFZMKCgiUmV0cmlldmVkIHNh
bHQgZnJvbSBkYlxuIikpOwotCi0gICAgICBuczEgPSBjcmVhdGVfbmV0c3RyaW5nX3N0cih0ZXh0
LT5zaW5mby0+c2FsdCwgc2l6ZW9mKHRleHQtPnNpbmZvLT5zYWx0KSwgc3BhcmFtcy0+dXRpbHMp
OwotCi0gICAgICBWTCgoIkNhbGN1bGF0aW5nIEJcbiIpKTsKLQotICAgICAgLyogQiA9ICh2ICsg
Z15iKSAlTiAqLwotICAgICAgcmVzdWx0ID0gY3JlYXRlX3B1YmxpY19zZXJ2ZXIodGV4dC0+Zywg
dGV4dC0+TiwgdGV4dC0+c2luZm8tPnZlcmlmaWVyLCB0ZXh0LT5iLCB0ZXh0LT5CKTsKLSAgICAg
IGlmIChyZXN1bHQhPVNBU0xfT0spIHJldHVybiByZXN1bHQ7Ci0KLSAgICAgIG5zMiA9IGNyZWF0
ZV9uZXRzdHJpbmdfYmlnaW50KHRleHQtPkIsIHNwYXJhbXMtPnV0aWxzKTsKLQotICAgICAgcHJp
bnRmKCJzZXJ2ZXIgQjogIik7Ci0gICAgICBtcHpfb3V0X3N0ciAoc3Rkb3V0LCAxMCwgdGV4dC0+
Qik7Ci0gICAgICBwcmludGYoIlxuIik7Ci0KLSAgICAgIC8qIHUgaXMgZmlyc3QgMzIgYml0cyBv
ZiBCOyBNU0IgZmlyc3QgKi8gICAgICAKLSAgICAgIEhhc2hfYmlnaW50KHRleHQtPkIsICZoYXNo
ZWRCLCBzcGFyYW1zLT51dGlscyk7Ci0gICAgICBtZW1jcHkoJnUsIGhhc2hlZEIuZGF0YSwgNCk7
Ci0gICAgICB1ID0gbnRvaGwodSk7Ci0KLSAgICAgIHByaW50ZigiVSA9ICVkXG4iLHUpOwotCi0g
ICAgICAvKiBjYWxjdWxhdGUgc2VydmVyIHNoYXJlZCBzZWNyZXQgKi8KLSAgICAgIC8qIFMgPSAo
QSp2XnUpXmIgJU4gKi8KLQotICAgICAgbXB6X2luaXQodGV4dC0+Uyk7Ci0KLSAgICAgIG1wel9w
b3dtX3VpICh0ZXh0LT5TLCB0ZXh0LT5zaW5mby0+dmVyaWZpZXIsIHUsIHRleHQtPk4pOyAgICAg
IAotICAgICAgbXB6X211bCAodGV4dC0+UywgdGV4dC0+UywgdGV4dC0+QSk7Ci0gICAgICBtcHpf
cG93bSAodGV4dC0+UywgdGV4dC0+UywgdGV4dC0+YiwgdGV4dC0+Tik7Ci0KLSAgICAgIHJlc3Vs
dCA9IFNIQV9JbnRlcmxlYXZlKHRleHQtPlMsICZ0ZXh0LT5zaGFyZWRzZWNyZXRLLCBzcGFyYW1z
LT51dGlscyk7Ci0gICAgICBpZiAocmVzdWx0IT1TQVNMX09LKSByZXR1cm4gcmVzdWx0OwotCi0g
ICAgICBwcmludGYoInNlcnZlciBjYWxjdWxhdGVkIFM6ICIpOwotICAgICAgbXB6X291dF9zdHIg
KHN0ZG91dCwgMTAsIHRleHQtPlMpOwotICAgICAgcHJpbnRmKCJcbiIpOwotCi0gICAgICBtZXJn
ZV9uZXRzdHJpbmdzKHNwYXJhbXMtPnV0aWxzLG5zMSxuczIsTlVMTCxzZXJ2ZXJvdXQsc2VydmVy
b3V0bGVuKTsKLQotICAgICAgdGV4dC0+c3RhdGUgPSAzOwotCi0gICAgICByZXR1cm4gU0FTTF9D
T05USU5VRTsKLSAgfQotCi0gIGlmICh0ZXh0LT5zdGF0ZSA9PSAzKSB7Ci0KLSAgICAgIG5ldHN0
cmluZ190ICpuczE9TlVMTDsgICAgICAKLSAgICAgIHVuc2lnbmVkIGNoYXIgKk0xaW47Ci0gICAg
ICBpbnQgTTFpbmxlbjsKLSAgICAgIGhhc2hfdCBNMTsKLSAgICAgIGhhc2hfdCBNMjsKLSAgICAg
IGludCBsdXA7Ci0KLSAgICAgIC8qCi0gICAgICAgKiBSZWNpZXZlIE0xIGV2aWRlbmNlCi0gICAg
ICAgKgotICAgICAgICovCi0gICAgICByZXN1bHQgPSBjaGVja3ZhbGlkX25ldHN0cmluZygoY2hh
ciAqKSBjbGllbnRpbiwgY2xpZW50aW5sZW4sIChjaGFyICoqKSAmTTFpbiwgJk0xaW5sZW4pOwot
ICAgICAgaWYgKHJlc3VsdCE9U0FTTF9PSykgcmV0dXJuIHJlc3VsdDsgICAgICAKLQotICAgICAg
LyogTGV0J3MgY2FsY3VsYXRlIE0xIG91cnNlbHZlcyBhbmQgc2VlIGlmIGl0IG1hdGNoZXMgKi8K
LSAgICAgIHJlc3VsdCA9IGNhbGN1bGF0ZV9jbGllbnRfZXZpZGVuY2UodGV4dC0+TiwgdGV4dC0+
ZywKLQkJCQkJIHRleHQtPnNpbmZvLT5zYWx0LCBzaXplb2YodGV4dC0+c2luZm8tPnNhbHQpLAot
CQkJCQkgdGV4dC0+c2VydmVyX29wdGlvbnMsCi0JCQkJCSB0ZXh0LT5BLCB0ZXh0LT5CLAotCQkJ
CQkgJnRleHQtPnNoYXJlZHNlY3JldEssCi0JCQkJCSAmTTEsCi0JCQkJCSBzcGFyYW1zLT51dGls
cyk7Ci0gICAgICBpZiAocmVzdWx0IT1TQVNMX09LKSByZXR1cm4gcmVzdWx0OyAgICAgIAotICAg
ICAgCi0gICAgICBmb3IgKGx1cD0wO2x1cDxIQVNITEVOO2x1cCsrKQotICAgICAgewotCSAgaWYg
KE0xaW5bbHVwXSE9TTEuZGF0YVtsdXBdKSB7Ci0JICAgICAgaWYgKGVycnN0cikgKmVycnN0ciA9
ICJDbGllbnQgZXZpZGVuY2UgaXMgd3JvbmciOwotCSAgICAgIHJldHVybiBTQVNMX0JBREFVVEg7
Ci0JICB9Ci0gICAgICB9Ci0KLSAgICAgIC8qCi0gICAgICAgKiBDYWxjdWxhdGUgYW5kIHNlbmQ6
Ci0gICAgICAgKiAgTTIKLSAgICAgICAqLwotCi0gICAgICByZXN1bHQgPSBjYWxjdWxhdGVfc2Vy
dmVyX2V2aWRlbmNlKHRleHQtPmF1dGhpZCwKLQkJCQkJIHRleHQtPkEsCi0JCQkJCSB0ZXh0LT5j
bGllbnRfb3B0aW9ucywKLQkJCQkJICZNMSwKLQkJCQkJICZ0ZXh0LT5zaGFyZWRzZWNyZXRLLAot
CQkJCQkgJk0yLAotCQkJCQkgc3BhcmFtcy0+dXRpbHMpOwotICAgICAgaWYgKHJlc3VsdCE9U0FT
TF9PSykgcmV0dXJuIHJlc3VsdDsgICAgICAKLSAgICAgIAotICAgICAgbnMxID0gY3JlYXRlX25l
dHN0cmluZ19zdHIoTTIuZGF0YSwgc2l6ZW9mKE0yLmRhdGEpLCBzcGFyYW1zLT51dGlscyk7Ci0g
ICAgICBpZiAobnMxPT1OVUxMKSByZXR1cm4gU0FTTF9OT01FTTsKLSAgICAgIAotICAgICAgKnNl
cnZlcm91dCA9IHNwYXJhbXMtPnV0aWxzLT5tYWxsb2MobnMxLT5zaXplKzEpOwotICAgICAgaWYg
KCEqc2VydmVyb3V0KSByZXR1cm4gU0FTTF9OT01FTTsKLSAgICAgIG1lbWNweSgqc2VydmVyb3V0
LCBuczEtPmRhdGEsIG5zMS0+c2l6ZSk7Ci0gICAgICAqc2VydmVyb3V0bGVuID0gbnMxLT5zaXpl
OwotCi0gICAgICAvKiBTZXQgdGhlIG9wYXJhbXMgKi8KLSAgICAgIG9wYXJhbXMtPmRvbmVmbGFn
PTE7Ci0gICAgICByZXN1bHQgPSBzcnBfc3RyZHVwKHNwYXJhbXMtPnV0aWxzLCB0ZXh0LT5hdXRo
aWQsICZvcGFyYW1zLT51c2VyLCBOVUxMKTsgCi0gICAgICByZXN1bHQgPSBzcnBfc3RyZHVwKHNw
YXJhbXMtPnV0aWxzLCB0ZXh0LT5yZWFsbSwgJm9wYXJhbXMtPnJlYWxtLCBOVUxMKTsgCi0gICAg
ICByZXN1bHQgPSBzcnBfc3RyZHVwKHNwYXJhbXMtPnV0aWxzLCB0ZXh0LT5hdXRoaWQsICZvcGFy
YW1zLT5hdXRoaWQsIE5VTEwpOwotICAgICAgb3BhcmFtcy0+bWVjaF9zc2YgPSAwOwotICAgICAg
b3BhcmFtcy0+bWF4b3V0YnVmID0gMDsKLSAgICAgIG9wYXJhbXMtPmVuY29kZSA9IE5VTEw7Ci0g
ICAgICBvcGFyYW1zLT5kZWNvZGUgPSBOVUxMOwotICAgICAgb3BhcmFtcy0+cGFyYW1fdmVyc2lv
biA9IDA7Ci0KLSAgICAgIHRleHQtPnN0YXRlID0gNDsKLSAgICAgIHJldHVybiBTQVNMX09LOwot
ICB9Ci0KLSAgcmV0dXJuIFNBU0xfRkFJTDsKIH0KIAogLyoKQEAgLTEyOTAsMjA1ICsyMzY4LDI4
MiBAQAogICByZXR1cm4gcmVzdWx0OwogfQogCi1zdGF0aWMgaW50IGNhbGN1bGF0ZV94KHNhc2xf
dXRpbHNfdCAqdXRpbHMsCi0JCSAgICAgICBjb25zdCBjaGFyICp1c2VyLCBpbnQgdXNlcmxlbiwK
LQkJICAgICAgIGNvbnN0IGNoYXIgKnBhc3MsIGludCBwYXNzbGVuLAotCQkgICAgICAgY2hhciAq
c2FsdCwgaW50IHNhbHRsZW4sCi0JCSAgICAgICBtcHpfdCB4KQotewotICAgIGNoYXIgKnVzZXJw
YXNzc3RyID0gTlVMTDsKLSAgICBjaGFyICpzYWx0Zm9vID1OVUxMOwotICAgIGhhc2hfdCB1c2Vy
cGFzc2hhc2g7Ci0gICAgaGFzaF90IGhhc2h4OwotICAgIGludCByZXN1bHQ7CiAKLSAgICAvKiBj
cmVhdGUgPHVzZXJuYW1lPiB8ICc6JyB8IDxwYXNzPiAqLwotICAgIHVzZXJwYXNzc3RyID0gdXRp
bHMtPm1hbGxvYyh1c2VybGVuKzErcGFzc2xlbisxKTsKLSAgICBpZiAoIXVzZXJwYXNzc3RyKSB7
Ci0JcmVzdWx0ID0gU0FTTF9OT01FTTsKLQlnb3RvIGRvbmU7CisvKiB4eHggdGhpcyBjYW4gbGVh
ayAqLworc3RhdGljIGludAorUmVhZFVzZXJJbmZvKHNhc2xfdXRpbHNfdCAqdXRpbHMsIGNoYXIg
KmF1dGhpZCwgY2hhciAqcmVhbG0sCisJICAgICBtcHpfdCAqTiwgbXB6X3QgKmcsIGNoYXIgKipz
YWx0LCBpbnQgKnNhbHRsZW4sIG1wel90ICp2LCBjb25zdCBjaGFyICoqZXJyc3RyKQoreworICAg
IHNhc2xfc2VjcmV0X3QgICpzZWMgPSBOVUxMOworICAgIHNhc2xfc2VydmVyX2dldHNlY3JldF90
ICpnZXRzZWNyZXQ7CisgICAgdm9pZCAqZ2V0c2VjcmV0X2NvbnRleHQ7CisgICAgaW50IHI7Cisg
ICAgY2hhciAqZGF0YTsKKyAgICBpbnQgZGF0YWxlbjsKKworICAgIHIgPSB1dGlscy0+Z2V0Y2Fs
bGJhY2sodXRpbHMtPmNvbm4sCisJCQkgICBTQVNMX0NCX1NFUlZFUl9HRVRTRUNSRVQsCisJCQkg
ICAoaW50ICgqKikgKCkpICZnZXRzZWNyZXQsCisJCQkgICAmZ2V0c2VjcmV0X2NvbnRleHQpOwor
CisgICAgaWYgKChyICE9IFNBU0xfT0spIHx8ICghZ2V0c2VjcmV0KSkgeworCSplcnJzdHIgPSAi
RXJyb3IgZ2V0dGluZyBnZXRzZWNyZXQgY2FsbGJhY2siOworCXJldHVybiByOwogICAgIH0KLQkK
LSAgICBzdHJjcHkodXNlcnBhc3NzdHIsIHVzZXIpOwotICAgIHVzZXJwYXNzc3RyW3VzZXJsZW5d
PSc6JzsKLSAgICBtZW1jcHkodXNlcnBhc3NzdHIrdXNlcmxlbisxLCBwYXNzLCBwYXNzbGVuKTsK
LSAgICB1c2VycGFzc3N0clt1c2VybGVuKzErcGFzc2xlbl09J1wwJzsKLQotICAgIC8qIFNIQSgg
PHVzZXJuYW1lPiB8ICc6JyB8IDxwYXNzPiApICovCi0gICAgSGFzaCh1c2VycGFzc3N0ciwgdXNl
cmxlbisxK3Bhc3NsZW4sICZ1c2VycGFzc2hhc2gpOwotICAgIAotICAgIC8qIGNyZWF0ZSA8c2Fs
dD4gfCBTSEEgKCAuLi4gKSAqLwotICAgIHNhbHRmb28gPSB1dGlscy0+bWFsbG9jKHNhbHRsZW4r
SEFTSExFTisxKTsKLSAgICBpZiAoIXNhbHRmb28pIHsKLQlyZXN1bHQgPSBTQVNMX05PTUVNOwot
CWdvdG8gZG9uZTsKKworICAgIC8qIFdlIHVzZSB0aGUgdXNlcidzIERJR0VTVCBzZWNyZXQgKi8K
KyAgICByID0gZ2V0c2VjcmV0KGdldHNlY3JldF9jb250ZXh0LCAiU1JQLU1ENS0xMjAiLCBhdXRo
aWQsIHJlYWxtLCAmc2VjKTsKKyAgICBpZiAoKHIpIHx8ICghc2VjKSkgeworCSplcnJzdHIgPSAi
dW5hYmxlIHRvIGdldCB1c2VyJ3Mgc2VjcmV0IjsKKwlyZXR1cm4gcjsKICAgICB9Ci0gICAgCi0g
ICAgbWVtY3B5KHNhbHRmb28sIHNhbHQsIHNhbHRsZW4pOwotICAgIG1lbWNweShzYWx0Zm9vK3Nh
bHRsZW4sIHVzZXJwYXNzaGFzaC5kYXRhLCBIQVNITEVOKTsKIAotICAgIC8qIHggPSBTSEEoIDxz
YWx0PiB8IFNIQSAoLi4uICkpICovCi0gICAgSGFzaChzYWx0Zm9vLCBzYWx0bGVuK0hBU0hMRU4s
ICZoYXNoeCk7CisgICAgLyogVGhlIHNlY3JldCBkYXRhIGlzIGVuY29kZWQganVzdCBsaWtlIGRh
dGEgd2Ugc2VuZCBvdmVyIHRoZSB3aXJlLiBJdCBoYXMKKyAgICAgKgorICAgICAqICBzYWx0IC0g
b3MgCisgICAgICogIE4gICAgLSBtcGkKKyAgICAgKiAgZyAgICAtIG1waQorICAgICAqICB2ICAg
IC0gbXBpCisgICAgICovCisgICAgciA9IFVuQnVmZmVyKHNlYy0+ZGF0YSwgc2VjLT5sZW4sICZk
YXRhLCAmZGF0YWxlbik7CisgICAgaWYgKHIpIHsKKwkqZXJyc3RyID0gIkVycm9yIFVuQnVmZmVy
aW5nIHNlY3JldCBkYXRhIjsKKwlnb3RvIGVuZDsKKyAgICB9CiAKLSAgICByZXN1bHQgPSBiaWdp
bnRfZnJvbXN0cihoYXNoeC5kYXRhLCBzaXplb2YoaGFzaHguZGF0YSksIHV0aWxzLCB4KTsKLSAg
ICBpZiAocmVzdWx0IT1TQVNMX09LKSBnb3RvIGRvbmU7CisgICAgciA9IEdldE9TKHV0aWxzLCBk
YXRhLCBkYXRhbGVuLCBzYWx0LCBzYWx0bGVuLCAmZGF0YSwgJmRhdGFsZW4pOworICAgIGlmIChy
KSB7CisJKmVycnN0ciA9ICJFcnJvciBwYXJzaW5nIG91dCBzYWx0IjsKKwlnb3RvIGVuZDsKKyAg
ICB9CiAKLSBkb25lOgotICAgIAotICAgIGlmICh1c2VycGFzc3N0cikgdXRpbHMtPmZyZWUodXNl
cnBhc3NzdHIpOwotICAgIGlmIChzYWx0Zm9vKSB1dGlscy0+ZnJlZShzYWx0Zm9vKTsKKyAgICBy
ID0gR2V0TVBJKGRhdGEsIGRhdGFsZW4sIE4sICZkYXRhLCAmZGF0YWxlbik7CisgICAgaWYgKHIp
IHsKKwkqZXJyc3RyID0gIkVycm9yIHBhcnNpbmcgb3V0ICdOJyI7CisJZ290byBlbmQ7CisgICAg
fQogCi0gICAgcmV0dXJuIHJlc3VsdDsKLX0KLS8qCi0gKiBGbGF0dGVuIGFuIHNhdmVkX2luZm9f
dCBpbnRvIGJ5dGVzCi0gKgotICogd2UgbmVlZCB0byBzYXZlOgotICogc2FsdCAgICAgIAotICog
bXB6X3QgdmVyaWZpZXI7Ci0gKgotICogc3RvcmUgc2FsdCBhcyBzZXJpZXMgb2YgYnl0ZXMKLSAq
IHZlcmlmaWVyIGFzIG5ldHN0cmluZyAKLSAqCi0gKi8KKyAgICByID0gR2V0TVBJKGRhdGEsIGRh
dGFsZW4sIGcsICZkYXRhLCAmZGF0YWxlbik7CisgICAgaWYgKHIpIHsKKwkqZXJyc3RyID0gIkVy
cm9yIHBhcnNpbmcgb3V0ICdnJyI7CisJZ290byBlbmQ7CisgICAgfQogCi1zdGF0aWMgc2FzbF9z
ZWNyZXRfdCAqZmxhdHRlbl9zaW5mbyhzYXZlZGluZm9fdCAqc2luZm8sIHNhc2xfdXRpbHNfdCAq
dXRpbHMpCi17CisgICAgciA9IEdldE1QSShkYXRhLCBkYXRhbGVuLCB2LCAmZGF0YSwgJmRhdGFs
ZW4pOworICAgIGlmIChyKSB7CisJKmVycnN0ciA9ICJFcnJvciBwYXJzaW5nIG91dCAndiciOwor
CWdvdG8gZW5kOworICAgIH0KIAotICAgIGludCByZXN1bHQ7Ci0gICAgaW50IHRvYWxzaXplOwot
ICAgIG5ldHN0cmluZ190ICpuczE7Ci0gICAgc2FzbF9zZWNyZXRfdCAqc2VjOwotICAgIGludCB0
b3RhbHNpemU7CisgICAgaWYgKGRhdGFsZW4gIT0gMCkgeworCSplcnJzdHIgPSAiRXh0cmEgZGF0
YSBpbiByZXF1ZXN0IHN0ZXAgMiI7CisJciA9IFNBU0xfRkFJTDsKKwlnb3RvIGVuZDsKKyAgICB9
CiAKLSAgICBuczEgPSBjcmVhdGVfbmV0c3RyaW5nX2JpZ2ludChzaW5mby0+dmVyaWZpZXIsIHV0
aWxzKTsKLSAgICBpZiAoIW5zMSkgcmV0dXJuIE5VTEw7CisgICAgLyogRnJlZSBhbmQgcmV0dXJu
ICovCisgZW5kOgorICAgIGlmIChzZWMpIHV0aWxzLT5mcmVlKHNlYyk7CiAKLSAgICB0b3RhbHNp
emUgPSBzaXplb2Yoc2luZm8tPnNhbHQpICsgbnMxLT5zaXplOworICAgIHJldHVybiByOworfQor
CiAKLSAgICBzZWM9KHNhc2xfc2VjcmV0X3QgKikgdXRpbHMtPm1hbGxvYyhzaXplb2Yoc2FzbF9z
ZWNyZXRfdCkrCi0JCQkJCXRvdGFsc2l6ZSsxKTsKLSAgICBpZiAoIXNlYykgcmV0dXJuIE5VTEw7
CisKK3N0YXRpYyBpbnQKK0dldFNhdmVJbmZvKHNhc2xfdXRpbHNfdCAqdXRpbHMsCisJICAgIGNv
bnN0IGNoYXIgKnVzZXIsCisJICAgIGNvbnN0IGNoYXIgKnBhc3MsIHVuc2lnbmVkIHBhc3NsZW4s
CisJICAgIHNhc2xfc2VjcmV0X3QgKipzZWMsCisJICAgIGNvbnN0IGNoYXIgKiplcnJzdHIpCit7
CisgICAgbXB6X3QgTjsKKyAgICBtcHpfdCBnOworICAgIG1wel90IHY7CisgICAgbXB6X3QgeDsK
KyAgICBjaGFyIHNhbHRbU1JQX1NBTFRfU0laRV07CisgICAgaW50IHNhbHRsZW47CisgICAgaW50
IHI7ICAgIAorICAgIGNoYXIgKm9zU2FsdCA9IE5VTEw7CisgICAgaW50IG9zU2FsdGxlbjsKKyAg
ICBjaGFyICptcGlOID0gTlVMTDsKKyAgICBpbnQgbXBpTmxlbjsKKyAgICBjaGFyICptcGlnID0g
TlVMTDsKKyAgICBpbnQgbXBpZ2xlbjsKKyAgICBjaGFyICptcGl2ID0gTlVMTDsKKyAgICBpbnQg
bXBpdmxlbjsgICAgCisgICAgY2hhciAqYnVmZmVyID0gTlVMTDsKKyAgICBpbnQgYnVmZmVybGVu
OworCisgICAgLyogZ2VuZXJhdGUgPHNhbHQ+ICovICAgIAorICAgIHNhbHRsZW4gPSBzaXplb2Yo
c2FsdCk7CisgICAgdXRpbHMtPnJhbmQodXRpbHMtPnJwb29sLCBzYWx0LCBzYWx0bGVuKTsKKwor
ICAgIHIgPSBnZW5lcmF0ZV9OX2FuZF9nKE4sIGcpOworICAgIGlmIChyKSB7CisJKmVycnN0ciA9
ICJFcnJvciBjYWxjdWxhdGluZyBOIGFuZCBnIjsKKwlyZXR1cm4gcjsKKyAgICB9CisKKyAgICBy
ID0gQ2FsY3VsYXRlWCh1dGlscywgc2FsdCwgc2FsdGxlbiwgdXNlciwgcGFzcywgcGFzc2xlbiwg
JngpOworICAgIGlmIChyKSB7CisJKmVycnN0ciA9ICJFcnJvciBjYWxjdWxhdGluZyAneCciOwor
CXJldHVybiByOworICAgIH0KKworICAgIC8qIHYgPSBnXnggKi8KKyAgICBtcHpfaW5pdCh2KTsK
KyAgICBtcHpfcG93bSAodiwgZywgeCwgTik7CiAKLSAgICBtZW1jcHkoc2VjLT5kYXRhLCBzaW5m
by0+c2FsdCwgc2l6ZW9mKHNpbmZvLT5zYWx0KSk7Ci0gICAgbWVtY3B5KHNlYy0+ZGF0YStzaXpl
b2Yoc2luZm8tPnNhbHQpLCBuczEtPmRhdGEsIG5zMS0+c2l6ZSk7CisgICAgLyoKKyAgICAgKiBX
ZSBuZWVkIHRvIHNhdmU6CisgICAgICogIHNhbHQKKyAgICAgKiAgTgorICAgICAqICBnCisgICAg
ICogIHYKKyAgICAgKi8KIAotICAgIHNlYy0+bGVuID0gdG90YWxzaXplOworICAgIHIgPSBNYWtl
T1ModXRpbHMsIHNhbHQsIHNhbHRsZW4sICZvc1NhbHQsICZvc1NhbHRsZW4pOworICAgIGlmIChy
KSB7CisJKmVycnN0ciA9ICJFcnJvciB0dXJuaW5nIHNhbHQgaW50byAnb3MnIHN0cmluZyI7CisJ
Z290byBlbmQ7CisgICAgfQorICAgIAorICAgIHIgPSBNYWtlTVBJKHV0aWxzLCBOLCAmbXBpTiwg
Jm1waU5sZW4pOworICAgIGlmIChyKSB7CisJKmVycnN0ciA9ICJFcnJvciB0dXJuaW5nICdOJyBp
bnRvICdtcGknIHN0cmluZyI7CisJZ290byBlbmQ7CisgICAgfQorCisgICAgciA9IE1ha2VNUEko
dXRpbHMsIGcsICZtcGlnLCAmbXBpZ2xlbik7CisgICAgaWYgKHIpIHsKKwkqZXJyc3RyID0gIkVy
cm9yIHR1cm5pbmcgJ2cnIGludG8gJ21waScgc3RyaW5nIjsKKwlnb3RvIGVuZDsKKyAgICB9Cisg
ICAgCisgICAgciA9IE1ha2VNUEkodXRpbHMsIHYsICZtcGl2LCAmbXBpdmxlbik7CisgICAgaWYg
KHIpIHsKKwkqZXJyc3RyID0gIkVycm9yIHR1cm5pbmcgJ04nIGludG8gJ21waScgc3RyaW5nIjsK
Kwlnb3RvIGVuZDsKKyAgICB9CisKKyAgICByID0gTWFrZUJ1ZmZlcih1dGlscywgb3NTYWx0LCBv
c1NhbHRsZW4sIG1waU4sIG1waU5sZW4sIG1waWcsIG1waWdsZW4sIG1waXYsIG1waXZsZW4sCisJ
CSAgICZidWZmZXIsICZidWZmZXJsZW4pOworICAgIGlmIChyKSB7CisJKmVycnN0ciA9ICJFcnJv
ciBwdXR0aW5nIGFsbCB0aGUgZGF0YSB0b2dldGhlciBpbiBzdGVwIDIiOworCWdvdG8gZW5kOwor
ICAgIH0gICAgCisgICAgCisgICAgLyogUHV0ICdidWZmZXInIGludG8gc2FzbF9zZWNyZXRfdCAq
LworICAgICpzZWMgPSB1dGlscy0+bWFsbG9jKHNpemVvZihzYXNsX3NlY3JldF90KStidWZmZXJs
ZW4rMSk7CisgICAgaWYgKCEqc2VjKSB7CisJciA9IFNBU0xfTk9NRU07CisJZ290byBlbmQ7Cisg
ICAgfQorICAgIG1lbWNweSgoKnNlYyktPmRhdGEsIGJ1ZmZlciwgYnVmZmVybGVuKTsKKyAgICAo
KnNlYyktPmxlbiA9IGJ1ZmZlcmxlbjsgICAgCisKKyAgICAvKiBDbGVhbiBldmVyeXRoaW5nIHVw
ICovCisgZW5kOgorICAgIGlmIChvc1NhbHQpIHV0aWxzLT5mcmVlKG9zU2FsdCk7CisgICAgaWYg
KG1waU4pICAgdXRpbHMtPmZyZWUobXBpTik7CisgICAgaWYgKG1waWcpICAgdXRpbHMtPmZyZWUo
bXBpZyk7CisgICAgaWYgKG1waXYpICAgdXRpbHMtPmZyZWUobXBpdik7CisgICAgaWYgKGJ1ZmZl
cikgdXRpbHMtPmZyZWUoYnVmZmVyKTsKKyAgICBtcHpfY2xlYXIoTik7CisgICAgbXB6X2NsZWFy
KGcpOworICAgIG1wel9jbGVhcih2KTsKKyAgICBtcHpfY2xlYXIoeCk7CiAKLSAgICByZXR1cm4g
c2VjOworICAgIHJldHVybiByOyAgIAogfQogCiBzdGF0aWMgaW50Ci1zZXRwYXNzKHZvaWQgKmds
b2JfY29udGV4dCBfX2F0dHJpYnV0ZV9fKCh1bnVzZWQpKSwKLQlzYXNsX3NlcnZlcl9wYXJhbXNf
dCAqc3BhcmFtcywKLQljb25zdCBjaGFyICp1c2Vyc3RyLAotCWNvbnN0IGNoYXIgKnBhc3MsCi0J
dW5zaWduZWQgcGFzc2xlbiwKLQlpbnQgZmxhZ3MgX19hdHRyaWJ1dGVfXygodW51c2VkKSksCi0J
Y29uc3QgY2hhciAqKmVycnN0cikKK3NycF9zZXRwYXNzKHZvaWQgKmdsb2JfY29udGV4dCBfX2F0
dHJpYnV0ZV9fKCh1bnVzZWQpKSwKKwkgICAgc2FzbF9zZXJ2ZXJfcGFyYW1zX3QgKnNwYXJhbXMs
CisJICAgIGNvbnN0IGNoYXIgKnVzZXJzdHIsCisJICAgIGNvbnN0IGNoYXIgKnBhc3MsCisJICAg
IHVuc2lnbmVkIHBhc3NsZW4sCisJICAgIGludCBmbGFncywKKwkgICAgY29uc3QgY2hhciAqKmVy
cnN0cikKIHsKLSAgICBpbnQgdXNlcmxlbiA9IHN0cmxlbih1c2Vyc3RyKTsKLSAgICAKLSAgICBp
bnQgcmVzdWx0OworICAgIGNvbnN0IGNoYXIgKm15ZXJyc3RyOworICAgIGludCByOwogICAgIHNh
c2xfc2VydmVyX3B1dHNlY3JldF90ICpwdXRzZWNyZXQ7CiAgICAgdm9pZCAqcHV0c2VjcmV0X2Nv
bnRleHQ7CiAgICAgY2hhciAqdXNlciA9IE5VTEw7CiAgICAgY2hhciAqcmVhbG0gPSBOVUxMOwot
Ci0gICAgc2F2ZWRpbmZvX3Qgc2luZm87Ci0gICAgc2FzbF9zZWNyZXRfdCAqc2VjID0gTlVMTDsK
KyAgICBzYXNsX3NlY3JldF90ICpzZWM7CiAKLSAgICBpZiAoZXJyc3RyKSB7Ci0JKmVycnN0ciA9
IE5VTEw7Ci0gICAgfQorICAgIGlmICghZXJyc3RyKSBlcnJzdHIgPSAmbXllcnJzdHI7CisgICAg
KmVycnN0ciA9IE5VTEw7CiAKLSAgICByZXN1bHQgPSBwYXJzZXVzZXIoc3BhcmFtcy0+dXRpbHMs
ICZ1c2VyLCAmcmVhbG0sIHNwYXJhbXMtPnVzZXJfcmVhbG0sCisgICAgciA9IHBhcnNldXNlcihz
cGFyYW1zLT51dGlscywgJnVzZXIsICZyZWFsbSwgc3BhcmFtcy0+dXNlcl9yZWFsbSwKIAkJICAg
ICAgIHNwYXJhbXMtPnNlcnZlckZRRE4sIHVzZXJzdHIpOwotICAgIGlmIChyZXN1bHQgIT0gU0FT
TF9PSykgewotCXJldHVybiByZXN1bHQ7CisgICAgaWYgKHIpIHsKKwkqZXJyc3RyID0gIkVycm9y
IHBhcnNpbmcgdXNlciI7CisJcmV0dXJuIHI7CiAgICAgfQogCiAgICAgaWYgKChmbGFncyAmIFNB
U0xfU0VUX0RJU0FCTEUpIHx8IHBhc3MgPT0gTlVMTCkgewogCXNlYyA9IE5VTEw7CiAgICAgfSBl
bHNlIHsKLQltcHpfdCBOLCBnLCB4OwotCi0JLyogZ2VuZXJhdGUgPHNhbHQ+ICovICAgIAotCXNw
YXJhbXMtPnV0aWxzLT5yYW5kKHNwYXJhbXMtPnV0aWxzLT5ycG9vbCwgc2luZm8uc2FsdCwgc2l6
ZW9mKHNpbmZvLnNhbHQpKTsKLSAgICAKLQkvKiB4ID0gU0hBKCA8c2FsdD4gfCBTSEEgKC4uLiAp
KSAqLwotCXJlc3VsdCA9IGNhbGN1bGF0ZV94KHNwYXJhbXMtPnV0aWxzLAotCQkJICAgICB1c2Vy
LCB1c2VybGVuLAotCQkJICAgICBwYXNzLCBwYXNzbGVuLAotCQkJICAgICBzaW5mby5zYWx0LCBz
aXplb2Yoc2luZm8uc2FsdCksCi0JCQkgICAgIHgpOwotCWlmIChyZXN1bHQhPVNBU0xfT0spIHJl
dHVybiByZXN1bHQ7Ci0KLQlyZXN1bHQgPSBnZW5lcmF0ZV9OX2FuZF9nKE4sIGcpOwotCWlmIChy
ZXN1bHQhPVNBU0xfT0spIHJldHVybiByZXN1bHQ7Ci0KLQkvKiBjYWxjdWxhdGUgdiA9IGdeeCAl
IE4gKi8KLQltcHpfaW5pdChzaW5mby52ZXJpZmllcik7Ci0JbXB6X3Bvd20oc2luZm8udmVyaWZp
ZXIsZyx4LE4pOwotCi0KLQkvKiBmbGF0dGVuIHNpbmZvICovCi0Jc2VjID0gZmxhdHRlbl9zaW5m
bygmc2luZm8sIHNwYXJhbXMtPnV0aWxzKTsKLQotCWlmIChzZWMgPT0gTlVMTCkgewotCSAgICBy
ZXN1bHQgPSBTQVNMX05PTUVNOwotCSAgICBnb3RvIGNsZWFudXA7CisJciA9IEdldFNhdmVJbmZv
KHNwYXJhbXMtPnV0aWxzLCB1c2VyLCBwYXNzLCBwYXNzbGVuLCAmc2VjLCBlcnJzdHIpOworCWlm
IChyKSB7CisJICAgICplcnJzdHIgPSAiRXJyb3IgY3JlYXRpbmcgZGF0YSBmb3IgU1JQIHRvIHNh
dmUiOworCSAgICByZXR1cm4gcjsKIAl9CiAgICAgfQogCiAgICAgLyogZ2V0IHRoZSBjYWxsYmFj
ayBmb3Igc2F2aW5nIHRvIHRoZSBwYXNzd29yZCBkYiAqLwotICAgIHJlc3VsdCA9IHNwYXJhbXMt
PnV0aWxzLT5nZXRjYWxsYmFjayhzcGFyYW1zLT51dGlscy0+Y29ubiwKLQkJCQkJIFNBU0xfQ0Jf
U0VSVkVSX1BVVFNFQ1JFVCwKLQkJCQkJICZwdXRzZWNyZXQsCi0JCQkJCSAmcHV0c2VjcmV0X2Nv
bnRleHQpOwotICAgIGlmIChyZXN1bHQgIT0gU0FTTF9PSykgeworICAgIHIgPSBzcGFyYW1zLT51
dGlscy0+Z2V0Y2FsbGJhY2soc3BhcmFtcy0+dXRpbHMtPmNvbm4sCisJCQkJICAgIFNBU0xfQ0Jf
U0VSVkVSX1BVVFNFQ1JFVCwKKwkJCQkgICAgJnB1dHNlY3JldCwKKwkJCQkgICAgJnB1dHNlY3Jl
dF9jb250ZXh0KTsKKyAgICBpZiAocikgeworCSplcnJzdHIgPSAiRXJyb3IgZ2V0dGluZyBwdXRz
ZWNyZXQgY2FsbGJhY2siOwogCWdvdG8gY2xlYW51cDsKICAgICB9CiAKICAgICAvKiBkbyB0aGUg
c3RvcmUgKi8KLSAgICByZXN1bHQgPSBwdXRzZWNyZXQocHV0c2VjcmV0X2NvbnRleHQsCi0JCSAg
ICAgICAiU1JQIiwgCi0JCSAgICAgICB1c2VyLAotCQkgICAgICAgcmVhbG0sCi0JCSAgICAgICBz
ZWMpOworICAgIHIgPSBwdXRzZWNyZXQocHV0c2VjcmV0X2NvbnRleHQsCisJCSAgIlNSUC1NRDUt
MTIwIiwgCisJCSAgdXNlciwKKwkJICByZWFsbSwKKwkJICBzZWMpOwogCi0gICAgaWYgKHJlc3Vs
dCAhPSBTQVNMX09LKSB7CisgICAgaWYgKHIpIHsKKwkqZXJyc3RyID0gIkVycm9yIHB1dHRpbmcg
c2VjcmV0IjsKIAlnb3RvIGNsZWFudXA7CiAgICAgfQogCiAgICAgLyogcHV0IGVudHJ5IGluIGRi
IHRvIHNheSB3ZSBoYXZlIGF0IGxlYXN0IG9uZSB1c2VyICovCi0gICAgcmVzdWx0ID0gbWVjaGFu
aXNtX2ZpbGxfZGIoIlNSUCIsIHNwYXJhbXMpOworICAgIHIgPSBtZWNoYW5pc21fZmlsbF9kYigi
U1JQLU1ENS0xMjAiLCBzcGFyYW1zKTsKIAogICAgIFZMKCgiU2V0cGFzcyBmb3IgU1JQIHN1Y2Nl
c3NmdWxcbiIpKTsKIAogIGNsZWFudXA6Ci0gICAgaWYgKHNlYykgewotCW1lbXNldChzZWMsIDAs
IHNpemVvZihzYXNsX3NlY3JldF90KSArIHNpemVvZihzYXZlZGluZm9fdCkpOwotCXNwYXJhbXMt
PnV0aWxzLT5mcmVlKHNlYyk7Ci0gICAgfQogCiAgICAgaWYgKHVzZXIpIAlzcGFyYW1zLT51dGls
cy0+ZnJlZSh1c2VyKTsKICAgICBpZiAocmVhbG0pIAlzcGFyYW1zLT51dGlscy0+ZnJlZShyZWFs
bSk7Ci0gICAgcmV0dXJuIHJlc3VsdDsKKyAgICBpZiAoc2VjKSAgICBzcGFyYW1zLT51dGlscy0+
ZnJlZShzZWMpOworCisgICAgcmV0dXJuIHI7CiB9CiAKKy8qIFhYWCBmb3Igbm93IHdlIG9ubHkg
c3VwcG9ydCBvbmUgaGFzaCB0eXBlICovCiBzdGF0aWMgY29uc3Qgc2FzbF9zZXJ2ZXJfcGx1Z190
IHBsdWdpbnNbXSA9IAogewogICB7Ci0gICAgIlNSUCIsCQkgICAgICAgIC8qIG1lY2hfbmFtZSAq
LworICAgICJTUlAtTUQ1LTEyMCIsCSAgICAgICAgLyogbWVjaF9uYW1lICovCiAgICAgMCwJCQkJ
LyogbWF4X3NzZiAqLwogICAgIFNBU0xfU0VDX05PUExBSU5URVhULAkvKiBzZWN1cml0eV9mbGFn
cyAqLwogICAgIE5VTEwsCQkJLyogZ2xvYl9jb250ZXh0ICovCiAgICAgJnNlcnZlcl9zdGFydCwJ
CS8qIG1lY2hfbmV3ICovCiAgICAgJnNlcnZlcl9jb250aW51ZV9zdGVwLAkvKiBtZWNoX3N0ZXAg
Ki8KLSAgICBOVUxMLAkJCS8qIG1lY2hfZGlzcG9zZSAqLworICAgICZkaXNwb3NlLAkJCS8qIG1l
Y2hfZGlzcG9zZSAqLwogICAgIE5VTEwsCQkJLyogbWVjaF9mcmVlICovCi0gICAgJnNldHBhc3Ms
CQkJLyogc2V0cGFzcyAqLworICAgICZzcnBfc2V0cGFzcywJCS8qIHNldHBhc3MgKi8KICAgICBO
VUxMLAkJCS8qIHVzZXJfcXVlcnkgKi8KICAgICBOVUxMLAkJCS8qIGlkbGUgKi8KICAgICBOVUxM
LAkJCS8qIGluc3RhbGxfY3JlZGVudGlhbHMgKi8KQEAgLTE0OTcsMTEgKzI2NTIsMTEgQEAKICAg
fQogfTsKIAotaW50IHNhc2xfc2VydmVyX3BsdWdfaW5pdChzYXNsX3V0aWxzX3QgKnV0aWxzIF9f
YXR0cmlidXRlX18oKHVudXNlZCkpLAotCQkJICBpbnQgbWF4dmVyc2lvbiwKLQkJCSAgaW50ICpv
dXRfdmVyc2lvbiwKLQkJCSAgY29uc3Qgc2FzbF9zZXJ2ZXJfcGx1Z190ICoqcGx1Z2xpc3QsCi0J
CQkgIGludCAqcGx1Z2NvdW50KQoraW50IHNycF9zYXNsX3NlcnZlcl9wbHVnX2luaXQoc2FzbF91
dGlsc190ICp1dGlscyBfX2F0dHJpYnV0ZV9fKCh1bnVzZWQpKSwKKwkJCSAgICAgIGludCBtYXh2
ZXJzaW9uLAorCQkJICAgICAgaW50ICpvdXRfdmVyc2lvbiwKKwkJCSAgICAgIGNvbnN0IHNhc2xf
c2VydmVyX3BsdWdfdCAqKnBsdWdsaXN0LAorCQkJICAgICAgaW50ICpwbHVnY291bnQpCiB7CiAg
IGlmIChtYXh2ZXJzaW9uPFNSUF9WRVJTSU9OKQogICAgIHJldHVybiBTQVNMX0JBRFZFUlM7CkBA
IC0xNTE0LDE3ICsyNjY5LDYgQEAKICAgcmV0dXJuIFNBU0xfT0s7CiB9CiAKLXN0YXRpYyB2b2lk
IGRpc3Bvc2Uodm9pZCAqY29ubl9jb250ZXh0LCBzYXNsX3V0aWxzX3QgKnV0aWxzKQotewotICBj
b250ZXh0X3QgKnRleHQ7Ci0gIHRleHQ9Y29ubl9jb250ZXh0OwotCi0gIGlmICghdGV4dCkKLSAg
ICByZXR1cm47Ci0KLSAgdXRpbHMtPmZyZWUodGV4dCk7Ci19Ci0KIC8qIHB1dCBpbiBzYXNsX3dy
b25nbWVjaCAqLwogc3RhdGljIGludAogY2xpZW50X3N0YXJ0KHZvaWQgKmdsb2JfY29udGV4dCBf
X2F0dHJpYnV0ZV9fKCh1bnVzZWQpKSwKQEAgLTE1NDEsNjAgKzI2ODUsMTIgQEAKICAgaWYgKHRl
eHQ9PU5VTEwpIHJldHVybiBTQVNMX05PTUVNOwogCiAgIG1lbXNldCh0ZXh0LCAnXDAnLCBzaXpl
b2YoY29udGV4dF90KSk7Ci0gIHRleHQtPnN0YXRlPTA7ICAKKyAgdGV4dC0+c3RhdGUgPSAwOyAg
CiAgICpjb25uPXRleHQ7CiAKICAgcmV0dXJuIFNBU0xfT0s7CiB9CiAKLS8qCi0gKiBDcmVhdGUg
bGFyZ2UgcmFuZG9tIGEKLSAqIEEgPSBnXmEgJSBOCi0gKgotICovCi0KLXN0YXRpYyBuZXRzdHJp
bmdfdCAqY3JlYXRlX3B1YmxpY19jbGllbnQobXB6X3QgZywgbXB6X3QgTiwgbXB6X3QgYSwgbXB6
X3QgQSwgCi0JCQkJCSBzYXNsX3V0aWxzX3QgKnV0aWxzKQotewotICAgIG1wel9pbml0KGEpOwot
ICAgIG1wel9pbml0KEEpOwotCi0gICAgLyogeHh4IGxpa2VseSBzaG91bGQgdXNlIHNhc2wgcmFu
ZG9tIGZ1bmNzICovCi0gICAgbXB6X3JhbmRvbShhLEJJVFNGT1JhYi8oOCpzaXplb2YoaW50KSkp
OyAKLQotICAgIC8qIEEgPSBnXmEgJSBOICovCi0gICAgbXB6X3Bvd20gKEEsIGcsIGEsIE4pOwot
Ci0gICAgcmV0dXJuIGNyZWF0ZV9uZXRzdHJpbmdfYmlnaW50KEEsIHV0aWxzKTsKLX0KLQotLyoK
LSAqIENyZWF0ZSBsYXJnZSByYW5kb20gYgotICogQiA9ICh2ICsgZ15iKSAlIE4KLSAqCi0gKi8K
LQotc3RhdGljIGludCBjcmVhdGVfcHVibGljX3NlcnZlcihtcHpfdCBnLCBtcHpfdCBOLCBtcHpf
dCB2LAotCQkJCW1wel90IGIsIG1wel90IEIpCi17Ci0gICAgbXB6X2luaXQoYik7Ci0gICAgbXB6
X2luaXQoQik7Ci0KLSAgICAvKiB4eHggbGlrZWx5IHNob3VsZCB1c2Ugc2FzbCByYW5kb20gZnVu
Y3MgKi8KLSAgICBtcHpfcmFuZG9tKGIsQklUU0ZPUmFiLyg4KnNpemVvZihpbnQpKSk7IAotCi0g
ICAgLyogIGdeYiAlIE4gKi8KLSAgICBtcHpfcG93bSAoQiwgZywgYiwgTik7Ci0KLSAgICAvKiB2
ICsgKGdeYiVOKSAgKi8KLSAgICBtcHpfYWRkIChCLCBCLCB2KTsKLQotICAgIC8qIEIgPSAodiAr
IGdeYikgJSBOICovCi0gICAgbXB6X21vZCAoQiwgQiwgTik7Ci0KLSAgICByZXR1cm4gU0FTTF9P
SzsKLX0KLQogLyogCiAgKiBUcnlzIHRvIGZpbmQgdGhlIHByb21wdCB3aXRoIHRoZSBsb29raW5n
Zm9yIGlkIGluIHRoZSBwcm9tcHQgbGlzdAogICogUmV0dXJucyBpdCBpZiBmb3VuZC4gTlVMTCBv
dGhlcndpc2UKQEAgLTE2MDMsMTcgKzI2OTksMTcgQEAKIHN0YXRpYyBzYXNsX2ludGVyYWN0X3Qg
KmZpbmRfcHJvbXB0KHNhc2xfaW50ZXJhY3RfdCAqcHJvbXB0bGlzdCwKIAkJCQkgICAgdW5zaWdu
ZWQgaW50IGxvb2tpbmdmb3IpCiB7Ci0gIGlmIChwcm9tcHRsaXN0PT1OVUxMKSByZXR1cm4gTlVM
TDsKLQotICB3aGlsZSAocHJvbXB0bGlzdC0+aWQhPVNBU0xfQ0JfTElTVF9FTkQpCi0gIHsKLSAg
ICBpZiAocHJvbXB0bGlzdC0+aWQ9PWxvb2tpbmdmb3IpCi0gICAgICByZXR1cm4gcHJvbXB0bGlz
dDsKLQotICAgIHByb21wdGxpc3QrKzsKLSAgfQotCi0gIHJldHVybiBOVUxMOworICAgIGlmIChw
cm9tcHRsaXN0PT1OVUxMKSByZXR1cm4gTlVMTDsKKyAgICAKKyAgICB3aGlsZSAocHJvbXB0bGlz
dC0+aWQhPVNBU0xfQ0JfTElTVF9FTkQpCisgICAgeworCWlmIChwcm9tcHRsaXN0LT5pZD09bG9v
a2luZ2ZvcikKKwkgICAgcmV0dXJuIHByb21wdGxpc3Q7CisJCisJcHJvbXB0bGlzdCsrOworICAg
IH0KKyAgICAKKyAgICByZXR1cm4gTlVMTDsKIH0KIAogc3RhdGljIGludCBnZXRfYXV0aGlkKHNh
c2xfY2xpZW50X3BhcmFtc190ICpwYXJhbXMsCkBAIC0xNjcyLDYgKzI3NjgsNzAgQEAKIAogfQog
CisvKgorICogU29tZWhvdyByZXRyaWV2ZSB0aGUgdXNlcmlkCisgKiBUaGlzIGlzIHRoZSBzYW1l
IGFzIGluIGRpZ2VzdC1tZDUgc28gY2hhbmdlIGJvdGgKKyAqLworCitzdGF0aWMgaW50CitnZXRf
dXNlcmlkKHNhc2xfY2xpZW50X3BhcmFtc190ICpwYXJhbXMsCisJICAgY2hhciAqKnVzZXJpZCwK
KwkgICBzYXNsX2ludGVyYWN0X3QgKipwcm9tcHRfbmVlZCkKK3sKKyAgaW50IHJlc3VsdDsKKyAg
c2FzbF9nZXRzaW1wbGVfdCAqZ2V0dXNlcl9jYjsKKyAgdm9pZCAqZ2V0dXNlcl9jb250ZXh0Owor
ICBzYXNsX2ludGVyYWN0X3QgKnByb21wdDsKKyAgY29uc3QgY2hhciAqcHRyOworCisgIC8qIHNl
ZSBpZiB3ZSB3ZXJlIGdpdmVuIHRoZSB1c2VyaWQgaW4gdGhlIHByb21wdCAqLworICBwcm9tcHQ9
ZmluZF9wcm9tcHQoKnByb21wdF9uZWVkLFNBU0xfQ0JfVVNFUik7CisgIGlmIChwcm9tcHQhPU5V
TEwpIHsKKyAgICAgIGlmICghcHJvbXB0LT5yZXN1bHQpIHsKKwkgIHJldHVybiBTQVNMX0JBRFBB
UkFNOworICAgICAgfQorCisgICAgICBWTCgoIkZvdW5kIHVzZXJpZCBpbiBjYWxsYmFja1xuIikp
OworCisgICAgICAvKiBjb3B5IGl0ICovCisgICAgICAqdXNlcmlkPXBhcmFtcy0+dXRpbHMtPm1h
bGxvYyhwcm9tcHQtPmxlbisxKTsKKyAgICAgIGlmICgoKnVzZXJpZCk9PU5VTEwpIHJldHVybiBT
QVNMX05PTUVNOworCisgICAgICBzdHJuY3B5KCp1c2VyaWQsIHByb21wdC0+cmVzdWx0LCBwcm9t
cHQtPmxlbisxKTsKKyAgICAgIHJldHVybiBTQVNMX09LOworICB9CisKKyAgLyogVHJ5IHRvIGdl
dCB0aGUgY2FsbGJhY2suLi4gKi8KKyAgcmVzdWx0ID0gcGFyYW1zLT51dGlscy0+Z2V0Y2FsbGJh
Y2socGFyYW1zLT51dGlscy0+Y29ubiwKKwkJCQkgICAgICBTQVNMX0NCX1VTRVIsCisJCQkJICAg
ICAgJmdldHVzZXJfY2IsCisJCQkJICAgICAgJmdldHVzZXJfY29udGV4dCk7CisgIHN3aXRjaCAo
cmVzdWx0KSB7CisgIGNhc2UgU0FTTF9JTlRFUkFDVDoKKyAgICByZXR1cm4gU0FTTF9JTlRFUkFD
VDsKKyAgY2FzZSBTQVNMX09LOgorICAgIGlmICghZ2V0dXNlcl9jYikKKyAgICAgIHJldHVybiBT
QVNMX0ZBSUw7CisgICAgcmVzdWx0ID0gZ2V0dXNlcl9jYihnZXR1c2VyX2NvbnRleHQsCisJCQlT
QVNMX0NCX1VTRVIsCisJCQkmcHRyLAorCQkJTlVMTCk7CisgICAgaWYgKHJlc3VsdCAhPSBTQVNM
X09LKQorICAgICAgcmV0dXJuIHJlc3VsdDsKKyAgICBpZiAoIXB0cikgcmV0dXJuIFNBU0xfQkFE
UEFSQU07CisKKyAgICAqdXNlcmlkPXBhcmFtcy0+dXRpbHMtPm1hbGxvYyhzdHJsZW4ocHRyKSsx
KTsKKyAgICBpZiAoKCp1c2VyaWQpPT1OVUxMKSByZXR1cm4gU0FTTF9OT01FTTsKKyAgICBzdHJj
cHkoKnVzZXJpZCwgcHRyKTsKKworICAgIGJyZWFrOworICBkZWZhdWx0OgorICAgIC8qIHN1Y2Vz
cyAqLworICAgIGJyZWFrOworICB9CisKKyAgcmV0dXJuIHJlc3VsdDsKK30KIAogc3RhdGljIGlu
dCBnZXRfcGFzc3dvcmQoc2FzbF9jbGllbnRfcGFyYW1zX3QgKnBhcmFtcywKIAkJICAgICAgc2Fz
bF9zZWNyZXRfdCAqKnBhc3N3b3JkLApAQCAtMTc1OSwxMyArMjkxOSwxNSBAQAogCiBzdGF0aWMg
aW50IG1ha2VfcHJvbXB0cyhzYXNsX2NsaWVudF9wYXJhbXNfdCAqcGFyYW1zLAogCQkJc2FzbF9p
bnRlcmFjdF90ICoqcHJvbXB0c19yZXMsCi0JCQlpbnQgYXV0aF9yZXMsCisJCQlpbnQgYXV0aF9y
ZXMsIC8qIGF1dGhlbnRpY2F0aW9uIGlkICovCisJCQlpbnQgdXNlcl9yZXMsIC8qIGF1dGhvcml6
YXRpb24gaWQgKi8KIAkJCWludCBwYXNzX3JlcykKIHsKICAgaW50IG51bT0xOwogICBzYXNsX2lu
dGVyYWN0X3QgKnByb21wdHM7CiAKICAgaWYgKGF1dGhfcmVzPT1TQVNMX0lOVEVSQUNUKSBudW0r
KzsKKyAgaWYgKHVzZXJfcmVzPT1TQVNMX0lOVEVSQUNUKSBudW0rKzsKICAgaWYgKHBhc3NfcmVz
PT1TQVNMX0lOVEVSQUNUKSBudW0rKzsKIAogICBpZiAobnVtPT0xKSByZXR1cm4gU0FTTF9GQUlM
OwpAQCAtMTc3OCwxNCArMjk0MCwyNSBAQAogICB7CiAgICAgLyogV2Ugd2VyZW4ndCBhYmxlIHRv
IGdldCB0aGUgY2FsbGJhY2s7IGxldCdzIHRyeSBhIFNBU0xfSU5URVJBQ1QgKi8KICAgICAocHJv
bXB0cyktPmlkPVNBU0xfQ0JfQVVUSE5BTUU7Ci0gICAgKHByb21wdHMpLT5jaGFsbGVuZ2U9IkF1
dGhvcml6YXRpb24gTmFtZSI7CisgICAgKHByb21wdHMpLT5jaGFsbGVuZ2U9IkF1dGhlbnRpY2F0
aW9uIE5hbWUiOwogICAgIChwcm9tcHRzKS0+cHJvbXB0PSJQbGVhc2UgZW50ZXIgeW91ciBhdXRo
b3JpemF0aW9uIG5hbWUiOwogICAgIChwcm9tcHRzKS0+ZGVmcmVzdWx0PU5VTEw7CiAKICAgICBW
TCgoImF1dGhpZCBjYWxsYmFjayBhZGRlZFxuIikpOwogICAgIHByb21wdHMrKzsKICAgfQorICBp
ZiAodXNlcl9yZXMgPT0gU0FTTF9JTlRFUkFDVCkgeworICAgIC8qCisgICAgICogV2Ugd2VyZW4n
dCBhYmxlIHRvIGdldCB0aGUgY2FsbGJhY2s7IGxldCdzIHRyeSBhIFNBU0xfSU5URVJBQ1QKKyAg
ICAgKi8KKyAgICAocHJvbXB0cyktPmlkPVNBU0xfQ0JfVVNFUjsKKyAgICAocHJvbXB0cyktPmNo
YWxsZW5nZT0iQXV0aG9yaXphdGlvbiBOYW1lIjsKKyAgICAocHJvbXB0cyktPnByb21wdD0iUGxl
YXNlIGVudGVyIHlvdXIgYXV0aG9yaXphdGlvbiBuYW1lIjsKKyAgICAocHJvbXB0cyktPmRlZnJl
c3VsdD1OVUxMOwogCisgICAgVkwoKCJ1c2VyaWQgY2FsbGJhY2sgYWRkZWRcbiIpKTsKKyAgICBw
cm9tcHRzKys7CisgIH0KICAgaWYgKHBhc3NfcmVzPT1TQVNMX0lOVEVSQUNUKQogICB7CiAgICAg
LyogV2Ugd2VyZW4ndCBhYmxlIHRvIGdldCB0aGUgY2FsbGJhY2s7IGxldCdzIHRyeSBhIFNBU0xf
SU5URVJBQ1QgKi8KQEAgLTE4MDksMzEzICsyOTgyLDQzNyBAQAogfQogCiBzdGF0aWMgaW50Ci1j
bGllbnRfY29udGludWVfc3RlcCh2b2lkICpjb25uX2NvbnRleHQsCi0JCXNhc2xfY2xpZW50X3Bh
cmFtc190ICpwYXJhbXMsCi0JCWNvbnN0IGNoYXIgKnNlcnZlcmluLAotCQlpbnQgc2VydmVyaW5s
ZW4sCi0JCXNhc2xfaW50ZXJhY3RfdCAqKnByb21wdF9uZWVkLAotCQljaGFyICoqY2xpZW50b3V0
LAotCQlpbnQgKmNsaWVudG91dGxlbiwKLQkJc2FzbF9vdXRfcGFyYW1zX3QgKm9wYXJhbXMpCitj
bGllbnRfc3RlcDEoY29udGV4dF90ICp0ZXh0LAorCSAgICAgc2FzbF9jbGllbnRfcGFyYW1zX3Qg
KnBhcmFtcywKKwkgICAgIGNvbnN0IGNoYXIgKnNlcnZlcmluICBfX2F0dHJpYnV0ZV9fKCh1bnVz
ZWQpKSwKKwkgICAgIGludCBzZXJ2ZXJpbmxlbiwKKwkgICAgIHNhc2xfaW50ZXJhY3RfdCAqKnBy
b21wdF9uZWVkLAorCSAgICAgY2hhciAqKmNsaWVudG91dCwKKwkgICAgIGludCAqY2xpZW50b3V0
bGVuLAorCSAgICAgc2FzbF9vdXRfcGFyYW1zX3QgKm9wYXJhbXMgIF9fYXR0cmlidXRlX18oKHVu
dXNlZCkpKQoreworICAgIGludCBhdXRoX3Jlc3VsdD1TQVNMX09LOworICAgIGludCBwYXNzX3Jl
c3VsdD1TQVNMX09LOworICAgIGludCB1c2VyX3Jlc3VsdD1TQVNMX09LOworICAgIGludCByOwor
ICAgIGNoYXIgKnV0ZjhVID0gTlVMTDsKKyAgICBpbnQgdXRmOFVsZW47CisKKyAgICAvKiBFeHBl
Y3Q6IAorICAgICAqICAgYWJzb2x1dGx5IG5vdGhpbmcKKyAgICAgKiAKKyAgICAgKi8KKyAgICBp
ZiAoc2VydmVyaW5sZW4gPiAwKSB7CisJVkwoKCJJbnZhbGlkIGlucHV0IHRvIGZpcnN0IHN0ZXAg
b2YgU1JQXG4iKSk7CisJcmV0dXJuIFNBU0xfRkFJTDsKKyAgICB9CisKKworICAgIC8qIHRyeSB0
byBnZXQgdGhlIGF1dGhpZCAqLworICAgIGlmICh0ZXh0LT5hdXRoaWQ9PU5VTEwpCisgICAgewor
CVZMICgoIlRyeWluZyB0byBnZXQgYXV0aGlkXG4iKSk7CisJYXV0aF9yZXN1bHQ9Z2V0X2F1dGhp
ZChwYXJhbXMsCisJCQkgICAgICAgJnRleHQtPmF1dGhpZCwKKwkJCSAgICAgICBwcm9tcHRfbmVl
ZCk7CisJICAKKwlpZiAoKGF1dGhfcmVzdWx0IT1TQVNMX09LKSAmJiAoYXV0aF9yZXN1bHQhPVNB
U0xfSU5URVJBQ1QpKQorCSAgICByZXR1cm4gYXV0aF9yZXN1bHQ7CSAgCisgICAgfQorCisgICAg
LyogdHJ5IHRvIGdldCB0aGUgdXNlcmlkICovCisgICAgaWYgKHRleHQtPnVzZXJpZCA9PSBOVUxM
KSB7CisgICAgICBWTCgoIlRyeWluZyB0byBnZXQgYXV0aG9yaXphdGlvbiBpZFxuIikpOworICAg
ICAgdXNlcl9yZXN1bHQgPSBnZXRfdXNlcmlkKHBhcmFtcywKKwkJCSAgICAgICAoY2hhciAqKikg
JnRleHQtPnVzZXJpZCwKKwkJCSAgICAgICBwcm9tcHRfbmVlZCk7CisKKyAgICAgIGlmICgodXNl
cl9yZXN1bHQgIT0gU0FTTF9PSykgJiYgKHVzZXJfcmVzdWx0ICE9IFNBU0xfSU5URVJBQ1QpKQor
ICAgICAgeworCSAgcmV0dXJuIHVzZXJfcmVzdWx0OworICAgICAgfQorICAgIH0KKyAgICAgIAor
ICAgIC8qIHRyeSB0byBnZXQgdGhlIHBhc3N3b3JkICovCisgICAgaWYgKHRleHQtPnBhc3N3b3Jk
PT1OVUxMKQorICAgIHsKKwlWTCAoKCJUcnlpbmcgdG8gZ2V0IHBhc3N3b3JkXG4iKSk7CisJcGFz
c19yZXN1bHQ9Z2V0X3Bhc3N3b3JkKHBhcmFtcywKKwkJCQkgJnRleHQtPnBhc3N3b3JkLAorCQkJ
CSBwcm9tcHRfbmVlZCk7CisJCisJaWYgKChwYXNzX3Jlc3VsdCE9U0FTTF9PSykgJiYgKHBhc3Nf
cmVzdWx0IT1TQVNMX0lOVEVSQUNUKSkKKwkgICAgcmV0dXJuIHBhc3NfcmVzdWx0OworICAgIH0K
KyAgICAKKyAgICAvKiBmcmVlIHByb21wdHMgd2UgZ290ICovCisgICAgaWYgKHByb21wdF9uZWVk
KSBmcmVlX3Byb21wdHMocGFyYW1zLCpwcm9tcHRfbmVlZCk7CisKKyAgICAvKiBpZiB0aGVyZSBh
cmUgcHJvbXB0cyBub3QgZmlsbGVkIGluICovCisgICAgaWYgKChhdXRoX3Jlc3VsdD09U0FTTF9J
TlRFUkFDVCkgfHwKKwkodXNlcl9yZXN1bHQ9PVNBU0xfSU5URVJBQ1QpIHx8CisJKHBhc3NfcmVz
dWx0PT1TQVNMX0lOVEVSQUNUKSkKKyAgICB7CisJLyogbWFrZSB0aGUgcHJvbXB0IGxpc3QgKi8K
KwlpbnQgcmVzdWx0PW1ha2VfcHJvbXB0cyhwYXJhbXMscHJvbXB0X25lZWQsCisJCQkJYXV0aF9y
ZXN1bHQsIHVzZXJfcmVzdWx0LCBwYXNzX3Jlc3VsdCk7CisJaWYgKHJlc3VsdCE9U0FTTF9PSykg
cmV0dXJuIHJlc3VsdDsKKwkKKwlWTCgoInJldHVybmluZyBwcm9tcHQocylcbiIpKTsKKwlyZXR1
cm4gU0FTTF9JTlRFUkFDVDsKKyAgICB9CisKKyAgICBWTCgoIlNlbmRpbmcgYXV0aGlkOiAlc1xu
Iix0ZXh0LT5hdXRoaWQpKTsKKworICAgIC8qIHNlbmQgYXV0aGVudGljYXRpb24gaWRlbnRpdHkg
CisgICAgICogeyB1dGY4KFUpIH0KKyAgICAgKi8KKworICAgIHIgPSBNYWtlVVRGOChwYXJhbXMt
PnV0aWxzLCB0ZXh0LT5hdXRoaWQsICZ1dGY4VSwgJnV0ZjhVbGVuKTsKKyAgICBpZiAocikgZ290
byBkb25lOworCisgICAgciA9IE1ha2VCdWZmZXIocGFyYW1zLT51dGlscywgdXRmOFUsIHV0ZjhV
bGVuLCBOVUxMLCAwLCBOVUxMLCAwLCBOVUxMLCAwLAorCQkgICBjbGllbnRvdXQsIGNsaWVudG91
dGxlbik7CisgICAgaWYgKHIpIGdvdG8gZG9uZTsKKworICAgIHRleHQtPnN0YXRlKys7CisgICAg
ciA9IFNBU0xfQ09OVElOVUU7CisKKyBkb25lOgorCisgICAgaWYgKHV0ZjhVKSAgICBwYXJhbXMt
PnV0aWxzLT5mcmVlKHV0ZjhVKTsKKworICAgIHJldHVybiByOworfQorCitzdGF0aWMgaW50Citj
bGllbnRfc3RlcDIoY29udGV4dF90ICp0ZXh0LAorCSAgICAgc2FzbF9jbGllbnRfcGFyYW1zX3Qg
KnBhcmFtcywKKwkgICAgIGNvbnN0IGNoYXIgKnNlcnZlcmluLAorCSAgICAgaW50IHNlcnZlcmlu
bGVuLAorCSAgICAgc2FzbF9pbnRlcmFjdF90ICoqcHJvbXB0X25lZWQgX19hdHRyaWJ1dGVfXygo
dW51c2VkKSksCisJICAgICBjaGFyICoqY2xpZW50b3V0LAorCSAgICAgaW50ICpjbGllbnRvdXRs
ZW4sCisJICAgICBzYXNsX291dF9wYXJhbXNfdCAqb3BhcmFtcyBfX2F0dHJpYnV0ZV9fKCh1bnVz
ZWQpKSkKIHsKLSAgaW50IHJlc3VsdDsKLSAgY29udGV4dF90ICp0ZXh0OwotICB0ZXh0PWNvbm5f
Y29udGV4dDsKKyAgICBjaGFyICpkYXRhOworICAgIGludCBkYXRhbGVuOworICAgIGludCByOyAg
ICAKKyAgICBjaGFyICp1dGY4SSA9IE5VTEwsICptcGlBID0gTlVMTCwgKnV0ZjhvID0gTlVMTDsK
KyAgICBpbnQgdXRmOElsZW4sIG1waUFsZW4sIHV0ZjhvbGVuOworICAgIHNycF9vcHRpb25zX3Qg
c2VydmVyX29wdHM7CiAKLSAgVkwoKCJTUlAgY2xpZW50IHN0ZXAgJWRcbiIsdGV4dC0+c3RhdGUp
KTsKKyAgICAvKiBleHBlY3Q6CisgICAgICogIHsgbXBpKE4pIG1waShnKSB1dGY4KEwpIH0KKyAg
ICAgKgorICAgICAqLworICAgIHIgPSBVbkJ1ZmZlcigoY2hhciAqKSBzZXJ2ZXJpbiwgc2VydmVy
aW5sZW4sICZkYXRhLCAmZGF0YWxlbik7CisgICAgaWYgKHIpIHJldHVybiByOworCisgICAgciA9
IEdldE1QSSgodW5zaWduZWQgY2hhciAqKWRhdGEsIGRhdGFsZW4sICZ0ZXh0LT5OLCAmZGF0YSwg
JmRhdGFsZW4pOworICAgIGlmIChyKSB7CisJVkwoKCJFcnJvciBnZXR0aW5nIE1QSSBzdHJpbmcg
Zm9yICdOJ1xuIikpOworCWdvdG8gZG9uZTsKKyAgICB9CiAKLSAgaWYgKHRleHQtPnN0YXRlID09
IDApIHsKKyAgICByID0gR2V0TVBJKCh1bnNpZ25lZCBjaGFyICopIGRhdGEsIGRhdGFsZW4sICZ0
ZXh0LT5nLCAmZGF0YSwgJmRhdGFsZW4pOworICAgIGlmIChyKSB7CisJVkwoKCJFcnJvciBnZXR0
aW5nIE1QSSBzdHJpbmcgZm9yICdnJ1xuIikpOworCWdvdG8gZG9uZTsKKyAgICB9CiAKLSAgICAg
IC8qIG5vdGhpbmcuIHNlcnZlciBtYWtlcyBmaXJzdCBjaGFsbGVuZ2UgKi8KKyAgICByID0gR2V0
VVRGOChwYXJhbXMtPnV0aWxzLCBkYXRhLCBkYXRhbGVuLCAmdGV4dC0+c2VydmVyX29wdGlvbnMs
ICZkYXRhLCAmZGF0YWxlbik7CisgICAgaWYgKHIpIHsKKwlWTCgoIkVycm9yIGdldHRpbmcgVVRG
OCBzdHJpbmcgZm9yICdMJyIpKTsKKwlnb3RvIGRvbmU7CisgICAgfQogCi0gICAgICAqY2xpZW50
b3V0PXBhcmFtcy0+dXRpbHMtPm1hbGxvYygxKTsKLSAgICAgIGlmICghICgqY2xpZW50b3V0KSkg
cmV0dXJuIFNBU0xfTk9NRU07Ci0gICAgICAoKmNsaWVudG91dClbMF09J1wwJzsKLSAgICAgICpj
bGllbnRvdXRsZW4gPSAwOwotCi0gICAgICBWTCgoIlN0ZXAgb25lIHN1Y2NlZWRlZCFcbiIpKTsK
LSAgICAgIHRleHQtPnN0YXRlID0gMTsKLSAgICAgIHJldHVybiBTQVNMX0NPTlRJTlVFOwotICB9
CisgICAgaWYgKGRhdGFsZW4gIT0gMCkgeworCVZMKCgiRXh0cmEgZGF0YSBwYXJzaW5nIGJ1ZmZl
clxuIikpOworCWdvdG8gZG9uZTsKKyAgICB9CiAKLSAgaWYgKHRleHQtPnN0YXRlID09IDEpIHsK
KyAgICAvKiBwYXJzZSBzZXJ2ZXIgb3B0aW9ucyAqLworICAgIG1lbXNldCgmc2VydmVyX29wdHMs
IDAsIHNpemVvZihzcnBfb3B0aW9uc190KSk7CisgICAgciA9IFBhcnNlT3B0aW9ucyhwYXJhbXMt
PnV0aWxzLCB0ZXh0LT5zZXJ2ZXJfb3B0aW9ucywgJnNlcnZlcl9vcHRzKTsKKyAgICBpZiAocikg
eworCVZMKCgiRXJyb3IgcGFyc2luZyBvcHRpb25zXG4iKSk7CisJZ290byBkb25lOworICAgIH0K
IAotICAgICAgbmV0ZGF0YV90ICpuZDE7Ci0gICAgICBuZXRkYXRhX3QgKm5kMjsKLSAgICAgIG5l
dGRhdGFfdCAqbmQzOwotCi0gICAgICBuZXRzdHJpbmdfdCAqbnMxOwotICAgICAgbmV0c3RyaW5n
X3QgKm5zMjsKLSAgICAgIG5ldHN0cmluZ190ICpuczM7Ci0KLSAgICAgIGludCByZXN1bHQ7Ci0g
ICAgICBpbnQgYXV0aF9yZXN1bHQ9U0FTTF9PSzsKLSAgICAgIGludCBwYXNzX3Jlc3VsdD1TQVNM
X09LOworICAgIC8qIGNyZWF0ZSBhbiAnYScgKi8KKyAgICBHZXRSYW5kQmlnSW50KHRleHQtPmEp
OwogCi0gICAgICAvKiB0cnkgdG8gZ2V0IHRoZSB1c2VyaWQgKi8KLSAgICAgIGlmICh0ZXh0LT5h
dXRoaWQ9PU5VTEwpCi0gICAgICB7Ci0JICBWTCAoKCJUcnlpbmcgdG8gZ2V0IGF1dGhpZFxuIikp
OwotCSAgYXV0aF9yZXN1bHQ9Z2V0X2F1dGhpZChwYXJhbXMsCi0JCQkJICZ0ZXh0LT5hdXRoaWQs
Ci0JCQkJIHByb21wdF9uZWVkKTsKLQkgIAotCSAgaWYgKChhdXRoX3Jlc3VsdCE9U0FTTF9PSykg
JiYgKGF1dGhfcmVzdWx0IT1TQVNMX0lOVEVSQUNUKSkKLQkgICAgICByZXR1cm4gYXV0aF9yZXN1
bHQ7CSAgCi0gICAgICB9CisgICAgLyogY2FsY3VsYXRlICdBJyAKKyAgICAgKgorICAgICAqIEEg
PSBnXmEgJSBOIAorICAgICAqLworICAgIG1wel9pbml0KHRleHQtPkEpOworICAgIG1wel9wb3dt
ICh0ZXh0LT5BLCB0ZXh0LT5nLCB0ZXh0LT5hLCB0ZXh0LT5OKTsKKworICAgIC8qIG1ha2UgbyAq
LworICAgIHIgPSBDcmVhdGVDbGllbnRPcHRzKHBhcmFtcywgJnNlcnZlcl9vcHRzLCAmdGV4dC0+
Y2xpZW50X29wdHMpOworICAgIGlmIChyKSB7CisJVkwoKCJFcnJvciBjcmVhdGluZyBjbGllbnQg
b3B0aW9uc1xuIikpOworCWdvdG8gZG9uZTsKKyAgICB9CisKKyAgICByID0gT3B0aW9uc1RvU3Ry
aW5nKHBhcmFtcy0+dXRpbHMsICZ0ZXh0LT5jbGllbnRfb3B0cywgJnRleHQtPmNsaWVudF9vcHRp
b25zKTsKKyAgICBpZiAocikgeworCVZMKCgiRXJyb3IgY29udmVydGluZyBjbGllbnQgb3B0aW9u
cyB0byBhbiBvcHRpb24gc3RyaW5nXG4iKSk7CisJZ290byBkb25lOworICAgIH0KICAgICAgIAot
ICAgICAgLyogdHJ5IHRvIGdldCB0aGUgcGFzc3dvcmQgKi8KLSAgICAgIGlmICh0ZXh0LT5wYXNz
d29yZD09TlVMTCkKLSAgICAgIHsKLQkgIFZMICgoIlRyeWluZyB0byBnZXQgcGFzc3dvcmRcbiIp
KTsKLQkgIHBhc3NfcmVzdWx0PWdldF9wYXNzd29yZChwYXJhbXMsCi0JCQkJICAgJnRleHQtPnBh
c3N3b3JkLAotCQkJCSAgIHByb21wdF9uZWVkKTsKLQkgIAotCSAgaWYgKChwYXNzX3Jlc3VsdCE9
U0FTTF9PSykgJiYgKHBhc3NfcmVzdWx0IT1TQVNMX0lOVEVSQUNUKSkKLQkgICAgICByZXR1cm4g
cGFzc19yZXN1bHQ7Ci0gICAgICB9CisgICAgLyogU2VuZCBvdXQ6CisgICAgICoKKyAgICAgKiBJ
IC0gYXV0aG9yaXphdGlvbgorICAgICAqIEEgLSBjbGllbnQncyBwdWJsaWMga2V5CisgICAgICog
byAtIGNsaWVudCBvcHRpb24gbGlzdAorICAgICAqCisgICAgICogeyB1ZjgoSSkgbXBpKEEpIHV0
ZjgobykgfQorICAgICAqLworICAgIAorICAgIHIgPSBNYWtlVVRGOChwYXJhbXMtPnV0aWxzLCB0
ZXh0LT51c2VyaWQsICZ1dGY4SSwgJnV0ZjhJbGVuKTsKKyAgICBpZiAocikgeworCVZMKCgiRXJy
b3IgbWFraW5nIFVURjggc3RyaW5nIGZyb20gdXNlcmlkICgnSScpXG4iKSk7CisJZ290byBkb25l
OworICAgIH0KKworICAgIHIgPSBNYWtlTVBJKHBhcmFtcy0+dXRpbHMsIHRleHQtPkEsICZtcGlB
LCAmbXBpQWxlbik7CisgICAgaWYgKHIpIHsKKwlWTCgoIkVycm9yIG1ha2luZyBNUEkgc3RyaW5n
IGZyb20gQVxuIikpOworCWdvdG8gZG9uZTsKKyAgICB9CisKKyAgICByID0gTWFrZVVURjgocGFy
YW1zLT51dGlscywgdGV4dC0+Y2xpZW50X29wdGlvbnMsICZ1dGY4bywgJnV0ZjhvbGVuKTsKKyAg
ICBpZiAocikgeworCVZMKCgiRXJyb3IgbWFraW5nIFVURjggc3RyaW5nIGZyb20gY2xpZW50IG9w
dGlvbnMgKCdvJylcbiIpKTsKKwlnb3RvIGRvbmU7CisgICAgfQorCisgICAgciA9IE1ha2VCdWZm
ZXIocGFyYW1zLT51dGlscywgdXRmOEksIHV0ZjhJbGVuLCBtcGlBLCBtcGlBbGVuLCB1dGY4bywg
dXRmOG9sZW4sIE5VTEwsIDAsCisJCSAgIGNsaWVudG91dCwgY2xpZW50b3V0bGVuKTsKKyAgICBp
ZiAocikgeworCVZMKCgiRXJyb3IgbWFraW5nIG91dHB1dCBidWZmZXJcbiIpKTsKKwlnb3RvIGRv
bmU7CisgICAgfQogCisgICAgdGV4dC0+c3RhdGUgKys7CisgICAgciA9IFNBU0xfQ09OVElOVUU7
CisKKyBkb25lOgogICAgIAotICAgICAgLyogZnJlZSBwcm9tcHRzIHdlIGdvdCAqLwotICAgICAg
aWYgKHByb21wdF9uZWVkKSBmcmVlX3Byb21wdHMocGFyYW1zLCpwcm9tcHRfbmVlZCk7CisgICAg
aWYgKHV0ZjhJKSAgICBwYXJhbXMtPnV0aWxzLT5mcmVlKHV0ZjhJKTsKKyAgICBpZiAobXBpQSkg
ICAgIHBhcmFtcy0+dXRpbHMtPmZyZWUobXBpQSk7CisgICAgaWYgKHV0ZjhvKSAgICBwYXJhbXMt
PnV0aWxzLT5mcmVlKHV0ZjhvKTsKIAotICAgICAgLyogaWYgdGhlcmUgYXJlIHByb21wdHMgbm90
IGZpbGxlZCBpbiAqLwotICAgICAgaWYgKChhdXRoX3Jlc3VsdD09U0FTTF9JTlRFUkFDVCkgfHwK
LQkgIChwYXNzX3Jlc3VsdD09U0FTTF9JTlRFUkFDVCkpCi0gICAgICB7Ci0JICAvKiBtYWtlIHRo
ZSBwcm9tcHQgbGlzdCAqLwotCSAgaW50IHJlc3VsdD1tYWtlX3Byb21wdHMocGFyYW1zLHByb21w
dF9uZWVkLAotCQkJCSAgYXV0aF9yZXN1bHQsIHBhc3NfcmVzdWx0KTsKLQkgIGlmIChyZXN1bHQh
PVNBU0xfT0spIHJldHVybiByZXN1bHQ7Ci0JICAKLQkgIFZMKCgicmV0dXJuaW5nIHByb21wdChz
KVxuIikpOwotCSAgcmV0dXJuIFNBU0xfSU5URVJBQ1Q7Ci0gICAgICB9CisgICAgcmV0dXJuIHI7
Cit9CisKK3N0YXRpYyBpbnQKK2NsaWVudF9zdGVwMyhjb250ZXh0X3QgKnRleHQsCisJICAgICBz
YXNsX2NsaWVudF9wYXJhbXNfdCAqcGFyYW1zLAorCSAgICAgY29uc3QgY2hhciAqc2VydmVyaW4s
CisJICAgICBpbnQgc2VydmVyaW5sZW4sCisJICAgICBzYXNsX2ludGVyYWN0X3QgKipwcm9tcHRf
bmVlZCBfX2F0dHJpYnV0ZV9fKCh1bnVzZWQpKSwKKwkgICAgIGNoYXIgKipjbGllbnRvdXQsCisJ
ICAgICBpbnQgKmNsaWVudG91dGxlbiwKKwkgICAgIHNhc2xfb3V0X3BhcmFtc190ICpvcGFyYW1z
ICBfX2F0dHJpYnV0ZV9fKCh1bnVzZWQpKSkKK3sKKyAgICBjaGFyICpkYXRhOworICAgIGludCBk
YXRhbGVuOworICAgIGludCByOyAgICAKKyAgICBjaGFyICpvc00xID0gTlVMTDsKKyAgICBpbnQg
b3NNMWxlbjsKKworICAgIC8qIEV4cGVjdDoKKyAgICAgKiAgeyBvcyhzKSBtcGkoQikgfQorICAg
ICAqCisgICAgICovCisgICAgciA9IFVuQnVmZmVyKChjaGFyICopIHNlcnZlcmluLCBzZXJ2ZXJp
bmxlbiwgJmRhdGEsICZkYXRhbGVuKTsKKyAgICBpZiAocikgcmV0dXJuIHI7CiAKLSAgICAgIHBy
aW50ZigiYXV0aGlkID0gJXNcbiIsdGV4dC0+YXV0aGlkKTsKKyAgICByID0gR2V0T1MocGFyYW1z
LT51dGlscywgKHVuc2lnbmVkIGNoYXIgKilkYXRhLCBkYXRhbGVuLCAmdGV4dC0+c2FsdCwgJnRl
eHQtPnNhbHRsZW4sICZkYXRhLCAmZGF0YWxlbik7CisgICAgaWYgKHIpIHJldHVybiByOwogCi0g
ICAgICAvKiBXZSByZWNlaXZlZDoKLSAgICAgICAqCi0gICAgICAgKiBOCi0gICAgICAgKiBnCi0g
ICAgICAgKiBaIC0gc2VydmVyIG9wdGlvbnMKLSAgICAgICAqLwotICAgICAgcmVzdWx0ID0gc3Bs
aXRfbmV0c3RyaW5ncyhwYXJhbXMtPnV0aWxzLCAmbmQxLCZuZDIsJm5kMywgKGNoYXIgKikgc2Vy
dmVyaW4sIHNlcnZlcmlubGVuKTsKLSAgICAgIGlmIChyZXN1bHQhPVNBU0xfT0spIHJldHVybiBy
ZXN1bHQ7Ci0KLSAgICAgIHByaW50Zigic3BsaXQgd29ya2VkXG4iKTsKKyAgICByID0gR2V0TVBJ
KCh1bnNpZ25lZCBjaGFyICopIGRhdGEsIGRhdGFsZW4sICZ0ZXh0LT5CLCAmZGF0YSwgJmRhdGFs
ZW4pOworICAgIGlmIChyKSByZXR1cm4gcjsKKworICAgIGlmIChkYXRhbGVuICE9IDApIHsKKwlW
TCgoIkV4dHJhIGRhdGEgcGFyc2luZyBidWZmZXJcbiIpKTsKKwlyZXR1cm4gU0FTTF9GQUlMOwor
ICAgIH0KKyAgICAKKyAgICAvKiBDYWxjdWxhdGUgc2hhcmVkIGNvbnRleHQga2V5IEsKKyAgICAg
KgorICAgICAqLworICAgIHIgPSBDYWxjdWxhdGVLX2NsaWVudChwYXJhbXMtPnV0aWxzLCB0ZXh0
LT5zYWx0LCB0ZXh0LT5zYWx0bGVuLCB0ZXh0LCB0ZXh0LT5hdXRoaWQsIAorCQkJICB0ZXh0LT5w
YXNzd29yZC0+ZGF0YSwgdGV4dC0+cGFzc3dvcmQtPmxlbiwgJnRleHQtPkssICZ0ZXh0LT5LbGVu
KTsKKyAgICBpZiAocikgcmV0dXJuIHI7CiAKLSAgICAgIHJlc3VsdCA9IGJpZ2ludF9mcm9tbmV0
ZGF0YShuZDEsIHBhcmFtcy0+dXRpbHMsIHRleHQtPk4pOwotICAgICAgaWYgKHJlc3VsdCE9U0FT
TF9PSykgcmV0dXJuIHJlc3VsdDsKKyAgICByID0gU2V0T3B0aW9ucygmdGV4dC0+Y2xpZW50X29w
dHMsIHRleHQsIHBhcmFtcy0+dXRpbHMsIG9wYXJhbXMpOworICAgIGlmIChyKSByZXR1cm4gcjsK
IAotICAgICAgcmVzdWx0ID0gYmlnaW50X2Zyb21uZXRkYXRhKG5kMiwgcGFyYW1zLT51dGlscywg
dGV4dC0+Zyk7Ci0gICAgICBpZiAocmVzdWx0IT1TQVNMX09LKSByZXR1cm4gcmVzdWx0OworICAg
IC8qIE5vdyBjYWxjdWxhdGUgTTEgKGNsaWVudCBldmlkZW5jZSkKKyAgICAgKgorICAgICAqLwor
ICAgIHIgPSBDYWxjdWxhdGVNMShwYXJhbXMtPnV0aWxzLCB0ZXh0LT5OLCB0ZXh0LT5nLCB0ZXh0
LT5hdXRoaWQsIHRleHQtPnNhbHQsIHRleHQtPnNhbHRsZW4sCisJCSAgICB0ZXh0LT5zZXJ2ZXJf
b3B0aW9ucywgdGV4dC0+QSwgdGV4dC0+QiwgdGV4dC0+SywgdGV4dC0+S2xlbiwKKwkJICAgICZ0
ZXh0LT5NMSwgJnRleHQtPk0xbGVuKTsKKyAgICBpZiAocikgcmV0dXJuIHI7CiAKLSAgICAgIGlm
IChuZDMtPnNpemUhPTEpIHsKLQkgIFZMKCgiT3B0aW9ucyBpcyB3cm9uZyBzaXplXG4iKSk7Ci0J
ICByZXR1cm4gU0FTTF9GQUlMOwotICAgICAgfQotICAgICAgdGV4dC0+c2VydmVyX29wdGlvbnMg
PSBuZDMtPmRhdGFbMF07CisgICAgLyogU2VuZDoKKyAgICAgKgorICAgICAqIHsgb3MoTTEpIH0K
KyAgICAgKi8KKyAgICAKKyAgICByID0gTWFrZU9TKHBhcmFtcy0+dXRpbHMsIHRleHQtPk0xLCB0
ZXh0LT5NMWxlbiwgJm9zTTEsICZvc00xbGVuKTsKKyAgICBpZiAocikgeworCVZMKCgiRXJyb3Ig
Y3JlYXRpbmcgT1Mgc3RyaW5nIGZvciBNMVxuIikpOworCWdvdG8gZG9uZTsKKyAgICB9CisKKyAg
ICByID0gTWFrZUJ1ZmZlcihwYXJhbXMtPnV0aWxzLCBvc00xLCBvc00xbGVuLCBOVUxMLCAwLCBO
VUxMLCAwLCBOVUxMLCAwLAorCQkgICBjbGllbnRvdXQsIGNsaWVudG91dGxlbik7CisgICAgaWYg
KHIpIHsKKwlWTCgoIkVycm9yIGNyZWF0aW5nIGJ1ZmZlciBpbiBzdGVwIDNcbiIpKTsKKwlnb3Rv
IGRvbmU7CisgICAgfQogCi0gICAgICBwcmludGYoImdvdCBOIGFuZCBnXG4iKTsKKyAgICB0ZXh0
LT5zdGF0ZSsrOworICAgIHIgPSBTQVNMX0NPTlRJTlVFOworIGRvbmU6CisKKyAgICBpZiAob3NN
MSkgICAgcGFyYW1zLT51dGlscy0+ZnJlZShvc00xKTsKKworICAgIHJldHVybiByOworfQogCi0g
ICAgICBwcmludGYoImNsaWVudCBnOiAiKTsKLSAgICAgIG1wel9vdXRfc3RyIChzdGRvdXQsIDEw
LCB0ZXh0LT5nKTsKLSAgICAgIHByaW50ZigiXG4iKTsKK3N0YXRpYyBpbnQKK2NsaWVudF9zdGVw
NChjb250ZXh0X3QgKnRleHQsCisJICAgICBzYXNsX2NsaWVudF9wYXJhbXNfdCAqcGFyYW1zLAor
CSAgICAgY29uc3QgY2hhciAqc2VydmVyaW4sCisJICAgICBpbnQgc2VydmVyaW5sZW4sCisJICAg
ICBzYXNsX2ludGVyYWN0X3QgKipwcm9tcHRfbmVlZCBfX2F0dHJpYnV0ZV9fKCh1bnVzZWQpKSwK
KwkgICAgIGNoYXIgKipjbGllbnRvdXQsCisJICAgICBpbnQgKmNsaWVudG91dGxlbiwKKwkgICAg
IHNhc2xfb3V0X3BhcmFtc190ICpvcGFyYW1zIF9fYXR0cmlidXRlX18oKHVudXNlZCkpKQorewor
ICAgIGNoYXIgKmRhdGE7CisgICAgaW50IGRhdGFsZW47CisgICAgaW50IHI7ICAgIAorICAgIGNo
YXIgKnNlcnZlck0yID0gTlVMTDsKKyAgICBpbnQgc2VydmVyTTJsZW47CisgICAgaW50IGk7Cisg
ICAgY2hhciAqbXlNMiA9IE5VTEw7CisgICAgaW50IG15TTJsZW47CiAKLSAgICAgIHByaW50Zigi
Y2xpZW50IE46ICIpOwotICAgICAgbXB6X291dF9zdHIgKHN0ZG91dCwgMTAsIHRleHQtPk4pOwot
ICAgICAgcHJpbnRmKCJcbiIpOworICAgIC8qIElucHV0OgorICAgICAqCisgICAgICogTTIgLSBz
ZXJ2ZXIgZXZpZGVuY2UKKyAgICAgKgorICAgICAqICAgeyBvcyhNMikgfQorICAgICAqLworICAg
IHIgPSBVbkJ1ZmZlcigoY2hhciAqKSBzZXJ2ZXJpbiwgc2VydmVyaW5sZW4sICZkYXRhLCAmZGF0
YWxlbik7CisgICAgaWYgKHIpIHJldHVybiByOwogCi0gICAgICAvKiBVICAtIGF1dGhuYW1lCi0g
ICAgICAgKiBBICAtIHB1YmxpYyBrZXkKLSAgICAgICAqIG8gIC0gb3B0aW9ucyBieXRlCi0gICAg
ICAgKi8KLSAgICAgIG5zMSA9IGNyZWF0ZV9uZXRzdHJpbmdfc3RyKHRleHQtPmF1dGhpZCxzdHJs
ZW4odGV4dC0+YXV0aGlkKSwgcGFyYW1zLT51dGlscyk7CisgICAgciA9IEdldE9TKHBhcmFtcy0+
dXRpbHMsICh1bnNpZ25lZCBjaGFyICopZGF0YSwgZGF0YWxlbiwgJnNlcnZlck0yLCAmc2VydmVy
TTJsZW4sCisJICAgICAgJmRhdGEsICZkYXRhbGVuKTsKKyAgICBpZiAocikgcmV0dXJuIHI7CisK
KyAgICBpZiAoZGF0YWxlbiAhPSAwKSB7CisJVkwoKCJFeHRyYSBkYXRhIHBhcnNpbmcgYnVmZmVy
XG4iKSk7CisJciA9IFNBU0xfRkFJTDsKKwlnb3RvIGRvbmU7CisgICAgfQogCi0gICAgICBuczIg
PSBjcmVhdGVfcHVibGljX2NsaWVudCh0ZXh0LT5nLHRleHQtPk4sIHRleHQtPmEsIHRleHQtPkEs
IHBhcmFtcy0+dXRpbHMpOworICAgIC8qIGNhbGN1bGF0ZSBvdXIgb3duIE0yICovCisgICAgciA9
IENhbGN1bGF0ZU0yKHBhcmFtcy0+dXRpbHMsIHRleHQtPkEsIHRleHQtPmF1dGhpZCwgdGV4dC0+
dXNlcmlkLAorCQkgICAgdGV4dC0+Y2xpZW50X29wdGlvbnMsIHRleHQtPk0xLCB0ZXh0LT5NMWxl
biwgdGV4dC0+SywgdGV4dC0+S2xlbiwKKwkJICAgICZteU0yLCAmbXlNMmxlbik7CisgICAgaWYg
KHIpIHsKKwlWTCgoIkVycm9yIGNhbGN1bGF0aW5nIG91ciBvd24gTTIgKHNlcnZlciBldmlkZW5j
ZSlcbiIpKTsKKwlnb3RvIGRvbmU7CisgICAgfQogCi0gICAgICBwcmludGYoImNyZWF0ZWQgcHVi
bGljIG5ldHN0cmluZ1xuIik7CisgICAgLyogY29tcGFyZSB0byBzZWUgaWYgaXMgc2VydmVyIHNw
b29mICovCisgICAgaWYgKG15TTJsZW4gIT0gc2VydmVyTTJsZW4pIHsKKwlWTCgoIlNlcnZlciBN
MiBsZW5ndGggd3JvbmdcbiIpKTsKKwlyID0gU0FTTF9GQUlMOworCWdvdG8gZG9uZTsKKyAgICB9
CiAKLSAgICAgIC8qIHh4eCBjbGllbnQgb3B0aW9ucyAqLwotICAgICAgdGV4dC0+Y2xpZW50X29w
dGlvbnMgPSAwOworICAgIAorICAgIGZvciAoaSA9IDA7IGkgPCBteU0ybGVuOyBpKyspIHsKKwlp
ZiAoc2VydmVyTTJbaV0gIT0gbXlNMltpXSkgeworCSAgICBWTCgoIlNlcnZlciBzcG9vZiBkZXRl
Y3RlZC4gTTIgaW5jb3JyZWN0XG4iKSk7CisJICAgIHIgPSBTQVNMX0ZBSUw7CisJICAgIGdvdG8g
ZG9uZTsKKwl9CisgICAgfQogCi0gICAgICAvKiBjcmVhdGUgb3B0aW9ucyAqLwotICAgICAgbnMz
ID0gY3JlYXRlX25ldHN0cmluZ19zdHIoJnRleHQtPmNsaWVudF9vcHRpb25zLDEsIHBhcmFtcy0+
dXRpbHMpOworICAgIC8qIFNlbmQgb3V0OiBub3RoaW5nCisgICAgICoKKyAgICAgKi8KKyAgICAq
Y2xpZW50b3V0ID0gTlVMTDsKKyAgICAqY2xpZW50b3V0bGVuID0gMDsKIAotICAgICAgbWVyZ2Vf
bmV0c3RyaW5ncyhwYXJhbXMtPnV0aWxzLCBuczEsbnMyLG5zMyxjbGllbnRvdXQsY2xpZW50b3V0
bGVuKTsKKyAgICB0ZXh0LT5zdGF0ZSsrOworICAgIHIgPSBTQVNMX09LOwogCi0gICAgICB0ZXh0
LT5zdGF0ZSA9IDI7Ci0gICAgICByZXR1cm4gU0FTTF9DT05USU5VRTsKLSAgfQotICBpZiAodGV4
dC0+c3RhdGUgPT0gMikgeyAvKiBjbGllbnQgc3RlcCAyICovCi0gICAgICBuZXRkYXRhX3QgKm5k
MTsKLSAgICAgIG5ldGRhdGFfdCAqbmQyOwotICAgICAgbmV0c3RyaW5nX3QgKm5zMTsKLSAgICAg
IG5ldHN0cmluZ190ICp0bXBuczsKLSAgICAgIG1wel90IGV4cDsKLSAgICAgIGludCBsdXA7Ci0g
ICAgICBoYXNoX3QgaGFzaGVkQjsKLSAgICAgIHVuc2lnbmVkIGludCB1OwotICAgICAgaGFzaF90
IGhhc2h4OwotICAgICAgbXB6X3QgeDsKLQotICAgICAgLyogV2UgcmVjZWl2ZWQgCi0gICAgICAg
KgotICAgICAgICogcyAtIHNhbHQKLSAgICAgICAqIEIgLSBzZXJ2ZXIgcHVibGljIGtleQotICAg
ICAgICovCi0KLSAgICAgIHJlc3VsdCA9IHNwbGl0X25ldHN0cmluZ3MocGFyYW1zLT51dGlscywg
Jm5kMSwmbmQyLE5VTEwsIChjaGFyICopIHNlcnZlcmluLCBzZXJ2ZXJpbmxlbik7Ci0gICAgICBp
ZiAocmVzdWx0IT1TQVNMX09LKSByZXR1cm4gcmVzdWx0OwotCi0gICAgICByZXN1bHQgPSBiaWdp
bnRfZnJvbW5ldGRhdGEobmQyLCBwYXJhbXMtPnV0aWxzLCB0ZXh0LT5CKTsKLSAgICAgIGlmIChy
ZXN1bHQhPVNBU0xfT0spIHJldHVybiByZXN1bHQ7Ci0KLSAgICAgIHByaW50ZigiY2xpZW50IEI6
ICIpOwotICAgICAgbXB6X291dF9zdHIgKHN0ZG91dCwgMTAsIHRleHQtPkIpOwotICAgICAgcHJp
bnRmKCJcbiIpOwotCi0gICAgICBwcmludGYoImZvb1xuIik7Ci0gICAgICAvKiBDYWxjdWxhdGUg
c2hhcmVkIHNlY3JldCBTICovCi0gICAgICAvKiBTID0gKEIgLSBnXngpIF4gKGErdSp4KSAlTiAq
LwotCi0KLSAgICAgIC8qIHUgaXMgZmlyc3QgMzIgYml0cyBvZiBCOyBNU0IgZmlyc3QgKi8gICAg
ICAKLSAgICAgIEhhc2hfYmlnaW50KHRleHQtPkIsICZoYXNoZWRCLCBwYXJhbXMtPnV0aWxzKTsK
LSAgICAgIG1lbWNweSgmdSwgaGFzaGVkQi5kYXRhLCA0KTsKLSAgICAgIHUgPSBudG9obCh1KTsg
ICAgICAKLQotICAgICAgcHJpbnRmKCJjbGllbnQgVSA9ICVkXG4iLHUpOwotCi0gICAgICAvKiBn
ZW5lcmF0ZSB4ICovCi0gICAgICByZXN1bHQgPSBjYWxjdWxhdGVfeChwYXJhbXMtPnV0aWxzLAot
CQkJICAgdGV4dC0+YXV0aGlkLCBzdHJsZW4odGV4dC0+YXV0aGlkKSwgCi0JCQkgICB0ZXh0LT5w
YXNzd29yZC0+ZGF0YSx0ZXh0LT5wYXNzd29yZC0+bGVuLCAKLQkJCSAgIG5kMS0+ZGF0YSwgbmQx
LT5zaXplLAotCQkJICAgeCk7Ci0gICAgICBpZiAocmVzdWx0IT1TQVNMX09LKSByZXR1cm4gcmVz
dWx0OwotCi0gICAgICAvKiBleHAgPSBhK3UqeCAqLwotICAgICAgbXB6X2luaXQoZXhwKTsKLSAg
ICAgIG1wel9tdWxfdWkgKGV4cCwgeCwgdSk7Ci0gICAgICBtcHpfYWRkKGV4cCxleHAsdGV4dC0+
YSk7Ci0KLSAgICAgIC8qICh0bXApUyA9IEIgLSBnXnggKi8KLSAgICAgIG1wel9pbml0KHRleHQt
PlMpOwotICAgICAgbXB6X3Bvd20gKHRleHQtPlMsIHRleHQtPmcsIHgsIHRleHQtPk4pOyAgICAg
Ci0gICAgICBwcmludGYoImNhbGN1bGF0ZWQgZzogIik7Ci0gICAgICBtcHpfb3V0X3N0ciAoc3Rk
b3V0LCAxMCwgdGV4dC0+Zyk7Ci0gICAgICBwcmludGYoIlxuIik7Ci0gICAgICBwcmludGYoImNh
bGN1bGF0ZWQgeDogIik7Ci0gICAgICBtcHpfb3V0X3N0ciAoc3Rkb3V0LCAxMCwgeCk7Ci0gICAg
ICBwcmludGYoIlxuIik7Ci0gICAgICBwcmludGYoImNhbGN1bGF0ZWQgTjogIik7Ci0gICAgICBt
cHpfb3V0X3N0ciAoc3Rkb3V0LCAxMCwgdGV4dC0+Tik7Ci0gICAgICBwcmludGYoIlxuIik7Ci0g
ICAgICAgcHJpbnRmKCJjYWxjdWxhdGVkIHRtcFMgMTogIik7Ci0gICAgICBtcHpfb3V0X3N0ciAo
c3Rkb3V0LCAxMCwgdGV4dC0+Uyk7Ci0gICAgICBwcmludGYoIlxuIik7Ci0KLSAgICAgIG1wel9z
dWIodGV4dC0+UywgdGV4dC0+Qix0ZXh0LT5TKTsKLQotICAgICAgcHJpbnRmKCJjYWxjdWxhdGVk
IHRtcFM6ICIpOwotICAgICAgbXB6X291dF9zdHIgKHN0ZG91dCwgMTAsIHRleHQtPlMpOwotICAg
ICAgcHJpbnRmKCJcbiIpOwotCi0gICAgICAvKiBTID0gdG1wU15leHAgJSBOICovCi0gICAgICBt
cHpfcG93bSh0ZXh0LT5TLCB0ZXh0LT5TLCBleHAsIHRleHQtPk4pOwotCi0gICAgICBwcmludGYo
ImNsaWVudCBjYWxjdWxhdGVkIFM6ICIpOwotICAgICAgbXB6X291dF9zdHIgKHN0ZG91dCwgMTAs
IHRleHQtPlMpOwotICAgICAgcHJpbnRmKCJcbiIpOwotCi0gICAgICByZXN1bHQgPSBTSEFfSW50
ZXJsZWF2ZSh0ZXh0LT5TLCAmdGV4dC0+c2hhcmVkc2VjcmV0SywgcGFyYW1zLT51dGlscyk7Ci0g
ICAgICBpZiAocmVzdWx0IT1TQVNMX09LKSByZXR1cm4gcmVzdWx0OwotCi0gICAgICAvKgotICAg
ICAgICogR2l2ZSBvdXQ6Ci0gICAgICAgKiAgTTEKLSAgICAgICAqCi0gICAgICAgKi8KLQotICAg
ICAgcmVzdWx0ID0gY2FsY3VsYXRlX2NsaWVudF9ldmlkZW5jZSh0ZXh0LT5OLCB0ZXh0LT5nLAot
CQkJCQkgbmQxLT5kYXRhLCBuZDEtPnNpemUsCi0JCQkJCSB0ZXh0LT5zZXJ2ZXJfb3B0aW9ucywK
LQkJCQkJIHRleHQtPkEsIHRleHQtPkIsCi0JCQkJCSAmdGV4dC0+c2hhcmVkc2VjcmV0SywKLQkJ
CQkJICYodGV4dC0+TTEpLAotCQkJCQkgcGFyYW1zLT51dGlscyk7Ci0gICAgICBpZiAocmVzdWx0
IT1TQVNMX09LKSByZXR1cm4gcmVzdWx0OworIGRvbmU6CiAKKyAgICBpZiAoc2VydmVyTTIpICAg
IHBhcmFtcy0+dXRpbHMtPmZyZWUoc2VydmVyTTIpOworICAgIGlmIChteU0yKSAgICAgICAgcGFy
YW1zLT51dGlscy0+ZnJlZShteU0yKTsKIAotICAgICAgbnMxID0gY3JlYXRlX25ldHN0cmluZ19z
dHIodGV4dC0+TTEuZGF0YSwgc2l6ZW9mKHRleHQtPk0xLmRhdGEpLCBwYXJhbXMtPnV0aWxzKTsK
LSAgICAgIGlmIChuczE9PU5VTEwpIHJldHVybiBTQVNMX05PTUVNOwotICAgICAgCi0gICAgICAq
Y2xpZW50b3V0ID0gcGFyYW1zLT51dGlscy0+bWFsbG9jKG5zMS0+c2l6ZSsxKTsKLSAgICAgIGlm
ICghKmNsaWVudG91dCkgcmV0dXJuIFNBU0xfTk9NRU07Ci0gICAgICBtZW1jcHkoKmNsaWVudG91
dCwgbnMxLT5kYXRhLCBuczEtPnNpemUpOwotICAgICAgKmNsaWVudG91dGxlbiA9IG5zMS0+c2l6
ZTsKLSAgICAgIAorICAgIHJldHVybiByOworfQogCi0gICAgICB0ZXh0LT5zdGF0ZSA9IDM7Ci0g
ICAgICByZXR1cm4gU0FTTF9DT05USU5VRTsKLSAgfQorc3RhdGljIGludAorY2xpZW50X2NvbnRp
bnVlX3N0ZXAodm9pZCAqY29ubl9jb250ZXh0LAorCQkgICAgIHNhc2xfY2xpZW50X3BhcmFtc190
ICpwYXJhbXMsCisJCSAgICAgY29uc3QgY2hhciAqc2VydmVyaW4sCisJCSAgICAgaW50IHNlcnZl
cmlubGVuLAorCQkgICAgIHNhc2xfaW50ZXJhY3RfdCAqKnByb21wdF9uZWVkLAorCQkgICAgIGNo
YXIgKipjbGllbnRvdXQsCisJCSAgICAgaW50ICpjbGllbnRvdXRsZW4sCisJCSAgICAgc2FzbF9v
dXRfcGFyYW1zX3QgKm9wYXJhbXMpCit7CisgIGNvbnRleHRfdCAqdGV4dCA9IGNvbm5fY29udGV4
dDsKIAotICBpZiAodGV4dC0+c3RhdGUgPT0gMykgeworICBWTCgoIlNSUCBjbGllbnQgc3RlcCAl
ZFxuIix0ZXh0LT5zdGF0ZSkpOwogCi0gICAgICB1bnNpZ25lZCBjaGFyICpNMmluOwotICAgICAg
aW50IE0yaW5sZW47Ci0gICAgICBoYXNoX3QgTTI7Ci0gICAgICBpbnQgbHVwOwotICAgICAgCi0g
ICAgICAvKgotICAgICAgICogUmV0cmlldmUgTTIgYW5kIHZlcmlmeSBpdAotICAgICAgICoKLSAg
ICAgICAqLwotICAgICAgcmVzdWx0ID0gY2hlY2t2YWxpZF9uZXRzdHJpbmcoKGNoYXIgKikgc2Vy
dmVyaW4sIHNlcnZlcmlubGVuLCAoY2hhciAqKSAmTTJpbiwgJk0yaW5sZW4pOwotICAgICAgaWYg
KHJlc3VsdCE9U0FTTF9PSykgcmV0dXJuIHJlc3VsdDsgICAgICAKLQotICAgICAgLyogTGV0J3Mg
Y2FsY3VsYXRlIE0yIG91cnNlbHZlcyBhbmQgc2VlIGlmIGl0IG1hdGNoZXMgKi8KLSAgICAgIHJl
c3VsdCA9IGNhbGN1bGF0ZV9zZXJ2ZXJfZXZpZGVuY2UodGV4dC0+YXV0aGlkLAotCQkJCQkgdGV4
dC0+QSwKLQkJCQkJIHRleHQtPmNsaWVudF9vcHRpb25zLAotCQkJCQkgJih0ZXh0LT5NMSksCi0J
CQkJCSAmdGV4dC0+c2hhcmVkc2VjcmV0SywKLQkJCQkJICZNMiwKLQkJCQkJIHBhcmFtcy0+dXRp
bHMpOwotICAgICAgaWYgKHJlc3VsdCE9U0FTTF9PSykgcmV0dXJuIHJlc3VsdDsgICAgICAKLSAg
ICAgIAotICAgICAgZm9yIChsdXA9MDtsdXA8SEFTSExFTjtsdXArKykKKyAgc3dpdGNoKHRleHQt
PnN0YXRlKQogICAgICAgewotCSAgaWYgKE0yaW5bbHVwXSE9TTIuZGF0YVtsdXBdKSB7Ci0JICAg
ICAgVkwgKCgiU2VydmVyIGV2aWRlbmNlIGZhaWx1cmVcbiIpKTsKLQkgICAgICByZXR1cm4gU0FT
TF9GQUlMOwotCSAgfQorICAgICAgY2FzZSAwOgorICAgICAgY2FzZSAxOiByZXR1cm4gY2xpZW50
X3N0ZXAxKHRleHQsIHBhcmFtcywgc2VydmVyaW4sIHNlcnZlcmlubGVuLCAKKwkJCQkgIHByb21w
dF9uZWVkLCBjbGllbnRvdXQsIGNsaWVudG91dGxlbiwgb3BhcmFtcyk7CisgICAgICBjYXNlIDI6
IHJldHVybiBjbGllbnRfc3RlcDIodGV4dCwgcGFyYW1zLCBzZXJ2ZXJpbiwgc2VydmVyaW5sZW4s
IAorCQkJCSAgcHJvbXB0X25lZWQsIGNsaWVudG91dCwgY2xpZW50b3V0bGVuLCBvcGFyYW1zKTsK
KyAgICAgIGNhc2UgMzogcmV0dXJuIGNsaWVudF9zdGVwMyh0ZXh0LCBwYXJhbXMsIHNlcnZlcmlu
LCBzZXJ2ZXJpbmxlbiwgCisJCQkJICBwcm9tcHRfbmVlZCwgY2xpZW50b3V0LCBjbGllbnRvdXRs
ZW4sIG9wYXJhbXMpOworICAgICAgY2FzZSA0OiByZXR1cm4gY2xpZW50X3N0ZXA0KHRleHQsIHBh
cmFtcywgc2VydmVyaW4sIHNlcnZlcmlubGVuLCAKKwkJCQkgIHByb21wdF9uZWVkLCBjbGllbnRv
dXQsIGNsaWVudG91dGxlbiwgb3BhcmFtcyk7CisgICAgICBkZWZhdWx0OgorCSAgVkwoKCJJbnZh
bGlkIFNSUCBzdGVwXG4iKSk7CisJICByZXR1cm4gU0FTTF9GQUlMOwogICAgICAgfQogCi0gICAg
ICAqY2xpZW50b3V0ID0gcGFyYW1zLT51dGlscy0+bWFsbG9jKDEpOwotICAgICAgaWYgKCEqY2xp
ZW50b3V0KSByZXR1cm4gU0FTTF9OT01FTTsKLSAgICAgICgqY2xpZW50b3V0KVswXSA9ICdcMCc7
Ci0gICAgICAqY2xpZW50b3V0bGVuID0gMDsKLQotICAgICAgdGV4dC0+c3RhdGUgPSA0OyAgICAg
Ci0gICAgICByZXR1cm4gU0FTTF9PSzsKLSAgfQotCiAgIHJldHVybiBTQVNMX0ZBSUw7CiB9CiAK
IHN0YXRpYyBjb25zdCBsb25nIGNsaWVudF9yZXF1aXJlZF9wcm9tcHRzW10gPSB7CiAgIFNBU0xf
Q0JfQVVUSE5BTUUsCisgIFNBU0xfQ0JfUEFTUywKICAgU0FTTF9DQl9MSVNUX0VORAogfTsKIAor
CisvKiBYWFggRm9yIG5vdyB3ZSBvbmx5IHN1cHBvcnQgb25lIGhhc2ggdHlwZSAqLwogc3RhdGlj
IGNvbnN0IHNhc2xfY2xpZW50X3BsdWdfdCBjbGllbnRfcGx1Z2luc1tdID0gCiB7CiAgIHsKLSAg
ICAiU1JQIiwJICAgCSAgICAgICAgLyogbWVjaF9uYW1lICovCisgICAgIlNSUC1NRDUtMTIwIiwg
ICAJICAgICAgICAvKiBtZWNoX25hbWUgKi8KICAgICAwLAkJCQkvKiBtYXhfc3NmICovCiAgICAg
U0FTTF9TRUNfTk9QTEFJTlRFWFQsCS8qIHNlY3VyaXR5X2ZsYWdzICovCiAgICAgY2xpZW50X3Jl
cXVpcmVkX3Byb21wdHMsCS8qIHJlcXVpcmVkX3Byb21wdHMgKi8KQEAgLTIxMjksMTEgKzM0MjYs
MTEgQEAKICAgfQogfTsKIAotaW50IHNhc2xfY2xpZW50X3BsdWdfaW5pdChzYXNsX3V0aWxzX3Qg
KnV0aWxzIF9fYXR0cmlidXRlX18oKHVudXNlZCkpLAotCQkJICBpbnQgbWF4dmVyc2lvbiwKLQkJ
CSAgaW50ICpvdXRfdmVyc2lvbiwKLQkJCSAgY29uc3Qgc2FzbF9jbGllbnRfcGx1Z190ICoqcGx1
Z2xpc3QsCi0JCQkgIGludCAqcGx1Z2NvdW50KQoraW50IHNycF9zYXNsX2NsaWVudF9wbHVnX2lu
aXQoc2FzbF91dGlsc190ICp1dGlscyBfX2F0dHJpYnV0ZV9fKCh1bnVzZWQpKSwKKwkJCSAgICAg
IGludCBtYXh2ZXJzaW9uLAorCQkJICAgICAgaW50ICpvdXRfdmVyc2lvbiwKKwkJCSAgICAgIGNv
bnN0IHNhc2xfY2xpZW50X3BsdWdfdCAqKnBsdWdsaXN0LAorCQkJICAgICAgaW50ICpwbHVnY291
bnQpCiB7CiAgIGlmIChtYXh2ZXJzaW9uIDwgU1JQX1ZFUlNJT04pCiAgICAgcmV0dXJuIFNBU0xf
QkFEVkVSUzsK
</data>        

          </attachment>
      

    </bug>

</bugzilla>