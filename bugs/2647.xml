<?xml version="1.0" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugzilla.cyrusimap.org/bugzilla.dtd">

<bugzilla version="3.2.5.1-2"
          urlbase="https://bugzilla.cyrusimap.org/"
          maintainer="Dave McMurtrie &lt;dave64@andrew.cmu.edu&gt;"
>

    <bug>
          <bug_id>2647</bug_id>
          
          <creation_ts>2005-04-07 23:40 EDT</creation_ts>
          <short_desc>Master needs to process all pending child messages in one go</short_desc>
          <delta_ts>2010-10-18 06:27:06 EDT</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Cyrus IMAP</product>
          <component>IMAP</component>
          <version>2.4.0</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>CLOSED</bug_status>
          <resolution>FIXED</resolution>
          
          
          
          
          <priority>P1</priority>
          <bug_severity>bug</bug_severity>
          <target_milestone>2.4.1</target_milestone>
          
          <blocked>3275</blocked>
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Henrique de Moraes Holschuh">hmh@debian.org</reporter>
          <assigned_to name="Bron Gondwana">brong@fastmail.fm</assigned_to>
          <cc>brong@fastmail.fm</cc>
    
    <cc>carsten-schaub@arcor.de</cc>
    
    <cc>pkg-cyrus-imapd-debian-devel@lists.alioth.debian.org</cc>
    
    <cc>vanmeeuwen@kolabsys.com</cc>
          <qa_contact name="The Cyrus Bugzilla List">cyrus-bugzilla@lists.andrew.cmu.edu</qa_contact>

      

      

      
          <long_desc isprivate="0">
            <who name="Henrique de Moraes Holschuh">hmh@debian.org</who>
            <bug_when>2005-04-07 23:40:24 EDT</bug_when>
            <thetext>There was a deficiency on the original patch that was the base for the Cyrus
master child tracking code present in 2.2.  It only parses one message per cycle
as 2.1 used to do, but this is deadly for the new code (which is a bug by itself).

The attached patch, which will not apply cleanly (it is for the highly modified
Debian Cyrus IMAPd 2.1 tree) implements the fix, AND also adds a way to tweak
the ammount of time master remembers dead children.

There is one other bug in the current code, that this patch does not fix: on the
pathological case where the messages are not being processed, the paranoia
resilience code in master should be capable of avoiding the resource starvation,
and it is currently not doing that.</thetext>
          </long_desc>
          <long_desc isprivate="0">
            <who name="Henrique de Moraes Holschuh">hmh@debian.org</who>
            <bug_when>2005-04-07 23:41:41 EDT</bug_when>
            <thetext>Created an attachment (id=339)
Process all messages in one go, and add -J option to master

Partial fix for this bug, but won&apos;t apply cleanly.  Should be used as a
reference for forward-porting the fix to 2.2.</thetext>
          </long_desc>
          <long_desc isprivate="0">
            <who name="Derrick">shadow@andrew.cmu.edu</who>
            <bug_when>2005-04-13 11:50:58 EDT</bug_when>
            <thetext>Created an attachment (id=342)
Ported to 2.3, still need to test

Ported to 2.3, still need to test</thetext>
          </long_desc>
          <long_desc isprivate="0">
            <who name="Henrique de Moraes Holschuh">hmh@debian.org</who>
            <bug_when>2006-02-19 21:25:25 EDT</bug_when>
            <thetext>*** Bug 2800 has been marked as a duplicate of this bug. ***</thetext>
          </long_desc>
          <long_desc isprivate="0">
            <who name="Henrique de Moraes Holschuh">hmh@debian.org</who>
            <bug_when>2006-02-19 21:30:58 EDT</bug_when>
            <thetext>Created an attachment (id=419)
Process all messages in one go, and add -J option to master, 2.2.12

This is the up-to-date version of the patch, as used by Debian&apos;s 2.2.12
experimental packages.</thetext>
          </long_desc>
          <long_desc isprivate="0">
            <who name="Henrique de Moraes Holschuh">hmh@debian.org</who>
            <bug_when>2006-02-19 21:32:54 EDT</bug_when>
            <thetext>(From update of attachment 419)
Patch has other noise (unrelated changes) in it. A new, clean version will be
uploaded shortly
</thetext>
          </long_desc>
          <long_desc isprivate="0">
            <who name="Henrique de Moraes Holschuh">hmh@debian.org</who>
            <bug_when>2006-02-19 21:34:22 EDT</bug_when>
            <thetext>(From update of attachment 339)
Un-obsolete, patch 419 is not good.
</thetext>
          </long_desc>
          <long_desc isprivate="0">
            <who name="Henrique de Moraes Holschuh">hmh@debian.org</who>
            <bug_when>2006-02-19 21:46:28 EDT</bug_when>
            <thetext>Created an attachment (id=420)
master 2.2.x: Add -J option (Janitor mourn time), fix period/frequency usage

This patch implements the -J option in master/master.c, release 2.2.12.

It also fixes the incorrect usage of &quot;period&quot; for the janitor sweeping
frequency.

Please apply.  It obsoletes patch 339 partially.</thetext>
          </long_desc>
          <long_desc isprivate="0">
            <who name="Henrique de Moraes Holschuh">hmh@debian.org</who>
            <bug_when>2006-02-19 21:54:20 EDT</bug_when>
            <thetext>Created an attachment (id=421)
master 2.2.x: better error message when receving signals from the dead

This patch changes an error message so that it describes much better what is
really happening.

It has reduced context so that it will apply cleanly (with an offset, but no
fuzz) against code patched with patch 420.</thetext>
          </long_desc>
          <long_desc isprivate="0">
            <who name="Henrique de Moraes Holschuh">hmh@debian.org</who>
            <bug_when>2006-02-19 22:08:37 EDT</bug_when>
            <thetext>Created an attachment (id=422)
master 2.2.x: Process all pending messages of a service in one go

Fixes a very very nasty bug in master which causes the child accounting to lose
sync in busy servers.

It changes master to process all pending messages in one go, as that is the
only way we can handle busy servers.</thetext>
          </long_desc>
          <long_desc isprivate="0">
            <who name="Henrique de Moraes Holschuh">hmh@debian.org</who>
            <bug_when>2006-02-19 22:09:10 EDT</bug_when>
            <thetext>(From update of attachment 339)
Made obsolete by patches 420, 421 and 422
</thetext>
          </long_desc>
          <long_desc isprivate="0">
            <who name="Jeroen van Meeuwen (Kolab Systems)">vanmeeuwen@kolabsys.com</who>
            <bug_when>2010-10-12 12:18:05 EDT</bug_when>
            <thetext>(From update of attachment 422)
Applied patch 422 to ticket/2647/master, obsoleting this patch. Awaiting acknowledgement from Bron or Ken before merging this back in with master and/or cyrus-imapd-2.4.</thetext>
          </long_desc>
          <long_desc isprivate="0">
            <who name="Jeroen van Meeuwen (Kolab Systems)">vanmeeuwen@kolabsys.com</who>
            <bug_when>2010-10-12 12:19:00 EDT</bug_when>
            <thetext>Update target milestone.</thetext>
          </long_desc>
          <long_desc isprivate="0">
            <who name="Henrique de Moraes Holschuh">hmh@debian.org</who>
            <bug_when>2010-10-12 14:05:18 EDT</bug_when>
            <thetext>Don&apos;t use ANY of these old patches.  I have a new set.</thetext>
          </long_desc>
          <long_desc isprivate="0">
            <who name="Henrique de Moraes Holschuh">hmh@debian.org</who>
            <bug_when>2010-10-12 14:08:22 EDT</bug_when>
            <thetext>Created an attachment (id=1307)
Full bug fix with proper commit message, forward-ported to 2.3

From: Henrique de Moraes Holschuh &lt;hmh@debian.org&gt;
Subject: Fixes process (child) handling in Cyrus master

Origin: vendor, Debian Cyrus IMAPd 2.1.16-7 (2004-08-07), 2.3.16-1

* Allows Cyrus master to process all pending child messages once per
  loop, which fixes a DoS situation if there is too much message churn
  in a slower box.  If the pending messages never get processed,
  eventually master stops spawning the service or handling connections.

  It seems that the problem this patch fixes has also been reported in
  Cyrus IMAP 2.2.12 by Earl Shannon, and Jules Agee actually tried to
  get the fix from Debian integrated upstream.

  Jules Agee described the problem quite well in a private message:

     &quot;The problem occurs when the child message queue is very backed up.
     A child process dies with several messages in the queue. reap_child
     marks it&apos;s state in the child table as dead and decrements the
     number of ready_workers.  Then the janitor process removes that
     child&apos;s entry from the child table.  When master finally gets
     around to processing all the messages in the child message queue,
     it has no idea where the message came from because the child&apos;s
     entry has already been removed from the ctable.  So it creates a
     new ctable entry, marking the child process state as unknown,
     assuming the message is from a child process that&apos;s still alive.
     When master finishes processing the messages from that long-dead
     child, it again (an inaccurately) decrements the count of
     ready_workers.

     The easiest solution in my opinion is to make sure master stays
     caught up with messages from its children by processing all child
     messages on each loop.  After all, it&apos;s the duty of a parent.&quot;

  Kenneth Murchison reported that they couldn&apos;t reproduce it in CMU.
  However, it is clearly something that depends on pathological loads
  and kernel behaviour to trigger.

  This fix is a trade off: we risk increasing latency to hand off
  connections/spawn new services (because we&apos;re in a loop processing
  child messages).  If the messages never stop coming, or come in
  extremely large bursts, master will backlog connections.  If syslog()
  or memory allocations in the message processing codepaths introduce
  large latencies, the cost of processing messages can get too high
  and master will backlog connections.  Note: this *CAN* happen, and
  in fact it did happen to Jules until he reduced the amount of data
  going to syslog in master/master.c:process_msg().

  Reported-analysed-and-tested-by: Jules Agee &lt;julesa@pcf.com&gt;.

* Fix message handling from expired children (new)

  It is possible that the kernel will delay message delivery a lot more
  than signal delivery in a overload situation.  The message delivery
  delay can get large enough for master to have already expired a dead
  child from its children table when a message arrives.  There is a bug
  in the state machine design: it readded such children to the table as
  being in an unknown state (as described by Jules Agee), which ends up
  causing bad accounting of ready_workers.

  Fix the state machine to assume messages from unknown children are
  from long dead children and add them back to the child table in DEAD
  state.

* Fix connection accounting when child dies before its messages
  have been processed (new)

  When processing messages from dead or long-dead children, explicitly
  ignore AVAILABLE/UNAVAILABLE messages (to document it as a normal
  codepath -- the code would already do it, but through a codepath
  marked as &quot;should not happen&quot;).  For CONNECTION/CONNECTION_MULTI
  messages from dead or long-dead children, just do connection accouting
  but don&apos;t touch children accounting (as we already accounted for the
  worker&apos;s death when we processed its SIGCHLD).</thetext>
          </long_desc>
          <long_desc isprivate="0">
            <who name="Henrique de Moraes Holschuh">hmh@debian.org</who>
            <bug_when>2010-10-12 14:09:32 EDT</bug_when>
            <thetext>This patch should also be applied to the 2.2 and 2.3 branches.  You might
want to let it cook a little on 2.4 first for testing.</thetext>
          </long_desc>
          <long_desc isprivate="0">
            <who name="Jeroen van Meeuwen (Kolab Systems)">vanmeeuwen@kolabsys.com</who>
            <bug_when>2010-10-12 19:01:07 EDT</bug_when>
            <thetext>Nice one, thanks!</thetext>
          </long_desc>
          <long_desc isprivate="0">
            <who name="Henrique de Moraes Holschuh">hmh@debian.org</who>
            <bug_when>2010-10-12 20:55:50 EDT</bug_when>
            <thetext>After applying this patch, the state diagram (xfig) needs to be updated as well.
I didn&apos;t include the update in the patch.

I also forwarded-ported the -J patch, but I *really* don&apos;t think that&apos;s the correct way to fix the real problem, and after the state-machine fixes I added in this newer version of the patch, it is unlikely to be useful anyway.</thetext>
          </long_desc>
          <long_desc isprivate="0">
            <who name="Bron Gondwana">brong@fastmail.fm</who>
            <bug_when>2010-10-13 08:40:05 EDT</bug_when>
            <thetext>I&apos;m going to put this in the FastMail package and make sure it doesn&apos;t create any problems in our environment.  It _looks_ totally sane, and I agree with the sentiment - you should let everyone out of the elevator who wants to get out before anybody else gets in.</thetext>
          </long_desc>
          <long_desc isprivate="0">
            <who name="Henrique de Moraes Holschuh">hmh@debian.org</who>
            <bug_when>2010-10-13 11:54:43 EDT</bug_when>
            <thetext>This patch shows that we really should think about two extra features in Cyrus, for better self-restraint when logging, and about judicious use of such features in the DoS-able paths (such as the reaper and message processing loop, lock loops, etc).

1. We should have log levels (or a log event mask) to avoid calling syslog() if an event is unmasked.

2. We should have logging rate-limit buckets (not just one bucket, or you will rate-limit [and not issue] an emergency message because of some crappy debug-level message that is driving the bucket empty).

Anyway, if you really want to test this patch, you will need a system where cyrus misbehaves (where you sabotaged it to do so in order to test the patch :p), or which you can bring down to its knees with a stratospheric load on the thousands with a very large process churn and a very large number of concurrent processes doing some imap activity.  That&apos;s when things start getting really funny re. signal versus message delivery, and that&apos;s when the deficiencies in cyrus master child handling show up.

As the boxes nowadays are MUCH more powerful CPU-wise, the chances of hitting such problems in production are not as high as they once were.</thetext>
          </long_desc>
          <long_desc isprivate="0">
            <who name="Bron Gondwana">brong@fastmail.fm</who>
            <bug_when>2010-10-18 05:59:31 EDT</bug_when>
            <thetext>Committed to master for 2.4.1 and to the 2.3 branch for the next 2.3 release as well.</thetext>
          </long_desc>
          <long_desc isprivate="0">
            <who name="Jeroen van Meeuwen (Kolab Systems)">vanmeeuwen@kolabsys.com</who>
            <bug_when>2010-10-18 06:01:53 EDT</bug_when>
            <thetext>Update target milestone</thetext>
          </long_desc>
      
          <attachment
              isobsolete="1"
              ispatch="1"
              isprivate="0"
          >
            <attachid>339</attachid>
            <date>2005-04-07 23:41 EDT</date>
            <desc>Process all messages in one go, and add -J option to master</desc>
            <filename>patch</filename>
            <type>text/plain</type>
            <size>5473</size>
            <attacher>hmh@debian.org</attacher>
            
              <data encoding="base64">LS0tLS0tLS0tLS0tLS0tLS0tLS0tClBhdGNoU2V0IDE4NDAgCkRhdGU6IDIwMDQvMDgvMDYgMTU6
NTQ6NTUKQXV0aG9yOiBobWgKQnJhbmNoOiBIRUFEClRhZzogKG5vbmUpIApMb2c6CiAgKiBUaW1l
IHRvIHJlbWVtYmVyIGRlYWQgY2hpbGRyZW4gaXMgbm93IGEgY29tbWFuZCBsaW5lIG9wdGlvbiAo
LUopCiAgKiBNYWtlIHN1cmUgdG8gcHJvY2VzcyBhbGwgcGVuZGluZyBtZXNzYWdlcyBvZiBjaGls
ZHJlbiBvZgogICAgYSBzZXJ2aWNlIGluIG9uZSBnby4gIFRoYW5rcyB0byBKdWxlcyBBZ2VlIDxq
dWxlc2FAcGNmLmNvbT4gZm9yCiAgICB0cmFja2luZyBkb3duIHRoaXMgcHJvYmxlbSwgYW5kIHRl
c3RpbmcgdGhlIG5ldyBjb2RlCiAgICAoUkVRVUlSRUQgRk9SIEhJR0gtVk9MVU1FIFNJVEVTKQog
ICoqKiBTWU5DIFRPIDIuMS4xNi0wd29vZHkuNi4yICoqKgoKTWVtYmVyczogCgltYXN0ZXIvbWFz
dGVyLmM6MS41Mi0+MS41MyAKCkluZGV4OiBkZWJpYW4vY3lydXMyMS1pbWFwZC9tYXN0ZXIvbWFz
dGVyLmMKPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PQpSQ1MgZmlsZTogL2hvbWUvY3ZzL2RlYmlhbi9jeXJ1czIxLWltYXBk
L21hc3Rlci9tYXN0ZXIuYyx2CnJldHJpZXZpbmcgcmV2aXNpb24gMS41MgpyZXRyaWV2aW5nIHJl
dmlzaW9uIDEuNTMKZGlmZiAtdSAtcjEuNTIgLXIxLjUzCi0tLSBkZWJpYW4vY3lydXMyMS1pbWFw
ZC9tYXN0ZXIvbWFzdGVyLmMJMTkgRGVjIDIwMDMgMDk6Mjk6MjIgLTAwMDAJMS41MgorKysgZGVi
aWFuL2N5cnVzMjEtaW1hcGQvbWFzdGVyL21hc3Rlci5jCTYgQXVnIDIwMDQgMTU6NTQ6NTUgLTAw
MDAJMS41MwpAQCAtMTU0LDYgKzE1NCw4IEBACiBzdGF0aWMgc3RydWN0IGNlbnRyeSAqY3RhYmxl
W2NoaWxkX3RhYmxlX3NpemVdOwogc3RhdGljIHN0cnVjdCBjZW50cnkgKmNmcmVlbGlzdDsKIAor
c3RhdGljIGludCBjaGlsZF9tb3VybmluZ190aW1lID0gMjsJLyogVGltZSBpbiBzZWNvbmRzIHRv
IHJlbWVtYmVyIGNoaWxkCisJCQkJCSAgIGFmdGVyIHByb2Nlc3NpbmcgU0lHQ0hMRCAqLwogc3Rh
dGljIGludCBqYW5pdG9yX2ZyZXF1ZW5jeSA9IDE7CS8qIEphbml0b3Igc3dlZXBzIHBlciBzZWNv
bmQgKi8KIHN0YXRpYyBpbnQgamFuaXRvcl9wb3NpdGlvbjsJCS8qIEVudHJ5IHRvIGJlZ2luIGF0
IGluIG5leHQgc3dlZXAgKi8KIHN0YXRpYyBzdHJ1Y3QgdGltZXZhbCBqYW5pdG9yX21hcms7CS8q
IExhc3QgdGltZSBqYW5pdG9yIGRpZCBhIHN3ZWVwICovCkBAIC04ODQsMTYgKzg4NiwxNiBAQAog
CQl9CiAJICAgIH0KIAkgICAgYy0+c2VydmljZV9zdGF0ZSA9IFNFUlZJQ0VfU1RBVEVfREVBRDsK
LQkgICAgYy0+amFuaXRvcl9kZWFkbGluZSA9IHRpbWUoTlVMTCkgKyAyOworCSAgICBjLT5qYW5p
dG9yX2RlYWRsaW5lID0gdGltZShOVUxMKSArIGNoaWxkX21vdXJuaW5nX3RpbWU7CiAJfSBlbHNl
IHsKIAkgICAgLyogd2VpcmQuIEFyZSB3ZSBtdWx0aXRocmVhZGVkIG5vdz8gd2UgZG9uJ3Qga25v
dyB0aGlzIGNoaWxkICovCiAJICAgIHN5c2xvZyhMT0dfV0FSTklORywKLQkJICAgInJlY2Vpdmlu
ZyBzaWduYWxzIGZyb20gdW5yZWdpc3RlcmVkIGNoaWxkICVkLiBIYW5kbGluZyBpdCBhbnl3YXki
LAorCQkgICAibm90aWZpZWQgb2YgZGVhdGggb2YgdW5yZWdpc3RlcmVkIGNoaWxkICVkLiBIYW5k
bGluZyBpdCBhbnl3YXkiLAogCQkgICBwaWQpOwogCSAgICBjID0gZ2V0X2NlbnRyeSgpOwogCSAg
ICBjLT5waWQgPSBwaWQ7CiAJICAgIGMtPnNlcnZpY2Vfc3RhdGUgPSBTRVJWSUNFX1NUQVRFX0RF
QUQ7Ci0JICAgIGMtPmphbml0b3JfZGVhZGxpbmUgPSB0aW1lKE5VTEwpICsgMjsKKwkgICAgYy0+
amFuaXRvcl9kZWFkbGluZSA9IHRpbWUoTlVMTCkgKyBjaGlsZF9tb3VybmluZ190aW1lOwogCSAg
ICBjLT5zID0gTlVMTDsKIAkgICAgYy0+bmV4dCA9IGN0YWJsZVtwaWQgJSBjaGlsZF90YWJsZV9z
aXplXTsKIAkgICAgY3RhYmxlW3BpZCAlIGNoaWxkX3RhYmxlX3NpemVdID0gYzsKQEAgLTEwNTIs
NiArMTA1NCwzNiBAQAogICAgIH0KIH0KIAorLyoKKyAqIFJlY2VpdmVzIGEgbWVzc2FnZSBmcm9t
IGEgc2VydmljZS4KKyAqCisgKiBSZXR1cm5zIHplcm8gaWYgYWxsIGdvZXMgd2VsbAorICogMSBp
ZiBubyBtc2cgYXZhaWxhYmxlCisgKiAyIGlmIGJhZCBtZXNzYWdlIHJlY2VpdmVkIChpbmNvcnJl
Y3RseSBzaXplZCkKKyAqIC0xIG9uIGVycm9yIChlcnJubyBzZXQpCisgKi8KK2ludCByZWFkX21z
ZyhpbnQgZmQsIHN0cnVjdCBub3RpZnlfbWVzc2FnZSAqbXNnKQoreworCXNzaXplX3QgcjsKKwlz
aXplX3Qgb2ZmID0gMDsKKwlpbnQgcyA9IHNpemVvZihzdHJ1Y3Qgbm90aWZ5X21lc3NhZ2UpOwor
CisJd2hpbGUgKHMgPiAwKSB7CisJICAgIGRvCisJCXIgPSByZWFkKGZkLCBtc2cgKyBvZmYsIHMp
OworCSAgICB3aGlsZSAoKHIgPT0gLTEpICYmIChlcnJubyA9PSBFSU5UUikpOworCSAgICBpZiAo
ciA8PSAwKSBicmVhazsKKwkgICAgcyAtPSByOworCSAgICBvZmYgKz0gcjsKKwl9CisJaWYgKCAo
KHIgPT0gMCkgJiYgKG9mZiA9PSAwKSkgfHwKKwkgICAgICgociA9PSAtMSkgJiYgKGVycm5vID09
IEVBR0FJTikpICkKKwkgICAgcmV0dXJuIDE7CisJaWYgKHIgPT0gLTEpIHJldHVybiAtMTsKKwlp
ZiAocyAhPSAwKSByZXR1cm4gMjsKKwlyZXR1cm4gMDsKK30KKwogdm9pZCBwcm9jZXNzX21zZyhz
dHJ1Y3Qgc2VydmljZSAqcywgc3RydWN0IG5vdGlmeV9tZXNzYWdlICptc2cpCiB7CiAgICAgc3Ry
dWN0IGNlbnRyeSAqIGM7CkBAIC0xNjU1LDcgKzE2ODcsNyBAQAogCiAgICAgcCA9IGdldGVudigi
Q1lSVVNfVkVSQk9TRSIpOwogICAgIGlmIChwKSB2ZXJib3NlID0gYXRvaShwKSArIDE7Ci0gICAg
d2hpbGUgKChvcHQgPSBnZXRvcHQoYXJnYywgYXJndiwgInA6bDpEZGo6IikpICE9IEVPRikgewor
ICAgIHdoaWxlICgob3B0ID0gZ2V0b3B0KGFyZ2MsIGFyZ3YsICJwOmw6RGRqOko6IikpICE9IEVP
RikgewogCXN3aXRjaCAob3B0KSB7CiAJY2FzZSAnbCc6CiAgICAgICAgICAgICAvKiB1c2VyIGRl
ZmluZWQgbGlzdGVuIHF1ZXVlIGJhY2tsb2cgKi8KQEAgLTE2ODEsNyArMTcxMywxNSBAQAogCSAg
ICAvKiBKYW5pdG9yIGZyZXF1ZW5jeSAqLwogCSAgICBqYW5pdG9yX2ZyZXF1ZW5jeSA9IGF0b2ko
b3B0YXJnKTsKIAkgICAgaWYoamFuaXRvcl9mcmVxdWVuY3kgPCAxKQotCQlmYXRhbCgiVGhlIGph
bml0b3IgcGVyaW9kIG11c3QgYmUgYXQgbGVhc3QgMSBzZWNvbmQiLCBFWF9DT05GSUcpOworCQlm
YXRhbCgiVGhlIGphbml0b3IgZnJlcXVlbmN5IG11c3QgYmUgYXQgbGVhc3Qgb25jZSBwZXIgc2Vj
b25kIiwKKwkJCUVYX0NPTkZJRyk7CisJICAgIGJyZWFrOworCWNhc2UgJ0onOgorCSAgICAvKiBK
YW5pdG9yIGRlbGF5IGJlZm9yZSBjbGVhbnVwIG9mIGEgY2hpbGQgKi8KKwkgICAgY2hpbGRfbW91
cm5pbmdfdGltZSA9IGF0b2kob3B0YXJnKTsKKwkgICAgaWYoY2hpbGRfbW91cm5pbmdfdGltZSA8
IDEpCisJCWZhdGFsKCJUaGUgamFuaXRvcidzIG1vdXJuaW5nIHRpbWUgaW50ZXJ2YWwgbXVzdCBi
ZSBhdCBsZWFzdCAxIHNlY29uZCIsIAorCQkJRVhfQ09ORklHKTsKIAkgICAgYnJlYWs7CiAJZGVm
YXVsdDoKIAkgICAgYnJlYWs7CkBAIC0yMDE2LDEzICsyMDU2LDE5IEBACiAJICAgIGludCBqOwog
CiAJICAgIGlmIChGRF9JU1NFVCh4LCAmcmZkcykpIHsKLQkJciA9IHJlYWQoeCwgJm1zZywgc2l6
ZW9mKG1zZykpOwotCQlpZiAociAhPSBzaXplb2YobXNnKSkgewotCQkgICAgc3lzbG9nKExPR19F
UlIsICJnb3QgaW5jb3JyZWN0bHkgc2l6ZWQgcmVzcG9uc2UgZnJvbSBjaGlsZDogJXgiLCBpKTsK
KwkJd2hpbGUgKChyID0gcmVhZF9tc2coeCwgJm1zZykpID09IDApCisJCSAgICBwcm9jZXNzX21z
ZygmU2VydmljZXNbaV0sICZtc2cpOworCisJCWlmIChyID09IDIpIHsKKwkJICAgIHN5c2xvZyhM
T0dfRVJSLCAKKwkJCSJnb3QgaW5jb3JyZWN0bHkgc2l6ZWQgcmVzcG9uc2UgZnJvbSBjaGlsZDog
JXgiLCBpKTsKKwkJICAgIGNvbnRpbnVlOworCQl9CisJCWlmIChyIDwgMCkgeworCQkgICAgc3lz
bG9nKExPR19FUlIsCisJCQkiZXJyb3Igd2hpbGUgcmVjZWl2aW5nIG1lc3NhZ2UgZnJvbSBjaGls
ZCAleDogJW0iLCBpKTsKIAkJICAgIGNvbnRpbnVlOwogCQl9Ci0KLQkJcHJvY2Vzc19tc2coJlNl
cnZpY2VzW2ldLCAmbXNnKTsKIAkgICAgfQogCiAJICAgIGlmIChTZXJ2aWNlc1tpXS5leGVjICYm
Ci0tLS0tLS0tLS0tLS0tLS0tLS0tLQpQYXRjaFNldCAxODQxIApEYXRlOiAyMDA0LzA4LzA2IDE3
OjUwOjAwCkF1dGhvcjogaG1oCkJyYW5jaDogSEVBRApUYWc6IChub25lKSAKTG9nOgogICogVGlt
ZSB0byByZW1lbWJlciBkZWFkIGNoaWxkcmVuIGlzIG5vdyBhIGNvbW1hbmQgbGluZSBvcHRpb24g
KC1KKQoKTWVtYmVyczogCgltYW4vbWFzdGVyLjg6MS41LT4xLjYgCgpJbmRleDogZGViaWFuL2N5
cnVzMjEtaW1hcGQvbWFuL21hc3Rlci44Cj09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KUkNTIGZpbGU6IC9ob21lL2N2cy9k
ZWJpYW4vY3lydXMyMS1pbWFwZC9tYW4vbWFzdGVyLjgsdgpyZXRyaWV2aW5nIHJldmlzaW9uIDEu
NQpyZXRyaWV2aW5nIHJldmlzaW9uIDEuNgpkaWZmIC11IC1yMS41IC1yMS42Ci0tLSBkZWJpYW4v
Y3lydXMyMS1pbWFwZC9tYW4vbWFzdGVyLjgJMjUgTWFyIDIwMDMgMTQ6Mzc6MzMgLTAwMDAJMS41
CisrKyBkZWJpYW4vY3lydXMyMS1pbWFwZC9tYW4vbWFzdGVyLjgJNiBBdWcgMjAwNCAxNzo1MDow
NCAtMDAwMAkxLjYKQEAgLTU0LDcgKzU0LDExIEBACiBdCiBbCiAuQiBcLWoKLS5JIGphbml0b3Ig
cGVyaW9kCisuSSBqYW5pdG9yIGZyZXF1ZW5jeQorXQorWworLkIgXC1KCisuSSBqYW5pdG9yJ3Mg
bW91cm5pbmcgdGltZSBpbnRlcnZhbAogXQogWwogLkIgXC1kCkBAIC04Niw2ICs5MCwxMiBAQAog
Zm9yayByYXRlIChhbmQgeW91IGhhdmUgbm90IGluY3JlYXNlZCB0aGUgY2hpbGQgaGFzaCB0YWJs
ZSBzaXplIHdoZW4geW91CiBjb21waWxlZCBDeXJ1cyBmcm9tIGl0cyBkZWZhdWx0IG9mIDEwMDAw
IGVudHJpZXMpLgogLlRQCisuQkkgXC1KICIgamFuaXRvciBtb3VyaW5pbmcgdGltZSBpbnRlcnZh
bCIKK1NldHMgdGhlIGFtb3VudCBvZiB0aW1lLCBpbiBzZWNvbmRzLCB0byByZW1lbWJlciBhIGNo
aWxkIHByb2Nlc3MgYWZ0ZXIKK2l0IGV4aXRzLiAgWW91IG9ubHkgbmVlZCB0byBpbmNyZWFzZSB0
aGlzIGZyb20gdGhlIGRlZmF1bHQgb2YgMiBzZWNvbmRzLAoraWYgeW91IHNlZSBtZXNzYWdlcyBp
biBzeXNsb2cgY29tcGxhaW5pbmcgb2YgbWVzc2FnZXMgZnJvbSB1bmtub3duIG9yCit1bnJlZ2lz
dGVyZWQgY2hpbGRyZW4uCisuVFAKIC5CSSBcLXAgIiBwaWRmaWxlIgogVXNlCiAuSSBwaWRmaWxl
Cg==
</data>        

          </attachment>
          <attachment
              isobsolete="1"
              ispatch="1"
              isprivate="0"
          >
            <attachid>342</attachid>
            <date>2005-04-13 11:50 EDT</date>
            <desc>Ported to 2.3, still need to test</desc>
            <filename>2647.txt</filename>
            <type>text/plain</type>
            <size>3932</size>
            <attacher>shadow@andrew.cmu.edu</attacher>
            
              <data encoding="base64">SW5kZXg6IG1hc3Rlci5jCj09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT0KUkNTIGZpbGU6IC9hZnMvYW5kcmV3LmNtdS5lZHUv
c3lzdGVtL2N2cy9zcmMvY3lydXMvbWFzdGVyL21hc3Rlci5jLHYKcmV0cmlldmluZyByZXZpc2lv
biAxLjg1LjIuMTUKZGlmZiAtdSAtcjEuODUuMi4xNSBtYXN0ZXIuYwotLS0gbWFzdGVyLmMJNiBB
cHIgMjAwNSAyMDozNzowMCAtMDAwMAkxLjg1LjIuMTUKKysrIG1hc3Rlci5jCTEzIEFwciAyMDA1
IDE1OjQ4OjMwIC0wMDAwCkBAIC0xNjUsNiArMTY1LDggQEAKIHN0YXRpYyBzdHJ1Y3QgY2VudHJ5
ICpjdGFibGVbY2hpbGRfdGFibGVfc2l6ZV07CiBzdGF0aWMgc3RydWN0IGNlbnRyeSAqY2ZyZWVs
aXN0OwogCitzdGF0aWMgaW50IGNoaWxkX21vdXJuaW5nX3RpbWUgPSAyOyAgICAvKiBUaW1lIGlu
IHNlY29uZHMgdG8gcmVtZW1iZXIgY2hpbGQKKwkJCQkJICBhZnRlciBwcm9jZXNzaW5nIFNJR0NI
TEQgKi8KIHN0YXRpYyBpbnQgamFuaXRvcl9mcmVxdWVuY3kgPSAxOwkvKiBKYW5pdG9yIHN3ZWVw
cyBwZXIgc2Vjb25kICovCiBzdGF0aWMgaW50IGphbml0b3JfcG9zaXRpb247CQkvKiBFbnRyeSB0
byBiZWdpbiBhdCBpbiBuZXh0IHN3ZWVwICovCiBzdGF0aWMgc3RydWN0IHRpbWV2YWwgamFuaXRv
cl9tYXJrOwkvKiBMYXN0IHRpbWUgamFuaXRvciBkaWQgYSBzd2VlcCAqLwpAQCAtOTM5LDE2ICs5
NDEsMTYgQEAKIAkJfQogCSAgICB9CiAJICAgIGMtPnNlcnZpY2Vfc3RhdGUgPSBTRVJWSUNFX1NU
QVRFX0RFQUQ7Ci0JICAgIGMtPmphbml0b3JfZGVhZGxpbmUgPSB0aW1lKE5VTEwpICsgMjsKKwkg
ICAgYy0+amFuaXRvcl9kZWFkbGluZSA9IHRpbWUoTlVMTCkgKyBjaGlsZF9tb3VybmluZ190aW1l
OwogCX0gZWxzZSB7CiAJICAgIC8qIHdlaXJkLiBBcmUgd2UgbXVsdGl0aHJlYWRlZCBub3c/IHdl
IGRvbid0IGtub3cgdGhpcyBjaGlsZCAqLwogCSAgICBzeXNsb2coTE9HX1dBUk5JTkcsCi0JCSAg
ICJyZWNlaXZpbmcgc2lnbmFscyBmcm9tIHVucmVnaXN0ZXJlZCBjaGlsZCAlZC4gSGFuZGxpbmcg
aXQgYW55d2F5IiwKKwkJICAgIm5vdGlmaWVkIG9mIGRlYXRoIG9mIHVucmVnaXN0ZXJlZCBjaGls
ZCAlZC4gSGFuZGxpbmcgaXQgYW55d2F5IiwKIAkJICAgcGlkKTsKIAkgICAgYyA9IGdldF9jZW50
cnkoKTsKIAkgICAgYy0+cGlkID0gcGlkOwogCSAgICBjLT5zZXJ2aWNlX3N0YXRlID0gU0VSVklD
RV9TVEFURV9ERUFEOwotCSAgICBjLT5qYW5pdG9yX2RlYWRsaW5lID0gdGltZShOVUxMKSArIDI7
CisJICAgIGMtPmphbml0b3JfZGVhZGxpbmUgPSB0aW1lKE5VTEwpICsgY2hpbGRfbW91cm5pbmdf
dGltZTsKIAkgICAgYy0+c2kgPSBTRVJWSUNFX05PTkU7CiAJICAgIGMtPm5leHQgPSBjdGFibGVb
cGlkICUgY2hpbGRfdGFibGVfc2l6ZV07CiAJICAgIGN0YWJsZVtwaWQgJSBjaGlsZF90YWJsZV9z
aXplXSA9IGM7CkBAIC0xMTAzLDYgKzExMDUsMzYgQEAKICAgICB9CiB9CiAKKy8qCisgKiBSZWNl
aXZlcyBhIG1lc3NhZ2UgZnJvbSBhIHNlcnZpY2UuCisgKgorICogUmV0dXJucyB6ZXJvIGlmIGFs
bCBnb2VzIHdlbGwKKyAqIDEgaWYgbm8gbXNnIGF2YWlsYWJsZQorICogMiBpZiBiYWQgbWVzc2Fn
ZSByZWNlaXZlZCAoaW5jb3JyZWN0bHkgc2l6ZWQpCisgKiAtMSBvbiBlcnJvciAoZXJybm8gc2V0
KQorICovCitpbnQgcmVhZF9tc2coaW50IGZkLCBzdHJ1Y3Qgbm90aWZ5X21lc3NhZ2UgKm1zZykK
K3sKKyAgICBzc2l6ZV90IHI7CisgICAgc2l6ZV90IG9mZiA9IDA7CisgICAgaW50IHMgPSBzaXpl
b2Yoc3RydWN0IG5vdGlmeV9tZXNzYWdlKTsKKyAgICAKKyAgICB3aGlsZSAocyA+IDApIHsKKwlk
bworCSAgICByID0gcmVhZChmZCwgbXNnICsgb2ZmLCBzKTsKKwl3aGlsZSAoKHIgPT0gLTEpICYm
IChlcnJubyA9PSBFSU5UUikpOworCWlmIChyIDw9IDApIGJyZWFrOworCXMgLT0gcjsKKwlvZmYg
Kz0gcjsKKyAgICB9CisgICAgaWYgKCAoKHIgPT0gMCkgJiYgKG9mZiA9PSAwKSkgfHwKKwkgKChy
ID09IC0xKSAmJiAoZXJybm8gPT0gRUFHQUlOKSkgKQorCXJldHVybiAxOworICAgIGlmIChyID09
IC0xKSByZXR1cm4gLTE7CisgICAgaWYgKHMgIT0gMCkgcmV0dXJuIDI7CisgICAgcmV0dXJuIDA7
Cit9CisKIHZvaWQgcHJvY2Vzc19tc2coY29uc3QgaW50IHNpLCBzdHJ1Y3Qgbm90aWZ5X21lc3Nh
Z2UgKm1zZykgCiB7CiAgICAgc3RydWN0IGNlbnRyeSAqYzsKQEAgLTE2NzUsOSArMTcwNyw5IEBA
CiAgICAgcCA9IGdldGVudigiQ1lSVVNfVkVSQk9TRSIpOwogICAgIGlmIChwKSB2ZXJib3NlID0g
YXRvaShwKSArIDE7CiAjaWZkZWYgSEFWRV9ORVRTTk1QCi0gICAgd2hpbGUgKChvcHQgPSBnZXRv
cHQoYXJnYywgYXJndiwgIkM6TTpwOmw6RGRqOlA6eDoiKSkgIT0gRU9GKSB7CisgICAgd2hpbGUg
KChvcHQgPSBnZXRvcHQoYXJnYywgYXJndiwgIkM6TTpwOmw6RGRqOlA6eDpKOiIpKSAhPSBFT0Yp
IHsKICNlbHNlCi0gICAgd2hpbGUgKChvcHQgPSBnZXRvcHQoYXJnYywgYXJndiwgIkM6TTpwOmw6
RGRqOiIpKSAhPSBFT0YpIHsKKyAgICB3aGlsZSAoKG9wdCA9IGdldG9wdChhcmdjLCBhcmd2LCAi
QzpNOnA6bDpEZGo6SjoiKSkgIT0gRU9GKSB7CiAjZW5kaWYKIAlzd2l0Y2ggKG9wdCkgewogCWNh
c2UgJ0MnOiAvKiBhbHQgaW1hcGQuY29uZiBmaWxlICovCkBAIC0xNzEwLDcgKzE3NDIsMTUgQEAK
IAkgICAgLyogSmFuaXRvciBmcmVxdWVuY3kgKi8KIAkgICAgamFuaXRvcl9mcmVxdWVuY3kgPSBh
dG9pKG9wdGFyZyk7CiAJICAgIGlmKGphbml0b3JfZnJlcXVlbmN5IDwgMSkKLQkJZmF0YWwoIlRo
ZSBqYW5pdG9yIHBlcmlvZCBtdXN0IGJlIGF0IGxlYXN0IDEgc2Vjb25kIiwgRVhfQ09ORklHKTsK
KwkJZmF0YWwoIlRoZSBqYW5pdG9yIGZyZXF1ZW5jeSBtdXN0IGJlIGF0IGxlYXN0IG9uY2UgcGVy
IHNlY29uZCIsCisJCSAgICAgIEVYX0NPTkZJRyk7CisJICAgIGJyZWFrOworCWNhc2UgJ0onOgor
CSAgICAvKiBKYW5pdG9yIGRlbGF5IGJlZm9yZSBjbGVhbnVwIG9mIGEgY2hpbGQgKi8KKwkgICAg
Y2hpbGRfbW91cm5pbmdfdGltZSA9IGF0b2kob3B0YXJnKTsKKwkgICAgaWYoY2hpbGRfbW91cm5p
bmdfdGltZSA8IDEpCisJCWZhdGFsKCJUaGUgamFuaXRvcidzIG1vdXJuaW5nIHRpbWUgaW50ZXJ2
YWwgbXVzdCBiZSBhdCBsZWFzdCAxIHNlY29uZCIsIAorCQkgICAgICBFWF9DT05GSUcpOwogCSAg
ICBicmVhazsgICAKICNpZmRlZiBIQVZFX05FVFNOTVAKIAljYXNlICdQJzogLyogc25tcCBBZ2Vu
dFhQaW5nSW50ZXJ2YWwgKi8KQEAgLTIwOTQsMTMgKzIxMzQsMTkgQEAKIAkgICAgaW50IGo7CiAK
IAkgICAgaWYgKEZEX0lTU0VUKHgsICZyZmRzKSkgewotCQlyID0gcmVhZCh4LCAmbXNnLCBzaXpl
b2YobXNnKSk7Ci0JCWlmIChyICE9IHNpemVvZihtc2cpKSB7Ci0JCSAgICBzeXNsb2coTE9HX0VS
UiwgImdvdCBpbmNvcnJlY3RseSBzaXplZCByZXNwb25zZSBmcm9tIGNoaWxkOiAleCIsIGkpOwor
CQl3aGlsZSAoKHIgPSByZWFkX21zZyh4LCAmbXNnKSkgPT0gMCkKKwkJICAgIHByb2Nlc3NfbXNn
KCZTZXJ2aWNlc1tpXSwgJm1zZyk7CisJCQorCQlpZiAociA9PSAyKSB7CisJCSAgICBzeXNsb2co
TE9HX0VSUiwgCisJCQkgICAiZ290IGluY29ycmVjdGx5IHNpemVkIHJlc3BvbnNlIGZyb20gY2hp
bGQ6ICV4IiwgaSk7CisJCSAgICBjb250aW51ZTsKKwkJfQorCQlpZiAociA8IDApIHsKKwkJICAg
IHN5c2xvZyhMT0dfRVJSLAorCQkJICAgImVycm9yIHdoaWxlIHJlY2VpdmluZyBtZXNzYWdlIGZy
b20gY2hpbGQgJXg6ICVtIiwgaSk7CiAJCSAgICBjb250aW51ZTsKIAkJfQotCQkKLQkJcHJvY2Vz
c19tc2coaSwgJm1zZyk7CiAJICAgIH0KIAogCSAgICBpZiAoU2VydmljZXNbaV0uZXhlYyAmJgo=
</data>        

          </attachment>
          <attachment
              isobsolete="1"
              ispatch="1"
              isprivate="0"
          >
            <attachid>419</attachid>
            <date>2006-02-19 21:30 EDT</date>
            <desc>Process all messages in one go, and add -J option to master, 2.2.12</desc>
            <filename>13-master_process_handling.dpatch</filename>
            <type>text/plain</type>
            <size>7326</size>
            <attacher>hmh@debian.org</attacher>
            
              <data encoding="base64">ZGlmZiAtdXJOYWQgY29tcGxldGUuZHBhdGNoL21hc3Rlci9tYXN0ZXIuYyAvdG1wL2RwZXAuTktJ
SVI5L2NvbXBsZXRlLmRwYXRjaC9tYXN0ZXIvbWFzdGVyLmMKLS0tIGNvbXBsZXRlLmRwYXRjaC9t
YXN0ZXIvbWFzdGVyLmMJMjAwNS0xMS0xMSAxNzowMzowNC4wMDAwMDAwMDAgKzAxMDAKKysrIC90
bXAvZHBlcC5OS0lJUjkvY29tcGxldGUuZHBhdGNoL21hc3Rlci9tYXN0ZXIuYwkyMDA1LTExLTEx
IDE3OjA0OjM5LjI3MzcwNDkzMCArMDEwMApAQCAtMTYyLDYgKzE2Miw4IEBACiBzdGF0aWMgc3Ry
dWN0IGNlbnRyeSAqY3RhYmxlW2NoaWxkX3RhYmxlX3NpemVdOwogc3RhdGljIHN0cnVjdCBjZW50
cnkgKmNmcmVlbGlzdDsKIAorc3RhdGljIGludCBjaGlsZF9tb3VybmluZ190aW1lID0gMjsgICAg
LyogVGltZSBpbiBzZWNvbmRzIHRvIHJlbWVtYmVyIGNoaWxkCisJCQkJCSAgYWZ0ZXIgcHJvY2Vz
c2luZyBTSUdDSExEICovCiBzdGF0aWMgaW50IGphbml0b3JfZnJlcXVlbmN5ID0gMTsJLyogSmFu
aXRvciBzd2VlcHMgcGVyIHNlY29uZCAqLwogc3RhdGljIGludCBqYW5pdG9yX3Bvc2l0aW9uOwkJ
LyogRW50cnkgdG8gYmVnaW4gYXQgaW4gbmV4dCBzd2VlcCAqLwogc3RhdGljIHN0cnVjdCB0aW1l
dmFsIGphbml0b3JfbWFyazsJLyogTGFzdCB0aW1lIGphbml0b3IgZGlkIGEgc3dlZXAgKi8KQEAg
LTE4Niw5ICsxODgsOSBAQAogaW50IGJlY29tZV9jeXJ1cyh2b2lkKQogewogICAgIHN0cnVjdCBw
YXNzd2QgKnA7Ci0gICAgaW50IG5ld3VpZCwgbmV3Z2lkOworICAgIHVpZF90IG5ld3VpZCwgbmV3
Z2lkOwogICAgIGludCByZXN1bHQ7Ci0gICAgc3RhdGljIGludCB1aWQgPSAwOworICAgIHN0YXRp
YyB1aWRfdCB1aWQgPSAwOwogCiAgICAgaWYgKHVpZCkgcmV0dXJuIHNldHVpZCh1aWQpOwogCkBA
IC05MTUsNyArOTE3LDcgQEAKIAkJfQogCSAgICB9CiAJICAgIGMtPnNlcnZpY2Vfc3RhdGUgPSBT
RVJWSUNFX1NUQVRFX0RFQUQ7Ci0JICAgIGMtPmphbml0b3JfZGVhZGxpbmUgPSB0aW1lKE5VTEwp
ICsgMjsKKwkgICAgYy0+amFuaXRvcl9kZWFkbGluZSA9IHRpbWUoTlVMTCkgKyBjaGlsZF9tb3Vy
bmluZ190aW1lOwogCX0gZWxzZSB7CiAJICAgIC8qIHdlaXJkLiBBcmUgd2UgbXVsdGl0aHJlYWRl
ZCBub3c/IHdlIGRvbid0IGtub3cgdGhpcyBjaGlsZCAqLwogCSAgICBzeXNsb2coTE9HX1dBUk5J
TkcsCkBAIC05MjQsNyArOTI2LDcgQEAKIAkgICAgYyA9IGdldF9jZW50cnkoKTsKIAkgICAgYy0+
cGlkID0gcGlkOwogCSAgICBjLT5zZXJ2aWNlX3N0YXRlID0gU0VSVklDRV9TVEFURV9ERUFEOwot
CSAgICBjLT5qYW5pdG9yX2RlYWRsaW5lID0gdGltZShOVUxMKSArIDI7CisJICAgIGMtPmphbml0
b3JfZGVhZGxpbmUgPSB0aW1lKE5VTEwpICsgY2hpbGRfbW91cm5pbmdfdGltZTsKIAkgICAgYy0+
c2kgPSBTRVJWSUNFX05PTkU7CiAJICAgIGMtPm5leHQgPSBjdGFibGVbcGlkICUgY2hpbGRfdGFi
bGVfc2l6ZV07CiAJICAgIGN0YWJsZVtwaWQgJSBjaGlsZF90YWJsZV9zaXplXSA9IGM7CkBAIC0x
MDc5LDYgKzEwODEsMzYgQEAKICAgICB9CiB9CiAKKy8qCisgKiBSZWNlaXZlcyBhIG1lc3NhZ2Ug
ZnJvbSBhIHNlcnZpY2UuCisgKgorICogUmV0dXJucyB6ZXJvIGlmIGFsbCBnb2VzIHdlbGwKKyAq
IDEgaWYgbm8gbXNnIGF2YWlsYWJsZQorICogMiBpZiBiYWQgbWVzc2FnZSByZWNlaXZlZCAoaW5j
b3JyZWN0bHkgc2l6ZWQpCisgKiAtMSBvbiBlcnJvciAoZXJybm8gc2V0KQorICovCitpbnQgcmVh
ZF9tc2coaW50IGZkLCBzdHJ1Y3Qgbm90aWZ5X21lc3NhZ2UgKm1zZykKK3sKKyAgICBzc2l6ZV90
IHI7CisgICAgc2l6ZV90IG9mZiA9IDA7CisgICAgaW50IHMgPSBzaXplb2Yoc3RydWN0IG5vdGlm
eV9tZXNzYWdlKTsKKyAgICAKKyAgICB3aGlsZSAocyA+IDApIHsKKyAgICAgICAgZG8KKyAgICAg
ICAgICAgIHIgPSByZWFkKGZkLCBtc2cgKyBvZmYsIHMpOworICAgICAgICB3aGlsZSAoKHIgPT0g
LTEpICYmIChlcnJubyA9PSBFSU5UUikpOworICAgICAgICBpZiAociA8PSAwKSBicmVhazsKKyAg
ICAgICAgcyAtPSByOworICAgICAgICBvZmYgKz0gcjsKKyAgICB9CisgICAgaWYgKCAoKHIgPT0g
MCkgJiYgKG9mZiA9PSAwKSkgfHwKKyAgICAgICAgICgociA9PSAtMSkgJiYgKGVycm5vID09IEVB
R0FJTikpICkKKyAgICAgICAgcmV0dXJuIDE7CisgICAgaWYgKHIgPT0gLTEpIHJldHVybiAtMTsK
KyAgICBpZiAocyAhPSAwKSByZXR1cm4gMjsKKyAgICByZXR1cm4gMDsKK30KKwogdm9pZCBwcm9j
ZXNzX21zZyhjb25zdCBpbnQgc2ksIHN0cnVjdCBub3RpZnlfbWVzc2FnZSAqbXNnKSAKIHsKICAg
ICBzdHJ1Y3QgY2VudHJ5ICpjOwpAQCAtMTM5Miw4ICsxNDI0LDkgQEAKIAlzbnByaW50ZihidWYs
IHNpemVvZihidWYpLAogCQkgImNhbm5vdCBmaW5kIGV4ZWN1dGFibGUgZm9yIHNlcnZpY2UgJyVz
JyIsIG5hbWUpOwogCQotCS8qIGlmIGl0IGlzIG5vdCwgd2UncmUgbWlzY29uZmlndXJlZCwgZGll
LiAqLwotCWZhdGFsKGJ1ZiwgRVhfQ09ORklHKTsKKwkvKiBpZiBpdCBpcyBub3QsIHdlIGp1c3Qg
c2tpcCBpdCAqLworCXN5c2xvZyhMT0dfV0FSTklORywgIldBUk5JTkc6ICVzIC0tIGlnbm9yZWQi
LCBidWYpOworCXJldHVybjsKICAgICB9CiAKICAgICBTZXJ2aWNlc1tpXS5tYXhmb3JrcmF0ZSA9
IG1heGZvcmtyYXRlOwpAQCAtMTQwNSw3ICsxNDM4LDcgQEAKIAlTZXJ2aWNlc1tpXS5kZXNpcmVk
X3dvcmtlcnMgPSBwcmVmb3JrOwogCVNlcnZpY2VzW2ldLmJhYnlzaXQgPSBiYWJ5c2l0OwogCVNl
cnZpY2VzW2ldLm1heF93b3JrZXJzID0gYXRvaShtYXgpOwotCWlmIChTZXJ2aWNlc1tpXS5tYXhf
d29ya2VycyA9PSAtMSkgeworCWlmIChTZXJ2aWNlc1tpXS5tYXhfd29ya2VycyA8IDApIHsKIAkg
ICAgU2VydmljZXNbaV0ubWF4X3dvcmtlcnMgPSBJTlRfTUFYOwogCX0KICAgICB9IGVsc2UgewpA
QCAtMTQxMyw2ICsxNDQ2LDcgQEAKIAlpZiAocHJlZm9yayA+IDEpIHByZWZvcmsgPSAxOwogCVNl
cnZpY2VzW2ldLmRlc2lyZWRfd29ya2VycyA9IHByZWZvcms7CiAJU2VydmljZXNbaV0ubWF4X3dv
cmtlcnMgPSAxOworCVNlcnZpY2VzW2ldLmJhYnlzaXQgPSAwOwogICAgIH0KICAgICBmcmVlKG1h
eCk7CiAgCkBAIC0xNDUyLDcgKzE0ODYsNyBAQAogICAgIGlmICghY21kKSB7CiAJY2hhciBidWZb
MjU2XTsKIAlzbnByaW50ZihidWYsIHNpemVvZihidWYpLAotCQkgInVuYWJsZSB0byBmaW5kIGNv
bW1hbmQgb3IgcG9ydCBmb3IgZXZlbnQgJyVzJyIsIG5hbWUpOworCQkgInVuYWJsZSB0byBmaW5k
IGNvbW1hbmQgZm9yIGV2ZW50ICclcyciLCBuYW1lKTsKIAogCWlmIChpZ25vcmVfZXJyKSB7CiAJ
ICAgIHN5c2xvZyhMT0dfV0FSTklORywgIldBUk5JTkc6ICVzIC0tIGlnbm9yZWQiLCBidWYpOwpA
QCAtMTUwNiw3ICsxNTQwLDcgQEAKIAogICAgIHJsLnJsaW1fY3VyID0geDsKICAgICBybC5ybGlt
X21heCA9IHg7Ci0gICAgaWYgKHNldHJsaW1pdChSTElNSVRfTlVNRkRTLCAmcmwpIDwgMCkgewor
ICAgIGlmIChzZXRybGltaXQoUkxJTUlUX05VTUZEUywgJnJsKSA8IDAgJiYgeCAhPSBSTElNX0lO
RklOSVRZKSB7CiAJc3lzbG9nKExPR19FUlIsICJzZXRybGltaXQ6IFVuYWJsZSB0byBzZXQgZmls
ZSBkZXNjcmlwdG9ycyBsaW1pdCB0byAlbGQ6ICVtIiwgeCk7CiAKICNpZmRlZiBIQVZFX0dFVFJM
SU1JVApAQCAtMTUyMSwxMSArMTU1NSw5IEBACiAgICAgfQogCiAKLSAgICBpZiAodmVyYm9zZSA+
IDEpIHsKLQlyID0gZ2V0cmxpbWl0KFJMSU1JVF9OVU1GRFMsICZybCk7Ci0Jc3lzbG9nKExPR19E
RUJVRywgInNldCBtYXhpbXVtIGZpbGUgZGVzY3JpcHRvcnMgdG8gJWxkLyVsZCIsIHJsLnJsaW1f
Y3VyLAotCSAgICAgICBybC5ybGltX21heCk7Ci0gICAgfQorICAgIGlmICh2ZXJib3NlID4gMSAm
JiBnZXRybGltaXQoUkxJTUlUX05VTUZEUywgJnJsKSA+PTApCisJc3lzbG9nKExPR19ERUJVRywg
InNldCBtYXhpbXVtIGZpbGUgZGVzY3JpcHRvcnMgdG8gJWxkLyVsZCIsCisJCXJsLnJsaW1fY3Vy
LCBybC5ybGltX21heCk7CiAjZWxzZQogICAgIH0KICNlbmRpZiAvKiBIQVZFX0dFVFJMSU1JVCAq
LwpAQCAtMTU0NCw3ICsxNTc2LDEwIEBACiAKICAgICAvKiBkaXNhYmxlIGFsbCBzZXJ2aWNlcyAt
CiAgICAgICAgdGhleSB3aWxsIGJlIHJlLWVuYWJsZWQgaWYgdGhleSBhcHBlYXIgaW4gY29uZmln
IGZpbGUgKi8KLSAgICBmb3IgKGkgPSAwOyBpIDwgbnNlcnZpY2VzOyBpKyspIFNlcnZpY2VzW2ld
LmV4ZWMgPSBOVUxMOworICAgIGZvciAoaSA9IDA7IGkgPCBuc2VydmljZXM7IGkrKykgeworCWlm
IChTZXJ2aWNlc1tpXS5leGVjKSBmcmVlKCh2b2lkKilTZXJ2aWNlc1tpXS5leGVjKTsKKwlTZXJ2
aWNlc1tpXS5leGVjID0gTlVMTDsKKyAgICB9CiAKICAgICAvKiByZWFkIHNlcnZpY2VzICovCiAg
ICAgbWFzdGVyY29uZl9nZXRzZWN0aW9uKCJTRVJWSUNFUyIsICZhZGRfc2VydmljZSwgKHZvaWQq
KSAxKTsKQEAgLTE1NTksMTMgKzE1OTQsMTggQEAKIAkJICAgICAgIFNlcnZpY2VzW2ldLnN0YXRb
MF0sIFNlcnZpY2VzW2ldLnN0YXRbMV0pOwogCiAJICAgIC8qIE9ubHkgZnJlZSB0aGUgc2Vydmlj
ZSBpbmZvIG9uIHRoZSBwcmltYXJ5ICovCi0JICAgIGlmKFNlcnZpY2VzW2ldLmFzc29jaWF0ZSA9
PSAwKSB7CisJICAgIGlmIChTZXJ2aWNlc1tpXS5hc3NvY2lhdGUgPT0gMCkgeworCQlmcmVlKFNl
cnZpY2VzW2ldLm5hbWUpOwogCQlmcmVlKFNlcnZpY2VzW2ldLmxpc3Rlbik7CiAJCWZyZWUoU2Vy
dmljZXNbaV0ucHJvdG8pOwogCSAgICB9CisJICAgIFNlcnZpY2VzW2ldLm5hbWUgPSBOVUxMOwog
CSAgICBTZXJ2aWNlc1tpXS5saXN0ZW4gPSBOVUxMOwogCSAgICBTZXJ2aWNlc1tpXS5wcm90byA9
IE5VTEw7CiAJICAgIFNlcnZpY2VzW2ldLmRlc2lyZWRfd29ya2VycyA9IDA7CisJICAgIFNlcnZp
Y2VzW2ldLm5mb3JrcyA9IDA7CisJICAgIFNlcnZpY2VzW2ldLm5hY3RpdmUgPSAwOworCSAgICBT
ZXJ2aWNlc1tpXS5uY29ubmVjdGlvbnMgPSAwOwogCiAJICAgIC8qIHNlbmQgU0lHSFVQIHRvIGFs
bCBjaGlsZHJlbiAqLwogCSAgICBmb3IgKGogPSAwIDsgaiA8IGNoaWxkX3RhYmxlX3NpemUgOyBq
KysgKSB7CkBAIC0xNjQ4LDkgKzE2ODgsOSBAQAogICAgIHAgPSBnZXRlbnYoIkNZUlVTX1ZFUkJP
U0UiKTsKICAgICBpZiAocCkgdmVyYm9zZSA9IGF0b2kocCkgKyAxOwogI2lmZGVmIEhBVkVfTkVU
U05NUAotICAgIHdoaWxlICgob3B0ID0gZ2V0b3B0KGFyZ2MsIGFyZ3YsICJDOk06cDpsOkRkajpQ
Ong6IikpICE9IEVPRikgeworICAgIHdoaWxlICgob3B0ID0gZ2V0b3B0KGFyZ2MsIGFyZ3YsICJD
Ok06cDpsOkRkako6UDp4OiIpKSAhPSBFT0YpIHsKICNlbHNlCi0gICAgd2hpbGUgKChvcHQgPSBn
ZXRvcHQoYXJnYywgYXJndiwgIkM6TTpwOmw6RGRqOiIpKSAhPSBFT0YpIHsKKyAgICB3aGlsZSAo
KG9wdCA9IGdldG9wdChhcmdjLCBhcmd2LCAiQzpNOnA6bDpEZGpKOiIpKSAhPSBFT0YpIHsKICNl
bmRpZgogCXN3aXRjaCAob3B0KSB7CiAJY2FzZSAnQyc6IC8qIGFsdCBpbWFwZC5jb25mIGZpbGUg
Ki8KQEAgLTE2ODMsOCArMTcyMywxNSBAQAogCSAgICAvKiBKYW5pdG9yIGZyZXF1ZW5jeSAqLwog
CSAgICBqYW5pdG9yX2ZyZXF1ZW5jeSA9IGF0b2kob3B0YXJnKTsKIAkgICAgaWYoamFuaXRvcl9m
cmVxdWVuY3kgPCAxKQotCQlmYXRhbCgiVGhlIGphbml0b3IgcGVyaW9kIG11c3QgYmUgYXQgbGVh
c3QgMSBzZWNvbmQiLCBFWF9DT05GSUcpOworCQlmYXRhbCgiVGhlIGphbml0b3IgZnJlcXVlbmN5
IG11c3QgYmUgYXQgbGVhc3Qgb25jZSBwZXIgc2Vjb25kIiwgRVhfQ09ORklHKTsKIAkgICAgYnJl
YWs7ICAgCisgICAgICAgY2FzZSAnSic6CisgICAgICAgICAgIC8qIEphbml0b3IgZGVsYXkgYmVm
b3JlIGNsZWFudXAgb2YgYSBjaGlsZCAqLworICAgICAgICAgICBjaGlsZF9tb3VybmluZ190aW1l
ID0gYXRvaShvcHRhcmcpOworICAgICAgICAgICBpZihjaGlsZF9tb3VybmluZ190aW1lIDwgMSkK
KyAgICAgICAgICAgICAgIGZhdGFsKCJUaGUgamFuaXRvcidzIG1vdXJuaW5nIHRpbWUgaW50ZXJ2
YWwgbXVzdCBiZSBhdCBsZWFzdCAxIHNlY29uZCIsCisgICAgICAgICAgICAgICAgICAgICAgIEVY
X0NPTkZJRyk7CisgICAgICAgICAgIGJyZWFrOwogI2lmZGVmIEhBVkVfTkVUU05NUAogCWNhc2Ug
J1AnOiAvKiBzbm1wIEFnZW50WFBpbmdJbnRlcnZhbCAqLwogCSAgICBhZ2VudHhwaW5naW50ZXJ2
YWwgPSBhdG9pKG9wdGFyZyk7CkBAIC0yMDYwLDEzICsyMTA3LDE5IEBACiAJICAgIGludCBqOwog
CiAJICAgIGlmIChGRF9JU1NFVCh4LCAmcmZkcykpIHsKLQkJciA9IHJlYWQoeCwgJm1zZywgc2l6
ZW9mKG1zZykpOwotCQlpZiAociAhPSBzaXplb2YobXNnKSkgewotCQkgICAgc3lzbG9nKExPR19F
UlIsICJnb3QgaW5jb3JyZWN0bHkgc2l6ZWQgcmVzcG9uc2UgZnJvbSBjaGlsZDogJXgiLCBpKTsK
KwkJd2hpbGUgKChyID0gcmVhZF9tc2coeCwgJm1zZykpID09IDApCisJCSAgICBwcm9jZXNzX21z
ZyhpLCAmbXNnKTsKKwkKKwkJaWYgKHIgPT0gMikgeworCQkgICAgc3lzbG9nKExPR19FUlIsCisJ
CQkiZ290IGluY29ycmVjdGx5IHNpemVkIHJlc3BvbnNlIGZyb20gY2hpbGQ6ICV4IiwgaSk7CisJ
CSAgICBjb250aW51ZTsKKwkJfQorCQlpZiAociA8IDApIHsKKwkJICAgIHN5c2xvZyhMT0dfRVJS
LAorCQkJImVycm9yIHdoaWxlIHJlY2VpdmluZyBtZXNzYWdlIGZyb20gY2hpbGQgJXg6ICVtIiwg
aSk7CiAJCSAgICBjb250aW51ZTsKIAkJfQotCQkKLQkJcHJvY2Vzc19tc2coaSwgJm1zZyk7CiAJ
ICAgIH0KIAogCSAgICBpZiAoU2VydmljZXNbaV0uZXhlYyAmJgpkaWZmIC11ck5hZCBjb21wbGV0
ZS5kcGF0Y2gvbWFzdGVyL21hc3Rlci5oIC90bXAvZHBlcC5OS0lJUjkvY29tcGxldGUuZHBhdGNo
L21hc3Rlci9tYXN0ZXIuaAotLS0gY29tcGxldGUuZHBhdGNoL21hc3Rlci9tYXN0ZXIuaAkyMDA1
LTExLTExIDE3OjAzOjAzLjAwMDAwMDAwMCArMDEwMAorKysgL3RtcC9kcGVwLk5LSUlSOS9jb21w
bGV0ZS5kcGF0Y2gvbWFzdGVyL21hc3Rlci5oCTIwMDUtMTEtMTEgMTc6MDM6MDQuNjUwOTk0NjU5
ICswMTAwCkBAIC00Myw2ICs0Myw3IEBACiBleHRlcm4gc3RydWN0IHNlcnZpY2UgKlNlcnZpY2Vz
OwogZXh0ZXJuIGludCBhbGxvY3NlcnZpY2VzOwogZXh0ZXJuIGludCBuc2VydmljZXM7Cit2b2lk
IHNpZ2hhbmRsZXJfc2V0dXAodm9pZCk7CiAKIC8qCiAgKiBEZXNjcmlwdGlvbiBvZiBtdWx0aXBs
ZSBhZGRyZXNzIGZhbWlseSBzdXBwb3J0IGZyb20K
</data>        

          </attachment>
          <attachment
              isobsolete="1"
              ispatch="1"
              isprivate="0"
          >
            <attachid>420</attachid>
            <date>2006-02-19 21:46 EDT</date>
            <desc>master 2.2.x: Add -J option (Janitor mourn time), fix period/frequency usage</desc>
            <filename>master-Janitor-fixes.diff</filename>
            <type>text/plain</type>
            <size>3101</size>
            <attacher>hmh@debian.org</attacher>
            
              <data encoding="base64">SW5kZXg6IG1hbi9tYXN0ZXIuOAo9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09Ci0tLSBtYW4vbWFzdGVyLjgJKHJldmlzaW9u
IDMwNSkKKysrIG1hbi9tYXN0ZXIuOAkod29ya2luZyBjb3B5KQpAQCAtNjYsOSArNjYsMTMgQEAK
IF0KIFsKIC5CIFwtagotLkkgamFuaXRvciBwZXJpb2QKKy5JIGphbml0b3IgZnJlcXVlbmN5CiBd
CiBbCisuQiBcLUoKKy5JIGphbml0b3IgbW91cm5pbmcgdGltZSBpbnRlcnZhbAorXQorWwogLkIg
XC1kCiBdCiBbCkBAIC0xMTAsNiArMTE0LDEyIEBACiBmb3JrIHJhdGUgKGFuZCB5b3UgaGF2ZSBu
b3QgaW5jcmVhc2VkIHRoZSBjaGlsZCBoYXNoIHRhYmxlIHNpemUgd2hlbiB5b3UKIGNvbXBpbGVk
IEN5cnVzIGZyb20gaXRzIGRlZmF1bHQgb2YgMTAwMDAgZW50cmllcykuCiAuVFAKKy5CSSBcLUog
IiBqYW5pdG9yIG1vdXJuaW5nIHRpbWUgaW50ZXJ2YWwiCitTZXRzIHRoZSBhbW91bnQgb2YgdGlt
ZSwgaW4gc2Vjb25kcywgdG8gcmVtZW1iZXIgYSBjaGlsZCBwcm9jZXNzIGFmdGVyCitpdCBleGl0
cy4gIFlvdSBvbmx5IG5lZWQgdG8gaW5jcmVhc2UgdGhpcyBmcm9tIHRoZSBkZWZhdWx0IG9mIDIg
c2Vjb25kcywKK2lmIHlvdSBzZWUgbWVzc2FnZXMgaW4gc3lzbG9nIGNvbXBsYWluaW5nIG9mIG1l
c3NhZ2VzIGZyb20gdW5rbm93biBvcgordW5yZWdpc3RlcmVkIGNoaWxkcmVuLgorLlRQCiAuQkkg
XC1wICIgcGlkZmlsZSIKIFVzZQogLkkgcGlkZmlsZQpJbmRleDogbWFzdGVyL21hc3Rlci5jCj09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT0KLS0tIG1hc3Rlci9tYXN0ZXIuYwkocmV2aXNpb24gMzA1KQorKysgbWFzdGVyL21h
c3Rlci5jCSh3b3JraW5nIGNvcHkpCkBAIC0xNjIsNiArMTYyLDggQEAKIHN0YXRpYyBzdHJ1Y3Qg
Y2VudHJ5ICpjdGFibGVbY2hpbGRfdGFibGVfc2l6ZV07CiBzdGF0aWMgc3RydWN0IGNlbnRyeSAq
Y2ZyZWVsaXN0OwogCitzdGF0aWMgaW50IGNoaWxkX21vdXJuaW5nX3RpbWUgPSAyOwkvKiBUaW1l
IGluIHNlY29uZHMgdG8gcmVtZW1iZXIgY2hpbGQKKwkJCQkJICAgYWZ0ZXIgcHJvY2Vzc2luZyBT
SUdDSExEICovCiBzdGF0aWMgaW50IGphbml0b3JfZnJlcXVlbmN5ID0gMTsJLyogSmFuaXRvciBz
d2VlcHMgcGVyIHNlY29uZCAqLwogc3RhdGljIGludCBqYW5pdG9yX3Bvc2l0aW9uOwkJLyogRW50
cnkgdG8gYmVnaW4gYXQgaW4gbmV4dCBzd2VlcCAqLwogc3RhdGljIHN0cnVjdCB0aW1ldmFsIGph
bml0b3JfbWFyazsJLyogTGFzdCB0aW1lIGphbml0b3IgZGlkIGEgc3dlZXAgKi8KQEAgLTkxMSw3
ICs5MTMsNyBAQAogCQl9CiAJICAgIH0KIAkgICAgYy0+c2VydmljZV9zdGF0ZSA9IFNFUlZJQ0Vf
U1RBVEVfREVBRDsKLQkgICAgYy0+amFuaXRvcl9kZWFkbGluZSA9IHRpbWUoTlVMTCkgKyAyOwor
CSAgICBjLT5qYW5pdG9yX2RlYWRsaW5lID0gdGltZShOVUxMKSArIGNoaWxkX21vdXJuaW5nX3Rp
bWU7CiAJfSBlbHNlIHsKIAkgICAgLyogd2VpcmQuIEFyZSB3ZSBtdWx0aXRocmVhZGVkIG5vdz8g
d2UgZG9uJ3Qga25vdyB0aGlzIGNoaWxkICovCiAJICAgIHN5c2xvZyhMT0dfV0FSTklORywKQEAg
LTkyMCw3ICs5MjIsNyBAQAogCSAgICBjID0gZ2V0X2NlbnRyeSgpOwogCSAgICBjLT5waWQgPSBw
aWQ7CiAJICAgIGMtPnNlcnZpY2Vfc3RhdGUgPSBTRVJWSUNFX1NUQVRFX0RFQUQ7Ci0JICAgIGMt
Pmphbml0b3JfZGVhZGxpbmUgPSB0aW1lKE5VTEwpICsgMjsKKwkgICAgYy0+amFuaXRvcl9kZWFk
bGluZSA9IHRpbWUoTlVMTCkgKyBjaGlsZF9tb3VybmluZ190aW1lOwogCSAgICBjLT5zaSA9IFNF
UlZJQ0VfTk9ORTsKIAkgICAgYy0+bmV4dCA9IGN0YWJsZVtwaWQgJSBjaGlsZF90YWJsZV9zaXpl
XTsKIAkgICAgY3RhYmxlW3BpZCAlIGNoaWxkX3RhYmxlX3NpemVdID0gYzsKQEAgLTE2NDQsOSAr
MTY0Niw5IEBACiAgICAgcCA9IGdldGVudigiQ1lSVVNfVkVSQk9TRSIpOwogICAgIGlmIChwKSB2
ZXJib3NlID0gYXRvaShwKSArIDE7CiAjaWZkZWYgSEFWRV9ORVRTTk1QCi0gICAgd2hpbGUgKChv
cHQgPSBnZXRvcHQoYXJnYywgYXJndiwgIkM6TTpwOmw6RGRqOlA6eDoiKSkgIT0gRU9GKSB7Cisg
ICAgd2hpbGUgKChvcHQgPSBnZXRvcHQoYXJnYywgYXJndiwgIkM6TTpwOmw6RGRqOko6UDp4OiIp
KSAhPSBFT0YpIHsKICNlbHNlCi0gICAgd2hpbGUgKChvcHQgPSBnZXRvcHQoYXJnYywgYXJndiwg
IkM6TTpwOmw6RGRqOiIpKSAhPSBFT0YpIHsKKyAgICB3aGlsZSAoKG9wdCA9IGdldG9wdChhcmdj
LCBhcmd2LCAiQzpNOnA6bDpEZGo6SjoiKSkgIT0gRU9GKSB7CiAjZW5kaWYKIAlzd2l0Y2ggKG9w
dCkgewogCWNhc2UgJ0MnOiAvKiBhbHQgaW1hcGQuY29uZiBmaWxlICovCkBAIC0xNjc5LDggKzE2
ODEsMTYgQEAKIAkgICAgLyogSmFuaXRvciBmcmVxdWVuY3kgKi8KIAkgICAgamFuaXRvcl9mcmVx
dWVuY3kgPSBhdG9pKG9wdGFyZyk7CiAJICAgIGlmKGphbml0b3JfZnJlcXVlbmN5IDwgMSkKLQkJ
ZmF0YWwoIlRoZSBqYW5pdG9yIHBlcmlvZCBtdXN0IGJlIGF0IGxlYXN0IDEgc2Vjb25kIiwgRVhf
Q09ORklHKTsKLQkgICAgYnJlYWs7ICAgCisJCWZhdGFsKCJUaGUgamFuaXRvciBmcmVxdWVuY3kg
bXVzdCBiZSBhdCBsZWFzdCBvbmNlIHBlciBzZWNvbmQiLAorCQkgICAgICBFWF9DT05GSUcpOwor
CSAgICBicmVhazsKKwljYXNlICdKJzoKKwkgICAgLyogSmFuaXRvciBkZWxheSBiZWZvcmUgY2xl
YW51cCBvZiBhIGNoaWxkICovCisJICAgIGNoaWxkX21vdXJuaW5nX3RpbWUgPSBhdG9pKG9wdGFy
Zyk7CisJICAgIGlmKGNoaWxkX21vdXJuaW5nX3RpbWUgPCAxKQorCQlmYXRhbCgiVGhlIGphbml0
b3IncyBtb3VybmluZyB0aW1lIGludGVydmFsIG11c3QgYmUgYXQgbGVhc3QgMSBzZWNvbmQiLAor
CQkgICAgICBFWF9DT05GSUcpOworCSAgICBicmVhazsKICNpZmRlZiBIQVZFX05FVFNOTVAKIAlj
YXNlICdQJzogLyogc25tcCBBZ2VudFhQaW5nSW50ZXJ2YWwgKi8KIAkgICAgYWdlbnR4cGluZ2lu
dGVydmFsID0gYXRvaShvcHRhcmcpOwo=
</data>        

          </attachment>
          <attachment
              isobsolete="1"
              ispatch="1"
              isprivate="0"
          >
            <attachid>421</attachid>
            <date>2006-02-19 21:54 EDT</date>
            <desc>master 2.2.x: better error message when receving signals from the dead</desc>
            <filename>master-errmsg-fix.diff</filename>
            <type>text/plain</type>
            <size>290</size>
            <attacher>hmh@debian.org</attacher>
            
              <data encoding="base64">b25seSBpbiBwYXRjaDI6Ci0tLSBtYXN0ZXIvbWFzdGVyLmMJKHJldmlzaW9uIDMwNSkKKysrIG1h
c3Rlci9tYXN0ZXIuYwkod29ya2luZyBjb3B5KQpAQCAtOTE3LDMgKzkxNywzIEBACiAJICAgIHN5
c2xvZyhMT0dfV0FSTklORywKLQkJICAgInJlY2VpdmluZyBzaWduYWxzIGZyb20gdW5yZWdpc3Rl
cmVkIGNoaWxkICVkLiBIYW5kbGluZyBpdCBhbnl3YXkiLAorCQkgICAibm90aWZpZWQgb2YgZGVh
dGggb2YgdW5yZWdpc3RlcmVkIGNoaWxkICVkLiBIYW5kbGluZyBpdCBhbnl3YXkiLAogCQkgICBw
aWQpOwo=
</data>        

          </attachment>
          <attachment
              isobsolete="1"
              ispatch="1"
              isprivate="0"
          >
            <attachid>422</attachid>
            <date>2006-02-19 22:08 EDT</date>
            <desc>master 2.2.x: Process all pending messages of a service in one go</desc>
            <filename>master-process_all_pending_msgs.diff</filename>
            <type>text/plain</type>
            <size>1522</size>
            <attacher>hmh@debian.org</attacher>
            
              <data encoding="base64">SW5kZXg6IG1hc3Rlci9tYXN0ZXIuYwo9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09Ci0tLSBtYXN0ZXIvbWFzdGVyLmMJKHJl
dmlzaW9uIDMwNSkKKysrIG1hc3Rlci9tYXN0ZXIuYwkod29ya2luZyBjb3B5KQpAQCAtMTA3NSw2
ICsxMDc1LDM2IEBACiAgICAgfQogfQogCisvKgorICogUmVjZWl2ZXMgYSBtZXNzYWdlIGZyb20g
YSBzZXJ2aWNlLgorICoKKyAqIFJldHVybnMgemVybyBpZiBhbGwgZ29lcyB3ZWxsCisgKiAxIGlm
IG5vIG1zZyBhdmFpbGFibGUKKyAqIDIgaWYgYmFkIG1lc3NhZ2UgcmVjZWl2ZWQgKGluY29ycmVj
dGx5IHNpemVkKQorICogLTEgb24gZXJyb3IgKGVycm5vIHNldCkKKyAqLworaW50IHJlYWRfbXNn
KGludCBmZCwgc3RydWN0IG5vdGlmeV9tZXNzYWdlICptc2cpCit7CisJc3NpemVfdCByOworCXNp
emVfdCBvZmYgPSAwOworCWludCBzID0gc2l6ZW9mKHN0cnVjdCBub3RpZnlfbWVzc2FnZSk7CisK
Kwl3aGlsZSAocyA+IDApIHsKKwkgICAgZG8KKwkJciA9IHJlYWQoZmQsIG1zZyArIG9mZiwgcyk7
CisJICAgIHdoaWxlICgociA9PSAtMSkgJiYgKGVycm5vID09IEVJTlRSKSk7CisJICAgIGlmIChy
IDw9IDApIGJyZWFrOworCSAgICBzIC09IHI7CisJICAgIG9mZiArPSByOworCX0KKwlpZiAoICgo
ciA9PSAwKSAmJiAob2ZmID09IDApKSB8fAorCSAgICAgKChyID09IC0xKSAmJiAoZXJybm8gPT0g
RUFHQUlOKSkgKQorCSAgICByZXR1cm4gMTsKKwlpZiAociA9PSAtMSkgcmV0dXJuIC0xOworCWlm
IChzICE9IDApIHJldHVybiAyOworCXJldHVybiAwOworfQorCiB2b2lkIHByb2Nlc3NfbXNnKGNv
bnN0IGludCBzaSwgc3RydWN0IG5vdGlmeV9tZXNzYWdlICptc2cpIAogewogICAgIHN0cnVjdCBj
ZW50cnkgKmM7CkBAIC0yMDU2LDEzICsyMDg2LDE5IEBACiAJICAgIGludCBqOwogCiAJICAgIGlm
IChGRF9JU1NFVCh4LCAmcmZkcykpIHsKLQkJciA9IHJlYWQoeCwgJm1zZywgc2l6ZW9mKG1zZykp
OwotCQlpZiAociAhPSBzaXplb2YobXNnKSkgewotCQkgICAgc3lzbG9nKExPR19FUlIsICJnb3Qg
aW5jb3JyZWN0bHkgc2l6ZWQgcmVzcG9uc2UgZnJvbSBjaGlsZDogJXgiLCBpKTsKKwkJd2hpbGUg
KChyID0gcmVhZF9tc2coeCwgJm1zZykpID09IDApCisJCSAgICBwcm9jZXNzX21zZygmU2Vydmlj
ZXNbaV0sICZtc2cpOworCisJCWlmIChyID09IDIpIHsKKwkJICAgIHN5c2xvZyhMT0dfRVJSLCAK
KwkJCSJnb3QgaW5jb3JyZWN0bHkgc2l6ZWQgcmVzcG9uc2UgZnJvbSBjaGlsZDogJXgiLCBpKTsK
IAkJICAgIGNvbnRpbnVlOwogCQl9Ci0JCQotCQlwcm9jZXNzX21zZyhpLCAmbXNnKTsKKwkJaWYg
KHIgPCAwKSB7CisJCSAgICBzeXNsb2coTE9HX0VSUiwKKwkJCSJlcnJvciB3aGlsZSByZWNlaXZp
bmcgbWVzc2FnZSBmcm9tIGNoaWxkICV4OiAlbSIsIGkpOworCQkgICAgY29udGludWU7CisJCX0K
IAkgICAgfQogCiAJICAgIGlmIChTZXJ2aWNlc1tpXS5leGVjICYmCg==
</data>        

          </attachment>
          <attachment
              isobsolete="0"
              ispatch="1"
              isprivate="0"
          >
            <attachid>1307</attachid>
            <date>2010-10-12 14:08 EDT</date>
            <desc>Full bug fix with proper commit message, forward-ported to 2.3</desc>
            <filename>13d-master-process-handling</filename>
            <type>text/plain</type>
            <size>9477</size>
            <attacher>hmh@debian.org</attacher>
            
              <data encoding="base64">RnJvbTogSGVucmlxdWUgZGUgTW9yYWVzIEhvbHNjaHVoIDxobWhAZGViaWFuLm9yZz4KU3ViamVj
dDogRml4ZXMgcHJvY2VzcyAoY2hpbGQpIGhhbmRsaW5nIGluIEN5cnVzIG1hc3RlcgoKT3JpZ2lu
OiB2ZW5kb3IsIERlYmlhbiBDeXJ1cyBJTUFQZCAyLjEuMTYtNyAoMjAwNC0wOC0wNyksIDIuMy4x
Ni0xCgoqIEFsbG93cyBDeXJ1cyBtYXN0ZXIgdG8gcHJvY2VzcyBhbGwgcGVuZGluZyBjaGlsZCBt
ZXNzYWdlcyBvbmNlIHBlcgogIGxvb3AsIHdoaWNoIGZpeGVzIGEgRG9TIHNpdHVhdGlvbiBpZiB0
aGVyZSBpcyB0b28gbXVjaCBtZXNzYWdlIGNodXJuCiAgaW4gYSBzbG93ZXIgYm94LiAgSWYgdGhl
IHBlbmRpbmcgbWVzc2FnZXMgbmV2ZXIgZ2V0IHByb2Nlc3NlZCwKICBldmVudHVhbGx5IG1hc3Rl
ciBzdG9wcyBzcGF3bmluZyB0aGUgc2VydmljZSBvciBoYW5kbGluZyBjb25uZWN0aW9ucy4KCiAg
SXQgc2VlbXMgdGhhdCB0aGUgcHJvYmxlbSB0aGlzIHBhdGNoIGZpeGVzIGhhcyBhbHNvIGJlZW4g
cmVwb3J0ZWQgaW4KICBDeXJ1cyBJTUFQIDIuMi4xMiBieSBFYXJsIFNoYW5ub24sIGFuZCBKdWxl
cyBBZ2VlIGFjdHVhbGx5IHRyaWVkIHRvCiAgZ2V0IHRoZSBmaXggZnJvbSBEZWJpYW4gaW50ZWdy
YXRlZCB1cHN0cmVhbS4KCiAgSnVsZXMgQWdlZSBkZXNjcmliZWQgdGhlIHByb2JsZW0gcXVpdGUg
d2VsbCBpbiBhIHByaXZhdGUgbWVzc2FnZToKCiAgICAgIlRoZSBwcm9ibGVtIG9jY3VycyB3aGVu
IHRoZSBjaGlsZCBtZXNzYWdlIHF1ZXVlIGlzIHZlcnkgYmFja2VkIHVwLgogICAgIEEgY2hpbGQg
cHJvY2VzcyBkaWVzIHdpdGggc2V2ZXJhbCBtZXNzYWdlcyBpbiB0aGUgcXVldWUuIHJlYXBfY2hp
bGQKICAgICBtYXJrcyBpdCdzIHN0YXRlIGluIHRoZSBjaGlsZCB0YWJsZSBhcyBkZWFkIGFuZCBk
ZWNyZW1lbnRzIHRoZQogICAgIG51bWJlciBvZiByZWFkeV93b3JrZXJzLiAgVGhlbiB0aGUgamFu
aXRvciBwcm9jZXNzIHJlbW92ZXMgdGhhdAogICAgIGNoaWxkJ3MgZW50cnkgZnJvbSB0aGUgY2hp
bGQgdGFibGUuICBXaGVuIG1hc3RlciBmaW5hbGx5IGdldHMKICAgICBhcm91bmQgdG8gcHJvY2Vz
c2luZyBhbGwgdGhlIG1lc3NhZ2VzIGluIHRoZSBjaGlsZCBtZXNzYWdlIHF1ZXVlLAogICAgIGl0
IGhhcyBubyBpZGVhIHdoZXJlIHRoZSBtZXNzYWdlIGNhbWUgZnJvbSBiZWNhdXNlIHRoZSBjaGls
ZCdzCiAgICAgZW50cnkgaGFzIGFscmVhZHkgYmVlbiByZW1vdmVkIGZyb20gdGhlIGN0YWJsZS4g
IFNvIGl0IGNyZWF0ZXMgYQogICAgIG5ldyBjdGFibGUgZW50cnksIG1hcmtpbmcgdGhlIGNoaWxk
IHByb2Nlc3Mgc3RhdGUgYXMgdW5rbm93biwKICAgICBhc3N1bWluZyB0aGUgbWVzc2FnZSBpcyBm
cm9tIGEgY2hpbGQgcHJvY2VzcyB0aGF0J3Mgc3RpbGwgYWxpdmUuCiAgICAgV2hlbiBtYXN0ZXIg
ZmluaXNoZXMgcHJvY2Vzc2luZyB0aGUgbWVzc2FnZXMgZnJvbSB0aGF0IGxvbmctZGVhZAogICAg
IGNoaWxkLCBpdCBhZ2FpbiAoYW4gaW5hY2N1cmF0ZWx5KSBkZWNyZW1lbnRzIHRoZSBjb3VudCBv
ZgogICAgIHJlYWR5X3dvcmtlcnMuCgogICAgIFRoZSBlYXNpZXN0IHNvbHV0aW9uIGluIG15IG9w
aW5pb24gaXMgdG8gbWFrZSBzdXJlIG1hc3RlciBzdGF5cwogICAgIGNhdWdodCB1cCB3aXRoIG1l
c3NhZ2VzIGZyb20gaXRzIGNoaWxkcmVuIGJ5IHByb2Nlc3NpbmcgYWxsIGNoaWxkCiAgICAgbWVz
c2FnZXMgb24gZWFjaCBsb29wLiAgQWZ0ZXIgYWxsLCBpdCdzIHRoZSBkdXR5IG9mIGEgcGFyZW50
LiIKCiAgS2VubmV0aCBNdXJjaGlzb24gcmVwb3J0ZWQgdGhhdCB0aGV5IGNvdWxkbid0IHJlcHJv
ZHVjZSBpdCBpbiBDTVUuCiAgSG93ZXZlciwgaXQgaXMgY2xlYXJseSBzb21ldGhpbmcgdGhhdCBk
ZXBlbmRzIG9uIHBhdGhvbG9naWNhbCBsb2FkcwogIGFuZCBrZXJuZWwgYmVoYXZpb3VyIHRvIHRy
aWdnZXIuCgogIFRoaXMgZml4IGlzIGEgdHJhZGUgb2ZmOiB3ZSByaXNrIGluY3JlYXNpbmcgbGF0
ZW5jeSB0byBoYW5kIG9mZgogIGNvbm5lY3Rpb25zL3NwYXduIG5ldyBzZXJ2aWNlcyAoYmVjYXVz
ZSB3ZSdyZSBpbiBhIGxvb3AgcHJvY2Vzc2luZwogIGNoaWxkIG1lc3NhZ2VzKS4gIElmIHRoZSBt
ZXNzYWdlcyBuZXZlciBzdG9wIGNvbWluZywgb3IgY29tZSBpbgogIGV4dHJlbWVseSBsYXJnZSBi
dXJzdHMsIG1hc3RlciB3aWxsIGJhY2tsb2cgY29ubmVjdGlvbnMuICBJZiBzeXNsb2coKQogIG9y
IG1lbW9yeSBhbGxvY2F0aW9ucyBpbiB0aGUgbWVzc2FnZSBwcm9jZXNzaW5nIGNvZGVwYXRocyBp
bnRyb2R1Y2UKICBsYXJnZSBsYXRlbmNpZXMsIHRoZSBjb3N0IG9mIHByb2Nlc3NpbmcgbWVzc2Fn
ZXMgY2FuIGdldCB0b28gaGlnaAogIGFuZCBtYXN0ZXIgd2lsbCBiYWNrbG9nIGNvbm5lY3Rpb25z
LiAgTm90ZTogdGhpcyAqQ0FOKiBoYXBwZW4sIGFuZAogIGluIGZhY3QgaXQgZGlkIGhhcHBlbiB0
byBKdWxlcyB1bnRpbCBoZSByZWR1Y2VkIHRoZSBhbW91bnQgb2YgZGF0YQogIGdvaW5nIHRvIHN5
c2xvZyBpbiBtYXN0ZXIvbWFzdGVyLmM6cHJvY2Vzc19tc2coKS4KCiAgUmVwb3J0ZWQtYW5hbHlz
ZWQtYW5kLXRlc3RlZC1ieTogSnVsZXMgQWdlZSA8anVsZXNhQHBjZi5jb20+LgoKKiBGaXggbWVz
c2FnZSBoYW5kbGluZyBmcm9tIGV4cGlyZWQgY2hpbGRyZW4gKG5ldykKCiAgSXQgaXMgcG9zc2li
bGUgdGhhdCB0aGUga2VybmVsIHdpbGwgZGVsYXkgbWVzc2FnZSBkZWxpdmVyeSBhIGxvdCBtb3Jl
CiAgdGhhbiBzaWduYWwgZGVsaXZlcnkgaW4gYSBvdmVybG9hZCBzaXR1YXRpb24uICBUaGUgbWVz
c2FnZSBkZWxpdmVyeQogIGRlbGF5IGNhbiBnZXQgbGFyZ2UgZW5vdWdoIGZvciBtYXN0ZXIgdG8g
aGF2ZSBhbHJlYWR5IGV4cGlyZWQgYSBkZWFkCiAgY2hpbGQgZnJvbSBpdHMgY2hpbGRyZW4gdGFi
bGUgd2hlbiBhIG1lc3NhZ2UgYXJyaXZlcy4gIFRoZXJlIGlzIGEgYnVnCiAgaW4gdGhlIHN0YXRl
IG1hY2hpbmUgZGVzaWduOiBpdCByZWFkZGVkIHN1Y2ggY2hpbGRyZW4gdG8gdGhlIHRhYmxlIGFz
CiAgYmVpbmcgaW4gYW4gdW5rbm93biBzdGF0ZSAoYXMgZGVzY3JpYmVkIGJ5IEp1bGVzIEFnZWUp
LCB3aGljaCBlbmRzIHVwCiAgY2F1c2luZyBiYWQgYWNjb3VudGluZyBvZiByZWFkeV93b3JrZXJz
LgoKICBGaXggdGhlIHN0YXRlIG1hY2hpbmUgdG8gYXNzdW1lIG1lc3NhZ2VzIGZyb20gdW5rbm93
biBjaGlsZHJlbiBhcmUKICBmcm9tIGxvbmcgZGVhZCBjaGlsZHJlbiBhbmQgYWRkIHRoZW0gYmFj
ayB0byB0aGUgY2hpbGQgdGFibGUgaW4gREVBRAogIHN0YXRlLgoKKiBGaXggY29ubmVjdGlvbiBh
Y2NvdW50aW5nIHdoZW4gY2hpbGQgZGllcyBiZWZvcmUgaXRzIG1lc3NhZ2VzCiAgaGF2ZSBiZWVu
IHByb2Nlc3NlZCAobmV3KQoKICBXaGVuIHByb2Nlc3NpbmcgbWVzc2FnZXMgZnJvbSBkZWFkIG9y
IGxvbmctZGVhZCBjaGlsZHJlbiwgZXhwbGljaXRseQogIGlnbm9yZSBBVkFJTEFCTEUvVU5BVkFJ
TEFCTEUgbWVzc2FnZXMgKHRvIGRvY3VtZW50IGl0IGFzIGEgbm9ybWFsCiAgY29kZXBhdGggLS0g
dGhlIGNvZGUgd291bGQgYWxyZWFkeSBkbyBpdCwgYnV0IHRocm91Z2ggYSBjb2RlcGF0aAogIG1h
cmtlZCBhcyAic2hvdWxkIG5vdCBoYXBwZW4iKS4gIEZvciBDT05ORUNUSU9OL0NPTk5FQ1RJT05f
TVVMVEkKICBtZXNzYWdlcyBmcm9tIGRlYWQgb3IgbG9uZy1kZWFkIGNoaWxkcmVuLCBqdXN0IGRv
IGNvbm5lY3Rpb24gYWNjb3V0aW5nCiAgYnV0IGRvbid0IHRvdWNoIGNoaWxkcmVuIGFjY291bnRp
bmcgKGFzIHdlIGFscmVhZHkgYWNjb3VudGVkIGZvciB0aGUKICB3b3JrZXIncyBkZWF0aCB3aGVu
IHdlIHByb2Nlc3NlZCBpdHMgU0lHQ0hMRCkuCgpJbmRleDogY3lydXMtaW1hcGQtMi4zLXBrZy9t
YXN0ZXIvbWFzdGVyLmMKPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PQotLS0gY3lydXMtaW1hcGQtMi4zLXBrZy5vcmlnL21h
c3Rlci9tYXN0ZXIuYworKysgY3lydXMtaW1hcGQtMi4zLXBrZy9tYXN0ZXIvbWFzdGVyLmMKQEAg
LTg5OCw3ICs4OTgsNiBAQCB2b2lkIHJlYXBfY2hpbGQodm9pZCkKIAkJfSAKIAkgICAgfSBlbHNl
IHsKIAkgICAgCS8qIGNoaWxkcmVuIGZyb20gc3Bhd25fc2NoZWR1bGUgKGV2ZW50cykgb3IKLQkJ
ICogY2hpbGRyZW4gdGhhdCBtZXNzYWdlZCB1cyBiZWZvcmUgYmVpbmcgcmVnaXN0ZXJlZCBvcgog
CQkgKiBjaGlsZHJlbiBvZiBzZXJ2aWNlcyByZW1vdmVkIGJ5IHJlcmVhZF9jb25mKCkgKi8KIAkJ
aWYgKGMtPnNlcnZpY2Vfc3RhdGUgIT0gU0VSVklDRV9TVEFURV9SRUFEWSkgewogCQkgICAgc3lz
bG9nKExPR19XQVJOSU5HLApAQCAtOTEwLDE3ICs5MDksMTEgQEAgdm9pZCByZWFwX2NoaWxkKHZv
aWQpCiAJICAgIGMtPnNlcnZpY2Vfc3RhdGUgPSBTRVJWSUNFX1NUQVRFX0RFQUQ7CiAJICAgIGMt
Pmphbml0b3JfZGVhZGxpbmUgPSB0aW1lKE5VTEwpICsgMjsKIAl9IGVsc2UgewotCSAgICAvKiB3
ZWlyZC4gQXJlIHdlIG11bHRpdGhyZWFkZWQgbm93PyB3ZSBkb24ndCBrbm93IHRoaXMgY2hpbGQg
Ki8KLQkgICAgc3lzbG9nKExPR19XQVJOSU5HLAotCQkgICAicmVjZWl2aW5nIHNpZ25hbHMgZnJv
bSB1bnJlZ2lzdGVyZWQgY2hpbGQgJWQuIEhhbmRsaW5nIGl0IGFueXdheSIsCisJICAgIC8qIEFy
ZSB3ZSBtdWx0aXRocmVhZGVkIG5vdz8gd2UgZG9uJ3Qga25vdyB0aGlzIGNoaWxkICovCisJICAg
IHN5c2xvZyhMT0dfRVJSLAorCQkgICAicmVjZWl2ZWQgU0lHQ0hMRCBmcm9tIHVua25vd24gY2hp
bGQgcGlkICVkLCBpZ25vcmluZyIsCiAJCSAgIHBpZCk7Ci0JICAgIGMgPSBnZXRfY2VudHJ5KCk7
Ci0JICAgIGMtPnBpZCA9IHBpZDsKLQkgICAgYy0+c2VydmljZV9zdGF0ZSA9IFNFUlZJQ0VfU1RB
VEVfREVBRDsKLQkgICAgYy0+amFuaXRvcl9kZWFkbGluZSA9IHRpbWUoTlVMTCkgKyAyOwotCSAg
ICBjLT5zaSA9IFNFUlZJQ0VfTk9ORTsKLQkgICAgYy0+bmV4dCA9IGN0YWJsZVtwaWQgJSBjaGls
ZF90YWJsZV9zaXplXTsKLQkgICAgY3RhYmxlW3BpZCAlIGNoaWxkX3RhYmxlX3NpemVdID0gYzsK
KwkgICAgLyogRklYTUU6IGlzIHRoaXMgc29tZXRoaW5nIHdlIHNob3VsZCB0YWtlIGxpZ2h0bHk/
ICovCiAJfQogCWlmICh2ZXJib3NlICYmIGMgJiYgKGMtPnNpICE9IFNFUlZJQ0VfTk9ORSkpCiAJ
ICAgIHN5c2xvZyhMT0dfREVCVUcsICJzZXJ2aWNlICVzIG5vdyBoYXMgJWQgcmVhZHkgd29ya2Vy
c1xuIiwgCkBAIC0xMDczLDYgKzEwNjYsMzYgQEAgdm9pZCBzaWdoYW5kbGVyX3NldHVwKHZvaWQp
CiAgICAgfQogfQogCisvKgorICogUmVjZWl2ZXMgYSBtZXNzYWdlIGZyb20gYSBzZXJ2aWNlLgor
ICoKKyAqIFJldHVybnMgemVybyBpZiBhbGwgZ29lcyB3ZWxsCisgKiAxIGlmIG5vIG1zZyBhdmFp
bGFibGUKKyAqIDIgaWYgYmFkIG1lc3NhZ2UgcmVjZWl2ZWQgKGluY29ycmVjdGx5IHNpemVkKQor
ICogLTEgb24gZXJyb3IgKGVycm5vIHNldCkKKyAqLworaW50IHJlYWRfbXNnKGludCBmZCwgc3Ry
dWN0IG5vdGlmeV9tZXNzYWdlICptc2cpCit7CisgICAgc3NpemVfdCByOworICAgIHNpemVfdCBv
ZmYgPSAwOworICAgIGludCBzID0gc2l6ZW9mKHN0cnVjdCBub3RpZnlfbWVzc2FnZSk7CisKKyAg
ICB3aGlsZSAocyA+IDApIHsKKyAgICAgICAgZG8KKyAgICAgICAgICAgIHIgPSByZWFkKGZkLCBt
c2cgKyBvZmYsIHMpOworICAgICAgICB3aGlsZSAoKHIgPT0gLTEpICYmIChlcnJubyA9PSBFSU5U
UikpOworICAgICAgICBpZiAociA8PSAwKSBicmVhazsKKyAgICAgICAgcyAtPSByOworICAgICAg
ICBvZmYgKz0gcjsKKyAgICB9CisgICAgaWYgKCAoKHIgPT0gMCkgJiYgKG9mZiA9PSAwKSkgfHwK
KyAgICAgICAgICgociA9PSAtMSkgJiYgKGVycm5vID09IEVBR0FJTikpICkKKyAgICAgICAgcmV0
dXJuIDE7CisgICAgaWYgKHIgPT0gLTEpIHJldHVybiAtMTsKKyAgICBpZiAocyAhPSAwKSByZXR1
cm4gMjsKKyAgICByZXR1cm4gMDsKK30KKwogdm9pZCBwcm9jZXNzX21zZyhjb25zdCBpbnQgc2ks
IHN0cnVjdCBub3RpZnlfbWVzc2FnZSAqbXNnKSAKIHsKICAgICBzdHJ1Y3QgY2VudHJ5ICpjOwpA
QCAtMTA4NSwxMyArMTEwOCwyMSBAQCB2b2lkIHByb2Nlc3NfbXNnKGNvbnN0IGludCBzaSwgc3Ry
dWN0IG5vCiAgICAgCiAgICAgLyogRGlkIHdlIGZpbmQgaXQ/ICovCiAgICAgaWYgKCFjIHx8IGMt
PnBpZCAhPSBtc2ctPnNlcnZpY2VfcGlkKSB7Ci0Jc3lzbG9nKExPR19XQVJOSU5HLCAic2Vydmlj
ZSAlcyBwaWQgJWQ6IHdoaWxlIHRyeWluZyB0byBwcm9jZXNzIG1lc3NhZ2UgMHgleDogbm90IHJl
Z2lzdGVyZWQgeWV0IiwgCi0JICAgICAgIFNFUlZJQ0VOQU1FKHMtPm5hbWUpLCBtc2ctPnNlcnZp
Y2VfcGlkLCBtc2ctPm1lc3NhZ2UpOwotCS8qIHJlc2lsaWVuY2UgcGFyYW5vaWEuIENhdXNlcyBz
bWFsbCBwZXJmb3JtYW5jZSBsb3NzIHdoZW4gdXNlZCAqLworCS8qIElmIHdlIGRvbid0IGtub3cg
YWJvdXQgdGhlIGNoaWxkLCB0aGF0IG1lYW5zIGl0IGhhcyBleHBpcmVkIGZyb20KKwkgKiB0aGUg
Y2hpbGQgbGlzdCwgZHVlIHRvIGxhcmdlIG1lc3NhZ2UgZGVsaXZlcnkgZGVsYXlzLiAgVGhpcyBp
cworCSAqIGluZGVlZCBwb3NzaWJsZSwgYWx0aG91Z2ggaXQgaXMgcmFyZSAoRGViaWFuIGJ1ZyBy
ZXBvcnQpLgorCSAqCisJICogTm90ZSB0aGF0IHRoaXMgYW5hbHlzaXMgZGVwZW5kcyBvbiBtYXN0
ZXIncyBzaW5nbGUtdGhyZWFkZWQKKwkgKiBuYXR1cmUgKi8KKwlzeXNsb2coTE9HX1dBUk5JTkcs
CisJCSJzZXJ2aWNlICVzIHBpZCAlZDogcmVjZWl2aW5nIG1lc3NhZ2VzIGZyb20gbG9uZyBkZWFk
IGNoaWxkcmVuIiwKKwkgICAgICAgU0VSVklDRU5BTUUocy0+bmFtZSksIG1zZy0+c2VydmljZV9w
aWQpOworCS8qIHJlLWFkZCBjaGlsZCB0byBsaXN0ICovCiAJYyA9IGdldF9jZW50cnkoKTsKIAlj
LT5zaSA9IHNpOwogCWMtPnBpZCA9IG1zZy0+c2VydmljZV9waWQ7Ci0JYy0+c2VydmljZV9zdGF0
ZSA9IFNFUlZJQ0VfU1RBVEVfVU5LTk9XTjsKKwljLT5zZXJ2aWNlX3N0YXRlID0gU0VSVklDRV9T
VEFURV9ERUFEOworCWMtPmphbml0b3JfZGVhZGxpbmUgPSB0aW1lKE5VTEwpICsgMjsKIAljLT5u
ZXh0ID0gY3RhYmxlW2MtPnBpZCAlIGNoaWxkX3RhYmxlX3NpemVdOwogCWN0YWJsZVtjLT5waWQg
JSBjaGlsZF90YWJsZV9zaXplXSA9IGM7CiAgICAgfQpAQCAtMTE1Myw2ICsxMTg0LDExIEBAIHZv
aWQgcHJvY2Vzc19tc2coY29uc3QgaW50IHNpLCBzdHJ1Y3Qgbm8KIAkgICAgYy0+c2VydmljZV9z
dGF0ZSA9IFNFUlZJQ0VfU1RBVEVfUkVBRFk7CiAJICAgIHMtPnJlYWR5X3dvcmtlcnMrKzsKIAkg
ICAgYnJlYWs7CisKKwljYXNlIFNFUlZJQ0VfU1RBVEVfREVBRDoKKwkgICAgLyogZWNob2VzIGZy
b20gdGhlIHBhc3QuLi4ganVzdCBpZ25vcmUgKi8KKwkgICAgYnJlYWs7CisKIAlkZWZhdWx0Ogog
CSAgICAvKiBTaG91bGRuJ3QgZ2V0IGhlcmUgKi8KIAkgICAgYnJlYWs7CkBAIC0xMTgzLDYgKzEy
MTksMTEgQEAgdm9pZCBwcm9jZXNzX21zZyhjb25zdCBpbnQgc2ksIHN0cnVjdCBubwogCSAgICBj
LT5zZXJ2aWNlX3N0YXRlID0gU0VSVklDRV9TVEFURV9CVVNZOwogCSAgICBzLT5yZWFkeV93b3Jr
ZXJzLS07CiAJICAgIGJyZWFrOworCisJY2FzZSBTRVJWSUNFX1NUQVRFX0RFQUQ6CisJICAgIC8q
IGVjaG9lcyBmcm9tIHRoZSBwYXN0Li4uIGp1c3QgaWdub3JlICovCisJICAgIGJyZWFrOworCiAJ
ZGVmYXVsdDoKIAkgICAgLyogU2hvdWxkbid0IGdldCBoZXJlICovCiAJICAgIGJyZWFrOwpAQCAt
MTIxNiw2ICsxMjU3LDEyIEBAIHZvaWQgcHJvY2Vzc19tc2coY29uc3QgaW50IHNpLCBzdHJ1Y3Qg
bm8KIAkgICAgYy0+c2VydmljZV9zdGF0ZSA9IFNFUlZJQ0VfU1RBVEVfQlVTWTsKIAkgICAgcy0+
bmNvbm5lY3Rpb25zKys7CiAJICAgIHMtPnJlYWR5X3dvcmtlcnMtLTsKKworCWNhc2UgU0VSVklD
RV9TVEFURV9ERUFEOgorCSAgICAvKiBlY2hvZXMgZnJvbSB0aGUgcGFzdC4uLiBkbyB0aGUgYWNj
b3VudGluZyAqLworCSAgICBzLT5uY29ubmVjdGlvbnMrKzsKKwkgICAgYnJlYWs7CisKIAlkZWZh
dWx0OgogCSAgICAvKiBTaG91bGRuJ3QgZ2V0IGhlcmUgKi8KIAkgICAgYnJlYWs7CkBAIC0xMjUw
LDYgKzEyOTcsMTIgQEAgdm9pZCBwcm9jZXNzX21zZyhjb25zdCBpbnQgc2ksIHN0cnVjdCBubwog
CQkgICAic2VydmljZSAlcyBwaWQgJWQgaW4gVU5LTk9XTiBzdGF0ZTogc2VydmluZyBvbmUgbW9y
ZSBtdWx0aS10aHJlYWRlZCBjb25uZWN0aW9uLCBmb3JjZWQgdG8gUkVBRFkgc3RhdGUiLAogCQkg
ICBTRVJWSUNFTkFNRShzLT5uYW1lKSwgYy0+cGlkKTsKIAkgICAgYnJlYWs7CisKKwljYXNlIFNF
UlZJQ0VfU1RBVEVfREVBRDoKKwkgICAgLyogZWNob2VzIGZyb20gdGhlIHBhc3QuLi4gZG8gdGhl
IGFjY291bnRpbmcgKi8KKwkgICAgcy0+bmNvbm5lY3Rpb25zKys7CisJICAgIGJyZWFrOworCiAJ
ZGVmYXVsdDoKIAkgICAgLyogU2hvdWxkbid0IGdldCBoZXJlICovCiAJICAgIGJyZWFrOwpAQCAt
MTQxMiw3ICsxNDY1LDcgQEAgdm9pZCBhZGRfc2VydmljZShjb25zdCBjaGFyICpuYW1lLCBzdHJ1
YwogCVNlcnZpY2VzW2ldLmRlc2lyZWRfd29ya2VycyA9IHByZWZvcms7CiAJU2VydmljZXNbaV0u
YmFieXNpdCA9IGJhYnlzaXQ7CiAJU2VydmljZXNbaV0ubWF4X3dvcmtlcnMgPSBhdG9pKG1heCk7
Ci0JaWYgKFNlcnZpY2VzW2ldLm1heF93b3JrZXJzID09IC0xKSB7CisJaWYgKFNlcnZpY2VzW2ld
Lm1heF93b3JrZXJzIDwgMCkgewogCSAgICBTZXJ2aWNlc1tpXS5tYXhfd29ya2VycyA9IElOVF9N
QVg7CiAJfQogICAgIH0gZWxzZSB7CkBAIC0yMDcyLDEzICsyMTI1LDE5IEBAIGludCBtYWluKGlu
dCBhcmdjLCBjaGFyICoqYXJndikKIAkgICAgaW50IGo7CiAKIAkgICAgaWYgKEZEX0lTU0VUKHgs
ICZyZmRzKSkgewotCQlyID0gcmVhZCh4LCAmbXNnLCBzaXplb2YobXNnKSk7Ci0JCWlmIChyICE9
IHNpemVvZihtc2cpKSB7Ci0JCSAgICBzeXNsb2coTE9HX0VSUiwgImdvdCBpbmNvcnJlY3RseSBz
aXplZCByZXNwb25zZSBmcm9tIGNoaWxkOiAleCIsIGkpOworCQl3aGlsZSAoKHIgPSByZWFkX21z
Zyh4LCAmbXNnKSkgPT0gMCkKKwkJICAgIHByb2Nlc3NfbXNnKGksICZtc2cpOworCisJCWlmIChy
ID09IDIpIHsKKwkJICAgIHN5c2xvZyhMT0dfRVJSLAorCQkJImdvdCBpbmNvcnJlY3RseSBzaXpl
ZCByZXNwb25zZSBmcm9tIGNoaWxkOiAleCIsIGkpOworCQkgICAgY29udGludWU7CisJCX0KKwkJ
aWYgKHIgPCAwKSB7CisJCSAgICBzeXNsb2coTE9HX0VSUiwKKwkJCSJlcnJvciB3aGlsZSByZWNl
aXZpbmcgbWVzc2FnZSBmcm9tIGNoaWxkICV4OiAlbSIsIGkpOwogCQkgICAgY29udGludWU7CiAJ
CX0KLQkJCi0JCXByb2Nlc3NfbXNnKGksICZtc2cpOwogCSAgICB9CiAKIAkgICAgaWYgKFNlcnZp
Y2VzW2ldLmV4ZWMgJiYK
</data>        

          </attachment>
      

    </bug>

</bugzilla>