<?xml version="1.0" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugzilla.cyrusimap.org/bugzilla.dtd">

<bugzilla version="3.2.5.1-2"
          urlbase="https://bugzilla.cyrusimap.org/"
          maintainer="Dave McMurtrie &lt;dave64@andrew.cmu.edu&gt;"
>

    <bug>
          <bug_id>63</bug_id>
          
          <creation_ts>2000-07-19 18:01 EDT</creation_ts>
          <short_desc>quota should use cyrusdb</short_desc>
          <delta_ts>2010-10-18 12:42:47 EDT</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Cyrus IMAP</product>
          <component>IMAP</component>
          <version>2.0.x</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>CLOSED</bug_status>
          <resolution>FIXED</resolution>
          
          
          
          
          <priority>P4</priority>
          <bug_severity>bug</bug_severity>
          <target_milestone>Future</target_milestone>
          <dependson>1270</dependson>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Larry Greenfield">leg+cyrus@andrew.cmu.edu</reporter>
          <assigned_to name="Rob Siemborski">rjs3@andrew.cmu.edu</assigned_to>
          
          

      

      

      
          <long_desc isprivate="0">
            <who name="Larry Greenfield">leg+cyrus@andrew.cmu.edu</who>
            <bug_when>2000-07-19 18:01:54 EDT</bug_when>
            <thetext>would be bad with current cyrusdb_flat, but ok with berkeley db and ok with
a finer-grainer locking scheme.</thetext>
          </long_desc>
          <long_desc isprivate="0">
            <who name="Ken Murchison">ken@oceana.com</who>
            <bug_when>2002-08-22 15:38:32 EDT</bug_when>
            <thetext>Should we do a unified quotas.db for 2.2?</thetext>
          </long_desc>
          <long_desc isprivate="0">
            <who name="Larry Greenfield">leg+cyrus@andrew.cmu.edu</who>
            <bug_when>2002-08-22 15:41:25 EDT</bug_when>
            <thetext>if so, the first step is to write a cyrusdb_quotalegacy backend that
interoperates with the legacy quota layout.

i&apos;m not sure it&apos;s worth it, since it&apos;s probably a case of not broke don&apos;t fix it.</thetext>
          </long_desc>
          <long_desc isprivate="0">
            <who name="Rob Siemborski">rjs3@andrew.cmu.edu</who>
            <bug_when>2003-12-05 15:58:54 EDT</bug_when>
            <thetext>add bug 1270 as a blocker, since if we can&apos;t fix the lock-across-network reads
issue then cyrusdb is a nonstarter.</thetext>
          </long_desc>
          <long_desc isprivate="0">
            <who name="Ken Murchison">ken@oceana.com</who>
            <bug_when>2003-12-19 10:50:39 EDT</bug_when>
            <thetext>Created an attachment (id=244)
cyrusdb_quotalegacy patch

Putting this here so I don&apos;t lose it.</thetext>
          </long_desc>
          <long_desc isprivate="0">
            <who name="Ken Murchison">ken@oceana.com</who>
            <bug_when>2004-01-06 16:58:59 EDT</bug_when>
            <thetext>Created an attachment (id=245)
cyrusdb_quotalegacy patch

Updated to current CVS.</thetext>
          </long_desc>
          <long_desc isprivate="0">
            <who name="Ken Murchison">ken@oceana.com</who>
            <bug_when>2004-01-19 20:11:27 EDT</bug_when>
            <thetext>Applied patch to CVS.</thetext>
          </long_desc>
      
          <attachment
              isobsolete="1"
              ispatch="1"
              isprivate="0"
          >
            <attachid>244</attachid>
            <date>2003-12-19 10:50 EDT</date>
            <desc>cyrusdb_quotalegacy patch</desc>
            <filename>quotalegacy.patch</filename>
            <type>text/plain</type>
            <size>86366</size>
            <attacher>ken@oceana.com</attacher>
            
              <data encoding="base64">SW5kZXg6IGNvbmZpZ3VyZS5pbgo9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09ClJDUyBmaWxlOiAvYWZzL2FuZHJldy9zeXN0
ZW0vY3ZzL3NyYy9jeXJ1cy9jb25maWd1cmUuaW4sdgpyZXRyaWV2aW5nIHJldmlzaW9uIDEuMjcz
CmRpZmYgLXUgLXIxLjI3MyBjb25maWd1cmUuaW4KLS0tIGNvbmZpZ3VyZS5pbgkxNSBEZWMgMjAw
MyAyMDowMDozNSAtMDAwMAkxLjI3MworKysgY29uZmlndXJlLmluCTE2IERlYyAyMDAzIDIxOjMx
OjQ4IC0wMDAwCkBAIC0xNjYsNyArMTY2LDcgQEAKIGRubCBmdW5jdGlvbiBmb3IgZG9pbmcgZWFj
aCBvZiB0aGUgZGF0YWJhc2UgYmFja2VuZHMKIGRubCBwYXJhbWV0ZXJzOiBiYWNrZW5kIG5hbWUs
IHZhcmlhYmxlIHRvIHNldCwgd2l0aHZhbAogCi1DWVJVU0RCX09CSlM9ImN5cnVzZGJfZmxhdC5v
IGN5cnVzZGJfc2tpcGxpc3QubyIKK0NZUlVTREJfT0JKUz0iY3lydXNkYl9mbGF0Lm8gY3lydXNk
Yl9za2lwbGlzdC5vIGN5cnVzZGJfcXVvdGFsZWdhY3kubyIKIAogZG5sIEJlcmtlbGV5IERCIERl
dGVjdGlvbgogCkluZGV4OiBpbWFwL01ha2VmaWxlLmluCj09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KUkNTIGZpbGU6IC9h
ZnMvYW5kcmV3L3N5c3RlbS9jdnMvc3JjL2N5cnVzL2ltYXAvTWFrZWZpbGUuaW4sdgpyZXRyaWV2
aW5nIHJldmlzaW9uIDEuMTc5CmRpZmYgLXUgLXIxLjE3OSBNYWtlZmlsZS5pbgotLS0gaW1hcC9N
YWtlZmlsZS5pbgkxMiBOb3YgMjAwMyAwNDowMjowMSAtMDAwMAkxLjE3OQorKysgaW1hcC9NYWtl
ZmlsZS5pbgkxNiBEZWMgMjAwMyAyMTozMTo0OSAtMDAwMApAQCAtMTAxLDcgKzEwMSw3IEBACiAJ
Z2xvYmFsLm8gaW1hcF9lcnIubyBtdXBkYXRlX2Vyci5vIHByb2MubyBzZXRwcm9jdGl0bGUubyBc
CiAJY29udmVydF9jb2RlLm8gZHVwbGljYXRlLm8gc2FzbGNsaWVudC5vIHNhc2xzZXJ2ZXIubyBz
aWduYWxzLm8gXAogCWFubm90YXRlLm8gc2VhcmNoX2VuZ2luZXMubyBzcXVhdC5vIHNxdWF0X2lu
dGVybmFsLm8gbWJkdW1wLm8gXAotCWltYXBwYXJzZS5vIHRlbGVtZXRyeS5vIHVzZXIubyBub3Rp
ZnkubyBwcm90b2NvbC5vIFwKKwlpbWFwcGFyc2UubyB0ZWxlbWV0cnkubyB1c2VyLm8gbm90aWZ5
Lm8gcHJvdG9jb2wubyBxdW90YV9kYi5vIFwKIAkkKFNFRU4pICQoSURMRSkKIAogSU1BUERPQkpT
PXB1c2hzdGF0cy5vIGJhY2tlbmQubyBpbWFwZC5vIGluZGV4Lm8gdGxzLm8gdmVyc2lvbi5vCklu
ZGV4OiBpbWFwL2FwcGVuZC5jCj09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KUkNTIGZpbGU6IC9hZnMvYW5kcmV3L3N5c3Rl
bS9jdnMvc3JjL2N5cnVzL2ltYXAvYXBwZW5kLmMsdgpyZXRyaWV2aW5nIHJldmlzaW9uIDEuMTAy
CmRpZmYgLXUgLXIxLjEwMiBhcHBlbmQuYwotLS0gaW1hcC9hcHBlbmQuYwkyMiBPY3QgMjAwMyAx
ODo1MDowNyAtMDAwMAkxLjEwMgorKysgaW1hcC9hcHBlbmQuYwkxNiBEZWMgMjAwMyAyMTozMTo0
OSAtMDAwMApAQCAtNjUsNiArNjUsNyBAQAogI2luY2x1ZGUgIm1ib3hsaXN0LmgiCiAjaW5jbHVk
ZSAic2Vlbi5oIgogI2luY2x1ZGUgInJldHJ5LmgiCisjaW5jbHVkZSAicXVvdGEuaCIKIAogc3Ry
dWN0IHN0YWdlbXNnIHsKICAgICBjaGFyIGZuYW1lWzEwMjRdOwpAQCAtMTM2LDIxICsxMzcsMTgg
QEAKIAlyZXR1cm4gSU1BUF9NQUlMQk9YX05PVFNVUFBPUlRFRDsKICAgICB9CiAKLSAgICByID0g
bWFpbGJveF9yZWFkX3F1b3RhKCZtLnF1b3RhKTsKLSAgICBpZiAocikgewotCW1haWxib3hfY2xv
c2UoJm0pOwotCXJldHVybiByOwotICAgIH0KLQotICAgIGlmIChtLnF1b3RhLmxpbWl0ID49IDAg
JiYgcXVvdGFjaGVjayA+PSAwICYmCi0JbS5xdW90YS51c2VkICsgcXVvdGFjaGVjayA+IAorICAg
IHIgPSBxdW90YV9yZWFkKCZtLnF1b3RhLCBOVUxMLCAwKTsKKyAgICBpZiAoIXIpIHsKKwlpZiAo
bS5xdW90YS5saW1pdCA+PSAwICYmIHF1b3RhY2hlY2sgPj0gMCAmJgorCSAgICBtLnF1b3RhLnVz
ZWQgKyBxdW90YWNoZWNrID4gCiAJICAgICgodW5zaWduZWQpIG0ucXVvdGEubGltaXQgKiBRVU9U
QV9VTklUUykpIHsKLQltYWlsYm94X2Nsb3NlKCZtKTsKLQlyZXR1cm4gSU1BUF9RVU9UQV9FWENF
RURFRDsKKwkgICAgciA9IElNQVBfUVVPVEFfRVhDRUVERUQ7CisJfQogICAgIH0KKyAgICBlbHNl
IGlmIChyID09IElNQVBfUVVPVEFST09UX05PTkVYSVNURU5UKSByID0gMDsKIAogICAgIG1haWxi
b3hfY2xvc2UoJm0pOwotICAgIHJldHVybiAwOworICAgIHJldHVybiByOwogfQogCiAvKgpAQCAt
MjA2LDE3ICsyMDQsMjAgQEAKIAlyZXR1cm4gcjsKICAgICB9CiAKLSAgICByID0gbWFpbGJveF9s
b2NrX3F1b3RhKCZhcy0+bS5xdW90YSk7Ci0gICAgaWYgKHIpIHsKLQltYWlsYm94X2Nsb3NlKCZh
cy0+bSk7Ci0JcmV0dXJuIHI7CisgICAgciA9IHF1b3RhX3JlYWQoJmFzLT5tLnF1b3RhLCBOVUxM
LCAwKTsKKyAgICBpZiAoIXIpIHsKKwlpZiAoYXMtPm0ucXVvdGEubGltaXQgPj0gMCAmJiBxdW90
YWNoZWNrID49IDAgJiYKKwkgICAgYXMtPm0ucXVvdGEudXNlZCArIHF1b3RhY2hlY2sgPiAKKwkg
ICAgKCh1bnNpZ25lZCkgYXMtPm0ucXVvdGEubGltaXQgKiBRVU9UQV9VTklUUykpIHsKKwkgICAg
bWFpbGJveF9jbG9zZSgmYXMtPm0pOworCSAgICByID0gSU1BUF9RVU9UQV9FWENFRURFRDsKKwl9
CiAgICAgfQorICAgIGVsc2UgaWYgKHIgPT0gSU1BUF9RVU9UQVJPT1RfTk9ORVhJU1RFTlQpIHIg
PSAwOwogCi0gICAgaWYgKGFzLT5tLnF1b3RhLmxpbWl0ID49IDAgJiYgcXVvdGFjaGVjayA+PSAw
ICYmCi0JYXMtPm0ucXVvdGEudXNlZCArIHF1b3RhY2hlY2sgPiAKLQkgICAgKCh1bnNpZ25lZCkg
YXMtPm0ucXVvdGEubGltaXQgKiBRVU9UQV9VTklUUykpIHsKKyAgICBpZiAocikgewogCW1haWxi
b3hfY2xvc2UoJmFzLT5tKTsKLQlyZXR1cm4gSU1BUF9RVU9UQV9FWENFRURFRDsKKwlyZXR1cm4g
cjsKICAgICB9CiAKICAgICBpZiAodXNlcmlkKSB7CkBAIC0yNDIsMTEgKzI0MywxMyBAQAogLyog
bWF5IHJldHVybiBub24temVybywgaW5kaWNhdGluZyB0aGF0IHRoZSBlbnRpcmUgYXBwZW5kIGhh
cyBmYWlsZWQKICBhbmQgdGhlIG1haWxib3ggaXMgcHJvYmFibHkgaW4gYW4gaW5jb25zaXN0ZW50
IHN0YXRlLiAqLwogaW50IGFwcGVuZF9jb21taXQoc3RydWN0IGFwcGVuZHN0YXRlICphcywgCisJ
CSAgbG9uZyBxdW90YWNoZWNrLAogCQkgIHVuc2lnbmVkIGxvbmcgKnVpZHZhbGlkaXR5LCAKIAkJ
ICB1bnNpZ25lZCBsb25nICpzdGFydCwKIAkJICB1bnNpZ25lZCBsb25nICpudW0pCiB7CiAgICAg
aW50IHIgPSAwOworICAgIHN0cnVjdCB0eG4gKnRpZCA9IE5VTEw7CiAgICAgCiAgICAgaWYgKGFz
LT5zID09IEFQUEVORF9ET05FKSByZXR1cm4gMDsKIApAQCAtMzAyLDggKzMwNSwyMSBAQAogICAg
IH0KIAogICAgIC8qIFdyaXRlIG91dCBxdW90YSBmaWxlICovCi0gICAgYXMtPm0ucXVvdGEudXNl
ZCArPSBhcy0+cXVvdGFfdXNlZDsKLSAgICByID0gbWFpbGJveF93cml0ZV9xdW90YSgmYXMtPm0u
cXVvdGEpOworICAgIHIgPSBxdW90YV9yZWFkKCZhcy0+bS5xdW90YSwgJnRpZCwgMSk7CisgICAg
aWYgKCFyKSB7CisJaWYgKGFzLT5tLnF1b3RhLmxpbWl0ID49IDAgJiYgcXVvdGFjaGVjayA+PSAw
ICYmCisJICAgIGFzLT5tLnF1b3RhLnVzZWQgKyBxdW90YWNoZWNrID4gCisJICAgICgodW5zaWdu
ZWQpIGFzLT5tLnF1b3RhLmxpbWl0ICogUVVPVEFfVU5JVFMpKSB7CisJICAgIHF1b3RhX2Fib3J0
KCZ0aWQpOworCSAgICBhcHBlbmRfYWJvcnQoYXMpOworCSAgICByZXR1cm4gSU1BUF9RVU9UQV9F
WENFRURFRDsKKwl9CisKKwlhcy0+bS5xdW90YS51c2VkICs9IGFzLT5xdW90YV91c2VkOworCXIg
PSBxdW90YV93cml0ZSgmYXMtPm0ucXVvdGEsICZ0aWQpOworCWlmICghcikgcXVvdGFfY29tbWl0
KCZ0aWQpOworICAgIH0KKyAgICBlbHNlIGlmIChyID09IElNQVBfUVVPVEFST09UX05PTkVYSVNU
RU5UKSByID0gMDsKICAgICBpZiAocikgewogCXN5c2xvZyhMT0dfRVJSLAogCSAgICAgICAiTE9T
VFFVT1RBOiB1bmFibGUgdG8gcmVjb3JkIHVzZSBvZiAldSBieXRlcyBpbiBxdW90YSBmaWxlICVz
IiwKQEAgLTMxOCw3ICszMzQsNiBAQAogCWZyZWUoYXMtPnNlZW5fbXNncmFuZ2UpOwogICAgIH0K
IAotICAgIG1haWxib3hfdW5sb2NrX3F1b3RhKCZhcy0+bS5xdW90YSk7CiAgICAgbWFpbGJveF91
bmxvY2tfaW5kZXgoJmFzLT5tKTsKICAgICBtYWlsYm94X3VubG9ja19oZWFkZXIoJmFzLT5tKTsK
ICAgICBtYWlsYm94X2Nsb3NlKCZhcy0+bSk7CkBAIC0zNTYsNyArMzcxLDYgQEAKICAgICBmdHJ1
bmNhdGUoYXMtPm0uY2FjaGVfZmQsIGFzLT5vcmlnX2NhY2hlX2xlbik7CiAKICAgICAvKiB1bmxv
Y2sgbWFpbGJveCAqLwotICAgIG1haWxib3hfdW5sb2NrX3F1b3RhKCZhcy0+bS5xdW90YSk7CiAg
ICAgbWFpbGJveF91bmxvY2tfaW5kZXgoJmFzLT5tKTsKICAgICBtYWlsYm94X3VubG9ja19oZWFk
ZXIoJmFzLT5tKTsKICAgICBtYWlsYm94X2Nsb3NlKCZhcy0+bSk7CkluZGV4OiBpbWFwL2FwcGVu
ZC5oCj09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT0KUkNTIGZpbGU6IC9hZnMvYW5kcmV3L3N5c3RlbS9jdnMvc3JjL2N5cnVz
L2ltYXAvYXBwZW5kLmgsdgpyZXRyaWV2aW5nIHJldmlzaW9uIDEuMjQKZGlmZiAtdSAtcjEuMjQg
YXBwZW5kLmgKLS0tIGltYXAvYXBwZW5kLmgJMjIgT2N0IDIwMDMgMTg6NTA6MDcgLTAwMDAJMS4y
NAorKysgaW1hcC9hcHBlbmQuaAkxNiBEZWMgMjAwMyAyMTozMTo0OSAtMDAwMApAQCAtMTA3LDYg
KzEwNyw3IEBACiAJCQlsb25nIGFjbGNoZWNrLCBsb25nIHF1b3RhY2hlY2spOwogCiBleHRlcm4g
aW50IGFwcGVuZF9jb21taXQoc3RydWN0IGFwcGVuZHN0YXRlICptYWlsYm94LAorCQkJIGxvbmcg
cXVvdGFjaGVjaywKIAkJCSB1bnNpZ25lZCBsb25nICp1aWR2YWxpZGl0eSwgCiAJCQkgdW5zaWdu
ZWQgbG9uZyAqc3RhcnR1aWQsIAogCQkJIHVuc2lnbmVkIGxvbmcgKm51bSk7CkluZGV4OiBpbWFw
L2N0bF9jeXJ1c2RiLmMKPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PQpSQ1MgZmlsZTogL2Fmcy9hbmRyZXcvc3lzdGVtL2N2
cy9zcmMvY3lydXMvaW1hcC9jdGxfY3lydXNkYi5jLHYKcmV0cmlldmluZyByZXZpc2lvbiAxLjIw
CmRpZmYgLXUgLXIxLjIwIGN0bF9jeXJ1c2RiLmMKLS0tIGltYXAvY3RsX2N5cnVzZGIuYwkxNSBE
ZWMgMjAwMyAyMTowMjo0OSAtMDAwMAkxLjIwCisrKyBpbWFwL2N0bF9jeXJ1c2RiLmMJMTYgRGVj
IDIwMDMgMjE6MzE6NDkgLTAwMDAKQEAgLTk2LDYgKzk2LDcgQEAKICAgICBpbnQgYXJjaGl2ZTsK
IH0gZGJsaXN0W10gPSB7CiAgICAgeyBGTkFNRV9NQk9YTElTVCwJCSZjb25maWdfbWJveGxpc3Rf
ZGIsCTEgfSwKKyAgICB7IEZOQU1FX1FVT1RBREIsCQkmY29uZmlnX3F1b3RhX2RiLAkxIH0sCiAg
ICAgeyBGTkFNRV9BTk5PVEFUSU9OUywJJmNvbmZpZ19hbm5vdGF0aW9uX2RiLAkxIH0sCiAgICAg
eyBGTkFNRV9ERUxJVkVSREIsCQkmY29uZmlnX2R1cGxpY2F0ZV9kYiwJMCB9LAogICAgIHsgRk5B
TUVfVExTU0VTU0lPTlMsCSZjb25maWdfdGxzY2FjaGVfZGIsCTAgfSwKSW5kZXg6IGltYXAvY3ly
X2V4cGlyZS5jCj09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT0KUkNTIGZpbGU6IC9hZnMvYW5kcmV3L3N5c3RlbS9jdnMvc3Jj
L2N5cnVzL2ltYXAvY3lyX2V4cGlyZS5jLHYKcmV0cmlldmluZyByZXZpc2lvbiAxLjMKZGlmZiAt
dSAtcjEuMyBjeXJfZXhwaXJlLmMKLS0tIGltYXAvY3lyX2V4cGlyZS5jCTI0IE9jdCAyMDAzIDE4
OjI0OjA1IC0wMDAwCTEuMworKysgaW1hcC9jeXJfZXhwaXJlLmMJMTYgRGVjIDIwMDMgMjE6MzE6
NDkgLTAwMDAKQEAgLTIzOCw2ICsyMzgsMTAgQEAKICAgICBtYm94bGlzdF9pbml0KDApOwogICAg
IG1ib3hsaXN0X29wZW4oTlVMTCk7CiAKKyAgICAvKiBvcGVuIHRoZSBxdW90YSBkYiwgd2UnbGwg
bmVlZCBpdCBmb3IgZXhwdW5nZSAqLworICAgIHF1b3RhZGJfaW5pdCgwKTsKKyAgICBxdW90YWRi
X29wZW4oTlVMTCk7CisKICAgICBpZiAoZHVwbGljYXRlX2luaXQoTlVMTCwgMCkgIT0gMCkgewog
CWZwcmludGYoc3RkZXJyLCAKIAkJImN5cl9leHBpcmU6IHVuYWJsZSB0byBpbml0IGR1cGxpY2F0
ZSBkZWxpdmVyeSBkYXRhYmFzZVxuIik7CkBAIC0yNjUsNiArMjY5LDggQEAKIAogICAgIGZyZWVf
aGFzaF90YWJsZSgmZXhwaXJlX3RhYmxlLCBmcmVlKTsKIAorICAgIHF1b3RhZGJfY2xvc2UoKTsK
KyAgICBxdW90YWRiX2RvbmUoKTsKICAgICBtYm94bGlzdF9jbG9zZSgpOwogICAgIG1ib3hsaXN0
X2RvbmUoKTsKICAgICBhbm5vdGF0ZW1vcmVfY2xvc2UoKTsKSW5kZXg6IGltYXAvZ2xvYmFsLmMK
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PQpSQ1MgZmlsZTogL2Fmcy9hbmRyZXcvc3lzdGVtL2N2cy9zcmMvY3lydXMvaW1h
cC9nbG9iYWwuYyx2CnJldHJpZXZpbmcgcmV2aXNpb24gMS40CmRpZmYgLXUgLXIxLjQgZ2xvYmFs
LmMKLS0tIGltYXAvZ2xvYmFsLmMJMTUgRGVjIDIwMDMgMjI6NDI6MzcgLTAwMDAJMS40CisrKyBp
bWFwL2dsb2JhbC5jCTE2IERlYyAyMDAzIDIxOjMxOjQ5IC0wMDAwCkBAIC04Miw2ICs4Miw3IEBA
CiAKIGludCBjb25maWdfaW1wbGljaXRyaWdodHM7ICAgICAgICAvKiAibGNhIiAqLwogc3RydWN0
IGN5cnVzZGJfYmFja2VuZCAqY29uZmlnX21ib3hsaXN0X2RiOworc3RydWN0IGN5cnVzZGJfYmFj
a2VuZCAqY29uZmlnX3F1b3RhX2RiOwogc3RydWN0IGN5cnVzZGJfYmFja2VuZCAqY29uZmlnX3N1
YnNjcmlwdGlvbl9kYjsKIHN0cnVjdCBjeXJ1c2RiX2JhY2tlbmQgKmNvbmZpZ19hbm5vdGF0aW9u
X2RiOwogc3RydWN0IGN5cnVzZGJfYmFja2VuZCAqY29uZmlnX3NlZW5zdGF0ZV9kYjsKQEAgLTE2
Miw2ICsxNjMsOCBAQAogICAgIC8qIGxvb2t1cCB0aGUgZGF0YWJhc2UgYmFja2VuZHMgKi8KICAg
ICBjb25maWdfbWJveGxpc3RfZGIgPQogCWN5cnVzZGJfZnJvbW5hbWUoY29uZmlnX2dldHN0cmlu
ZyhJTUFQT1BUX01CT1hMSVNUX0RCKSk7CisgICAgY29uZmlnX3F1b3RhX2RiID0KKwljeXJ1c2Ri
X2Zyb21uYW1lKGNvbmZpZ19nZXRzdHJpbmcoSU1BUE9QVF9RVU9UQV9EQikpOwogICAgIGNvbmZp
Z19zdWJzY3JpcHRpb25fZGIgPQogCWN5cnVzZGJfZnJvbW5hbWUoY29uZmlnX2dldHN0cmluZyhJ
TUFQT1BUX1NVQlNDUklQVElPTl9EQikpOwogICAgIGNvbmZpZ19hbm5vdGF0aW9uX2RiID0KQEAg
LTE5Myw2ICsxOTYsOCBAQAogCQkJICAgICAgY29uZmlnX2dldHN3aXRjaChJTUFQT1BUX0ZVTExE
SVJIQVNIKSk7CiAgICAgbGliY3lydXNfY29uZmlnX3NldHN0cmluZyhDWVJVU09QVF9QVFNDQUNI
RV9EQiwKIAkJCSAgICAgIGNvbmZpZ19nZXRzdHJpbmcoSU1BUE9QVF9QVFNDQUNIRV9EQikpOwor
ICAgIGxpYmN5cnVzX2NvbmZpZ19zZXRzd2l0Y2goQ1lSVVNPUFRfVklSVERPTUFJTlMsCisJCQkg
ICAgICBjb25maWdfZ2V0c3dpdGNoKElNQVBPUFRfVklSVERPTUFJTlMpKTsKIAogICAgIC8qIE5v
dCB1bnRpbCBhbGwgY29uZmlndXJhdGlvbiBwYXJhbWV0ZXJzIGFyZSBzZXQhICovCiAgICAgbGli
Y3lydXNfaW5pdCgpOwpJbmRleDogaW1hcC9nbG9iYWwuaAo9PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09ClJDUyBmaWxlOiAv
YWZzL2FuZHJldy9zeXN0ZW0vY3ZzL3NyYy9jeXJ1cy9pbWFwL2dsb2JhbC5oLHYKcmV0cmlldmlu
ZyByZXZpc2lvbiAxLjMKZGlmZiAtdSAtcjEuMyBnbG9iYWwuaAotLS0gaW1hcC9nbG9iYWwuaAkx
NSBEZWMgMjAwMyAyMDowMDo0MCAtMDAwMAkxLjMKKysrIGltYXAvZ2xvYmFsLmgJMTYgRGVjIDIw
MDMgMjE6MzE6NDkgLTAwMDAKQEAgLTE0NCw2ICsxNDQsNyBAQAogLyogTWlzYyBnbG9iYWxzICov
CiBleHRlcm4gaW50IGNvbmZpZ19pbXBsaWNpdHJpZ2h0czsKIGV4dGVybiBzdHJ1Y3QgY3lydXNk
Yl9iYWNrZW5kICpjb25maWdfbWJveGxpc3RfZGI7CitleHRlcm4gc3RydWN0IGN5cnVzZGJfYmFj
a2VuZCAqY29uZmlnX3F1b3RhX2RiOwogZXh0ZXJuIHN0cnVjdCBjeXJ1c2RiX2JhY2tlbmQgKmNv
bmZpZ19zdWJzY3JpcHRpb25fZGI7CiBleHRlcm4gc3RydWN0IGN5cnVzZGJfYmFja2VuZCAqY29u
ZmlnX2Fubm90YXRpb25fZGI7CiBleHRlcm4gc3RydWN0IGN5cnVzZGJfYmFja2VuZCAqY29uZmln
X3NlZW5zdGF0ZV9kYjsKSW5kZXg6IGltYXAvaW1hcGQuYwo9PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09ClJDUyBmaWxlOiAv
YWZzL2FuZHJldy9zeXN0ZW0vY3ZzL3NyYy9jeXJ1cy9pbWFwL2ltYXBkLmMsdgpyZXRyaWV2aW5n
IHJldmlzaW9uIDEuNDQ4CmRpZmYgLXUgLXIxLjQ0OCBpbWFwZC5jCi0tLSBpbWFwL2ltYXBkLmMJ
NSBEZWMgMjAwMyAyMTozMzowNyAtMDAwMAkxLjQ0OAorKysgaW1hcC9pbWFwZC5jCTE2IERlYyAy
MDAzIDIxOjMxOjQ5IC0wMDAwCkBAIC04NCw2ICs4NCw3IEBACiAjaW5jbHVkZSAibWJkdW1wLmgi
CiAjaW5jbHVkZSAibWtnbXRpbWUuaCIKICNpbmNsdWRlICJtdXBkYXRlLWNsaWVudC5oIgorI2lu
Y2x1ZGUgInF1b3RhLmgiCiAjaW5jbHVkZSAidGVsZW1ldHJ5LmgiCiAjaW5jbHVkZSAidGxzLmgi
CiAjaW5jbHVkZSAidXNlci5oIgpAQCAtNDQzLDYgKzQ0NCwxMCBAQAogICAgIG1ib3hsaXN0X29w
ZW4oTlVMTCk7CiAgICAgbWFpbGJveF9pbml0aWFsaXplKCk7CiAKKyAgICAvKiBvcGVuIHRoZSBx
dW90YSBkYiwgd2UnbGwgbmVlZCBpdCBmb3IgcmVhbCB3b3JrICovCisgICAgcXVvdGFkYl9pbml0
KDApOworICAgIHF1b3RhZGJfb3BlbihOVUxMKTsKKwogICAgIC8qIHNldHVwIGZvciBzZW5kaW5n
IElNQVAgSURMRSBub3RpZmljYXRpb25zICovCiAgICAgaWRsZV9lbmFibGVkKCk7CiAKQEAgLTYy
MCw2ICs2MjUsOSBAQAogICAgIG1ib3hsaXN0X2Nsb3NlKCk7CiAgICAgbWJveGxpc3RfZG9uZSgp
OwogCisgICAgcXVvdGFkYl9jbG9zZSgpOworICAgIHF1b3RhZGJfZG9uZSgpOworCiAgICAgYW5u
b3RhdGVtb3JlX2Nsb3NlKCk7CiAgICAgYW5ub3RhdGVtb3JlX2RvbmUoKTsKIApAQCAtMjMwMyw3
ICsyMzExLDcgQEAKICAgICB9CiAKICAgICBpZiAoIXIpIHsKLQlyID0gYXBwZW5kX2NvbW1pdCgm
bWFpbGJveCwgJnVpZHZhbGlkaXR5LCAmZmlyc3R1aWQsICZudW0pOworCXIgPSBhcHBlbmRfY29t
bWl0KCZtYWlsYm94LCBzaXplLCAmdWlkdmFsaWRpdHksICZmaXJzdHVpZCwgJm51bSk7CiAgICAg
fSBlbHNlIHsKIAlhcHBlbmRfYWJvcnQoJm1haWxib3gpOwogICAgIH0KQEAgLTI0MDcsOCArMjQx
NSw4IEBACiAKICAgICBpZiAoaW1hcGRfbWFpbGJveC0+bXlyaWdodHMgJiBBQ0xfREVMRVRFKSB7
CiAJLyogV2FybiBpZiBtYWlsYm94IGlzIGNsb3NlIHRvIG9yIG92ZXIgcXVvdGEgKi8KLQltYWls
Ym94X3JlYWRfcXVvdGEoJmltYXBkX21haWxib3gtPnF1b3RhKTsKLQlpZiAoaW1hcGRfbWFpbGJv
eC0+cXVvdGEubGltaXQgPiAwKSB7CisJciA9IHF1b3RhX3JlYWQoJmltYXBkX21haWxib3gtPnF1
b3RhLCBOVUxMLCAwKTsKKwlpZiAoIXIgJiYgaW1hcGRfbWFpbGJveC0+cXVvdGEubGltaXQgPiAw
KSB7CiAgCSAgICAvKiBXYXJuIGlmIHRoZSBmb2xsb3dpbmcgcG9zc2liaWxpdGllcyBvY2N1cjoK
ICAJICAgICAqIC0gcXVvdGF3YXJua2Igbm90IHNldCArIHF1b3Rhd2FybiBoaXQKIAkgICAgICog
LSBxdW90YXdhcm5rYiBzZXQgbGFyZ2VyIHRoYW4gbWFpbGJveCArIHF1b3Rhd2FybiBoaXQKQEAg
LTQzOTQsMjIgKzQ0MDIsMTMgQEAKICAgICBjaGFyIGJ1ZltNQVhfTUFJTEJPWF9QQVRIKzFdOwog
ICAgIGNoYXIgbWFpbGJveG5hbWVbTUFYX01BSUxCT1hfTkFNRSsxXTsKIAotICAgIHF1b3RhLmZk
ID0gLTE7Ci0KICAgICBpZiAoIWltYXBkX3VzZXJpc2FkbWluKSByID0gSU1BUF9QRVJNSVNTSU9O
X0RFTklFRDsKICAgICBlbHNlIHsKIAlyID0gKCppbWFwZF9uYW1lc3BhY2UubWJveG5hbWVfdG9p
bnRlcm5hbCkoJmltYXBkX25hbWVzcGFjZSwgbmFtZSwKIAkJCQkJCSAgIGltYXBkX3VzZXJpZCwg
bWFpbGJveG5hbWUpOwogCWlmICghcikgewogCSAgICBxdW90YS5yb290ID0gbWFpbGJveG5hbWU7
Ci0JICAgIG1haWxib3hfaGFzaF9xdW90YShidWYsIHNpemVvZihidWYpLCBxdW90YS5yb290KTsK
LQkgICAgcXVvdGEuZmQgPSBvcGVuKGJ1ZiwgT19SRFdSLCAwKTsKLQkgICAgaWYgKHF1b3RhLmZk
ID09IC0xKSB7Ci0JCXIgPSBJTUFQX1FVT1RBUk9PVF9OT05FWElTVEVOVDsKLQkgICAgfQotCSAg
ICBlbHNlIHsKLQkJciA9IG1haWxib3hfcmVhZF9xdW90YSgmcXVvdGEpOwotCSAgICB9CisJICAg
IHIgPSBxdW90YV9yZWFkKCZxdW90YSwgTlVMTCwgMCk7CiAJfQogICAgIH0KICAgICAKQEAgLTQ0
MjQsMTAgKzQ0MjMsNiBAQAogCXByb3RfcHJpbnRmKGltYXBkX291dCwgIilcclxuIik7CiAgICAg
fQogCi0gICAgaWYgKHF1b3RhLmZkICE9IC0xKSB7Ci0JY2xvc2UocXVvdGEuZmQpOwotICAgIH0K
LQogICAgIGlmIChyKSB7CiAJcHJvdF9wcmludGYoaW1hcGRfb3V0LCAiJXMgTk8gJXNcclxuIiwg
dGFnLCBlcnJvcl9tZXNzYWdlKHIpKTsKIAlyZXR1cm47CkBAIC00NDgwLDcgKzQ0NzUsNyBAQAog
CQkJCQkJICAgaW1hcGRfdXNlcmlkLCBtYWlsYm94bmFtZSk7CiAJICAgIHByb3RfcHJpbnRmKGlt
YXBkX291dCwgIiAiKTsKIAkgICAgcHJpbnRhc3RyaW5nKG1haWxib3huYW1lKTsKLQkgICAgciA9
IG1haWxib3hfcmVhZF9xdW90YSgmbWFpbGJveC5xdW90YSk7CisJICAgIHIgPSBxdW90YV9yZWFk
KCZtYWlsYm94LnF1b3RhLCBOVUxMLCAwKTsKIAkgICAgaWYgKCFyKSB7CiAJCXByb3RfcHJpbnRm
KGltYXBkX291dCwgIlxyXG4qIFFVT1RBICIpOwogCQlwcmludGFzdHJpbmcobWFpbGJveG5hbWUp
OwpAQCAtNjQyOCwyNyArNjQyMywyMiBAQAogCSAgICBjaGFyIGJ1ZltNQVhfTUFJTEJPWF9QQVRI
KzFdOwogCSAgICBzdHJ1Y3QgcXVvdGEgcXVvdGE7CiAJICAgIAotCSAgICBxdW90YS5mZCA9IC0x
OwogCSAgICBxdW90YS5yb290ID0gbWFpbGJveG5hbWU7Ci0JICAgIG1haWxib3hfaGFzaF9xdW90
YShidWYsc2l6ZW9mKGJ1ZikscXVvdGEucm9vdCk7Ci0JICAgIHF1b3RhLmZkID0gb3BlbihidWYs
IE9fUkRXUiwgMCk7Ci0JICAgIGlmKHF1b3RhLmZkICE9IC0xKSB7CSAgICAKLQkJciA9IG1haWxi
b3hfcmVhZF9xdW90YSgmcXVvdGEpOwotCQljbG9zZShxdW90YS5mZCk7CisJICAgIHIgPSBxdW90
YV9yZWFkKCZxdW90YSwgTlVMTCwgMCk7CiAJICAgIAotCQlpZighcikgewotCQkgICAgLyogbm90
ZSB1c2Ugb2YgKyB0byBmb3JjZSB0aGUgc2V0dGluZyBvZiBhIG5vbmV4aXN0YW50Ci0JCSAgICAg
KiBxdW90YXJvb3QgKi8KLQkJICAgIHByb3RfcHJpbnRmKGJlLT5vdXQsICJRMDEgU0VUUVVPVEEg
eyVkK31cclxuIiBcCi0JCQkJICAgICAgICAgIislcyAoU1RPUkFHRSAlZClcclxuIiwKLQkJCQlz
dHJsZW4obmFtZSkrMSwgbmFtZSwgcXVvdGEubGltaXQpOwotCQkgICAgciA9IGdldHJlc3VsdChi
ZS0+aW4sICJRMDEiKTsKLQkJICAgIGlmKHIpIHN5c2xvZyhMT0dfRVJSLAotCQkJCSAiQ291bGQg
bm90IG1vdmUgbWFpbGJveDogJXMsICIgXAotCQkJCSAiZmFpbGVkIHNldHRpbmcgaW5pdGlhbCBx
dW90YSByb290XHJcbiIsCi0JCQkJIG1haWxib3huYW1lKTsKLQkJfQorCSAgICBpZighcikgewor
CQkvKiBub3RlIHVzZSBvZiArIHRvIGZvcmNlIHRoZSBzZXR0aW5nIG9mIGEgbm9uZXhpc3RhbnQK
KwkJICogcXVvdGFyb290ICovCisJCXByb3RfcHJpbnRmKGJlLT5vdXQsICJRMDEgU0VUUVVPVEEg
eyVkK31cclxuIiBcCisJCQkgICAgIislcyAoU1RPUkFHRSAlZClcclxuIiwKKwkJCSAgICBzdHJs
ZW4obmFtZSkrMSwgbmFtZSwgcXVvdGEubGltaXQpOworCQlyID0gZ2V0cmVzdWx0KGJlLT5pbiwg
IlEwMSIpOworCQlpZihyKSBzeXNsb2coTE9HX0VSUiwKKwkJCSAgICAgIkNvdWxkIG5vdCBtb3Zl
IG1haWxib3g6ICVzLCAiIFwKKwkJCSAgICAgImZhaWxlZCBzZXR0aW5nIGluaXRpYWwgcXVvdGEg
cm9vdFxyXG4iLAorCQkJICAgICBtYWlsYm94bmFtZSk7CiAJICAgIH0KKwkgICAgZWxzZSBpZiAo
ciA9PSBJTUFQX1FVT1RBUk9PVF9OT05FWElTVEVOVCkgciA9IDA7CiAJfQogCiAKSW5kZXg6IGlt
YXAvaW5kZXguYwo9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09ClJDUyBmaWxlOiAvYWZzL2FuZHJldy9zeXN0ZW0vY3ZzL3Ny
Yy9jeXJ1cy9pbWFwL2luZGV4LmMsdgpyZXRyaWV2aW5nIHJldmlzaW9uIDEuMjAxCmRpZmYgLXUg
LXIxLjIwMSBpbmRleC5jCi0tLSBpbWFwL2luZGV4LmMJMjIgT2N0IDIwMDMgMjA6MDU6MTIgLTAw
MDAJMS4yMDEKKysrIGltYXAvaW5kZXguYwkxNiBEZWMgMjAwMyAyMTozMTo0OSAtMDAwMApAQCAt
MTE3Nyw3ICsxMTc3LDggQEAKIAogICAgIHIgPSBhcHBlbmRfY29weShtYWlsYm94LCAmYXBwZW5k
X21haWxib3gsIGNvcHlhcmdzLm51bW1zZywKIAkJICAgIGNvcHlhcmdzLmNvcHltc2cpOwotICAg
IGlmICghcikgYXBwZW5kX2NvbW1pdCgmYXBwZW5kX21haWxib3gsICZ1aWR2YWxpZGl0eSwgJnN0
YXJ0dWlkLCAmbnVtKTsKKyAgICBpZiAoIXIpIGFwcGVuZF9jb21taXQoJmFwcGVuZF9tYWlsYm94
LCB0b3RhbHNpemUsCisJCQkgICZ1aWR2YWxpZGl0eSwgJnN0YXJ0dWlkLCAmbnVtKTsKICAgICBp
ZiAoIXIpIHsKIAljb3B5dWlkX3NpemUgPSAxMDI0OwogCWNvcHl1aWQgPSB4bWFsbG9jKGNvcHl1
aWRfc2l6ZSk7CkluZGV4OiBpbWFwL2lwdXJnZS5jCj09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KUkNTIGZpbGU6IC9hZnMv
YW5kcmV3L3N5c3RlbS9jdnMvc3JjL2N5cnVzL2ltYXAvaXB1cmdlLmMsdgpyZXRyaWV2aW5nIHJl
dmlzaW9uIDEuMjEKZGlmZiAtdSAtcjEuMjEgaXB1cmdlLmMKLS0tIGltYXAvaXB1cmdlLmMJMjAg
Tm92IDIwMDMgMTg6NDc6NDYgLTAwMDAJMS4yMQorKysgaW1hcC9pcHVyZ2UuYwkxNiBEZWMgMjAw
MyAyMTozMTo0OSAtMDAwMApAQCAtMTgwLDYgKzE4MCwxMCBAQAogICBtYm94bGlzdF9pbml0KDAp
OwogICBtYm94bGlzdF9vcGVuKE5VTEwpOwogCisgIC8qIG9wZW4gdGhlIHF1b3RhIGRiLCB3ZSds
bCBuZWVkIGl0IGZvciBleHB1bmdlICovCisgIHF1b3RhZGJfaW5pdCgwKTsKKyAgcXVvdGFkYl9v
cGVuKE5VTEwpOworCiAgIGlmIChvcHRpbmQgPT0gYXJnYykgeyAvKiBkbyB0aGUgd2hvbGUgcGFy
dGl0aW9uICovCiAgICAgc3RyY3B5KGJ1ZiwgIioiKTsKICAgICAoKnB1cmdlX25hbWVzcGFjZS5t
Ym94bGlzdF9maW5kYWxsKSgmcHVyZ2VfbmFtZXNwYWNlLCBidWYsIDEsIDAsIDAsCkBAIC0xOTUs
NiArMTk5LDkgQEAKIAkJCQkJICBwdXJnZV9tZSwgTlVMTCk7CiAgICAgfQogICB9CisgIHF1b3Rh
ZGJfY2xvc2UoKTsKKyAgcXVvdGFkYl9kb25lKCk7CisKICAgbWJveGxpc3RfY2xvc2UoKTsKICAg
bWJveGxpc3RfZG9uZSgpOwogCkluZGV4OiBpbWFwL2xtdHBkLmMKPT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQpSQ1MgZmls
ZTogL2Fmcy9hbmRyZXcvc3lzdGVtL2N2cy9zcmMvY3lydXMvaW1hcC9sbXRwZC5jLHYKcmV0cmll
dmluZyByZXZpc2lvbiAxLjEyNQpkaWZmIC11IC1yMS4xMjUgbG10cGQuYwotLS0gaW1hcC9sbXRw
ZC5jCTE2IERlYyAyMDAzIDIwOjM2OjU1IC0wMDAwCTEuMTI1CisrKyBpbWFwL2xtdHBkLmMJMTYg
RGVjIDIwMDMgMjE6MzE6NDkgLTAwMDAKQEAgLTIzMCw2ICsyMzAsMTAgQEAKICAgICBtYm94bGlz
dF9pbml0KDApOwogICAgIG1ib3hsaXN0X29wZW4oTlVMTCk7CiAKKyAgICAvKiBzbyB3ZSBjYW4g
ZG8gcXVvdGEgb3BlcmF0aW9ucyAqLworICAgIHF1b3RhZGJfaW5pdCgwKTsKKyAgICBxdW90YWRi
X29wZW4oTlVMTCk7CisKICAgICAvKiBzZXR1cCBmb3Igc2VuZGluZyBJTUFQIElETEUgbm90aWZp
Y2F0aW9ucyAqLwogICAgIGlkbGVfZW5hYmxlZCgpOwogCkBAIC0xMDc2LDcgKzEwODAsNyBAQAog
CSAgICByID0gYXBwZW5kX2Zyb21zdHJlYW0oJmFzLCBtc2csIHNpemUsIG5vdywgCiAJCQkJICAo
Y29uc3QgY2hhciAqKikgZmxhZywgbmZsYWdzKTsKIAl9Ci0JaWYgKCFyKSBhcHBlbmRfY29tbWl0
KCZhcywgTlVMTCwgJnVpZCwgTlVMTCk7CisJaWYgKCFyKSBhcHBlbmRfY29tbWl0KCZhcywgcXVv
dGFvdmVycmlkZSA/IC0xIDogMCwgTlVMTCwgJnVpZCwgTlVMTCk7CiAJZWxzZSBhcHBlbmRfYWJv
cnQoJmFzKTsKICAgICB9CiAKQEAgLTEyNzUsNiArMTI3OSw5IEBACiAKICAgICBtYm94bGlzdF9j
bG9zZSgpOwogICAgIG1ib3hsaXN0X2RvbmUoKTsKKworICAgIHF1b3RhZGJfY2xvc2UoKTsKKyAg
ICBxdW90YWRiX2RvbmUoKTsKICNpZmRlZiBIQVZFX1NTTAogICAgIHRsc19zaHV0ZG93bl9zZXJ2
ZXJlbmdpbmUoKTsKICNlbmRpZgpJbmRleDogaW1hcC9tYWlsYm94LmMKPT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQpSQ1Mg
ZmlsZTogL2Fmcy9hbmRyZXcvc3lzdGVtL2N2cy9zcmMvY3lydXMvaW1hcC9tYWlsYm94LmMsdgpy
ZXRyaWV2aW5nIHJldmlzaW9uIDEuMTUwCmRpZmYgLXUgLXIxLjE1MCBtYWlsYm94LmMKLS0tIGlt
YXAvbWFpbGJveC5jCTQgTm92IDIwMDMgMjE6NDM6MjIgLTAwMDAJMS4xNTAKKysrIGltYXAvbWFp
bGJveC5jCTE2IERlYyAyMDAzIDIxOjMxOjQ5IC0wMDAwCkBAIC01MiwxNCArNTIsNiBAQAogI2lu
Y2x1ZGUgPHN0cmluZy5oPgogI2luY2x1ZGUgPGVycm5vLmg+CiAjaW5jbHVkZSA8c3lzbG9nLmg+
Ci0jaW5jbHVkZSA8c3lzL3R5cGVzLmg+Ci0jaW5jbHVkZSA8ZmNudGwuaD4KLSNpbmNsdWRlIDxu
ZXRpbmV0L2luLmg+Ci0jaW5jbHVkZSA8c3lzL3VuLmg+Ci0jaW5jbHVkZSA8c3lzL3NvY2tldC5o
PgotI2luY2x1ZGUgPHN5cy90eXBlcy5oPgotI2luY2x1ZGUgPHN5cy9zdGF0Lmg+Ci0jaW5jbHVk
ZSA8Y3R5cGUuaD4KICNpbmNsdWRlIDxjb21fZXJyLmg+CiAKICNpZmRlZiBIQVZFX0RJUkVOVF9I
CkBAIC00MTYsNyArNDA4LDYgQEAKICAgICBpbnQgcjsKIAogICAgIHplcm9tYWlsYm94KCptYWls
Ym94KTsKLSAgICBtYWlsYm94LT5xdW90YS5mZCA9IC0xOwogCiAgICAgc3RybGNweShmbmFtZWJ1
ZiwgcGF0aCwgc2l6ZW9mKGZuYW1lYnVmKSk7CiAgICAgc3RybGNhdChmbmFtZWJ1ZiwgRk5BTUVf
SEVBREVSLCBzaXplb2YoZm5hbWVidWYpKTsKQEAgLTU4NSwxMCArNTc2LDYgQEAKIAltYXBfZnJl
ZSgmbWFpbGJveC0+Y2FjaGVfYmFzZSwgJm1haWxib3gtPmNhY2hlX2xlbik7CiAgICAgfQogCi0g
ICAgaWYgKG1haWxib3gtPnF1b3RhLmZkICE9IC0xKSB7Ci0JY2xvc2UobWFpbGJveC0+cXVvdGEu
ZmQpOwotICAgIH0KLQkKICAgICBmcmVlKG1haWxib3gtPm5hbWUpOwogICAgIGZyZWUobWFpbGJv
eC0+cGF0aCk7CiAgICAgZnJlZShtYWlsYm94LT5hY2wpOwpAQCAtNjAwLDcgKzU4Nyw2IEBACiAg
ICAgfQogCiAgICAgemVyb21haWxib3goKm1haWxib3gpOwotICAgIG1haWxib3gtPnF1b3RhLmZk
ID0gLTE7CiB9CiAKIC8qCkBAIC02MzMsMTUgKzYxOSw2IEBACiAJdGFiID0gZW9sOwogICAgIH0K
ICAgICBpZiAobWFpbGJveC0+cXVvdGEucm9vdCkgewotCS8qIGNoZWNrIGlmIHRoaXMgaXMgdGhl
IHNhbWUgYXMgd2hhdCdzIHRoZXJlICovCi0JaWYgKHN0cmxlbihtYWlsYm94LT5xdW90YS5yb290
KSAhPSAoc2l6ZV90KSh0YWItcCkgfHwKLQkgICAgc3RybmNtcChtYWlsYm94LT5xdW90YS5yb290
LCBwLCB0YWItcCkgIT0gMCkgewotCSAgICBhc3NlcnQobWFpbGJveC0+cXVvdGEubG9ja19jb3Vu
dCA9PSAwKTsKLQkgICAgaWYgKG1haWxib3gtPnF1b3RhLmZkICE9IC0xKSB7Ci0JCWNsb3NlKG1h
aWxib3gtPnF1b3RhLmZkKTsKLQkgICAgfQotCSAgICBtYWlsYm94LT5xdW90YS5mZCA9IC0xOwot
CX0KIAlmcmVlKG1haWxib3gtPnF1b3RhLnJvb3QpOwogICAgIH0KICAgICBpZiAocCA8IHRhYikg
ewpAQCAtOTI2LDU3ICs5MDMsNiBAQAogfQogCiAvKgotICogT3BlbiBhbmQgcmVhZCB0aGUgcXVv
dGEgZmlsZSAncXVvdGEnCi0gKi8KLWludAotbWFpbGJveF9yZWFkX3F1b3RhKHF1b3RhKQotc3Ry
dWN0IHF1b3RhICpxdW90YTsKLXsKLSAgICBjb25zdCBjaGFyICpwLCAqZW9sOwotICAgIGNoYXIg
YnVmW01BWF9NQUlMQk9YX1BBVEgrMV07Ci0gICAgY29uc3QgY2hhciAqcXVvdGFfYmFzZSA9IDA7
Ci0gICAgdW5zaWduZWQgbG9uZyBxdW90YV9sZW4gPSAwOwotCi0KLSAgICBpZiAoIXF1b3RhLT5y
b290KSB7Ci0JcXVvdGEtPnVzZWQgPSAwOwotCXF1b3RhLT5saW1pdCA9IC0xOwotCXJldHVybiAw
OwotICAgIH0KLQotICAgIGlmIChxdW90YS0+ZmQgPT0gLTEpIHsKLQltYWlsYm94X2hhc2hfcXVv
dGEoYnVmLCBzaXplb2YoYnVmKSwgcXVvdGEtPnJvb3QpOwotCXF1b3RhLT5mZCA9IG9wZW4oYnVm
LCBPX1JEV1IsIDApOwotCWlmIChxdW90YS0+ZmQgPT0gLTEpIHsKLQkgICAgc3lzbG9nKExPR19F
UlIsICJJT0VSUk9SOiBvcGVuaW5nIHF1b3RhIGZpbGUgJXM6ICVtIiwgYnVmKTsKLQkgICAgcmV0
dXJuIElNQVBfSU9FUlJPUjsKLQl9Ci0gICAgfQotICAgIAotICAgIG1hcF9yZWZyZXNoKHF1b3Rh
LT5mZCwgMSwgJnF1b3RhX2Jhc2UsICZxdW90YV9sZW4sCi0JCU1BUF9VTktOT1dOX0xFTiwgYnVm
LCAwKTsKLQotICAgIHAgPSBxdW90YV9iYXNlOwotICAgIGVvbCA9IG1lbWNocihwLCAnXG4nLCBx
dW90YV9sZW4gLSAocCAtIHF1b3RhX2Jhc2UpKTsKLSAgICBpZiAoIWVvbCkgewotCW1hcF9mcmVl
KCZxdW90YV9iYXNlLCAmcXVvdGFfbGVuKTsKLQlyZXR1cm4gSU1BUF9NQUlMQk9YX0JBREZPUk1B
VDsKLSAgICB9Ci0gICAgcXVvdGEtPnVzZWQgPSBhdG9sKHApOwotCi0gICAgcCA9IGVvbCArIDE7
Ci0gICAgZW9sID0gbWVtY2hyKHAsICdcbicsIHF1b3RhX2xlbiAtIChwIC0gcXVvdGFfYmFzZSkp
OwotICAgIGlmICghZW9sKSB7Ci0JbWFwX2ZyZWUoJnF1b3RhX2Jhc2UsICZxdW90YV9sZW4pOwot
CXJldHVybiBJTUFQX01BSUxCT1hfQkFERk9STUFUOwotICAgIH0KLSAgICBxdW90YS0+bGltaXQg
PSBhdG9pKHApOwotCi0gICAgbWFwX2ZyZWUoJnF1b3RhX2Jhc2UsICZxdW90YV9sZW4pOwotICAg
IHJldHVybiAwOwotfQotCi0vKgogICogTG9jayB0aGUgaGVhZGVyIGZvciAnbWFpbGJveCcuICBS
ZXJlYWQgaGVhZGVyIGlmIG5lY2Vzc2FyeS4KICAqLwogaW50CkBAIC05OTEsNyArOTE3LDYgQEAK
ICAgICBpZiAobWFpbGJveC0+aGVhZGVyX2xvY2tfY291bnQrKykgcmV0dXJuIDA7CiAKICAgICBh
c3NlcnQobWFpbGJveC0+aW5kZXhfbG9ja19jb3VudCA9PSAwKTsKLSAgICBhc3NlcnQobWFpbGJv
eC0+cXVvdGEubG9ja19jb3VudCA9PSAwKTsKICAgICBhc3NlcnQobWFpbGJveC0+c2Vlbl9sb2Nr
X2NvdW50ID09IDApOwogCiAgICAgc3RybGNweShmbmFtZWJ1ZiwgbWFpbGJveC0+cGF0aCwgc2l6
ZW9mKGZuYW1lYnVmKSk7CkBAIC0xMDM0LDcgKzk1OSw2IEBACiAKICAgICBpZiAobWFpbGJveC0+
aW5kZXhfbG9ja19jb3VudCsrKSByZXR1cm4gMDsKIAotICAgIGFzc2VydChtYWlsYm94LT5xdW90
YS5sb2NrX2NvdW50ID09IDApOwogICAgIGFzc2VydChtYWlsYm94LT5zZWVuX2xvY2tfY291bnQg
PT0gMCk7CiAKICAgICBzdHJsY3B5KGZuYW1lYnVmLCBtYWlsYm94LT5wYXRoLCBzaXplb2YoZm5h
bWVidWYpKTsKQEAgLTExMDcsNTAgKzEwMzEsNiBAQAogfQogCiAvKgotICogTG9jayB0aGUgcXVv
dGEgZmlsZSAncXVvdGEnLiAgUmVyZWFkIHF1b3RhIGZpbGUgaWYgbmVjZXNzYXJ5LgotICovCi1p
bnQKLW1haWxib3hfbG9ja19xdW90YShxdW90YSkKLXN0cnVjdCBxdW90YSAqcXVvdGE7Ci17Ci0g
ICAgY2hhciBxdW90YV9wYXRoW01BWF9NQUlMQk9YX1BBVEgrMV07Ci0gICAgc3RydWN0IHN0YXQg
c2J1ZjsKLSAgICBjb25zdCBjaGFyICpsb2NrZmFpbGFjdGlvbjsKLSAgICBpbnQgcjsKLQotICAg
IC8qIGFzc2VydChtYWlsYm94LT5oZWFkZXJfbG9ja19jb3VudCAhPSAwKTsgKi8KLQotICAgIGlm
IChxdW90YS0+bG9ja19jb3VudCsrKSByZXR1cm4gMDsKLQotICAgIC8qIGFzc2VydChtYWlsYm94
LT5zZWVuX2xvY2tfY291bnQgPT0gMCk7ICovCi0KLSAgICBpZiAoIXF1b3RhLT5yb290KSB7Ci0J
cXVvdGEtPnVzZWQgPSAwOwotCXF1b3RhLT5saW1pdCA9IC0xOwotCXJldHVybiAwOwotICAgIH0K
LSAgICBtYWlsYm94X2hhc2hfcXVvdGEocXVvdGFfcGF0aCwgc2l6ZW9mKHF1b3RhX3BhdGgpLCBx
dW90YS0+cm9vdCk7Ci0gICAgaWYgKHF1b3RhLT5mZCA9PSAtMSkgewotCXF1b3RhLT5mZCA9IG9w
ZW4ocXVvdGFfcGF0aCwgT19SRFdSLCAwKTsKLQlpZiAocXVvdGEtPmZkID09IC0xKSB7Ci0JICAg
IHN5c2xvZyhMT0dfRVJSLCAiSU9FUlJPUjogb3BlbmluZyBxdW90YSBmaWxlICVzOiAlbSIsCi0J
CSAgIHF1b3RhX3BhdGgpOwotCSAgICByZXR1cm4gSU1BUF9JT0VSUk9SOwotCX0KLSAgICB9Ci0K
LSAgICByID0gbG9ja19yZW9wZW4ocXVvdGEtPmZkLCBxdW90YV9wYXRoLCAmc2J1ZiwgJmxvY2tm
YWlsYWN0aW9uKTsKLSAgICBpZiAociA9PSAtMSkgewotCXF1b3RhLT5sb2NrX2NvdW50LS07Ci0J
c3lzbG9nKExPR19FUlIsICJJT0VSUk9SOiAlcyBxdW90YSAlczogJW0iLCBsb2NrZmFpbGFjdGlv
biwKLQkgICAgICAgcXVvdGEtPnJvb3QpOwotCXJldHVybiBJTUFQX0lPRVJST1I7Ci0gICAgfQot
Ci0gICAgcmV0dXJuIG1haWxib3hfcmVhZF9xdW90YShxdW90YSk7Ci19Ci0KLS8qCiAgKiBSZWxl
YXNlIGxvY2sgb24gdGhlIGhlYWRlciBmb3IgJ21haWxib3gnCiAgKi8KIHZvaWQgbWFpbGJveF91
bmxvY2tfaGVhZGVyKHN0cnVjdCBtYWlsYm94ICptYWlsYm94KQpAQCAtMTE5NywyMiArMTA3Nyw2
IEBACiB9CiAKIC8qCi0gKiBSZWxlYXNlIGxvY2sgb24gdGhlIHF1b3RhIGZpbGUgJ3F1b3RhJwot
ICovCi12b2lkCi1tYWlsYm94X3VubG9ja19xdW90YShxdW90YSkKLXN0cnVjdCBxdW90YSAqcXVv
dGE7Ci17Ci0gICAgYXNzZXJ0KHF1b3RhLT5sb2NrX2NvdW50ICE9IDApOwotCi0gICAgaWYgKC0t
cXVvdGEtPmxvY2tfY291bnQgPT0gMCAmJiBxdW90YS0+cm9vdCkgewotCWlmIChsb2NrX3VubG9j
ayhxdW90YS0+ZmQpKQotCSAgICBzeXNsb2coTE9HX0VSUiwgIklPRVJST1I6IHVubG9ja2luZyBx
dW90YSBmb3IgJXM6ICVtIiwgCi0JCXF1b3RhLT5yb290KTsKLSAgICB9Ci19Ci0KLS8qCiAgKiBX
cml0ZSB0aGUgaGVhZGVyIGZpbGUgZm9yICdtYWlsYm94JwogICovCiBpbnQgbWFpbGJveF93cml0
ZV9oZWFkZXIoc3RydWN0IG1haWxib3ggKm1haWxib3gpCkBAIC0xNDUzLDEwMiArMTMxNyw2IEBA
CiB9CiAKIC8qCi0gKiBXcml0ZSBvdXQgdGhlIHF1b3RhICdxdW90YScKLSAqLwotaW50IG1haWxi
b3hfd3JpdGVfcXVvdGEoc3RydWN0IHF1b3RhICpxdW90YSkKLXsKLSAgICBpbnQgcjsKLSAgICBp
bnQgbGVuOwotICAgIGNoYXIgYnVmWzEwMjRdOwotICAgIGNoYXIgcXVvdGFfcGF0aFtNQVhfTUFJ
TEJPWF9QQVRIKzFdOwotICAgIGNoYXIgbmV3X3F1b3RhX3BhdGhbTUFYX01BSUxCT1hfUEFUSCsx
XTsKLSAgICBpbnQgbmV3ZmQ7Ci0KLSAgICBhc3NlcnQocXVvdGEtPmxvY2tfY291bnQgIT0gMCk7
Ci0KLSAgICBpZiAoIXF1b3RhLT5yb290KSByZXR1cm4gMDsKLQotICAgIG1haWxib3hfaGFzaF9x
dW90YShxdW90YV9wYXRoLCBzaXplb2YocXVvdGFfcGF0aCksIHF1b3RhLT5yb290KTsKLQotICAg
IHN0cmxjcHkobmV3X3F1b3RhX3BhdGgsIHF1b3RhX3BhdGgsIHNpemVvZihuZXdfcXVvdGFfcGF0
aCkpOwotICAgIHN0cmxjYXQobmV3X3F1b3RhX3BhdGgsICIuTkVXIiwgc2l6ZW9mKG5ld19xdW90
YV9wYXRoKSk7Ci0KLSAgICBuZXdmZCA9IG9wZW4obmV3X3F1b3RhX3BhdGgsIE9fQ1JFQVQgfCBP
X1RSVU5DIHwgT19SRFdSLCAwNjY2KTsKLSAgICBpZiAobmV3ZmQgPT0gLTEgJiYgZXJybm8gPT0g
RU5PRU5UKSB7Ci0JaWYgKGN5cnVzX21rZGlyKG5ld19xdW90YV9wYXRoLCAwNzU1KSA9PSAtMSkg
cmV0dXJuIElNQVBfSU9FUlJPUjsKLQotCW5ld2ZkID0gb3BlbihuZXdfcXVvdGFfcGF0aCwgT19D
UkVBVCB8IE9fVFJVTkMgfCBPX1JEV1IsIDA2NjYpOwotICAgIH0KLSAgICBpZiAobmV3ZmQgPT0g
LTEpIHsKLQlzeXNsb2coTE9HX0VSUiwgIklPRVJST1I6IGNyZWF0aW5nIHF1b3RhIGZpbGUgJXM6
ICVtIiwgbmV3X3F1b3RhX3BhdGgpOwotCXJldHVybiBJTUFQX0lPRVJST1I7Ci0gICAgfQotCi0g
ICAgciA9IGxvY2tfYmxvY2tpbmcobmV3ZmQpOwotICAgIGlmIChyKSB7Ci0Jc3lzbG9nKExPR19F
UlIsICJJT0VSUk9SOiBsb2NraW5nIHF1b3RhIGZpbGUgJXM6ICVtIiwKLQkgICAgICAgbmV3X3F1
b3RhX3BhdGgpOwotCWNsb3NlKG5ld2ZkKTsKLQlyZXR1cm4gSU1BUF9JT0VSUk9SOwotICAgIH0K
LQotICAgIGxlbiA9IHNucHJpbnRmKGJ1Ziwgc2l6ZW9mKGJ1ZikgLSAxLAotCQkgICAiJWx1XG4l
ZFxuIiwgcXVvdGEtPnVzZWQsIHF1b3RhLT5saW1pdCk7Ci0gICAgciA9IHdyaXRlKG5ld2ZkLCBi
dWYsIGxlbik7Ci0gICAgCi0gICAgaWYgKHIgPT0gLTEgfHwgZnN5bmMobmV3ZmQpKSB7Ci0Jc3lz
bG9nKExPR19FUlIsICJJT0VSUk9SOiB3cml0aW5nIHF1b3RhIGZpbGUgJXM6ICVtIiwKLQkgICAg
ICAgbmV3X3F1b3RhX3BhdGgpOwotCWNsb3NlKG5ld2ZkKTsKLQlyZXR1cm4gSU1BUF9JT0VSUk9S
OwotICAgIH0KLQotICAgIGlmIChyZW5hbWUobmV3X3F1b3RhX3BhdGgsIHF1b3RhX3BhdGgpKSB7
Ci0Jc3lzbG9nKExPR19FUlIsICJJT0VSUk9SOiByZW5hbWluZyBxdW90YSBmaWxlICVzOiAlbSIs
Ci0JICAgICAgIHF1b3RhX3BhdGgpOwotCWNsb3NlKG5ld2ZkKTsKLQlyZXR1cm4gSU1BUF9JT0VS
Uk9SOwotICAgIH0KLQotICAgIGlmIChxdW90YS0+ZmQgIT0gLTEpIHsKLQljbG9zZShxdW90YS0+
ZmQpOwotCXF1b3RhLT5mZCA9IC0xOwotICAgIH0KLQotICAgIHF1b3RhLT5mZCA9IG5ld2ZkOwot
Ci0gICAgcmV0dXJuIDA7Ci19Ci0KLS8qCi0gKiBSZW1vdmUgdGhlIHF1b3RhIHJvb3QgJ3F1b3Rh
JwotICovCi1pbnQKLW1haWxib3hfZGVsZXRlX3F1b3RhKHF1b3RhKQotc3RydWN0IHF1b3RhICpx
dW90YTsKLXsKLSAgICBjaGFyIHF1b3RhX3BhdGhbTUFYX01BSUxCT1hfUEFUSCsxXTsKLQotICAg
IGFzc2VydChxdW90YS0+bG9ja19jb3VudCAhPSAwKTsKLQotICAgIGlmICghcXVvdGEtPnJvb3Qp
IHJldHVybiAwOwotCi0gICAgbWFpbGJveF9oYXNoX3F1b3RhKHF1b3RhX3BhdGgsIHNpemVvZihx
dW90YV9wYXRoKSwgcXVvdGEtPnJvb3QpOwotCi0gICAgdW5saW5rKHF1b3RhX3BhdGgpOwotCi0g
ICAgaWYgKHF1b3RhLT5mZCAhPSAtMSkgewotCWNsb3NlKHF1b3RhLT5mZCk7Ci0JcXVvdGEtPmZk
ID0gLTE7Ci0gICAgfQotCi0gICAgZnJlZShxdW90YS0+cm9vdCk7Ci0gICAgcXVvdGEtPnJvb3Qg
PSAwOwotCi0gICAgcmV0dXJuIDA7Ci19Ci0KLS8qCiAgKiBMb2NrIHRoZSBpbmRleCBmaWxlIGZv
ciAnbWFpbGJveCcuCiAgKiBET04nVCBSZXJlYWQgaW5kZXggZmlsZSBoZWFkZXIgaWYgbmVjZXNz
YXJ5LgogICovCkBAIC0xNTYwLDcgKzEzMjgsNiBAQAogCiAgICAgaWYgKG1haWxib3gtPmluZGV4
X2xvY2tfY291bnQrKykgcmV0dXJuIDA7CiAKLSAgICBhc3NlcnQobWFpbGJveC0+cXVvdGEubG9j
a19jb3VudCA9PSAwKTsKICAgICBhc3NlcnQobWFpbGJveC0+c2Vlbl9sb2NrX2NvdW50ID09IDAp
OwogCiAgICAgc3RybGNweShmbmFtZWJ1ZiwgbWFpbGJveC0+cGF0aCwgc2l6ZW9mKGZuYW1lYnVm
KSk7CkBAIC0xODUwLDYgKzE2MTcsNyBAQAogICAgIHVuc2lnbmVkIG1zZ25vOwogICAgIHN0cnVj
dCBzdGF0IHNidWY7CiAgICAgY2hhciAqZm5hbWV0YWlsOworICAgIHN0cnVjdCB0eG4gKnRpZCA9
IE5VTEw7CiAKICAgICAvKiBPZmZzZXQgaW50byB0aGUgbmV3IGNhY2hlIGZpbGUgZm9yIHVzZSB3
aGVuIHVwZGF0aW5nIHRoZSBpbmRleCByZWNvcmQgKi8KICAgICBzaXplX3QgbmV3X2NhY2hlX3Rv
dGFsX3NpemUgPSBzaXplb2YoYml0MzIpOwpAQCAtMjA3OSwyMSArMTg0NywyMyBAQAogICAgIH0K
IAogICAgIC8qIFJlY29yZCBxdW90YSByZWxlYXNlICovCi0gICAgciA9IG1haWxib3hfbG9ja19x
dW90YSgmbWFpbGJveC0+cXVvdGEpOwotICAgIGlmIChyKSBnb3RvIGZhaWw7Ci0gICAgaWYgKG1h
aWxib3gtPnF1b3RhLnVzZWQgPj0gcXVvdGFkZWxldGVkKSB7Ci0JbWFpbGJveC0+cXVvdGEudXNl
ZCAtPSBxdW90YWRlbGV0ZWQ7Ci0gICAgfQotICAgIGVsc2UgewotCW1haWxib3gtPnF1b3RhLnVz
ZWQgPSAwOwotICAgIH0KLSAgICByID0gbWFpbGJveF93cml0ZV9xdW90YSgmbWFpbGJveC0+cXVv
dGEpOwotICAgIGlmIChyKSB7Ci0Jc3lzbG9nKExPR19FUlIsCi0JICAgICAgICJMT1NUUVVPVEE6
IHVuYWJsZSB0byByZWNvcmQgZnJlZSBvZiAldSBieXRlcyBpbiBxdW90YSAlcyIsCi0JICAgICAg
IHF1b3RhZGVsZXRlZCwgbWFpbGJveC0+cXVvdGEucm9vdCk7CisgICAgciA9IHF1b3RhX3JlYWQo
Jm1haWxib3gtPnF1b3RhLCAmdGlkLCAxKTsKKyAgICBpZiAoIXIpIHsKKwlpZiAobWFpbGJveC0+
cXVvdGEudXNlZCA+PSBxdW90YWRlbGV0ZWQpIHsKKwkgICAgbWFpbGJveC0+cXVvdGEudXNlZCAt
PSBxdW90YWRlbGV0ZWQ7CisJfQorCWVsc2UgeworCSAgICBtYWlsYm94LT5xdW90YS51c2VkID0g
MDsKKwl9CisJciA9IHF1b3RhX3dyaXRlKCZtYWlsYm94LT5xdW90YSwgJnRpZCk7CisJaWYgKCFy
KSBxdW90YV9jb21taXQoJnRpZCk7CisJZWxzZSB7CisJICAgIHN5c2xvZyhMT0dfRVJSLAorCQkg
ICAiTE9TVFFVT1RBOiB1bmFibGUgdG8gcmVjb3JkIGZyZWUgb2YgJXUgYnl0ZXMgaW4gcXVvdGEg
JXMiLAorCQkgICBxdW90YWRlbGV0ZWQsIG1haWxib3gtPnF1b3RhLnJvb3QpOworCX0KICAgICB9
Ci0gICAgbWFpbGJveF91bmxvY2tfcXVvdGEoJm1haWxib3gtPnF1b3RhKTsKKyAgICBlbHNlIGlm
IChyICE9IElNQVBfUVVPVEFST09UX05PTkVYSVNURU5UKSBnb3RvIGZhaWw7CiAKICAgICBzdHJs
Y3B5KGZuYW1lYnVmLCBtYWlsYm94LT5wYXRoLCBzaXplb2YoZm5hbWVidWYpKTsKIApAQCAtMjE2
OCw0MCArMTkzOCw2IEBACiAgICAgcmV0dXJuIElNQVBfSU9FUlJPUjsKIH0KIAotLyogZmluZCB0
aGUgbWFpbGJveCAnbmFtZScgJ3MgcXVvdGFyb290LCBhbmQgcmV0dXJuIGl0IGluICdzdGFydCcu
Ci0gICAnc3RhcnQnIG11c3QgYmUgYXQgbGVhc3QgTUFYX01BSUxCT1hfUEFUSC4gCi0KLSAgIHJl
dHVybnMgdHJ1ZSBpZiBhIHF1b3Rhcm9vdCBpcyBmb3VuZCwgMCBvdGhlcndpc2UuIAotKi8KLWlu
dCBtYWlsYm94X2ZpbmRxdW90YShjaGFyICpyZXQsIHNpemVfdCByZXRsZW4sIGNvbnN0IGNoYXIg
Km5hbWUpCi17Ci0gICAgY2hhciBxdW90YV9wYXRoW01BWF9NQUlMQk9YX1BBVEgrMV07Ci0gICAg
Y2hhciAqdGFpbCwgKnAsICptYm94OwotICAgIHN0cnVjdCBzdGF0IHNidWY7Ci0KLSAgICBzdHJs
Y3B5KHJldCwgbmFtZSwgcmV0bGVuKTsKLQotICAgIC8qIGZpbmQgdGhlIHN0YXJ0IG9mIHRoZSB1
bnF1YWxpZmllZCBtYWlsYm94IG5hbWUgKi8KLSAgICBtYm94ID0gKGNvbmZpZ192aXJ0ZG9tYWlu
cyAmJiAocCA9IHN0cmNocihyZXQsICchJykpKSA/IHArMSA6IHJldDsKLSAgICB0YWlsID0gbWJv
eCArIHN0cmxlbihtYm94KTsKLQotICAgIG1haWxib3hfaGFzaF9xdW90YShxdW90YV9wYXRoLCBz
aXplb2YocXVvdGFfcGF0aCksIHJldCk7Ci0gICAgd2hpbGUgKHN0YXQocXVvdGFfcGF0aCwgJnNi
dWYpID09IC0xKSB7Ci0JdGFpbCA9IHN0cnJjaHIobWJveCwgJy4nKTsKLQlpZiAoIXRhaWwpIGJy
ZWFrOwotCSp0YWlsID0gJ1wwJzsKLQltYWlsYm94X2hhc2hfcXVvdGEocXVvdGFfcGF0aCwgc2l6
ZW9mKHF1b3RhX3BhdGgpLCByZXQpOwotICAgIH0KLSAgICBpZiAodGFpbCkgcmV0dXJuIDE7Ci0g
ICAgaWYgKG1ib3ggPT0gcmV0KSByZXR1cm4gMDsKLQotICAgIC8qIGNoZWNrIGZvciBhIGRvbWFp
biBxdW90YSAqLwotICAgICptYm94ID0gJ1wwJzsKLSAgICBtYWlsYm94X2hhc2hfcXVvdGEocXVv
dGFfcGF0aCwgc2l6ZW9mKHF1b3RhX3BhdGgpLCByZXQpOwotICAgIHJldHVybiAoc3RhdChxdW90
YV9wYXRoLCAmc2J1ZikgIT0gLTEpOwotfQotCi0KIGludCBtYWlsYm94X2NyZWF0ZShjb25zdCBj
aGFyICpuYW1lLAogCQkgICBjaGFyICpwYXRoLAogCQkgICBjb25zdCBjaGFyICphY2wsCkBAIC0y
MjMyLDkgKzE5NjgsOCBAQAogICAgIH0KIAogICAgIHplcm9tYWlsYm94KG1haWxib3gpOwotICAg
IG1haWxib3gucXVvdGEuZmQgPSAtMTsKIAotICAgIGhhc3F1b3RhID0gbWFpbGJveF9maW5kcXVv
dGEocXVvdGFfcm9vdCwgc2l6ZW9mKHF1b3RhX3Jvb3QpLCBuYW1lKTsKKyAgICBoYXNxdW90YSA9
IHF1b3RhX2ZpbmRyb290KHF1b3RhX3Jvb3QsIHNpemVvZihxdW90YV9yb290KSwgbmFtZSk7CiAK
ICAgICAvKiBTZXQgdXAgYnVmZmVyICovCiAgICAgc3RybGNweShmbmFtZWJ1ZiwgcGF0aCwgc2l6
ZW9mKGZuYW1lYnVmKSk7CkBAIC0yMzcwLDE2ICsyMTA1LDE5IEBACiAgICAgc3RydWN0IGRpcmVu
dCAqZjsKICAgICBjaGFyIGJ1ZltNQVhfTUFJTEJPWF9QQVRIKzFdOwogICAgIGNoYXIgKnRhaWw7
CisgICAgc3RydWN0IHR4biAqdGlkID0gTlVMTDsKICAgICAKICAgICAvKiBFbnN1cmUgdGhhdCB3
ZSBhcmUgbG9ja2VkICovCiAgICAgaWYoIW1haWxib3gtPmhlYWRlcl9sb2NrX2NvdW50KSByZXR1
cm4gSU1BUF9JTlRFUk5BTDsKIAotICAgIHJxdW90YSA9IG1haWxib3hfbG9ja19xdW90YSgmbWFp
bGJveC0+cXVvdGEpOworICAgIHJxdW90YSA9IHF1b3RhX3JlYWQoJm1haWxib3gtPnF1b3RhLCAm
dGlkLCAxKTsKIAogICAgIHNlZW5fZGVsZXRlX21haWxib3gobWFpbGJveCk7CiAKICAgICBpZiAo
ZGVsZXRlX3F1b3RhX3Jvb3QgJiYgIXJxdW90YSkgewotCW1haWxib3hfZGVsZXRlX3F1b3RhKCZt
YWlsYm94LT5xdW90YSk7CisJcXVvdGFfZGVsZXRlKCZtYWlsYm94LT5xdW90YSwgJnRpZCk7CisJ
ZnJlZShtYWlsYm94LT5xdW90YS5yb290KTsKKwltYWlsYm94LT5xdW90YS5yb290ID0gTlVMTDsK
ICAgICB9IGVsc2UgaWYgKCFycXVvdGEpIHsKIAkvKiBGcmVlIGFueSBxdW90YSBiZWluZyB1c2Vk
IGJ5IHRoaXMgbWFpbGJveCAqLwogCWlmIChtYWlsYm94LT5xdW90YS51c2VkID49IG1haWxib3gt
PnF1b3RhX21haWxib3hfdXNlZCkgewpAQCAtMjM4OCwxMyArMjEyNiwxNCBAQAogCWVsc2Ugewog
CSAgICBtYWlsYm94LT5xdW90YS51c2VkID0gMDsKIAl9Ci0JciA9IG1haWxib3hfd3JpdGVfcXVv
dGEoJm1haWxib3gtPnF1b3RhKTsKKwlyID0gcXVvdGFfd3JpdGUoJm1haWxib3gtPnF1b3RhLCAm
dGlkKTsKIAlpZiAocikgewogCSAgICBzeXNsb2coTE9HX0VSUiwKIAkJICAgIkxPU1RRVU9UQTog
dW5hYmxlIHRvIHJlY29yZCBmcmVlIG9mICVsdSBieXRlcyBpbiBxdW90YSAlcyIsCiAJCSAgIG1h
aWxib3gtPnF1b3RhX21haWxib3hfdXNlZCwgbWFpbGJveC0+cXVvdGEucm9vdCk7CiAJfQotCW1h
aWxib3hfdW5sb2NrX3F1b3RhKCZtYWlsYm94LT5xdW90YSk7CisJZWxzZQorCSAgICBxdW90YV9j
b21taXQoJnRpZCk7CiAgICAgfQogCiAgICAgLyogcmVtb3ZlIGFsbCBmaWxlcyBpbiBkaXJlY3Rv
cnkgKi8KQEAgLTI0NjksNiArMjIwOCw3IEBACiAgICAgY2hhciBvbGRmbmFtZVtNQVhfTUFJTEJP
WF9QQVRIKzFdLCBuZXdmbmFtZVtNQVhfTUFJTEJPWF9QQVRIKzFdOwogICAgIHNpemVfdCBvbGRm
bmFtZV9sZW4sIG5ld2ZuYW1lX2xlbiwgZm5fbGVuOwogICAgIGNoYXIgKm9sZGZuYW1ldGFpbCwg
Km5ld2ZuYW1ldGFpbDsKKyAgICBzdHJ1Y3QgdHhuICp0aWQgPSBOVUxMOwogCiAgICAgYXNzZXJ0
KG9sZG1haWxib3gtPmhlYWRlcl9sb2NrX2NvdW50ID4gMAogCSAgICYmIG9sZG1haWxib3gtPmlu
ZGV4X2xvY2tfY291bnQgPiAwKTsKQEAgLTI1MDIsNyArMjI0Miw3IEBACiAKICAgICAvKiBDaGVj
ayBxdW90YSBpZiBuZWNlc3NhcnkgKi8KICAgICBpZiAobmV3bWFpbGJveC0+cXVvdGEucm9vdCkg
ewotCXIgPSBtYWlsYm94X2xvY2tfcXVvdGEoJihuZXdtYWlsYm94LT5xdW90YSkpOworCXIgPSBx
dW90YV9yZWFkKCYobmV3bWFpbGJveC0+cXVvdGEpLCAmdGlkLCAxKTsKIAlpZiAoIW9sZG1haWxi
b3gtPnF1b3RhLnJvb3QgfHwKIAkgICAgc3RyY21wKG9sZG1haWxib3gtPnF1b3RhLnJvb3QsIG5l
d21haWxib3gtPnF1b3RhLnJvb3QpICE9IDApIHsKIAkgICAgaWYgKCFyICYmIG5ld21haWxib3gt
PnF1b3RhLmxpbWl0ID49IDAgJiYKQEAgLTI1MTEsNyArMjI1MSw3IEBACiAJCXIgPSBJTUFQX1FV
T1RBX0VYQ0VFREVEOwogCSAgICB9CiAJfQotCWlmIChyKSB7CisJaWYgKHIgJiYgciAhPSBJTUFQ
X1FVT1RBUk9PVF9OT05FWElTVEVOVCkgewogCSAgICBtYWlsYm94X2Nsb3NlKG5ld21haWxib3gp
OwogCSAgICByZXR1cm4gcjsKIAl9CkBAIC0yNjAzLDggKzIzNDMsOCBAQAogICAgIC8qIFJlY29y
ZCBuZXcgcXVvdGEgdXNhZ2UgKi8KICAgICBpZiAoIXIgJiYgbmV3bWFpbGJveC0+cXVvdGEucm9v
dCkgewogCW5ld21haWxib3gtPnF1b3RhLnVzZWQgKz0gb2xkbWFpbGJveC0+cXVvdGFfbWFpbGJv
eF91c2VkOwotCXIgPSBtYWlsYm94X3dyaXRlX3F1b3RhKCYobmV3bWFpbGJveC0+cXVvdGEpKTsK
LQltYWlsYm94X3VubG9ja19xdW90YSgmKG5ld21haWxib3gtPnF1b3RhKSk7CisJciA9IHF1b3Rh
X3dyaXRlKCYobmV3bWFpbGJveC0+cXVvdGEpLCAmdGlkKTsKKwlpZiAoIXIpIHF1b3RhX2NvbW1p
dCgmdGlkKTsKICAgICB9CiAgICAgaWYgKHIpIHsKIAkvKiBmYWlsdXJlIGFuZCBiYWNrIG91dCAq
LwpAQCAtMjY1OCw2ICsyMzk4LDcgQEAKICAgICBjaGFyIG9sZGZuYW1lW01BWF9NQUlMQk9YX1BB
VEgrMV0sIG5ld2ZuYW1lW01BWF9NQUlMQk9YX1BBVEgrMV07CiAgICAgc2l6ZV90IG9sZGZuYW1l
X2xlbiwgbmV3Zm5hbWVfbGVuLCBmbl9sZW47CiAgICAgY2hhciAqb2xkZm5hbWV0YWlsLCAqbmV3
Zm5hbWV0YWlsOworICAgIHN0cnVjdCB0eG4gKnRpZCA9IE5VTEw7CiAKICAgICAvKiBPcGVuIG9s
ZCBtYWlsYm94IGFuZCBsb2NrICovCiAgICAgbWFpbGJveF9vcGVuX2hlYWRlcl9wYXRoKG9sZG5h
bWUsIG9sZHBhdGgsIG9sZGFjbCwgMCwgJm9sZG1haWxib3gsIDApOwpAQCAtMjcxNSw3ICsyNDU2
LDcgQEAKIAogICAgIC8qIENoZWNrIHF1b3RhIGlmIG5lY2Vzc2FyeSAqLwogICAgIGlmIChuZXdt
YWlsYm94LnF1b3RhLnJvb3QpIHsKLQlyID0gbWFpbGJveF9sb2NrX3F1b3RhKCZuZXdtYWlsYm94
LnF1b3RhKTsKKwlyID0gcXVvdGFfcmVhZCgmbmV3bWFpbGJveC5xdW90YSwgJnRpZCwgMSk7CiAJ
aWYgKCFvbGRtYWlsYm94LnF1b3RhLnJvb3QgfHwKIAkgICAgc3RyY21wKG9sZG1haWxib3gucXVv
dGEucm9vdCwgbmV3bWFpbGJveC5xdW90YS5yb290KSAhPSAwKSB7CiAJICAgIGlmICghciAmJiBu
ZXdtYWlsYm94LnF1b3RhLmxpbWl0ID49IDAgJiYKQEAgLTI3MjQsNyArMjQ2NSw3IEBACiAJCXIg
PSBJTUFQX1FVT1RBX0VYQ0VFREVEOwogCSAgICB9CiAJfQotCWlmIChyKSB7CisJaWYgKHIgJiYg
ciAhPSBJTUFQX1FVT1RBUk9PVF9OT05FWElTVEVOVCkgewogCSAgICBtYWlsYm94X2Nsb3NlKCZu
ZXdtYWlsYm94KTsKIAkgICAgbWFpbGJveF9jbG9zZSgmb2xkbWFpbGJveCk7CiAJICAgIHJldHVy
biByOwpAQCAtMjg1NywxOCArMjU5OCwyMCBAQAogICAgIC8qIFJlY29yZCBuZXcgcXVvdGEgdXNh
Z2UgKi8KICAgICBpZiAoIXIgJiYgbmV3bWFpbGJveC5xdW90YS5yb290KSB7CiAJbmV3bWFpbGJv
eC5xdW90YS51c2VkICs9IG9sZG1haWxib3gucXVvdGFfbWFpbGJveF91c2VkOwotCXIgPSBtYWls
Ym94X3dyaXRlX3F1b3RhKCZuZXdtYWlsYm94LnF1b3RhKTsKLQltYWlsYm94X3VubG9ja19xdW90
YSgmbmV3bWFpbGJveC5xdW90YSk7CisJciA9IHF1b3RhX3dyaXRlKCZuZXdtYWlsYm94LnF1b3Rh
LCAmdGlkKTsKKwlpZiAoIXIpIHF1b3RhX2NvbW1pdCgmdGlkKTsKKwl0aWQgPSBOVUxMOwogICAg
IH0KICAgICBpZiAocikgZ290byBmYWlsOwogCiAgICAgaWYgKHIgJiYgbmV3bWFpbGJveC5xdW90
YS5yb290KSB7Ci0JcjIgPSBtYWlsYm94X2xvY2tfcXVvdGEoJm5ld21haWxib3gucXVvdGEpOwor
CXIyID0gcXVvdGFfcmVhZCgmbmV3bWFpbGJveC5xdW90YSwgJnRpZCwgMSk7CiAJbmV3bWFpbGJv
eC5xdW90YS51c2VkICs9IG5ld21haWxib3gucXVvdGFfbWFpbGJveF91c2VkOwogCWlmICghcjIp
IHsKLQkgICAgcjIgPSBtYWlsYm94X3dyaXRlX3F1b3RhKCZuZXdtYWlsYm94LnF1b3RhKTsKLQkg
ICAgbWFpbGJveF91bmxvY2tfcXVvdGEoJm5ld21haWxib3gucXVvdGEpOworCSAgICByMiA9IHF1
b3RhX3dyaXRlKCZuZXdtYWlsYm94LnF1b3RhLCAmdGlkKTsKKwkgICAgaWYgKCFyMikgcXVvdGFf
Y29tbWl0KCZ0aWQpOwogCX0KKwllbHNlIGlmIChyMiA9PSBJTUFQX1FVT1RBUk9PVF9OT05FWElT
VEVOVCkgcjIgPSAwOwogCWlmIChyMikgewogCSAgICBzeXNsb2coTE9HX0VSUiwKIAkgICAgICAi
TE9TVFFVT1RBOiB1bmFibGUgdG8gcmVjb3JkIHVzZSBvZiAlbHUgYnl0ZXMgaW4gcXVvdGEgJXMi
LApAQCAtMzAwMyw1MiArMjc0Niw1IEBACiAgICAgLyogY2hhbmdlIGFsbCAnLidzIHRvICcvJyAq
LwogICAgIGZvciAocCA9IGJ1ZjsgKnA7IHArKykgewogCWlmICgqcCA9PSAnLicpICpwID0gJy8n
OwotICAgIH0KLX0KLQotLyogc2ltcGxlIGhhc2ggc28gaXQncyBlYXN5IHRvIGZpbmQgdGhlc2Ug
dGhpbmdzIGluIHRoZSBmaWxlc3lzdGVtOwotICAgb3VyIGh1bWFuIHRpbWUgaXMgd29ydGggbW9y
ZSB0aGFuIGVmZmljaWVuY3kgKi8KLXZvaWQgbWFpbGJveF9oYXNoX3F1b3RhKGNoYXIgKmJ1Ziwg
c2l6ZV90IHNpemUsIGNvbnN0IGNoYXIgKnFyKSB7Ci0gICAgY29uc3QgY2hhciAqaWR4OwotICAg
IGNoYXIgYywgKnA7Ci0gICAgdW5zaWduZWQgbGVuOwotCi0gICAgaWYgKChsZW4gPSBzbnByaW50
ZihidWYsIHNpemUsICIlcyIsIGNvbmZpZ19kaXIpKSA+PSBzaXplKSB7Ci0gICAgICAgIGZhdGFs
KCJpbnN1ZmZpY2llbnQgYnVmZmVyIHNpemUgaW4gbWFpbGJveF9oYXNoX3F1b3RhIiwgRUNfVEVN
UEZBSUwpOwotICAgIH0KLSAgICBidWYgKz0gbGVuOwotICAgIHNpemUgLT0gbGVuOwotCi0gICAg
aWYgKGNvbmZpZ192aXJ0ZG9tYWlucyAmJiAocCA9IHN0cmNocihxciwgJyEnKSkpIHsKLQkqcCA9
ICdcMCc7ICAvKiBzcGxpdCBkb21haW4hcXIgKi8KLQljID0gKGNoYXIpIGRpcl9oYXNoX2MocXIp
OwotCWlmICgobGVuID0gc25wcmludGYoYnVmLCBzaXplLCAiJXMlYy8lcyIsIEZOQU1FX0RPTUFJ
TkRJUiwgYywgcXIpKSA+PSBzaXplKSB7Ci0JICAgIGZhdGFsKCJpbnN1ZmZpY2llbnQgYnVmZmVy
IHNpemUgaW4gbWFpbGJveF9oYXNoX3F1b3RhIiwgRUNfVEVNUEZBSUwpOwotCX0KLQkqcCsrID0g
JyEnOyAgLyogcmVhc3NlbWJsZSBkb21haW4hcXIgKi8KLQlxciA9IHA7Ci0JYnVmICs9IGxlbjsK
LQlzaXplIC09IGxlbjsKLQotCWlmICghKnFyKSB7Ci0JICAgIC8qIHF1b3RhIGZvciBlbnRpcmUg
ZG9tYWluICovCi0JICAgIGlmIChzbnByaW50ZihidWYsIHNpemUsICIlc3Jvb3QiLCBGTkFNRV9R
VU9UQURJUikgPj0gc2l6ZSkgewotCQlmYXRhbCgiaW5zdWZmaWNpZW50IGJ1ZmZlciBzaXplIGlu
IG1haWxib3hfaGFzaF9xdW90YSIsCi0JCSAgICAgIEVDX1RFTVBGQUlMKTsKLQkgICAgfQotCSAg
ICByZXR1cm47Ci0JfQotICAgIH0KLQotICAgIGlkeCA9IHN0cmNocihxciwgJy4nKTsgLyogc2tp
cCBwYXN0IHVzZXIuICovCi0gICAgaWYgKGlkeCA9PSBOVUxMKSB7Ci0JaWR4ID0gcXI7Ci0gICAg
fSBlbHNlIHsKLQlpZHgrKzsKLSAgICB9Ci0gICAgYyA9IChjaGFyKSBkaXJfaGFzaF9jKGlkeCk7
Ci0KLSAgICBpZiAoc25wcmludGYoYnVmLCBzaXplLCAiJXMlYy8lcyIsIEZOQU1FX1FVT1RBRElS
LCBjLCBxcikgPj0gc2l6ZSkgewotCWZhdGFsKCJpbnN1ZmZpY2llbnQgYnVmZmVyIHNpemUgaW4g
bWFpbGJveF9oYXNoX3F1b3RhIiwgRUNfVEVNUEZBSUwpOwogICAgIH0KIH0KSW5kZXg6IGltYXAv
bWFpbGJveC5oCj09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT0KUkNTIGZpbGU6IC9hZnMvYW5kcmV3L3N5c3RlbS9jdnMvc3Jj
L2N5cnVzL2ltYXAvbWFpbGJveC5oLHYKcmV0cmlldmluZyByZXZpc2lvbiAxLjc4CmRpZmYgLXUg
LXIxLjc4IG1haWxib3guaAotLS0gaW1hcC9tYWlsYm94LmgJMjcgT2N0IDIwMDMgMjE6NTM6NTEg
LTAwMDAJMS43OAorKysgaW1hcC9tYWlsYm94LmgJMTYgRGVjIDIwMDMgMjE6MzE6NDkgLTAwMDAK
QEAgLTQ3LDYgKzQ3LDcgQEAKICNpbmNsdWRlIDxsaW1pdHMuaD4KIAogI2luY2x1ZGUgImF1dGgu
aCIKKyNpbmNsdWRlICJxdW90YS5oIgogCiAjZGVmaW5lIEJJVDMyX01BWCA0Mjk0OTY3Mjk1VQog
CkBAIC03OSwyMyArODAsOSBAQAogI2RlZmluZSBGTkFNRV9JTkRFWCAiL2N5cnVzLmluZGV4Igog
I2RlZmluZSBGTkFNRV9DQUNIRSAiL2N5cnVzLmNhY2hlIgogI2RlZmluZSBGTkFNRV9TUVVBVF9J
TkRFWCAiL2N5cnVzLnNxdWF0IgotI2RlZmluZSBGTkFNRV9RVU9UQURJUiAiL3F1b3RhLyIKIAog
I2RlZmluZSBNQUlMQk9YX0ZOQU1FX0xFTiAyNTYKIAotI2RlZmluZSBRVU9UQV9VTklUUyAoMTAy
NCkKLQotc3RydWN0IHF1b3RhIHsKLSAgICBpbnQgZmQ7Ci0KLSAgICBpbnQgbG9ja19jb3VudDsK
LSAgICBjaGFyICpyb290OwotCi0gICAgLyogSW5mb3JtYXRpb24gaW4gcXVvdGEgZmlsZSAqLwot
ICAgIHVuc2lnbmVkIGxvbmcgdXNlZDsKLSAgICBpbnQgbGltaXQ7CQkJLyogaW4gUVVPVEFfVU5J
VFMgKi8KLX07Ci0KIHN0cnVjdCBtYWlsYm94IHsKICAgICBpbnQgaGVhZGVyX2ZkOwogICAgIGlu
dCBpbmRleF9mZDsKQEAgLTI4NiwxNyArMjczLDEzIEBACiBleHRlcm4gaW50IG1haWxib3hfcmVh
ZF9pbmRleF9yZWNvcmQoc3RydWN0IG1haWxib3ggKm1haWxib3gsCiAJCQkJICAgICB1bnNpZ25l
ZCBtc2dubywKIAkJCQkgICAgIHN0cnVjdCBpbmRleF9yZWNvcmQgKnJlY29yZCk7Ci1leHRlcm4g
aW50IG1haWxib3hfcmVhZF9xdW90YShzdHJ1Y3QgcXVvdGEgKnF1b3RhKTsKLWV4dGVybiB2b2lk
IG1haWxib3hfaGFzaF9xdW90YShjaGFyICpidWYsIHNpemVfdCBzaXplLCBjb25zdCBjaGFyICpx
cik7CiBleHRlcm4gaW50IG1haWxib3hfbG9ja19oZWFkZXIoc3RydWN0IG1haWxib3ggKm1haWxi
b3gpOwogZXh0ZXJuIGludCBtYWlsYm94X2xvY2tfaW5kZXgoc3RydWN0IG1haWxib3ggKm1haWxi
b3gpOwogZXh0ZXJuIGludCBtYWlsYm94X2xvY2tfcG9wKHN0cnVjdCBtYWlsYm94ICptYWlsYm94
KTsKLWV4dGVybiBpbnQgbWFpbGJveF9sb2NrX3F1b3RhKHN0cnVjdCBxdW90YSAqcXVvdGEpOwog
CiBleHRlcm4gdm9pZCBtYWlsYm94X3VubG9ja19oZWFkZXIoc3RydWN0IG1haWxib3ggKm1haWxi
b3gpOwogZXh0ZXJuIHZvaWQgbWFpbGJveF91bmxvY2tfaW5kZXgoc3RydWN0IG1haWxib3ggKm1h
aWxib3gpOwogZXh0ZXJuIHZvaWQgbWFpbGJveF91bmxvY2tfcG9wKHN0cnVjdCBtYWlsYm94ICpt
YWlsYm94KTsKLWV4dGVybiB2b2lkIG1haWxib3hfdW5sb2NrX3F1b3RhKHN0cnVjdCBxdW90YSAq
cXVvdGEpOwogCiBleHRlcm4gaW50IG1haWxib3hfd3JpdGVfaGVhZGVyKHN0cnVjdCBtYWlsYm94
ICptYWlsYm94KTsKIGV4dGVybiBpbnQgbWFpbGJveF93cml0ZV9pbmRleF9oZWFkZXIoc3RydWN0
IG1haWxib3ggKm1haWxib3gpOwpAQCAtMzA3LDkgKzI5MCw2IEBACiBleHRlcm4gaW50IG1haWxi
b3hfYXBwZW5kX2luZGV4KHN0cnVjdCBtYWlsYm94ICptYWlsYm94LAogCQkJCXN0cnVjdCBpbmRl
eF9yZWNvcmQgKnJlY29yZCwKIAkJCQl1bnNpZ25lZCBzdGFydCwgdW5zaWduZWQgbnVtLCBpbnQg
c3luYyk7Ci1leHRlcm4gaW50IG1haWxib3hfd3JpdGVfcXVvdGEoc3RydWN0IHF1b3RhICpxdW90
YSk7Ci0KLWV4dGVybiBpbnQgbWFpbGJveF9kZWxldGVfcXVvdGEoc3RydWN0IHF1b3RhICpxdW90
YSk7CiAKIGV4dGVybiBpbnQgbWFpbGJveF9leHB1bmdlKHN0cnVjdCBtYWlsYm94ICptYWlsYm94
LAogCQkJICAgaW50IGlzY3VycmVudGRpciwKQEAgLTMxNyw3ICsyOTcsNiBAQAogCQkJICAgdm9p
ZCAqZGVjaWRlcm9jayk7CiBleHRlcm4gaW50IG1haWxib3hfZXhwdW5nZW5ld3Moc3RydWN0IG1h
aWxib3ggKm1haWxib3gpOwogCi1leHRlcm4gaW50IG1haWxib3hfZmluZHF1b3RhKGNoYXIgKnJl
dCwgc2l6ZV90IHJldGxlbiwgY29uc3QgY2hhciAqbmFtZSk7CiBleHRlcm4gdm9pZCBtYWlsYm94
X21ha2VfdW5pcXVlaWQoY2hhciAqbmFtZSwgdW5zaWduZWQgbG9uZyB1aWR2YWxpZGl0eSwKIAkJ
CQkgIGNoYXIgKnVuaXF1ZWlkLCBzaXplX3Qgb3V0bGVuKTsKIApJbmRleDogaW1hcC9tYmR1bXAu
Ywo9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09ClJDUyBmaWxlOiAvYWZzL2FuZHJldy9zeXN0ZW0vY3ZzL3NyYy9jeXJ1cy9p
bWFwL21iZHVtcC5jLHYKcmV0cmlldmluZyByZXZpc2lvbiAxLjI3CmRpZmYgLXUgLXIxLjI3IG1i
ZHVtcC5jCi0tLSBpbWFwL21iZHVtcC5jCTI0IE9jdCAyMDAzIDE3OjMxOjQ5IC0wMDAwCTEuMjcK
KysrIGltYXAvbWJkdW1wLmMJMTYgRGVjIDIwMDMgMjE6MzE6NDkgLTAwMDAKQEAgLTcxLDYgKzcx
LDcgQEAKICNpbmNsdWRlICJtYmR1bXAuaCIKICNpbmNsdWRlICJtYm94bGlzdC5oIgogI2luY2x1
ZGUgInByb3QuaCIKKyNpbmNsdWRlICJxdW90YS5oIgogI2luY2x1ZGUgInNlZW4uaCIKICNpbmNs
dWRlICJ4bWFsbG9jLmgiCiAjaW5jbHVkZSAidXRpbC5oIgpAQCAtMjE2LDIxICsyMTcsMTEgQEAK
ICAgICAvKiBUaGUgZmlyc3QgbWVtYmVyIGlzIGVpdGhlciBhIG51bWJlciAoaWYgaXQgaXMgYSBx
dW90YSByb290KSwgb3IgTklMCiAgICAgICogKGlmIGl0IGlzbid0KSAqLwogICAgIHsKLQljaGFy
IGJ1ZltNQVhfTUFJTEJPWF9QQVRIKzFdOwogCXN0cnVjdCBxdW90YSBxdW90YTsKIAotCXF1b3Rh
LmZkID0gLTE7CiAJcXVvdGEucm9vdCA9IChjaGFyICopbWJuYW1lOyAvKiB4eHggKi8KLQltYWls
Ym94X2hhc2hfcXVvdGEoYnVmLHNpemVvZihidWYpLHF1b3RhLnJvb3QpOwotCXF1b3RhLmZkID0g
b3BlbihidWYsIE9fUkRXUiwgMCk7Ci0JaWYocXVvdGEuZmQgPT0gLTEpIHsKLQkgICAgcHJvdF9w
cmludGYocG91dCwgIk5JTCAiKTsKLQkgICAgZ290byBkdW1wX2ZpbGVzOwotCX0KLQotCXIgPSBt
YWlsYm94X3JlYWRfcXVvdGEoJnF1b3RhKTsKLQljbG9zZShxdW90YS5mZCk7CiAKKwlyID0gcXVv
dGFfcmVhZCgmcXVvdGEsIE5VTEwsIDApOwogCWlmKHIpIHsKIAkgICAgcHJvdF9wcmludGYocG91
dCwgIk5JTCAiKTsKIAkgICAgZ290byBkdW1wX2ZpbGVzOyAKQEAgLTc5MiwxNyArNzgzLDE3IEBA
CiAgICAgaWYoIXIgJiYgcXVvdGF1c2VkKSB7CiAJc3RydWN0IHF1b3RhIHF1b3RhOwogCWNoYXIg
cXVvdGFfcm9vdFtNQVhfTUFJTEJPWF9QQVRIKzFdOworCXN0cnVjdCB0eG4gKnRpZCA9IE5VTEw7
CiAJCi0JaWYobWFpbGJveF9maW5kcXVvdGEocXVvdGFfcm9vdCwgc2l6ZW9mKHF1b3RhX3Jvb3Qp
LCBtYm5hbWUpKSB7CisJaWYgKHF1b3RhX2ZpbmRyb290KHF1b3RhX3Jvb3QsIHNpemVvZihxdW90
YV9yb290KSwgbWJuYW1lKSkgewogCSAgICAvKiB1cGRhdGUgdGhlIHF1b3RhIGZpbGUgKi8KIAkg
ICAgbWVtc2V0KCZxdW90YSwgMCwgc2l6ZW9mKHF1b3RhKSk7CiAJICAgIHF1b3RhLnJvb3QgPSBx
dW90YV9yb290OwotCSAgICBxdW90YS5mZCA9IC0xOwotCSAgICByID0gbWFpbGJveF9sb2NrX3F1
b3RhKCZxdW90YSk7CisJICAgIHIgPSBxdW90YV9yZWFkKCZxdW90YSwgJnRpZCwgMSk7CiAJICAg
IGlmKCFyKSB7CiAJCXF1b3RhLnVzZWQgKz0gcXVvdGF1c2VkOwotCQlyID0gbWFpbGJveF93cml0
ZV9xdW90YSgmcXVvdGEpOwotCQljbG9zZShxdW90YS5mZCk7CisJCXIgPSBxdW90YV93cml0ZSgm
cXVvdGEsICZ0aWQpOworCQlpZiAoIXIpIHF1b3RhX2NvbW1pdCgmdGlkKTsKIAkgICAgfSBlbHNl
IHsKIAkJc3lzbG9nKExPR19FUlIsICJjb3VsZCBub3QgbG9jayBxdW90YSBmaWxlIGZvciAlcyAo
JXMpIiwKIAkJICAgICAgIHF1b3RhX3Jvb3QsIGVycm9yX21lc3NhZ2UocikpOwpJbmRleDogaW1h
cC9tYm94bGlzdC5jCj09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT0KUkNTIGZpbGU6IC9hZnMvYW5kcmV3L3N5c3RlbS9jdnMv
c3JjL2N5cnVzL2ltYXAvbWJveGxpc3QuYyx2CnJldHJpZXZpbmcgcmV2aXNpb24gMS4yMjcKZGlm
ZiAtdSAtcjEuMjI3IG1ib3hsaXN0LmMKLS0tIGltYXAvbWJveGxpc3QuYwkxNSBEZWMgMjAwMyAy
MDowMDo0MCAtMDAwMAkxLjIyNworKysgaW1hcC9tYm94bGlzdC5jCTE2IERlYyAyMDAzIDIxOjMx
OjQ5IC0wMDAwCkBAIC04MCw2ICs4MCw3IEBACiAjaW5jbHVkZSAibXVwZGF0ZS1jbGllbnQuaCIK
IAogI2luY2x1ZGUgIm1ib3hsaXN0LmgiCisjaW5jbHVkZSAicXVvdGEuaCIKIAogI2RlZmluZSBE
QiBjb25maWdfbWJveGxpc3RfZGIKICNkZWZpbmUgU1VCREIgY29uZmlnX3N1YnNjcmlwdGlvbl9k
YgpAQCAtOTgsNiArOTksMTEgQEAKIHN0YXRpYyBpbnQgbWJveGxpc3RfY2hhbmdlcXVvdGEoY29u
c3QgY2hhciAqbmFtZSwgaW50IG1hdGNobGVuLCBpbnQgbWF5Y3JlYXRlLAogCQkJCXZvaWQgKnJv
Y2spOwogCitzdHJ1Y3QgY2hhbmdlX3JvY2sgeworICAgIHN0cnVjdCBxdW90YSAqcXVvdGE7Cisg
ICAgc3RydWN0IHR4biAqKnRpZDsKK307CisKICNkZWZpbmUgRk5BTUVfU1VCU1NVRkZJWCAiLnN1
YiIKIAogLyoKQEAgLTIyNDksNiArMjI1NSw4IEBACiAgICAgc3RydWN0IHF1b3RhIHF1b3RhOwog
ICAgIGludCBoYXZlX21haWxib3ggPSAxOwogICAgIGludCByLCB0OworICAgIHN0cnVjdCB0eG4g
KnRpZCA9IE5VTEw7CisgICAgc3RydWN0IGNoYW5nZV9yb2NrIGNyb2NrOwogCiAgICAgaWYgKCFy
b290WzBdIHx8IHJvb3RbMF0gPT0gJy4nIHx8IHN0cmNocihyb290LCAnLycpCiAJfHwgc3RyY2hy
KHJvb3QsICcqJykgfHwgc3RyY2hyKHJvb3QsICclJykgfHwgc3RyY2hyKHJvb3QsICc/JykpIHsK
QEAgLTIyNTgsMjEgKzIyNjYsMjEgQEAKICAgICBtZW1zZXQoJnF1b3RhLCAwLCBzaXplb2Yoc3Ry
dWN0IHF1b3RhKSk7CiAKICAgICBxdW90YS5yb290ID0gKGNoYXIgKikgcm9vdDsKLSAgICBtYWls
Ym94X2hhc2hfcXVvdGEocXVvdGFfcGF0aCwgc2l6ZW9mKHF1b3RhX3BhdGgpLCByb290KTsKKyAg
ICByID0gcXVvdGFfcmVhZCgmcXVvdGEsICZ0aWQsIDEpOwogCi0gICAgaWYgKChxdW90YS5mZCA9
IG9wZW4ocXVvdGFfcGF0aCwgT19SRFdSLCAwKSkgIT0gLTEpIHsKLQkvKiBKdXN0IGxvY2sgYW5k
IGNoYW5nZSBpdCAqLwotCXIgPSBtYWlsYm94X2xvY2tfcXVvdGEoJnF1b3RhKTsKKyAgICBpZiAo
IXIpIHsKKwkvKiBKdXN0IGNoYW5nZSBpdCAqLwogCiAJcXVvdGEubGltaXQgPSBuZXdxdW90YTsK
IAotCWlmICghcikgciA9IG1haWxib3hfd3JpdGVfcXVvdGEoJnF1b3RhKTsKLQlpZiAocXVvdGEu
ZmQgIT0gLTEpIHsKLQkgICAgY2xvc2UocXVvdGEuZmQpOwotCX0KKwlyID0gcXVvdGFfd3JpdGUo
JnF1b3RhLCAmdGlkKTsKKwlpZiAoIXIpIHF1b3RhX2NvbW1pdCgmdGlkKTsKKwogCXJldHVybiBy
OwogICAgIH0KIAorICAgIGlmIChyICE9IElNQVBfUVVPVEFST09UX05PTkVYSVNURU5UKSByZXR1
cm4gcjsKKwogICAgIC8qCiAgICAgICogSGF2ZSB0byBjcmVhdGUgYSBuZXcgcXVvdGEgcm9vdAog
ICAgICAqLwpAQCAtMjMwNCwyNSArMjMxMiwyMSBAQAogICAgIH0KIAogICAgIC8qIHBlcmhhcHMg
Y3JlYXRlIC5ORVcsIGxvY2ssIGNoZWNrIGlmIGl0IGdvdCByZWNyZWF0ZWQsIG1vdmUgaW4gcGxh
Y2UgKi8KLSAgICBxdW90YS5sb2NrX2NvdW50ID0gMTsKICAgICBxdW90YS51c2VkID0gMDsKICAg
ICBxdW90YS5saW1pdCA9IG5ld3F1b3RhOwotICAgIHIgPSBtYWlsYm94X3dyaXRlX3F1b3RhKCZx
dW90YSk7Ci0KLSAgICBpZiAocikgewotCXJldHVybiByOwotICAgIH0KKyAgICByID0gcXVvdGFf
d3JpdGUoJnF1b3RhLCAmdGlkKTsKKyAgICBpZiAocikgcmV0dXJuIHI7CiAKKyAgICBjcm9jay5x
dW90YSA9ICZxdW90YTsKKyAgICBjcm9jay50aWQgPSAmdGlkOwogICAgIC8qIHRvcCBsZXZlbCBt
YWlsYm94ICovCiAgICAgaWYoaGF2ZV9tYWlsYm94KQotCW1ib3hsaXN0X2NoYW5nZXF1b3RhKHF1
b3RhLnJvb3QsIDAsIDAsICZxdW90YSk7CisJbWJveGxpc3RfY2hhbmdlcXVvdGEocXVvdGEucm9v
dCwgMCwgMCwgJmNyb2NrKTsKICAgICAvKiBzdWJtYWlsYm94ZXMgLSB3ZSdyZSB1c2luZyBpbnRl
cm5hbCBuYW1lcyBoZXJlICovCi0gICAgbWJveGxpc3RfZmluZGFsbChOVUxMLCBwYXR0ZXJuLCAx
LCAwLCAwLCBtYm94bGlzdF9jaGFuZ2VxdW90YSwgJnF1b3RhKTsKKyAgICBtYm94bGlzdF9maW5k
YWxsKE5VTEwsIHBhdHRlcm4sIDEsIDAsIDAsIG1ib3hsaXN0X2NoYW5nZXF1b3RhLCAmY3JvY2sp
OwogICAgIAotICAgIHIgPSBtYWlsYm94X3dyaXRlX3F1b3RhKCZxdW90YSk7Ci0gICAgaWYgKHF1
b3RhLmZkICE9IC0xKSB7Ci0JY2xvc2UocXVvdGEuZmQpOwotICAgIH0KKyAgICByID0gcXVvdGFf
d3JpdGUoJnF1b3RhLCAmdGlkKTsKKyAgICBpZiAoIXIpIHF1b3RhX2NvbW1pdCgmdGlkKTsKIAog
ICAgIHJldHVybiByOwogfQpAQCAtMjMzMiw5ICsyMzM2LDggQEAKICAqLwogaW50IG1ib3hsaXN0
X3Vuc2V0cXVvdGEoY29uc3QgY2hhciAqcm9vdCkKIHsKLSAgICBjaGFyIHF1b3RhX3BhdGhbTUFY
X01BSUxCT1hfUEFUSCsxXTsKICAgICBjaGFyIHBhdHRlcm5bTUFYX01BSUxCT1hfUEFUSCsxXTsK
LSAgICBpbnQgZmQ7CisgICAgc3RydWN0IHF1b3RhIHF1b3RhOwogICAgIGludCByPTA7CiAKICAg
ICBpZiAoIXJvb3RbMF0gfHwgcm9vdFswXSA9PSAnLicgfHwgc3RyY2hyKHJvb3QsICcvJykKQEAg
LTIzNDIsMTQgKzIzNDUsMTMgQEAKIAlyZXR1cm4gSU1BUF9NQUlMQk9YX0JBRE5BTUU7CiAgICAg
fQogICAgIAotICAgIG1haWxib3hfaGFzaF9xdW90YShxdW90YV9wYXRoLCBzaXplb2YocXVvdGFf
cGF0aCksIHJvb3QpOwotCi0gICAgaWYgKChmZCA9IG9wZW4ocXVvdGFfcGF0aCwgT19SRFdSLCAw
KSkgPT0gLTEpIHsKKyAgICBxdW90YS5yb290ID0gKGNoYXIgKikgcm9vdDsKKyAgICByID0gcXVv
dGFfcmVhZCgmcXVvdGEsIE5VTEwsIDApOworICAgIGlmIChyID09IElNQVBfUVVPVEFST09UX05P
TkVYSVNURU5UKSB7CiAJLyogYWxyZWFkeSB1bnNldCAqLwogCXJldHVybiAwOwogICAgIH0KLSAg
ICAKLSAgICBjbG9zZShmZCk7CisgICAgZWxzZSBpZiAocikgcmV0dXJuIHI7CiAKICAgICAvKgog
ICAgICAqIEhhdmUgdG8gcmVtb3ZlIGl0IGZyb20gYWxsIGFmZmVjdGVkIG1haWxib3hlcwpAQCAt
MjM2NywxMCArMjM2OSw3IEBACiAgICAgLyogc3VibWFpbGJveGVzIC0gd2UncmUgdXNpbmcgaW50
ZXJuYWwgbmFtZXMgaGVyZSAqLwogICAgIG1ib3hsaXN0X2ZpbmRhbGwoTlVMTCwgcGF0dGVybiwg
MSwgMCwgMCwgbWJveGxpc3Rfcm1xdW90YSwgKHZvaWQgKilyb290KTsKIAotICAgIGlmKHVubGlu
ayhxdW90YV9wYXRoKSA9PSAtMSkgewotCXN5c2xvZyhMT0dfRVJSLCAiY291bGQgbm90IHVubGlu
ayAlcyAoJW0pIiwgcXVvdGFfcGF0aCk7Ci0JciA9IElNQVBfU1lTX0VSUk9SOwotICAgIH0KKyAg
ICByID0gcXVvdGFfZGVsZXRlKCZxdW90YSwgTlVMTCk7CiAKICAgICByZXR1cm4gcjsKIH0KQEAg
LTI0NjIsNyArMjQ2MSw5IEBACiB7CiAgICAgaW50IHI7CiAgICAgc3RydWN0IG1haWxib3ggbWFp
bGJveDsKLSAgICBzdHJ1Y3QgcXVvdGEgKm1ib3hsaXN0X25ld3F1b3RhID0gKHN0cnVjdCBxdW90
YSAqKSByb2NrOworICAgIHN0cnVjdCBjaGFuZ2Vfcm9jayAqY3JvY2sgPSAoc3RydWN0IGNoYW5n
ZV9yb2NrICopIHJvY2s7CisgICAgc3RydWN0IHF1b3RhICptYm94bGlzdF9uZXdxdW90YSA9IGNy
b2NrLT5xdW90YTsKKyAgICBzdHJ1Y3QgdHhuICoqdGlkID0gY3JvY2stPnRpZDsKIAogICAgIGFz
c2VydChyb2NrICE9IE5VTEwpOwogCkBAIC0yNDg1LDcgKzI0ODYsNyBAQAogCSAgICByZXR1cm4g
MDsKIAl9CiAKLQlyID0gbWFpbGJveF9sb2NrX3F1b3RhKCZtYWlsYm94LnF1b3RhKTsKKwlyID0g
cXVvdGFfcmVhZCgmbWFpbGJveC5xdW90YSwgdGlkLCAxKTsKIAlpZiAocikgZ290byBlcnJvcjsK
IAlpZiAobWFpbGJveC5xdW90YS51c2VkID49IG1haWxib3gucXVvdGFfbWFpbGJveF91c2VkKSB7
CiAJICAgIG1haWxib3gucXVvdGEudXNlZCAtPSBtYWlsYm94LnF1b3RhX21haWxib3hfdXNlZDsK
QEAgLTI0OTMsMTMgKzI0OTQsMTIgQEAKIAllbHNlIHsKIAkgICAgbWFpbGJveC5xdW90YS51c2Vk
ID0gMDsKIAl9Ci0JciA9IG1haWxib3hfd3JpdGVfcXVvdGEoJm1haWxib3gucXVvdGEpOworCXIg
PSBxdW90YV93cml0ZSgmbWFpbGJveC5xdW90YSwgdGlkKTsKIAlpZiAocikgewogCSAgICBzeXNs
b2coTE9HX0VSUiwKIAkJICAgIkxPU1RRVU9UQTogdW5hYmxlIHRvIHJlY29yZCBmcmVlIG9mICVs
dSBieXRlcyBpbiBxdW90YSAlcyIsCiAJCSAgIG1haWxib3gucXVvdGFfbWFpbGJveF91c2VkLCBt
YWlsYm94LnF1b3RhLnJvb3QpOwogCX0KLQltYWlsYm94X3VubG9ja19xdW90YSgmbWFpbGJveC5x
dW90YSk7CiAJZnJlZShtYWlsYm94LnF1b3RhLnJvb3QpOwogICAgIH0KIApJbmRleDogaW1hcC9u
bnRwZC5jCj09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT0KUkNTIGZpbGU6IC9hZnMvYW5kcmV3L3N5c3RlbS9jdnMvc3JjL2N5
cnVzL2ltYXAvbm50cGQuYyx2CnJldHJpZXZpbmcgcmV2aXNpb24gMS42CmRpZmYgLXUgLXIxLjYg
bm50cGQuYwotLS0gaW1hcC9ubnRwZC5jCTI1IE9jdCAyMDAzIDE0OjM4OjIyIC0wMDAwCTEuNgor
KysgaW1hcC9ubnRwZC5jCTE2IERlYyAyMDAzIDIxOjMxOjQ5IC0wMDAwCkBAIC01NzQsNiArNTc0
LDEwIEBACiAgICAgbWJveGxpc3RfaW5pdCgwKTsKICAgICBtYm94bGlzdF9vcGVuKE5VTEwpOwog
CisgICAgLyogb3BlbiB0aGUgcXVvdGEgZGIsIHdlJ2xsIG5lZWQgaXQgZm9yIGV4cHVuZ2UgKi8K
KyAgICBxdW90YWRiX2luaXQoMCk7CisgICAgcXVvdGFkYl9vcGVuKE5VTEwpOworCiAgICAgd2hp
bGUgKChvcHQgPSBnZXRvcHQoYXJnYywgYXJndiwgInNyZiIpKSAhPSBFT0YpIHsKIAlzd2l0Y2go
b3B0KSB7CiAJY2FzZSAncyc6IC8qIG5udHBzIChkbyBzdGFydHRscyByaWdodCBhd2F5KSAqLwpA
QCAtNzU4LDYgKzc2Miw5IEBACiAgICAgbWJveGxpc3RfY2xvc2UoKTsKICAgICBtYm94bGlzdF9k
b25lKCk7CiAKKyAgICBxdW90YWRiX2Nsb3NlKCk7CisgICAgcXVvdGFkYl9kb25lKCk7CisKICAg
ICBhbm5vdGF0ZW1vcmVfY2xvc2UoKTsKICAgICBhbm5vdGF0ZW1vcmVfZG9uZSgpOwogCkBAIC0z
MDM3LDEyICszMDQ0LDEzIEBACiAJCWVsc2UKIAkJICAgIHIgPSBhcHBlbmRfZnJvbXN0cmVhbSgm
YXMsIG1zZy0+ZGF0YSwgbXNnLT5zaXplLCBub3csCiAJCQkJCSAgKGNvbnN0IGNoYXIgKiopIE5V
TEwsIDApOwotCQlpZiAoIXIpIGFwcGVuZF9jb21taXQoJmFzLCBOVUxMLCAmdWlkLCBOVUxMKTsK
KwkJaWYgKCFyKSBhcHBlbmRfY29tbWl0KCZhcywgMCwgTlVMTCwgJnVpZCwgTlVMTCk7CiAJCWVs
c2UgYXBwZW5kX2Fib3J0KCZhcyk7CiAJICAgIH0KIAogCSAgICBpZiAoIXIgJiYgbXNnLT5pZCkK
LQkJZHVwbGljYXRlX21hcmsobXNnLT5pZCwgc3RybGVuKG1zZy0+aWQpLCByY3B0LCBzdHJsZW4o
cmNwdCksIG5vdywgdWlkKTsKKwkJZHVwbGljYXRlX21hcmsobXNnLT5pZCwgc3RybGVuKG1zZy0+
aWQpLCByY3B0LCBzdHJsZW4ocmNwdCksCisJCQkgICAgICAgbm93LCB1aWQpOwogCiAJICAgIGlm
IChyKSByZXR1cm4gcjsKIApJbmRleDogaW1hcC9wb3AzZC5jCj09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KUkNTIGZpbGU6
IC9hZnMvYW5kcmV3L3N5c3RlbS9jdnMvc3JjL2N5cnVzL2ltYXAvcG9wM2QuYyx2CnJldHJpZXZp
bmcgcmV2aXNpb24gMS4xNDcKZGlmZiAtdSAtcjEuMTQ3IHBvcDNkLmMKLS0tIGltYXAvcG9wM2Qu
YwkyNCBPY3QgMjAwMyAxODoyNDowNyAtMDAwMAkxLjE0NworKysgaW1hcC9wb3AzZC5jCTE2IERl
YyAyMDAzIDIxOjMxOjQ5IC0wMDAwCkBAIC0yOTQsNiArMjk0LDEwIEBACiAgICAgbWJveGxpc3Rf
aW5pdCgwKTsKICAgICBtYm94bGlzdF9vcGVuKE5VTEwpOwogCisgICAgLyogb3BlbiB0aGUgcXVv
dGEgZGIsIHdlJ2xsIG5lZWQgaXQgZm9yIGV4cHVuZ2UgKi8KKyAgICBxdW90YWRiX2luaXQoMCk7
CisgICAgcXVvdGFkYl9vcGVuKE5VTEwpOworCiAgICAgLyogc2V0dXAgZm9yIHNlbmRpbmcgSU1B
UCBJRExFIG5vdGlmaWNhdGlvbnMgKi8KICAgICBpZGxlX2VuYWJsZWQoKTsKIApAQCAtNDU4LDYg
KzQ2Miw5IEBACiAKICAgICBtYm94bGlzdF9jbG9zZSgpOwogICAgIG1ib3hsaXN0X2RvbmUoKTsK
KworICAgIHF1b3RhZGJfY2xvc2UoKTsKKyAgICBxdW90YWRiX2RvbmUoKTsKIAogICAgIGlmIChw
b3BkX2luKSB7CiAJcHJvdF9OT05CTE9DSyhwb3BkX2luKTsKSW5kZXg6IGltYXAvcXVvdGEuYwo9
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09ClJDUyBmaWxlOiAvYWZzL2FuZHJldy9zeXN0ZW0vY3ZzL3NyYy9jeXJ1cy9pbWFw
L3F1b3RhLmMsdgpyZXRyaWV2aW5nIHJldmlzaW9uIDEuNDgKZGlmZiAtdSAtcjEuNDggcXVvdGEu
YwotLS0gaW1hcC9xdW90YS5jCTIyIE9jdCAyMDAzIDE4OjUwOjA4IC0wMDAwCTEuNDgKKysrIGlt
YXAvcXVvdGEuYwkxNiBEZWMgMjAwMyAyMTozMTo0OSAtMDAwMApAQCAtNzcsNiArNzcsNyBAQAog
I2VuZGlmCiAKICNpbmNsdWRlICJhc3NlcnQuaCIKKyNpbmNsdWRlICJjeXJ1c2RiLmgiCiAjaW5j
bHVkZSAiZ2xvYmFsLmgiCiAjaW5jbHVkZSAiZXhpdGNvZGVzLmgiCiAjaW5jbHVkZSAiaW1hcF9l
cnIuaCIKQEAgLTg0LDYgKzg1LDcgQEAKICNpbmNsdWRlICJ4bWFsbG9jLmgiCiAjaW5jbHVkZSAi
bWJveGxpc3QuaCIKICNpbmNsdWRlICJtYm94bmFtZS5oIgorI2luY2x1ZGUgInF1b3RhLmgiCiAj
aW5jbHVkZSAiY29udmVydF9jb2RlLmgiCiAjaW5jbHVkZSAidXRpbC5oIgogCkBAIC0xMDMsMTEg
KzEwNSwxNiBAQAogaW50IGZpeHF1b3RhX21haWxib3goY2hhciAqbmFtZSwKIAkJICAgICBpbnQg
bWF0Y2hsZW4sCiAJCSAgICAgaW50IG1heWNyZWF0ZSwKLQkJICAgICB2b2lkKiByb2NrKTsKKwkJ
ICAgICB2b2lkICpyb2NrKTsKIGludCBmaXhxdW90YShjaGFyICpkb21haW4sIGludCBpc3BhcnRp
YWwpOwogaW50IGZpeHF1b3RhX2ZpeHJvb3Qoc3RydWN0IG1haWxib3ggKm1haWxib3gsCiAJCSAg
ICAgY2hhciAqcm9vdCk7Ci1pbnQgZml4cXVvdGFfZmluaXNoKGludCB0aGlzcXVvdGEpOworaW50
IGZpeHF1b3RhX2ZpbmlzaChpbnQgdGhpc3F1b3RhLCBzdHJ1Y3QgdHhuICoqdGlkKTsKKworc3Ry
dWN0IGZpeF9yb2NrIHsKKyAgICBjaGFyICpkb21haW47CisgICAgc3RydWN0IHR4biAqKnRpZDsK
K307CiAKIHN0cnVjdCBxdW90YWVudHJ5IHsKICAgICBzdHJ1Y3QgcXVvdGEgcXVvdGE7CkBAIC0x
MTgsNyArMTI1LDYgQEAKIAogI2RlZmluZSBRVU9UQUdST1cgMzAwCiAKLXN0cnVjdCBxdW90YWVu
dHJ5IHplcm9xdW90YWVudHJ5Owogc3RydWN0IHF1b3RhZW50cnkgKnF1b3RhOwogaW50IHF1b3Rh
X251bSA9IDAsIHF1b3RhX2FsbG9jID0gMDsKIApAQCAtMTYyLDcgKzE2OCwxMCBAQAogCWZhdGFs
KGVycm9yX21lc3NhZ2UociksIEVDX0NPTkZJRyk7CiAgICAgfQogCi0gICAgciA9IGJ1aWxkcXVv
dGFsaXN0KGRvbWFpbiwgYXJnditvcHRpbmQsIGFyZ2Mtb3B0aW5kKTsKKyAgICBxdW90YWRiX2lu
aXQoMCk7CisgICAgcXVvdGFkYl9vcGVuKE5VTEwpOworCisgICAgaWYgKCFyKSByID0gYnVpbGRx
dW90YWxpc3QoZG9tYWluLCBhcmd2K29wdGluZCwgYXJnYy1vcHRpbmQpOwogCiAgICAgaWYgKCFy
ICYmIGZmbGFnKSB7CiAJbWJveGxpc3RfaW5pdCgwKTsKQEAgLTE3MCw2ICsxNzksOSBAQAogCW1i
b3hsaXN0X2RvbmUoKTsKICAgICB9CiAKKyAgICBxdW90YWRiX2Nsb3NlKCk7CisgICAgcXVvdGFk
Yl9kb25lKCk7CisKICAgICBpZiAoIXIpIHJlcG9ydHF1b3RhKCk7CiAKICAgICBpZiAocikgewpA
QCAtMTg4LDUxICsyMDAsNTkgQEAKICAgICBleGl0KEVDX1VTQUdFKTsKIH0gICAgCiAKLS8qCi0g
KiBDb21wYXJpc29uIGZ1bmN0aW9uIGZvciBzb3J0aW5nIHF1b3RhIHJvb3RzCi0gKi8KLWludCBj
b21wYXJlX3F1b3RhKGNvbnN0IHZvaWQgKmEsIGNvbnN0IHZvaWQgKmIpCitzdHJ1Y3QgZmluZF9y
b2NrIHsKKyAgICBjaGFyICoqcm9vdHM7CisgICAgaW50IG5yb290czsKK307CisKK3N0YXRpYyBp
bnQgZmluZF9wKHZvaWQgKnJvY2twLAorCQkgIGNvbnN0IGNoYXIgKmtleSwgaW50IGtleWxlbiwK
KwkJICBjb25zdCBjaGFyICpkYXRhLCBpbnQgZGF0YWxlbikKIHsKLSAgICByZXR1cm4gc3RyY21w
KCgoc3RydWN0IHF1b3RhZW50cnkgKilhKS0+cXVvdGEucm9vdCwKLQkJICAgICAgKChzdHJ1Y3Qg
cXVvdGFlbnRyeSAqKWIpLT5xdW90YS5yb290KTsKKyAgICBzdHJ1Y3QgZmluZF9yb2NrICpmcm9j
ayA9IChzdHJ1Y3QgZmluZF9yb2NrICopIHJvY2twOworICAgIGludCBpOworCisgICAgLyogSWYg
cmVzdHJpY3Rpbmcgb3VyIGxpc3QsIHNlZSBpZiB0aGlzIHF1b3RhIHJvb3QgbWF0Y2hlcyAqLwor
ICAgIGlmIChmcm9jay0+bnJvb3RzKSB7CisJZm9yIChpID0gMDsgaSA8IGZyb2NrLT5ucm9vdHM7
IGkrKykgeworCSAgICBpZiAoKCFzdHJuY21wKGtleSwgZnJvY2stPnJvb3RzW2ldLCBrZXlsZW4p
ICYmCisJCSBrZXlsZW4gPT0gc3RybGVuKGZyb2NrLT5yb290c1tpXSkpIHx8CisJCSghc3RybmNt
cChrZXksIGZyb2NrLT5yb290c1tpXSwgc3RybGVuKGZyb2NrLT5yb290c1tpXSkpICYmCisJCSBr
ZXlbc3RybGVuKGZyb2NrLT5yb290c1tpXSldID09ICcuJykpIGJyZWFrOworCX0KKwlpZiAoaSA9
PSBmcm9jay0+bnJvb3RzKSByZXR1cm4gMDsKKyAgICB9CisKKyAgICByZXR1cm4gMTsKIH0KIAog
LyoKICAqIEFkZCBhIHF1b3RhIHJvb3QgdG8gdGhlIGxpc3QgaW4gJ3F1b3RhJwogICovCi12b2lk
IGFkZHF1b3Rhcm9vdChjaGFyICpkb21haW4sIGNoYXIgKnFyKQorc3RhdGljIGludCBmaW5kX2Ni
KHZvaWQgKnJvY2twLAorCQkgICBjb25zdCBjaGFyICprZXksIGludCBrZXlsZW4sCisJCSAgIGNv
bnN0IGNoYXIgKmRhdGEsIGludCBkYXRhbGVuKQogewogICAgIGludCByOworICAgIHVuc2lnbmVk
IGxvbmcgdXNlZDsKKyAgICBpbnQgbGltaXQ7CisgICAgY2hhciAqcDsKKworICAgIGlmICghZGF0
YSkgcmV0dXJuIDA7CiAKICAgICBpZiAocXVvdGFfbnVtID09IHF1b3RhX2FsbG9jKSB7CiAJcXVv
dGFfYWxsb2MgKz0gUVVPVEFHUk9XOwogCXF1b3RhID0gKHN0cnVjdCBxdW90YWVudHJ5ICopCiAJ
ICB4cmVhbGxvYygoY2hhciAqKXF1b3RhLCBxdW90YV9hbGxvYyAqIHNpemVvZihzdHJ1Y3QgcXVv
dGFlbnRyeSkpOwogICAgIH0KLSAgICBxdW90YVtxdW90YV9udW1dID0gemVyb3F1b3RhZW50cnk7
Ci0gICAgcXVvdGFbcXVvdGFfbnVtXS5xdW90YS5mZCA9IC0xOwotICAgIGlmIChkb21haW4pIHsK
LSAgCXF1b3RhW3F1b3RhX251bV0ucXVvdGEucm9vdCA9Ci0JICB4bWFsbG9jKHN0cmxlbihxcikg
KyBzdHJsZW4oZG9tYWluKSArIDIpOwotCXNwcmludGYocXVvdGFbcXVvdGFfbnVtXS5xdW90YS5y
b290LCAiJXMhJXMiLAotCQlkb21haW4sIHFyKTsKLSAgICB9Ci0gICAgZWxzZQotICAJcXVvdGFb
cXVvdGFfbnVtXS5xdW90YS5yb290ID0geHN0cmR1cChxcik7Ci0gIAotICAgIHIgPSBtYWlsYm94
X3JlYWRfcXVvdGEoJnF1b3RhW3F1b3RhX251bV0ucXVvdGEpOwotICAgIGlmIChxdW90YVtxdW90
YV9udW1dLnF1b3RhLmZkICE9IC0xKSB7Ci0gIAljbG9zZShxdW90YVtxdW90YV9udW1dLnF1b3Rh
LmZkKTsKLQlxdW90YVtxdW90YV9udW1dLnF1b3RhLmZkID0gLTE7Ci0gICAgfQotICAgIGlmIChy
KSB7Ci0gIAljb21fZXJyKHFyLCByLAotCQkociA9PSBFQ19JT0VSUikgPyBlcnJvcl9tZXNzYWdl
KGVycm5vKSA6IE5VTEwpOwotCXF1b3RhW3F1b3RhX251bV0ucXVvdGEudXNlZCA9IDA7Ci0JcXVv
dGFbcXVvdGFfbnVtXS5xdW90YS5saW1pdCA9IC0xOwotICAgIH0KKyAgICBtZW1zZXQoJnF1b3Rh
W3F1b3RhX251bV0sIDAsIHNpemVvZihzdHJ1Y3QgcXVvdGFlbnRyeSkpOworICAgIHF1b3RhW3F1
b3RhX251bV0ucXVvdGEucm9vdCA9IHhzdHJuZHVwKGtleSwga2V5bGVuKTsKKyAgICBzc2NhbmYo
ZGF0YSwgIiVsdSAlZCIsCisJICAgJnF1b3RhW3F1b3RhX251bV0ucXVvdGEudXNlZCwgJnF1b3Rh
W3F1b3RhX251bV0ucXVvdGEubGltaXQpOwogICAKICAgICBxdW90YV9udW0rKzsKKworICAgIHJl
dHVybiAwOwogfQogCiAvKgpAQCAtMjQwLDExICsyNjAsOSBAQAogICovCiBpbnQgYnVpbGRxdW90
YWxpc3QoY2hhciAqZG9tYWluLCBjaGFyICoqcm9vdHMsIGludCBucm9vdHMpCiB7Ci0gICAgY2hh
ciBxdW90YV9wYXRoW01BWF9NQUlMQk9YX1BBVEgrMV07CiAgICAgaW50IGk7Ci0gICAgRElSICpk
aXJwOwotICAgIERJUiAqdG9wcDsKLSAgICBzdHJ1Y3QgZGlyZW50ICpkaXJlbnQ7CisgICAgY2hh
ciBidWZbTUFYX01BSUxCT1hfTkFNRSsxXTsKKyAgICBzdHJ1Y3QgZmluZF9yb2NrIGZyb2NrID0g
eyByb290cywgbnJvb3RzIH07CiAKICAgICAvKiBUcmFuc2xhdGUgc2VwYXJhdG9yIGluIG1haWxi
b3huYW1lcy4KICAgICAgKgpAQCAtMjU3LDYwICsyNzUsMTMgQEAKIAltYm94bmFtZV9oaWVyc2Vw
X3RvaW50ZXJuYWwoJnF1b3RhX25hbWVzcGFjZSwgcm9vdHNbaV0sIDApOwogICAgIH0KIAorICAg
IGJ1ZlswXSA9ICdcMCc7CiAgICAgaWYgKGRvbWFpbikgewotCXNucHJpbnRmKHF1b3RhX3BhdGgs
IHNpemVvZihxdW90YV9wYXRoKSwKLQkJICIlcyVzJWMvJXMlcyIsIGNvbmZpZ19kaXIsIEZOQU1F
X0RPTUFJTkRJUiwKLQkJIGRpcl9oYXNoX2MoZG9tYWluKSwgZG9tYWluLCBGTkFNRV9RVU9UQURJ
Uik7Ci0gICAgfSBlbHNlIHsKLQlzbnByaW50ZihxdW90YV9wYXRoLCBzaXplb2YocXVvdGFfcGF0
aCksCi0JCSAiJXMlcyIsIGNvbmZpZ19kaXIsIEZOQU1FX1FVT1RBRElSKTsKLSAgICB9Ci0gICAg
aWYgKGNoZGlyKHF1b3RhX3BhdGgpKSB7Ci0JLyogTm8gcXVvdGEgZGlyZWN0b3J5IGluIHRoaXMg
ZG9tYWluICovCi0gCXJldHVybiAwOwotICAgIH0KLSAgICAKLSAgICB0b3BwID0gb3BlbmRpcigi
LiIpOwotICAgIGlmICghdG9wcCkgewotCXJldHVybiBJTUFQX0lPRVJST1I7Ci0gICAgfQotICAg
IHdoaWxlICgoZGlyZW50ID0gcmVhZGRpcih0b3BwKSkhPU5VTEwpIHsKLQlpZiAoZGlyZW50LT5k
X25hbWVbMF0gPT0gJy4nKSBjb250aW51ZTsKLQotCWlmIChkb21haW4gJiYgIXN0cmNtcChkaXJl
bnQtPmRfbmFtZSwgInJvb3QiKSkgewotCSAgICAvKiBRdW90YSBmb3IgZW50aXJlIGRvbWFpbiAq
LwotCSAgICBhZGRxdW90YXJvb3QoZG9tYWluLCAiIik7Ci0JICAgIGNvbnRpbnVlOwotCX0KLQkK
LQlkaXJwID0gb3BlbmRpcihkaXJlbnQtPmRfbmFtZSk7Ci0JaWYgKCFkaXJwKSBjb250aW51ZTsK
LQotCXdoaWxlICgoZGlyZW50ID0gcmVhZGRpcihkaXJwKSkhPU5VTEwpIHsKLQkgICAgaWYgKGRp
cmVudC0+ZF9uYW1lWzBdID09ICcuJykgY29udGludWU7Ci0KLQkgICAgLyogSWYgcmVzdHJpY3Rp
bmcgb3VyIGxpc3QsIHNlZSBpZiB0aGlzIHF1b3RhIGZpbGUgbWF0Y2hlcyAqLwotCSAgICBpZiAo
bnJvb3RzKSB7Ci0JCWZvciAoaSA9IDA7IGkgPCBucm9vdHM7IGkrKykgewotCQkgICAgaWYgKCFz
dHJjbXAoZGlyZW50LT5kX25hbWUsIHJvb3RzW2ldKSB8fAotCQkJKCFzdHJuY21wKGRpcmVudC0+
ZF9uYW1lLCByb290c1tpXSwgc3RybGVuKHJvb3RzW2ldKSkgJiYKLQkJCSBkaXJlbnQtPmRfbmFt
ZVtzdHJsZW4ocm9vdHNbaV0pXSA9PSAnLicpKSBicmVhazsKKwlzbnByaW50ZihidWYsIHNpemVv
ZihidWYpLCAiJXMhIiwgZG9tYWluKTsKIAkJfQotCQlpZiAoaSA9PSBucm9vdHMpIGNvbnRpbnVl
OwotCSAgICB9CiAJICAgIAotCSAgICAvKiBJZ25vcmUgLk5FVyBmaWxlcyAqLwotCSAgICBpID0g
c3RybGVuKGRpcmVudC0+ZF9uYW1lKTsKLQkgICAgaWYgKGkgPiA0ICYmICFzdHJjbXAoZGlyZW50
LT5kX25hbWUraS00LCAiLk5FVyIpKSBjb250aW51ZTsKLQkgICAgCi0JICAgIGFkZHF1b3Rhcm9v
dChkb21haW4sIGRpcmVudC0+ZF9uYW1lKTsKLQl9Ci0JCi0JLyogY2xvc2UgdGhpcyBzdWJkaXJl
Y3RvcnkgKi8KLQljbG9zZWRpcihkaXJwKTsKLSAgICB9Ci0gICAgY2xvc2VkaXIodG9wcCk7Ci0g
ICAgcXNvcnQoKGNoYXIgKilxdW90YSwgcXVvdGFfbnVtLCBzaXplb2YoKnF1b3RhKSwgY29tcGFy
ZV9xdW90YSk7CisgICAgY29uZmlnX3F1b3RhX2RiLT5mb3JlYWNoKHFkYiwgYnVmLCBzdHJsZW4o
YnVmKSwKKwkJCSAgICAgJmZpbmRfcCwgJmZpbmRfY2IsICZmcm9jaywgTlVMTCk7CiAKICAgICBy
ZXR1cm4gMDsKIH0KQEAgLTMyNiw3ICsyOTcsOSBAQAogICAgIGludCByOwogICAgIHN0cnVjdCBt
YWlsYm94IG1haWxib3g7CiAgICAgaW50IGksIGxlbiwgdGhpc3F1b3RhLCB0aGlzcXVvdGFsZW47
Ci0gICAgY2hhciAqcCwgKmRvbWFpbiA9IChjaGFyICopIHJvY2s7CisgICAgc3RydWN0IGZpeF9y
b2NrICpmcm9jayA9IChzdHJ1Y3QgZml4X3JvY2sgKikgcm9jazsKKyAgICBjaGFyICpwLCAqZG9t
YWluID0gZnJvY2stPmRvbWFpbjsKKyAgICBzdHJ1Y3QgdHhuICoqdGlkID0gZnJvY2stPnRpZDsK
IAogICAgIC8qIG1ha2Ugc3VyZSB0aGUgZG9tYWlucyBtYXRjaCAqLwogICAgIGlmICgocCA9IHN0
cmNocihuYW1lLCAnIScpKSAhPSBOVUxMKSB7CkBAIC0zNDAsNyArMzEzLDcgQEAKICAgICB3aGls
ZSAoZmlyc3RxdW90YSA8IHF1b3RhX251bSAmJgogCSAgIHN0cm5jbXAobmFtZSwgcXVvdGFbZmly
c3RxdW90YV0ucXVvdGEucm9vdCwKIAkJICAgICAgIHN0cmxlbihxdW90YVtmaXJzdHF1b3RhXS5x
dW90YS5yb290KSkgPiAwKSB7Ci0JciA9IGZpeHF1b3RhX2ZpbmlzaChmaXJzdHF1b3RhKyspOwor
CXIgPSBmaXhxdW90YV9maW5pc2goZmlyc3RxdW90YSsrLCB0aWQpOwogCWlmIChyKSByZXR1cm4g
cjsKICAgICB9CiAKQEAgLTM4NiwxNCArMzU5LDYgQEAKIAl9CiAgICAgfQogICAgIAotICAgIGlm
IChxdW90YVt0aGlzcXVvdGFdLnF1b3RhLmZkID09IC0xKSB7Ci0JciA9IG1haWxib3hfbG9ja19x
dW90YSgmcXVvdGFbdGhpc3F1b3RhXS5xdW90YSk7Ci0JaWYgKHIpIHsKLQkgICAgbWFpbGJveF9j
bG9zZSgmbWFpbGJveCk7Ci0JICAgIHJldHVybiByOwotCX0KLSAgICB9Ci0KICAgICByID0gbWFp
bGJveF9vcGVuX2luZGV4KCZtYWlsYm94KTsKICAgICBpZiAocikgewogCW1haWxib3hfY2xvc2Uo
Jm1haWxib3gpOwpAQCAtNDExLDIyICszNzYsNiBAQAogewogICAgIGludCBpLCByOwogCi0gICAg
LyoKLSAgICAgKiBMb2NraW5nIG9yZGVyIGlzIHRvIGxvY2sgaGVhZGVyIGJlZm9yZSBxdW90YS4g
IFdlIHRoZXJlZm9yZQotICAgICAqIHVubG9jayBhbGwgdGhlIHF1b3RhIHJvb3RzIHdlIGhhdmUg
bG9ja2VkIGluIG9yZGVyIHRvIGF2b2lkIGEKLSAgICAgKiBkZWFkbG9jay4gIEFzIHJlbGVhc2lu
ZyB0aGVzZSBsb2NrcyBjYW4gY2F1c2UgdGhlIHF1b3RhIHVzZQotICAgICAqIHJlY2FsY3VsYXRp
b24gdG8gc2NyZXcgdXAsIHdlIHNldCB0aGUgZ2xvYmFsIHZhcmlhYmxlICdyZWRvZml4JwotICAg
ICAqIHRvIGNhdXNlIHRoZSBxdW90YSB1c2UgcmVjYWxjdWxhdGlvbiB0byBiZSByZWRvbmUuCi0g
ICAgICoKLSAgICAgKiBXZSBjb3VsZCBvcHRpbWl6ZSB0aGlzIGJ5IHRyeWluZyB0byBnZXQgYSBu
b25ibG9ja2luZyBsb2NrIG9uCi0gICAgICogdGhlIGhlYWRlciBhbmQgdW5sb2NraW5nIGFsbCB0
aGUgcXVvdGEgcm9vdHMgb25seSB3aGVuIHRoYXQgZmFpbHMuCi0gICAgICovCi0gICAgZm9yIChp
ID0gZmlyc3RxdW90YTsgaSA8IHF1b3RhX251bTsgaSsrKSB7Ci0JaWYgKHF1b3RhW2ldLnF1b3Rh
LmZkICE9IC0xKSB7Ci0JICAgIGNsb3NlKHF1b3RhW2ldLnF1b3RhLmZkKTsKLQkgICAgcXVvdGFb
aV0ucXVvdGEuZmQgPSAtMTsKLQl9Ci0gICAgfQogICAgIHJlZG9maXggPSAxOwogCiAgICAgciA9
IG1haWxib3hfbG9ja19oZWFkZXIobWFpbGJveCk7CkBAIC00NTIsNDMgKzQwMSwyOSBAQAogLyoK
ICAqIEZpbmlzaCBmaXhpbmcgdXAgYSBxdW90YSByb290CiAgKi8KLWludCBmaXhxdW90YV9maW5p
c2goaW50IHRoaXNxdW90YSkKK2ludCBmaXhxdW90YV9maW5pc2goaW50IHRoaXNxdW90YSwgc3Ry
dWN0IHR4biAqKnRpZCkKIHsKICAgICBpbnQgcjsKIAogICAgIGlmICghcXVvdGFbdGhpc3F1b3Rh
XS5yZWZjb3VudCkgewogCWlmICghcXVvdGFbdGhpc3F1b3RhXS5kZWxldGVkKyspIHsKLQkgICAg
Y2hhciBidWZbTUFYX01BSUxCT1hfUEFUSCsxXTsKLQkgICAgCiAJICAgIHByaW50ZigiJXM6IHJl
bW92ZWRcbiIsIHF1b3RhW3RoaXNxdW90YV0ucXVvdGEucm9vdCk7Ci0JICAgIG1haWxib3hfaGFz
aF9xdW90YShidWYsIHNpemVvZihidWYpLCBxdW90YVt0aGlzcXVvdGFdLnF1b3RhLnJvb3QpOwot
Ci0JICAgIHVubGluayhidWYpOworCSAgICByID0gcXVvdGFfZGVsZXRlKCZxdW90YVt0aGlzcXVv
dGFdLnF1b3RhLCB0aWQpOworCSAgICBpZiAocikgcmV0dXJuIHI7CisJICAgIGZyZWUocXVvdGFb
dGhpc3F1b3RhXS5xdW90YS5yb290KTsKKwkgICAgcXVvdGFbdGhpc3F1b3RhXS5xdW90YS5yb290
ID0gTlVMTDsKIAl9CiAJcmV0dXJuIDA7CiAgICAgfQogCi0gICAgaWYgKHF1b3RhW3RoaXNxdW90
YV0ucXVvdGEuZmQgPT0gLTEpIHsKLQlyID0gbWFpbGJveF9sb2NrX3F1b3RhKCZxdW90YVt0aGlz
cXVvdGFdLnF1b3RhKTsKLQlpZiAocikgewotCSAgICBpZiAocXVvdGFbdGhpc3F1b3RhXS5xdW90
YS5mZCAhPSAtMSkgewotCQljbG9zZShxdW90YVt0aGlzcXVvdGFdLnF1b3RhLmZkKTsKLQkJcXVv
dGFbdGhpc3F1b3RhXS5xdW90YS5mZCA9IC0xOwotCSAgICB9Ci0JICAgIHJldHVybiByOwotCX0K
LSAgICB9Ci0gICAgCiAgICAgaWYgKHF1b3RhW3RoaXNxdW90YV0ucXVvdGEudXNlZCAhPSBxdW90
YVt0aGlzcXVvdGFdLm5ld3VzZWQpIHsKIAlwcmludGYoIiVzOiB1c2FnZSB3YXMgJWx1LCBub3cg
JWx1XG4iLCBxdW90YVt0aGlzcXVvdGFdLnF1b3RhLnJvb3QsCiAJICAgICAgIHF1b3RhW3RoaXNx
dW90YV0ucXVvdGEudXNlZCwgcXVvdGFbdGhpc3F1b3RhXS5uZXd1c2VkKTsKIAlxdW90YVt0aGlz
cXVvdGFdLnF1b3RhLnVzZWQgPSBxdW90YVt0aGlzcXVvdGFdLm5ld3VzZWQ7Ci0JciA9IG1haWxi
b3hfd3JpdGVfcXVvdGEoJnF1b3RhW3RoaXNxdW90YV0ucXVvdGEpOworCXIgPSBxdW90YV93cml0
ZSgmcXVvdGFbdGhpc3F1b3RhXS5xdW90YSwgdGlkKTsKIAlpZiAocikgcmV0dXJuIHI7CiAgICAg
fQogCi0gICAgY2xvc2UocXVvdGFbdGhpc3F1b3RhXS5xdW90YS5mZCk7Ci0gICAgcXVvdGFbdGhp
c3F1b3RhXS5xdW90YS5mZCA9IC0xOwogICAgIHJldHVybiAwOwogfQogCkBAIC01MDAsNiArNDM1
LDggQEAKIHsKICAgICBpbnQgciA9IDA7CiAgICAgc3RhdGljIGNoYXIgcGF0dGVyblsyXSA9ICIq
IjsKKyAgICBzdHJ1Y3QgZml4X3JvY2sgZnJvY2s7CisgICAgc3RydWN0IHR4biAqdGlkID0gTlVM
TDsKIAogICAgIC8qCiAgICAgICogTG9jayBtYWlsYm94IGxpc3QgdG8gcHJldmVudCBtYWlsYm94
IGNyZWF0aW9uL2RlbGV0aW9uCkBAIC01MDcsNiArNDQ0LDkgQEAKICAgICAgKi8KICAgICBtYm94
bGlzdF9vcGVuKE5VTEwpOwogCisgICAgZnJvY2suZG9tYWluID0gZG9tYWluOworICAgIGZyb2Nr
LnRpZCA9ICZ0aWQ7CisKICAgICByZWRvZml4ID0gMTsKICAgICB3aGlsZSAocmVkb2ZpeCkgewog
CXJlZG9maXggPSAwOwpAQCAtNTE0LDIwICs0NTQsMjIgQEAKIAlwYXJ0aWFsID0gaXNwYXJ0aWFs
OwogCiAJciA9ICgqcXVvdGFfbmFtZXNwYWNlLm1ib3hsaXN0X2ZpbmRhbGwpKCZxdW90YV9uYW1l
c3BhY2UsIHBhdHRlcm4sIDEsCi0JCQkJCQkwLCAwLCBmaXhxdW90YV9tYWlsYm94LCBkb21haW4p
OworCQkJCQkJMCwgMCwgZml4cXVvdGFfbWFpbGJveCwgJmZyb2NrKTsKIAlpZiAocikgewogCSAg
ICBtYm94bGlzdF9jbG9zZSgpOwogCSAgICByZXR1cm4gcjsKIAl9CiAKIAl3aGlsZSAoZmlyc3Rx
dW90YSA8IHF1b3RhX251bSkgewotCSAgICByID0gZml4cXVvdGFfZmluaXNoKGZpcnN0cXVvdGEr
Kyk7CisJICAgIHIgPSBmaXhxdW90YV9maW5pc2goZmlyc3RxdW90YSsrLCAmdGlkKTsKIAkgICAg
aWYgKHIpIHsKIAkJbWJveGxpc3RfY2xvc2UoKTsKIAkJcmV0dXJuIHI7CiAJICAgIH0KIAl9CiAg
ICAgfQorCisgICAgaWYgKCFyKSBxdW90YV9jb21taXQoJnRpZCk7CiAgICAgCiAgICAgbWJveGxp
c3RfY2xvc2UoKTsKICAgICByZXR1cm4gMDsKSW5kZXg6IGltYXAvcXVvdGEuaAo9PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
ClJDUyBmaWxlOiBpbWFwL3F1b3RhLmgKZGlmZiAtTiBpbWFwL3F1b3RhLmgKLS0tIC9kZXYvbnVs
bAkxIEphbiAxOTcwIDAwOjAwOjAwIC0wMDAwCisrKyBpbWFwL3F1b3RhLmgJMTYgRGVjIDIwMDMg
MjE6MzE6NDkgLTAwMDAKQEAgLTAsMCArMSw4NiBAQAorLyogcXVvdGEuaCAtLSBRdW90YSBmb3Jt
YXQgZGVmaW5pdGlvbnMKKyAqCisgKiBDb3B5cmlnaHQgKGMpIDE5OTgtMjAwMyBDYXJuZWdpZSBN
ZWxsb24gVW5pdmVyc2l0eS4gIEFsbCByaWdodHMgcmVzZXJ2ZWQuCisgKgorICogUmVkaXN0cmli
dXRpb24gYW5kIHVzZSBpbiBzb3VyY2UgYW5kIGJpbmFyeSBmb3Jtcywgd2l0aCBvciB3aXRob3V0
CisgKiBtb2RpZmljYXRpb24sIGFyZSBwZXJtaXR0ZWQgcHJvdmlkZWQgdGhhdCB0aGUgZm9sbG93
aW5nIGNvbmRpdGlvbnMKKyAqIGFyZSBtZXQ6CisgKgorICogMS4gUmVkaXN0cmlidXRpb25zIG9m
IHNvdXJjZSBjb2RlIG11c3QgcmV0YWluIHRoZSBhYm92ZSBjb3B5cmlnaHQKKyAqICAgIG5vdGlj
ZSwgdGhpcyBsaXN0IG9mIGNvbmRpdGlvbnMgYW5kIHRoZSBmb2xsb3dpbmcgZGlzY2xhaW1lci4g
CisgKgorICogMi4gUmVkaXN0cmlidXRpb25zIGluIGJpbmFyeSBmb3JtIG11c3QgcmVwcm9kdWNl
IHRoZSBhYm92ZSBjb3B5cmlnaHQKKyAqICAgIG5vdGljZSwgdGhpcyBsaXN0IG9mIGNvbmRpdGlv
bnMgYW5kIHRoZSBmb2xsb3dpbmcgZGlzY2xhaW1lciBpbgorICogICAgdGhlIGRvY3VtZW50YXRp
b24gYW5kL29yIG90aGVyIG1hdGVyaWFscyBwcm92aWRlZCB3aXRoIHRoZQorICogICAgZGlzdHJp
YnV0aW9uLgorICoKKyAqIDMuIFRoZSBuYW1lICJDYXJuZWdpZSBNZWxsb24gVW5pdmVyc2l0eSIg
bXVzdCBub3QgYmUgdXNlZCB0bworICogICAgZW5kb3JzZSBvciBwcm9tb3RlIHByb2R1Y3RzIGRl
cml2ZWQgZnJvbSB0aGlzIHNvZnR3YXJlIHdpdGhvdXQKKyAqICAgIHByaW9yIHdyaXR0ZW4gcGVy
bWlzc2lvbi4gRm9yIHBlcm1pc3Npb24gb3IgYW55IG90aGVyIGxlZ2FsCisgKiAgICBkZXRhaWxz
LCBwbGVhc2UgY29udGFjdCAgCisgKiAgICAgIE9mZmljZSBvZiBUZWNobm9sb2d5IFRyYW5zZmVy
CisgKiAgICAgIENhcm5lZ2llIE1lbGxvbiBVbml2ZXJzaXR5CisgKiAgICAgIDUwMDAgRm9yYmVz
IEF2ZW51ZQorICogICAgICBQaXR0c2J1cmdoLCBQQSAgMTUyMTMtMzg5MAorICogICAgICAoNDEy
KSAyNjgtNDM4NywgZmF4OiAoNDEyKSAyNjgtNzM5NQorICogICAgICB0ZWNoLXRyYW5zZmVyQGFu
ZHJldy5jbXUuZWR1CisgKgorICogNC4gUmVkaXN0cmlidXRpb25zIG9mIGFueSBmb3JtIHdoYXRz
b2V2ZXIgbXVzdCByZXRhaW4gdGhlIGZvbGxvd2luZworICogICAgYWNrbm93bGVkZ21lbnQ6Cisg
KiAgICAiVGhpcyBwcm9kdWN0IGluY2x1ZGVzIHNvZnR3YXJlIGRldmVsb3BlZCBieSBDb21wdXRp
bmcgU2VydmljZXMKKyAqICAgICBhdCBDYXJuZWdpZSBNZWxsb24gVW5pdmVyc2l0eSAoaHR0cDov
L3d3dy5jbXUuZWR1L2NvbXB1dGluZy8pLiIKKyAqCisgKiBDQVJORUdJRSBNRUxMT04gVU5JVkVS
U0lUWSBESVNDTEFJTVMgQUxMIFdBUlJBTlRJRVMgV0lUSCBSRUdBUkQgVE8KKyAqIFRISVMgU09G
VFdBUkUsIElOQ0xVRElORyBBTEwgSU1QTElFRCBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElU
WQorICogQU5EIEZJVE5FU1MsIElOIE5PIEVWRU5UIFNIQUxMIENBUk5FR0lFIE1FTExPTiBVTklW
RVJTSVRZIEJFIExJQUJMRQorICogRk9SIEFOWSBTUEVDSUFMLCBJTkRJUkVDVCBPUiBDT05TRVFV
RU5USUFMIERBTUFHRVMgT1IgQU5ZIERBTUFHRVMKKyAqIFdIQVRTT0VWRVIgUkVTVUxUSU5HIEZS
T00gTE9TUyBPRiBVU0UsIERBVEEgT1IgUFJPRklUUywgV0hFVEhFUiBJTgorICogQU4gQUNUSU9O
IE9GIENPTlRSQUNULCBORUdMSUdFTkNFIE9SIE9USEVSIFRPUlRJT1VTIEFDVElPTiwgQVJJU0lO
RworICogT1VUIE9GIE9SIElOIENPTk5FQ1RJT04gV0lUSCBUSEUgVVNFIE9SIFBFUkZPUk1BTkNF
IE9GIFRISVMgU09GVFdBUkUuCisgKgorICogJElkJAorICovCisKKyNpZm5kZWYgSU5DTFVERURf
UVVPVEFfSAorI2RlZmluZSBJTkNMVURFRF9RVU9UQV9ICisKKyNpbmNsdWRlICJjeXJ1c2RiLmgi
CisKKyNkZWZpbmUgRk5BTUVfUVVPVEFEQiAiL3F1b3Rhcy5kYiIKKworI2RlZmluZSBRVU9UQV9V
TklUUyAoMTAyNCkKKworZXh0ZXJuIHN0cnVjdCBkYiAqcWRiOworCitzdHJ1Y3QgcXVvdGEgewor
ICAgIGNoYXIgKnJvb3Q7CisKKyAgICAvKiBJbmZvcm1hdGlvbiBpbiBxdW90YSBlbnRyeSAqLwor
ICAgIHVuc2lnbmVkIGxvbmcgdXNlZDsKKyAgICBpbnQgbGltaXQ7CQkJLyogaW4gUVVPVEFfVU5J
VFMgKi8KK307CisKK2V4dGVybiBpbnQgcXVvdGFfcmVhZChzdHJ1Y3QgcXVvdGEgKnF1b3RhLCBz
dHJ1Y3QgdHhuICoqdGlkLCBpbnQgd3Jsb2NrKTsKKworZXh0ZXJuIHZvaWQgcXVvdGFfY29tbWl0
KHN0cnVjdCB0eG4gKip0aWQpOworCitleHRlcm4gaW50IHF1b3RhX3dyaXRlKHN0cnVjdCBxdW90
YSAqcXVvdGEsIHN0cnVjdCB0eG4gKip0aWQpOworCitleHRlcm4gaW50IHF1b3RhX2RlbGV0ZShz
dHJ1Y3QgcXVvdGEgKnF1b3RhLCBzdHJ1Y3QgdHhuICoqdGlkKTsKKworZXh0ZXJuIGludCBxdW90
YV9maW5kcm9vdChjaGFyICpyZXQsIHNpemVfdCByZXRsZW4sIGNvbnN0IGNoYXIgKm5hbWUpOwor
CisvKiBvcGVuIHRoZSBxdW90YXMgZGIgKi8KK3ZvaWQgcXVvdGFkYl9vcGVuKGNoYXIgKm5hbWUp
OworCisvKiBjbG9zZSB0aGUgZGF0YWJhc2UgKi8KK3ZvaWQgcXVvdGFkYl9jbG9zZSh2b2lkKTsK
KworLyogaW5pdGlhbGl6ZSBkYXRhYmFzZSBzdHJ1Y3R1cmVzICovCisjZGVmaW5lIFFVT1RBREJf
U1lOQyAweDAyCit2b2lkIHF1b3RhZGJfaW5pdChpbnQgZmxhZ3MpOworCisvKiBkb25lIHdpdGgg
ZGF0YWJhc2Ugc3R1ZmYgKi8KK3ZvaWQgcXVvdGFkYl9kb25lKHZvaWQpOworCisjZW5kaWYgLyog
SU5DTFVERURfUVVPVEFfSCAqLwpJbmRleDogaW1hcC9xdW90YV9kYi5jCj09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KUkNT
IGZpbGU6IGltYXAvcXVvdGFfZGIuYwpkaWZmIC1OIGltYXAvcXVvdGFfZGIuYwotLS0gL2Rldi9u
dWxsCTEgSmFuIDE5NzAgMDA6MDA6MDAgLTAwMDAKKysrIGltYXAvcXVvdGFfZGIuYwkxNiBEZWMg
MjAwMyAyMTozMTo0OSAtMDAwMApAQCAtMCwwICsxLDI4MCBAQAorLyogcXVvdGFfZGIuYyAtLSBx
dW90YSBtYW5pcHVsYXRpb24gcm91dGluZXMKKyAqIAorICogQ29weXJpZ2h0IChjKSAxOTk4LTIw
MDMgQ2FybmVnaWUgTWVsbG9uIFVuaXZlcnNpdHkuICBBbGwgcmlnaHRzIHJlc2VydmVkLgorICoK
KyAqIFJlZGlzdHJpYnV0aW9uIGFuZCB1c2UgaW4gc291cmNlIGFuZCBiaW5hcnkgZm9ybXMsIHdp
dGggb3Igd2l0aG91dAorICogbW9kaWZpY2F0aW9uLCBhcmUgcGVybWl0dGVkIHByb3ZpZGVkIHRo
YXQgdGhlIGZvbGxvd2luZyBjb25kaXRpb25zCisgKiBhcmUgbWV0OgorICoKKyAqIDEuIFJlZGlz
dHJpYnV0aW9ucyBvZiBzb3VyY2UgY29kZSBtdXN0IHJldGFpbiB0aGUgYWJvdmUgY29weXJpZ2h0
CisgKiAgICBub3RpY2UsIHRoaXMgbGlzdCBvZiBjb25kaXRpb25zIGFuZCB0aGUgZm9sbG93aW5n
IGRpc2NsYWltZXIuIAorICoKKyAqIDIuIFJlZGlzdHJpYnV0aW9ucyBpbiBiaW5hcnkgZm9ybSBt
dXN0IHJlcHJvZHVjZSB0aGUgYWJvdmUgY29weXJpZ2h0CisgKiAgICBub3RpY2UsIHRoaXMgbGlz
dCBvZiBjb25kaXRpb25zIGFuZCB0aGUgZm9sbG93aW5nIGRpc2NsYWltZXIgaW4KKyAqICAgIHRo
ZSBkb2N1bWVudGF0aW9uIGFuZC9vciBvdGhlciBtYXRlcmlhbHMgcHJvdmlkZWQgd2l0aCB0aGUK
KyAqICAgIGRpc3RyaWJ1dGlvbi4KKyAqCisgKiAzLiBUaGUgbmFtZSAiQ2FybmVnaWUgTWVsbG9u
IFVuaXZlcnNpdHkiIG11c3Qgbm90IGJlIHVzZWQgdG8KKyAqICAgIGVuZG9yc2Ugb3IgcHJvbW90
ZSBwcm9kdWN0cyBkZXJpdmVkIGZyb20gdGhpcyBzb2Z0d2FyZSB3aXRob3V0CisgKiAgICBwcmlv
ciB3cml0dGVuIHBlcm1pc3Npb24uIEZvciBwZXJtaXNzaW9uIG9yIGFueSBvdGhlciBsZWdhbAor
ICogICAgZGV0YWlscywgcGxlYXNlIGNvbnRhY3QgIAorICogICAgICBPZmZpY2Ugb2YgVGVjaG5v
bG9neSBUcmFuc2ZlcgorICogICAgICBDYXJuZWdpZSBNZWxsb24gVW5pdmVyc2l0eQorICogICAg
ICA1MDAwIEZvcmJlcyBBdmVudWUKKyAqICAgICAgUGl0dHNidXJnaCwgUEEgIDE1MjEzLTM4OTAK
KyAqICAgICAgKDQxMikgMjY4LTQzODcsIGZheDogKDQxMikgMjY4LTczOTUKKyAqICAgICAgdGVj
aC10cmFuc2ZlckBhbmRyZXcuY211LmVkdQorICoKKyAqIDQuIFJlZGlzdHJpYnV0aW9ucyBvZiBh
bnkgZm9ybSB3aGF0c29ldmVyIG11c3QgcmV0YWluIHRoZSBmb2xsb3dpbmcKKyAqICAgIGFja25v
d2xlZGdtZW50OgorICogICAgIlRoaXMgcHJvZHVjdCBpbmNsdWRlcyBzb2Z0d2FyZSBkZXZlbG9w
ZWQgYnkgQ29tcHV0aW5nIFNlcnZpY2VzCisgKiAgICAgYXQgQ2FybmVnaWUgTWVsbG9uIFVuaXZl
cnNpdHkgKGh0dHA6Ly93d3cuY211LmVkdS9jb21wdXRpbmcvKS4iCisgKgorICogQ0FSTkVHSUUg
TUVMTE9OIFVOSVZFUlNJVFkgRElTQ0xBSU1TIEFMTCBXQVJSQU5USUVTIFdJVEggUkVHQVJEIFRP
CisgKiBUSElTIFNPRlRXQVJFLCBJTkNMVURJTkcgQUxMIElNUExJRUQgV0FSUkFOVElFUyBPRiBN
RVJDSEFOVEFCSUxJVFkKKyAqIEFORCBGSVRORVNTLCBJTiBOTyBFVkVOVCBTSEFMTCBDQVJORUdJ
RSBNRUxMT04gVU5JVkVSU0lUWSBCRSBMSUFCTEUKKyAqIEZPUiBBTlkgU1BFQ0lBTCwgSU5ESVJF
Q1QgT1IgQ09OU0VRVUVOVElBTCBEQU1BR0VTIE9SIEFOWSBEQU1BR0VTCisgKiBXSEFUU09FVkVS
IFJFU1VMVElORyBGUk9NIExPU1MgT0YgVVNFLCBEQVRBIE9SIFBST0ZJVFMsIFdIRVRIRVIgSU4K
KyAqIEFOIEFDVElPTiBPRiBDT05UUkFDVCwgTkVHTElHRU5DRSBPUiBPVEhFUiBUT1JUSU9VUyBB
Q1RJT04sIEFSSVNJTkcKKyAqIE9VVCBPRiBPUiBJTiBDT05ORUNUSU9OIFdJVEggVEhFIFVTRSBP
UiBQRVJGT1JNQU5DRSBPRiBUSElTIFNPRlRXQVJFLgorICoKKyAqICRJZCQKKyAqCisgKi8KKwor
I2luY2x1ZGUgPGNvbmZpZy5oPgorCisjaWZkZWYgSEFWRV9VTklTVERfSAorI2luY2x1ZGUgPHVu
aXN0ZC5oPgorI2VuZGlmCisjaW5jbHVkZSA8c3RkaW8uaD4KKyNpbmNsdWRlIDxzdGRsaWIuaD4K
KyNpbmNsdWRlIDxzdHJpbmcuaD4KKyNpbmNsdWRlIDxlcnJuby5oPgorI2luY2x1ZGUgPHN5c2xv
Zy5oPgorI2luY2x1ZGUgPGNvbV9lcnIuaD4KKworI2luY2x1ZGUgImFzc2VydC5oIgorI2luY2x1
ZGUgImN5cnVzZGIuaCIKKyNpbmNsdWRlICJleGl0Y29kZXMuaCIKKyNpbmNsdWRlICJnbG9iYWwu
aCIKKyNpbmNsdWRlICJpbWFwX2Vyci5oIgorI2luY2x1ZGUgIm1haWxib3guaCIKKyNpbmNsdWRl
ICJxdW90YS5oIgorI2luY2x1ZGUgInV0aWwuaCIKKyNpbmNsdWRlICJ4bWFsbG9jLmgiCisKKyNk
ZWZpbmUgUURCIGNvbmZpZ19xdW90YV9kYgorCitzdHJ1Y3QgZGIgKnFkYjsKKworc3RhdGljIGlu
dCBxdW90YV9kYm9wZW4gPSAwOworCisvKgorICogUmVhZCB0aGUgcXVvdGEgZW50cnkgJ3F1b3Rh
JworICovCitpbnQgcXVvdGFfcmVhZChzdHJ1Y3QgcXVvdGEgKnF1b3RhLCBzdHJ1Y3QgdHhuICoq
dGlkLCBpbnQgd3Jsb2NrKQoreworICAgIGludCByOworICAgIGludCBxcmxlbjsKKyAgICBjb25z
dCBjaGFyICpkYXRhOworICAgIGludCBkYXRhbGVuOworCisgICAgaWYgKCFxdW90YS0+cm9vdCB8
fCAhKHFybGVuID0gc3RybGVuKHF1b3RhLT5yb290KSkpCisJcmV0dXJuIElNQVBfUVVPVEFST09U
X05PTkVYSVNURU5UOworCisgICAgaWYgKHdybG9jaykKKwlyID0gUURCLT5mZXRjaGxvY2socWRi
LCBxdW90YS0+cm9vdCwgcXJsZW4sICZkYXRhLCAmZGF0YWxlbiwgdGlkKTsKKyAgICBlbHNlCisJ
ciA9IFFEQi0+ZmV0Y2gocWRiLCBxdW90YS0+cm9vdCwgcXJsZW4sICZkYXRhLCAmZGF0YWxlbiwg
dGlkKTsKKworICAgIHN3aXRjaCAocikgeworICAgIGNhc2UgQ1lSVVNEQl9PSzoKKwlzc2NhbmYo
ZGF0YSwgIiVsdSAlZCIsICZxdW90YS0+dXNlZCwgJnF1b3RhLT5saW1pdCk7CisJYnJlYWs7CisK
KyAgICBjYXNlIENZUlVTREJfQUdBSU46CisJcmV0dXJuIElNQVBfQUdBSU47CisJYnJlYWs7CisK
KyAgICBjYXNlIENZUlVTREJfTk9URk9VTkQ6CisJcmV0dXJuIElNQVBfUVVPVEFST09UX05PTkVY
SVNURU5UOworCWJyZWFrOworCisgICAgZGVmYXVsdDoKKwlzeXNsb2coTE9HX0VSUiwgIkRCRVJS
T1I6IGVycm9yIGZldGNoaW5nICVzOiAlcyIsCisJICAgICAgIHF1b3RhLT5yb290LCBjeXJ1c2Ri
X3N0cmVycm9yKHIpKTsKKwlyZXR1cm4gSU1BUF9JT0VSUk9SOworCWJyZWFrOworICAgIH0KKwor
ICAgIHJldHVybiAwOworfQorCisvKgorICogQ29tbWl0IHRoZSBvdXRzdGFuZGluZyBxdW90YSB0
cmFuc2FjdGlvbgorICovCit2b2lkIHF1b3RhX2NvbW1pdChzdHJ1Y3QgdHhuICoqdGlkKQorewor
ICAgIGlmICh0aWQgJiYgKnRpZCkgeworCWlmIChRREItPmNvbW1pdChxZGIsICp0aWQpKSB7CisJ
ICAgIHN5c2xvZyhMT0dfRVJSLCAiSU9FUlJPUjogY29tbWl0dGluZyBxdW90YTogJW0iKTsKKwl9
CisJKnRpZCA9IE5VTEw7CisgICAgfQorfQorCisvKgorICogQWJvcnQgdGhlIG91dHN0YW5kaW5n
IHF1b3RhIHRyYW5zYWN0aW9uCisgKi8KK3ZvaWQgcXVvdGFfYWJvcnQoc3RydWN0IHR4biAqKnRp
ZCkKK3sKKyAgICBpZiAodGlkICYmICp0aWQpIHsKKwlpZiAoUURCLT5hYm9ydChxZGIsICp0aWQp
KSB7CisJICAgIHN5c2xvZyhMT0dfRVJSLCAiSU9FUlJPUjogYWJvcnRpbmcgcXVvdGE6ICVtIik7
CisJfQorCSp0aWQgPSBOVUxMOworICAgIH0KK30KKworLyoKKyAqIFdyaXRlIG91dCB0aGUgcXVv
dGEgZW50cnkgJ3F1b3RhJworICovCitpbnQgcXVvdGFfd3JpdGUoc3RydWN0IHF1b3RhICpxdW90
YSwgc3RydWN0IHR4biAqKnRpZCkKK3sKKyAgICBpbnQgcjsKKyAgICBpbnQgcXJsZW4sIGxlbjsK
KyAgICBjaGFyIGJ1ZlsxMDI0XTsKKworICAgIGlmICghcXVvdGEtPnJvb3QpIHJldHVybiAwOwor
CisgICAgcXJsZW4gPSBzdHJsZW4ocXVvdGEtPnJvb3QpOworICAgIGlmICghcXJsZW4pIHJldHVy
biBJTUFQX1FVT1RBUk9PVF9OT05FWElTVEVOVDsKKworICAgIGxlbiA9IHNucHJpbnRmKGJ1Ziwg
c2l6ZW9mKGJ1ZikgLSAxLAorCQkgICAiJWx1ICVkIiwgcXVvdGEtPnVzZWQsIHF1b3RhLT5saW1p
dCk7CisgICAgciA9IFFEQi0+c3RvcmUocWRiLCBxdW90YS0+cm9vdCwgcXJsZW4sIGJ1ZiwgbGVu
LCB0aWQpOworICAgIAorICAgIHN3aXRjaCAocikgeworICAgIGNhc2UgQ1lSVVNEQl9PSzoKKwli
cmVhazsKKworICAgIGNhc2UgQ1lSVVNEQl9BR0FJTjoKKwlyZXR1cm4gSU1BUF9BR0FJTjsKKwli
cmVhazsKKworICAgIGRlZmF1bHQ6CisJc3lzbG9nKExPR19FUlIsICJEQkVSUk9SOiBlcnJvciBz
dG9yaW5nICVzOiAlcyIsCisJICAgICAgIHF1b3RhLT5yb290LCBjeXJ1c2RiX3N0cmVycm9yKHIp
KTsKKwlyZXR1cm4gSU1BUF9JT0VSUk9SOworCWJyZWFrOworICAgIH0KKworICAgIHJldHVybiAw
OworfQorCisvKgorICogUmVtb3ZlIHRoZSBxdW90YSByb290ICdxdW90YScKKyAqLworaW50IHF1
b3RhX2RlbGV0ZShzdHJ1Y3QgcXVvdGEgKnF1b3RhLCBzdHJ1Y3QgdHhuICoqdGlkKQoreworICAg
IGludCBxcmxlbiwgcjsKKworICAgIGlmICghcXVvdGEtPnJvb3QpIHJldHVybiAwOworCisgICAg
cXJsZW4gPSBzdHJsZW4ocXVvdGEtPnJvb3QpOworICAgIGlmICghcXJsZW4pIHJldHVybiBJTUFQ
X1FVT1RBUk9PVF9OT05FWElTVEVOVDsKKworICAgIHIgPSBRREItPmRlbGV0ZShxZGIsIHF1b3Rh
LT5yb290LCBxcmxlbiwgdGlkLCAwKTsKKworICAgIHJldHVybiByOworfQorCisvKgorICogRmlu
ZCB0aGUgbWFpbGJveCAnbmFtZScgJ3MgcXVvdGFyb290LCBhbmQgcmV0dXJuIGl0IGluICdyZXQn
LgorICogJ3JldCcgbXVzdCBiZSBhdCBsZWFzdCBNQVhfTUFJTEJPWF9QQVRILiAKKyAqCisgKiBy
ZXR1cm5zIHRydWUgaWYgYSBxdW90YXJvb3QgaXMgZm91bmQsIDAgb3RoZXJ3aXNlLiAKKyovCitp
bnQgcXVvdGFfZmluZHJvb3QoY2hhciAqcmV0LCBzaXplX3QgcmV0bGVuLCBjb25zdCBjaGFyICpu
YW1lKQoreworICAgIGNoYXIgKnRhaWwsICpwLCAqbWJveDsKKworICAgIHN0cmxjcHkocmV0LCBu
YW1lLCByZXRsZW4pOworCisgICAgLyogZmluZCB0aGUgc3RhcnQgb2YgdGhlIHVucXVhbGlmaWVk
IG1haWxib3ggbmFtZSAqLworICAgIG1ib3ggPSAoY29uZmlnX3ZpcnRkb21haW5zICYmIChwID0g
c3RyY2hyKHJldCwgJyEnKSkpID8gcCsxIDogcmV0OworICAgIHRhaWwgPSBtYm94ICsgc3RybGVu
KG1ib3gpOworCisgICAgd2hpbGUgKFFEQi0+ZmV0Y2gocWRiLCByZXQsIHN0cmxlbihyZXQpLCBO
VUxMLCBOVUxMLCBOVUxMKSkgeworCXRhaWwgPSBzdHJyY2hyKG1ib3gsICcuJyk7CisJaWYgKCF0
YWlsKSBicmVhazsKKwkqdGFpbCA9ICdcMCc7CisgICAgfQorICAgIGlmICh0YWlsKSByZXR1cm4g
MTsKKyAgICBpZiAobWJveCA9PSByZXQpIHJldHVybiAwOworCisgICAgLyogY2hlY2sgZm9yIGEg
ZG9tYWluIHF1b3RhICovCisgICAgKm1ib3ggPSAnXDAnOworICAgIHJldHVybiAoUURCLT5mZXRj
aChxZGIsIHJldCwgc3RybGVuKHJldCksIE5VTEwsIE5VTEwsIE5VTEwpID09IDApOworfQorCisK
Ky8qIG11c3QgYmUgY2FsbGVkIGFmdGVyIGN5cnVzX2luaXQgKi8KK3ZvaWQgcXVvdGFkYl9pbml0
KGludCBteWZsYWdzKQoreworICAgIGludCByOworCisgICAgaWYgKG15ZmxhZ3MgJiBRVU9UQURC
X1NZTkMpIHsKKwlyID0gUURCLT5zeW5jKCk7CisgICAgfQorfQorCit2b2lkIHF1b3RhZGJfb3Bl
bihjaGFyICpmbmFtZSkKK3sKKyAgICBpbnQgcmV0OworICAgIGNoYXIgKnRvZnJlZSA9IE5VTEw7
CisKKyAgICAvKiBjcmVhdGUgZGIgZmlsZSBuYW1lICovCisgICAgaWYgKCFmbmFtZSkgeworCXNp
emVfdCBmbmFtZV9sZW4gPSBzdHJsZW4oY29uZmlnX2Rpcikrc3RybGVuKEZOQU1FX1FVT1RBREIp
KzE7CisJCisJZm5hbWUgPSB4bWFsbG9jKGZuYW1lX2xlbik7CisJdG9mcmVlID0gZm5hbWU7CisK
KwlzdHJsY3B5KGZuYW1lLCBjb25maWdfZGlyLCBmbmFtZV9sZW4pOworCXN0cmxjYXQoZm5hbWUs
IEZOQU1FX1FVT1RBREIsIGZuYW1lX2xlbik7CisgICAgfQorCisgICAgcmV0ID0gUURCLT5vcGVu
KGZuYW1lLCBDWVJVU0RCX0NSRUFURSwgJnFkYik7CisgICAgaWYgKHJldCAhPSAwKSB7CisJc3lz
bG9nKExPR19FUlIsICJEQkVSUk9SOiBvcGVuaW5nICVzOiAlcyIsIGZuYW1lLAorCSAgICAgICBj
eXJ1c2RiX3N0cmVycm9yKHJldCkpOworCSAgICAvKiBFeGl0aW5nIFRFTVBGQUlMIGJlY2F1c2Ug
U2VuZG1haWwgdGhpbmtzIHRoaXMKKwkgICAgICAgRUNfT1NGSUxFID09IHBlcm1hbmVudCBmYWls
dXJlLiAqLworCWZhdGFsKCJjYW4ndCByZWFkIHF1b3RhcyBmaWxlIiwgRUNfVEVNUEZBSUwpOwor
ICAgIH0KKworICAgIGlmICh0b2ZyZWUpIGZyZWUodG9mcmVlKTsKKworICAgIHF1b3RhX2Rib3Bl
biA9IDE7Cit9CisKK3ZvaWQgcXVvdGFkYl9jbG9zZSh2b2lkKQoreworICAgIGludCByOworCisg
ICAgaWYgKHF1b3RhX2Rib3BlbikgeworCXIgPSBRREItPmNsb3NlKHFkYik7CisJaWYgKHIpIHsK
KwkgICAgc3lzbG9nKExPR19FUlIsICJEQkVSUk9SOiBlcnJvciBjbG9zaW5nIHF1b3RhczogJXMi
LAorCQkgICBjeXJ1c2RiX3N0cmVycm9yKHIpKTsKKwl9CisJcXVvdGFfZGJvcGVuID0gMDsKKyAg
ICB9Cit9CisKK3ZvaWQgcXVvdGFkYl9kb25lKHZvaWQpCit7CisgICAgLyogREItPmRvbmUoKSBo
YW5kbGVkIGJ5IGN5cnVzX2RvbmUoKSAqLworfQpJbmRleDogaW1hcC9yZWNvbnN0cnVjdC5jCj09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT0KUkNTIGZpbGU6IC9hZnMvYW5kcmV3L3N5c3RlbS9jdnMvc3JjL2N5cnVzL2ltYXAv
cmVjb25zdHJ1Y3QuYyx2CnJldHJpZXZpbmcgcmV2aXNpb24gMS44MQpkaWZmIC11IC1yMS44MSBy
ZWNvbnN0cnVjdC5jCi0tLSBpbWFwL3JlY29uc3RydWN0LmMJMjIgT2N0IDIwMDMgMTg6NTA6MDgg
LTAwMDAJMS44MQorKysgaW1hcC9yZWNvbnN0cnVjdC5jCTE2IERlYyAyMDAzIDIxOjMxOjQ5IC0w
MDAwCkBAIC04OSw2ICs4OSw3IEBACiAjaW5jbHVkZSAiZ2xvYmFsLmgiCiAjaW5jbHVkZSAibWJv
eG5hbWUuaCIKICNpbmNsdWRlICJtYm94bGlzdC5oIgorI2luY2x1ZGUgInF1b3RhLmgiCiAjaW5j
bHVkZSAic2Vlbi5oIgogI2luY2x1ZGUgInJldHJ5LmgiCiAjaW5jbHVkZSAiY29udmVydF9jb2Rl
LmgiCkBAIC00NDgsNyArNDQ5LDcgQEAKICAgICB9CiAKICAgICAvKiBGaXggcXVvdGEgcm9vdCAq
LwotICAgIGhhc3F1b3RhID0gbWFpbGJveF9maW5kcXVvdGEocXVvdGFfcm9vdCwgc2l6ZW9mKHF1
b3RhX3Jvb3QpLCBtYWlsYm94Lm5hbWUpOworICAgIGhhc3F1b3RhID0gcXVvdGFfZmluZHJvb3Qo
cXVvdGFfcm9vdCwgc2l6ZW9mKHF1b3RhX3Jvb3QpLCBtYWlsYm94Lm5hbWUpOwogICAgIGlmICht
YWlsYm94LnF1b3RhLnJvb3QpIGZyZWUobWFpbGJveC5xdW90YS5yb290KTsKICAgICBpZiAoaGFz
cXVvdGEpIHsKIAltYWlsYm94LnF1b3RhLnJvb3QgPSB4c3RyZHVwKHF1b3RhX3Jvb3QpOwpJbmRl
eDogaW1hcC91c2VyLmMKPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PQpSQ1MgZmlsZTogL2Fmcy9hbmRyZXcvc3lzdGVtL2N2
cy9zcmMvY3lydXMvaW1hcC91c2VyLmMsdgpyZXRyaWV2aW5nIHJldmlzaW9uIDEuMTcKZGlmZiAt
dSAtcjEuMTcgdXNlci5jCi0tLSBpbWFwL3VzZXIuYwkyMiBPY3QgMjAwMyAxODo1MDowOSAtMDAw
MAkxLjE3CisrKyBpbWFwL3VzZXIuYwkxNiBEZWMgMjAwMyAyMTozMTo0OSAtMDAwMApAQCAtNzks
NiArNzksNyBAQAogI2luY2x1ZGUgIm1haWxib3guaCIKICNpbmNsdWRlICJ1dGlsLmgiCiAjaW5j
bHVkZSAic2Vlbi5oIgorI2luY2x1ZGUgInF1b3RhLmgiCiAKICNpZiAwCiBzdGF0aWMgaW50IHVz
ZXJfZGVsZXRlYWNsKGNoYXIgKm5hbWUsIGludCBtYXRjaGxlbiwgaW50IG1heWNyZWF0ZSwgdm9p
ZCogcm9jaykKQEAgLTM5MiwyOSArMzkzLDUwIEBACiB7CiAgICAgaW50IHIgPSAwOwogICAgIHN0
cnVjdCBxdW90YSBxdW90YTsKLSAgICBjaGFyIGJ1ZltNQVhfTUFJTEJPWF9QQVRIKzFdOwogCiAg
ICAgcXVvdGEucm9vdCA9IG9sZG5hbWU7Ci0gICAgcXVvdGEuZmQgPSAtMTsKIAotICAgIG1haWxi
b3hfaGFzaF9xdW90YShidWYsIHNpemVvZihidWYpLCBxdW90YS5yb290KTsKLSAgICBxdW90YS5m
ZCA9IG9wZW4oYnVmLCBPX1JEV1IsIDApOwotICAgIGlmIChxdW90YS5mZCA+IDApIHsKLQlyID0g
bWFpbGJveF9yZWFkX3F1b3RhKCZxdW90YSk7Ci0JaWYgKCFyKSBtYm94bGlzdF9zZXRxdW90YShu
ZXduYW1lLCBxdW90YS5saW1pdCwgMCk7Ci0gICAgfQorICAgIHIgPSBxdW90YV9yZWFkKCZxdW90
YSwgTlVMTCwgMCk7CisgICAgaWYgKCFyKSBtYm94bGlzdF9zZXRxdW90YShuZXduYW1lLCBxdW90
YS5saW1pdCwgMCk7CisKKyAgICByZXR1cm4gcjsKK30KKworc3RydWN0IGZpbmRfcm9jayB7Cisg
ICAgY2hhciAqaW5ib3huYW1lOworICAgIHN0cnVjdCB0eG4gKip0aWQ7Cit9OworCitzdGF0aWMg
aW50IGZpbmRfcCh2b2lkICpyb2NrcCwKKwkJICBjb25zdCBjaGFyICprZXksIGludCBrZXlsZW4s
CisJCSAgY29uc3QgY2hhciAqZGF0YSwgaW50IGRhdGFsZW4pCit7CisgICAgY2hhciAqaW5ib3hu
YW1lID0gKChzdHJ1Y3QgZmluZF9yb2NrICopIHJvY2twKS0+aW5ib3huYW1lOwogCisgICAgcmV0
dXJuICghc3RybmNtcChrZXksIGluYm94bmFtZSwgc3RybGVuKGluYm94bmFtZSkpICYmCisJICAg
IChrZXlsZW4gPT0gc3RybGVuKGluYm94bmFtZSkgfHwga2V5W3N0cmxlbihpbmJveG5hbWUpXSA9
PSAnLicpKTsKK30KKworc3RhdGljIGludCBmaW5kX2NiKHZvaWQgKnJvY2twLAorCQkgIGNvbnN0
IGNoYXIgKmtleSwgaW50IGtleWxlbiwKKwkJICBjb25zdCBjaGFyICpkYXRhLCBpbnQgZGF0YWxl
bikKK3sKKyAgICBzdHJ1Y3QgcXVvdGEgcXVvdGFfcm9vdDsKKyAgICBzdHJ1Y3QgdHhuICoqdGlk
ID0gKChzdHJ1Y3QgZmluZF9yb2NrICopIHJvY2twKS0+dGlkOworICAgIGludCByOworCisgICAg
cXVvdGFfcm9vdC5yb290ID0gKGNoYXIgKikgeHN0cm5kdXAoa2V5LCBrZXlsZW4pOworICAgIHIg
PSBxdW90YV9kZWxldGUoJnF1b3RhX3Jvb3QsIHRpZCk7CisgICAgZnJlZShxdW90YV9yb290LnJv
b3QpOyAKICAgICByZXR1cm4gcjsKIH0KIAogaW50IHVzZXJfZGVsZXRlcXVvdGFyb290cyhjb25z
dCBjaGFyICp1c2VyKQogewogICAgIHN0cnVjdCBuYW1lc3BhY2UgbmFtZXNwYWNlOwotICAgIGNo
YXIgaW5ib3huYW1lWzEwMjRdOworICAgIGNoYXIgYnVmW01BWF9NQUlMQk9YX05BTUUrMV0sICpp
bmJveG5hbWUgPSBidWY7CisgICAgc3RydWN0IHR4biAqdGlkID0gTlVMTDsKICAgICBpbnQgcjsK
LSAgICBjaGFyIGRpcltNQVhfTUFJTEJPWF9OQU1FKzFdLCAqZm5hbWUsIHFwYXRoW01BWF9NQUlM
Qk9YX05BTUVdOwotICAgIERJUiAqZGlycDsKLSAgICBzdHJ1Y3QgZGlyZW50ICpmOwogCiAgICAg
Lyogc2V0IG5hbWVzcGFjZSAqLwogICAgIHIgPSBtYm94bmFtZV9pbml0X25hbWVzcGFjZSgmbmFt
ZXNwYWNlLCAwKTsKQEAgLTQyMiwzMCArNDQ0LDE1IEBACiAgICAgLyogZ2V0IHVzZXIncyB0b3Bs
ZXZlbCBxdW90YXJvb3QgKElOQk9YKSAqLwogICAgIGlmICghcikKIAlyID0gKCpuYW1lc3BhY2Uu
bWJveG5hbWVfdG9pbnRlcm5hbCkoJm5hbWVzcGFjZSwgIklOQk9YIiwKLQkJCQkJICAgICB1c2Vy
LCBpbmJveG5hbWUpOworCQkJCQkJIHVzZXIsIGluYm94bmFtZSk7CiAKICAgICBpZiAoIXIpIHsK
LQkvKiBnZXQgcGF0aCB0byB0b3BsZXZlbCBxdW90YXJvb3QgKi8KLQltYWlsYm94X2hhc2hfcXVv
dGEoZGlyLCBzaXplb2YoZGlyKSwgaW5ib3huYW1lKTsKLQotCS8qIHNwbGl0IGRpcmVjdG9yeSBh
bmQgZmlsZW5hbWUgKi8KLQlmbmFtZSA9IHN0cnJjaHIoZGlyLCAnLycpOwotCSpmbmFtZSsrID0g
J1wwJzsKLQotCWRpcnAgPSBvcGVuZGlyKGRpcik7Ci0JaWYgKGRpcnApIHsKLQkgICAgd2hpbGUg
KChmID0gcmVhZGRpcihkaXJwKSkgIT0gTlVMTCkgewotCQlpZiAoIXN0cm5jbXAoZi0+ZF9uYW1l
LCBmbmFtZSwgc3RybGVuKGZuYW1lKSkgJiYKLQkJICAgIChmLT5kX25hbWVbc3RybGVuKGZuYW1l
KV0gPT0gJ1wwJ3x8Ci0JCSAgICAgZi0+ZF9uYW1lW3N0cmxlbihmbmFtZSldID09ICcuJykpIHsK
LQotCQkgICAgc25wcmludGYocXBhdGgsIHNpemVvZihxcGF0aCksICIlcy8lcyIsIGRpciwgZi0+
ZF9uYW1lKTsKLQkJICAgIHVubGluayhxcGF0aCk7Ci0JCX0KLQkgICAgfQotCSAgICBjbG9zZWRp
cihkaXJwKTsKLQl9CisJc3RydWN0IGZpbmRfcm9jayBmcm9jayA9IHsgaW5ib3huYW1lLCAmdGlk
IH07CisJciA9IGNvbmZpZ19xdW90YV9kYi0+Zm9yZWFjaChxZGIsIGluYm94bmFtZSwgc3RybGVu
KGluYm94bmFtZSksCisJCQkJICAgICAmZmluZF9wLCAmZmluZF9jYiwgJmZyb2NrLCAmdGlkKTsK
ICAgICB9CisKKyAgICBpZiAoIXIpIHF1b3RhX2NvbW1pdCgmdGlkKTsKIAogICAgIHJldHVybiBy
OwogfQpJbmRleDogbGliL2N5cnVzZGIuYwo9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09ClJDUyBmaWxlOiAvYWZzL2FuZHJl
dy9zeXN0ZW0vY3ZzL3NyYy9jeXJ1cy9saWIvY3lydXNkYi5jLHYKcmV0cmlldmluZyByZXZpc2lv
biAxLjcKZGlmZiAtdSAtcjEuNyBjeXJ1c2RiLmMKLS0tIGxpYi9jeXJ1c2RiLmMJMTUgRGVjIDIw
MDMgMjI6NDI6MzggLTAwMDAJMS43CisrKyBsaWIvY3lydXNkYi5jCTE2IERlYyAyMDAzIDIxOjMx
OjUwIC0wMDAwCkBAIC02OCw2ICs2OCw3IEBACiAjZW5kaWYKICAgICAmY3lydXNkYl9mbGF0LAog
ICAgICZjeXJ1c2RiX3NraXBsaXN0LAorICAgICZjeXJ1c2RiX3F1b3RhbGVnYWN5LAogICAgIE5V
TEwgfTsKIAogdm9pZCBjeXJ1c2RiX2luaXQoKSAKSW5kZXg6IGxpYi9jeXJ1c2RiLmgKPT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PQpSQ1MgZmlsZTogL2Fmcy9hbmRyZXcvc3lzdGVtL2N2cy9zcmMvY3lydXMvbGliL2N5cnVz
ZGIuaCx2CnJldHJpZXZpbmcgcmV2aXNpb24gMS4yNwpkaWZmIC11IC1yMS4yNyBjeXJ1c2RiLmgK
LS0tIGxpYi9jeXJ1c2RiLmgJMTUgRGVjIDIwMDMgMjI6NDI6MzggLTAwMDAJMS4yNworKysgbGli
L2N5cnVzZGIuaAkxNiBEZWMgMjAwMyAyMTozMTo1MCAtMDAwMApAQCAtMTg1LDYgKzE4NSw3IEBA
CiBleHRlcm4gc3RydWN0IGN5cnVzZGJfYmFja2VuZCBjeXJ1c2RiX2JlcmtlbGV5X25vc3luYzsK
IGV4dGVybiBzdHJ1Y3QgY3lydXNkYl9iYWNrZW5kIGN5cnVzZGJfZmxhdDsKIGV4dGVybiBzdHJ1
Y3QgY3lydXNkYl9iYWNrZW5kIGN5cnVzZGJfc2tpcGxpc3Q7CitleHRlcm4gc3RydWN0IGN5cnVz
ZGJfYmFja2VuZCBjeXJ1c2RiX3F1b3RhbGVnYWN5OwogCiBleHRlcm4gaW50IGN5cnVzZGJfY29w
eWZpbGUoY29uc3QgY2hhciAqc3JjbmFtZSwgY29uc3QgY2hhciAqZHN0bmFtZSk7CiAKSW5kZXg6
IGxpYi9jeXJ1c2RiX3F1b3RhbGVnYWN5LmMKPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQpSQ1MgZmlsZTogbGliL2N5cnVz
ZGJfcXVvdGFsZWdhY3kuYwpkaWZmIC1OIGxpYi9jeXJ1c2RiX3F1b3RhbGVnYWN5LmMKLS0tIC9k
ZXYvbnVsbAkxIEphbiAxOTcwIDAwOjAwOjAwIC0wMDAwCisrKyBsaWIvY3lydXNkYl9xdW90YWxl
Z2FjeS5jCTE2IERlYyAyMDAzIDIxOjMxOjUwIC0wMDAwCkBAIC0wLDAgKzEsNzUzIEBACisvKiAg
Y3lydXNkYl9xdW90YWxlZ2FjeTogY3lydXNkYiBiYWNrZW5kIGZvciBhY2Nlc3NpbmcgbGVnYWN5
IHF1b3RhIGZpbGVzCisgKgorICogQ29weXJpZ2h0IChjKSAxOTk4LTIwMDMgQ2FybmVnaWUgTWVs
bG9uIFVuaXZlcnNpdHkuICBBbGwgcmlnaHRzIHJlc2VydmVkLgorICoKKyAqIFJlZGlzdHJpYnV0
aW9uIGFuZCB1c2UgaW4gc291cmNlIGFuZCBiaW5hcnkgZm9ybXMsIHdpdGggb3Igd2l0aG91dAor
ICogbW9kaWZpY2F0aW9uLCBhcmUgcGVybWl0dGVkIHByb3ZpZGVkIHRoYXQgdGhlIGZvbGxvd2lu
ZyBjb25kaXRpb25zCisgKiBhcmUgbWV0OgorICoKKyAqIDEuIFJlZGlzdHJpYnV0aW9ucyBvZiBz
b3VyY2UgY29kZSBtdXN0IHJldGFpbiB0aGUgYWJvdmUgY29weXJpZ2h0CisgKiAgICBub3RpY2Us
IHRoaXMgbGlzdCBvZiBjb25kaXRpb25zIGFuZCB0aGUgZm9sbG93aW5nIGRpc2NsYWltZXIuIAor
ICoKKyAqIDIuIFJlZGlzdHJpYnV0aW9ucyBpbiBiaW5hcnkgZm9ybSBtdXN0IHJlcHJvZHVjZSB0
aGUgYWJvdmUgY29weXJpZ2h0CisgKiAgICBub3RpY2UsIHRoaXMgbGlzdCBvZiBjb25kaXRpb25z
IGFuZCB0aGUgZm9sbG93aW5nIGRpc2NsYWltZXIgaW4KKyAqICAgIHRoZSBkb2N1bWVudGF0aW9u
IGFuZC9vciBvdGhlciBtYXRlcmlhbHMgcHJvdmlkZWQgd2l0aCB0aGUKKyAqICAgIGRpc3RyaWJ1
dGlvbi4KKyAqCisgKiAzLiBUaGUgbmFtZSAiQ2FybmVnaWUgTWVsbG9uIFVuaXZlcnNpdHkiIG11
c3Qgbm90IGJlIHVzZWQgdG8KKyAqICAgIGVuZG9yc2Ugb3IgcHJvbW90ZSBwcm9kdWN0cyBkZXJp
dmVkIGZyb20gdGhpcyBzb2Z0d2FyZSB3aXRob3V0CisgKiAgICBwcmlvciB3cml0dGVuIHBlcm1p
c3Npb24uIEZvciBwZXJtaXNzaW9uIG9yIGFueSBvdGhlciBsZWdhbAorICogICAgZGV0YWlscywg
cGxlYXNlIGNvbnRhY3QgIAorICogICAgICBPZmZpY2Ugb2YgVGVjaG5vbG9neSBUcmFuc2Zlcgor
ICogICAgICBDYXJuZWdpZSBNZWxsb24gVW5pdmVyc2l0eQorICogICAgICA1MDAwIEZvcmJlcyBB
dmVudWUKKyAqICAgICAgUGl0dHNidXJnaCwgUEEgIDE1MjEzLTM4OTAKKyAqICAgICAgKDQxMikg
MjY4LTQzODcsIGZheDogKDQxMikgMjY4LTczOTUKKyAqICAgICAgdGVjaC10cmFuc2ZlckBhbmRy
ZXcuY211LmVkdQorICoKKyAqIDQuIFJlZGlzdHJpYnV0aW9ucyBvZiBhbnkgZm9ybSB3aGF0c29l
dmVyIG11c3QgcmV0YWluIHRoZSBmb2xsb3dpbmcKKyAqICAgIGFja25vd2xlZGdtZW50OgorICog
ICAgIlRoaXMgcHJvZHVjdCBpbmNsdWRlcyBzb2Z0d2FyZSBkZXZlbG9wZWQgYnkgQ29tcHV0aW5n
IFNlcnZpY2VzCisgKiAgICAgYXQgQ2FybmVnaWUgTWVsbG9uIFVuaXZlcnNpdHkgKGh0dHA6Ly93
d3cuY211LmVkdS9jb21wdXRpbmcvKS4iCisgKgorICogQ0FSTkVHSUUgTUVMTE9OIFVOSVZFUlNJ
VFkgRElTQ0xBSU1TIEFMTCBXQVJSQU5USUVTIFdJVEggUkVHQVJEIFRPCisgKiBUSElTIFNPRlRX
QVJFLCBJTkNMVURJTkcgQUxMIElNUExJRUQgV0FSUkFOVElFUyBPRiBNRVJDSEFOVEFCSUxJVFkK
KyAqIEFORCBGSVRORVNTLCBJTiBOTyBFVkVOVCBTSEFMTCBDQVJORUdJRSBNRUxMT04gVU5JVkVS
U0lUWSBCRSBMSUFCTEUKKyAqIEZPUiBBTlkgU1BFQ0lBTCwgSU5ESVJFQ1QgT1IgQ09OU0VRVUVO
VElBTCBEQU1BR0VTIE9SIEFOWSBEQU1BR0VTCisgKiBXSEFUU09FVkVSIFJFU1VMVElORyBGUk9N
IExPU1MgT0YgVVNFLCBEQVRBIE9SIFBST0ZJVFMsIFdIRVRIRVIgSU4KKyAqIEFOIEFDVElPTiBP
RiBDT05UUkFDVCwgTkVHTElHRU5DRSBPUiBPVEhFUiBUT1JUSU9VUyBBQ1RJT04sIEFSSVNJTkcK
KyAqIE9VVCBPRiBPUiBJTiBDT05ORUNUSU9OIFdJVEggVEhFIFVTRSBPUiBQRVJGT1JNQU5DRSBP
RiBUSElTIFNPRlRXQVJFLgorICovCisKKy8qICRJZCQgKi8KKworI2luY2x1ZGUgPGNvbmZpZy5o
PgorCisjaWZkZWYgSEFWRV9VTklTVERfSAorI2luY2x1ZGUgPHVuaXN0ZC5oPgorI2VuZGlmCisj
aW5jbHVkZSA8c3RkaW8uaD4KKyNpbmNsdWRlIDxzdGRsaWIuaD4KKyNpbmNsdWRlIDxzeXNsb2cu
aD4KKyNpbmNsdWRlIDxzdHJpbmcuaD4KKyNpbmNsdWRlIDxlcnJuby5oPgorI2luY2x1ZGUgPHN5
cy90eXBlcy5oPgorI2luY2x1ZGUgPHN5cy9zdGF0Lmg+CisjaW5jbHVkZSA8c3lzL3Vpby5oPgor
I2luY2x1ZGUgPGZjbnRsLmg+CisjaW5jbHVkZSAiL3Vzci9pbmNsdWRlL2dsb2IuaCIKKworI2lu
Y2x1ZGUgImFzc2VydC5oIgorI2luY2x1ZGUgImN5cnVzZGIuaCIKKyNpbmNsdWRlICJleGl0Y29k
ZXMuaCIKKyNpbmNsdWRlICJoYXNoLmgiCisjaW5jbHVkZSAibWFwLmgiCisjaW5jbHVkZSAibGli
Y3lyX2NmZy5oIgorI2luY2x1ZGUgImxvY2suaCIKKyNpbmNsdWRlICJyZXRyeS5oIgorI2luY2x1
ZGUgInV0aWwuaCIKKyNpbmNsdWRlICJ4bWFsbG9jLmgiCisKKyNkZWZpbmUgRk5BTUVfUVVPVEFE
SVIgIi9xdW90YS8iCisjZGVmaW5lIE1BWF9RVU9UQV9QQVRIIDQwOTYKKworLyogd2UgaGF2ZSB0
aGUgZmlsZSBsb2NrZWQgaWZmIHdlIGhhdmUgYW4gb3V0c3RhbmRpbmcgdHJhbnNhY3Rpb24gKi8K
Kworc3RydWN0IGRiIHsKKyAgICBjaGFyICpwYXRoOworCisgICAgY2hhciAqZGF0YTsgIC8qIGFs
bG9jYXRlZCBidWZmZXIgZm9yIGZldGNoZWQgZGF0YSAqLworCisgICAgaGFzaF90YWJsZSB0YWJs
ZTsgIC8qIHRyYW5zYWN0aW9uIChoYXNoIHRhYmxlIG9mIHN1Yi10cmFuc2FjdGlvbnMpICovCit9
OworCitzdHJ1Y3Qgc3VidHhuIHsKKyAgICBpbnQgZmQ7CisKKyAgICBjaGFyICpmbmFtZW5ldzsK
KyAgICBpbnQgZmRuZXc7CisKKyAgICBpbnQgZGVsZXRlOworfTsKKworLyogc2ltcGxlIGhhc2gg
c28gaXQncyBlYXN5IHRvIGZpbmQgdGhlc2UgdGhpbmdzIGluIHRoZSBmaWxlc3lzdGVtOworICAg
b3VyIGh1bWFuIHRpbWUgaXMgd29ydGggbW9yZSB0aGFuIGVmZmljaWVuY3kgKi8KK3N0YXRpYyB2
b2lkIGhhc2hfcXVvdGEoY2hhciAqYnVmLCBzaXplX3Qgc2l6ZSwgY29uc3QgY2hhciAqcXIsIGNo
YXIgKnBhdGgpCit7CisgICAgaW50IGNvbmZpZ192aXJ0ZG9tYWlucyA9IGxpYmN5cnVzX2NvbmZp
Z19nZXRzd2l0Y2goQ1lSVVNPUFRfVklSVERPTUFJTlMpOworICAgIGNvbnN0IGNoYXIgKmlkeDsK
KyAgICBjaGFyIGMsICpwOworICAgIHVuc2lnbmVkIGxlbjsKKworICAgIGlmICgobGVuID0gc25w
cmludGYoYnVmLCBzaXplLCAiJXMiLCBwYXRoKSkgPj0gc2l6ZSkgeworICAgICAgICBmYXRhbCgi
aW5zdWZmaWNpZW50IGJ1ZmZlciBzaXplIGluIGhhc2hfcXVvdGEiLCBFQ19URU1QRkFJTCk7Cisg
ICAgfQorICAgIGJ1ZiArPSBsZW47CisgICAgc2l6ZSAtPSBsZW47CisKKyAgICBpZiAoY29uZmln
X3ZpcnRkb21haW5zICYmIChwID0gc3RyY2hyKHFyLCAnIScpKSkgeworCSpwID0gJ1wwJzsgIC8q
IHNwbGl0IGRvbWFpbiFxciAqLworCWMgPSAoY2hhcikgZGlyX2hhc2hfYyhxcik7CisJaWYgKChs
ZW4gPSBzbnByaW50ZihidWYsIHNpemUsICIlcyVjLyVzIiwKKwkJCSAgICBGTkFNRV9ET01BSU5E
SVIsIGMsIHFyKSkgPj0gc2l6ZSkgeworCSAgICBmYXRhbCgiaW5zdWZmaWNpZW50IGJ1ZmZlciBz
aXplIGluIGhhc2hfcXVvdGEiLCBFQ19URU1QRkFJTCk7CisJfQorCSpwKysgPSAnISc7ICAvKiBy
ZWFzc2VtYmxlIGRvbWFpbiFxciAqLworCXFyID0gcDsKKwlidWYgKz0gbGVuOworCXNpemUgLT0g
bGVuOworCisJaWYgKCEqcXIpIHsKKwkgICAgLyogcXVvdGEgZm9yIGVudGlyZSBkb21haW4gKi8K
KwkgICAgaWYgKHNucHJpbnRmKGJ1Ziwgc2l6ZSwgIiVzcm9vdCIsIEZOQU1FX1FVT1RBRElSKSA+
PSBzaXplKSB7CisJCWZhdGFsKCJpbnN1ZmZpY2llbnQgYnVmZmVyIHNpemUgaW4gaGFzaF9xdW90
YSIsCisJCSAgICAgIEVDX1RFTVBGQUlMKTsKKwkgICAgfQorCSAgICByZXR1cm47CisJfQorICAg
IH0KKworICAgIGlkeCA9IHN0cmNocihxciwgJy4nKTsgLyogc2tpcCBwYXN0IHVzZXIuICovCisg
ICAgaWYgKGlkeCA9PSBOVUxMKSB7CisJaWR4ID0gcXI7CisgICAgfSBlbHNlIHsKKwlpZHgrKzsK
KyAgICB9CisgICAgYyA9IChjaGFyKSBkaXJfaGFzaF9jKGlkeCk7CisKKyAgICBpZiAoc25wcmlu
dGYoYnVmLCBzaXplLCAiJXMlYy8lcyIsIEZOQU1FX1FVT1RBRElSLCBjLCBxcikgPj0gc2l6ZSkg
eworCWZhdGFsKCJpbnN1ZmZpY2llbnQgYnVmZmVyIHNpemUgaW4gaGFzaF9xdW90YSIsIEVDX1RF
TVBGQUlMKTsKKyAgICB9Cit9CisKKy8qIG90aGVyIHJvdXRpbmVzIGNhbGwgdGhpcyBvbmUgd2hl
biB0aGV5IGZhaWwgKi8KK3N0YXRpYyBpbnQgYWJvcnRfc3VidHhuKGNoYXIgKmZuYW1lLCBzdHJ1
Y3Qgc3VidHhuICp0aWQpCit7CisgICAgaW50IHIgPSBDWVJVU0RCX09LOworCisgICAgYXNzZXJ0
KGZuYW1lICYmIHRpZCk7CisKKyAgICAvKiBjbGVhbnVwIGRvbmUgd2hpbGUgbG9jayBpcyBoZWxk
ICovCisgICAgaWYgKHRpZC0+Zm5hbWVuZXcpIHsKKwl1bmxpbmsodGlkLT5mbmFtZW5ldyk7CisJ
ZnJlZSh0aWQtPmZuYW1lbmV3KTsKKyAgICB9CisKKyAgICBpZiAodGlkLT5mZG5ldyAhPSAtMSkg
eworCXIgPSBjbG9zZSh0aWQtPmZkbmV3KTsKKyAgICB9CisKKyAgICBpZiAodGlkLT5mZCAhPSAt
MSkgeworCS8qIHJlbGVhc2UgbG9jayAqLworCXIgPSBsb2NrX3VubG9jayh0aWQtPmZkKTsKKwlp
ZiAociA9PSAtMSkgeworCSAgICBzeXNsb2coTE9HX0VSUiwgIklPRVJST1I6IHVubG9ja2luZyAl
czogJW0iLCBmbmFtZSk7CisJICAgIHIgPSBDWVJVU0RCX0lPRVJST1I7CisJfQorCisJLyogY2xv
c2UgKi8KKwlyID0gY2xvc2UodGlkLT5mZCk7CisJaWYgKHIgPT0gLTEpIHsKKwkgICAgc3lzbG9n
KExPR19FUlIsICJJT0VSUk9SOiBjbG9zaW5nICVzOiAlbSIsIGZuYW1lKTsKKwkgICAgciA9IENZ
UlVTREJfSU9FUlJPUjsKKwl9CisgICAgfQorCisgICAgZnJlZSh0aWQpOworCisgICAgcmV0dXJu
IHI7Cit9CisKK3N0YXRpYyBpbnQgY29tbWl0X3N1YnR4bihjaGFyICpmbmFtZSwgc3RydWN0IHN1
YnR4biAqdGlkKQoreworICAgIGludCB3cml0ZWZkOworICAgIGludCByID0gMDsKKyAgICBzdHJ1
Y3Qgc3RhdCBzYnVmOworCisgICAgYXNzZXJ0KGZuYW1lICYmIHRpZCk7CisKKyAgICBpZiAoKHdy
aXRlZmQgPSB0aWQtPmZkbmV3KSAhPSAtMSkgeworCS8qIHdlIHdyb3RlIHNvbWV0aGluZyAqLwor
CisJaWYgKGZzeW5jKHdyaXRlZmQpIHx8CisJICAgIGZzdGF0KHdyaXRlZmQsICZzYnVmKSA9PSAt
MSB8fAorCSAgICByZW5hbWUodGlkLT5mbmFtZW5ldywgZm5hbWUpID09IC0xIHx8CisJICAgIGxv
Y2tfdW5sb2NrKHdyaXRlZmQpID09IC0xKSB7CisJICAgIHN5c2xvZyhMT0dfRVJSLCAiSU9FUlJP
Ujogd3JpdGluZyAlczogJW0iLCB0aWQtPmZuYW1lbmV3KTsKKwkgICAgciA9IENZUlVTREJfSU9F
UlJPUjsKKwl9CisJY2xvc2Uod3JpdGVmZCk7CisJZnJlZSh0aWQtPmZuYW1lbmV3KTsKKyAgICB9
IGVsc2UgaWYgKHRpZC0+ZGVsZXRlKSB7CisJLyogZGVsZXRlIGZpbGUgKi8KKwlyID0gdW5saW5r
KGZuYW1lKTsKKwlpZiAociA9PSAtMSkgeworCSAgICBzeXNsb2coTE9HX0VSUiwgIklPRVJST1I6
IHVubGlua2luZyAlczogJW0iLCBmbmFtZSk7CisJICAgIHIgPSBDWVJVU0RCX0lPRVJST1I7CisJ
fQorICAgIH0gZWxzZSB7CisJLyogcmVhZC1vbmx5IHR4biAqLworICAgIH0KKworICAgIC8qIHJl
bGVhc2UgbG9jayAqLworICAgIGlmICh0aWQtPmZkICE9IC0xKSB7CisJciA9IGxvY2tfdW5sb2Nr
KHRpZC0+ZmQpOworCWlmIChyID09IC0xKSB7CisJICAgIHN5c2xvZyhMT0dfRVJSLCAiSU9FUlJP
UjogdW5sb2NraW5nICVzOiAlbSIsIGZuYW1lKTsKKwkgICAgciA9IENZUlVTREJfSU9FUlJPUjsK
Kwl9CisKKwlyID0gY2xvc2UodGlkLT5mZCk7CisJaWYgKHIgPT0gLTEpIHsKKwkgICAgc3lzbG9n
KExPR19FUlIsICJJT0VSUk9SOiBjbG9zaW5nICVzOiAlbSIsIGZuYW1lKTsKKwkgICAgciA9IENZ
UlVTREJfSU9FUlJPUjsKKwl9CisgICAgfQorCisgICAgZnJlZSh0aWQpOworCisgICAgcmV0dXJu
IHI7Cit9CisKK3N0YXRpYyB2b2lkIGZyZWVfZGIoc3RydWN0IGRiICpkYikKK3sKKyAgICBpZiAo
ZGIpIHsKKwlpZiAoZGItPnBhdGgpIGZyZWUoZGItPnBhdGgpOworCWlmIChkYi0+ZGF0YSkgZnJl
ZShkYi0+ZGF0YSk7CisJZnJlZV9oYXNoX3RhYmxlKCZkYi0+dGFibGUsIE5VTEwpOworCWZyZWUo
ZGIpOworICAgIH0KK30KKworc3RhdGljIHN0cnVjdCBzdWJ0eG4gKm5ld19zdWJ0eG4oY29uc3Qg
Y2hhciAqZm5hbWUsIGludCBmZCkKK3sKKyAgICBzdHJ1Y3Qgc3VidHhuICpyZXQgPSAoc3RydWN0
IHN1YnR4biAqKSB4bWFsbG9jKHNpemVvZihzdHJ1Y3Qgc3VidHhuKSk7CisKKyAgICByZXQtPmZk
ID0gZmQ7CisgICAgcmV0LT5mbmFtZW5ldyA9IE5VTEw7CisgICAgcmV0LT5mZG5ldyA9IC0xOwor
ICAgIHJldC0+ZGVsZXRlID0gMDsKKyAgICByZXR1cm4gcmV0OworfQorCitzdGF0aWMgaW50IGlu
aXQoY29uc3QgY2hhciAqZGJkaXIgX19hdHRyaWJ1dGVfXygodW51c2VkKSksCisJCWludCBteWZs
YWdzIF9fYXR0cmlidXRlX18oKHVudXNlZCkpKQoreworICAgIHJldHVybiAwOworfQorCitzdGF0
aWMgaW50IGRvbmUodm9pZCkKK3sKKyAgICByZXR1cm4gMDsKK30KKworc3RhdGljIGludCBteXN5
bmModm9pZCkKK3sKKyAgICByZXR1cm4gMDsKK30KKworc3RhdGljIGludCBteWFyY2hpdmUoY29u
c3QgY2hhciAqKmZuYW1lcywgY29uc3QgY2hhciAqZGlybmFtZSkKK3sKKyAgICByZXR1cm4gMDsK
K30KKworc3RhdGljIGludCBteW9wZW4oY29uc3QgY2hhciAqZm5hbWUsIGludCBmbGFncywgc3Ry
dWN0IGRiICoqcmV0KQoreworICAgIHN0cnVjdCBkYiAqZGIgPSAoc3RydWN0IGRiICopIHh6bWFs
bG9jKHNpemVvZihzdHJ1Y3QgZGIpKTsKKyAgICBzdHJ1Y3Qgc3RhdCBzYnVmOworICAgIGNoYXIg
KnA7CisgICAgaW50IHI7CisKKyAgICBhc3NlcnQoZm5hbWUgJiYgcmV0KTsKKworICAgIGRiLT5w
YXRoID0geHN0cmR1cChmbmFtZSk7CisgICAgY29uc3RydWN0X2hhc2hfdGFibGUoJmRiLT50YWJs
ZSwgMzIsIDApOworCisgICAgLyogc3RyaXAgYW55IGZpbGVuYW1lIGZyb20gdGhlIHBhdGggKi8K
KyAgICBpZiAocCA9IHN0cnJjaHIoZGItPnBhdGgsICcvJykpICpwID0gJ1wwJzsKKworICAgIHIg
PSBzdGF0KGRiLT5wYXRoLCAmc2J1Zik7CisgICAgaWYgKHIgPT0gLTEgJiYgZXJybm8gPT0gRU5P
RU5UICYmIChmbGFncyAmIENZUlVTREJfQ1JFQVRFKSkgeworCWlmIChjeXJ1c19ta2RpcihmbmFt
ZSwgMDc1NSkgIT0gLTEpIHsKKwkgICAgciA9IHN0YXQoZGItPnBhdGgsICZzYnVmKTsKKwl9Cisg
ICAgfQorCisgICAgaWYgKHIgPT0gLTEpIHsKKwlpbnQgbGV2ZWwgPSAoZmxhZ3MgJiBDWVJVU0RC
X0NSRUFURSkgPyBMT0dfRVJSIDogTE9HX0RFQlVHOworCXN5c2xvZyhsZXZlbCwgIklPRVJST1I6
IHN0YXRpbmcgJXM6ICVtIiwgZGItPnBhdGgpOworCWZyZWVfZGIoZGIpOworCXJldHVybiBDWVJV
U0RCX0lPRVJST1I7CisgICAgfQorCisgICAgKnJldCA9IGRiOworICAgIHJldHVybiAwOworfQor
CitzdGF0aWMgaW50IG15Y2xvc2Uoc3RydWN0IGRiICpkYikKK3sKKyAgICBhc3NlcnQoZGIpOwor
CisgICAgZnJlZV9kYihkYik7CisKKyAgICByZXR1cm4gMDsKK30KKworc3RhdGljIGludCBteWZl
dGNoKHN0cnVjdCBkYiAqZGIsIGNoYXIgKnF1b3RhX3BhdGgsCisJCSAgIGNvbnN0IGNoYXIgKipk
YXRhLCBpbnQgKmRhdGFsZW4sCisJCSAgIHN0cnVjdCB0eG4gKip0aWQpCit7CisgICAgc3RydWN0
IHN1YnR4biAqbXl0aWQgPSBOVUxMOworICAgIGludCBxdW90YV9mZDsKKyAgICBjb25zdCBjaGFy
ICpxdW90YV9iYXNlID0gMDsKKyAgICB1bnNpZ25lZCBsb25nIHF1b3RhX2xlbiA9IDA7CisKKyAg
ICBhc3NlcnQoZGIpOworCisgICAgaWYgKGRhdGEpICpkYXRhID0gTlVMTDsKKyAgICBpZiAoZGF0
YWxlbikgKmRhdGFsZW4gPSAwOworCisgICAgaWYgKCFkYXRhKSB7CisJLyoganVzdCBjaGVjayBp
ZiB0aGUga2V5IGV4aXN0cyAqLworCXN0cnVjdCBzdGF0IHNidWY7CisKKwlpZiAoc3RhdChxdW90
YV9wYXRoLCAmc2J1ZikgPT0gLTEpCisJICAgIHJldHVybiBDWVJVU0RCX05PVEZPVU5EOworCisJ
cmV0dXJuIDA7CisgICAgfQorCisgICAgaWYgKHRpZCkgeworCWlmICghKnRpZCkKKwkgICAgKnRp
ZCA9IChzdHJ1Y3QgdHhuICopICZkYi0+dGFibGU7CisJZWxzZQorCSAgICBteXRpZCA9IChzdHJ1
Y3Qgc3VidHhuICopIGhhc2hfbG9va3VwKHF1b3RhX3BhdGgsICZkYi0+dGFibGUpOworICAgIH0K
KworICAgIC8qIG9wZW4gYW5kIGxvY2sgZmlsZSwgaWYgbmVlZGVkICovCisgICAgaWYgKCFteXRp
ZCkgeworCXF1b3RhX2ZkID0gb3BlbihxdW90YV9wYXRoLCBPX1JEV1IsIDApOworCWlmIChxdW90
YV9mZCA9PSAtMSkgeworCSAgICBpZiAoZXJybm8gPT0gRU5PRU5UKSB7CisJCS8qIGtleSBkb2Vz
bid0IGV4aXN0ICovCisJCXJldHVybiBDWVJVU0RCX05PVEZPVU5EOworCSAgICB9CisKKwkgICAg
c3lzbG9nKExPR19FUlIsICJJT0VSUk9SOiBvcGVuaW5nIHF1b3RhIGZpbGUgJXM6ICVtIiwgcXVv
dGFfcGF0aCk7CisJICAgIHJldHVybiBDWVJVU0RCX0lPRVJST1I7CisJfQorCisJaWYgKHRpZCkg
eworCSAgICBpbnQgcjsKKwkgICAgc3RydWN0IHN0YXQgc2J1ZjsKKwkgICAgY29uc3QgY2hhciAq
bG9ja2ZhaWxhY3Rpb247CisKKwkgICAgciA9IGxvY2tfcmVvcGVuKHF1b3RhX2ZkLCBxdW90YV9w
YXRoLCAmc2J1ZiwgJmxvY2tmYWlsYWN0aW9uKTsKKwkgICAgaWYgKHIgPT0gLTEpIHsKKwkJc3lz
bG9nKExPR19FUlIsICJJT0VSUk9SOiAlcyBxdW90YSAlczogJW0iLCBsb2NrZmFpbGFjdGlvbiwK
KwkJICAgICAgIHF1b3RhX3BhdGgpOworCQlyZXR1cm4gQ1lSVVNEQl9JT0VSUk9SOworCSAgICB9
CisKKwkgICAgbXl0aWQgPSBuZXdfc3VidHhuKHF1b3RhX3BhdGgsIHF1b3RhX2ZkKTsKKwkgICAg
aGFzaF9pbnNlcnQocXVvdGFfcGF0aCwgbXl0aWQsICZkYi0+dGFibGUpOworCX0KKyAgICB9Cisg
ICAgZWxzZQorCXF1b3RhX2ZkID0gbXl0aWQtPmZkOworCisgICAgbWFwX3JlZnJlc2gocXVvdGFf
ZmQsIDEsICZxdW90YV9iYXNlLCAmcXVvdGFfbGVuLAorCQlNQVBfVU5LTk9XTl9MRU4sIHF1b3Rh
X3BhdGgsIDApOworCisgICAgaWYgKHF1b3RhX2xlbikgeworCWNoYXIgKnAsICplb2w7CisKKwlk
Yi0+ZGF0YSA9IHhyZWFsbG9jKGRiLT5kYXRhLCBxdW90YV9sZW4pOworCW1lbWNweShkYi0+ZGF0
YSwgcXVvdGFfYmFzZSwgcXVvdGFfbGVuKTsKKworCXAgPSBkYi0+ZGF0YTsKKwllb2wgPSBtZW1j
aHIocCwgJ1xuJywgcXVvdGFfbGVuIC0gKHAgLSBkYi0+ZGF0YSkpOworCWlmICghZW9sKSB7CisJ
ICAgIG1hcF9mcmVlKCZxdW90YV9iYXNlLCAmcXVvdGFfbGVuKTsKKwkgICAgcmV0dXJuIENZUlVT
REJfSU9FUlJPUjsKKwl9CisJLyogY29udmVydCB0aGUgc2VwYXJhdGluZyBcbiB0byBTUCAqLwor
CSplb2wgPSAnICc7CisKKwlwID0gZW9sICsgMTsKKwllb2wgPSBtZW1jaHIocCwgJ1xuJywgcXVv
dGFfbGVuIC0gKHAgLSBkYi0+ZGF0YSkpOworCWlmICghZW9sKSB7CisJICAgIG1hcF9mcmVlKCZx
dW90YV9iYXNlLCAmcXVvdGFfbGVuKTsKKwkgICAgcmV0dXJuIENZUlVTREJfSU9FUlJPUjsKKwl9
CisJLyogY29udmVydCB0aGUgdGVybWluYXRpbmcgXG4gdG8gXDAgKi8KKwkqZW9sID0gJ1wwJzsK
KworCSpkYXRhID0gZGItPmRhdGE7CisJKmRhdGFsZW4gPSBzdHJsZW4oZGItPmRhdGEpOworICAg
IH0KKworICAgIG1hcF9mcmVlKCZxdW90YV9iYXNlLCAmcXVvdGFfbGVuKTsKKyAgICBpZiAoIXRp
ZCkgY2xvc2UocXVvdGFfZmQpOworCisgICAgcmV0dXJuIDA7Cit9CisKK3N0YXRpYyBpbnQgZmV0
Y2goc3RydWN0IGRiICpkYiwgCisJCSBjb25zdCBjaGFyICprZXksIGludCBrZXlsZW4sCisJCSBj
b25zdCBjaGFyICoqZGF0YSwgaW50ICpkYXRhbGVuLAorCQkgc3RydWN0IHR4biAqKnRpZCkKK3sK
KyAgICBjaGFyIHF1b3RhX3BhdGhbTUFYX1FVT1RBX1BBVEgrMV0sICp0bXBrZXkgPSBOVUxMOwor
CisgICAgLyogaWYgd2UgbmVlZCB0byB0cnVuY2F0ZSB0aGUga2V5LCBkbyBzbyAqLworICAgIGlm
IChrZXlba2V5bGVuXSAhPSAnXDAnKSB7CisJdG1wa2V5ID0geG1hbGxvYyhrZXlsZW4gKyAxKTsK
KwltZW1jcHkodG1wa2V5LCBrZXksIGtleWxlbik7CisJdG1wa2V5W2tleWxlbl0gPSAnXDAnOwor
CWtleSA9IHRtcGtleTsKKyAgICB9CisKKyAgICBoYXNoX3F1b3RhKHF1b3RhX3BhdGgsIHNpemVv
ZihxdW90YV9wYXRoKSwga2V5LCBkYi0+cGF0aCk7CisgICAgaWYgKHRtcGtleSkgZnJlZSh0bXBr
ZXkpOworCisgICAgcmV0dXJuIG15ZmV0Y2goZGIsIHF1b3RhX3BhdGgsIGRhdGEsIGRhdGFsZW4s
IHRpZCk7Cit9CisKK3N0YXRpYyBpbnQgZm9yZWFjaChzdHJ1Y3QgZGIgKmRiLAorCQkgICBjaGFy
ICpwcmVmaXgsIGludCBwcmVmaXhsZW4sCisJCSAgIGZvcmVhY2hfcCAqZ29vZHAsCisJCSAgIGZv
cmVhY2hfY2IgKmNiLCB2b2lkICpyb2NrLCAKKwkJICAgc3RydWN0IHR4biAqKnRpZCkKK3sKKyAg
ICBpbnQgciA9IENZUlVTREJfT0s7CisgICAgaW50IGNvbmZpZ192aXJ0ZG9tYWlucyA9IGxpYmN5
cnVzX2NvbmZpZ19nZXRzd2l0Y2goQ1lSVVNPUFRfVklSVERPTUFJTlMpOworICAgIGNoYXIgcXVv
dGFfcGF0aFtNQVhfUVVPVEFfUEFUSCsxXTsKKyAgICBnbG9iX3QgZ2xvYmJ1ZjsKKyAgICBpbnQg
aTsKKyAgICBjaGFyICp0bXBwcmVmaXggPSBOVUxMLCAqcCA9IE5VTEw7CisKKyAgICAvKiBpZiB3
ZSBuZWVkIHRvIHRydW5jYXRlIHRoZSBwcmVmaXgsIGRvIHNvICovCisgICAgaWYgKHByZWZpeFtw
cmVmaXhsZW5dICE9ICdcMCcpIHsKKwl0bXBwcmVmaXggPSB4bWFsbG9jKHByZWZpeGxlbiArIDEp
OworCW1lbWNweSh0bXBwcmVmaXgsIHByZWZpeCwgcHJlZml4bGVuKTsKKwl0bXBwcmVmaXhbcHJl
Zml4bGVuXSA9ICdcMCc7CisJcHJlZml4ID0gdG1wcHJlZml4OworICAgIH0KKworICAgIGhhc2hf
cXVvdGEocXVvdGFfcGF0aCwgc2l6ZW9mKHF1b3RhX3BhdGgpLCBwcmVmaXgsIGRiLT5wYXRoKTsK
KyAgICBpZiAoY29uZmlnX3ZpcnRkb21haW5zICYmIChwID0gc3RyY2hyKHByZWZpeCwgJyEnKSkp
CisJcHJlZml4ID0gcCArIDE7CisKKyAgICAvKiBzdHJpcCBvZmYgdGhlIHFyIHNwZWNpZmljIHBh
dGggYW5kIHJlcGxhY2Ugd2l0aCBwYXR0ZXJuICovCisgICAgc3ByaW50ZihzdHJzdHIocXVvdGFf
cGF0aCwgRk5BTUVfUVVPVEFESVIpICsgc3RybGVuKEZOQU1FX1FVT1RBRElSKSwKKwkgICAgIiov
JXMqIiwgcHJlZml4KTsKKworICAgIC8qIHNlYXJjaCBmb3IgdGhlIHF1b3Rhcm9vdHMgKi8KKyAg
ICBnbG9iKHF1b3RhX3BhdGgsIDAsIE5VTEwsICZnbG9iYnVmKTsKKworICAgIGlmIChjb25maWdf
dmlydGRvbWFpbnMpIHsKKwlpZiAoIXByZWZpeGxlbikgeworCSAgICAvKiBzZWFyY2ggZm9yIGFs
bCB2aXJ0ZG9tYWluIHF1b3Rhcm9vdHMgKi8KKwkgICAgc25wcmludGYocXVvdGFfcGF0aCwgc2l6
ZW9mKHF1b3RhX3BhdGgpLCAiJXMlcyovKiVzKi8qIiwKKwkJICAgICBkYi0+cGF0aCwgRk5BTUVf
RE9NQUlORElSLCBGTkFNRV9RVU9UQURJUik7CisJICAgIGdsb2IocXVvdGFfcGF0aCwgR0xPQl9B
UFBFTkQsIE5VTEwsICZnbG9iYnVmKTsKKworCSAgICAvKiBzZWFyY2ggZm9yIGFsbCBkb21haW4g
cXVvdGFzICovCisJICAgIHNucHJpbnRmKHF1b3RhX3BhdGgsIHNpemVvZihxdW90YV9wYXRoKSwg
IiVzJXMqLyolc3Jvb3QiLAorCQkgICAgIGRiLT5wYXRoLCBGTkFNRV9ET01BSU5ESVIsIEZOQU1F
X1FVT1RBRElSKTsKKwkgICAgZ2xvYihxdW90YV9wYXRoLCBHTE9CX0FQUEVORCwgTlVMTCwgJmds
b2JidWYpOworCX0KKwllbHNlIGlmICghc3RybGVuKHByZWZpeCkpIHsKKwkgICAgLyogc2VhcmNo
IGZvciB0aGUgZG9tYWluIHF1b3RhcyAqLworCSAgICBzdHJjcHkoc3Ryc3RyKHF1b3RhX3BhdGgs
IEZOQU1FX1FVT1RBRElSKSArIHN0cmxlbihGTkFNRV9RVU9UQURJUiksCisJCSAgICJyb290Iik7
CisJICAgIGdsb2IocXVvdGFfcGF0aCwgR0xPQl9BUFBFTkQsIE5VTEwsICZnbG9iYnVmKTsKKwl9
CisgICAgfQorICAgIGlmICh0bXBwcmVmaXgpIGZyZWUodG1wcHJlZml4KTsKKworICAgIGlmICh0
aWQgJiYgISp0aWQpICp0aWQgPSAoc3RydWN0IHR4biAqKSAmZGItPnRhYmxlOworCisgICAgZm9y
IChpID0gMDsgaSA8IGdsb2JidWYuZ2xfcGF0aGM7IGkrKykgeworCWNvbnN0IGNoYXIgKmRhdGE7
CisJY2hhciAqcXIsICprZXk7CisJc2l6ZV90IGtleWxlbiwgZGF0YWxlbjsKKworCXIgPSBteWZl
dGNoKGRiLCBnbG9iYnVmLmdsX3BhdGh2W2ldLCAmZGF0YSwgJmRhdGFsZW4sIHRpZCk7CisJaWYg
KHIpIGJyZWFrOworCisJcXIgPSBzdHJyY2hyKGdsb2JidWYuZ2xfcGF0aHZbaV0sICcvJykgKyAx
OworCWlmIChwID0gc3Ryc3RyKGdsb2JidWYuZ2xfcGF0aHZbaV0sIEZOQU1FX0RPTUFJTkRJUikp
IHsKKwkgICAgLyogdXNlIHRoZSBxdW90YV9wYXRoIGFzIGEgYnVmZmVyIHRvIGNvbnN0cnVjdCB2
aXJ0ZG9tYWluIHFyICovCisJICAgIHAgKz0gc3RybGVuKEZOQU1FX0RPTUFJTkRJUikgKyAyOyAv
KiArMiBmb3IgaGFzaGRpciAqLworCSAgICBzcHJpbnRmKHF1b3RhX3BhdGgsICIlLipzISVzIiwg
c3RyY3NwbihwLCAiLyIpLCBwLAorCQkgICAgc3RyY21wKHFyLCAicm9vdCIpID8gcXIgOiAiIik7
CisJICAgIGtleSA9IHF1b3RhX3BhdGg7CisJfQorCWVsc2UKKwkgICAga2V5ID0gcXI7CisKKwlr
ZXlsZW4gPSBzdHJsZW4oa2V5KTsKKworCWlmIChnb29kcChyb2NrLCBrZXksIGtleWxlbiwgZGF0
YSwgZGF0YWxlbikpIHsKKwkgICAgLyogbWFrZSBjYWxsYmFjayAqLworCSAgICByID0gY2Iocm9j
aywga2V5LCBrZXlsZW4sIGRhdGEsIGRhdGFsZW4pOworCSAgICBpZiAocikgYnJlYWs7CisJfQor
ICAgIH0KKworICAgIGdsb2JmcmVlKCZnbG9iYnVmKTsKKworICAgIHJldHVybiByOworfQorCitz
dGF0aWMgaW50IG15c3RvcmUoc3RydWN0IGRiICpkYiwgCisJCSAgIGNvbnN0IGNoYXIgKmtleSwg
aW50IGtleWxlbiwKKwkJICAgY29uc3QgY2hhciAqZGF0YSwgaW50IGRhdGFsZW4sCisJCSAgIHN0
cnVjdCB0eG4gKip0aWQsIGludCBvdmVyd3JpdGUpCit7CisgICAgY2hhciBxdW90YV9wYXRoW01B
WF9RVU9UQV9QQVRIKzFdLCAqdG1wa2V5ID0gTlVMTDsKKyAgICBzdHJ1Y3Qgc3VidHhuICpteXRp
ZCA9IE5VTEw7CisgICAgaW50IHIgPSAwOworCisgICAgLyogaWYgd2UgbmVlZCB0byB0cnVuY2F0
ZSB0aGUga2V5LCBkbyBzbyAqLworICAgIGlmIChrZXlba2V5bGVuXSAhPSAnXDAnKSB7CisJdG1w
a2V5ID0geG1hbGxvYyhrZXlsZW4gKyAxKTsKKwltZW1jcHkodG1wa2V5LCBrZXksIGtleWxlbik7
CisJdG1wa2V5W2tleWxlbl0gPSAnXDAnOworCWtleSA9IHRtcGtleTsKKyAgICB9CisKKyAgICBo
YXNoX3F1b3RhKHF1b3RhX3BhdGgsIHNpemVvZihxdW90YV9wYXRoKSwga2V5LCBkYi0+cGF0aCk7
CisgICAgaWYgKHRtcGtleSkgZnJlZSh0bXBrZXkpOworCisgICAgaWYgKHRpZCkgeworCWlmICgh
KnRpZCkKKwkgICAgKnRpZCA9IChzdHJ1Y3QgdHhuICopICZkYi0+dGFibGU7CisJZWxzZQorCSAg
ICBteXRpZCA9IChzdHJ1Y3Qgc3VidHhuICopIGhhc2hfbG9va3VwKHF1b3RhX3BhdGgsICZkYi0+
dGFibGUpOworICAgIH0KKworICAgIC8qIG9wZW4gYW5kIGxvY2sgZmlsZSwgaWYgbmVlZGVkICov
CisgICAgaWYgKCFteXRpZCkgeworCWludCBmZDsKKwlzdHJ1Y3Qgc3RhdCBzYnVmOworCWNvbnN0
IGNoYXIgKmxvY2tmYWlsYWN0aW9uOworCisJZmQgPSBvcGVuKHF1b3RhX3BhdGgsIE9fUkRXUiwg
MDY0NCk7CisJaWYgKGZkID09IC0xICYmIGVycm5vID09IEVOT0VOVCAmJiBkYXRhKSB7CisJICAg
IGlmIChjeXJ1c19ta2RpcihxdW90YV9wYXRoLCAwNzU1KSAhPSAtMSkgeworCQlmZCA9IG9wZW4o
cXVvdGFfcGF0aCwgT19SRFdSIHwgT19DUkVBVCwgMDY0NCk7CisJICAgIH0KKwl9CisJaWYgKGZk
ID09IC0xICYmIChlcnJubyAhPSBFTk9FTlQgfHwgZGF0YSkpIHsKKwkgICAgc3lzbG9nKExPR19F
UlIsICJJT0VSUk9SOiBvcGVuaW5nIHF1b3RhIGZpbGUgJXM6ICVtIiwgcXVvdGFfcGF0aCk7CisJ
ICAgIHJldHVybiBDWVJVU0RCX0lPRVJST1I7CisJfQorCisJaWYgKGZkICE9IC0xKSB7CisJICAg
IHIgPSBsb2NrX3Jlb3BlbihmZCwgcXVvdGFfcGF0aCwgJnNidWYsICZsb2NrZmFpbGFjdGlvbik7
CisJICAgIGlmIChyID09IC0xKSB7CisJCXN5c2xvZyhMT0dfRVJSLCAiSU9FUlJPUjogJXMgcXVv
dGEgJXM6ICVtIiwgbG9ja2ZhaWxhY3Rpb24sCisJCSAgICAgICBxdW90YV9wYXRoKTsKKwkJcmV0
dXJuIENZUlVTREJfSU9FUlJPUjsKKwkgICAgfQorCX0KKworCW15dGlkID0gbmV3X3N1YnR4bihx
dW90YV9wYXRoLCBmZCk7CisKKwlpZiAodGlkKQorCSAgICBoYXNoX2luc2VydChxdW90YV9wYXRo
LCBteXRpZCwgJmRiLT50YWJsZSk7CisgICAgfQorCisgICAgaWYgKCFkYXRhKSB7CisJbXl0aWQt
PmRlbGV0ZSA9IDE7CisgICAgfQorICAgIGVsc2UgeworCWNoYXIgbmV3X3F1b3RhX3BhdGhbTUFY
X1FVT1RBX1BBVEgrMV0sICpidWYsICpwOworCWludCBuZXdmZCA9IC0xLCByMTs7CisKKwlpZiAo
bXl0aWQtPmZkICE9IC0xICYmICFvdmVyd3JpdGUpIHsKKwkgICAgaWYgKHRpZCkKKwkJYWJvcnRf
dHhuKGRiLCAqdGlkKTsKKwkgICAgZWxzZQorCQlhYm9ydF9zdWJ0eG4ocXVvdGFfcGF0aCwgbXl0
aWQpOworCSAgICByZXR1cm4gQ1lSVVNEQl9FWElTVFM7CisJfQorCisJc3RybGNweShuZXdfcXVv
dGFfcGF0aCwgcXVvdGFfcGF0aCwgc2l6ZW9mKG5ld19xdW90YV9wYXRoKSk7CisJc3RybGNhdChu
ZXdfcXVvdGFfcGF0aCwgIi5ORVciLCBzaXplb2YobmV3X3F1b3RhX3BhdGgpKTsKKworCXVubGlu
ayhuZXdfcXVvdGFfcGF0aCk7CisJbmV3ZmQgPSBvcGVuKG5ld19xdW90YV9wYXRoLCBPX0NSRUFU
IHwgT19UUlVOQyB8IE9fUkRXUiwgMDY2Nik7CisJaWYgKG5ld2ZkID09IC0xICYmIGVycm5vID09
IEVOT0VOVCkgeworCSAgICBpZiAoY3lydXNfbWtkaXIobmV3X3F1b3RhX3BhdGgsIDA3NTUpICE9
IC0xKQorCQluZXdmZCA9IG9wZW4obmV3X3F1b3RhX3BhdGgsIE9fQ1JFQVQgfCBPX1RSVU5DIHwg
T19SRFdSLCAwNjY2KTsKKwl9CisJaWYgKG5ld2ZkID09IC0xKSB7CisJICAgIHN5c2xvZyhMT0df
RVJSLCAiSU9FUlJPUjogY3JlYXRpbmcgcXVvdGEgZmlsZSAlczogJW0iLAorCQkgICBuZXdfcXVv
dGFfcGF0aCk7CisJICAgIGlmICh0aWQpCisJCWFib3J0X3R4bihkYiwgKnRpZCk7CisJICAgIGVs
c2UKKwkJYWJvcnRfc3VidHhuKHF1b3RhX3BhdGgsIG15dGlkKTsKKwkgICAgcmV0dXJuIENZUlVT
REJfSU9FUlJPUjsKKwl9CisKKwlteXRpZC0+ZmRuZXcgPSBuZXdmZDsKKwlyID0gbG9ja19ibG9j
a2luZyhuZXdmZCk7CisJaWYgKHIpIHsKKwkgICAgc3lzbG9nKExPR19FUlIsICJJT0VSUk9SOiBs
b2NraW5nIHF1b3RhIGZpbGUgJXM6ICVtIiwKKwkJICAgbmV3X3F1b3RhX3BhdGgpOworCSAgICBp
ZiAodGlkKQorCQlhYm9ydF90eG4oZGIsICp0aWQpOworCSAgICBlbHNlCisJCWFib3J0X3N1YnR4
bihxdW90YV9wYXRoLCBteXRpZCk7CisJICAgIHJldHVybiBDWVJVU0RCX0lPRVJST1I7CisJfQor
CisJYnVmID0geG1hbGxvYyhkYXRhbGVuKzEpOworCW1lbWNweShidWYsIGRhdGEsIGRhdGFsZW4p
OworCS8qIGNvbnZlcnQgc2VwYXJhdGluZyBTUCB0byBcbiAqLworCXAgPSBtZW1jaHIoYnVmLCAn
ICcsIGRhdGFsZW4pOworCSpwID0gJ1xuJzsKKwkvKiBhZGQgYSB0ZXJtaW5hdGluZyBcbiAqLwor
CWJ1ZltkYXRhbGVuXSA9ICdcbic7CisKKwlyMSA9IHdyaXRlKG5ld2ZkLCBidWYsIGRhdGFsZW4r
MSk7CisJZnJlZShidWYpOworCisJaWYgKHIxID09IC0xKSB7CisJICAgIHN5c2xvZyhMT0dfRVJS
LCAiSU9FUlJPUjogd3JpdGluZyBxdW90YSBmaWxlICVzOiAlbSIsCisJCSAgIG5ld19xdW90YV9w
YXRoKTsKKwkgICAgaWYgKHRpZCkKKwkJYWJvcnRfdHhuKGRiLCAqdGlkKTsKKwkgICAgZWxzZQor
CQlhYm9ydF9zdWJ0eG4ocXVvdGFfcGF0aCwgbXl0aWQpOworCSAgICByZXR1cm4gQ1lSVVNEQl9J
T0VSUk9SOworCX0KKworCWlmICghbXl0aWQtPmZuYW1lbmV3KQorCSAgICBteXRpZC0+Zm5hbWVu
ZXcgPSB4c3RyZHVwKG5ld19xdW90YV9wYXRoKTsKKyAgICB9CisKKyAgICBpZiAoIXRpZCkgewor
CS8qIGNvbW1pdCBpbW1lZGlhdGVseSAqLworCXIgPSBjb21taXRfc3VidHhuKHF1b3RhX3BhdGgs
IG15dGlkKTsKKyAgICB9CisKKyAgICByZXR1cm4gcjsKK30KKworc3RhdGljIGludCBjcmVhdGUo
c3RydWN0IGRiICpkYiwgCisJCSAgY29uc3QgY2hhciAqa2V5LCBpbnQga2V5bGVuLAorCQkgIGNv
bnN0IGNoYXIgKmRhdGEsIGludCBkYXRhbGVuLAorCQkgIHN0cnVjdCB0eG4gKip0aWQpCit7Cisg
ICAgcmV0dXJuIG15c3RvcmUoZGIsIGtleSwga2V5bGVuLCBkYXRhLCBkYXRhbGVuLCB0aWQsIDAp
OworfQorCitzdGF0aWMgaW50IHN0b3JlKHN0cnVjdCBkYiAqZGIsIAorCQkgY29uc3QgY2hhciAq
a2V5LCBpbnQga2V5bGVuLAorCQkgY29uc3QgY2hhciAqZGF0YSwgaW50IGRhdGFsZW4sCisJCSBz
dHJ1Y3QgdHhuICoqdGlkKQoreworICAgIHJldHVybiBteXN0b3JlKGRiLCBrZXksIGtleWxlbiwg
ZGF0YSwgZGF0YWxlbiwgdGlkLCAxKTsKK30KKworc3RhdGljIGludCBkZWxldGUoc3RydWN0IGRi
ICpkYiwgCisJCSAgY29uc3QgY2hhciAqa2V5LCBpbnQga2V5bGVuLAorCQkgIHN0cnVjdCB0eG4g
KipteXRpZCwgaW50IGZvcmNlIF9fYXR0cmlidXRlX18oKHVudXNlZCkpKQoreworICAgIHJldHVy
biBteXN0b3JlKGRiLCBrZXksIGtleWxlbiwgTlVMTCwgMCwgbXl0aWQsIDEpOworfQorCitzdHJ1
Y3QgdHhuX3JvY2sgeworICAgIGhhc2hfdGFibGUgKnRhYmxlOworICAgIGludCAoKmZ1bmMpKGNo
YXIgKiwgc3RydWN0IHN1YnR4biAqKTsKKyAgICBpbnQgcmV0OworfTsKKworc3RhdGljIHZvaWQg
ZW51bV9mdW5jKGNoYXIgKmZuYW1lLCB2b2lkICpkYXRhLCB2b2lkICpyb2NrKQoreworICAgIHN0
cnVjdCB0eG5fcm9jayAqdHJvY2sgPSAoc3RydWN0IHR4bl9yb2NrICopIHJvY2s7CisgICAgaW50
IHI7CisKKyAgICByID0gdHJvY2stPmZ1bmMoZm5hbWUsIChzdHJ1Y3Qgc3VidHhuICopIGRhdGEp
OworICAgIGhhc2hfZGVsKGZuYW1lLCB0cm9jay0+dGFibGUpOworCisgICAgaWYgKHIgJiYgIXRy
b2NrLT5yZXQpIHRyb2NrLT5yZXQgPSByOworfQorCitpbnQgY29tbWl0X3R4bihzdHJ1Y3QgZGIg
KmRiLCBzdHJ1Y3QgdHhuICp0aWQpCit7CisgICAgc3RydWN0IHR4bl9yb2NrIHRyb2NrOworCisg
ICAgdHJvY2sudGFibGUgPSAoaGFzaF90YWJsZSAqKSB0aWQ7CisgICAgdHJvY2suZnVuYyA9IGNv
bW1pdF9zdWJ0eG47CisgICAgdHJvY2sucmV0ID0gMDsKKworICAgIGhhc2hfZW51bWVyYXRlKCho
YXNoX3RhYmxlICopIHRpZCwgZW51bV9mdW5jLCAmdHJvY2spOworCisgICAgcmV0dXJuIHRyb2Nr
LnJldDsKK30KKworaW50IGFib3J0X3R4bihzdHJ1Y3QgZGIgKmRiLCBzdHJ1Y3QgdHhuICp0aWQp
Cit7CisgICAgc3RydWN0IHR4bl9yb2NrIHRyb2NrOworCisgICAgdHJvY2sudGFibGUgPSAoaGFz
aF90YWJsZSAqKSB0aWQ7CisgICAgdHJvY2suZnVuYyA9IGFib3J0X3N1YnR4bjsKKyAgICB0cm9j
ay5yZXQgPSAwOworCisgICAgaGFzaF9lbnVtZXJhdGUoKGhhc2hfdGFibGUgKikgdGlkLCBlbnVt
X2Z1bmMsICZ0cm9jayk7CisKKyAgICByZXR1cm4gdHJvY2sucmV0OworfQorCitzdHJ1Y3QgY3ly
dXNkYl9iYWNrZW5kIGN5cnVzZGJfcXVvdGFsZWdhY3kgPSAKK3sKKyAgICAicXVvdGFsZWdhY3ki
LAkJCS8qIG5hbWUgKi8KKworICAgICZpbml0LAorICAgICZkb25lLAorICAgICZteXN5bmMsCisg
ICAgJm15YXJjaGl2ZSwKKworICAgICZteW9wZW4sCisgICAgJm15Y2xvc2UsCisKKyAgICAmZmV0
Y2gsCisgICAgJmZldGNoLAorICAgICZmb3JlYWNoLAorICAgICZjcmVhdGUsCisgICAgJnN0b3Jl
LAorICAgICZkZWxldGUsCisKKyAgICAmY29tbWl0X3R4biwKKyAgICAmYWJvcnRfdHhuLAorCisg
ICAgTlVMTCwKKyAgICBOVUxMCit9OwpJbmRleDogbGliL2ltYXBvcHRpb25zCj09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0K
UkNTIGZpbGU6IC9hZnMvYW5kcmV3L3N5c3RlbS9jdnMvc3JjL2N5cnVzL2xpYi9pbWFwb3B0aW9u
cyx2CnJldHJpZXZpbmcgcmV2aXNpb24gMS44CmRpZmYgLXUgLXIxLjggaW1hcG9wdGlvbnMKLS0t
IGxpYi9pbWFwb3B0aW9ucwkxNSBEZWMgMjAwMyAyMDowMDo0MiAtMDAwMAkxLjgKKysrIGxpYi9p
bWFwb3B0aW9ucwkxNiBEZWMgMjAwMyAyMTozMTo1MCAtMDAwMApAQCAtNDc1LDYgKzQ3NSw5IEBA
CiAgICBmb3JjZSB0aGUgJy8nIGluIEtlcmJlcm9zIDUgcHJpbmNpcGFscyB0byBiZSBjYW5vbmlj
YWxpemVkIHRvIGEgJy4nCiAgICAodG8gbWFrZSBQVFMgbG9va3VwcyBlYXNpZXIpICovCiAKK3sg
InF1b3RhX2RiIiwgInF1b3RhbGVnYWN5IiwgU1RSSU5HTElTVCgiZmxhdCIsICJiZXJrZWxleSIs
ICJza2lwbGlzdCIsICJxdW90YWxlZ2FjeSIpfQorLyogVGhlIGN5cnVzZGIgYmFja2VuZCB0byB1
c2UgZm9yIHF1b3Rhcy4gKi8KKwogeyAicXVvdGF3YXJuIiwgOTAsIElOVCB9CiAvKiBUaGUgcGVy
Y2VudCBvZiBxdW90YSB1dGlsaXphdGlvbiBvdmVyIHdoaWNoIHRoZSBzZXJ2ZXIgZ2VuZXJhdGVz
CiAgICB3YXJuaW5ncy4gKi8KSW5kZXg6IGxpYi9saWJjeXJfY2ZnLmMKPT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQpSQ1Mg
ZmlsZTogL2Fmcy9hbmRyZXcvc3lzdGVtL2N2cy9zcmMvY3lydXMvbGliL2xpYmN5cl9jZmcuYyx2
CnJldHJpZXZpbmcgcmV2aXNpb24gMS4zCmRpZmYgLXUgLXIxLjMgbGliY3lyX2NmZy5jCi0tLSBs
aWIvbGliY3lyX2NmZy5jCTE1IERlYyAyMDAzIDIyOjQyOjM4IC0wMDAwCTEuMworKysgbGliL2xp
YmN5cl9jZmcuYwkxNiBEZWMgMjAwMyAyMTozMTo1MCAtMDAwMApAQCAtOTEsNiArOTEsMTAgQEAK
ICAgICAgICh1bmlvbiBjeXJ1c19jb25maWdfdmFsdWUpKChjb25zdCBjaGFyICopImJlcmtlbGV5
IiksCiAgICAgICBDWVJVU19PUFRfU1RSSU5HIH0sCiAKKyAgICB7IENZUlVTT1BUX1ZJUlRET01B
SU5TLAorICAgICAgKHVuaW9uIGN5cnVzX2NvbmZpZ192YWx1ZSkoKGludCkwKSwKKyAgICAgIENZ
UlVTX09QVF9TV0lUQ0ggfSwKKwogICAgIHsgQ1lSVVNPUFRfTEFTVCwgeyBOVUxMIH0sIENZUlVT
X09QVF9OT1RPUFQgfQogfTsKIApJbmRleDogbGliL2xpYmN5cl9jZmcuaAo9PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09ClJD
UyBmaWxlOiAvYWZzL2FuZHJldy9zeXN0ZW0vY3ZzL3NyYy9jeXJ1cy9saWIvbGliY3lyX2NmZy5o
LHYKcmV0cmlldmluZyByZXZpc2lvbiAxLjMKZGlmZiAtdSAtcjEuMyBsaWJjeXJfY2ZnLmgKLS0t
IGxpYi9saWJjeXJfY2ZnLmgJMTUgRGVjIDIwMDMgMjI6NDI6MzggLTAwMDAJMS4zCisrKyBsaWIv
bGliY3lyX2NmZy5oCTE2IERlYyAyMDAzIDIxOjMxOjUwIC0wMDAwCkBAIC04Nyw2ICs4Nyw4IEBA
CiAgICAgQ1lSVVNPUFRfRlVMTERJUkhBU0gsCiAgICAgLyogRGF0YWJhc2UgZm9yIHVzZSBieSBB
VVRIX1BUUyAqLwogICAgIENZUlVTT1BUX1BUU0NBQ0hFX0RCLAorICAgIC8qIFZpcnR1YWwgRG9t
YWlucyAoT0ZGKSAqLworICAgIENZUlVTT1BUX1ZJUlRET01BSU5TLAogCiAgICAgQ1lSVVNPUFRf
TEFTVAogICAgIAo=
</data>        

          </attachment>
          <attachment
              isobsolete="0"
              ispatch="1"
              isprivate="0"
          >
            <attachid>245</attachid>
            <date>2004-01-06 16:58 EDT</date>
            <desc>cyrusdb_quotalegacy patch</desc>
            <filename>quotalegacy.patch</filename>
            <type>text/plain</type>
            <size>86413</size>
            <attacher>ken@oceana.com</attacher>
            
              <data encoding="base64">SW5kZXg6IGNvbmZpZ3VyZS5pbgo9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09ClJDUyBmaWxlOiAvYWZzL2FuZHJldy9zeXN0
ZW0vY3ZzL3NyYy9jeXJ1cy9jb25maWd1cmUuaW4sdgpyZXRyaWV2aW5nIHJldmlzaW9uIDEuMjc2
CmRpZmYgLXUgLXUgLXIxLjI3NiBjb25maWd1cmUuaW4KLS0tIGNvbmZpZ3VyZS5pbgkzIEphbiAy
MDA0IDIwOjEyOjMxIC0wMDAwCTEuMjc2CisrKyBjb25maWd1cmUuaW4JNiBKYW4gMjAwNCAyMTo1
MjozMCAtMDAwMApAQCAtMTY2LDcgKzE2Niw3IEBACiBkbmwgZnVuY3Rpb24gZm9yIGRvaW5nIGVh
Y2ggb2YgdGhlIGRhdGFiYXNlIGJhY2tlbmRzCiBkbmwgcGFyYW1ldGVyczogYmFja2VuZCBuYW1l
LCB2YXJpYWJsZSB0byBzZXQsIHdpdGh2YWwKIAotQ1lSVVNEQl9PQkpTPSJjeXJ1c2RiX2ZsYXQu
byBjeXJ1c2RiX3NraXBsaXN0Lm8iCitDWVJVU0RCX09CSlM9ImN5cnVzZGJfZmxhdC5vIGN5cnVz
ZGJfc2tpcGxpc3QubyBjeXJ1c2RiX3F1b3RhbGVnYWN5Lm8iCiAKIGRubCBCZXJrZWxleSBEQiBE
ZXRlY3Rpb24KIApJbmRleDogaW1hcC9NYWtlZmlsZS5pbgo9PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09ClJDUyBmaWxlOiAv
YWZzL2FuZHJldy9zeXN0ZW0vY3ZzL3NyYy9jeXJ1cy9pbWFwL01ha2VmaWxlLmluLHYKcmV0cmll
dmluZyByZXZpc2lvbiAxLjE3OQpkaWZmIC11IC11IC1yMS4xNzkgTWFrZWZpbGUuaW4KLS0tIGlt
YXAvTWFrZWZpbGUuaW4JMTIgTm92IDIwMDMgMDQ6MDI6MDEgLTAwMDAJMS4xNzkKKysrIGltYXAv
TWFrZWZpbGUuaW4JNiBKYW4gMjAwNCAyMTo1MjozMiAtMDAwMApAQCAtMTAxLDcgKzEwMSw3IEBA
CiAJZ2xvYmFsLm8gaW1hcF9lcnIubyBtdXBkYXRlX2Vyci5vIHByb2MubyBzZXRwcm9jdGl0bGUu
byBcCiAJY29udmVydF9jb2RlLm8gZHVwbGljYXRlLm8gc2FzbGNsaWVudC5vIHNhc2xzZXJ2ZXIu
byBzaWduYWxzLm8gXAogCWFubm90YXRlLm8gc2VhcmNoX2VuZ2luZXMubyBzcXVhdC5vIHNxdWF0
X2ludGVybmFsLm8gbWJkdW1wLm8gXAotCWltYXBwYXJzZS5vIHRlbGVtZXRyeS5vIHVzZXIubyBu
b3RpZnkubyBwcm90b2NvbC5vIFwKKwlpbWFwcGFyc2UubyB0ZWxlbWV0cnkubyB1c2VyLm8gbm90
aWZ5Lm8gcHJvdG9jb2wubyBxdW90YV9kYi5vIFwKIAkkKFNFRU4pICQoSURMRSkKIAogSU1BUERP
QkpTPXB1c2hzdGF0cy5vIGJhY2tlbmQubyBpbWFwZC5vIGluZGV4Lm8gdGxzLm8gdmVyc2lvbi5v
CkluZGV4OiBpbWFwL2FwcGVuZC5jCj09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KUkNTIGZpbGU6IC9hZnMvYW5kcmV3L3N5
c3RlbS9jdnMvc3JjL2N5cnVzL2ltYXAvYXBwZW5kLmMsdgpyZXRyaWV2aW5nIHJldmlzaW9uIDEu
MTAyCmRpZmYgLXUgLXUgLXIxLjEwMiBhcHBlbmQuYwotLS0gaW1hcC9hcHBlbmQuYwkyMiBPY3Qg
MjAwMyAxODo1MDowNyAtMDAwMAkxLjEwMgorKysgaW1hcC9hcHBlbmQuYwk2IEphbiAyMDA0IDIx
OjUyOjMyIC0wMDAwCkBAIC02NSw2ICs2NSw3IEBACiAjaW5jbHVkZSAibWJveGxpc3QuaCIKICNp
bmNsdWRlICJzZWVuLmgiCiAjaW5jbHVkZSAicmV0cnkuaCIKKyNpbmNsdWRlICJxdW90YS5oIgog
CiBzdHJ1Y3Qgc3RhZ2Vtc2cgewogICAgIGNoYXIgZm5hbWVbMTAyNF07CkBAIC0xMzYsMjEgKzEz
NywxOCBAQAogCXJldHVybiBJTUFQX01BSUxCT1hfTk9UU1VQUE9SVEVEOwogICAgIH0KIAotICAg
IHIgPSBtYWlsYm94X3JlYWRfcXVvdGEoJm0ucXVvdGEpOwotICAgIGlmIChyKSB7Ci0JbWFpbGJv
eF9jbG9zZSgmbSk7Ci0JcmV0dXJuIHI7Ci0gICAgfQotCi0gICAgaWYgKG0ucXVvdGEubGltaXQg
Pj0gMCAmJiBxdW90YWNoZWNrID49IDAgJiYKLQltLnF1b3RhLnVzZWQgKyBxdW90YWNoZWNrID4g
CisgICAgciA9IHF1b3RhX3JlYWQoJm0ucXVvdGEsIE5VTEwsIDApOworICAgIGlmICghcikgewor
CWlmIChtLnF1b3RhLmxpbWl0ID49IDAgJiYgcXVvdGFjaGVjayA+PSAwICYmCisJICAgIG0ucXVv
dGEudXNlZCArIHF1b3RhY2hlY2sgPiAKIAkgICAgKCh1bnNpZ25lZCkgbS5xdW90YS5saW1pdCAq
IFFVT1RBX1VOSVRTKSkgewotCW1haWxib3hfY2xvc2UoJm0pOwotCXJldHVybiBJTUFQX1FVT1RB
X0VYQ0VFREVEOworCSAgICByID0gSU1BUF9RVU9UQV9FWENFRURFRDsKKwl9CiAgICAgfQorICAg
IGVsc2UgaWYgKHIgPT0gSU1BUF9RVU9UQVJPT1RfTk9ORVhJU1RFTlQpIHIgPSAwOwogCiAgICAg
bWFpbGJveF9jbG9zZSgmbSk7Ci0gICAgcmV0dXJuIDA7CisgICAgcmV0dXJuIHI7CiB9CiAKIC8q
CkBAIC0yMDYsMTcgKzIwNCwyMCBAQAogCXJldHVybiByOwogICAgIH0KIAotICAgIHIgPSBtYWls
Ym94X2xvY2tfcXVvdGEoJmFzLT5tLnF1b3RhKTsKLSAgICBpZiAocikgewotCW1haWxib3hfY2xv
c2UoJmFzLT5tKTsKLQlyZXR1cm4gcjsKKyAgICByID0gcXVvdGFfcmVhZCgmYXMtPm0ucXVvdGEs
IE5VTEwsIDApOworICAgIGlmICghcikgeworCWlmIChhcy0+bS5xdW90YS5saW1pdCA+PSAwICYm
IHF1b3RhY2hlY2sgPj0gMCAmJgorCSAgICBhcy0+bS5xdW90YS51c2VkICsgcXVvdGFjaGVjayA+
IAorCSAgICAoKHVuc2lnbmVkKSBhcy0+bS5xdW90YS5saW1pdCAqIFFVT1RBX1VOSVRTKSkgewor
CSAgICBtYWlsYm94X2Nsb3NlKCZhcy0+bSk7CisJICAgIHIgPSBJTUFQX1FVT1RBX0VYQ0VFREVE
OworCX0KICAgICB9CisgICAgZWxzZSBpZiAociA9PSBJTUFQX1FVT1RBUk9PVF9OT05FWElTVEVO
VCkgciA9IDA7CiAKLSAgICBpZiAoYXMtPm0ucXVvdGEubGltaXQgPj0gMCAmJiBxdW90YWNoZWNr
ID49IDAgJiYKLQlhcy0+bS5xdW90YS51c2VkICsgcXVvdGFjaGVjayA+IAotCSAgICAoKHVuc2ln
bmVkKSBhcy0+bS5xdW90YS5saW1pdCAqIFFVT1RBX1VOSVRTKSkgeworICAgIGlmIChyKSB7CiAJ
bWFpbGJveF9jbG9zZSgmYXMtPm0pOwotCXJldHVybiBJTUFQX1FVT1RBX0VYQ0VFREVEOworCXJl
dHVybiByOwogICAgIH0KIAogICAgIGlmICh1c2VyaWQpIHsKQEAgLTI0MiwxMSArMjQzLDEzIEBA
CiAvKiBtYXkgcmV0dXJuIG5vbi16ZXJvLCBpbmRpY2F0aW5nIHRoYXQgdGhlIGVudGlyZSBhcHBl
bmQgaGFzIGZhaWxlZAogIGFuZCB0aGUgbWFpbGJveCBpcyBwcm9iYWJseSBpbiBhbiBpbmNvbnNp
c3RlbnQgc3RhdGUuICovCiBpbnQgYXBwZW5kX2NvbW1pdChzdHJ1Y3QgYXBwZW5kc3RhdGUgKmFz
LCAKKwkJICBsb25nIHF1b3RhY2hlY2ssCiAJCSAgdW5zaWduZWQgbG9uZyAqdWlkdmFsaWRpdHks
IAogCQkgIHVuc2lnbmVkIGxvbmcgKnN0YXJ0LAogCQkgIHVuc2lnbmVkIGxvbmcgKm51bSkKIHsK
ICAgICBpbnQgciA9IDA7CisgICAgc3RydWN0IHR4biAqdGlkID0gTlVMTDsKICAgICAKICAgICBp
ZiAoYXMtPnMgPT0gQVBQRU5EX0RPTkUpIHJldHVybiAwOwogCkBAIC0zMDIsOCArMzA1LDIxIEBA
CiAgICAgfQogCiAgICAgLyogV3JpdGUgb3V0IHF1b3RhIGZpbGUgKi8KLSAgICBhcy0+bS5xdW90
YS51c2VkICs9IGFzLT5xdW90YV91c2VkOwotICAgIHIgPSBtYWlsYm94X3dyaXRlX3F1b3RhKCZh
cy0+bS5xdW90YSk7CisgICAgciA9IHF1b3RhX3JlYWQoJmFzLT5tLnF1b3RhLCAmdGlkLCAxKTsK
KyAgICBpZiAoIXIpIHsKKwlpZiAoYXMtPm0ucXVvdGEubGltaXQgPj0gMCAmJiBxdW90YWNoZWNr
ID49IDAgJiYKKwkgICAgYXMtPm0ucXVvdGEudXNlZCArIHF1b3RhY2hlY2sgPiAKKwkgICAgKCh1
bnNpZ25lZCkgYXMtPm0ucXVvdGEubGltaXQgKiBRVU9UQV9VTklUUykpIHsKKwkgICAgcXVvdGFf
YWJvcnQoJnRpZCk7CisJICAgIGFwcGVuZF9hYm9ydChhcyk7CisJICAgIHJldHVybiBJTUFQX1FV
T1RBX0VYQ0VFREVEOworCX0KKworCWFzLT5tLnF1b3RhLnVzZWQgKz0gYXMtPnF1b3RhX3VzZWQ7
CisJciA9IHF1b3RhX3dyaXRlKCZhcy0+bS5xdW90YSwgJnRpZCk7CisJaWYgKCFyKSBxdW90YV9j
b21taXQoJnRpZCk7CisgICAgfQorICAgIGVsc2UgaWYgKHIgPT0gSU1BUF9RVU9UQVJPT1RfTk9O
RVhJU1RFTlQpIHIgPSAwOwogICAgIGlmIChyKSB7CiAJc3lzbG9nKExPR19FUlIsCiAJICAgICAg
ICJMT1NUUVVPVEE6IHVuYWJsZSB0byByZWNvcmQgdXNlIG9mICV1IGJ5dGVzIGluIHF1b3RhIGZp
bGUgJXMiLApAQCAtMzE4LDcgKzMzNCw2IEBACiAJZnJlZShhcy0+c2Vlbl9tc2dyYW5nZSk7CiAg
ICAgfQogCi0gICAgbWFpbGJveF91bmxvY2tfcXVvdGEoJmFzLT5tLnF1b3RhKTsKICAgICBtYWls
Ym94X3VubG9ja19pbmRleCgmYXMtPm0pOwogICAgIG1haWxib3hfdW5sb2NrX2hlYWRlcigmYXMt
Pm0pOwogICAgIG1haWxib3hfY2xvc2UoJmFzLT5tKTsKQEAgLTM1Niw3ICszNzEsNiBAQAogICAg
IGZ0cnVuY2F0ZShhcy0+bS5jYWNoZV9mZCwgYXMtPm9yaWdfY2FjaGVfbGVuKTsKIAogICAgIC8q
IHVubG9jayBtYWlsYm94ICovCi0gICAgbWFpbGJveF91bmxvY2tfcXVvdGEoJmFzLT5tLnF1b3Rh
KTsKICAgICBtYWlsYm94X3VubG9ja19pbmRleCgmYXMtPm0pOwogICAgIG1haWxib3hfdW5sb2Nr
X2hlYWRlcigmYXMtPm0pOwogICAgIG1haWxib3hfY2xvc2UoJmFzLT5tKTsKSW5kZXg6IGltYXAv
YXBwZW5kLmgKPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PQpSQ1MgZmlsZTogL2Fmcy9hbmRyZXcvc3lzdGVtL2N2cy9zcmMv
Y3lydXMvaW1hcC9hcHBlbmQuaCx2CnJldHJpZXZpbmcgcmV2aXNpb24gMS4yNApkaWZmIC11IC11
IC1yMS4yNCBhcHBlbmQuaAotLS0gaW1hcC9hcHBlbmQuaAkyMiBPY3QgMjAwMyAxODo1MDowNyAt
MDAwMAkxLjI0CisrKyBpbWFwL2FwcGVuZC5oCTYgSmFuIDIwMDQgMjE6NTI6MzIgLTAwMDAKQEAg
LTEwNyw2ICsxMDcsNyBAQAogCQkJbG9uZyBhY2xjaGVjaywgbG9uZyBxdW90YWNoZWNrKTsKIAog
ZXh0ZXJuIGludCBhcHBlbmRfY29tbWl0KHN0cnVjdCBhcHBlbmRzdGF0ZSAqbWFpbGJveCwKKwkJ
CSBsb25nIHF1b3RhY2hlY2ssCiAJCQkgdW5zaWduZWQgbG9uZyAqdWlkdmFsaWRpdHksIAogCQkJ
IHVuc2lnbmVkIGxvbmcgKnN0YXJ0dWlkLCAKIAkJCSB1bnNpZ25lZCBsb25nICpudW0pOwpJbmRl
eDogaW1hcC9jdGxfY3lydXNkYi5jCj09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KUkNTIGZpbGU6IC9hZnMvYW5kcmV3L3N5
c3RlbS9jdnMvc3JjL2N5cnVzL2ltYXAvY3RsX2N5cnVzZGIuYyx2CnJldHJpZXZpbmcgcmV2aXNp
b24gMS4yMApkaWZmIC11IC11IC1yMS4yMCBjdGxfY3lydXNkYi5jCi0tLSBpbWFwL2N0bF9jeXJ1
c2RiLmMJMTUgRGVjIDIwMDMgMjE6MDI6NDkgLTAwMDAJMS4yMAorKysgaW1hcC9jdGxfY3lydXNk
Yi5jCTYgSmFuIDIwMDQgMjE6NTI6MzIgLTAwMDAKQEAgLTk2LDYgKzk2LDcgQEAKICAgICBpbnQg
YXJjaGl2ZTsKIH0gZGJsaXN0W10gPSB7CiAgICAgeyBGTkFNRV9NQk9YTElTVCwJCSZjb25maWdf
bWJveGxpc3RfZGIsCTEgfSwKKyAgICB7IEZOQU1FX1FVT1RBREIsCQkmY29uZmlnX3F1b3RhX2Ri
LAkxIH0sCiAgICAgeyBGTkFNRV9BTk5PVEFUSU9OUywJJmNvbmZpZ19hbm5vdGF0aW9uX2RiLAkx
IH0sCiAgICAgeyBGTkFNRV9ERUxJVkVSREIsCQkmY29uZmlnX2R1cGxpY2F0ZV9kYiwJMCB9LAog
ICAgIHsgRk5BTUVfVExTU0VTU0lPTlMsCSZjb25maWdfdGxzY2FjaGVfZGIsCTAgfSwKSW5kZXg6
IGltYXAvY3lyX2V4cGlyZS5jCj09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KUkNTIGZpbGU6IC9hZnMvYW5kcmV3L3N5c3Rl
bS9jdnMvc3JjL2N5cnVzL2ltYXAvY3lyX2V4cGlyZS5jLHYKcmV0cmlldmluZyByZXZpc2lvbiAx
LjMKZGlmZiAtdSAtdSAtcjEuMyBjeXJfZXhwaXJlLmMKLS0tIGltYXAvY3lyX2V4cGlyZS5jCTI0
IE9jdCAyMDAzIDE4OjI0OjA1IC0wMDAwCTEuMworKysgaW1hcC9jeXJfZXhwaXJlLmMJNiBKYW4g
MjAwNCAyMTo1MjozMiAtMDAwMApAQCAtMjM4LDYgKzIzOCwxMCBAQAogICAgIG1ib3hsaXN0X2lu
aXQoMCk7CiAgICAgbWJveGxpc3Rfb3BlbihOVUxMKTsKIAorICAgIC8qIG9wZW4gdGhlIHF1b3Rh
IGRiLCB3ZSdsbCBuZWVkIGl0IGZvciBleHB1bmdlICovCisgICAgcXVvdGFkYl9pbml0KDApOwor
ICAgIHF1b3RhZGJfb3BlbihOVUxMKTsKKwogICAgIGlmIChkdXBsaWNhdGVfaW5pdChOVUxMLCAw
KSAhPSAwKSB7CiAJZnByaW50ZihzdGRlcnIsIAogCQkiY3lyX2V4cGlyZTogdW5hYmxlIHRvIGlu
aXQgZHVwbGljYXRlIGRlbGl2ZXJ5IGRhdGFiYXNlXG4iKTsKQEAgLTI2NSw2ICsyNjksOCBAQAog
CiAgICAgZnJlZV9oYXNoX3RhYmxlKCZleHBpcmVfdGFibGUsIGZyZWUpOwogCisgICAgcXVvdGFk
Yl9jbG9zZSgpOworICAgIHF1b3RhZGJfZG9uZSgpOwogICAgIG1ib3hsaXN0X2Nsb3NlKCk7CiAg
ICAgbWJveGxpc3RfZG9uZSgpOwogICAgIGFubm90YXRlbW9yZV9jbG9zZSgpOwpJbmRleDogaW1h
cC9nbG9iYWwuYwo9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09ClJDUyBmaWxlOiAvYWZzL2FuZHJldy9zeXN0ZW0vY3ZzL3Ny
Yy9jeXJ1cy9pbWFwL2dsb2JhbC5jLHYKcmV0cmlldmluZyByZXZpc2lvbiAxLjUKZGlmZiAtdSAt
dSAtcjEuNSBnbG9iYWwuYwotLS0gaW1hcC9nbG9iYWwuYwkyOSBEZWMgMjAwMyAyMDoyMjo1NCAt
MDAwMAkxLjUKKysrIGltYXAvZ2xvYmFsLmMJNiBKYW4gMjAwNCAyMTo1MjozMiAtMDAwMApAQCAt
ODIsNiArODIsNyBAQAogCiBpbnQgY29uZmlnX2ltcGxpY2l0cmlnaHRzOyAgICAgICAgLyogImxj
YSIgKi8KIHN0cnVjdCBjeXJ1c2RiX2JhY2tlbmQgKmNvbmZpZ19tYm94bGlzdF9kYjsKK3N0cnVj
dCBjeXJ1c2RiX2JhY2tlbmQgKmNvbmZpZ19xdW90YV9kYjsKIHN0cnVjdCBjeXJ1c2RiX2JhY2tl
bmQgKmNvbmZpZ19zdWJzY3JpcHRpb25fZGI7CiBzdHJ1Y3QgY3lydXNkYl9iYWNrZW5kICpjb25m
aWdfYW5ub3RhdGlvbl9kYjsKIHN0cnVjdCBjeXJ1c2RiX2JhY2tlbmQgKmNvbmZpZ19zZWVuc3Rh
dGVfZGI7CkBAIC0xNjIsNiArMTYzLDggQEAKICAgICAvKiBsb29rdXAgdGhlIGRhdGFiYXNlIGJh
Y2tlbmRzICovCiAgICAgY29uZmlnX21ib3hsaXN0X2RiID0KIAljeXJ1c2RiX2Zyb21uYW1lKGNv
bmZpZ19nZXRzdHJpbmcoSU1BUE9QVF9NQk9YTElTVF9EQikpOworICAgIGNvbmZpZ19xdW90YV9k
YiA9CisJY3lydXNkYl9mcm9tbmFtZShjb25maWdfZ2V0c3RyaW5nKElNQVBPUFRfUVVPVEFfREIp
KTsKICAgICBjb25maWdfc3Vic2NyaXB0aW9uX2RiID0KIAljeXJ1c2RiX2Zyb21uYW1lKGNvbmZp
Z19nZXRzdHJpbmcoSU1BUE9QVF9TVUJTQ1JJUFRJT05fREIpKTsKICAgICBjb25maWdfYW5ub3Rh
dGlvbl9kYiA9CkBAIC0xOTMsNiArMTk2LDggQEAKIAkJCSAgICAgIGNvbmZpZ19nZXRzd2l0Y2go
SU1BUE9QVF9GVUxMRElSSEFTSCkpOwogICAgIGxpYmN5cnVzX2NvbmZpZ19zZXRzdHJpbmcoQ1lS
VVNPUFRfUFRTQ0FDSEVfREIsCiAJCQkgICAgICBjb25maWdfZ2V0c3RyaW5nKElNQVBPUFRfUFRT
Q0FDSEVfREIpKTsKKyAgICBsaWJjeXJ1c19jb25maWdfc2V0c3dpdGNoKENZUlVTT1BUX1ZJUlRE
T01BSU5TLAorCQkJICAgICAgY29uZmlnX2dldGVudW0oSU1BUE9QVF9WSVJURE9NQUlOUykpOwog
CiAgICAgLyogTm90IHVudGlsIGFsbCBjb25maWd1cmF0aW9uIHBhcmFtZXRlcnMgYXJlIHNldCEg
Ki8KICAgICBsaWJjeXJ1c19pbml0KCk7CkluZGV4OiBpbWFwL2dsb2JhbC5oCj09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0K
UkNTIGZpbGU6IC9hZnMvYW5kcmV3L3N5c3RlbS9jdnMvc3JjL2N5cnVzL2ltYXAvZ2xvYmFsLmgs
dgpyZXRyaWV2aW5nIHJldmlzaW9uIDEuMwpkaWZmIC11IC11IC1yMS4zIGdsb2JhbC5oCi0tLSBp
bWFwL2dsb2JhbC5oCTE1IERlYyAyMDAzIDIwOjAwOjQwIC0wMDAwCTEuMworKysgaW1hcC9nbG9i
YWwuaAk2IEphbiAyMDA0IDIxOjUyOjMyIC0wMDAwCkBAIC0xNDQsNiArMTQ0LDcgQEAKIC8qIE1p
c2MgZ2xvYmFscyAqLwogZXh0ZXJuIGludCBjb25maWdfaW1wbGljaXRyaWdodHM7CiBleHRlcm4g
c3RydWN0IGN5cnVzZGJfYmFja2VuZCAqY29uZmlnX21ib3hsaXN0X2RiOworZXh0ZXJuIHN0cnVj
dCBjeXJ1c2RiX2JhY2tlbmQgKmNvbmZpZ19xdW90YV9kYjsKIGV4dGVybiBzdHJ1Y3QgY3lydXNk
Yl9iYWNrZW5kICpjb25maWdfc3Vic2NyaXB0aW9uX2RiOwogZXh0ZXJuIHN0cnVjdCBjeXJ1c2Ri
X2JhY2tlbmQgKmNvbmZpZ19hbm5vdGF0aW9uX2RiOwogZXh0ZXJuIHN0cnVjdCBjeXJ1c2RiX2Jh
Y2tlbmQgKmNvbmZpZ19zZWVuc3RhdGVfZGI7CkluZGV4OiBpbWFwL2ltYXBkLmMKPT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PQpSQ1MgZmlsZTogL2Fmcy9hbmRyZXcvc3lzdGVtL2N2cy9zcmMvY3lydXMvaW1hcC9pbWFwZC5j
LHYKcmV0cmlldmluZyByZXZpc2lvbiAxLjQ0OQpkaWZmIC11IC11IC1yMS40NDkgaW1hcGQuYwot
LS0gaW1hcC9pbWFwZC5jCTI5IERlYyAyMDAzIDE3OjA3OjU5IC0wMDAwCTEuNDQ5CisrKyBpbWFw
L2ltYXBkLmMJNiBKYW4gMjAwNCAyMTo1MjozMiAtMDAwMApAQCAtODQsNiArODQsNyBAQAogI2lu
Y2x1ZGUgIm1iZHVtcC5oIgogI2luY2x1ZGUgIm1rZ210aW1lLmgiCiAjaW5jbHVkZSAibXVwZGF0
ZS1jbGllbnQuaCIKKyNpbmNsdWRlICJxdW90YS5oIgogI2luY2x1ZGUgInRlbGVtZXRyeS5oIgog
I2luY2x1ZGUgInRscy5oIgogI2luY2x1ZGUgInVzZXIuaCIKQEAgLTQ0Myw2ICs0NDQsMTAgQEAK
ICAgICBtYm94bGlzdF9vcGVuKE5VTEwpOwogICAgIG1haWxib3hfaW5pdGlhbGl6ZSgpOwogCisg
ICAgLyogb3BlbiB0aGUgcXVvdGEgZGIsIHdlJ2xsIG5lZWQgaXQgZm9yIHJlYWwgd29yayAqLwor
ICAgIHF1b3RhZGJfaW5pdCgwKTsKKyAgICBxdW90YWRiX29wZW4oTlVMTCk7CisKICAgICAvKiBz
ZXR1cCBmb3Igc2VuZGluZyBJTUFQIElETEUgbm90aWZpY2F0aW9ucyAqLwogICAgIGlkbGVfZW5h
YmxlZCgpOwogCkBAIC02MjAsNiArNjI1LDkgQEAKICAgICBtYm94bGlzdF9jbG9zZSgpOwogICAg
IG1ib3hsaXN0X2RvbmUoKTsKIAorICAgIHF1b3RhZGJfY2xvc2UoKTsKKyAgICBxdW90YWRiX2Rv
bmUoKTsKKwogICAgIGFubm90YXRlbW9yZV9jbG9zZSgpOwogICAgIGFubm90YXRlbW9yZV9kb25l
KCk7CiAKQEAgLTIzMDMsNyArMjMxMSw3IEBACiAgICAgfQogCiAgICAgaWYgKCFyKSB7Ci0JciA9
IGFwcGVuZF9jb21taXQoJm1haWxib3gsICZ1aWR2YWxpZGl0eSwgJmZpcnN0dWlkLCAmbnVtKTsK
KwlyID0gYXBwZW5kX2NvbW1pdCgmbWFpbGJveCwgc2l6ZSwgJnVpZHZhbGlkaXR5LCAmZmlyc3R1
aWQsICZudW0pOwogICAgIH0gZWxzZSB7CiAJYXBwZW5kX2Fib3J0KCZtYWlsYm94KTsKICAgICB9
CkBAIC0yNDA3LDggKzI0MTUsOCBAQAogCiAgICAgaWYgKGltYXBkX21haWxib3gtPm15cmlnaHRz
ICYgQUNMX0RFTEVURSkgewogCS8qIFdhcm4gaWYgbWFpbGJveCBpcyBjbG9zZSB0byBvciBvdmVy
IHF1b3RhICovCi0JbWFpbGJveF9yZWFkX3F1b3RhKCZpbWFwZF9tYWlsYm94LT5xdW90YSk7Ci0J
aWYgKGltYXBkX21haWxib3gtPnF1b3RhLmxpbWl0ID4gMCkgeworCXIgPSBxdW90YV9yZWFkKCZp
bWFwZF9tYWlsYm94LT5xdW90YSwgTlVMTCwgMCk7CisJaWYgKCFyICYmIGltYXBkX21haWxib3gt
PnF1b3RhLmxpbWl0ID4gMCkgewogIAkgICAgLyogV2FybiBpZiB0aGUgZm9sbG93aW5nIHBvc3Np
YmlsaXRpZXMgb2NjdXI6CiAgCSAgICAgKiAtIHF1b3Rhd2FybmtiIG5vdCBzZXQgKyBxdW90YXdh
cm4gaGl0CiAJICAgICAqIC0gcXVvdGF3YXJua2Igc2V0IGxhcmdlciB0aGFuIG1haWxib3ggKyBx
dW90YXdhcm4gaGl0CkBAIC00Mzk0LDIyICs0NDAyLDEzIEBACiAgICAgY2hhciBidWZbTUFYX01B
SUxCT1hfUEFUSCsxXTsKICAgICBjaGFyIG1haWxib3huYW1lW01BWF9NQUlMQk9YX05BTUUrMV07
CiAKLSAgICBxdW90YS5mZCA9IC0xOwotCiAgICAgaWYgKCFpbWFwZF91c2VyaXNhZG1pbikgciA9
IElNQVBfUEVSTUlTU0lPTl9ERU5JRUQ7CiAgICAgZWxzZSB7CiAJciA9ICgqaW1hcGRfbmFtZXNw
YWNlLm1ib3huYW1lX3RvaW50ZXJuYWwpKCZpbWFwZF9uYW1lc3BhY2UsIG5hbWUsCiAJCQkJCQkg
ICBpbWFwZF91c2VyaWQsIG1haWxib3huYW1lKTsKIAlpZiAoIXIpIHsKIAkgICAgcXVvdGEucm9v
dCA9IG1haWxib3huYW1lOwotCSAgICBtYWlsYm94X2hhc2hfcXVvdGEoYnVmLCBzaXplb2YoYnVm
KSwgcXVvdGEucm9vdCk7Ci0JICAgIHF1b3RhLmZkID0gb3BlbihidWYsIE9fUkRXUiwgMCk7Ci0J
ICAgIGlmIChxdW90YS5mZCA9PSAtMSkgewotCQlyID0gSU1BUF9RVU9UQVJPT1RfTk9ORVhJU1RF
TlQ7Ci0JICAgIH0KLQkgICAgZWxzZSB7Ci0JCXIgPSBtYWlsYm94X3JlYWRfcXVvdGEoJnF1b3Rh
KTsKLQkgICAgfQorCSAgICByID0gcXVvdGFfcmVhZCgmcXVvdGEsIE5VTEwsIDApOwogCX0KICAg
ICB9CiAgICAgCkBAIC00NDI0LDEwICs0NDIzLDYgQEAKIAlwcm90X3ByaW50ZihpbWFwZF9vdXQs
ICIpXHJcbiIpOwogICAgIH0KIAotICAgIGlmIChxdW90YS5mZCAhPSAtMSkgewotCWNsb3NlKHF1
b3RhLmZkKTsKLSAgICB9Ci0KICAgICBpZiAocikgewogCXByb3RfcHJpbnRmKGltYXBkX291dCwg
IiVzIE5PICVzXHJcbiIsIHRhZywgZXJyb3JfbWVzc2FnZShyKSk7CiAJcmV0dXJuOwpAQCAtNDQ4
MCw3ICs0NDc1LDcgQEAKIAkJCQkJCSAgIGltYXBkX3VzZXJpZCwgbWFpbGJveG5hbWUpOwogCSAg
ICBwcm90X3ByaW50ZihpbWFwZF9vdXQsICIgIik7CiAJICAgIHByaW50YXN0cmluZyhtYWlsYm94
bmFtZSk7Ci0JICAgIHIgPSBtYWlsYm94X3JlYWRfcXVvdGEoJm1haWxib3gucXVvdGEpOworCSAg
ICByID0gcXVvdGFfcmVhZCgmbWFpbGJveC5xdW90YSwgTlVMTCwgMCk7CiAJICAgIGlmICghcikg
ewogCQlwcm90X3ByaW50ZihpbWFwZF9vdXQsICJcclxuKiBRVU9UQSAiKTsKIAkJcHJpbnRhc3Ry
aW5nKG1haWxib3huYW1lKTsKQEAgLTY0MjgsMjcgKzY0MjMsMjIgQEAKIAkgICAgY2hhciBidWZb
TUFYX01BSUxCT1hfUEFUSCsxXTsKIAkgICAgc3RydWN0IHF1b3RhIHF1b3RhOwogCSAgICAKLQkg
ICAgcXVvdGEuZmQgPSAtMTsKIAkgICAgcXVvdGEucm9vdCA9IG1haWxib3huYW1lOwotCSAgICBt
YWlsYm94X2hhc2hfcXVvdGEoYnVmLHNpemVvZihidWYpLHF1b3RhLnJvb3QpOwotCSAgICBxdW90
YS5mZCA9IG9wZW4oYnVmLCBPX1JEV1IsIDApOwotCSAgICBpZihxdW90YS5mZCAhPSAtMSkgewkg
ICAgCi0JCXIgPSBtYWlsYm94X3JlYWRfcXVvdGEoJnF1b3RhKTsKLQkJY2xvc2UocXVvdGEuZmQp
OworCSAgICByID0gcXVvdGFfcmVhZCgmcXVvdGEsIE5VTEwsIDApOwogCSAgICAKLQkJaWYoIXIp
IHsKLQkJICAgIC8qIG5vdGUgdXNlIG9mICsgdG8gZm9yY2UgdGhlIHNldHRpbmcgb2YgYSBub25l
eGlzdGFudAotCQkgICAgICogcXVvdGFyb290ICovCi0JCSAgICBwcm90X3ByaW50ZihiZS0+b3V0
LCAiUTAxIFNFVFFVT1RBIHslZCt9XHJcbiIgXAotCQkJCSAgICAgICAgICIrJXMgKFNUT1JBR0Ug
JWQpXHJcbiIsCi0JCQkJc3RybGVuKG5hbWUpKzEsIG5hbWUsIHF1b3RhLmxpbWl0KTsKLQkJICAg
IHIgPSBnZXRyZXN1bHQoYmUtPmluLCAiUTAxIik7Ci0JCSAgICBpZihyKSBzeXNsb2coTE9HX0VS
UiwKLQkJCQkgIkNvdWxkIG5vdCBtb3ZlIG1haWxib3g6ICVzLCAiIFwKLQkJCQkgImZhaWxlZCBz
ZXR0aW5nIGluaXRpYWwgcXVvdGEgcm9vdFxyXG4iLAotCQkJCSBtYWlsYm94bmFtZSk7Ci0JCX0K
KwkgICAgaWYoIXIpIHsKKwkJLyogbm90ZSB1c2Ugb2YgKyB0byBmb3JjZSB0aGUgc2V0dGluZyBv
ZiBhIG5vbmV4aXN0YW50CisJCSAqIHF1b3Rhcm9vdCAqLworCQlwcm90X3ByaW50ZihiZS0+b3V0
LCAiUTAxIFNFVFFVT1RBIHslZCt9XHJcbiIgXAorCQkJICAgICIrJXMgKFNUT1JBR0UgJWQpXHJc
biIsCisJCQkgICAgc3RybGVuKG5hbWUpKzEsIG5hbWUsIHF1b3RhLmxpbWl0KTsKKwkJciA9IGdl
dHJlc3VsdChiZS0+aW4sICJRMDEiKTsKKwkJaWYocikgc3lzbG9nKExPR19FUlIsCisJCQkgICAg
ICJDb3VsZCBub3QgbW92ZSBtYWlsYm94OiAlcywgIiBcCisJCQkgICAgICJmYWlsZWQgc2V0dGlu
ZyBpbml0aWFsIHF1b3RhIHJvb3RcclxuIiwKKwkJCSAgICAgbWFpbGJveG5hbWUpOwogCSAgICB9
CisJICAgIGVsc2UgaWYgKHIgPT0gSU1BUF9RVU9UQVJPT1RfTk9ORVhJU1RFTlQpIHIgPSAwOwog
CX0KIAogCkluZGV4OiBpbWFwL2luZGV4LmMKPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQpSQ1MgZmlsZTogL2Fmcy9hbmRy
ZXcvc3lzdGVtL2N2cy9zcmMvY3lydXMvaW1hcC9pbmRleC5jLHYKcmV0cmlldmluZyByZXZpc2lv
biAxLjIwMQpkaWZmIC11IC11IC1yMS4yMDEgaW5kZXguYwotLS0gaW1hcC9pbmRleC5jCTIyIE9j
dCAyMDAzIDIwOjA1OjEyIC0wMDAwCTEuMjAxCisrKyBpbWFwL2luZGV4LmMJNiBKYW4gMjAwNCAy
MTo1MjozMiAtMDAwMApAQCAtMTE3Nyw3ICsxMTc3LDggQEAKIAogICAgIHIgPSBhcHBlbmRfY29w
eShtYWlsYm94LCAmYXBwZW5kX21haWxib3gsIGNvcHlhcmdzLm51bW1zZywKIAkJICAgIGNvcHlh
cmdzLmNvcHltc2cpOwotICAgIGlmICghcikgYXBwZW5kX2NvbW1pdCgmYXBwZW5kX21haWxib3gs
ICZ1aWR2YWxpZGl0eSwgJnN0YXJ0dWlkLCAmbnVtKTsKKyAgICBpZiAoIXIpIGFwcGVuZF9jb21t
aXQoJmFwcGVuZF9tYWlsYm94LCB0b3RhbHNpemUsCisJCQkgICZ1aWR2YWxpZGl0eSwgJnN0YXJ0
dWlkLCAmbnVtKTsKICAgICBpZiAoIXIpIHsKIAljb3B5dWlkX3NpemUgPSAxMDI0OwogCWNvcHl1
aWQgPSB4bWFsbG9jKGNvcHl1aWRfc2l6ZSk7CkluZGV4OiBpbWFwL2lwdXJnZS5jCj09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT0KUkNTIGZpbGU6IC9hZnMvYW5kcmV3L3N5c3RlbS9jdnMvc3JjL2N5cnVzL2ltYXAvaXB1cmdl
LmMsdgpyZXRyaWV2aW5nIHJldmlzaW9uIDEuMjEKZGlmZiAtdSAtdSAtcjEuMjEgaXB1cmdlLmMK
LS0tIGltYXAvaXB1cmdlLmMJMjAgTm92IDIwMDMgMTg6NDc6NDYgLTAwMDAJMS4yMQorKysgaW1h
cC9pcHVyZ2UuYwk2IEphbiAyMDA0IDIxOjUyOjMyIC0wMDAwCkBAIC0xODAsNiArMTgwLDEwIEBA
CiAgIG1ib3hsaXN0X2luaXQoMCk7CiAgIG1ib3hsaXN0X29wZW4oTlVMTCk7CiAKKyAgLyogb3Bl
biB0aGUgcXVvdGEgZGIsIHdlJ2xsIG5lZWQgaXQgZm9yIGV4cHVuZ2UgKi8KKyAgcXVvdGFkYl9p
bml0KDApOworICBxdW90YWRiX29wZW4oTlVMTCk7CisKICAgaWYgKG9wdGluZCA9PSBhcmdjKSB7
IC8qIGRvIHRoZSB3aG9sZSBwYXJ0aXRpb24gKi8KICAgICBzdHJjcHkoYnVmLCAiKiIpOwogICAg
ICgqcHVyZ2VfbmFtZXNwYWNlLm1ib3hsaXN0X2ZpbmRhbGwpKCZwdXJnZV9uYW1lc3BhY2UsIGJ1
ZiwgMSwgMCwgMCwKQEAgLTE5NSw2ICsxOTksOSBAQAogCQkJCQkgIHB1cmdlX21lLCBOVUxMKTsK
ICAgICB9CiAgIH0KKyAgcXVvdGFkYl9jbG9zZSgpOworICBxdW90YWRiX2RvbmUoKTsKKwogICBt
Ym94bGlzdF9jbG9zZSgpOwogICBtYm94bGlzdF9kb25lKCk7CiAKSW5kZXg6IGltYXAvbG10cGQu
Ywo9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09ClJDUyBmaWxlOiAvYWZzL2FuZHJldy9zeXN0ZW0vY3ZzL3NyYy9jeXJ1cy9p
bWFwL2xtdHBkLmMsdgpyZXRyaWV2aW5nIHJldmlzaW9uIDEuMTI1CmRpZmYgLXUgLXUgLXIxLjEy
NSBsbXRwZC5jCi0tLSBpbWFwL2xtdHBkLmMJMTYgRGVjIDIwMDMgMjA6MzY6NTUgLTAwMDAJMS4x
MjUKKysrIGltYXAvbG10cGQuYwk2IEphbiAyMDA0IDIxOjUyOjMzIC0wMDAwCkBAIC0yMzAsNiAr
MjMwLDEwIEBACiAgICAgbWJveGxpc3RfaW5pdCgwKTsKICAgICBtYm94bGlzdF9vcGVuKE5VTEwp
OwogCisgICAgLyogc28gd2UgY2FuIGRvIHF1b3RhIG9wZXJhdGlvbnMgKi8KKyAgICBxdW90YWRi
X2luaXQoMCk7CisgICAgcXVvdGFkYl9vcGVuKE5VTEwpOworCiAgICAgLyogc2V0dXAgZm9yIHNl
bmRpbmcgSU1BUCBJRExFIG5vdGlmaWNhdGlvbnMgKi8KICAgICBpZGxlX2VuYWJsZWQoKTsKIApA
QCAtMTA3Niw3ICsxMDgwLDcgQEAKIAkgICAgciA9IGFwcGVuZF9mcm9tc3RyZWFtKCZhcywgbXNn
LCBzaXplLCBub3csIAogCQkJCSAgKGNvbnN0IGNoYXIgKiopIGZsYWcsIG5mbGFncyk7CiAJfQot
CWlmICghcikgYXBwZW5kX2NvbW1pdCgmYXMsIE5VTEwsICZ1aWQsIE5VTEwpOworCWlmICghcikg
YXBwZW5kX2NvbW1pdCgmYXMsIHF1b3Rhb3ZlcnJpZGUgPyAtMSA6IDAsIE5VTEwsICZ1aWQsIE5V
TEwpOwogCWVsc2UgYXBwZW5kX2Fib3J0KCZhcyk7CiAgICAgfQogCkBAIC0xMjc1LDYgKzEyNzks
OSBAQAogCiAgICAgbWJveGxpc3RfY2xvc2UoKTsKICAgICBtYm94bGlzdF9kb25lKCk7CisKKyAg
ICBxdW90YWRiX2Nsb3NlKCk7CisgICAgcXVvdGFkYl9kb25lKCk7CiAjaWZkZWYgSEFWRV9TU0wK
ICAgICB0bHNfc2h1dGRvd25fc2VydmVyZW5naW5lKCk7CiAjZW5kaWYKSW5kZXg6IGltYXAvbWFp
bGJveC5jCj09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT0KUkNTIGZpbGU6IC9hZnMvYW5kcmV3L3N5c3RlbS9jdnMvc3JjL2N5
cnVzL2ltYXAvbWFpbGJveC5jLHYKcmV0cmlldmluZyByZXZpc2lvbiAxLjE1MApkaWZmIC11IC11
IC1yMS4xNTAgbWFpbGJveC5jCi0tLSBpbWFwL21haWxib3guYwk0IE5vdiAyMDAzIDIxOjQzOjIy
IC0wMDAwCTEuMTUwCisrKyBpbWFwL21haWxib3guYwk2IEphbiAyMDA0IDIxOjUyOjMzIC0wMDAw
CkBAIC01MiwxNCArNTIsNiBAQAogI2luY2x1ZGUgPHN0cmluZy5oPgogI2luY2x1ZGUgPGVycm5v
Lmg+CiAjaW5jbHVkZSA8c3lzbG9nLmg+Ci0jaW5jbHVkZSA8c3lzL3R5cGVzLmg+Ci0jaW5jbHVk
ZSA8ZmNudGwuaD4KLSNpbmNsdWRlIDxuZXRpbmV0L2luLmg+Ci0jaW5jbHVkZSA8c3lzL3VuLmg+
Ci0jaW5jbHVkZSA8c3lzL3NvY2tldC5oPgotI2luY2x1ZGUgPHN5cy90eXBlcy5oPgotI2luY2x1
ZGUgPHN5cy9zdGF0Lmg+Ci0jaW5jbHVkZSA8Y3R5cGUuaD4KICNpbmNsdWRlIDxjb21fZXJyLmg+
CiAKICNpZmRlZiBIQVZFX0RJUkVOVF9ICkBAIC00MTYsNyArNDA4LDYgQEAKICAgICBpbnQgcjsK
IAogICAgIHplcm9tYWlsYm94KCptYWlsYm94KTsKLSAgICBtYWlsYm94LT5xdW90YS5mZCA9IC0x
OwogCiAgICAgc3RybGNweShmbmFtZWJ1ZiwgcGF0aCwgc2l6ZW9mKGZuYW1lYnVmKSk7CiAgICAg
c3RybGNhdChmbmFtZWJ1ZiwgRk5BTUVfSEVBREVSLCBzaXplb2YoZm5hbWVidWYpKTsKQEAgLTU4
NSwxMCArNTc2LDYgQEAKIAltYXBfZnJlZSgmbWFpbGJveC0+Y2FjaGVfYmFzZSwgJm1haWxib3gt
PmNhY2hlX2xlbik7CiAgICAgfQogCi0gICAgaWYgKG1haWxib3gtPnF1b3RhLmZkICE9IC0xKSB7
Ci0JY2xvc2UobWFpbGJveC0+cXVvdGEuZmQpOwotICAgIH0KLQkKICAgICBmcmVlKG1haWxib3gt
Pm5hbWUpOwogICAgIGZyZWUobWFpbGJveC0+cGF0aCk7CiAgICAgZnJlZShtYWlsYm94LT5hY2wp
OwpAQCAtNjAwLDcgKzU4Nyw2IEBACiAgICAgfQogCiAgICAgemVyb21haWxib3goKm1haWxib3gp
OwotICAgIG1haWxib3gtPnF1b3RhLmZkID0gLTE7CiB9CiAKIC8qCkBAIC02MzMsMTUgKzYxOSw2
IEBACiAJdGFiID0gZW9sOwogICAgIH0KICAgICBpZiAobWFpbGJveC0+cXVvdGEucm9vdCkgewot
CS8qIGNoZWNrIGlmIHRoaXMgaXMgdGhlIHNhbWUgYXMgd2hhdCdzIHRoZXJlICovCi0JaWYgKHN0
cmxlbihtYWlsYm94LT5xdW90YS5yb290KSAhPSAoc2l6ZV90KSh0YWItcCkgfHwKLQkgICAgc3Ry
bmNtcChtYWlsYm94LT5xdW90YS5yb290LCBwLCB0YWItcCkgIT0gMCkgewotCSAgICBhc3NlcnQo
bWFpbGJveC0+cXVvdGEubG9ja19jb3VudCA9PSAwKTsKLQkgICAgaWYgKG1haWxib3gtPnF1b3Rh
LmZkICE9IC0xKSB7Ci0JCWNsb3NlKG1haWxib3gtPnF1b3RhLmZkKTsKLQkgICAgfQotCSAgICBt
YWlsYm94LT5xdW90YS5mZCA9IC0xOwotCX0KIAlmcmVlKG1haWxib3gtPnF1b3RhLnJvb3QpOwog
ICAgIH0KICAgICBpZiAocCA8IHRhYikgewpAQCAtOTI2LDU3ICs5MDMsNiBAQAogfQogCiAvKgot
ICogT3BlbiBhbmQgcmVhZCB0aGUgcXVvdGEgZmlsZSAncXVvdGEnCi0gKi8KLWludAotbWFpbGJv
eF9yZWFkX3F1b3RhKHF1b3RhKQotc3RydWN0IHF1b3RhICpxdW90YTsKLXsKLSAgICBjb25zdCBj
aGFyICpwLCAqZW9sOwotICAgIGNoYXIgYnVmW01BWF9NQUlMQk9YX1BBVEgrMV07Ci0gICAgY29u
c3QgY2hhciAqcXVvdGFfYmFzZSA9IDA7Ci0gICAgdW5zaWduZWQgbG9uZyBxdW90YV9sZW4gPSAw
OwotCi0KLSAgICBpZiAoIXF1b3RhLT5yb290KSB7Ci0JcXVvdGEtPnVzZWQgPSAwOwotCXF1b3Rh
LT5saW1pdCA9IC0xOwotCXJldHVybiAwOwotICAgIH0KLQotICAgIGlmIChxdW90YS0+ZmQgPT0g
LTEpIHsKLQltYWlsYm94X2hhc2hfcXVvdGEoYnVmLCBzaXplb2YoYnVmKSwgcXVvdGEtPnJvb3Qp
OwotCXF1b3RhLT5mZCA9IG9wZW4oYnVmLCBPX1JEV1IsIDApOwotCWlmIChxdW90YS0+ZmQgPT0g
LTEpIHsKLQkgICAgc3lzbG9nKExPR19FUlIsICJJT0VSUk9SOiBvcGVuaW5nIHF1b3RhIGZpbGUg
JXM6ICVtIiwgYnVmKTsKLQkgICAgcmV0dXJuIElNQVBfSU9FUlJPUjsKLQl9Ci0gICAgfQotICAg
IAotICAgIG1hcF9yZWZyZXNoKHF1b3RhLT5mZCwgMSwgJnF1b3RhX2Jhc2UsICZxdW90YV9sZW4s
Ci0JCU1BUF9VTktOT1dOX0xFTiwgYnVmLCAwKTsKLQotICAgIHAgPSBxdW90YV9iYXNlOwotICAg
IGVvbCA9IG1lbWNocihwLCAnXG4nLCBxdW90YV9sZW4gLSAocCAtIHF1b3RhX2Jhc2UpKTsKLSAg
ICBpZiAoIWVvbCkgewotCW1hcF9mcmVlKCZxdW90YV9iYXNlLCAmcXVvdGFfbGVuKTsKLQlyZXR1
cm4gSU1BUF9NQUlMQk9YX0JBREZPUk1BVDsKLSAgICB9Ci0gICAgcXVvdGEtPnVzZWQgPSBhdG9s
KHApOwotCi0gICAgcCA9IGVvbCArIDE7Ci0gICAgZW9sID0gbWVtY2hyKHAsICdcbicsIHF1b3Rh
X2xlbiAtIChwIC0gcXVvdGFfYmFzZSkpOwotICAgIGlmICghZW9sKSB7Ci0JbWFwX2ZyZWUoJnF1
b3RhX2Jhc2UsICZxdW90YV9sZW4pOwotCXJldHVybiBJTUFQX01BSUxCT1hfQkFERk9STUFUOwot
ICAgIH0KLSAgICBxdW90YS0+bGltaXQgPSBhdG9pKHApOwotCi0gICAgbWFwX2ZyZWUoJnF1b3Rh
X2Jhc2UsICZxdW90YV9sZW4pOwotICAgIHJldHVybiAwOwotfQotCi0vKgogICogTG9jayB0aGUg
aGVhZGVyIGZvciAnbWFpbGJveCcuICBSZXJlYWQgaGVhZGVyIGlmIG5lY2Vzc2FyeS4KICAqLwog
aW50CkBAIC05OTEsNyArOTE3LDYgQEAKICAgICBpZiAobWFpbGJveC0+aGVhZGVyX2xvY2tfY291
bnQrKykgcmV0dXJuIDA7CiAKICAgICBhc3NlcnQobWFpbGJveC0+aW5kZXhfbG9ja19jb3VudCA9
PSAwKTsKLSAgICBhc3NlcnQobWFpbGJveC0+cXVvdGEubG9ja19jb3VudCA9PSAwKTsKICAgICBh
c3NlcnQobWFpbGJveC0+c2Vlbl9sb2NrX2NvdW50ID09IDApOwogCiAgICAgc3RybGNweShmbmFt
ZWJ1ZiwgbWFpbGJveC0+cGF0aCwgc2l6ZW9mKGZuYW1lYnVmKSk7CkBAIC0xMDM0LDcgKzk1OSw2
IEBACiAKICAgICBpZiAobWFpbGJveC0+aW5kZXhfbG9ja19jb3VudCsrKSByZXR1cm4gMDsKIAot
ICAgIGFzc2VydChtYWlsYm94LT5xdW90YS5sb2NrX2NvdW50ID09IDApOwogICAgIGFzc2VydCht
YWlsYm94LT5zZWVuX2xvY2tfY291bnQgPT0gMCk7CiAKICAgICBzdHJsY3B5KGZuYW1lYnVmLCBt
YWlsYm94LT5wYXRoLCBzaXplb2YoZm5hbWVidWYpKTsKQEAgLTExMDcsNTAgKzEwMzEsNiBAQAog
fQogCiAvKgotICogTG9jayB0aGUgcXVvdGEgZmlsZSAncXVvdGEnLiAgUmVyZWFkIHF1b3RhIGZp
bGUgaWYgbmVjZXNzYXJ5LgotICovCi1pbnQKLW1haWxib3hfbG9ja19xdW90YShxdW90YSkKLXN0
cnVjdCBxdW90YSAqcXVvdGE7Ci17Ci0gICAgY2hhciBxdW90YV9wYXRoW01BWF9NQUlMQk9YX1BB
VEgrMV07Ci0gICAgc3RydWN0IHN0YXQgc2J1ZjsKLSAgICBjb25zdCBjaGFyICpsb2NrZmFpbGFj
dGlvbjsKLSAgICBpbnQgcjsKLQotICAgIC8qIGFzc2VydChtYWlsYm94LT5oZWFkZXJfbG9ja19j
b3VudCAhPSAwKTsgKi8KLQotICAgIGlmIChxdW90YS0+bG9ja19jb3VudCsrKSByZXR1cm4gMDsK
LQotICAgIC8qIGFzc2VydChtYWlsYm94LT5zZWVuX2xvY2tfY291bnQgPT0gMCk7ICovCi0KLSAg
ICBpZiAoIXF1b3RhLT5yb290KSB7Ci0JcXVvdGEtPnVzZWQgPSAwOwotCXF1b3RhLT5saW1pdCA9
IC0xOwotCXJldHVybiAwOwotICAgIH0KLSAgICBtYWlsYm94X2hhc2hfcXVvdGEocXVvdGFfcGF0
aCwgc2l6ZW9mKHF1b3RhX3BhdGgpLCBxdW90YS0+cm9vdCk7Ci0gICAgaWYgKHF1b3RhLT5mZCA9
PSAtMSkgewotCXF1b3RhLT5mZCA9IG9wZW4ocXVvdGFfcGF0aCwgT19SRFdSLCAwKTsKLQlpZiAo
cXVvdGEtPmZkID09IC0xKSB7Ci0JICAgIHN5c2xvZyhMT0dfRVJSLCAiSU9FUlJPUjogb3Blbmlu
ZyBxdW90YSBmaWxlICVzOiAlbSIsCi0JCSAgIHF1b3RhX3BhdGgpOwotCSAgICByZXR1cm4gSU1B
UF9JT0VSUk9SOwotCX0KLSAgICB9Ci0KLSAgICByID0gbG9ja19yZW9wZW4ocXVvdGEtPmZkLCBx
dW90YV9wYXRoLCAmc2J1ZiwgJmxvY2tmYWlsYWN0aW9uKTsKLSAgICBpZiAociA9PSAtMSkgewot
CXF1b3RhLT5sb2NrX2NvdW50LS07Ci0Jc3lzbG9nKExPR19FUlIsICJJT0VSUk9SOiAlcyBxdW90
YSAlczogJW0iLCBsb2NrZmFpbGFjdGlvbiwKLQkgICAgICAgcXVvdGEtPnJvb3QpOwotCXJldHVy
biBJTUFQX0lPRVJST1I7Ci0gICAgfQotCi0gICAgcmV0dXJuIG1haWxib3hfcmVhZF9xdW90YShx
dW90YSk7Ci19Ci0KLS8qCiAgKiBSZWxlYXNlIGxvY2sgb24gdGhlIGhlYWRlciBmb3IgJ21haWxi
b3gnCiAgKi8KIHZvaWQgbWFpbGJveF91bmxvY2tfaGVhZGVyKHN0cnVjdCBtYWlsYm94ICptYWls
Ym94KQpAQCAtMTE5NywyMiArMTA3Nyw2IEBACiB9CiAKIC8qCi0gKiBSZWxlYXNlIGxvY2sgb24g
dGhlIHF1b3RhIGZpbGUgJ3F1b3RhJwotICovCi12b2lkCi1tYWlsYm94X3VubG9ja19xdW90YShx
dW90YSkKLXN0cnVjdCBxdW90YSAqcXVvdGE7Ci17Ci0gICAgYXNzZXJ0KHF1b3RhLT5sb2NrX2Nv
dW50ICE9IDApOwotCi0gICAgaWYgKC0tcXVvdGEtPmxvY2tfY291bnQgPT0gMCAmJiBxdW90YS0+
cm9vdCkgewotCWlmIChsb2NrX3VubG9jayhxdW90YS0+ZmQpKQotCSAgICBzeXNsb2coTE9HX0VS
UiwgIklPRVJST1I6IHVubG9ja2luZyBxdW90YSBmb3IgJXM6ICVtIiwgCi0JCXF1b3RhLT5yb290
KTsKLSAgICB9Ci19Ci0KLS8qCiAgKiBXcml0ZSB0aGUgaGVhZGVyIGZpbGUgZm9yICdtYWlsYm94
JwogICovCiBpbnQgbWFpbGJveF93cml0ZV9oZWFkZXIoc3RydWN0IG1haWxib3ggKm1haWxib3gp
CkBAIC0xNDUzLDEwMiArMTMxNyw2IEBACiB9CiAKIC8qCi0gKiBXcml0ZSBvdXQgdGhlIHF1b3Rh
ICdxdW90YScKLSAqLwotaW50IG1haWxib3hfd3JpdGVfcXVvdGEoc3RydWN0IHF1b3RhICpxdW90
YSkKLXsKLSAgICBpbnQgcjsKLSAgICBpbnQgbGVuOwotICAgIGNoYXIgYnVmWzEwMjRdOwotICAg
IGNoYXIgcXVvdGFfcGF0aFtNQVhfTUFJTEJPWF9QQVRIKzFdOwotICAgIGNoYXIgbmV3X3F1b3Rh
X3BhdGhbTUFYX01BSUxCT1hfUEFUSCsxXTsKLSAgICBpbnQgbmV3ZmQ7Ci0KLSAgICBhc3NlcnQo
cXVvdGEtPmxvY2tfY291bnQgIT0gMCk7Ci0KLSAgICBpZiAoIXF1b3RhLT5yb290KSByZXR1cm4g
MDsKLQotICAgIG1haWxib3hfaGFzaF9xdW90YShxdW90YV9wYXRoLCBzaXplb2YocXVvdGFfcGF0
aCksIHF1b3RhLT5yb290KTsKLQotICAgIHN0cmxjcHkobmV3X3F1b3RhX3BhdGgsIHF1b3RhX3Bh
dGgsIHNpemVvZihuZXdfcXVvdGFfcGF0aCkpOwotICAgIHN0cmxjYXQobmV3X3F1b3RhX3BhdGgs
ICIuTkVXIiwgc2l6ZW9mKG5ld19xdW90YV9wYXRoKSk7Ci0KLSAgICBuZXdmZCA9IG9wZW4obmV3
X3F1b3RhX3BhdGgsIE9fQ1JFQVQgfCBPX1RSVU5DIHwgT19SRFdSLCAwNjY2KTsKLSAgICBpZiAo
bmV3ZmQgPT0gLTEgJiYgZXJybm8gPT0gRU5PRU5UKSB7Ci0JaWYgKGN5cnVzX21rZGlyKG5ld19x
dW90YV9wYXRoLCAwNzU1KSA9PSAtMSkgcmV0dXJuIElNQVBfSU9FUlJPUjsKLQotCW5ld2ZkID0g
b3BlbihuZXdfcXVvdGFfcGF0aCwgT19DUkVBVCB8IE9fVFJVTkMgfCBPX1JEV1IsIDA2NjYpOwot
ICAgIH0KLSAgICBpZiAobmV3ZmQgPT0gLTEpIHsKLQlzeXNsb2coTE9HX0VSUiwgIklPRVJST1I6
IGNyZWF0aW5nIHF1b3RhIGZpbGUgJXM6ICVtIiwgbmV3X3F1b3RhX3BhdGgpOwotCXJldHVybiBJ
TUFQX0lPRVJST1I7Ci0gICAgfQotCi0gICAgciA9IGxvY2tfYmxvY2tpbmcobmV3ZmQpOwotICAg
IGlmIChyKSB7Ci0Jc3lzbG9nKExPR19FUlIsICJJT0VSUk9SOiBsb2NraW5nIHF1b3RhIGZpbGUg
JXM6ICVtIiwKLQkgICAgICAgbmV3X3F1b3RhX3BhdGgpOwotCWNsb3NlKG5ld2ZkKTsKLQlyZXR1
cm4gSU1BUF9JT0VSUk9SOwotICAgIH0KLQotICAgIGxlbiA9IHNucHJpbnRmKGJ1Ziwgc2l6ZW9m
KGJ1ZikgLSAxLAotCQkgICAiJWx1XG4lZFxuIiwgcXVvdGEtPnVzZWQsIHF1b3RhLT5saW1pdCk7
Ci0gICAgciA9IHdyaXRlKG5ld2ZkLCBidWYsIGxlbik7Ci0gICAgCi0gICAgaWYgKHIgPT0gLTEg
fHwgZnN5bmMobmV3ZmQpKSB7Ci0Jc3lzbG9nKExPR19FUlIsICJJT0VSUk9SOiB3cml0aW5nIHF1
b3RhIGZpbGUgJXM6ICVtIiwKLQkgICAgICAgbmV3X3F1b3RhX3BhdGgpOwotCWNsb3NlKG5ld2Zk
KTsKLQlyZXR1cm4gSU1BUF9JT0VSUk9SOwotICAgIH0KLQotICAgIGlmIChyZW5hbWUobmV3X3F1
b3RhX3BhdGgsIHF1b3RhX3BhdGgpKSB7Ci0Jc3lzbG9nKExPR19FUlIsICJJT0VSUk9SOiByZW5h
bWluZyBxdW90YSBmaWxlICVzOiAlbSIsCi0JICAgICAgIHF1b3RhX3BhdGgpOwotCWNsb3NlKG5l
d2ZkKTsKLQlyZXR1cm4gSU1BUF9JT0VSUk9SOwotICAgIH0KLQotICAgIGlmIChxdW90YS0+ZmQg
IT0gLTEpIHsKLQljbG9zZShxdW90YS0+ZmQpOwotCXF1b3RhLT5mZCA9IC0xOwotICAgIH0KLQot
ICAgIHF1b3RhLT5mZCA9IG5ld2ZkOwotCi0gICAgcmV0dXJuIDA7Ci19Ci0KLS8qCi0gKiBSZW1v
dmUgdGhlIHF1b3RhIHJvb3QgJ3F1b3RhJwotICovCi1pbnQKLW1haWxib3hfZGVsZXRlX3F1b3Rh
KHF1b3RhKQotc3RydWN0IHF1b3RhICpxdW90YTsKLXsKLSAgICBjaGFyIHF1b3RhX3BhdGhbTUFY
X01BSUxCT1hfUEFUSCsxXTsKLQotICAgIGFzc2VydChxdW90YS0+bG9ja19jb3VudCAhPSAwKTsK
LQotICAgIGlmICghcXVvdGEtPnJvb3QpIHJldHVybiAwOwotCi0gICAgbWFpbGJveF9oYXNoX3F1
b3RhKHF1b3RhX3BhdGgsIHNpemVvZihxdW90YV9wYXRoKSwgcXVvdGEtPnJvb3QpOwotCi0gICAg
dW5saW5rKHF1b3RhX3BhdGgpOwotCi0gICAgaWYgKHF1b3RhLT5mZCAhPSAtMSkgewotCWNsb3Nl
KHF1b3RhLT5mZCk7Ci0JcXVvdGEtPmZkID0gLTE7Ci0gICAgfQotCi0gICAgZnJlZShxdW90YS0+
cm9vdCk7Ci0gICAgcXVvdGEtPnJvb3QgPSAwOwotCi0gICAgcmV0dXJuIDA7Ci19Ci0KLS8qCiAg
KiBMb2NrIHRoZSBpbmRleCBmaWxlIGZvciAnbWFpbGJveCcuCiAgKiBET04nVCBSZXJlYWQgaW5k
ZXggZmlsZSBoZWFkZXIgaWYgbmVjZXNzYXJ5LgogICovCkBAIC0xNTYwLDcgKzEzMjgsNiBAQAog
CiAgICAgaWYgKG1haWxib3gtPmluZGV4X2xvY2tfY291bnQrKykgcmV0dXJuIDA7CiAKLSAgICBh
c3NlcnQobWFpbGJveC0+cXVvdGEubG9ja19jb3VudCA9PSAwKTsKICAgICBhc3NlcnQobWFpbGJv
eC0+c2Vlbl9sb2NrX2NvdW50ID09IDApOwogCiAgICAgc3RybGNweShmbmFtZWJ1ZiwgbWFpbGJv
eC0+cGF0aCwgc2l6ZW9mKGZuYW1lYnVmKSk7CkBAIC0xODUwLDYgKzE2MTcsNyBAQAogICAgIHVu
c2lnbmVkIG1zZ25vOwogICAgIHN0cnVjdCBzdGF0IHNidWY7CiAgICAgY2hhciAqZm5hbWV0YWls
OworICAgIHN0cnVjdCB0eG4gKnRpZCA9IE5VTEw7CiAKICAgICAvKiBPZmZzZXQgaW50byB0aGUg
bmV3IGNhY2hlIGZpbGUgZm9yIHVzZSB3aGVuIHVwZGF0aW5nIHRoZSBpbmRleCByZWNvcmQgKi8K
ICAgICBzaXplX3QgbmV3X2NhY2hlX3RvdGFsX3NpemUgPSBzaXplb2YoYml0MzIpOwpAQCAtMjA3
OSwyMSArMTg0NywyMyBAQAogICAgIH0KIAogICAgIC8qIFJlY29yZCBxdW90YSByZWxlYXNlICov
Ci0gICAgciA9IG1haWxib3hfbG9ja19xdW90YSgmbWFpbGJveC0+cXVvdGEpOwotICAgIGlmIChy
KSBnb3RvIGZhaWw7Ci0gICAgaWYgKG1haWxib3gtPnF1b3RhLnVzZWQgPj0gcXVvdGFkZWxldGVk
KSB7Ci0JbWFpbGJveC0+cXVvdGEudXNlZCAtPSBxdW90YWRlbGV0ZWQ7Ci0gICAgfQotICAgIGVs
c2UgewotCW1haWxib3gtPnF1b3RhLnVzZWQgPSAwOwotICAgIH0KLSAgICByID0gbWFpbGJveF93
cml0ZV9xdW90YSgmbWFpbGJveC0+cXVvdGEpOwotICAgIGlmIChyKSB7Ci0Jc3lzbG9nKExPR19F
UlIsCi0JICAgICAgICJMT1NUUVVPVEE6IHVuYWJsZSB0byByZWNvcmQgZnJlZSBvZiAldSBieXRl
cyBpbiBxdW90YSAlcyIsCi0JICAgICAgIHF1b3RhZGVsZXRlZCwgbWFpbGJveC0+cXVvdGEucm9v
dCk7CisgICAgciA9IHF1b3RhX3JlYWQoJm1haWxib3gtPnF1b3RhLCAmdGlkLCAxKTsKKyAgICBp
ZiAoIXIpIHsKKwlpZiAobWFpbGJveC0+cXVvdGEudXNlZCA+PSBxdW90YWRlbGV0ZWQpIHsKKwkg
ICAgbWFpbGJveC0+cXVvdGEudXNlZCAtPSBxdW90YWRlbGV0ZWQ7CisJfQorCWVsc2UgeworCSAg
ICBtYWlsYm94LT5xdW90YS51c2VkID0gMDsKKwl9CisJciA9IHF1b3RhX3dyaXRlKCZtYWlsYm94
LT5xdW90YSwgJnRpZCk7CisJaWYgKCFyKSBxdW90YV9jb21taXQoJnRpZCk7CisJZWxzZSB7CisJ
ICAgIHN5c2xvZyhMT0dfRVJSLAorCQkgICAiTE9TVFFVT1RBOiB1bmFibGUgdG8gcmVjb3JkIGZy
ZWUgb2YgJXUgYnl0ZXMgaW4gcXVvdGEgJXMiLAorCQkgICBxdW90YWRlbGV0ZWQsIG1haWxib3gt
PnF1b3RhLnJvb3QpOworCX0KICAgICB9Ci0gICAgbWFpbGJveF91bmxvY2tfcXVvdGEoJm1haWxi
b3gtPnF1b3RhKTsKKyAgICBlbHNlIGlmIChyICE9IElNQVBfUVVPVEFST09UX05PTkVYSVNURU5U
KSBnb3RvIGZhaWw7CiAKICAgICBzdHJsY3B5KGZuYW1lYnVmLCBtYWlsYm94LT5wYXRoLCBzaXpl
b2YoZm5hbWVidWYpKTsKIApAQCAtMjE2OCw0MCArMTkzOCw2IEBACiAgICAgcmV0dXJuIElNQVBf
SU9FUlJPUjsKIH0KIAotLyogZmluZCB0aGUgbWFpbGJveCAnbmFtZScgJ3MgcXVvdGFyb290LCBh
bmQgcmV0dXJuIGl0IGluICdzdGFydCcuCi0gICAnc3RhcnQnIG11c3QgYmUgYXQgbGVhc3QgTUFY
X01BSUxCT1hfUEFUSC4gCi0KLSAgIHJldHVybnMgdHJ1ZSBpZiBhIHF1b3Rhcm9vdCBpcyBmb3Vu
ZCwgMCBvdGhlcndpc2UuIAotKi8KLWludCBtYWlsYm94X2ZpbmRxdW90YShjaGFyICpyZXQsIHNp
emVfdCByZXRsZW4sIGNvbnN0IGNoYXIgKm5hbWUpCi17Ci0gICAgY2hhciBxdW90YV9wYXRoW01B
WF9NQUlMQk9YX1BBVEgrMV07Ci0gICAgY2hhciAqdGFpbCwgKnAsICptYm94OwotICAgIHN0cnVj
dCBzdGF0IHNidWY7Ci0KLSAgICBzdHJsY3B5KHJldCwgbmFtZSwgcmV0bGVuKTsKLQotICAgIC8q
IGZpbmQgdGhlIHN0YXJ0IG9mIHRoZSB1bnF1YWxpZmllZCBtYWlsYm94IG5hbWUgKi8KLSAgICBt
Ym94ID0gKGNvbmZpZ192aXJ0ZG9tYWlucyAmJiAocCA9IHN0cmNocihyZXQsICchJykpKSA/IHAr
MSA6IHJldDsKLSAgICB0YWlsID0gbWJveCArIHN0cmxlbihtYm94KTsKLQotICAgIG1haWxib3hf
aGFzaF9xdW90YShxdW90YV9wYXRoLCBzaXplb2YocXVvdGFfcGF0aCksIHJldCk7Ci0gICAgd2hp
bGUgKHN0YXQocXVvdGFfcGF0aCwgJnNidWYpID09IC0xKSB7Ci0JdGFpbCA9IHN0cnJjaHIobWJv
eCwgJy4nKTsKLQlpZiAoIXRhaWwpIGJyZWFrOwotCSp0YWlsID0gJ1wwJzsKLQltYWlsYm94X2hh
c2hfcXVvdGEocXVvdGFfcGF0aCwgc2l6ZW9mKHF1b3RhX3BhdGgpLCByZXQpOwotICAgIH0KLSAg
ICBpZiAodGFpbCkgcmV0dXJuIDE7Ci0gICAgaWYgKG1ib3ggPT0gcmV0KSByZXR1cm4gMDsKLQot
ICAgIC8qIGNoZWNrIGZvciBhIGRvbWFpbiBxdW90YSAqLwotICAgICptYm94ID0gJ1wwJzsKLSAg
ICBtYWlsYm94X2hhc2hfcXVvdGEocXVvdGFfcGF0aCwgc2l6ZW9mKHF1b3RhX3BhdGgpLCByZXQp
OwotICAgIHJldHVybiAoc3RhdChxdW90YV9wYXRoLCAmc2J1ZikgIT0gLTEpOwotfQotCi0KIGlu
dCBtYWlsYm94X2NyZWF0ZShjb25zdCBjaGFyICpuYW1lLAogCQkgICBjaGFyICpwYXRoLAogCQkg
ICBjb25zdCBjaGFyICphY2wsCkBAIC0yMjMyLDkgKzE5NjgsOCBAQAogICAgIH0KIAogICAgIHpl
cm9tYWlsYm94KG1haWxib3gpOwotICAgIG1haWxib3gucXVvdGEuZmQgPSAtMTsKIAotICAgIGhh
c3F1b3RhID0gbWFpbGJveF9maW5kcXVvdGEocXVvdGFfcm9vdCwgc2l6ZW9mKHF1b3RhX3Jvb3Qp
LCBuYW1lKTsKKyAgICBoYXNxdW90YSA9IHF1b3RhX2ZpbmRyb290KHF1b3RhX3Jvb3QsIHNpemVv
ZihxdW90YV9yb290KSwgbmFtZSk7CiAKICAgICAvKiBTZXQgdXAgYnVmZmVyICovCiAgICAgc3Ry
bGNweShmbmFtZWJ1ZiwgcGF0aCwgc2l6ZW9mKGZuYW1lYnVmKSk7CkBAIC0yMzcwLDE2ICsyMTA1
LDE5IEBACiAgICAgc3RydWN0IGRpcmVudCAqZjsKICAgICBjaGFyIGJ1ZltNQVhfTUFJTEJPWF9Q
QVRIKzFdOwogICAgIGNoYXIgKnRhaWw7CisgICAgc3RydWN0IHR4biAqdGlkID0gTlVMTDsKICAg
ICAKICAgICAvKiBFbnN1cmUgdGhhdCB3ZSBhcmUgbG9ja2VkICovCiAgICAgaWYoIW1haWxib3gt
PmhlYWRlcl9sb2NrX2NvdW50KSByZXR1cm4gSU1BUF9JTlRFUk5BTDsKIAotICAgIHJxdW90YSA9
IG1haWxib3hfbG9ja19xdW90YSgmbWFpbGJveC0+cXVvdGEpOworICAgIHJxdW90YSA9IHF1b3Rh
X3JlYWQoJm1haWxib3gtPnF1b3RhLCAmdGlkLCAxKTsKIAogICAgIHNlZW5fZGVsZXRlX21haWxi
b3gobWFpbGJveCk7CiAKICAgICBpZiAoZGVsZXRlX3F1b3RhX3Jvb3QgJiYgIXJxdW90YSkgewot
CW1haWxib3hfZGVsZXRlX3F1b3RhKCZtYWlsYm94LT5xdW90YSk7CisJcXVvdGFfZGVsZXRlKCZt
YWlsYm94LT5xdW90YSwgJnRpZCk7CisJZnJlZShtYWlsYm94LT5xdW90YS5yb290KTsKKwltYWls
Ym94LT5xdW90YS5yb290ID0gTlVMTDsKICAgICB9IGVsc2UgaWYgKCFycXVvdGEpIHsKIAkvKiBG
cmVlIGFueSBxdW90YSBiZWluZyB1c2VkIGJ5IHRoaXMgbWFpbGJveCAqLwogCWlmIChtYWlsYm94
LT5xdW90YS51c2VkID49IG1haWxib3gtPnF1b3RhX21haWxib3hfdXNlZCkgewpAQCAtMjM4OCwx
MyArMjEyNiwxNCBAQAogCWVsc2UgewogCSAgICBtYWlsYm94LT5xdW90YS51c2VkID0gMDsKIAl9
Ci0JciA9IG1haWxib3hfd3JpdGVfcXVvdGEoJm1haWxib3gtPnF1b3RhKTsKKwlyID0gcXVvdGFf
d3JpdGUoJm1haWxib3gtPnF1b3RhLCAmdGlkKTsKIAlpZiAocikgewogCSAgICBzeXNsb2coTE9H
X0VSUiwKIAkJICAgIkxPU1RRVU9UQTogdW5hYmxlIHRvIHJlY29yZCBmcmVlIG9mICVsdSBieXRl
cyBpbiBxdW90YSAlcyIsCiAJCSAgIG1haWxib3gtPnF1b3RhX21haWxib3hfdXNlZCwgbWFpbGJv
eC0+cXVvdGEucm9vdCk7CiAJfQotCW1haWxib3hfdW5sb2NrX3F1b3RhKCZtYWlsYm94LT5xdW90
YSk7CisJZWxzZQorCSAgICBxdW90YV9jb21taXQoJnRpZCk7CiAgICAgfQogCiAgICAgLyogcmVt
b3ZlIGFsbCBmaWxlcyBpbiBkaXJlY3RvcnkgKi8KQEAgLTI0NjksNiArMjIwOCw3IEBACiAgICAg
Y2hhciBvbGRmbmFtZVtNQVhfTUFJTEJPWF9QQVRIKzFdLCBuZXdmbmFtZVtNQVhfTUFJTEJPWF9Q
QVRIKzFdOwogICAgIHNpemVfdCBvbGRmbmFtZV9sZW4sIG5ld2ZuYW1lX2xlbiwgZm5fbGVuOwog
ICAgIGNoYXIgKm9sZGZuYW1ldGFpbCwgKm5ld2ZuYW1ldGFpbDsKKyAgICBzdHJ1Y3QgdHhuICp0
aWQgPSBOVUxMOwogCiAgICAgYXNzZXJ0KG9sZG1haWxib3gtPmhlYWRlcl9sb2NrX2NvdW50ID4g
MAogCSAgICYmIG9sZG1haWxib3gtPmluZGV4X2xvY2tfY291bnQgPiAwKTsKQEAgLTI1MDIsNyAr
MjI0Miw3IEBACiAKICAgICAvKiBDaGVjayBxdW90YSBpZiBuZWNlc3NhcnkgKi8KICAgICBpZiAo
bmV3bWFpbGJveC0+cXVvdGEucm9vdCkgewotCXIgPSBtYWlsYm94X2xvY2tfcXVvdGEoJihuZXdt
YWlsYm94LT5xdW90YSkpOworCXIgPSBxdW90YV9yZWFkKCYobmV3bWFpbGJveC0+cXVvdGEpLCAm
dGlkLCAxKTsKIAlpZiAoIW9sZG1haWxib3gtPnF1b3RhLnJvb3QgfHwKIAkgICAgc3RyY21wKG9s
ZG1haWxib3gtPnF1b3RhLnJvb3QsIG5ld21haWxib3gtPnF1b3RhLnJvb3QpICE9IDApIHsKIAkg
ICAgaWYgKCFyICYmIG5ld21haWxib3gtPnF1b3RhLmxpbWl0ID49IDAgJiYKQEAgLTI1MTEsNyAr
MjI1MSw3IEBACiAJCXIgPSBJTUFQX1FVT1RBX0VYQ0VFREVEOwogCSAgICB9CiAJfQotCWlmIChy
KSB7CisJaWYgKHIgJiYgciAhPSBJTUFQX1FVT1RBUk9PVF9OT05FWElTVEVOVCkgewogCSAgICBt
YWlsYm94X2Nsb3NlKG5ld21haWxib3gpOwogCSAgICByZXR1cm4gcjsKIAl9CkBAIC0yNjAzLDgg
KzIzNDMsOCBAQAogICAgIC8qIFJlY29yZCBuZXcgcXVvdGEgdXNhZ2UgKi8KICAgICBpZiAoIXIg
JiYgbmV3bWFpbGJveC0+cXVvdGEucm9vdCkgewogCW5ld21haWxib3gtPnF1b3RhLnVzZWQgKz0g
b2xkbWFpbGJveC0+cXVvdGFfbWFpbGJveF91c2VkOwotCXIgPSBtYWlsYm94X3dyaXRlX3F1b3Rh
KCYobmV3bWFpbGJveC0+cXVvdGEpKTsKLQltYWlsYm94X3VubG9ja19xdW90YSgmKG5ld21haWxi
b3gtPnF1b3RhKSk7CisJciA9IHF1b3RhX3dyaXRlKCYobmV3bWFpbGJveC0+cXVvdGEpLCAmdGlk
KTsKKwlpZiAoIXIpIHF1b3RhX2NvbW1pdCgmdGlkKTsKICAgICB9CiAgICAgaWYgKHIpIHsKIAkv
KiBmYWlsdXJlIGFuZCBiYWNrIG91dCAqLwpAQCAtMjY1OCw2ICsyMzk4LDcgQEAKICAgICBjaGFy
IG9sZGZuYW1lW01BWF9NQUlMQk9YX1BBVEgrMV0sIG5ld2ZuYW1lW01BWF9NQUlMQk9YX1BBVEgr
MV07CiAgICAgc2l6ZV90IG9sZGZuYW1lX2xlbiwgbmV3Zm5hbWVfbGVuLCBmbl9sZW47CiAgICAg
Y2hhciAqb2xkZm5hbWV0YWlsLCAqbmV3Zm5hbWV0YWlsOworICAgIHN0cnVjdCB0eG4gKnRpZCA9
IE5VTEw7CiAKICAgICAvKiBPcGVuIG9sZCBtYWlsYm94IGFuZCBsb2NrICovCiAgICAgbWFpbGJv
eF9vcGVuX2hlYWRlcl9wYXRoKG9sZG5hbWUsIG9sZHBhdGgsIG9sZGFjbCwgMCwgJm9sZG1haWxi
b3gsIDApOwpAQCAtMjcxNSw3ICsyNDU2LDcgQEAKIAogICAgIC8qIENoZWNrIHF1b3RhIGlmIG5l
Y2Vzc2FyeSAqLwogICAgIGlmIChuZXdtYWlsYm94LnF1b3RhLnJvb3QpIHsKLQlyID0gbWFpbGJv
eF9sb2NrX3F1b3RhKCZuZXdtYWlsYm94LnF1b3RhKTsKKwlyID0gcXVvdGFfcmVhZCgmbmV3bWFp
bGJveC5xdW90YSwgJnRpZCwgMSk7CiAJaWYgKCFvbGRtYWlsYm94LnF1b3RhLnJvb3QgfHwKIAkg
ICAgc3RyY21wKG9sZG1haWxib3gucXVvdGEucm9vdCwgbmV3bWFpbGJveC5xdW90YS5yb290KSAh
PSAwKSB7CiAJICAgIGlmICghciAmJiBuZXdtYWlsYm94LnF1b3RhLmxpbWl0ID49IDAgJiYKQEAg
LTI3MjQsNyArMjQ2NSw3IEBACiAJCXIgPSBJTUFQX1FVT1RBX0VYQ0VFREVEOwogCSAgICB9CiAJ
fQotCWlmIChyKSB7CisJaWYgKHIgJiYgciAhPSBJTUFQX1FVT1RBUk9PVF9OT05FWElTVEVOVCkg
ewogCSAgICBtYWlsYm94X2Nsb3NlKCZuZXdtYWlsYm94KTsKIAkgICAgbWFpbGJveF9jbG9zZSgm
b2xkbWFpbGJveCk7CiAJICAgIHJldHVybiByOwpAQCAtMjg1NywxOCArMjU5OCwyMCBAQAogICAg
IC8qIFJlY29yZCBuZXcgcXVvdGEgdXNhZ2UgKi8KICAgICBpZiAoIXIgJiYgbmV3bWFpbGJveC5x
dW90YS5yb290KSB7CiAJbmV3bWFpbGJveC5xdW90YS51c2VkICs9IG9sZG1haWxib3gucXVvdGFf
bWFpbGJveF91c2VkOwotCXIgPSBtYWlsYm94X3dyaXRlX3F1b3RhKCZuZXdtYWlsYm94LnF1b3Rh
KTsKLQltYWlsYm94X3VubG9ja19xdW90YSgmbmV3bWFpbGJveC5xdW90YSk7CisJciA9IHF1b3Rh
X3dyaXRlKCZuZXdtYWlsYm94LnF1b3RhLCAmdGlkKTsKKwlpZiAoIXIpIHF1b3RhX2NvbW1pdCgm
dGlkKTsKKwl0aWQgPSBOVUxMOwogICAgIH0KICAgICBpZiAocikgZ290byBmYWlsOwogCiAgICAg
aWYgKHIgJiYgbmV3bWFpbGJveC5xdW90YS5yb290KSB7Ci0JcjIgPSBtYWlsYm94X2xvY2tfcXVv
dGEoJm5ld21haWxib3gucXVvdGEpOworCXIyID0gcXVvdGFfcmVhZCgmbmV3bWFpbGJveC5xdW90
YSwgJnRpZCwgMSk7CiAJbmV3bWFpbGJveC5xdW90YS51c2VkICs9IG5ld21haWxib3gucXVvdGFf
bWFpbGJveF91c2VkOwogCWlmICghcjIpIHsKLQkgICAgcjIgPSBtYWlsYm94X3dyaXRlX3F1b3Rh
KCZuZXdtYWlsYm94LnF1b3RhKTsKLQkgICAgbWFpbGJveF91bmxvY2tfcXVvdGEoJm5ld21haWxi
b3gucXVvdGEpOworCSAgICByMiA9IHF1b3RhX3dyaXRlKCZuZXdtYWlsYm94LnF1b3RhLCAmdGlk
KTsKKwkgICAgaWYgKCFyMikgcXVvdGFfY29tbWl0KCZ0aWQpOwogCX0KKwllbHNlIGlmIChyMiA9
PSBJTUFQX1FVT1RBUk9PVF9OT05FWElTVEVOVCkgcjIgPSAwOwogCWlmIChyMikgewogCSAgICBz
eXNsb2coTE9HX0VSUiwKIAkgICAgICAiTE9TVFFVT1RBOiB1bmFibGUgdG8gcmVjb3JkIHVzZSBv
ZiAlbHUgYnl0ZXMgaW4gcXVvdGEgJXMiLApAQCAtMzAwMyw1MiArMjc0Niw1IEBACiAgICAgLyog
Y2hhbmdlIGFsbCAnLidzIHRvICcvJyAqLwogICAgIGZvciAocCA9IGJ1ZjsgKnA7IHArKykgewog
CWlmICgqcCA9PSAnLicpICpwID0gJy8nOwotICAgIH0KLX0KLQotLyogc2ltcGxlIGhhc2ggc28g
aXQncyBlYXN5IHRvIGZpbmQgdGhlc2UgdGhpbmdzIGluIHRoZSBmaWxlc3lzdGVtOwotICAgb3Vy
IGh1bWFuIHRpbWUgaXMgd29ydGggbW9yZSB0aGFuIGVmZmljaWVuY3kgKi8KLXZvaWQgbWFpbGJv
eF9oYXNoX3F1b3RhKGNoYXIgKmJ1Ziwgc2l6ZV90IHNpemUsIGNvbnN0IGNoYXIgKnFyKSB7Ci0g
ICAgY29uc3QgY2hhciAqaWR4OwotICAgIGNoYXIgYywgKnA7Ci0gICAgdW5zaWduZWQgbGVuOwot
Ci0gICAgaWYgKChsZW4gPSBzbnByaW50ZihidWYsIHNpemUsICIlcyIsIGNvbmZpZ19kaXIpKSA+
PSBzaXplKSB7Ci0gICAgICAgIGZhdGFsKCJpbnN1ZmZpY2llbnQgYnVmZmVyIHNpemUgaW4gbWFp
bGJveF9oYXNoX3F1b3RhIiwgRUNfVEVNUEZBSUwpOwotICAgIH0KLSAgICBidWYgKz0gbGVuOwot
ICAgIHNpemUgLT0gbGVuOwotCi0gICAgaWYgKGNvbmZpZ192aXJ0ZG9tYWlucyAmJiAocCA9IHN0
cmNocihxciwgJyEnKSkpIHsKLQkqcCA9ICdcMCc7ICAvKiBzcGxpdCBkb21haW4hcXIgKi8KLQlj
ID0gKGNoYXIpIGRpcl9oYXNoX2MocXIpOwotCWlmICgobGVuID0gc25wcmludGYoYnVmLCBzaXpl
LCAiJXMlYy8lcyIsIEZOQU1FX0RPTUFJTkRJUiwgYywgcXIpKSA+PSBzaXplKSB7Ci0JICAgIGZh
dGFsKCJpbnN1ZmZpY2llbnQgYnVmZmVyIHNpemUgaW4gbWFpbGJveF9oYXNoX3F1b3RhIiwgRUNf
VEVNUEZBSUwpOwotCX0KLQkqcCsrID0gJyEnOyAgLyogcmVhc3NlbWJsZSBkb21haW4hcXIgKi8K
LQlxciA9IHA7Ci0JYnVmICs9IGxlbjsKLQlzaXplIC09IGxlbjsKLQotCWlmICghKnFyKSB7Ci0J
ICAgIC8qIHF1b3RhIGZvciBlbnRpcmUgZG9tYWluICovCi0JICAgIGlmIChzbnByaW50ZihidWYs
IHNpemUsICIlc3Jvb3QiLCBGTkFNRV9RVU9UQURJUikgPj0gc2l6ZSkgewotCQlmYXRhbCgiaW5z
dWZmaWNpZW50IGJ1ZmZlciBzaXplIGluIG1haWxib3hfaGFzaF9xdW90YSIsCi0JCSAgICAgIEVD
X1RFTVBGQUlMKTsKLQkgICAgfQotCSAgICByZXR1cm47Ci0JfQotICAgIH0KLQotICAgIGlkeCA9
IHN0cmNocihxciwgJy4nKTsgLyogc2tpcCBwYXN0IHVzZXIuICovCi0gICAgaWYgKGlkeCA9PSBO
VUxMKSB7Ci0JaWR4ID0gcXI7Ci0gICAgfSBlbHNlIHsKLQlpZHgrKzsKLSAgICB9Ci0gICAgYyA9
IChjaGFyKSBkaXJfaGFzaF9jKGlkeCk7Ci0KLSAgICBpZiAoc25wcmludGYoYnVmLCBzaXplLCAi
JXMlYy8lcyIsIEZOQU1FX1FVT1RBRElSLCBjLCBxcikgPj0gc2l6ZSkgewotCWZhdGFsKCJpbnN1
ZmZpY2llbnQgYnVmZmVyIHNpemUgaW4gbWFpbGJveF9oYXNoX3F1b3RhIiwgRUNfVEVNUEZBSUwp
OwogICAgIH0KIH0KSW5kZXg6IGltYXAvbWFpbGJveC5oCj09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KUkNTIGZpbGU6IC9h
ZnMvYW5kcmV3L3N5c3RlbS9jdnMvc3JjL2N5cnVzL2ltYXAvbWFpbGJveC5oLHYKcmV0cmlldmlu
ZyByZXZpc2lvbiAxLjc4CmRpZmYgLXUgLXUgLXIxLjc4IG1haWxib3guaAotLS0gaW1hcC9tYWls
Ym94LmgJMjcgT2N0IDIwMDMgMjE6NTM6NTEgLTAwMDAJMS43OAorKysgaW1hcC9tYWlsYm94LmgJ
NiBKYW4gMjAwNCAyMTo1MjozMyAtMDAwMApAQCAtNDcsNiArNDcsNyBAQAogI2luY2x1ZGUgPGxp
bWl0cy5oPgogCiAjaW5jbHVkZSAiYXV0aC5oIgorI2luY2x1ZGUgInF1b3RhLmgiCiAKICNkZWZp
bmUgQklUMzJfTUFYIDQyOTQ5NjcyOTVVCiAKQEAgLTc5LDIzICs4MCw5IEBACiAjZGVmaW5lIEZO
QU1FX0lOREVYICIvY3lydXMuaW5kZXgiCiAjZGVmaW5lIEZOQU1FX0NBQ0hFICIvY3lydXMuY2Fj
aGUiCiAjZGVmaW5lIEZOQU1FX1NRVUFUX0lOREVYICIvY3lydXMuc3F1YXQiCi0jZGVmaW5lIEZO
QU1FX1FVT1RBRElSICIvcXVvdGEvIgogCiAjZGVmaW5lIE1BSUxCT1hfRk5BTUVfTEVOIDI1Ngog
Ci0jZGVmaW5lIFFVT1RBX1VOSVRTICgxMDI0KQotCi1zdHJ1Y3QgcXVvdGEgewotICAgIGludCBm
ZDsKLQotICAgIGludCBsb2NrX2NvdW50OwotICAgIGNoYXIgKnJvb3Q7Ci0KLSAgICAvKiBJbmZv
cm1hdGlvbiBpbiBxdW90YSBmaWxlICovCi0gICAgdW5zaWduZWQgbG9uZyB1c2VkOwotICAgIGlu
dCBsaW1pdDsJCQkvKiBpbiBRVU9UQV9VTklUUyAqLwotfTsKLQogc3RydWN0IG1haWxib3ggewog
ICAgIGludCBoZWFkZXJfZmQ7CiAgICAgaW50IGluZGV4X2ZkOwpAQCAtMjg2LDE3ICsyNzMsMTMg
QEAKIGV4dGVybiBpbnQgbWFpbGJveF9yZWFkX2luZGV4X3JlY29yZChzdHJ1Y3QgbWFpbGJveCAq
bWFpbGJveCwKIAkJCQkgICAgIHVuc2lnbmVkIG1zZ25vLAogCQkJCSAgICAgc3RydWN0IGluZGV4
X3JlY29yZCAqcmVjb3JkKTsKLWV4dGVybiBpbnQgbWFpbGJveF9yZWFkX3F1b3RhKHN0cnVjdCBx
dW90YSAqcXVvdGEpOwotZXh0ZXJuIHZvaWQgbWFpbGJveF9oYXNoX3F1b3RhKGNoYXIgKmJ1Ziwg
c2l6ZV90IHNpemUsIGNvbnN0IGNoYXIgKnFyKTsKIGV4dGVybiBpbnQgbWFpbGJveF9sb2NrX2hl
YWRlcihzdHJ1Y3QgbWFpbGJveCAqbWFpbGJveCk7CiBleHRlcm4gaW50IG1haWxib3hfbG9ja19p
bmRleChzdHJ1Y3QgbWFpbGJveCAqbWFpbGJveCk7CiBleHRlcm4gaW50IG1haWxib3hfbG9ja19w
b3Aoc3RydWN0IG1haWxib3ggKm1haWxib3gpOwotZXh0ZXJuIGludCBtYWlsYm94X2xvY2tfcXVv
dGEoc3RydWN0IHF1b3RhICpxdW90YSk7CiAKIGV4dGVybiB2b2lkIG1haWxib3hfdW5sb2NrX2hl
YWRlcihzdHJ1Y3QgbWFpbGJveCAqbWFpbGJveCk7CiBleHRlcm4gdm9pZCBtYWlsYm94X3VubG9j
a19pbmRleChzdHJ1Y3QgbWFpbGJveCAqbWFpbGJveCk7CiBleHRlcm4gdm9pZCBtYWlsYm94X3Vu
bG9ja19wb3Aoc3RydWN0IG1haWxib3ggKm1haWxib3gpOwotZXh0ZXJuIHZvaWQgbWFpbGJveF91
bmxvY2tfcXVvdGEoc3RydWN0IHF1b3RhICpxdW90YSk7CiAKIGV4dGVybiBpbnQgbWFpbGJveF93
cml0ZV9oZWFkZXIoc3RydWN0IG1haWxib3ggKm1haWxib3gpOwogZXh0ZXJuIGludCBtYWlsYm94
X3dyaXRlX2luZGV4X2hlYWRlcihzdHJ1Y3QgbWFpbGJveCAqbWFpbGJveCk7CkBAIC0zMDcsOSAr
MjkwLDYgQEAKIGV4dGVybiBpbnQgbWFpbGJveF9hcHBlbmRfaW5kZXgoc3RydWN0IG1haWxib3gg
Km1haWxib3gsCiAJCQkJc3RydWN0IGluZGV4X3JlY29yZCAqcmVjb3JkLAogCQkJCXVuc2lnbmVk
IHN0YXJ0LCB1bnNpZ25lZCBudW0sIGludCBzeW5jKTsKLWV4dGVybiBpbnQgbWFpbGJveF93cml0
ZV9xdW90YShzdHJ1Y3QgcXVvdGEgKnF1b3RhKTsKLQotZXh0ZXJuIGludCBtYWlsYm94X2RlbGV0
ZV9xdW90YShzdHJ1Y3QgcXVvdGEgKnF1b3RhKTsKIAogZXh0ZXJuIGludCBtYWlsYm94X2V4cHVu
Z2Uoc3RydWN0IG1haWxib3ggKm1haWxib3gsCiAJCQkgICBpbnQgaXNjdXJyZW50ZGlyLApAQCAt
MzE3LDcgKzI5Nyw2IEBACiAJCQkgICB2b2lkICpkZWNpZGVyb2NrKTsKIGV4dGVybiBpbnQgbWFp
bGJveF9leHB1bmdlbmV3cyhzdHJ1Y3QgbWFpbGJveCAqbWFpbGJveCk7CiAKLWV4dGVybiBpbnQg
bWFpbGJveF9maW5kcXVvdGEoY2hhciAqcmV0LCBzaXplX3QgcmV0bGVuLCBjb25zdCBjaGFyICpu
YW1lKTsKIGV4dGVybiB2b2lkIG1haWxib3hfbWFrZV91bmlxdWVpZChjaGFyICpuYW1lLCB1bnNp
Z25lZCBsb25nIHVpZHZhbGlkaXR5LAogCQkJCSAgY2hhciAqdW5pcXVlaWQsIHNpemVfdCBvdXRs
ZW4pOwogCkluZGV4OiBpbWFwL21iZHVtcC5jCj09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KUkNTIGZpbGU6IC9hZnMvYW5k
cmV3L3N5c3RlbS9jdnMvc3JjL2N5cnVzL2ltYXAvbWJkdW1wLmMsdgpyZXRyaWV2aW5nIHJldmlz
aW9uIDEuMjcKZGlmZiAtdSAtdSAtcjEuMjcgbWJkdW1wLmMKLS0tIGltYXAvbWJkdW1wLmMJMjQg
T2N0IDIwMDMgMTc6MzE6NDkgLTAwMDAJMS4yNworKysgaW1hcC9tYmR1bXAuYwk2IEphbiAyMDA0
IDIxOjUyOjMzIC0wMDAwCkBAIC03MSw2ICs3MSw3IEBACiAjaW5jbHVkZSAibWJkdW1wLmgiCiAj
aW5jbHVkZSAibWJveGxpc3QuaCIKICNpbmNsdWRlICJwcm90LmgiCisjaW5jbHVkZSAicXVvdGEu
aCIKICNpbmNsdWRlICJzZWVuLmgiCiAjaW5jbHVkZSAieG1hbGxvYy5oIgogI2luY2x1ZGUgInV0
aWwuaCIKQEAgLTIxNiwyMSArMjE3LDExIEBACiAgICAgLyogVGhlIGZpcnN0IG1lbWJlciBpcyBl
aXRoZXIgYSBudW1iZXIgKGlmIGl0IGlzIGEgcXVvdGEgcm9vdCksIG9yIE5JTAogICAgICAqIChp
ZiBpdCBpc24ndCkgKi8KICAgICB7Ci0JY2hhciBidWZbTUFYX01BSUxCT1hfUEFUSCsxXTsKIAlz
dHJ1Y3QgcXVvdGEgcXVvdGE7CiAKLQlxdW90YS5mZCA9IC0xOwogCXF1b3RhLnJvb3QgPSAoY2hh
ciAqKW1ibmFtZTsgLyogeHh4ICovCi0JbWFpbGJveF9oYXNoX3F1b3RhKGJ1ZixzaXplb2YoYnVm
KSxxdW90YS5yb290KTsKLQlxdW90YS5mZCA9IG9wZW4oYnVmLCBPX1JEV1IsIDApOwotCWlmKHF1
b3RhLmZkID09IC0xKSB7Ci0JICAgIHByb3RfcHJpbnRmKHBvdXQsICJOSUwgIik7Ci0JICAgIGdv
dG8gZHVtcF9maWxlczsKLQl9Ci0KLQlyID0gbWFpbGJveF9yZWFkX3F1b3RhKCZxdW90YSk7Ci0J
Y2xvc2UocXVvdGEuZmQpOwogCisJciA9IHF1b3RhX3JlYWQoJnF1b3RhLCBOVUxMLCAwKTsKIAlp
ZihyKSB7CiAJICAgIHByb3RfcHJpbnRmKHBvdXQsICJOSUwgIik7CiAJICAgIGdvdG8gZHVtcF9m
aWxlczsgCkBAIC03OTIsMTcgKzc4MywxNyBAQAogICAgIGlmKCFyICYmIHF1b3RhdXNlZCkgewog
CXN0cnVjdCBxdW90YSBxdW90YTsKIAljaGFyIHF1b3RhX3Jvb3RbTUFYX01BSUxCT1hfUEFUSCsx
XTsKKwlzdHJ1Y3QgdHhuICp0aWQgPSBOVUxMOwogCQotCWlmKG1haWxib3hfZmluZHF1b3RhKHF1
b3RhX3Jvb3QsIHNpemVvZihxdW90YV9yb290KSwgbWJuYW1lKSkgeworCWlmIChxdW90YV9maW5k
cm9vdChxdW90YV9yb290LCBzaXplb2YocXVvdGFfcm9vdCksIG1ibmFtZSkpIHsKIAkgICAgLyog
dXBkYXRlIHRoZSBxdW90YSBmaWxlICovCiAJICAgIG1lbXNldCgmcXVvdGEsIDAsIHNpemVvZihx
dW90YSkpOwogCSAgICBxdW90YS5yb290ID0gcXVvdGFfcm9vdDsKLQkgICAgcXVvdGEuZmQgPSAt
MTsKLQkgICAgciA9IG1haWxib3hfbG9ja19xdW90YSgmcXVvdGEpOworCSAgICByID0gcXVvdGFf
cmVhZCgmcXVvdGEsICZ0aWQsIDEpOwogCSAgICBpZighcikgewogCQlxdW90YS51c2VkICs9IHF1
b3RhdXNlZDsKLQkJciA9IG1haWxib3hfd3JpdGVfcXVvdGEoJnF1b3RhKTsKLQkJY2xvc2UocXVv
dGEuZmQpOworCQlyID0gcXVvdGFfd3JpdGUoJnF1b3RhLCAmdGlkKTsKKwkJaWYgKCFyKSBxdW90
YV9jb21taXQoJnRpZCk7CiAJICAgIH0gZWxzZSB7CiAJCXN5c2xvZyhMT0dfRVJSLCAiY291bGQg
bm90IGxvY2sgcXVvdGEgZmlsZSBmb3IgJXMgKCVzKSIsCiAJCSAgICAgICBxdW90YV9yb290LCBl
cnJvcl9tZXNzYWdlKHIpKTsKSW5kZXg6IGltYXAvbWJveGxpc3QuYwo9PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09ClJDUyBm
aWxlOiAvYWZzL2FuZHJldy9zeXN0ZW0vY3ZzL3NyYy9jeXJ1cy9pbWFwL21ib3hsaXN0LmMsdgpy
ZXRyaWV2aW5nIHJldmlzaW9uIDEuMjI3CmRpZmYgLXUgLXUgLXIxLjIyNyBtYm94bGlzdC5jCi0t
LSBpbWFwL21ib3hsaXN0LmMJMTUgRGVjIDIwMDMgMjA6MDA6NDAgLTAwMDAJMS4yMjcKKysrIGlt
YXAvbWJveGxpc3QuYwk2IEphbiAyMDA0IDIxOjUyOjMzIC0wMDAwCkBAIC04MCw2ICs4MCw3IEBA
CiAjaW5jbHVkZSAibXVwZGF0ZS1jbGllbnQuaCIKIAogI2luY2x1ZGUgIm1ib3hsaXN0LmgiCisj
aW5jbHVkZSAicXVvdGEuaCIKIAogI2RlZmluZSBEQiBjb25maWdfbWJveGxpc3RfZGIKICNkZWZp
bmUgU1VCREIgY29uZmlnX3N1YnNjcmlwdGlvbl9kYgpAQCAtOTgsNiArOTksMTEgQEAKIHN0YXRp
YyBpbnQgbWJveGxpc3RfY2hhbmdlcXVvdGEoY29uc3QgY2hhciAqbmFtZSwgaW50IG1hdGNobGVu
LCBpbnQgbWF5Y3JlYXRlLAogCQkJCXZvaWQgKnJvY2spOwogCitzdHJ1Y3QgY2hhbmdlX3JvY2sg
eworICAgIHN0cnVjdCBxdW90YSAqcXVvdGE7CisgICAgc3RydWN0IHR4biAqKnRpZDsKK307CisK
ICNkZWZpbmUgRk5BTUVfU1VCU1NVRkZJWCAiLnN1YiIKIAogLyoKQEAgLTIyNDksNiArMjI1NSw4
IEBACiAgICAgc3RydWN0IHF1b3RhIHF1b3RhOwogICAgIGludCBoYXZlX21haWxib3ggPSAxOwog
ICAgIGludCByLCB0OworICAgIHN0cnVjdCB0eG4gKnRpZCA9IE5VTEw7CisgICAgc3RydWN0IGNo
YW5nZV9yb2NrIGNyb2NrOwogCiAgICAgaWYgKCFyb290WzBdIHx8IHJvb3RbMF0gPT0gJy4nIHx8
IHN0cmNocihyb290LCAnLycpCiAJfHwgc3RyY2hyKHJvb3QsICcqJykgfHwgc3RyY2hyKHJvb3Qs
ICclJykgfHwgc3RyY2hyKHJvb3QsICc/JykpIHsKQEAgLTIyNTgsMjEgKzIyNjYsMjEgQEAKICAg
ICBtZW1zZXQoJnF1b3RhLCAwLCBzaXplb2Yoc3RydWN0IHF1b3RhKSk7CiAKICAgICBxdW90YS5y
b290ID0gKGNoYXIgKikgcm9vdDsKLSAgICBtYWlsYm94X2hhc2hfcXVvdGEocXVvdGFfcGF0aCwg
c2l6ZW9mKHF1b3RhX3BhdGgpLCByb290KTsKKyAgICByID0gcXVvdGFfcmVhZCgmcXVvdGEsICZ0
aWQsIDEpOwogCi0gICAgaWYgKChxdW90YS5mZCA9IG9wZW4ocXVvdGFfcGF0aCwgT19SRFdSLCAw
KSkgIT0gLTEpIHsKLQkvKiBKdXN0IGxvY2sgYW5kIGNoYW5nZSBpdCAqLwotCXIgPSBtYWlsYm94
X2xvY2tfcXVvdGEoJnF1b3RhKTsKKyAgICBpZiAoIXIpIHsKKwkvKiBKdXN0IGNoYW5nZSBpdCAq
LwogCiAJcXVvdGEubGltaXQgPSBuZXdxdW90YTsKIAotCWlmICghcikgciA9IG1haWxib3hfd3Jp
dGVfcXVvdGEoJnF1b3RhKTsKLQlpZiAocXVvdGEuZmQgIT0gLTEpIHsKLQkgICAgY2xvc2UocXVv
dGEuZmQpOwotCX0KKwlyID0gcXVvdGFfd3JpdGUoJnF1b3RhLCAmdGlkKTsKKwlpZiAoIXIpIHF1
b3RhX2NvbW1pdCgmdGlkKTsKKwogCXJldHVybiByOwogICAgIH0KIAorICAgIGlmIChyICE9IElN
QVBfUVVPVEFST09UX05PTkVYSVNURU5UKSByZXR1cm4gcjsKKwogICAgIC8qCiAgICAgICogSGF2
ZSB0byBjcmVhdGUgYSBuZXcgcXVvdGEgcm9vdAogICAgICAqLwpAQCAtMjMwNCwyNSArMjMxMiwy
MSBAQAogICAgIH0KIAogICAgIC8qIHBlcmhhcHMgY3JlYXRlIC5ORVcsIGxvY2ssIGNoZWNrIGlm
IGl0IGdvdCByZWNyZWF0ZWQsIG1vdmUgaW4gcGxhY2UgKi8KLSAgICBxdW90YS5sb2NrX2NvdW50
ID0gMTsKICAgICBxdW90YS51c2VkID0gMDsKICAgICBxdW90YS5saW1pdCA9IG5ld3F1b3RhOwot
ICAgIHIgPSBtYWlsYm94X3dyaXRlX3F1b3RhKCZxdW90YSk7Ci0KLSAgICBpZiAocikgewotCXJl
dHVybiByOwotICAgIH0KKyAgICByID0gcXVvdGFfd3JpdGUoJnF1b3RhLCAmdGlkKTsKKyAgICBp
ZiAocikgcmV0dXJuIHI7CiAKKyAgICBjcm9jay5xdW90YSA9ICZxdW90YTsKKyAgICBjcm9jay50
aWQgPSAmdGlkOwogICAgIC8qIHRvcCBsZXZlbCBtYWlsYm94ICovCiAgICAgaWYoaGF2ZV9tYWls
Ym94KQotCW1ib3hsaXN0X2NoYW5nZXF1b3RhKHF1b3RhLnJvb3QsIDAsIDAsICZxdW90YSk7CisJ
bWJveGxpc3RfY2hhbmdlcXVvdGEocXVvdGEucm9vdCwgMCwgMCwgJmNyb2NrKTsKICAgICAvKiBz
dWJtYWlsYm94ZXMgLSB3ZSdyZSB1c2luZyBpbnRlcm5hbCBuYW1lcyBoZXJlICovCi0gICAgbWJv
eGxpc3RfZmluZGFsbChOVUxMLCBwYXR0ZXJuLCAxLCAwLCAwLCBtYm94bGlzdF9jaGFuZ2VxdW90
YSwgJnF1b3RhKTsKKyAgICBtYm94bGlzdF9maW5kYWxsKE5VTEwsIHBhdHRlcm4sIDEsIDAsIDAs
IG1ib3hsaXN0X2NoYW5nZXF1b3RhLCAmY3JvY2spOwogICAgIAotICAgIHIgPSBtYWlsYm94X3dy
aXRlX3F1b3RhKCZxdW90YSk7Ci0gICAgaWYgKHF1b3RhLmZkICE9IC0xKSB7Ci0JY2xvc2UocXVv
dGEuZmQpOwotICAgIH0KKyAgICByID0gcXVvdGFfd3JpdGUoJnF1b3RhLCAmdGlkKTsKKyAgICBp
ZiAoIXIpIHF1b3RhX2NvbW1pdCgmdGlkKTsKIAogICAgIHJldHVybiByOwogfQpAQCAtMjMzMiw5
ICsyMzM2LDggQEAKICAqLwogaW50IG1ib3hsaXN0X3Vuc2V0cXVvdGEoY29uc3QgY2hhciAqcm9v
dCkKIHsKLSAgICBjaGFyIHF1b3RhX3BhdGhbTUFYX01BSUxCT1hfUEFUSCsxXTsKICAgICBjaGFy
IHBhdHRlcm5bTUFYX01BSUxCT1hfUEFUSCsxXTsKLSAgICBpbnQgZmQ7CisgICAgc3RydWN0IHF1
b3RhIHF1b3RhOwogICAgIGludCByPTA7CiAKICAgICBpZiAoIXJvb3RbMF0gfHwgcm9vdFswXSA9
PSAnLicgfHwgc3RyY2hyKHJvb3QsICcvJykKQEAgLTIzNDIsMTQgKzIzNDUsMTMgQEAKIAlyZXR1
cm4gSU1BUF9NQUlMQk9YX0JBRE5BTUU7CiAgICAgfQogICAgIAotICAgIG1haWxib3hfaGFzaF9x
dW90YShxdW90YV9wYXRoLCBzaXplb2YocXVvdGFfcGF0aCksIHJvb3QpOwotCi0gICAgaWYgKChm
ZCA9IG9wZW4ocXVvdGFfcGF0aCwgT19SRFdSLCAwKSkgPT0gLTEpIHsKKyAgICBxdW90YS5yb290
ID0gKGNoYXIgKikgcm9vdDsKKyAgICByID0gcXVvdGFfcmVhZCgmcXVvdGEsIE5VTEwsIDApOwor
ICAgIGlmIChyID09IElNQVBfUVVPVEFST09UX05PTkVYSVNURU5UKSB7CiAJLyogYWxyZWFkeSB1
bnNldCAqLwogCXJldHVybiAwOwogICAgIH0KLSAgICAKLSAgICBjbG9zZShmZCk7CisgICAgZWxz
ZSBpZiAocikgcmV0dXJuIHI7CiAKICAgICAvKgogICAgICAqIEhhdmUgdG8gcmVtb3ZlIGl0IGZy
b20gYWxsIGFmZmVjdGVkIG1haWxib3hlcwpAQCAtMjM2NywxMCArMjM2OSw3IEBACiAgICAgLyog
c3VibWFpbGJveGVzIC0gd2UncmUgdXNpbmcgaW50ZXJuYWwgbmFtZXMgaGVyZSAqLwogICAgIG1i
b3hsaXN0X2ZpbmRhbGwoTlVMTCwgcGF0dGVybiwgMSwgMCwgMCwgbWJveGxpc3Rfcm1xdW90YSwg
KHZvaWQgKilyb290KTsKIAotICAgIGlmKHVubGluayhxdW90YV9wYXRoKSA9PSAtMSkgewotCXN5
c2xvZyhMT0dfRVJSLCAiY291bGQgbm90IHVubGluayAlcyAoJW0pIiwgcXVvdGFfcGF0aCk7Ci0J
ciA9IElNQVBfU1lTX0VSUk9SOwotICAgIH0KKyAgICByID0gcXVvdGFfZGVsZXRlKCZxdW90YSwg
TlVMTCk7CiAKICAgICByZXR1cm4gcjsKIH0KQEAgLTI0NjIsNyArMjQ2MSw5IEBACiB7CiAgICAg
aW50IHI7CiAgICAgc3RydWN0IG1haWxib3ggbWFpbGJveDsKLSAgICBzdHJ1Y3QgcXVvdGEgKm1i
b3hsaXN0X25ld3F1b3RhID0gKHN0cnVjdCBxdW90YSAqKSByb2NrOworICAgIHN0cnVjdCBjaGFu
Z2Vfcm9jayAqY3JvY2sgPSAoc3RydWN0IGNoYW5nZV9yb2NrICopIHJvY2s7CisgICAgc3RydWN0
IHF1b3RhICptYm94bGlzdF9uZXdxdW90YSA9IGNyb2NrLT5xdW90YTsKKyAgICBzdHJ1Y3QgdHhu
ICoqdGlkID0gY3JvY2stPnRpZDsKIAogICAgIGFzc2VydChyb2NrICE9IE5VTEwpOwogCkBAIC0y
NDg1LDcgKzI0ODYsNyBAQAogCSAgICByZXR1cm4gMDsKIAl9CiAKLQlyID0gbWFpbGJveF9sb2Nr
X3F1b3RhKCZtYWlsYm94LnF1b3RhKTsKKwlyID0gcXVvdGFfcmVhZCgmbWFpbGJveC5xdW90YSwg
dGlkLCAxKTsKIAlpZiAocikgZ290byBlcnJvcjsKIAlpZiAobWFpbGJveC5xdW90YS51c2VkID49
IG1haWxib3gucXVvdGFfbWFpbGJveF91c2VkKSB7CiAJICAgIG1haWxib3gucXVvdGEudXNlZCAt
PSBtYWlsYm94LnF1b3RhX21haWxib3hfdXNlZDsKQEAgLTI0OTMsMTMgKzI0OTQsMTIgQEAKIAll
bHNlIHsKIAkgICAgbWFpbGJveC5xdW90YS51c2VkID0gMDsKIAl9Ci0JciA9IG1haWxib3hfd3Jp
dGVfcXVvdGEoJm1haWxib3gucXVvdGEpOworCXIgPSBxdW90YV93cml0ZSgmbWFpbGJveC5xdW90
YSwgdGlkKTsKIAlpZiAocikgewogCSAgICBzeXNsb2coTE9HX0VSUiwKIAkJICAgIkxPU1RRVU9U
QTogdW5hYmxlIHRvIHJlY29yZCBmcmVlIG9mICVsdSBieXRlcyBpbiBxdW90YSAlcyIsCiAJCSAg
IG1haWxib3gucXVvdGFfbWFpbGJveF91c2VkLCBtYWlsYm94LnF1b3RhLnJvb3QpOwogCX0KLQlt
YWlsYm94X3VubG9ja19xdW90YSgmbWFpbGJveC5xdW90YSk7CiAJZnJlZShtYWlsYm94LnF1b3Rh
LnJvb3QpOwogICAgIH0KIApJbmRleDogaW1hcC9ubnRwZC5jCj09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KUkNTIGZpbGU6
IC9hZnMvYW5kcmV3L3N5c3RlbS9jdnMvc3JjL2N5cnVzL2ltYXAvbm50cGQuYyx2CnJldHJpZXZp
bmcgcmV2aXNpb24gMS45CmRpZmYgLXUgLXUgLXIxLjkgbm50cGQuYwotLS0gaW1hcC9ubnRwZC5j
CTUgSmFuIDIwMDQgMTk6NTY6MzcgLTAwMDAJMS45CisrKyBpbWFwL25udHBkLmMJNiBKYW4gMjAw
NCAyMTo1MjozNCAtMDAwMApAQCAtNTc0LDYgKzU3NCwxMCBAQAogICAgIG1ib3hsaXN0X2luaXQo
MCk7CiAgICAgbWJveGxpc3Rfb3BlbihOVUxMKTsKIAorICAgIC8qIG9wZW4gdGhlIHF1b3RhIGRi
LCB3ZSdsbCBuZWVkIGl0IGZvciBleHB1bmdlICovCisgICAgcXVvdGFkYl9pbml0KDApOworICAg
IHF1b3RhZGJfb3BlbihOVUxMKTsKKwogICAgIHdoaWxlICgob3B0ID0gZ2V0b3B0KGFyZ2MsIGFy
Z3YsICJzcmYiKSkgIT0gRU9GKSB7CiAJc3dpdGNoKG9wdCkgewogCWNhc2UgJ3MnOiAvKiBubnRw
cyAoZG8gc3RhcnR0bHMgcmlnaHQgYXdheSkgKi8KQEAgLTc1OCw2ICs3NjIsOSBAQAogICAgIG1i
b3hsaXN0X2Nsb3NlKCk7CiAgICAgbWJveGxpc3RfZG9uZSgpOwogCisgICAgcXVvdGFkYl9jbG9z
ZSgpOworICAgIHF1b3RhZGJfZG9uZSgpOworCiAgICAgYW5ub3RhdGVtb3JlX2Nsb3NlKCk7CiAg
ICAgYW5ub3RhdGVtb3JlX2RvbmUoKTsKIApAQCAtMzEwOSwxMiArMzExNiwxMyBAQAogCQllbHNl
CiAJCSAgICByID0gYXBwZW5kX2Zyb21zdHJlYW0oJmFzLCBtc2ctPmRhdGEsIG1zZy0+c2l6ZSwg
bm93LAogCQkJCQkgIChjb25zdCBjaGFyICoqKSBOVUxMLCAwKTsKLQkJaWYgKCFyKSBhcHBlbmRf
Y29tbWl0KCZhcywgTlVMTCwgJnVpZCwgTlVMTCk7CisJCWlmICghcikgYXBwZW5kX2NvbW1pdCgm
YXMsIDAsIE5VTEwsICZ1aWQsIE5VTEwpOwogCQllbHNlIGFwcGVuZF9hYm9ydCgmYXMpOwogCSAg
ICB9CiAKIAkgICAgaWYgKCFyICYmIG1zZy0+aWQpCi0JCWR1cGxpY2F0ZV9tYXJrKG1zZy0+aWQs
IHN0cmxlbihtc2ctPmlkKSwgcmNwdCwgc3RybGVuKHJjcHQpLCBub3csIHVpZCk7CisJCWR1cGxp
Y2F0ZV9tYXJrKG1zZy0+aWQsIHN0cmxlbihtc2ctPmlkKSwgcmNwdCwgc3RybGVuKHJjcHQpLAor
CQkJICAgICAgIG5vdywgdWlkKTsKIAogCSAgICBpZiAocikgcmV0dXJuIHI7CiAKSW5kZXg6IGlt
YXAvcG9wM2QuYwo9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09ClJDUyBmaWxlOiAvYWZzL2FuZHJldy9zeXN0ZW0vY3ZzL3Ny
Yy9jeXJ1cy9pbWFwL3BvcDNkLmMsdgpyZXRyaWV2aW5nIHJldmlzaW9uIDEuMTQ3CmRpZmYgLXUg
LXUgLXIxLjE0NyBwb3AzZC5jCi0tLSBpbWFwL3BvcDNkLmMJMjQgT2N0IDIwMDMgMTg6MjQ6MDcg
LTAwMDAJMS4xNDcKKysrIGltYXAvcG9wM2QuYwk2IEphbiAyMDA0IDIxOjUyOjM0IC0wMDAwCkBA
IC0yOTQsNiArMjk0LDEwIEBACiAgICAgbWJveGxpc3RfaW5pdCgwKTsKICAgICBtYm94bGlzdF9v
cGVuKE5VTEwpOwogCisgICAgLyogb3BlbiB0aGUgcXVvdGEgZGIsIHdlJ2xsIG5lZWQgaXQgZm9y
IGV4cHVuZ2UgKi8KKyAgICBxdW90YWRiX2luaXQoMCk7CisgICAgcXVvdGFkYl9vcGVuKE5VTEwp
OworCiAgICAgLyogc2V0dXAgZm9yIHNlbmRpbmcgSU1BUCBJRExFIG5vdGlmaWNhdGlvbnMgKi8K
ICAgICBpZGxlX2VuYWJsZWQoKTsKIApAQCAtNDU4LDYgKzQ2Miw5IEBACiAKICAgICBtYm94bGlz
dF9jbG9zZSgpOwogICAgIG1ib3hsaXN0X2RvbmUoKTsKKworICAgIHF1b3RhZGJfY2xvc2UoKTsK
KyAgICBxdW90YWRiX2RvbmUoKTsKIAogICAgIGlmIChwb3BkX2luKSB7CiAJcHJvdF9OT05CTE9D
Syhwb3BkX2luKTsKSW5kZXg6IGltYXAvcXVvdGEuYwo9PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09ClJDUyBmaWxlOiAvYWZz
L2FuZHJldy9zeXN0ZW0vY3ZzL3NyYy9jeXJ1cy9pbWFwL3F1b3RhLmMsdgpyZXRyaWV2aW5nIHJl
dmlzaW9uIDEuNDgKZGlmZiAtdSAtdSAtcjEuNDggcXVvdGEuYwotLS0gaW1hcC9xdW90YS5jCTIy
IE9jdCAyMDAzIDE4OjUwOjA4IC0wMDAwCTEuNDgKKysrIGltYXAvcXVvdGEuYwk2IEphbiAyMDA0
IDIxOjUyOjM0IC0wMDAwCkBAIC03Nyw2ICs3Nyw3IEBACiAjZW5kaWYKIAogI2luY2x1ZGUgImFz
c2VydC5oIgorI2luY2x1ZGUgImN5cnVzZGIuaCIKICNpbmNsdWRlICJnbG9iYWwuaCIKICNpbmNs
dWRlICJleGl0Y29kZXMuaCIKICNpbmNsdWRlICJpbWFwX2Vyci5oIgpAQCAtODQsNiArODUsNyBA
QAogI2luY2x1ZGUgInhtYWxsb2MuaCIKICNpbmNsdWRlICJtYm94bGlzdC5oIgogI2luY2x1ZGUg
Im1ib3huYW1lLmgiCisjaW5jbHVkZSAicXVvdGEuaCIKICNpbmNsdWRlICJjb252ZXJ0X2NvZGUu
aCIKICNpbmNsdWRlICJ1dGlsLmgiCiAKQEAgLTEwMywxMSArMTA1LDE2IEBACiBpbnQgZml4cXVv
dGFfbWFpbGJveChjaGFyICpuYW1lLAogCQkgICAgIGludCBtYXRjaGxlbiwKIAkJICAgICBpbnQg
bWF5Y3JlYXRlLAotCQkgICAgIHZvaWQqIHJvY2spOworCQkgICAgIHZvaWQgKnJvY2spOwogaW50
IGZpeHF1b3RhKGNoYXIgKmRvbWFpbiwgaW50IGlzcGFydGlhbCk7CiBpbnQgZml4cXVvdGFfZml4
cm9vdChzdHJ1Y3QgbWFpbGJveCAqbWFpbGJveCwKIAkJICAgICBjaGFyICpyb290KTsKLWludCBm
aXhxdW90YV9maW5pc2goaW50IHRoaXNxdW90YSk7CitpbnQgZml4cXVvdGFfZmluaXNoKGludCB0
aGlzcXVvdGEsIHN0cnVjdCB0eG4gKip0aWQpOworCitzdHJ1Y3QgZml4X3JvY2sgeworICAgIGNo
YXIgKmRvbWFpbjsKKyAgICBzdHJ1Y3QgdHhuICoqdGlkOworfTsKIAogc3RydWN0IHF1b3RhZW50
cnkgewogICAgIHN0cnVjdCBxdW90YSBxdW90YTsKQEAgLTExOCw3ICsxMjUsNiBAQAogCiAjZGVm
aW5lIFFVT1RBR1JPVyAzMDAKIAotc3RydWN0IHF1b3RhZW50cnkgemVyb3F1b3RhZW50cnk7CiBz
dHJ1Y3QgcXVvdGFlbnRyeSAqcXVvdGE7CiBpbnQgcXVvdGFfbnVtID0gMCwgcXVvdGFfYWxsb2Mg
PSAwOwogCkBAIC0xNjIsNyArMTY4LDEwIEBACiAJZmF0YWwoZXJyb3JfbWVzc2FnZShyKSwgRUNf
Q09ORklHKTsKICAgICB9CiAKLSAgICByID0gYnVpbGRxdW90YWxpc3QoZG9tYWluLCBhcmd2K29w
dGluZCwgYXJnYy1vcHRpbmQpOworICAgIHF1b3RhZGJfaW5pdCgwKTsKKyAgICBxdW90YWRiX29w
ZW4oTlVMTCk7CisKKyAgICBpZiAoIXIpIHIgPSBidWlsZHF1b3RhbGlzdChkb21haW4sIGFyZ3Yr
b3B0aW5kLCBhcmdjLW9wdGluZCk7CiAKICAgICBpZiAoIXIgJiYgZmZsYWcpIHsKIAltYm94bGlz
dF9pbml0KDApOwpAQCAtMTcwLDYgKzE3OSw5IEBACiAJbWJveGxpc3RfZG9uZSgpOwogICAgIH0K
IAorICAgIHF1b3RhZGJfY2xvc2UoKTsKKyAgICBxdW90YWRiX2RvbmUoKTsKKwogICAgIGlmICgh
cikgcmVwb3J0cXVvdGEoKTsKIAogICAgIGlmIChyKSB7CkBAIC0xODgsNTEgKzIwMCw1OSBAQAog
ICAgIGV4aXQoRUNfVVNBR0UpOwogfSAgICAKIAotLyoKLSAqIENvbXBhcmlzb24gZnVuY3Rpb24g
Zm9yIHNvcnRpbmcgcXVvdGEgcm9vdHMKLSAqLwotaW50IGNvbXBhcmVfcXVvdGEoY29uc3Qgdm9p
ZCAqYSwgY29uc3Qgdm9pZCAqYikKK3N0cnVjdCBmaW5kX3JvY2sgeworICAgIGNoYXIgKipyb290
czsKKyAgICBpbnQgbnJvb3RzOworfTsKKworc3RhdGljIGludCBmaW5kX3Aodm9pZCAqcm9ja3As
CisJCSAgY29uc3QgY2hhciAqa2V5LCBpbnQga2V5bGVuLAorCQkgIGNvbnN0IGNoYXIgKmRhdGEs
IGludCBkYXRhbGVuKQogewotICAgIHJldHVybiBzdHJjbXAoKChzdHJ1Y3QgcXVvdGFlbnRyeSAq
KWEpLT5xdW90YS5yb290LAotCQkgICAgICAoKHN0cnVjdCBxdW90YWVudHJ5ICopYiktPnF1b3Rh
LnJvb3QpOworICAgIHN0cnVjdCBmaW5kX3JvY2sgKmZyb2NrID0gKHN0cnVjdCBmaW5kX3JvY2sg
Kikgcm9ja3A7CisgICAgaW50IGk7CisKKyAgICAvKiBJZiByZXN0cmljdGluZyBvdXIgbGlzdCwg
c2VlIGlmIHRoaXMgcXVvdGEgcm9vdCBtYXRjaGVzICovCisgICAgaWYgKGZyb2NrLT5ucm9vdHMp
IHsKKwlmb3IgKGkgPSAwOyBpIDwgZnJvY2stPm5yb290czsgaSsrKSB7CisJICAgIGlmICgoIXN0
cm5jbXAoa2V5LCBmcm9jay0+cm9vdHNbaV0sIGtleWxlbikgJiYKKwkJIGtleWxlbiA9PSBzdHJs
ZW4oZnJvY2stPnJvb3RzW2ldKSkgfHwKKwkJKCFzdHJuY21wKGtleSwgZnJvY2stPnJvb3RzW2ld
LCBzdHJsZW4oZnJvY2stPnJvb3RzW2ldKSkgJiYKKwkJIGtleVtzdHJsZW4oZnJvY2stPnJvb3Rz
W2ldKV0gPT0gJy4nKSkgYnJlYWs7CisJfQorCWlmIChpID09IGZyb2NrLT5ucm9vdHMpIHJldHVy
biAwOworICAgIH0KKworICAgIHJldHVybiAxOwogfQogCiAvKgogICogQWRkIGEgcXVvdGEgcm9v
dCB0byB0aGUgbGlzdCBpbiAncXVvdGEnCiAgKi8KLXZvaWQgYWRkcXVvdGFyb290KGNoYXIgKmRv
bWFpbiwgY2hhciAqcXIpCitzdGF0aWMgaW50IGZpbmRfY2Iodm9pZCAqcm9ja3AsCisJCSAgIGNv
bnN0IGNoYXIgKmtleSwgaW50IGtleWxlbiwKKwkJICAgY29uc3QgY2hhciAqZGF0YSwgaW50IGRh
dGFsZW4pCiB7CiAgICAgaW50IHI7CisgICAgdW5zaWduZWQgbG9uZyB1c2VkOworICAgIGludCBs
aW1pdDsKKyAgICBjaGFyICpwOworCisgICAgaWYgKCFkYXRhKSByZXR1cm4gMDsKIAogICAgIGlm
IChxdW90YV9udW0gPT0gcXVvdGFfYWxsb2MpIHsKIAlxdW90YV9hbGxvYyArPSBRVU9UQUdST1c7
CiAJcXVvdGEgPSAoc3RydWN0IHF1b3RhZW50cnkgKikKIAkgIHhyZWFsbG9jKChjaGFyICopcXVv
dGEsIHF1b3RhX2FsbG9jICogc2l6ZW9mKHN0cnVjdCBxdW90YWVudHJ5KSk7CiAgICAgfQotICAg
IHF1b3RhW3F1b3RhX251bV0gPSB6ZXJvcXVvdGFlbnRyeTsKLSAgICBxdW90YVtxdW90YV9udW1d
LnF1b3RhLmZkID0gLTE7Ci0gICAgaWYgKGRvbWFpbikgewotICAJcXVvdGFbcXVvdGFfbnVtXS5x
dW90YS5yb290ID0KLQkgIHhtYWxsb2Moc3RybGVuKHFyKSArIHN0cmxlbihkb21haW4pICsgMik7
Ci0Jc3ByaW50ZihxdW90YVtxdW90YV9udW1dLnF1b3RhLnJvb3QsICIlcyElcyIsCi0JCWRvbWFp
biwgcXIpOwotICAgIH0KLSAgICBlbHNlCi0gIAlxdW90YVtxdW90YV9udW1dLnF1b3RhLnJvb3Qg
PSB4c3RyZHVwKHFyKTsKLSAgCi0gICAgciA9IG1haWxib3hfcmVhZF9xdW90YSgmcXVvdGFbcXVv
dGFfbnVtXS5xdW90YSk7Ci0gICAgaWYgKHF1b3RhW3F1b3RhX251bV0ucXVvdGEuZmQgIT0gLTEp
IHsKLSAgCWNsb3NlKHF1b3RhW3F1b3RhX251bV0ucXVvdGEuZmQpOwotCXF1b3RhW3F1b3RhX251
bV0ucXVvdGEuZmQgPSAtMTsKLSAgICB9Ci0gICAgaWYgKHIpIHsKLSAgCWNvbV9lcnIocXIsIHIs
Ci0JCShyID09IEVDX0lPRVJSKSA/IGVycm9yX21lc3NhZ2UoZXJybm8pIDogTlVMTCk7Ci0JcXVv
dGFbcXVvdGFfbnVtXS5xdW90YS51c2VkID0gMDsKLQlxdW90YVtxdW90YV9udW1dLnF1b3RhLmxp
bWl0ID0gLTE7Ci0gICAgfQorICAgIG1lbXNldCgmcXVvdGFbcXVvdGFfbnVtXSwgMCwgc2l6ZW9m
KHN0cnVjdCBxdW90YWVudHJ5KSk7CisgICAgcXVvdGFbcXVvdGFfbnVtXS5xdW90YS5yb290ID0g
eHN0cm5kdXAoa2V5LCBrZXlsZW4pOworICAgIHNzY2FuZihkYXRhLCAiJWx1ICVkIiwKKwkgICAm
cXVvdGFbcXVvdGFfbnVtXS5xdW90YS51c2VkLCAmcXVvdGFbcXVvdGFfbnVtXS5xdW90YS5saW1p
dCk7CiAgIAogICAgIHF1b3RhX251bSsrOworCisgICAgcmV0dXJuIDA7CiB9CiAKIC8qCkBAIC0y
NDAsMTEgKzI2MCw5IEBACiAgKi8KIGludCBidWlsZHF1b3RhbGlzdChjaGFyICpkb21haW4sIGNo
YXIgKipyb290cywgaW50IG5yb290cykKIHsKLSAgICBjaGFyIHF1b3RhX3BhdGhbTUFYX01BSUxC
T1hfUEFUSCsxXTsKICAgICBpbnQgaTsKLSAgICBESVIgKmRpcnA7Ci0gICAgRElSICp0b3BwOwot
ICAgIHN0cnVjdCBkaXJlbnQgKmRpcmVudDsKKyAgICBjaGFyIGJ1ZltNQVhfTUFJTEJPWF9OQU1F
KzFdOworICAgIHN0cnVjdCBmaW5kX3JvY2sgZnJvY2sgPSB7IHJvb3RzLCBucm9vdHMgfTsKIAog
ICAgIC8qIFRyYW5zbGF0ZSBzZXBhcmF0b3IgaW4gbWFpbGJveG5hbWVzLgogICAgICAqCkBAIC0y
NTcsNjAgKzI3NSwxMyBAQAogCW1ib3huYW1lX2hpZXJzZXBfdG9pbnRlcm5hbCgmcXVvdGFfbmFt
ZXNwYWNlLCByb290c1tpXSwgMCk7CiAgICAgfQogCisgICAgYnVmWzBdID0gJ1wwJzsKICAgICBp
ZiAoZG9tYWluKSB7Ci0Jc25wcmludGYocXVvdGFfcGF0aCwgc2l6ZW9mKHF1b3RhX3BhdGgpLAot
CQkgIiVzJXMlYy8lcyVzIiwgY29uZmlnX2RpciwgRk5BTUVfRE9NQUlORElSLAotCQkgZGlyX2hh
c2hfYyhkb21haW4pLCBkb21haW4sIEZOQU1FX1FVT1RBRElSKTsKLSAgICB9IGVsc2UgewotCXNu
cHJpbnRmKHF1b3RhX3BhdGgsIHNpemVvZihxdW90YV9wYXRoKSwKLQkJICIlcyVzIiwgY29uZmln
X2RpciwgRk5BTUVfUVVPVEFESVIpOwotICAgIH0KLSAgICBpZiAoY2hkaXIocXVvdGFfcGF0aCkp
IHsKLQkvKiBObyBxdW90YSBkaXJlY3RvcnkgaW4gdGhpcyBkb21haW4gKi8KLSAJcmV0dXJuIDA7
Ci0gICAgfQotICAgIAotICAgIHRvcHAgPSBvcGVuZGlyKCIuIik7Ci0gICAgaWYgKCF0b3BwKSB7
Ci0JcmV0dXJuIElNQVBfSU9FUlJPUjsKLSAgICB9Ci0gICAgd2hpbGUgKChkaXJlbnQgPSByZWFk
ZGlyKHRvcHApKSE9TlVMTCkgewotCWlmIChkaXJlbnQtPmRfbmFtZVswXSA9PSAnLicpIGNvbnRp
bnVlOwotCi0JaWYgKGRvbWFpbiAmJiAhc3RyY21wKGRpcmVudC0+ZF9uYW1lLCAicm9vdCIpKSB7
Ci0JICAgIC8qIFF1b3RhIGZvciBlbnRpcmUgZG9tYWluICovCi0JICAgIGFkZHF1b3Rhcm9vdChk
b21haW4sICIiKTsKLQkgICAgY29udGludWU7Ci0JfQotCQotCWRpcnAgPSBvcGVuZGlyKGRpcmVu
dC0+ZF9uYW1lKTsKLQlpZiAoIWRpcnApIGNvbnRpbnVlOwotCi0Jd2hpbGUgKChkaXJlbnQgPSBy
ZWFkZGlyKGRpcnApKSE9TlVMTCkgewotCSAgICBpZiAoZGlyZW50LT5kX25hbWVbMF0gPT0gJy4n
KSBjb250aW51ZTsKLQotCSAgICAvKiBJZiByZXN0cmljdGluZyBvdXIgbGlzdCwgc2VlIGlmIHRo
aXMgcXVvdGEgZmlsZSBtYXRjaGVzICovCi0JICAgIGlmIChucm9vdHMpIHsKLQkJZm9yIChpID0g
MDsgaSA8IG5yb290czsgaSsrKSB7Ci0JCSAgICBpZiAoIXN0cmNtcChkaXJlbnQtPmRfbmFtZSwg
cm9vdHNbaV0pIHx8Ci0JCQkoIXN0cm5jbXAoZGlyZW50LT5kX25hbWUsIHJvb3RzW2ldLCBzdHJs
ZW4ocm9vdHNbaV0pKSAmJgotCQkJIGRpcmVudC0+ZF9uYW1lW3N0cmxlbihyb290c1tpXSldID09
ICcuJykpIGJyZWFrOworCXNucHJpbnRmKGJ1Ziwgc2l6ZW9mKGJ1ZiksICIlcyEiLCBkb21haW4p
OwogCQl9Ci0JCWlmIChpID09IG5yb290cykgY29udGludWU7Ci0JICAgIH0KIAkgICAgCi0JICAg
IC8qIElnbm9yZSAuTkVXIGZpbGVzICovCi0JICAgIGkgPSBzdHJsZW4oZGlyZW50LT5kX25hbWUp
OwotCSAgICBpZiAoaSA+IDQgJiYgIXN0cmNtcChkaXJlbnQtPmRfbmFtZStpLTQsICIuTkVXIikp
IGNvbnRpbnVlOwotCSAgICAKLQkgICAgYWRkcXVvdGFyb290KGRvbWFpbiwgZGlyZW50LT5kX25h
bWUpOwotCX0KLQkKLQkvKiBjbG9zZSB0aGlzIHN1YmRpcmVjdG9yeSAqLwotCWNsb3NlZGlyKGRp
cnApOwotICAgIH0KLSAgICBjbG9zZWRpcih0b3BwKTsKLSAgICBxc29ydCgoY2hhciAqKXF1b3Rh
LCBxdW90YV9udW0sIHNpemVvZigqcXVvdGEpLCBjb21wYXJlX3F1b3RhKTsKKyAgICBjb25maWdf
cXVvdGFfZGItPmZvcmVhY2gocWRiLCBidWYsIHN0cmxlbihidWYpLAorCQkJICAgICAmZmluZF9w
LCAmZmluZF9jYiwgJmZyb2NrLCBOVUxMKTsKIAogICAgIHJldHVybiAwOwogfQpAQCAtMzI2LDcg
KzI5Nyw5IEBACiAgICAgaW50IHI7CiAgICAgc3RydWN0IG1haWxib3ggbWFpbGJveDsKICAgICBp
bnQgaSwgbGVuLCB0aGlzcXVvdGEsIHRoaXNxdW90YWxlbjsKLSAgICBjaGFyICpwLCAqZG9tYWlu
ID0gKGNoYXIgKikgcm9jazsKKyAgICBzdHJ1Y3QgZml4X3JvY2sgKmZyb2NrID0gKHN0cnVjdCBm
aXhfcm9jayAqKSByb2NrOworICAgIGNoYXIgKnAsICpkb21haW4gPSBmcm9jay0+ZG9tYWluOwor
ICAgIHN0cnVjdCB0eG4gKip0aWQgPSBmcm9jay0+dGlkOwogCiAgICAgLyogbWFrZSBzdXJlIHRo
ZSBkb21haW5zIG1hdGNoICovCiAgICAgaWYgKChwID0gc3RyY2hyKG5hbWUsICchJykpICE9IE5V
TEwpIHsKQEAgLTM0MCw3ICszMTMsNyBAQAogICAgIHdoaWxlIChmaXJzdHF1b3RhIDwgcXVvdGFf
bnVtICYmCiAJICAgc3RybmNtcChuYW1lLCBxdW90YVtmaXJzdHF1b3RhXS5xdW90YS5yb290LAog
CQkgICAgICAgc3RybGVuKHF1b3RhW2ZpcnN0cXVvdGFdLnF1b3RhLnJvb3QpKSA+IDApIHsKLQly
ID0gZml4cXVvdGFfZmluaXNoKGZpcnN0cXVvdGErKyk7CisJciA9IGZpeHF1b3RhX2ZpbmlzaChm
aXJzdHF1b3RhKyssIHRpZCk7CiAJaWYgKHIpIHJldHVybiByOwogICAgIH0KIApAQCAtMzg2LDE0
ICszNTksNiBAQAogCX0KICAgICB9CiAgICAgCi0gICAgaWYgKHF1b3RhW3RoaXNxdW90YV0ucXVv
dGEuZmQgPT0gLTEpIHsKLQlyID0gbWFpbGJveF9sb2NrX3F1b3RhKCZxdW90YVt0aGlzcXVvdGFd
LnF1b3RhKTsKLQlpZiAocikgewotCSAgICBtYWlsYm94X2Nsb3NlKCZtYWlsYm94KTsKLQkgICAg
cmV0dXJuIHI7Ci0JfQotICAgIH0KLQogICAgIHIgPSBtYWlsYm94X29wZW5faW5kZXgoJm1haWxi
b3gpOwogICAgIGlmIChyKSB7CiAJbWFpbGJveF9jbG9zZSgmbWFpbGJveCk7CkBAIC00MTEsMjIg
KzM3Niw2IEBACiB7CiAgICAgaW50IGksIHI7CiAKLSAgICAvKgotICAgICAqIExvY2tpbmcgb3Jk
ZXIgaXMgdG8gbG9jayBoZWFkZXIgYmVmb3JlIHF1b3RhLiAgV2UgdGhlcmVmb3JlCi0gICAgICog
dW5sb2NrIGFsbCB0aGUgcXVvdGEgcm9vdHMgd2UgaGF2ZSBsb2NrZWQgaW4gb3JkZXIgdG8gYXZv
aWQgYQotICAgICAqIGRlYWRsb2NrLiAgQXMgcmVsZWFzaW5nIHRoZXNlIGxvY2tzIGNhbiBjYXVz
ZSB0aGUgcXVvdGEgdXNlCi0gICAgICogcmVjYWxjdWxhdGlvbiB0byBzY3JldyB1cCwgd2Ugc2V0
IHRoZSBnbG9iYWwgdmFyaWFibGUgJ3JlZG9maXgnCi0gICAgICogdG8gY2F1c2UgdGhlIHF1b3Rh
IHVzZSByZWNhbGN1bGF0aW9uIHRvIGJlIHJlZG9uZS4KLSAgICAgKgotICAgICAqIFdlIGNvdWxk
IG9wdGltaXplIHRoaXMgYnkgdHJ5aW5nIHRvIGdldCBhIG5vbmJsb2NraW5nIGxvY2sgb24KLSAg
ICAgKiB0aGUgaGVhZGVyIGFuZCB1bmxvY2tpbmcgYWxsIHRoZSBxdW90YSByb290cyBvbmx5IHdo
ZW4gdGhhdCBmYWlscy4KLSAgICAgKi8KLSAgICBmb3IgKGkgPSBmaXJzdHF1b3RhOyBpIDwgcXVv
dGFfbnVtOyBpKyspIHsKLQlpZiAocXVvdGFbaV0ucXVvdGEuZmQgIT0gLTEpIHsKLQkgICAgY2xv
c2UocXVvdGFbaV0ucXVvdGEuZmQpOwotCSAgICBxdW90YVtpXS5xdW90YS5mZCA9IC0xOwotCX0K
LSAgICB9CiAgICAgcmVkb2ZpeCA9IDE7CiAKICAgICByID0gbWFpbGJveF9sb2NrX2hlYWRlciht
YWlsYm94KTsKQEAgLTQ1Miw0MyArNDAxLDI5IEBACiAvKgogICogRmluaXNoIGZpeGluZyB1cCBh
IHF1b3RhIHJvb3QKICAqLwotaW50IGZpeHF1b3RhX2ZpbmlzaChpbnQgdGhpc3F1b3RhKQoraW50
IGZpeHF1b3RhX2ZpbmlzaChpbnQgdGhpc3F1b3RhLCBzdHJ1Y3QgdHhuICoqdGlkKQogewogICAg
IGludCByOwogCiAgICAgaWYgKCFxdW90YVt0aGlzcXVvdGFdLnJlZmNvdW50KSB7CiAJaWYgKCFx
dW90YVt0aGlzcXVvdGFdLmRlbGV0ZWQrKykgewotCSAgICBjaGFyIGJ1ZltNQVhfTUFJTEJPWF9Q
QVRIKzFdOwotCSAgICAKIAkgICAgcHJpbnRmKCIlczogcmVtb3ZlZFxuIiwgcXVvdGFbdGhpc3F1
b3RhXS5xdW90YS5yb290KTsKLQkgICAgbWFpbGJveF9oYXNoX3F1b3RhKGJ1Ziwgc2l6ZW9mKGJ1
ZiksIHF1b3RhW3RoaXNxdW90YV0ucXVvdGEucm9vdCk7Ci0KLQkgICAgdW5saW5rKGJ1Zik7CisJ
ICAgIHIgPSBxdW90YV9kZWxldGUoJnF1b3RhW3RoaXNxdW90YV0ucXVvdGEsIHRpZCk7CisJICAg
IGlmIChyKSByZXR1cm4gcjsKKwkgICAgZnJlZShxdW90YVt0aGlzcXVvdGFdLnF1b3RhLnJvb3Qp
OworCSAgICBxdW90YVt0aGlzcXVvdGFdLnF1b3RhLnJvb3QgPSBOVUxMOwogCX0KIAlyZXR1cm4g
MDsKICAgICB9CiAKLSAgICBpZiAocXVvdGFbdGhpc3F1b3RhXS5xdW90YS5mZCA9PSAtMSkgewot
CXIgPSBtYWlsYm94X2xvY2tfcXVvdGEoJnF1b3RhW3RoaXNxdW90YV0ucXVvdGEpOwotCWlmIChy
KSB7Ci0JICAgIGlmIChxdW90YVt0aGlzcXVvdGFdLnF1b3RhLmZkICE9IC0xKSB7Ci0JCWNsb3Nl
KHF1b3RhW3RoaXNxdW90YV0ucXVvdGEuZmQpOwotCQlxdW90YVt0aGlzcXVvdGFdLnF1b3RhLmZk
ID0gLTE7Ci0JICAgIH0KLQkgICAgcmV0dXJuIHI7Ci0JfQotICAgIH0KLSAgICAKICAgICBpZiAo
cXVvdGFbdGhpc3F1b3RhXS5xdW90YS51c2VkICE9IHF1b3RhW3RoaXNxdW90YV0ubmV3dXNlZCkg
ewogCXByaW50ZigiJXM6IHVzYWdlIHdhcyAlbHUsIG5vdyAlbHVcbiIsIHF1b3RhW3RoaXNxdW90
YV0ucXVvdGEucm9vdCwKIAkgICAgICAgcXVvdGFbdGhpc3F1b3RhXS5xdW90YS51c2VkLCBxdW90
YVt0aGlzcXVvdGFdLm5ld3VzZWQpOwogCXF1b3RhW3RoaXNxdW90YV0ucXVvdGEudXNlZCA9IHF1
b3RhW3RoaXNxdW90YV0ubmV3dXNlZDsKLQlyID0gbWFpbGJveF93cml0ZV9xdW90YSgmcXVvdGFb
dGhpc3F1b3RhXS5xdW90YSk7CisJciA9IHF1b3RhX3dyaXRlKCZxdW90YVt0aGlzcXVvdGFdLnF1
b3RhLCB0aWQpOwogCWlmIChyKSByZXR1cm4gcjsKICAgICB9CiAKLSAgICBjbG9zZShxdW90YVt0
aGlzcXVvdGFdLnF1b3RhLmZkKTsKLSAgICBxdW90YVt0aGlzcXVvdGFdLnF1b3RhLmZkID0gLTE7
CiAgICAgcmV0dXJuIDA7CiB9CiAKQEAgLTUwMCw2ICs0MzUsOCBAQAogewogICAgIGludCByID0g
MDsKICAgICBzdGF0aWMgY2hhciBwYXR0ZXJuWzJdID0gIioiOworICAgIHN0cnVjdCBmaXhfcm9j
ayBmcm9jazsKKyAgICBzdHJ1Y3QgdHhuICp0aWQgPSBOVUxMOwogCiAgICAgLyoKICAgICAgKiBM
b2NrIG1haWxib3ggbGlzdCB0byBwcmV2ZW50IG1haWxib3ggY3JlYXRpb24vZGVsZXRpb24KQEAg
LTUwNyw2ICs0NDQsOSBAQAogICAgICAqLwogICAgIG1ib3hsaXN0X29wZW4oTlVMTCk7CiAKKyAg
ICBmcm9jay5kb21haW4gPSBkb21haW47CisgICAgZnJvY2sudGlkID0gJnRpZDsKKwogICAgIHJl
ZG9maXggPSAxOwogICAgIHdoaWxlIChyZWRvZml4KSB7CiAJcmVkb2ZpeCA9IDA7CkBAIC01MTQs
MjAgKzQ1NCwyMiBAQAogCXBhcnRpYWwgPSBpc3BhcnRpYWw7CiAKIAlyID0gKCpxdW90YV9uYW1l
c3BhY2UubWJveGxpc3RfZmluZGFsbCkoJnF1b3RhX25hbWVzcGFjZSwgcGF0dGVybiwgMSwKLQkJ
CQkJCTAsIDAsIGZpeHF1b3RhX21haWxib3gsIGRvbWFpbik7CisJCQkJCQkwLCAwLCBmaXhxdW90
YV9tYWlsYm94LCAmZnJvY2spOwogCWlmIChyKSB7CiAJICAgIG1ib3hsaXN0X2Nsb3NlKCk7CiAJ
ICAgIHJldHVybiByOwogCX0KIAogCXdoaWxlIChmaXJzdHF1b3RhIDwgcXVvdGFfbnVtKSB7Ci0J
ICAgIHIgPSBmaXhxdW90YV9maW5pc2goZmlyc3RxdW90YSsrKTsKKwkgICAgciA9IGZpeHF1b3Rh
X2ZpbmlzaChmaXJzdHF1b3RhKyssICZ0aWQpOwogCSAgICBpZiAocikgewogCQltYm94bGlzdF9j
bG9zZSgpOwogCQlyZXR1cm4gcjsKIAkgICAgfQogCX0KICAgICB9CisKKyAgICBpZiAoIXIpIHF1
b3RhX2NvbW1pdCgmdGlkKTsKICAgICAKICAgICBtYm94bGlzdF9jbG9zZSgpOwogICAgIHJldHVy
biAwOwpJbmRleDogaW1hcC9xdW90YS5oCj09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KUkNTIGZpbGU6IGltYXAvcXVvdGEu
aApkaWZmIC1OIGltYXAvcXVvdGEuaAotLS0gL2Rldi9udWxsCTEgSmFuIDE5NzAgMDA6MDA6MDAg
LTAwMDAKKysrIGltYXAvcXVvdGEuaAk2IEphbiAyMDA0IDIxOjUyOjM0IC0wMDAwCkBAIC0wLDAg
KzEsODYgQEAKKy8qIHF1b3RhLmggLS0gUXVvdGEgZm9ybWF0IGRlZmluaXRpb25zCisgKgorICog
Q29weXJpZ2h0IChjKSAxOTk4LTIwMDMgQ2FybmVnaWUgTWVsbG9uIFVuaXZlcnNpdHkuICBBbGwg
cmlnaHRzIHJlc2VydmVkLgorICoKKyAqIFJlZGlzdHJpYnV0aW9uIGFuZCB1c2UgaW4gc291cmNl
IGFuZCBiaW5hcnkgZm9ybXMsIHdpdGggb3Igd2l0aG91dAorICogbW9kaWZpY2F0aW9uLCBhcmUg
cGVybWl0dGVkIHByb3ZpZGVkIHRoYXQgdGhlIGZvbGxvd2luZyBjb25kaXRpb25zCisgKiBhcmUg
bWV0OgorICoKKyAqIDEuIFJlZGlzdHJpYnV0aW9ucyBvZiBzb3VyY2UgY29kZSBtdXN0IHJldGFp
biB0aGUgYWJvdmUgY29weXJpZ2h0CisgKiAgICBub3RpY2UsIHRoaXMgbGlzdCBvZiBjb25kaXRp
b25zIGFuZCB0aGUgZm9sbG93aW5nIGRpc2NsYWltZXIuIAorICoKKyAqIDIuIFJlZGlzdHJpYnV0
aW9ucyBpbiBiaW5hcnkgZm9ybSBtdXN0IHJlcHJvZHVjZSB0aGUgYWJvdmUgY29weXJpZ2h0Cisg
KiAgICBub3RpY2UsIHRoaXMgbGlzdCBvZiBjb25kaXRpb25zIGFuZCB0aGUgZm9sbG93aW5nIGRp
c2NsYWltZXIgaW4KKyAqICAgIHRoZSBkb2N1bWVudGF0aW9uIGFuZC9vciBvdGhlciBtYXRlcmlh
bHMgcHJvdmlkZWQgd2l0aCB0aGUKKyAqICAgIGRpc3RyaWJ1dGlvbi4KKyAqCisgKiAzLiBUaGUg
bmFtZSAiQ2FybmVnaWUgTWVsbG9uIFVuaXZlcnNpdHkiIG11c3Qgbm90IGJlIHVzZWQgdG8KKyAq
ICAgIGVuZG9yc2Ugb3IgcHJvbW90ZSBwcm9kdWN0cyBkZXJpdmVkIGZyb20gdGhpcyBzb2Z0d2Fy
ZSB3aXRob3V0CisgKiAgICBwcmlvciB3cml0dGVuIHBlcm1pc3Npb24uIEZvciBwZXJtaXNzaW9u
IG9yIGFueSBvdGhlciBsZWdhbAorICogICAgZGV0YWlscywgcGxlYXNlIGNvbnRhY3QgIAorICog
ICAgICBPZmZpY2Ugb2YgVGVjaG5vbG9neSBUcmFuc2ZlcgorICogICAgICBDYXJuZWdpZSBNZWxs
b24gVW5pdmVyc2l0eQorICogICAgICA1MDAwIEZvcmJlcyBBdmVudWUKKyAqICAgICAgUGl0dHNi
dXJnaCwgUEEgIDE1MjEzLTM4OTAKKyAqICAgICAgKDQxMikgMjY4LTQzODcsIGZheDogKDQxMikg
MjY4LTczOTUKKyAqICAgICAgdGVjaC10cmFuc2ZlckBhbmRyZXcuY211LmVkdQorICoKKyAqIDQu
IFJlZGlzdHJpYnV0aW9ucyBvZiBhbnkgZm9ybSB3aGF0c29ldmVyIG11c3QgcmV0YWluIHRoZSBm
b2xsb3dpbmcKKyAqICAgIGFja25vd2xlZGdtZW50OgorICogICAgIlRoaXMgcHJvZHVjdCBpbmNs
dWRlcyBzb2Z0d2FyZSBkZXZlbG9wZWQgYnkgQ29tcHV0aW5nIFNlcnZpY2VzCisgKiAgICAgYXQg
Q2FybmVnaWUgTWVsbG9uIFVuaXZlcnNpdHkgKGh0dHA6Ly93d3cuY211LmVkdS9jb21wdXRpbmcv
KS4iCisgKgorICogQ0FSTkVHSUUgTUVMTE9OIFVOSVZFUlNJVFkgRElTQ0xBSU1TIEFMTCBXQVJS
QU5USUVTIFdJVEggUkVHQVJEIFRPCisgKiBUSElTIFNPRlRXQVJFLCBJTkNMVURJTkcgQUxMIElN
UExJRUQgV0FSUkFOVElFUyBPRiBNRVJDSEFOVEFCSUxJVFkKKyAqIEFORCBGSVRORVNTLCBJTiBO
TyBFVkVOVCBTSEFMTCBDQVJORUdJRSBNRUxMT04gVU5JVkVSU0lUWSBCRSBMSUFCTEUKKyAqIEZP
UiBBTlkgU1BFQ0lBTCwgSU5ESVJFQ1QgT1IgQ09OU0VRVUVOVElBTCBEQU1BR0VTIE9SIEFOWSBE
QU1BR0VTCisgKiBXSEFUU09FVkVSIFJFU1VMVElORyBGUk9NIExPU1MgT0YgVVNFLCBEQVRBIE9S
IFBST0ZJVFMsIFdIRVRIRVIgSU4KKyAqIEFOIEFDVElPTiBPRiBDT05UUkFDVCwgTkVHTElHRU5D
RSBPUiBPVEhFUiBUT1JUSU9VUyBBQ1RJT04sIEFSSVNJTkcKKyAqIE9VVCBPRiBPUiBJTiBDT05O
RUNUSU9OIFdJVEggVEhFIFVTRSBPUiBQRVJGT1JNQU5DRSBPRiBUSElTIFNPRlRXQVJFLgorICoK
KyAqICRJZCQKKyAqLworCisjaWZuZGVmIElOQ0xVREVEX1FVT1RBX0gKKyNkZWZpbmUgSU5DTFVE
RURfUVVPVEFfSAorCisjaW5jbHVkZSAiY3lydXNkYi5oIgorCisjZGVmaW5lIEZOQU1FX1FVT1RB
REIgIi9xdW90YXMuZGIiCisKKyNkZWZpbmUgUVVPVEFfVU5JVFMgKDEwMjQpCisKK2V4dGVybiBz
dHJ1Y3QgZGIgKnFkYjsKKworc3RydWN0IHF1b3RhIHsKKyAgICBjaGFyICpyb290OworCisgICAg
LyogSW5mb3JtYXRpb24gaW4gcXVvdGEgZW50cnkgKi8KKyAgICB1bnNpZ25lZCBsb25nIHVzZWQ7
CisgICAgaW50IGxpbWl0OwkJCS8qIGluIFFVT1RBX1VOSVRTICovCit9OworCitleHRlcm4gaW50
IHF1b3RhX3JlYWQoc3RydWN0IHF1b3RhICpxdW90YSwgc3RydWN0IHR4biAqKnRpZCwgaW50IHdy
bG9jayk7CisKK2V4dGVybiB2b2lkIHF1b3RhX2NvbW1pdChzdHJ1Y3QgdHhuICoqdGlkKTsKKwor
ZXh0ZXJuIGludCBxdW90YV93cml0ZShzdHJ1Y3QgcXVvdGEgKnF1b3RhLCBzdHJ1Y3QgdHhuICoq
dGlkKTsKKworZXh0ZXJuIGludCBxdW90YV9kZWxldGUoc3RydWN0IHF1b3RhICpxdW90YSwgc3Ry
dWN0IHR4biAqKnRpZCk7CisKK2V4dGVybiBpbnQgcXVvdGFfZmluZHJvb3QoY2hhciAqcmV0LCBz
aXplX3QgcmV0bGVuLCBjb25zdCBjaGFyICpuYW1lKTsKKworLyogb3BlbiB0aGUgcXVvdGFzIGRi
ICovCit2b2lkIHF1b3RhZGJfb3BlbihjaGFyICpuYW1lKTsKKworLyogY2xvc2UgdGhlIGRhdGFi
YXNlICovCit2b2lkIHF1b3RhZGJfY2xvc2Uodm9pZCk7CisKKy8qIGluaXRpYWxpemUgZGF0YWJh
c2Ugc3RydWN0dXJlcyAqLworI2RlZmluZSBRVU9UQURCX1NZTkMgMHgwMgordm9pZCBxdW90YWRi
X2luaXQoaW50IGZsYWdzKTsKKworLyogZG9uZSB3aXRoIGRhdGFiYXNlIHN0dWZmICovCit2b2lk
IHF1b3RhZGJfZG9uZSh2b2lkKTsKKworI2VuZGlmIC8qIElOQ0xVREVEX1FVT1RBX0ggKi8KSW5k
ZXg6IGltYXAvcXVvdGFfZGIuYwo9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09ClJDUyBmaWxlOiBpbWFwL3F1b3RhX2RiLmMK
ZGlmZiAtTiBpbWFwL3F1b3RhX2RiLmMKLS0tIC9kZXYvbnVsbAkxIEphbiAxOTcwIDAwOjAwOjAw
IC0wMDAwCisrKyBpbWFwL3F1b3RhX2RiLmMJNiBKYW4gMjAwNCAyMTo1MjozNCAtMDAwMApAQCAt
MCwwICsxLDI4MCBAQAorLyogcXVvdGFfZGIuYyAtLSBxdW90YSBtYW5pcHVsYXRpb24gcm91dGlu
ZXMKKyAqIAorICogQ29weXJpZ2h0IChjKSAxOTk4LTIwMDMgQ2FybmVnaWUgTWVsbG9uIFVuaXZl
cnNpdHkuICBBbGwgcmlnaHRzIHJlc2VydmVkLgorICoKKyAqIFJlZGlzdHJpYnV0aW9uIGFuZCB1
c2UgaW4gc291cmNlIGFuZCBiaW5hcnkgZm9ybXMsIHdpdGggb3Igd2l0aG91dAorICogbW9kaWZp
Y2F0aW9uLCBhcmUgcGVybWl0dGVkIHByb3ZpZGVkIHRoYXQgdGhlIGZvbGxvd2luZyBjb25kaXRp
b25zCisgKiBhcmUgbWV0OgorICoKKyAqIDEuIFJlZGlzdHJpYnV0aW9ucyBvZiBzb3VyY2UgY29k
ZSBtdXN0IHJldGFpbiB0aGUgYWJvdmUgY29weXJpZ2h0CisgKiAgICBub3RpY2UsIHRoaXMgbGlz
dCBvZiBjb25kaXRpb25zIGFuZCB0aGUgZm9sbG93aW5nIGRpc2NsYWltZXIuIAorICoKKyAqIDIu
IFJlZGlzdHJpYnV0aW9ucyBpbiBiaW5hcnkgZm9ybSBtdXN0IHJlcHJvZHVjZSB0aGUgYWJvdmUg
Y29weXJpZ2h0CisgKiAgICBub3RpY2UsIHRoaXMgbGlzdCBvZiBjb25kaXRpb25zIGFuZCB0aGUg
Zm9sbG93aW5nIGRpc2NsYWltZXIgaW4KKyAqICAgIHRoZSBkb2N1bWVudGF0aW9uIGFuZC9vciBv
dGhlciBtYXRlcmlhbHMgcHJvdmlkZWQgd2l0aCB0aGUKKyAqICAgIGRpc3RyaWJ1dGlvbi4KKyAq
CisgKiAzLiBUaGUgbmFtZSAiQ2FybmVnaWUgTWVsbG9uIFVuaXZlcnNpdHkiIG11c3Qgbm90IGJl
IHVzZWQgdG8KKyAqICAgIGVuZG9yc2Ugb3IgcHJvbW90ZSBwcm9kdWN0cyBkZXJpdmVkIGZyb20g
dGhpcyBzb2Z0d2FyZSB3aXRob3V0CisgKiAgICBwcmlvciB3cml0dGVuIHBlcm1pc3Npb24uIEZv
ciBwZXJtaXNzaW9uIG9yIGFueSBvdGhlciBsZWdhbAorICogICAgZGV0YWlscywgcGxlYXNlIGNv
bnRhY3QgIAorICogICAgICBPZmZpY2Ugb2YgVGVjaG5vbG9neSBUcmFuc2ZlcgorICogICAgICBD
YXJuZWdpZSBNZWxsb24gVW5pdmVyc2l0eQorICogICAgICA1MDAwIEZvcmJlcyBBdmVudWUKKyAq
ICAgICAgUGl0dHNidXJnaCwgUEEgIDE1MjEzLTM4OTAKKyAqICAgICAgKDQxMikgMjY4LTQzODcs
IGZheDogKDQxMikgMjY4LTczOTUKKyAqICAgICAgdGVjaC10cmFuc2ZlckBhbmRyZXcuY211LmVk
dQorICoKKyAqIDQuIFJlZGlzdHJpYnV0aW9ucyBvZiBhbnkgZm9ybSB3aGF0c29ldmVyIG11c3Qg
cmV0YWluIHRoZSBmb2xsb3dpbmcKKyAqICAgIGFja25vd2xlZGdtZW50OgorICogICAgIlRoaXMg
cHJvZHVjdCBpbmNsdWRlcyBzb2Z0d2FyZSBkZXZlbG9wZWQgYnkgQ29tcHV0aW5nIFNlcnZpY2Vz
CisgKiAgICAgYXQgQ2FybmVnaWUgTWVsbG9uIFVuaXZlcnNpdHkgKGh0dHA6Ly93d3cuY211LmVk
dS9jb21wdXRpbmcvKS4iCisgKgorICogQ0FSTkVHSUUgTUVMTE9OIFVOSVZFUlNJVFkgRElTQ0xB
SU1TIEFMTCBXQVJSQU5USUVTIFdJVEggUkVHQVJEIFRPCisgKiBUSElTIFNPRlRXQVJFLCBJTkNM
VURJTkcgQUxMIElNUExJRUQgV0FSUkFOVElFUyBPRiBNRVJDSEFOVEFCSUxJVFkKKyAqIEFORCBG
SVRORVNTLCBJTiBOTyBFVkVOVCBTSEFMTCBDQVJORUdJRSBNRUxMT04gVU5JVkVSU0lUWSBCRSBM
SUFCTEUKKyAqIEZPUiBBTlkgU1BFQ0lBTCwgSU5ESVJFQ1QgT1IgQ09OU0VRVUVOVElBTCBEQU1B
R0VTIE9SIEFOWSBEQU1BR0VTCisgKiBXSEFUU09FVkVSIFJFU1VMVElORyBGUk9NIExPU1MgT0Yg
VVNFLCBEQVRBIE9SIFBST0ZJVFMsIFdIRVRIRVIgSU4KKyAqIEFOIEFDVElPTiBPRiBDT05UUkFD
VCwgTkVHTElHRU5DRSBPUiBPVEhFUiBUT1JUSU9VUyBBQ1RJT04sIEFSSVNJTkcKKyAqIE9VVCBP
RiBPUiBJTiBDT05ORUNUSU9OIFdJVEggVEhFIFVTRSBPUiBQRVJGT1JNQU5DRSBPRiBUSElTIFNP
RlRXQVJFLgorICoKKyAqICRJZCQKKyAqCisgKi8KKworI2luY2x1ZGUgPGNvbmZpZy5oPgorCisj
aWZkZWYgSEFWRV9VTklTVERfSAorI2luY2x1ZGUgPHVuaXN0ZC5oPgorI2VuZGlmCisjaW5jbHVk
ZSA8c3RkaW8uaD4KKyNpbmNsdWRlIDxzdGRsaWIuaD4KKyNpbmNsdWRlIDxzdHJpbmcuaD4KKyNp
bmNsdWRlIDxlcnJuby5oPgorI2luY2x1ZGUgPHN5c2xvZy5oPgorI2luY2x1ZGUgPGNvbV9lcnIu
aD4KKworI2luY2x1ZGUgImFzc2VydC5oIgorI2luY2x1ZGUgImN5cnVzZGIuaCIKKyNpbmNsdWRl
ICJleGl0Y29kZXMuaCIKKyNpbmNsdWRlICJnbG9iYWwuaCIKKyNpbmNsdWRlICJpbWFwX2Vyci5o
IgorI2luY2x1ZGUgIm1haWxib3guaCIKKyNpbmNsdWRlICJxdW90YS5oIgorI2luY2x1ZGUgInV0
aWwuaCIKKyNpbmNsdWRlICJ4bWFsbG9jLmgiCisKKyNkZWZpbmUgUURCIGNvbmZpZ19xdW90YV9k
YgorCitzdHJ1Y3QgZGIgKnFkYjsKKworc3RhdGljIGludCBxdW90YV9kYm9wZW4gPSAwOworCisv
KgorICogUmVhZCB0aGUgcXVvdGEgZW50cnkgJ3F1b3RhJworICovCitpbnQgcXVvdGFfcmVhZChz
dHJ1Y3QgcXVvdGEgKnF1b3RhLCBzdHJ1Y3QgdHhuICoqdGlkLCBpbnQgd3Jsb2NrKQoreworICAg
IGludCByOworICAgIGludCBxcmxlbjsKKyAgICBjb25zdCBjaGFyICpkYXRhOworICAgIGludCBk
YXRhbGVuOworCisgICAgaWYgKCFxdW90YS0+cm9vdCB8fCAhKHFybGVuID0gc3RybGVuKHF1b3Rh
LT5yb290KSkpCisJcmV0dXJuIElNQVBfUVVPVEFST09UX05PTkVYSVNURU5UOworCisgICAgaWYg
KHdybG9jaykKKwlyID0gUURCLT5mZXRjaGxvY2socWRiLCBxdW90YS0+cm9vdCwgcXJsZW4sICZk
YXRhLCAmZGF0YWxlbiwgdGlkKTsKKyAgICBlbHNlCisJciA9IFFEQi0+ZmV0Y2gocWRiLCBxdW90
YS0+cm9vdCwgcXJsZW4sICZkYXRhLCAmZGF0YWxlbiwgdGlkKTsKKworICAgIHN3aXRjaCAocikg
eworICAgIGNhc2UgQ1lSVVNEQl9PSzoKKwlzc2NhbmYoZGF0YSwgIiVsdSAlZCIsICZxdW90YS0+
dXNlZCwgJnF1b3RhLT5saW1pdCk7CisJYnJlYWs7CisKKyAgICBjYXNlIENZUlVTREJfQUdBSU46
CisJcmV0dXJuIElNQVBfQUdBSU47CisJYnJlYWs7CisKKyAgICBjYXNlIENZUlVTREJfTk9URk9V
TkQ6CisJcmV0dXJuIElNQVBfUVVPVEFST09UX05PTkVYSVNURU5UOworCWJyZWFrOworCisgICAg
ZGVmYXVsdDoKKwlzeXNsb2coTE9HX0VSUiwgIkRCRVJST1I6IGVycm9yIGZldGNoaW5nICVzOiAl
cyIsCisJICAgICAgIHF1b3RhLT5yb290LCBjeXJ1c2RiX3N0cmVycm9yKHIpKTsKKwlyZXR1cm4g
SU1BUF9JT0VSUk9SOworCWJyZWFrOworICAgIH0KKworICAgIHJldHVybiAwOworfQorCisvKgor
ICogQ29tbWl0IHRoZSBvdXRzdGFuZGluZyBxdW90YSB0cmFuc2FjdGlvbgorICovCit2b2lkIHF1
b3RhX2NvbW1pdChzdHJ1Y3QgdHhuICoqdGlkKQoreworICAgIGlmICh0aWQgJiYgKnRpZCkgewor
CWlmIChRREItPmNvbW1pdChxZGIsICp0aWQpKSB7CisJICAgIHN5c2xvZyhMT0dfRVJSLCAiSU9F
UlJPUjogY29tbWl0dGluZyBxdW90YTogJW0iKTsKKwl9CisJKnRpZCA9IE5VTEw7CisgICAgfQor
fQorCisvKgorICogQWJvcnQgdGhlIG91dHN0YW5kaW5nIHF1b3RhIHRyYW5zYWN0aW9uCisgKi8K
K3ZvaWQgcXVvdGFfYWJvcnQoc3RydWN0IHR4biAqKnRpZCkKK3sKKyAgICBpZiAodGlkICYmICp0
aWQpIHsKKwlpZiAoUURCLT5hYm9ydChxZGIsICp0aWQpKSB7CisJICAgIHN5c2xvZyhMT0dfRVJS
LCAiSU9FUlJPUjogYWJvcnRpbmcgcXVvdGE6ICVtIik7CisJfQorCSp0aWQgPSBOVUxMOworICAg
IH0KK30KKworLyoKKyAqIFdyaXRlIG91dCB0aGUgcXVvdGEgZW50cnkgJ3F1b3RhJworICovCitp
bnQgcXVvdGFfd3JpdGUoc3RydWN0IHF1b3RhICpxdW90YSwgc3RydWN0IHR4biAqKnRpZCkKK3sK
KyAgICBpbnQgcjsKKyAgICBpbnQgcXJsZW4sIGxlbjsKKyAgICBjaGFyIGJ1ZlsxMDI0XTsKKwor
ICAgIGlmICghcXVvdGEtPnJvb3QpIHJldHVybiAwOworCisgICAgcXJsZW4gPSBzdHJsZW4ocXVv
dGEtPnJvb3QpOworICAgIGlmICghcXJsZW4pIHJldHVybiBJTUFQX1FVT1RBUk9PVF9OT05FWElT
VEVOVDsKKworICAgIGxlbiA9IHNucHJpbnRmKGJ1Ziwgc2l6ZW9mKGJ1ZikgLSAxLAorCQkgICAi
JWx1ICVkIiwgcXVvdGEtPnVzZWQsIHF1b3RhLT5saW1pdCk7CisgICAgciA9IFFEQi0+c3RvcmUo
cWRiLCBxdW90YS0+cm9vdCwgcXJsZW4sIGJ1ZiwgbGVuLCB0aWQpOworICAgIAorICAgIHN3aXRj
aCAocikgeworICAgIGNhc2UgQ1lSVVNEQl9PSzoKKwlicmVhazsKKworICAgIGNhc2UgQ1lSVVNE
Ql9BR0FJTjoKKwlyZXR1cm4gSU1BUF9BR0FJTjsKKwlicmVhazsKKworICAgIGRlZmF1bHQ6CisJ
c3lzbG9nKExPR19FUlIsICJEQkVSUk9SOiBlcnJvciBzdG9yaW5nICVzOiAlcyIsCisJICAgICAg
IHF1b3RhLT5yb290LCBjeXJ1c2RiX3N0cmVycm9yKHIpKTsKKwlyZXR1cm4gSU1BUF9JT0VSUk9S
OworCWJyZWFrOworICAgIH0KKworICAgIHJldHVybiAwOworfQorCisvKgorICogUmVtb3ZlIHRo
ZSBxdW90YSByb290ICdxdW90YScKKyAqLworaW50IHF1b3RhX2RlbGV0ZShzdHJ1Y3QgcXVvdGEg
KnF1b3RhLCBzdHJ1Y3QgdHhuICoqdGlkKQoreworICAgIGludCBxcmxlbiwgcjsKKworICAgIGlm
ICghcXVvdGEtPnJvb3QpIHJldHVybiAwOworCisgICAgcXJsZW4gPSBzdHJsZW4ocXVvdGEtPnJv
b3QpOworICAgIGlmICghcXJsZW4pIHJldHVybiBJTUFQX1FVT1RBUk9PVF9OT05FWElTVEVOVDsK
KworICAgIHIgPSBRREItPmRlbGV0ZShxZGIsIHF1b3RhLT5yb290LCBxcmxlbiwgdGlkLCAwKTsK
KworICAgIHJldHVybiByOworfQorCisvKgorICogRmluZCB0aGUgbWFpbGJveCAnbmFtZScgJ3Mg
cXVvdGFyb290LCBhbmQgcmV0dXJuIGl0IGluICdyZXQnLgorICogJ3JldCcgbXVzdCBiZSBhdCBs
ZWFzdCBNQVhfTUFJTEJPWF9QQVRILiAKKyAqCisgKiByZXR1cm5zIHRydWUgaWYgYSBxdW90YXJv
b3QgaXMgZm91bmQsIDAgb3RoZXJ3aXNlLiAKKyovCitpbnQgcXVvdGFfZmluZHJvb3QoY2hhciAq
cmV0LCBzaXplX3QgcmV0bGVuLCBjb25zdCBjaGFyICpuYW1lKQoreworICAgIGNoYXIgKnRhaWws
ICpwLCAqbWJveDsKKworICAgIHN0cmxjcHkocmV0LCBuYW1lLCByZXRsZW4pOworCisgICAgLyog
ZmluZCB0aGUgc3RhcnQgb2YgdGhlIHVucXVhbGlmaWVkIG1haWxib3ggbmFtZSAqLworICAgIG1i
b3ggPSAoY29uZmlnX3ZpcnRkb21haW5zICYmIChwID0gc3RyY2hyKHJldCwgJyEnKSkpID8gcCsx
IDogcmV0OworICAgIHRhaWwgPSBtYm94ICsgc3RybGVuKG1ib3gpOworCisgICAgd2hpbGUgKFFE
Qi0+ZmV0Y2gocWRiLCByZXQsIHN0cmxlbihyZXQpLCBOVUxMLCBOVUxMLCBOVUxMKSkgeworCXRh
aWwgPSBzdHJyY2hyKG1ib3gsICcuJyk7CisJaWYgKCF0YWlsKSBicmVhazsKKwkqdGFpbCA9ICdc
MCc7CisgICAgfQorICAgIGlmICh0YWlsKSByZXR1cm4gMTsKKyAgICBpZiAobWJveCA9PSByZXQp
IHJldHVybiAwOworCisgICAgLyogY2hlY2sgZm9yIGEgZG9tYWluIHF1b3RhICovCisgICAgKm1i
b3ggPSAnXDAnOworICAgIHJldHVybiAoUURCLT5mZXRjaChxZGIsIHJldCwgc3RybGVuKHJldCks
IE5VTEwsIE5VTEwsIE5VTEwpID09IDApOworfQorCisKKy8qIG11c3QgYmUgY2FsbGVkIGFmdGVy
IGN5cnVzX2luaXQgKi8KK3ZvaWQgcXVvdGFkYl9pbml0KGludCBteWZsYWdzKQoreworICAgIGlu
dCByOworCisgICAgaWYgKG15ZmxhZ3MgJiBRVU9UQURCX1NZTkMpIHsKKwlyID0gUURCLT5zeW5j
KCk7CisgICAgfQorfQorCit2b2lkIHF1b3RhZGJfb3BlbihjaGFyICpmbmFtZSkKK3sKKyAgICBp
bnQgcmV0OworICAgIGNoYXIgKnRvZnJlZSA9IE5VTEw7CisKKyAgICAvKiBjcmVhdGUgZGIgZmls
ZSBuYW1lICovCisgICAgaWYgKCFmbmFtZSkgeworCXNpemVfdCBmbmFtZV9sZW4gPSBzdHJsZW4o
Y29uZmlnX2Rpcikrc3RybGVuKEZOQU1FX1FVT1RBREIpKzE7CisJCisJZm5hbWUgPSB4bWFsbG9j
KGZuYW1lX2xlbik7CisJdG9mcmVlID0gZm5hbWU7CisKKwlzdHJsY3B5KGZuYW1lLCBjb25maWdf
ZGlyLCBmbmFtZV9sZW4pOworCXN0cmxjYXQoZm5hbWUsIEZOQU1FX1FVT1RBREIsIGZuYW1lX2xl
bik7CisgICAgfQorCisgICAgcmV0ID0gUURCLT5vcGVuKGZuYW1lLCBDWVJVU0RCX0NSRUFURSwg
JnFkYik7CisgICAgaWYgKHJldCAhPSAwKSB7CisJc3lzbG9nKExPR19FUlIsICJEQkVSUk9SOiBv
cGVuaW5nICVzOiAlcyIsIGZuYW1lLAorCSAgICAgICBjeXJ1c2RiX3N0cmVycm9yKHJldCkpOwor
CSAgICAvKiBFeGl0aW5nIFRFTVBGQUlMIGJlY2F1c2UgU2VuZG1haWwgdGhpbmtzIHRoaXMKKwkg
ICAgICAgRUNfT1NGSUxFID09IHBlcm1hbmVudCBmYWlsdXJlLiAqLworCWZhdGFsKCJjYW4ndCBy
ZWFkIHF1b3RhcyBmaWxlIiwgRUNfVEVNUEZBSUwpOworICAgIH0KKworICAgIGlmICh0b2ZyZWUp
IGZyZWUodG9mcmVlKTsKKworICAgIHF1b3RhX2Rib3BlbiA9IDE7Cit9CisKK3ZvaWQgcXVvdGFk
Yl9jbG9zZSh2b2lkKQoreworICAgIGludCByOworCisgICAgaWYgKHF1b3RhX2Rib3Blbikgewor
CXIgPSBRREItPmNsb3NlKHFkYik7CisJaWYgKHIpIHsKKwkgICAgc3lzbG9nKExPR19FUlIsICJE
QkVSUk9SOiBlcnJvciBjbG9zaW5nIHF1b3RhczogJXMiLAorCQkgICBjeXJ1c2RiX3N0cmVycm9y
KHIpKTsKKwl9CisJcXVvdGFfZGJvcGVuID0gMDsKKyAgICB9Cit9CisKK3ZvaWQgcXVvdGFkYl9k
b25lKHZvaWQpCit7CisgICAgLyogREItPmRvbmUoKSBoYW5kbGVkIGJ5IGN5cnVzX2RvbmUoKSAq
LworfQpJbmRleDogaW1hcC9yZWNvbnN0cnVjdC5jCj09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KUkNTIGZpbGU6IC9hZnMv
YW5kcmV3L3N5c3RlbS9jdnMvc3JjL2N5cnVzL2ltYXAvcmVjb25zdHJ1Y3QuYyx2CnJldHJpZXZp
bmcgcmV2aXNpb24gMS44MQpkaWZmIC11IC11IC1yMS44MSByZWNvbnN0cnVjdC5jCi0tLSBpbWFw
L3JlY29uc3RydWN0LmMJMjIgT2N0IDIwMDMgMTg6NTA6MDggLTAwMDAJMS44MQorKysgaW1hcC9y
ZWNvbnN0cnVjdC5jCTYgSmFuIDIwMDQgMjE6NTI6MzQgLTAwMDAKQEAgLTg5LDYgKzg5LDcgQEAK
ICNpbmNsdWRlICJnbG9iYWwuaCIKICNpbmNsdWRlICJtYm94bmFtZS5oIgogI2luY2x1ZGUgIm1i
b3hsaXN0LmgiCisjaW5jbHVkZSAicXVvdGEuaCIKICNpbmNsdWRlICJzZWVuLmgiCiAjaW5jbHVk
ZSAicmV0cnkuaCIKICNpbmNsdWRlICJjb252ZXJ0X2NvZGUuaCIKQEAgLTQ0OCw3ICs0NDksNyBA
QAogICAgIH0KIAogICAgIC8qIEZpeCBxdW90YSByb290ICovCi0gICAgaGFzcXVvdGEgPSBtYWls
Ym94X2ZpbmRxdW90YShxdW90YV9yb290LCBzaXplb2YocXVvdGFfcm9vdCksIG1haWxib3gubmFt
ZSk7CisgICAgaGFzcXVvdGEgPSBxdW90YV9maW5kcm9vdChxdW90YV9yb290LCBzaXplb2YocXVv
dGFfcm9vdCksIG1haWxib3gubmFtZSk7CiAgICAgaWYgKG1haWxib3gucXVvdGEucm9vdCkgZnJl
ZShtYWlsYm94LnF1b3RhLnJvb3QpOwogICAgIGlmIChoYXNxdW90YSkgewogCW1haWxib3gucXVv
dGEucm9vdCA9IHhzdHJkdXAocXVvdGFfcm9vdCk7CkluZGV4OiBpbWFwL3VzZXIuYwo9PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09ClJDUyBmaWxlOiAvYWZzL2FuZHJldy9zeXN0ZW0vY3ZzL3NyYy9jeXJ1cy9pbWFwL3VzZXIu
Yyx2CnJldHJpZXZpbmcgcmV2aXNpb24gMS4xNwpkaWZmIC11IC11IC1yMS4xNyB1c2VyLmMKLS0t
IGltYXAvdXNlci5jCTIyIE9jdCAyMDAzIDE4OjUwOjA5IC0wMDAwCTEuMTcKKysrIGltYXAvdXNl
ci5jCTYgSmFuIDIwMDQgMjE6NTI6MzQgLTAwMDAKQEAgLTc5LDYgKzc5LDcgQEAKICNpbmNsdWRl
ICJtYWlsYm94LmgiCiAjaW5jbHVkZSAidXRpbC5oIgogI2luY2x1ZGUgInNlZW4uaCIKKyNpbmNs
dWRlICJxdW90YS5oIgogCiAjaWYgMAogc3RhdGljIGludCB1c2VyX2RlbGV0ZWFjbChjaGFyICpu
YW1lLCBpbnQgbWF0Y2hsZW4sIGludCBtYXljcmVhdGUsIHZvaWQqIHJvY2spCkBAIC0zOTIsMjkg
KzM5Myw1MCBAQAogewogICAgIGludCByID0gMDsKICAgICBzdHJ1Y3QgcXVvdGEgcXVvdGE7Ci0g
ICAgY2hhciBidWZbTUFYX01BSUxCT1hfUEFUSCsxXTsKIAogICAgIHF1b3RhLnJvb3QgPSBvbGRu
YW1lOwotICAgIHF1b3RhLmZkID0gLTE7CiAKLSAgICBtYWlsYm94X2hhc2hfcXVvdGEoYnVmLCBz
aXplb2YoYnVmKSwgcXVvdGEucm9vdCk7Ci0gICAgcXVvdGEuZmQgPSBvcGVuKGJ1ZiwgT19SRFdS
LCAwKTsKLSAgICBpZiAocXVvdGEuZmQgPiAwKSB7Ci0JciA9IG1haWxib3hfcmVhZF9xdW90YSgm
cXVvdGEpOwotCWlmICghcikgbWJveGxpc3Rfc2V0cXVvdGEobmV3bmFtZSwgcXVvdGEubGltaXQs
IDApOwotICAgIH0KKyAgICByID0gcXVvdGFfcmVhZCgmcXVvdGEsIE5VTEwsIDApOworICAgIGlm
ICghcikgbWJveGxpc3Rfc2V0cXVvdGEobmV3bmFtZSwgcXVvdGEubGltaXQsIDApOworCisgICAg
cmV0dXJuIHI7Cit9CisKK3N0cnVjdCBmaW5kX3JvY2sgeworICAgIGNoYXIgKmluYm94bmFtZTsK
KyAgICBzdHJ1Y3QgdHhuICoqdGlkOworfTsKKworc3RhdGljIGludCBmaW5kX3Aodm9pZCAqcm9j
a3AsCisJCSAgY29uc3QgY2hhciAqa2V5LCBpbnQga2V5bGVuLAorCQkgIGNvbnN0IGNoYXIgKmRh
dGEsIGludCBkYXRhbGVuKQoreworICAgIGNoYXIgKmluYm94bmFtZSA9ICgoc3RydWN0IGZpbmRf
cm9jayAqKSByb2NrcCktPmluYm94bmFtZTsKIAorICAgIHJldHVybiAoIXN0cm5jbXAoa2V5LCBp
bmJveG5hbWUsIHN0cmxlbihpbmJveG5hbWUpKSAmJgorCSAgICAoa2V5bGVuID09IHN0cmxlbihp
bmJveG5hbWUpIHx8IGtleVtzdHJsZW4oaW5ib3huYW1lKV0gPT0gJy4nKSk7Cit9CisKK3N0YXRp
YyBpbnQgZmluZF9jYih2b2lkICpyb2NrcCwKKwkJICBjb25zdCBjaGFyICprZXksIGludCBrZXls
ZW4sCisJCSAgY29uc3QgY2hhciAqZGF0YSwgaW50IGRhdGFsZW4pCit7CisgICAgc3RydWN0IHF1
b3RhIHF1b3RhX3Jvb3Q7CisgICAgc3RydWN0IHR4biAqKnRpZCA9ICgoc3RydWN0IGZpbmRfcm9j
ayAqKSByb2NrcCktPnRpZDsKKyAgICBpbnQgcjsKKworICAgIHF1b3RhX3Jvb3Qucm9vdCA9IChj
aGFyICopIHhzdHJuZHVwKGtleSwga2V5bGVuKTsKKyAgICByID0gcXVvdGFfZGVsZXRlKCZxdW90
YV9yb290LCB0aWQpOworICAgIGZyZWUocXVvdGFfcm9vdC5yb290KTsgCiAgICAgcmV0dXJuIHI7
CiB9CiAKIGludCB1c2VyX2RlbGV0ZXF1b3Rhcm9vdHMoY29uc3QgY2hhciAqdXNlcikKIHsKICAg
ICBzdHJ1Y3QgbmFtZXNwYWNlIG5hbWVzcGFjZTsKLSAgICBjaGFyIGluYm94bmFtZVsxMDI0XTsK
KyAgICBjaGFyIGJ1ZltNQVhfTUFJTEJPWF9OQU1FKzFdLCAqaW5ib3huYW1lID0gYnVmOworICAg
IHN0cnVjdCB0eG4gKnRpZCA9IE5VTEw7CiAgICAgaW50IHI7Ci0gICAgY2hhciBkaXJbTUFYX01B
SUxCT1hfTkFNRSsxXSwgKmZuYW1lLCBxcGF0aFtNQVhfTUFJTEJPWF9OQU1FXTsKLSAgICBESVIg
KmRpcnA7Ci0gICAgc3RydWN0IGRpcmVudCAqZjsKIAogICAgIC8qIHNldCBuYW1lc3BhY2UgKi8K
ICAgICByID0gbWJveG5hbWVfaW5pdF9uYW1lc3BhY2UoJm5hbWVzcGFjZSwgMCk7CkBAIC00MjIs
MzAgKzQ0NCwxNSBAQAogICAgIC8qIGdldCB1c2VyJ3MgdG9wbGV2ZWwgcXVvdGFyb290IChJTkJP
WCkgKi8KICAgICBpZiAoIXIpCiAJciA9ICgqbmFtZXNwYWNlLm1ib3huYW1lX3RvaW50ZXJuYWwp
KCZuYW1lc3BhY2UsICJJTkJPWCIsCi0JCQkJCSAgICAgdXNlciwgaW5ib3huYW1lKTsKKwkJCQkJ
CSB1c2VyLCBpbmJveG5hbWUpOwogCiAgICAgaWYgKCFyKSB7Ci0JLyogZ2V0IHBhdGggdG8gdG9w
bGV2ZWwgcXVvdGFyb290ICovCi0JbWFpbGJveF9oYXNoX3F1b3RhKGRpciwgc2l6ZW9mKGRpciks
IGluYm94bmFtZSk7Ci0KLQkvKiBzcGxpdCBkaXJlY3RvcnkgYW5kIGZpbGVuYW1lICovCi0JZm5h
bWUgPSBzdHJyY2hyKGRpciwgJy8nKTsKLQkqZm5hbWUrKyA9ICdcMCc7Ci0KLQlkaXJwID0gb3Bl
bmRpcihkaXIpOwotCWlmIChkaXJwKSB7Ci0JICAgIHdoaWxlICgoZiA9IHJlYWRkaXIoZGlycCkp
ICE9IE5VTEwpIHsKLQkJaWYgKCFzdHJuY21wKGYtPmRfbmFtZSwgZm5hbWUsIHN0cmxlbihmbmFt
ZSkpICYmCi0JCSAgICAoZi0+ZF9uYW1lW3N0cmxlbihmbmFtZSldID09ICdcMCd8fAotCQkgICAg
IGYtPmRfbmFtZVtzdHJsZW4oZm5hbWUpXSA9PSAnLicpKSB7Ci0KLQkJICAgIHNucHJpbnRmKHFw
YXRoLCBzaXplb2YocXBhdGgpLCAiJXMvJXMiLCBkaXIsIGYtPmRfbmFtZSk7Ci0JCSAgICB1bmxp
bmsocXBhdGgpOwotCQl9Ci0JICAgIH0KLQkgICAgY2xvc2VkaXIoZGlycCk7Ci0JfQorCXN0cnVj
dCBmaW5kX3JvY2sgZnJvY2sgPSB7IGluYm94bmFtZSwgJnRpZCB9OworCXIgPSBjb25maWdfcXVv
dGFfZGItPmZvcmVhY2gocWRiLCBpbmJveG5hbWUsIHN0cmxlbihpbmJveG5hbWUpLAorCQkJCSAg
ICAgJmZpbmRfcCwgJmZpbmRfY2IsICZmcm9jaywgJnRpZCk7CiAgICAgfQorCisgICAgaWYgKCFy
KSBxdW90YV9jb21taXQoJnRpZCk7CiAKICAgICByZXR1cm4gcjsKIH0KSW5kZXg6IGxpYi9jeXJ1
c2RiLmMKPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PQpSQ1MgZmlsZTogL2Fmcy9hbmRyZXcvc3lzdGVtL2N2cy9zcmMvY3ly
dXMvbGliL2N5cnVzZGIuYyx2CnJldHJpZXZpbmcgcmV2aXNpb24gMS44CmRpZmYgLXUgLXUgLXIx
LjggY3lydXNkYi5jCi0tLSBsaWIvY3lydXNkYi5jCTMgSmFuIDIwMDQgMjA6MTI6MzMgLTAwMDAJ
MS44CisrKyBsaWIvY3lydXNkYi5jCTYgSmFuIDIwMDQgMjE6NTI6MzQgLTAwMDAKQEAgLTY4LDYg
KzY4LDcgQEAKICNlbmRpZgogICAgICZjeXJ1c2RiX2ZsYXQsCiAgICAgJmN5cnVzZGJfc2tpcGxp
c3QsCisgICAgJmN5cnVzZGJfcXVvdGFsZWdhY3ksCiAgICAgTlVMTCB9OwogCiB2b2lkIGN5cnVz
ZGJfaW5pdCgpIApJbmRleDogbGliL2N5cnVzZGIuaAo9PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09ClJDUyBmaWxlOiAvYWZz
L2FuZHJldy9zeXN0ZW0vY3ZzL3NyYy9jeXJ1cy9saWIvY3lydXNkYi5oLHYKcmV0cmlldmluZyBy
ZXZpc2lvbiAxLjI3CmRpZmYgLXUgLXUgLXIxLjI3IGN5cnVzZGIuaAotLS0gbGliL2N5cnVzZGIu
aAkxNSBEZWMgMjAwMyAyMjo0MjozOCAtMDAwMAkxLjI3CisrKyBsaWIvY3lydXNkYi5oCTYgSmFu
IDIwMDQgMjE6NTI6MzQgLTAwMDAKQEAgLTE4NSw2ICsxODUsNyBAQAogZXh0ZXJuIHN0cnVjdCBj
eXJ1c2RiX2JhY2tlbmQgY3lydXNkYl9iZXJrZWxleV9ub3N5bmM7CiBleHRlcm4gc3RydWN0IGN5
cnVzZGJfYmFja2VuZCBjeXJ1c2RiX2ZsYXQ7CiBleHRlcm4gc3RydWN0IGN5cnVzZGJfYmFja2Vu
ZCBjeXJ1c2RiX3NraXBsaXN0OworZXh0ZXJuIHN0cnVjdCBjeXJ1c2RiX2JhY2tlbmQgY3lydXNk
Yl9xdW90YWxlZ2FjeTsKIAogZXh0ZXJuIGludCBjeXJ1c2RiX2NvcHlmaWxlKGNvbnN0IGNoYXIg
KnNyY25hbWUsIGNvbnN0IGNoYXIgKmRzdG5hbWUpOwogCkluZGV4OiBsaWIvY3lydXNkYl9xdW90
YWxlZ2FjeS5jCj09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT0KUkNTIGZpbGU6IGxpYi9jeXJ1c2RiX3F1b3RhbGVnYWN5LmMK
ZGlmZiAtTiBsaWIvY3lydXNkYl9xdW90YWxlZ2FjeS5jCi0tLSAvZGV2L251bGwJMSBKYW4gMTk3
MCAwMDowMDowMCAtMDAwMAorKysgbGliL2N5cnVzZGJfcXVvdGFsZWdhY3kuYwk2IEphbiAyMDA0
IDIxOjUyOjM0IC0wMDAwCkBAIC0wLDAgKzEsNzUzIEBACisvKiAgY3lydXNkYl9xdW90YWxlZ2Fj
eTogY3lydXNkYiBiYWNrZW5kIGZvciBhY2Nlc3NpbmcgbGVnYWN5IHF1b3RhIGZpbGVzCisgKgor
ICogQ29weXJpZ2h0IChjKSAxOTk4LTIwMDMgQ2FybmVnaWUgTWVsbG9uIFVuaXZlcnNpdHkuICBB
bGwgcmlnaHRzIHJlc2VydmVkLgorICoKKyAqIFJlZGlzdHJpYnV0aW9uIGFuZCB1c2UgaW4gc291
cmNlIGFuZCBiaW5hcnkgZm9ybXMsIHdpdGggb3Igd2l0aG91dAorICogbW9kaWZpY2F0aW9uLCBh
cmUgcGVybWl0dGVkIHByb3ZpZGVkIHRoYXQgdGhlIGZvbGxvd2luZyBjb25kaXRpb25zCisgKiBh
cmUgbWV0OgorICoKKyAqIDEuIFJlZGlzdHJpYnV0aW9ucyBvZiBzb3VyY2UgY29kZSBtdXN0IHJl
dGFpbiB0aGUgYWJvdmUgY29weXJpZ2h0CisgKiAgICBub3RpY2UsIHRoaXMgbGlzdCBvZiBjb25k
aXRpb25zIGFuZCB0aGUgZm9sbG93aW5nIGRpc2NsYWltZXIuIAorICoKKyAqIDIuIFJlZGlzdHJp
YnV0aW9ucyBpbiBiaW5hcnkgZm9ybSBtdXN0IHJlcHJvZHVjZSB0aGUgYWJvdmUgY29weXJpZ2h0
CisgKiAgICBub3RpY2UsIHRoaXMgbGlzdCBvZiBjb25kaXRpb25zIGFuZCB0aGUgZm9sbG93aW5n
IGRpc2NsYWltZXIgaW4KKyAqICAgIHRoZSBkb2N1bWVudGF0aW9uIGFuZC9vciBvdGhlciBtYXRl
cmlhbHMgcHJvdmlkZWQgd2l0aCB0aGUKKyAqICAgIGRpc3RyaWJ1dGlvbi4KKyAqCisgKiAzLiBU
aGUgbmFtZSAiQ2FybmVnaWUgTWVsbG9uIFVuaXZlcnNpdHkiIG11c3Qgbm90IGJlIHVzZWQgdG8K
KyAqICAgIGVuZG9yc2Ugb3IgcHJvbW90ZSBwcm9kdWN0cyBkZXJpdmVkIGZyb20gdGhpcyBzb2Z0
d2FyZSB3aXRob3V0CisgKiAgICBwcmlvciB3cml0dGVuIHBlcm1pc3Npb24uIEZvciBwZXJtaXNz
aW9uIG9yIGFueSBvdGhlciBsZWdhbAorICogICAgZGV0YWlscywgcGxlYXNlIGNvbnRhY3QgIAor
ICogICAgICBPZmZpY2Ugb2YgVGVjaG5vbG9neSBUcmFuc2ZlcgorICogICAgICBDYXJuZWdpZSBN
ZWxsb24gVW5pdmVyc2l0eQorICogICAgICA1MDAwIEZvcmJlcyBBdmVudWUKKyAqICAgICAgUGl0
dHNidXJnaCwgUEEgIDE1MjEzLTM4OTAKKyAqICAgICAgKDQxMikgMjY4LTQzODcsIGZheDogKDQx
MikgMjY4LTczOTUKKyAqICAgICAgdGVjaC10cmFuc2ZlckBhbmRyZXcuY211LmVkdQorICoKKyAq
IDQuIFJlZGlzdHJpYnV0aW9ucyBvZiBhbnkgZm9ybSB3aGF0c29ldmVyIG11c3QgcmV0YWluIHRo
ZSBmb2xsb3dpbmcKKyAqICAgIGFja25vd2xlZGdtZW50OgorICogICAgIlRoaXMgcHJvZHVjdCBp
bmNsdWRlcyBzb2Z0d2FyZSBkZXZlbG9wZWQgYnkgQ29tcHV0aW5nIFNlcnZpY2VzCisgKiAgICAg
YXQgQ2FybmVnaWUgTWVsbG9uIFVuaXZlcnNpdHkgKGh0dHA6Ly93d3cuY211LmVkdS9jb21wdXRp
bmcvKS4iCisgKgorICogQ0FSTkVHSUUgTUVMTE9OIFVOSVZFUlNJVFkgRElTQ0xBSU1TIEFMTCBX
QVJSQU5USUVTIFdJVEggUkVHQVJEIFRPCisgKiBUSElTIFNPRlRXQVJFLCBJTkNMVURJTkcgQUxM
IElNUExJRUQgV0FSUkFOVElFUyBPRiBNRVJDSEFOVEFCSUxJVFkKKyAqIEFORCBGSVRORVNTLCBJ
TiBOTyBFVkVOVCBTSEFMTCBDQVJORUdJRSBNRUxMT04gVU5JVkVSU0lUWSBCRSBMSUFCTEUKKyAq
IEZPUiBBTlkgU1BFQ0lBTCwgSU5ESVJFQ1QgT1IgQ09OU0VRVUVOVElBTCBEQU1BR0VTIE9SIEFO
WSBEQU1BR0VTCisgKiBXSEFUU09FVkVSIFJFU1VMVElORyBGUk9NIExPU1MgT0YgVVNFLCBEQVRB
IE9SIFBST0ZJVFMsIFdIRVRIRVIgSU4KKyAqIEFOIEFDVElPTiBPRiBDT05UUkFDVCwgTkVHTElH
RU5DRSBPUiBPVEhFUiBUT1JUSU9VUyBBQ1RJT04sIEFSSVNJTkcKKyAqIE9VVCBPRiBPUiBJTiBD
T05ORUNUSU9OIFdJVEggVEhFIFVTRSBPUiBQRVJGT1JNQU5DRSBPRiBUSElTIFNPRlRXQVJFLgor
ICovCisKKy8qICRJZCQgKi8KKworI2luY2x1ZGUgPGNvbmZpZy5oPgorCisjaWZkZWYgSEFWRV9V
TklTVERfSAorI2luY2x1ZGUgPHVuaXN0ZC5oPgorI2VuZGlmCisjaW5jbHVkZSA8c3RkaW8uaD4K
KyNpbmNsdWRlIDxzdGRsaWIuaD4KKyNpbmNsdWRlIDxzeXNsb2cuaD4KKyNpbmNsdWRlIDxzdHJp
bmcuaD4KKyNpbmNsdWRlIDxlcnJuby5oPgorI2luY2x1ZGUgPHN5cy90eXBlcy5oPgorI2luY2x1
ZGUgPHN5cy9zdGF0Lmg+CisjaW5jbHVkZSA8c3lzL3Vpby5oPgorI2luY2x1ZGUgPGZjbnRsLmg+
CisjaW5jbHVkZSAiL3Vzci9pbmNsdWRlL2dsb2IuaCIKKworI2luY2x1ZGUgImFzc2VydC5oIgor
I2luY2x1ZGUgImN5cnVzZGIuaCIKKyNpbmNsdWRlICJleGl0Y29kZXMuaCIKKyNpbmNsdWRlICJo
YXNoLmgiCisjaW5jbHVkZSAibWFwLmgiCisjaW5jbHVkZSAibGliY3lyX2NmZy5oIgorI2luY2x1
ZGUgImxvY2suaCIKKyNpbmNsdWRlICJyZXRyeS5oIgorI2luY2x1ZGUgInV0aWwuaCIKKyNpbmNs
dWRlICJ4bWFsbG9jLmgiCisKKyNkZWZpbmUgRk5BTUVfUVVPVEFESVIgIi9xdW90YS8iCisjZGVm
aW5lIE1BWF9RVU9UQV9QQVRIIDQwOTYKKworLyogd2UgaGF2ZSB0aGUgZmlsZSBsb2NrZWQgaWZm
IHdlIGhhdmUgYW4gb3V0c3RhbmRpbmcgdHJhbnNhY3Rpb24gKi8KKworc3RydWN0IGRiIHsKKyAg
ICBjaGFyICpwYXRoOworCisgICAgY2hhciAqZGF0YTsgIC8qIGFsbG9jYXRlZCBidWZmZXIgZm9y
IGZldGNoZWQgZGF0YSAqLworCisgICAgaGFzaF90YWJsZSB0YWJsZTsgIC8qIHRyYW5zYWN0aW9u
IChoYXNoIHRhYmxlIG9mIHN1Yi10cmFuc2FjdGlvbnMpICovCit9OworCitzdHJ1Y3Qgc3VidHhu
IHsKKyAgICBpbnQgZmQ7CisKKyAgICBjaGFyICpmbmFtZW5ldzsKKyAgICBpbnQgZmRuZXc7CisK
KyAgICBpbnQgZGVsZXRlOworfTsKKworLyogc2ltcGxlIGhhc2ggc28gaXQncyBlYXN5IHRvIGZp
bmQgdGhlc2UgdGhpbmdzIGluIHRoZSBmaWxlc3lzdGVtOworICAgb3VyIGh1bWFuIHRpbWUgaXMg
d29ydGggbW9yZSB0aGFuIGVmZmljaWVuY3kgKi8KK3N0YXRpYyB2b2lkIGhhc2hfcXVvdGEoY2hh
ciAqYnVmLCBzaXplX3Qgc2l6ZSwgY29uc3QgY2hhciAqcXIsIGNoYXIgKnBhdGgpCit7CisgICAg
aW50IGNvbmZpZ192aXJ0ZG9tYWlucyA9IGxpYmN5cnVzX2NvbmZpZ19nZXRzd2l0Y2goQ1lSVVNP
UFRfVklSVERPTUFJTlMpOworICAgIGNvbnN0IGNoYXIgKmlkeDsKKyAgICBjaGFyIGMsICpwOwor
ICAgIHVuc2lnbmVkIGxlbjsKKworICAgIGlmICgobGVuID0gc25wcmludGYoYnVmLCBzaXplLCAi
JXMiLCBwYXRoKSkgPj0gc2l6ZSkgeworICAgICAgICBmYXRhbCgiaW5zdWZmaWNpZW50IGJ1ZmZl
ciBzaXplIGluIGhhc2hfcXVvdGEiLCBFQ19URU1QRkFJTCk7CisgICAgfQorICAgIGJ1ZiArPSBs
ZW47CisgICAgc2l6ZSAtPSBsZW47CisKKyAgICBpZiAoY29uZmlnX3ZpcnRkb21haW5zICYmIChw
ID0gc3RyY2hyKHFyLCAnIScpKSkgeworCSpwID0gJ1wwJzsgIC8qIHNwbGl0IGRvbWFpbiFxciAq
LworCWMgPSAoY2hhcikgZGlyX2hhc2hfYyhxcik7CisJaWYgKChsZW4gPSBzbnByaW50ZihidWYs
IHNpemUsICIlcyVjLyVzIiwKKwkJCSAgICBGTkFNRV9ET01BSU5ESVIsIGMsIHFyKSkgPj0gc2l6
ZSkgeworCSAgICBmYXRhbCgiaW5zdWZmaWNpZW50IGJ1ZmZlciBzaXplIGluIGhhc2hfcXVvdGEi
LCBFQ19URU1QRkFJTCk7CisJfQorCSpwKysgPSAnISc7ICAvKiByZWFzc2VtYmxlIGRvbWFpbiFx
ciAqLworCXFyID0gcDsKKwlidWYgKz0gbGVuOworCXNpemUgLT0gbGVuOworCisJaWYgKCEqcXIp
IHsKKwkgICAgLyogcXVvdGEgZm9yIGVudGlyZSBkb21haW4gKi8KKwkgICAgaWYgKHNucHJpbnRm
KGJ1Ziwgc2l6ZSwgIiVzcm9vdCIsIEZOQU1FX1FVT1RBRElSKSA+PSBzaXplKSB7CisJCWZhdGFs
KCJpbnN1ZmZpY2llbnQgYnVmZmVyIHNpemUgaW4gaGFzaF9xdW90YSIsCisJCSAgICAgIEVDX1RF
TVBGQUlMKTsKKwkgICAgfQorCSAgICByZXR1cm47CisJfQorICAgIH0KKworICAgIGlkeCA9IHN0
cmNocihxciwgJy4nKTsgLyogc2tpcCBwYXN0IHVzZXIuICovCisgICAgaWYgKGlkeCA9PSBOVUxM
KSB7CisJaWR4ID0gcXI7CisgICAgfSBlbHNlIHsKKwlpZHgrKzsKKyAgICB9CisgICAgYyA9IChj
aGFyKSBkaXJfaGFzaF9jKGlkeCk7CisKKyAgICBpZiAoc25wcmludGYoYnVmLCBzaXplLCAiJXMl
Yy8lcyIsIEZOQU1FX1FVT1RBRElSLCBjLCBxcikgPj0gc2l6ZSkgeworCWZhdGFsKCJpbnN1ZmZp
Y2llbnQgYnVmZmVyIHNpemUgaW4gaGFzaF9xdW90YSIsIEVDX1RFTVBGQUlMKTsKKyAgICB9Cit9
CisKKy8qIG90aGVyIHJvdXRpbmVzIGNhbGwgdGhpcyBvbmUgd2hlbiB0aGV5IGZhaWwgKi8KK3N0
YXRpYyBpbnQgYWJvcnRfc3VidHhuKGNoYXIgKmZuYW1lLCBzdHJ1Y3Qgc3VidHhuICp0aWQpCit7
CisgICAgaW50IHIgPSBDWVJVU0RCX09LOworCisgICAgYXNzZXJ0KGZuYW1lICYmIHRpZCk7CisK
KyAgICAvKiBjbGVhbnVwIGRvbmUgd2hpbGUgbG9jayBpcyBoZWxkICovCisgICAgaWYgKHRpZC0+
Zm5hbWVuZXcpIHsKKwl1bmxpbmsodGlkLT5mbmFtZW5ldyk7CisJZnJlZSh0aWQtPmZuYW1lbmV3
KTsKKyAgICB9CisKKyAgICBpZiAodGlkLT5mZG5ldyAhPSAtMSkgeworCXIgPSBjbG9zZSh0aWQt
PmZkbmV3KTsKKyAgICB9CisKKyAgICBpZiAodGlkLT5mZCAhPSAtMSkgeworCS8qIHJlbGVhc2Ug
bG9jayAqLworCXIgPSBsb2NrX3VubG9jayh0aWQtPmZkKTsKKwlpZiAociA9PSAtMSkgeworCSAg
ICBzeXNsb2coTE9HX0VSUiwgIklPRVJST1I6IHVubG9ja2luZyAlczogJW0iLCBmbmFtZSk7CisJ
ICAgIHIgPSBDWVJVU0RCX0lPRVJST1I7CisJfQorCisJLyogY2xvc2UgKi8KKwlyID0gY2xvc2Uo
dGlkLT5mZCk7CisJaWYgKHIgPT0gLTEpIHsKKwkgICAgc3lzbG9nKExPR19FUlIsICJJT0VSUk9S
OiBjbG9zaW5nICVzOiAlbSIsIGZuYW1lKTsKKwkgICAgciA9IENZUlVTREJfSU9FUlJPUjsKKwl9
CisgICAgfQorCisgICAgZnJlZSh0aWQpOworCisgICAgcmV0dXJuIHI7Cit9CisKK3N0YXRpYyBp
bnQgY29tbWl0X3N1YnR4bihjaGFyICpmbmFtZSwgc3RydWN0IHN1YnR4biAqdGlkKQoreworICAg
IGludCB3cml0ZWZkOworICAgIGludCByID0gMDsKKyAgICBzdHJ1Y3Qgc3RhdCBzYnVmOworCisg
ICAgYXNzZXJ0KGZuYW1lICYmIHRpZCk7CisKKyAgICBpZiAoKHdyaXRlZmQgPSB0aWQtPmZkbmV3
KSAhPSAtMSkgeworCS8qIHdlIHdyb3RlIHNvbWV0aGluZyAqLworCisJaWYgKGZzeW5jKHdyaXRl
ZmQpIHx8CisJICAgIGZzdGF0KHdyaXRlZmQsICZzYnVmKSA9PSAtMSB8fAorCSAgICByZW5hbWUo
dGlkLT5mbmFtZW5ldywgZm5hbWUpID09IC0xIHx8CisJICAgIGxvY2tfdW5sb2NrKHdyaXRlZmQp
ID09IC0xKSB7CisJICAgIHN5c2xvZyhMT0dfRVJSLCAiSU9FUlJPUjogd3JpdGluZyAlczogJW0i
LCB0aWQtPmZuYW1lbmV3KTsKKwkgICAgciA9IENZUlVTREJfSU9FUlJPUjsKKwl9CisJY2xvc2Uo
d3JpdGVmZCk7CisJZnJlZSh0aWQtPmZuYW1lbmV3KTsKKyAgICB9IGVsc2UgaWYgKHRpZC0+ZGVs
ZXRlKSB7CisJLyogZGVsZXRlIGZpbGUgKi8KKwlyID0gdW5saW5rKGZuYW1lKTsKKwlpZiAociA9
PSAtMSkgeworCSAgICBzeXNsb2coTE9HX0VSUiwgIklPRVJST1I6IHVubGlua2luZyAlczogJW0i
LCBmbmFtZSk7CisJICAgIHIgPSBDWVJVU0RCX0lPRVJST1I7CisJfQorICAgIH0gZWxzZSB7CisJ
LyogcmVhZC1vbmx5IHR4biAqLworICAgIH0KKworICAgIC8qIHJlbGVhc2UgbG9jayAqLworICAg
IGlmICh0aWQtPmZkICE9IC0xKSB7CisJciA9IGxvY2tfdW5sb2NrKHRpZC0+ZmQpOworCWlmIChy
ID09IC0xKSB7CisJICAgIHN5c2xvZyhMT0dfRVJSLCAiSU9FUlJPUjogdW5sb2NraW5nICVzOiAl
bSIsIGZuYW1lKTsKKwkgICAgciA9IENZUlVTREJfSU9FUlJPUjsKKwl9CisKKwlyID0gY2xvc2Uo
dGlkLT5mZCk7CisJaWYgKHIgPT0gLTEpIHsKKwkgICAgc3lzbG9nKExPR19FUlIsICJJT0VSUk9S
OiBjbG9zaW5nICVzOiAlbSIsIGZuYW1lKTsKKwkgICAgciA9IENZUlVTREJfSU9FUlJPUjsKKwl9
CisgICAgfQorCisgICAgZnJlZSh0aWQpOworCisgICAgcmV0dXJuIHI7Cit9CisKK3N0YXRpYyB2
b2lkIGZyZWVfZGIoc3RydWN0IGRiICpkYikKK3sKKyAgICBpZiAoZGIpIHsKKwlpZiAoZGItPnBh
dGgpIGZyZWUoZGItPnBhdGgpOworCWlmIChkYi0+ZGF0YSkgZnJlZShkYi0+ZGF0YSk7CisJZnJl
ZV9oYXNoX3RhYmxlKCZkYi0+dGFibGUsIE5VTEwpOworCWZyZWUoZGIpOworICAgIH0KK30KKwor
c3RhdGljIHN0cnVjdCBzdWJ0eG4gKm5ld19zdWJ0eG4oY29uc3QgY2hhciAqZm5hbWUsIGludCBm
ZCkKK3sKKyAgICBzdHJ1Y3Qgc3VidHhuICpyZXQgPSAoc3RydWN0IHN1YnR4biAqKSB4bWFsbG9j
KHNpemVvZihzdHJ1Y3Qgc3VidHhuKSk7CisKKyAgICByZXQtPmZkID0gZmQ7CisgICAgcmV0LT5m
bmFtZW5ldyA9IE5VTEw7CisgICAgcmV0LT5mZG5ldyA9IC0xOworICAgIHJldC0+ZGVsZXRlID0g
MDsKKyAgICByZXR1cm4gcmV0OworfQorCitzdGF0aWMgaW50IGluaXQoY29uc3QgY2hhciAqZGJk
aXIgX19hdHRyaWJ1dGVfXygodW51c2VkKSksCisJCWludCBteWZsYWdzIF9fYXR0cmlidXRlX18o
KHVudXNlZCkpKQoreworICAgIHJldHVybiAwOworfQorCitzdGF0aWMgaW50IGRvbmUodm9pZCkK
K3sKKyAgICByZXR1cm4gMDsKK30KKworc3RhdGljIGludCBteXN5bmModm9pZCkKK3sKKyAgICBy
ZXR1cm4gMDsKK30KKworc3RhdGljIGludCBteWFyY2hpdmUoY29uc3QgY2hhciAqKmZuYW1lcywg
Y29uc3QgY2hhciAqZGlybmFtZSkKK3sKKyAgICByZXR1cm4gMDsKK30KKworc3RhdGljIGludCBt
eW9wZW4oY29uc3QgY2hhciAqZm5hbWUsIGludCBmbGFncywgc3RydWN0IGRiICoqcmV0KQorewor
ICAgIHN0cnVjdCBkYiAqZGIgPSAoc3RydWN0IGRiICopIHh6bWFsbG9jKHNpemVvZihzdHJ1Y3Qg
ZGIpKTsKKyAgICBzdHJ1Y3Qgc3RhdCBzYnVmOworICAgIGNoYXIgKnA7CisgICAgaW50IHI7CisK
KyAgICBhc3NlcnQoZm5hbWUgJiYgcmV0KTsKKworICAgIGRiLT5wYXRoID0geHN0cmR1cChmbmFt
ZSk7CisgICAgY29uc3RydWN0X2hhc2hfdGFibGUoJmRiLT50YWJsZSwgMzIsIDApOworCisgICAg
Lyogc3RyaXAgYW55IGZpbGVuYW1lIGZyb20gdGhlIHBhdGggKi8KKyAgICBpZiAocCA9IHN0cnJj
aHIoZGItPnBhdGgsICcvJykpICpwID0gJ1wwJzsKKworICAgIHIgPSBzdGF0KGRiLT5wYXRoLCAm
c2J1Zik7CisgICAgaWYgKHIgPT0gLTEgJiYgZXJybm8gPT0gRU5PRU5UICYmIChmbGFncyAmIENZ
UlVTREJfQ1JFQVRFKSkgeworCWlmIChjeXJ1c19ta2RpcihmbmFtZSwgMDc1NSkgIT0gLTEpIHsK
KwkgICAgciA9IHN0YXQoZGItPnBhdGgsICZzYnVmKTsKKwl9CisgICAgfQorCisgICAgaWYgKHIg
PT0gLTEpIHsKKwlpbnQgbGV2ZWwgPSAoZmxhZ3MgJiBDWVJVU0RCX0NSRUFURSkgPyBMT0dfRVJS
IDogTE9HX0RFQlVHOworCXN5c2xvZyhsZXZlbCwgIklPRVJST1I6IHN0YXRpbmcgJXM6ICVtIiwg
ZGItPnBhdGgpOworCWZyZWVfZGIoZGIpOworCXJldHVybiBDWVJVU0RCX0lPRVJST1I7CisgICAg
fQorCisgICAgKnJldCA9IGRiOworICAgIHJldHVybiAwOworfQorCitzdGF0aWMgaW50IG15Y2xv
c2Uoc3RydWN0IGRiICpkYikKK3sKKyAgICBhc3NlcnQoZGIpOworCisgICAgZnJlZV9kYihkYik7
CisKKyAgICByZXR1cm4gMDsKK30KKworc3RhdGljIGludCBteWZldGNoKHN0cnVjdCBkYiAqZGIs
IGNoYXIgKnF1b3RhX3BhdGgsCisJCSAgIGNvbnN0IGNoYXIgKipkYXRhLCBpbnQgKmRhdGFsZW4s
CisJCSAgIHN0cnVjdCB0eG4gKip0aWQpCit7CisgICAgc3RydWN0IHN1YnR4biAqbXl0aWQgPSBO
VUxMOworICAgIGludCBxdW90YV9mZDsKKyAgICBjb25zdCBjaGFyICpxdW90YV9iYXNlID0gMDsK
KyAgICB1bnNpZ25lZCBsb25nIHF1b3RhX2xlbiA9IDA7CisKKyAgICBhc3NlcnQoZGIpOworCisg
ICAgaWYgKGRhdGEpICpkYXRhID0gTlVMTDsKKyAgICBpZiAoZGF0YWxlbikgKmRhdGFsZW4gPSAw
OworCisgICAgaWYgKCFkYXRhKSB7CisJLyoganVzdCBjaGVjayBpZiB0aGUga2V5IGV4aXN0cyAq
LworCXN0cnVjdCBzdGF0IHNidWY7CisKKwlpZiAoc3RhdChxdW90YV9wYXRoLCAmc2J1ZikgPT0g
LTEpCisJICAgIHJldHVybiBDWVJVU0RCX05PVEZPVU5EOworCisJcmV0dXJuIDA7CisgICAgfQor
CisgICAgaWYgKHRpZCkgeworCWlmICghKnRpZCkKKwkgICAgKnRpZCA9IChzdHJ1Y3QgdHhuICop
ICZkYi0+dGFibGU7CisJZWxzZQorCSAgICBteXRpZCA9IChzdHJ1Y3Qgc3VidHhuICopIGhhc2hf
bG9va3VwKHF1b3RhX3BhdGgsICZkYi0+dGFibGUpOworICAgIH0KKworICAgIC8qIG9wZW4gYW5k
IGxvY2sgZmlsZSwgaWYgbmVlZGVkICovCisgICAgaWYgKCFteXRpZCkgeworCXF1b3RhX2ZkID0g
b3BlbihxdW90YV9wYXRoLCBPX1JEV1IsIDApOworCWlmIChxdW90YV9mZCA9PSAtMSkgeworCSAg
ICBpZiAoZXJybm8gPT0gRU5PRU5UKSB7CisJCS8qIGtleSBkb2Vzbid0IGV4aXN0ICovCisJCXJl
dHVybiBDWVJVU0RCX05PVEZPVU5EOworCSAgICB9CisKKwkgICAgc3lzbG9nKExPR19FUlIsICJJ
T0VSUk9SOiBvcGVuaW5nIHF1b3RhIGZpbGUgJXM6ICVtIiwgcXVvdGFfcGF0aCk7CisJICAgIHJl
dHVybiBDWVJVU0RCX0lPRVJST1I7CisJfQorCisJaWYgKHRpZCkgeworCSAgICBpbnQgcjsKKwkg
ICAgc3RydWN0IHN0YXQgc2J1ZjsKKwkgICAgY29uc3QgY2hhciAqbG9ja2ZhaWxhY3Rpb247CisK
KwkgICAgciA9IGxvY2tfcmVvcGVuKHF1b3RhX2ZkLCBxdW90YV9wYXRoLCAmc2J1ZiwgJmxvY2tm
YWlsYWN0aW9uKTsKKwkgICAgaWYgKHIgPT0gLTEpIHsKKwkJc3lzbG9nKExPR19FUlIsICJJT0VS
Uk9SOiAlcyBxdW90YSAlczogJW0iLCBsb2NrZmFpbGFjdGlvbiwKKwkJICAgICAgIHF1b3RhX3Bh
dGgpOworCQlyZXR1cm4gQ1lSVVNEQl9JT0VSUk9SOworCSAgICB9CisKKwkgICAgbXl0aWQgPSBu
ZXdfc3VidHhuKHF1b3RhX3BhdGgsIHF1b3RhX2ZkKTsKKwkgICAgaGFzaF9pbnNlcnQocXVvdGFf
cGF0aCwgbXl0aWQsICZkYi0+dGFibGUpOworCX0KKyAgICB9CisgICAgZWxzZQorCXF1b3RhX2Zk
ID0gbXl0aWQtPmZkOworCisgICAgbWFwX3JlZnJlc2gocXVvdGFfZmQsIDEsICZxdW90YV9iYXNl
LCAmcXVvdGFfbGVuLAorCQlNQVBfVU5LTk9XTl9MRU4sIHF1b3RhX3BhdGgsIDApOworCisgICAg
aWYgKHF1b3RhX2xlbikgeworCWNoYXIgKnAsICplb2w7CisKKwlkYi0+ZGF0YSA9IHhyZWFsbG9j
KGRiLT5kYXRhLCBxdW90YV9sZW4pOworCW1lbWNweShkYi0+ZGF0YSwgcXVvdGFfYmFzZSwgcXVv
dGFfbGVuKTsKKworCXAgPSBkYi0+ZGF0YTsKKwllb2wgPSBtZW1jaHIocCwgJ1xuJywgcXVvdGFf
bGVuIC0gKHAgLSBkYi0+ZGF0YSkpOworCWlmICghZW9sKSB7CisJICAgIG1hcF9mcmVlKCZxdW90
YV9iYXNlLCAmcXVvdGFfbGVuKTsKKwkgICAgcmV0dXJuIENZUlVTREJfSU9FUlJPUjsKKwl9CisJ
LyogY29udmVydCB0aGUgc2VwYXJhdGluZyBcbiB0byBTUCAqLworCSplb2wgPSAnICc7CisKKwlw
ID0gZW9sICsgMTsKKwllb2wgPSBtZW1jaHIocCwgJ1xuJywgcXVvdGFfbGVuIC0gKHAgLSBkYi0+
ZGF0YSkpOworCWlmICghZW9sKSB7CisJICAgIG1hcF9mcmVlKCZxdW90YV9iYXNlLCAmcXVvdGFf
bGVuKTsKKwkgICAgcmV0dXJuIENZUlVTREJfSU9FUlJPUjsKKwl9CisJLyogY29udmVydCB0aGUg
dGVybWluYXRpbmcgXG4gdG8gXDAgKi8KKwkqZW9sID0gJ1wwJzsKKworCSpkYXRhID0gZGItPmRh
dGE7CisJKmRhdGFsZW4gPSBzdHJsZW4oZGItPmRhdGEpOworICAgIH0KKworICAgIG1hcF9mcmVl
KCZxdW90YV9iYXNlLCAmcXVvdGFfbGVuKTsKKyAgICBpZiAoIXRpZCkgY2xvc2UocXVvdGFfZmQp
OworCisgICAgcmV0dXJuIDA7Cit9CisKK3N0YXRpYyBpbnQgZmV0Y2goc3RydWN0IGRiICpkYiwg
CisJCSBjb25zdCBjaGFyICprZXksIGludCBrZXlsZW4sCisJCSBjb25zdCBjaGFyICoqZGF0YSwg
aW50ICpkYXRhbGVuLAorCQkgc3RydWN0IHR4biAqKnRpZCkKK3sKKyAgICBjaGFyIHF1b3RhX3Bh
dGhbTUFYX1FVT1RBX1BBVEgrMV0sICp0bXBrZXkgPSBOVUxMOworCisgICAgLyogaWYgd2UgbmVl
ZCB0byB0cnVuY2F0ZSB0aGUga2V5LCBkbyBzbyAqLworICAgIGlmIChrZXlba2V5bGVuXSAhPSAn
XDAnKSB7CisJdG1wa2V5ID0geG1hbGxvYyhrZXlsZW4gKyAxKTsKKwltZW1jcHkodG1wa2V5LCBr
ZXksIGtleWxlbik7CisJdG1wa2V5W2tleWxlbl0gPSAnXDAnOworCWtleSA9IHRtcGtleTsKKyAg
ICB9CisKKyAgICBoYXNoX3F1b3RhKHF1b3RhX3BhdGgsIHNpemVvZihxdW90YV9wYXRoKSwga2V5
LCBkYi0+cGF0aCk7CisgICAgaWYgKHRtcGtleSkgZnJlZSh0bXBrZXkpOworCisgICAgcmV0dXJu
IG15ZmV0Y2goZGIsIHF1b3RhX3BhdGgsIGRhdGEsIGRhdGFsZW4sIHRpZCk7Cit9CisKK3N0YXRp
YyBpbnQgZm9yZWFjaChzdHJ1Y3QgZGIgKmRiLAorCQkgICBjaGFyICpwcmVmaXgsIGludCBwcmVm
aXhsZW4sCisJCSAgIGZvcmVhY2hfcCAqZ29vZHAsCisJCSAgIGZvcmVhY2hfY2IgKmNiLCB2b2lk
ICpyb2NrLCAKKwkJICAgc3RydWN0IHR4biAqKnRpZCkKK3sKKyAgICBpbnQgciA9IENZUlVTREJf
T0s7CisgICAgaW50IGNvbmZpZ192aXJ0ZG9tYWlucyA9IGxpYmN5cnVzX2NvbmZpZ19nZXRzd2l0
Y2goQ1lSVVNPUFRfVklSVERPTUFJTlMpOworICAgIGNoYXIgcXVvdGFfcGF0aFtNQVhfUVVPVEFf
UEFUSCsxXTsKKyAgICBnbG9iX3QgZ2xvYmJ1ZjsKKyAgICBpbnQgaTsKKyAgICBjaGFyICp0bXBw
cmVmaXggPSBOVUxMLCAqcCA9IE5VTEw7CisKKyAgICAvKiBpZiB3ZSBuZWVkIHRvIHRydW5jYXRl
IHRoZSBwcmVmaXgsIGRvIHNvICovCisgICAgaWYgKHByZWZpeFtwcmVmaXhsZW5dICE9ICdcMCcp
IHsKKwl0bXBwcmVmaXggPSB4bWFsbG9jKHByZWZpeGxlbiArIDEpOworCW1lbWNweSh0bXBwcmVm
aXgsIHByZWZpeCwgcHJlZml4bGVuKTsKKwl0bXBwcmVmaXhbcHJlZml4bGVuXSA9ICdcMCc7CisJ
cHJlZml4ID0gdG1wcHJlZml4OworICAgIH0KKworICAgIGhhc2hfcXVvdGEocXVvdGFfcGF0aCwg
c2l6ZW9mKHF1b3RhX3BhdGgpLCBwcmVmaXgsIGRiLT5wYXRoKTsKKyAgICBpZiAoY29uZmlnX3Zp
cnRkb21haW5zICYmIChwID0gc3RyY2hyKHByZWZpeCwgJyEnKSkpCisJcHJlZml4ID0gcCArIDE7
CisKKyAgICAvKiBzdHJpcCBvZmYgdGhlIHFyIHNwZWNpZmljIHBhdGggYW5kIHJlcGxhY2Ugd2l0
aCBwYXR0ZXJuICovCisgICAgc3ByaW50ZihzdHJzdHIocXVvdGFfcGF0aCwgRk5BTUVfUVVPVEFE
SVIpICsgc3RybGVuKEZOQU1FX1FVT1RBRElSKSwKKwkgICAgIiovJXMqIiwgcHJlZml4KTsKKwor
ICAgIC8qIHNlYXJjaCBmb3IgdGhlIHF1b3Rhcm9vdHMgKi8KKyAgICBnbG9iKHF1b3RhX3BhdGgs
IDAsIE5VTEwsICZnbG9iYnVmKTsKKworICAgIGlmIChjb25maWdfdmlydGRvbWFpbnMpIHsKKwlp
ZiAoIXByZWZpeGxlbikgeworCSAgICAvKiBzZWFyY2ggZm9yIGFsbCB2aXJ0ZG9tYWluIHF1b3Rh
cm9vdHMgKi8KKwkgICAgc25wcmludGYocXVvdGFfcGF0aCwgc2l6ZW9mKHF1b3RhX3BhdGgpLCAi
JXMlcyovKiVzKi8qIiwKKwkJICAgICBkYi0+cGF0aCwgRk5BTUVfRE9NQUlORElSLCBGTkFNRV9R
VU9UQURJUik7CisJICAgIGdsb2IocXVvdGFfcGF0aCwgR0xPQl9BUFBFTkQsIE5VTEwsICZnbG9i
YnVmKTsKKworCSAgICAvKiBzZWFyY2ggZm9yIGFsbCBkb21haW4gcXVvdGFzICovCisJICAgIHNu
cHJpbnRmKHF1b3RhX3BhdGgsIHNpemVvZihxdW90YV9wYXRoKSwgIiVzJXMqLyolc3Jvb3QiLAor
CQkgICAgIGRiLT5wYXRoLCBGTkFNRV9ET01BSU5ESVIsIEZOQU1FX1FVT1RBRElSKTsKKwkgICAg
Z2xvYihxdW90YV9wYXRoLCBHTE9CX0FQUEVORCwgTlVMTCwgJmdsb2JidWYpOworCX0KKwllbHNl
IGlmICghc3RybGVuKHByZWZpeCkpIHsKKwkgICAgLyogc2VhcmNoIGZvciB0aGUgZG9tYWluIHF1
b3RhcyAqLworCSAgICBzdHJjcHkoc3Ryc3RyKHF1b3RhX3BhdGgsIEZOQU1FX1FVT1RBRElSKSAr
IHN0cmxlbihGTkFNRV9RVU9UQURJUiksCisJCSAgICJyb290Iik7CisJICAgIGdsb2IocXVvdGFf
cGF0aCwgR0xPQl9BUFBFTkQsIE5VTEwsICZnbG9iYnVmKTsKKwl9CisgICAgfQorICAgIGlmICh0
bXBwcmVmaXgpIGZyZWUodG1wcHJlZml4KTsKKworICAgIGlmICh0aWQgJiYgISp0aWQpICp0aWQg
PSAoc3RydWN0IHR4biAqKSAmZGItPnRhYmxlOworCisgICAgZm9yIChpID0gMDsgaSA8IGdsb2Ji
dWYuZ2xfcGF0aGM7IGkrKykgeworCWNvbnN0IGNoYXIgKmRhdGE7CisJY2hhciAqcXIsICprZXk7
CisJc2l6ZV90IGtleWxlbiwgZGF0YWxlbjsKKworCXIgPSBteWZldGNoKGRiLCBnbG9iYnVmLmds
X3BhdGh2W2ldLCAmZGF0YSwgJmRhdGFsZW4sIHRpZCk7CisJaWYgKHIpIGJyZWFrOworCisJcXIg
PSBzdHJyY2hyKGdsb2JidWYuZ2xfcGF0aHZbaV0sICcvJykgKyAxOworCWlmIChwID0gc3Ryc3Ry
KGdsb2JidWYuZ2xfcGF0aHZbaV0sIEZOQU1FX0RPTUFJTkRJUikpIHsKKwkgICAgLyogdXNlIHRo
ZSBxdW90YV9wYXRoIGFzIGEgYnVmZmVyIHRvIGNvbnN0cnVjdCB2aXJ0ZG9tYWluIHFyICovCisJ
ICAgIHAgKz0gc3RybGVuKEZOQU1FX0RPTUFJTkRJUikgKyAyOyAvKiArMiBmb3IgaGFzaGRpciAq
LworCSAgICBzcHJpbnRmKHF1b3RhX3BhdGgsICIlLipzISVzIiwgc3RyY3NwbihwLCAiLyIpLCBw
LAorCQkgICAgc3RyY21wKHFyLCAicm9vdCIpID8gcXIgOiAiIik7CisJICAgIGtleSA9IHF1b3Rh
X3BhdGg7CisJfQorCWVsc2UKKwkgICAga2V5ID0gcXI7CisKKwlrZXlsZW4gPSBzdHJsZW4oa2V5
KTsKKworCWlmIChnb29kcChyb2NrLCBrZXksIGtleWxlbiwgZGF0YSwgZGF0YWxlbikpIHsKKwkg
ICAgLyogbWFrZSBjYWxsYmFjayAqLworCSAgICByID0gY2Iocm9jaywga2V5LCBrZXlsZW4sIGRh
dGEsIGRhdGFsZW4pOworCSAgICBpZiAocikgYnJlYWs7CisJfQorICAgIH0KKworICAgIGdsb2Jm
cmVlKCZnbG9iYnVmKTsKKworICAgIHJldHVybiByOworfQorCitzdGF0aWMgaW50IG15c3RvcmUo
c3RydWN0IGRiICpkYiwgCisJCSAgIGNvbnN0IGNoYXIgKmtleSwgaW50IGtleWxlbiwKKwkJICAg
Y29uc3QgY2hhciAqZGF0YSwgaW50IGRhdGFsZW4sCisJCSAgIHN0cnVjdCB0eG4gKip0aWQsIGlu
dCBvdmVyd3JpdGUpCit7CisgICAgY2hhciBxdW90YV9wYXRoW01BWF9RVU9UQV9QQVRIKzFdLCAq
dG1wa2V5ID0gTlVMTDsKKyAgICBzdHJ1Y3Qgc3VidHhuICpteXRpZCA9IE5VTEw7CisgICAgaW50
IHIgPSAwOworCisgICAgLyogaWYgd2UgbmVlZCB0byB0cnVuY2F0ZSB0aGUga2V5LCBkbyBzbyAq
LworICAgIGlmIChrZXlba2V5bGVuXSAhPSAnXDAnKSB7CisJdG1wa2V5ID0geG1hbGxvYyhrZXls
ZW4gKyAxKTsKKwltZW1jcHkodG1wa2V5LCBrZXksIGtleWxlbik7CisJdG1wa2V5W2tleWxlbl0g
PSAnXDAnOworCWtleSA9IHRtcGtleTsKKyAgICB9CisKKyAgICBoYXNoX3F1b3RhKHF1b3RhX3Bh
dGgsIHNpemVvZihxdW90YV9wYXRoKSwga2V5LCBkYi0+cGF0aCk7CisgICAgaWYgKHRtcGtleSkg
ZnJlZSh0bXBrZXkpOworCisgICAgaWYgKHRpZCkgeworCWlmICghKnRpZCkKKwkgICAgKnRpZCA9
IChzdHJ1Y3QgdHhuICopICZkYi0+dGFibGU7CisJZWxzZQorCSAgICBteXRpZCA9IChzdHJ1Y3Qg
c3VidHhuICopIGhhc2hfbG9va3VwKHF1b3RhX3BhdGgsICZkYi0+dGFibGUpOworICAgIH0KKwor
ICAgIC8qIG9wZW4gYW5kIGxvY2sgZmlsZSwgaWYgbmVlZGVkICovCisgICAgaWYgKCFteXRpZCkg
eworCWludCBmZDsKKwlzdHJ1Y3Qgc3RhdCBzYnVmOworCWNvbnN0IGNoYXIgKmxvY2tmYWlsYWN0
aW9uOworCisJZmQgPSBvcGVuKHF1b3RhX3BhdGgsIE9fUkRXUiwgMDY0NCk7CisJaWYgKGZkID09
IC0xICYmIGVycm5vID09IEVOT0VOVCAmJiBkYXRhKSB7CisJICAgIGlmIChjeXJ1c19ta2Rpcihx
dW90YV9wYXRoLCAwNzU1KSAhPSAtMSkgeworCQlmZCA9IG9wZW4ocXVvdGFfcGF0aCwgT19SRFdS
IHwgT19DUkVBVCwgMDY0NCk7CisJICAgIH0KKwl9CisJaWYgKGZkID09IC0xICYmIChlcnJubyAh
PSBFTk9FTlQgfHwgZGF0YSkpIHsKKwkgICAgc3lzbG9nKExPR19FUlIsICJJT0VSUk9SOiBvcGVu
aW5nIHF1b3RhIGZpbGUgJXM6ICVtIiwgcXVvdGFfcGF0aCk7CisJICAgIHJldHVybiBDWVJVU0RC
X0lPRVJST1I7CisJfQorCisJaWYgKGZkICE9IC0xKSB7CisJICAgIHIgPSBsb2NrX3Jlb3Blbihm
ZCwgcXVvdGFfcGF0aCwgJnNidWYsICZsb2NrZmFpbGFjdGlvbik7CisJICAgIGlmIChyID09IC0x
KSB7CisJCXN5c2xvZyhMT0dfRVJSLCAiSU9FUlJPUjogJXMgcXVvdGEgJXM6ICVtIiwgbG9ja2Zh
aWxhY3Rpb24sCisJCSAgICAgICBxdW90YV9wYXRoKTsKKwkJcmV0dXJuIENZUlVTREJfSU9FUlJP
UjsKKwkgICAgfQorCX0KKworCW15dGlkID0gbmV3X3N1YnR4bihxdW90YV9wYXRoLCBmZCk7CisK
KwlpZiAodGlkKQorCSAgICBoYXNoX2luc2VydChxdW90YV9wYXRoLCBteXRpZCwgJmRiLT50YWJs
ZSk7CisgICAgfQorCisgICAgaWYgKCFkYXRhKSB7CisJbXl0aWQtPmRlbGV0ZSA9IDE7CisgICAg
fQorICAgIGVsc2UgeworCWNoYXIgbmV3X3F1b3RhX3BhdGhbTUFYX1FVT1RBX1BBVEgrMV0sICpi
dWYsICpwOworCWludCBuZXdmZCA9IC0xLCByMTs7CisKKwlpZiAobXl0aWQtPmZkICE9IC0xICYm
ICFvdmVyd3JpdGUpIHsKKwkgICAgaWYgKHRpZCkKKwkJYWJvcnRfdHhuKGRiLCAqdGlkKTsKKwkg
ICAgZWxzZQorCQlhYm9ydF9zdWJ0eG4ocXVvdGFfcGF0aCwgbXl0aWQpOworCSAgICByZXR1cm4g
Q1lSVVNEQl9FWElTVFM7CisJfQorCisJc3RybGNweShuZXdfcXVvdGFfcGF0aCwgcXVvdGFfcGF0
aCwgc2l6ZW9mKG5ld19xdW90YV9wYXRoKSk7CisJc3RybGNhdChuZXdfcXVvdGFfcGF0aCwgIi5O
RVciLCBzaXplb2YobmV3X3F1b3RhX3BhdGgpKTsKKworCXVubGluayhuZXdfcXVvdGFfcGF0aCk7
CisJbmV3ZmQgPSBvcGVuKG5ld19xdW90YV9wYXRoLCBPX0NSRUFUIHwgT19UUlVOQyB8IE9fUkRX
UiwgMDY2Nik7CisJaWYgKG5ld2ZkID09IC0xICYmIGVycm5vID09IEVOT0VOVCkgeworCSAgICBp
ZiAoY3lydXNfbWtkaXIobmV3X3F1b3RhX3BhdGgsIDA3NTUpICE9IC0xKQorCQluZXdmZCA9IG9w
ZW4obmV3X3F1b3RhX3BhdGgsIE9fQ1JFQVQgfCBPX1RSVU5DIHwgT19SRFdSLCAwNjY2KTsKKwl9
CisJaWYgKG5ld2ZkID09IC0xKSB7CisJICAgIHN5c2xvZyhMT0dfRVJSLCAiSU9FUlJPUjogY3Jl
YXRpbmcgcXVvdGEgZmlsZSAlczogJW0iLAorCQkgICBuZXdfcXVvdGFfcGF0aCk7CisJICAgIGlm
ICh0aWQpCisJCWFib3J0X3R4bihkYiwgKnRpZCk7CisJICAgIGVsc2UKKwkJYWJvcnRfc3VidHhu
KHF1b3RhX3BhdGgsIG15dGlkKTsKKwkgICAgcmV0dXJuIENZUlVTREJfSU9FUlJPUjsKKwl9CisK
KwlteXRpZC0+ZmRuZXcgPSBuZXdmZDsKKwlyID0gbG9ja19ibG9ja2luZyhuZXdmZCk7CisJaWYg
KHIpIHsKKwkgICAgc3lzbG9nKExPR19FUlIsICJJT0VSUk9SOiBsb2NraW5nIHF1b3RhIGZpbGUg
JXM6ICVtIiwKKwkJICAgbmV3X3F1b3RhX3BhdGgpOworCSAgICBpZiAodGlkKQorCQlhYm9ydF90
eG4oZGIsICp0aWQpOworCSAgICBlbHNlCisJCWFib3J0X3N1YnR4bihxdW90YV9wYXRoLCBteXRp
ZCk7CisJICAgIHJldHVybiBDWVJVU0RCX0lPRVJST1I7CisJfQorCisJYnVmID0geG1hbGxvYyhk
YXRhbGVuKzEpOworCW1lbWNweShidWYsIGRhdGEsIGRhdGFsZW4pOworCS8qIGNvbnZlcnQgc2Vw
YXJhdGluZyBTUCB0byBcbiAqLworCXAgPSBtZW1jaHIoYnVmLCAnICcsIGRhdGFsZW4pOworCSpw
ID0gJ1xuJzsKKwkvKiBhZGQgYSB0ZXJtaW5hdGluZyBcbiAqLworCWJ1ZltkYXRhbGVuXSA9ICdc
bic7CisKKwlyMSA9IHdyaXRlKG5ld2ZkLCBidWYsIGRhdGFsZW4rMSk7CisJZnJlZShidWYpOwor
CisJaWYgKHIxID09IC0xKSB7CisJICAgIHN5c2xvZyhMT0dfRVJSLCAiSU9FUlJPUjogd3JpdGlu
ZyBxdW90YSBmaWxlICVzOiAlbSIsCisJCSAgIG5ld19xdW90YV9wYXRoKTsKKwkgICAgaWYgKHRp
ZCkKKwkJYWJvcnRfdHhuKGRiLCAqdGlkKTsKKwkgICAgZWxzZQorCQlhYm9ydF9zdWJ0eG4ocXVv
dGFfcGF0aCwgbXl0aWQpOworCSAgICByZXR1cm4gQ1lSVVNEQl9JT0VSUk9SOworCX0KKworCWlm
ICghbXl0aWQtPmZuYW1lbmV3KQorCSAgICBteXRpZC0+Zm5hbWVuZXcgPSB4c3RyZHVwKG5ld19x
dW90YV9wYXRoKTsKKyAgICB9CisKKyAgICBpZiAoIXRpZCkgeworCS8qIGNvbW1pdCBpbW1lZGlh
dGVseSAqLworCXIgPSBjb21taXRfc3VidHhuKHF1b3RhX3BhdGgsIG15dGlkKTsKKyAgICB9CisK
KyAgICByZXR1cm4gcjsKK30KKworc3RhdGljIGludCBjcmVhdGUoc3RydWN0IGRiICpkYiwgCisJ
CSAgY29uc3QgY2hhciAqa2V5LCBpbnQga2V5bGVuLAorCQkgIGNvbnN0IGNoYXIgKmRhdGEsIGlu
dCBkYXRhbGVuLAorCQkgIHN0cnVjdCB0eG4gKip0aWQpCit7CisgICAgcmV0dXJuIG15c3RvcmUo
ZGIsIGtleSwga2V5bGVuLCBkYXRhLCBkYXRhbGVuLCB0aWQsIDApOworfQorCitzdGF0aWMgaW50
IHN0b3JlKHN0cnVjdCBkYiAqZGIsIAorCQkgY29uc3QgY2hhciAqa2V5LCBpbnQga2V5bGVuLAor
CQkgY29uc3QgY2hhciAqZGF0YSwgaW50IGRhdGFsZW4sCisJCSBzdHJ1Y3QgdHhuICoqdGlkKQor
eworICAgIHJldHVybiBteXN0b3JlKGRiLCBrZXksIGtleWxlbiwgZGF0YSwgZGF0YWxlbiwgdGlk
LCAxKTsKK30KKworc3RhdGljIGludCBkZWxldGUoc3RydWN0IGRiICpkYiwgCisJCSAgY29uc3Qg
Y2hhciAqa2V5LCBpbnQga2V5bGVuLAorCQkgIHN0cnVjdCB0eG4gKipteXRpZCwgaW50IGZvcmNl
IF9fYXR0cmlidXRlX18oKHVudXNlZCkpKQoreworICAgIHJldHVybiBteXN0b3JlKGRiLCBrZXks
IGtleWxlbiwgTlVMTCwgMCwgbXl0aWQsIDEpOworfQorCitzdHJ1Y3QgdHhuX3JvY2sgeworICAg
IGhhc2hfdGFibGUgKnRhYmxlOworICAgIGludCAoKmZ1bmMpKGNoYXIgKiwgc3RydWN0IHN1YnR4
biAqKTsKKyAgICBpbnQgcmV0OworfTsKKworc3RhdGljIHZvaWQgZW51bV9mdW5jKGNoYXIgKmZu
YW1lLCB2b2lkICpkYXRhLCB2b2lkICpyb2NrKQoreworICAgIHN0cnVjdCB0eG5fcm9jayAqdHJv
Y2sgPSAoc3RydWN0IHR4bl9yb2NrICopIHJvY2s7CisgICAgaW50IHI7CisKKyAgICByID0gdHJv
Y2stPmZ1bmMoZm5hbWUsIChzdHJ1Y3Qgc3VidHhuICopIGRhdGEpOworICAgIGhhc2hfZGVsKGZu
YW1lLCB0cm9jay0+dGFibGUpOworCisgICAgaWYgKHIgJiYgIXRyb2NrLT5yZXQpIHRyb2NrLT5y
ZXQgPSByOworfQorCitpbnQgY29tbWl0X3R4bihzdHJ1Y3QgZGIgKmRiLCBzdHJ1Y3QgdHhuICp0
aWQpCit7CisgICAgc3RydWN0IHR4bl9yb2NrIHRyb2NrOworCisgICAgdHJvY2sudGFibGUgPSAo
aGFzaF90YWJsZSAqKSB0aWQ7CisgICAgdHJvY2suZnVuYyA9IGNvbW1pdF9zdWJ0eG47CisgICAg
dHJvY2sucmV0ID0gMDsKKworICAgIGhhc2hfZW51bWVyYXRlKChoYXNoX3RhYmxlICopIHRpZCwg
ZW51bV9mdW5jLCAmdHJvY2spOworCisgICAgcmV0dXJuIHRyb2NrLnJldDsKK30KKworaW50IGFi
b3J0X3R4bihzdHJ1Y3QgZGIgKmRiLCBzdHJ1Y3QgdHhuICp0aWQpCit7CisgICAgc3RydWN0IHR4
bl9yb2NrIHRyb2NrOworCisgICAgdHJvY2sudGFibGUgPSAoaGFzaF90YWJsZSAqKSB0aWQ7Cisg
ICAgdHJvY2suZnVuYyA9IGFib3J0X3N1YnR4bjsKKyAgICB0cm9jay5yZXQgPSAwOworCisgICAg
aGFzaF9lbnVtZXJhdGUoKGhhc2hfdGFibGUgKikgdGlkLCBlbnVtX2Z1bmMsICZ0cm9jayk7CisK
KyAgICByZXR1cm4gdHJvY2sucmV0OworfQorCitzdHJ1Y3QgY3lydXNkYl9iYWNrZW5kIGN5cnVz
ZGJfcXVvdGFsZWdhY3kgPSAKK3sKKyAgICAicXVvdGFsZWdhY3kiLAkJCS8qIG5hbWUgKi8KKwor
ICAgICZpbml0LAorICAgICZkb25lLAorICAgICZteXN5bmMsCisgICAgJm15YXJjaGl2ZSwKKwor
ICAgICZteW9wZW4sCisgICAgJm15Y2xvc2UsCisKKyAgICAmZmV0Y2gsCisgICAgJmZldGNoLAor
ICAgICZmb3JlYWNoLAorICAgICZjcmVhdGUsCisgICAgJnN0b3JlLAorICAgICZkZWxldGUsCisK
KyAgICAmY29tbWl0X3R4biwKKyAgICAmYWJvcnRfdHhuLAorCisgICAgTlVMTCwKKyAgICBOVUxM
Cit9OwpJbmRleDogbGliL2ltYXBvcHRpb25zCj09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KUkNTIGZpbGU6IC9hZnMvYW5k
cmV3L3N5c3RlbS9jdnMvc3JjL2N5cnVzL2xpYi9pbWFwb3B0aW9ucyx2CnJldHJpZXZpbmcgcmV2
aXNpb24gMS4xMQpkaWZmIC11IC11IC1yMS4xMSBpbWFwb3B0aW9ucwotLS0gbGliL2ltYXBvcHRp
b25zCTUgSmFuIDIwMDQgMTk6NTY6MzggLTAwMDAJMS4xMQorKysgbGliL2ltYXBvcHRpb25zCTYg
SmFuIDIwMDQgMjE6NTI6MzUgLTAwMDAKQEAgLTQ4Miw2ICs0ODIsOSBAQAogICAgZm9yY2UgdGhl
ICcvJyBpbiBLZXJiZXJvcyA1IHByaW5jaXBhbHMgdG8gYmUgY2Fub25pY2FsaXplZCB0byBhICcu
JwogICAgKHRvIG1ha2UgUFRTIGxvb2t1cHMgZWFzaWVyKSAqLwogCit7ICJxdW90YV9kYiIsICJx
dW90YWxlZ2FjeSIsIFNUUklOR0xJU1QoImZsYXQiLCAiYmVya2VsZXkiLCAic2tpcGxpc3QiLCAi
cXVvdGFsZWdhY3kiKX0KKy8qIFRoZSBjeXJ1c2RiIGJhY2tlbmQgdG8gdXNlIGZvciBxdW90YXMu
ICovCisKIHsgInF1b3Rhd2FybiIsIDkwLCBJTlQgfQogLyogVGhlIHBlcmNlbnQgb2YgcXVvdGEg
dXRpbGl6YXRpb24gb3ZlciB3aGljaCB0aGUgc2VydmVyIGdlbmVyYXRlcwogICAgd2FybmluZ3Mu
ICovCkluZGV4OiBsaWIvbGliY3lyX2NmZy5jCj09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KUkNTIGZpbGU6IC9hZnMvYW5k
cmV3L3N5c3RlbS9jdnMvc3JjL2N5cnVzL2xpYi9saWJjeXJfY2ZnLmMsdgpyZXRyaWV2aW5nIHJl
dmlzaW9uIDEuMwpkaWZmIC11IC11IC1yMS4zIGxpYmN5cl9jZmcuYwotLS0gbGliL2xpYmN5cl9j
ZmcuYwkxNSBEZWMgMjAwMyAyMjo0MjozOCAtMDAwMAkxLjMKKysrIGxpYi9saWJjeXJfY2ZnLmMJ
NiBKYW4gMjAwNCAyMTo1MjozNSAtMDAwMApAQCAtOTEsNiArOTEsMTAgQEAKICAgICAgICh1bmlv
biBjeXJ1c19jb25maWdfdmFsdWUpKChjb25zdCBjaGFyICopImJlcmtlbGV5IiksCiAgICAgICBD
WVJVU19PUFRfU1RSSU5HIH0sCiAKKyAgICB7IENZUlVTT1BUX1ZJUlRET01BSU5TLAorICAgICAg
KHVuaW9uIGN5cnVzX2NvbmZpZ192YWx1ZSkoKGludCkwKSwKKyAgICAgIENZUlVTX09QVF9TV0lU
Q0ggfSwKKwogICAgIHsgQ1lSVVNPUFRfTEFTVCwgeyBOVUxMIH0sIENZUlVTX09QVF9OT1RPUFQg
fQogfTsKIApJbmRleDogbGliL2xpYmN5cl9jZmcuaAo9PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09ClJDUyBmaWxlOiAvYWZz
L2FuZHJldy9zeXN0ZW0vY3ZzL3NyYy9jeXJ1cy9saWIvbGliY3lyX2NmZy5oLHYKcmV0cmlldmlu
ZyByZXZpc2lvbiAxLjMKZGlmZiAtdSAtdSAtcjEuMyBsaWJjeXJfY2ZnLmgKLS0tIGxpYi9saWJj
eXJfY2ZnLmgJMTUgRGVjIDIwMDMgMjI6NDI6MzggLTAwMDAJMS4zCisrKyBsaWIvbGliY3lyX2Nm
Zy5oCTYgSmFuIDIwMDQgMjE6NTI6MzUgLTAwMDAKQEAgLTg3LDYgKzg3LDggQEAKICAgICBDWVJV
U09QVF9GVUxMRElSSEFTSCwKICAgICAvKiBEYXRhYmFzZSBmb3IgdXNlIGJ5IEFVVEhfUFRTICov
CiAgICAgQ1lSVVNPUFRfUFRTQ0FDSEVfREIsCisgICAgLyogVmlydHVhbCBEb21haW5zIChPRkYp
ICovCisgICAgQ1lSVVNPUFRfVklSVERPTUFJTlMsCiAKICAgICBDWVJVU09QVF9MQVNUCiAgICAg
Cg==
</data>        

          </attachment>
      

    </bug>

</bugzilla>