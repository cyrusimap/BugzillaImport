<?xml version="1.0" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugzilla.cyrusimap.org/bugzilla.dtd">

<bugzilla version="3.2.5.1-2"
          urlbase="https://bugzilla.cyrusimap.org/"
          maintainer="Dave McMurtrie &lt;dave64@andrew.cmu.edu&gt;"
>

    <bug>
          <bug_id>3112</bug_id>
          
          <creation_ts>2008-10-28 10:48 EDT</creation_ts>
          <short_desc>patch: add sqlite3 backend support to the cyrus-sasl sql plugin</short_desc>
          <delta_ts>2010-10-25 18:46:47 EDT</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Cyrus SASL</product>
          <component>plugins</component>
          <version>2.1.x</version>
          <rep_platform>All</rep_platform>
          <op_sys>Linux</op_sys>
          <bug_status>CLOSED</bug_status>
          <resolution>DUPLICATE</resolution>
          <dup_id>2754</dup_id>
          
          
          
          <priority>P5</priority>
          <bug_severity>enhancement</bug_severity>
          <target_milestone>Future</target_milestone>
          
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Maxim Gorbachyov">maxim.gorbachyov@gmail.com</reporter>
          <assigned_to name="Ken Murchison">murch@andrew.cmu.edu</assigned_to>
          <cc>Alexey.Melnikov@isode.com</cc>
          

      

      

      
          <long_desc isprivate="0">
            <who name="Maxim Gorbachyov">maxim.gorbachyov@gmail.com</who>
            <bug_when>2008-10-28 10:48:03 EDT</bug_when>
            <thetext>Created an attachment (id=1039)
patch, adds sqlite3 support

Proposed patch (see attachment) adds sqlite3 backend support to the cyrus-sasl sql plugin. The patch does not interfere with present sqlite(v2) code. Build infrastructure is updated (tested on Debian Sid and on Ubuntu Hardy), but this update does not address win32 systems.

It seems like this patch is a solution for:
https://bugzilla.andrew.cmu.edu/show_bug.cgi?id=2754</thetext>
          </long_desc>
          <long_desc isprivate="0">
            <who name="Alexey Melnikov">Alexey.Melnikov@isode.com</who>
            <bug_when>2008-11-15 19:17:41 EDT</bug_when>
            <thetext>

*** This bug has been marked as a duplicate of bug 2754 ***</thetext>
          </long_desc>
      
          <attachment
              isobsolete="0"
              ispatch="1"
              isprivate="0"
          >
            <attachid>1039</attachid>
            <date>2008-10-28 10:48 EDT</date>
            <desc>patch, adds sqlite3 support</desc>
            <filename>add-sqlite3-support</filename>
            <type>text/plain</type>
            <size>7037</size>
            <attacher>maxim.gorbachyov@gmail.com</attacher>
            
              <data encoding="base64">ZGlmZiAtdXdyIGN5cnVzLXNhc2wtMi4xLjIyLW9sZC9jb25maWd1cmUuaW4gY3lydXMtc2FzbC0y
LjEuMjItbmV3L2NvbmZpZ3VyZS5pbgotLS0gY3lydXMtc2FzbC0yLjEuMjItb2xkL2NvbmZpZ3Vy
ZS5pbgkyMDA2LTA1LTE4IDIzOjA2OjEzLjAwMDAwMDAwMCArMDQwMAorKysgY3lydXMtc2FzbC0y
LjEuMjItbmV3L2NvbmZpZ3VyZS5pbgkyMDA4LTEwLTI4IDE2OjQ5OjAwLjAwMDAwMDAwMCArMDMw
MApAQCAtODQ2LDggKzg0Niw2MCBAQAogZXNhYwogQUNfU1VCU1QoTElCX1NRTElURSkKIAotaWYg
dGVzdCAiJHNxbCIgPSB5ZXMgLWEgIiR3aXRoX3Bnc3FsIiA9IG5vIC1hICIkd2l0aF9teXNxbCIg
PSBubyAtYSAiJHdpdGhfc3FsaXRlIiA9IG5vOyB0aGVuCi0gICAgQUNfRVJST1IoWy0tZW5hYmxl
LXNxbCBjaG9zZW4gYnV0IG5laXRoZXIgUG9zdGdyZXMgbm9yIE15U1FMIG5vciBTUUxpdGUgZm91
bmRdKQorZG5sIFNRTGl0ZTMKK0FDX0FSR19XSVRIKHNxbGl0ZTMsICBbICAtLXdpdGgtc3FsaXRl
Mz1QQVRIICAgICAgIHVzZSBTUUxpdGUzIGZyb20gUEFUSCBdLAorICB3aXRoX3NxbGl0ZTM9JHdp
dGh2YWwsCisgIHdpdGhfc3FsaXRlMz0kc3FsKQorCisjIGZpbmQgbG9jYXRpb24gb2YgbGlicmFy
eSAKKyMgcHJlc3VpbmcgaWYgb25lIGdpdmVuIHRoZW4gY29ycmVjdAoraWYgdGVzdCAiJHt3aXRo
X3NxbGl0ZTN9IiA9ICJ5ZXMiOyB0aGVuCisgIHdpdGhfc3FsaXRlMz1ub3Rmb3VuZAorICBmb3Ig
c3FsaXRlM2xvYyBpbiBsaWIKKyAgZG8KKyAgICBpZiB0ZXN0IC1mICR7cHJlZml4fS8ke3NxbGl0
ZTNsb2N9L2xpYnNxbGl0ZTMuYTsgdGhlbgorICAgICAgd2l0aF9zcWxpdGUzPSIke3ByZWZpeH0i
CisgICAgICBicmVhaworICAgIGVsaWYgdGVzdCAtZiAvdXNyL2xvY2FsLyR7c3FsaXRlM2xvY30v
bGlic3FsaXRlMy5hOyB0aGVuCisgICAgICB3aXRoX3NxbGl0ZTM9Ii91c3IvbG9jYWwiCisgICAg
ICBicmVhaworICAgIGVsaWYgdGVzdCAtZiAvdXNyLyR7c3FsaXRlM2xvY30vbGlic3FsaXRlMy5h
OyB0aGVuCisgICAgICB3aXRoX3NxbGl0ZTM9Ii91c3IiCisgICAgICBicmVhaworICAgIGZpCisg
IGRvbmUKK2ZpCisKK0xJQl9TUUxJVEUzPSIiCisKK2Nhc2UgIiR3aXRoX3NxbGl0ZTMiIGluCisg
ICAgbm8pIHRydWU7OworICAgIG5vdGZvdW5kKSBBQ19XQVJOKFtTUUxpdGUzIExpYnJhcnkgbm90
IGZvdW5kXSk7IHRydWU7OworICAgICopCisgICAgIGlmIHRlc3QgLWQgJHt3aXRoX3NxbGl0ZTN9
L2xpYjsgdGhlbgorICAgICAgICAgTElCX1NRTElURTM9Ii1MJHt3aXRoX3NxbGl0ZTN9L2xpYiAt
UiR7d2l0aF9zcWxpdGUzfS9saWIiCisgICAgIGVsc2UKKyAgICAgICAgIExJQl9TUUxJVEUzPSIt
TCR7d2l0aF9zcWxpdGUzfSAtUiR7d2l0aF9zcWxpdGUzfSIKKyAgICAgZmkKKworICAgICBMSUJf
U1FMSVRFM19ESVI9JExJQl9TUUxJVEUzCisgICAgIExJQl9TUUxJVEUzPSIkTElCX1NRTElURTMg
LWxzcWxpdGUzIgorCisgICAgIGlmIHRlc3QgLWQgJHt3aXRoX3NxbGl0ZTN9L2luY2x1ZGU7IHRo
ZW4KKyAgICAgICAgIENQUEZMQUdTPSIke0NQUEZMQUdTfSAtSSR7d2l0aF9zcWxpdGUzfS9pbmNs
dWRlIgorICAgICBlbHNlCisgICAgICAgICBDUFBGTEFHUz0iJHtDUFBGTEFHU30gLUkke3dpdGhf
c3FsaXRlM30iCisgICAgIGZpCisgICAgICAgQUNfQ0hFQ0tfTElCKHNxbGl0ZTMsIHNxbGl0ZTNf
b3BlbiwgQUNfREVGSU5FKEhBVkVfU1FMSVRFMyxbXSwKKwkgICBbRG8gd2UgaGF2ZSBTUUxpdGUz
IHN1cHBvcnQ/XSksCisgICAgICAgICAgIFtBQ19XQVJOKFtTUUxpdGUzIExpYnJhcnkgc3FsaXRl
MyBkb2VzIG5vdCB3b3JrXSkKKwkgICAgd2l0aF9zcWxpdGUzPW5vXSwgJExJQl9TUUxJVEUzX0RJ
Uik7OworICAgICAgICAgCitlc2FjCitBQ19TVUJTVChMSUJfU1FMSVRFMykKKworaWYgdGVzdCAi
JHNxbCIgPSB5ZXMgLWEgIiR3aXRoX3Bnc3FsIiA9IG5vIC1hICIkd2l0aF9teXNxbCIgPSBubyAt
YSAiJHdpdGhfc3FsaXRlIiA9IG5vIC1hICIkd2l0aF9zcWxpdGUzIiA9IG5vOyB0aGVuCisgICAg
QUNfRVJST1IoWy0tZW5hYmxlLXNxbCBjaG9zZW4gYnV0IG5laXRoZXIgUG9zdGdyZXMgbm9yIE15
U1FMIG5vciBTUUxpdGUgbm9yIFNRTGl0ZTMgZm91bmRdKQogZmkKIAogaWYgdGVzdCAiJGVuYWJs
ZV9zaGFyZWQiID0geWVzOyB0aGVuCmRpZmYgLXV3ciBjeXJ1cy1zYXNsLTIuMS4yMi1vbGQvZG9j
L29wdGlvbnMuaHRtbCBjeXJ1cy1zYXNsLTIuMS4yMi1uZXcvZG9jL29wdGlvbnMuaHRtbAotLS0g
Y3lydXMtc2FzbC0yLjEuMjItb2xkL2RvYy9vcHRpb25zLmh0bWwJMjAwNS0wMi0xNiAyMzo1Mjow
NS4wMDAwMDAwMDAgKzAzMDAKKysrIGN5cnVzLXNhc2wtMi4xLjIyLW5ldy9kb2Mvb3B0aW9ucy5o
dG1sCTIwMDgtMTAtMjggMTY6NDk6NTcuMDAwMDAwMDAwICswMzAwCkBAIC0xNDIsNyArMTQyLDcg
QEAKIDxURD5QYXRoIHRvIHNhc2xkYiBmaWxlPC9URD48VEQ+PHR0Pi9ldGMvc2FzbGRiMjwvdHQ+
IChzeXN0ZW0gZGVwZW5kYW50KTwvVEQ+CiA8VFI+CiA8VEQ+c3FsX2VuZ2luZTwvVEQ+PFREPlNR
TCBwbHVnaW48L1REPgotPFREPk5hbWUgb2YgU1FMIGVuZ2luZSB0byB1c2UgKHBvc3NpYmxlIHZh
bHVlczogJ215c3FsJywgJ3Bnc3FsJywgJ3NxbGl0ZScpLjwvVEQ+Cis8VEQ+TmFtZSBvZiBTUUwg
ZW5naW5lIHRvIHVzZSAocG9zc2libGUgdmFsdWVzOiAnbXlzcWwnLCAncGdzcWwnLCAnc3FsaXRl
JywgJ3NxbGl0ZTMnKS48L1REPgogPFREPjx0dD5teXNxbDwvdHQ+PC9URD4KIDwvVFI+CiA8VFI+
CmRpZmYgLXV3ciBjeXJ1cy1zYXNsLTIuMS4yMi1vbGQvcGx1Z2lucy9zcWwuYyBjeXJ1cy1zYXNs
LTIuMS4yMi1uZXcvcGx1Z2lucy9zcWwuYwotLS0gY3lydXMtc2FzbC0yLjEuMjItb2xkL3BsdWdp
bnMvc3FsLmMJMjAwNi0wNC0wNyAxNzo0MjoxNi4wMDAwMDAwMDAgKzA0MDAKKysrIGN5cnVzLXNh
c2wtMi4xLjIyLW5ldy9wbHVnaW5zL3NxbC5jCTIwMDgtMTAtMjggMTY6NTU6MTIuMDAwMDAwMDAw
ICswMzAwCkBAIC00NjgsNiArNDY4LDE0MSBAQAogfQogI2VuZGlmIC8qIEhBVkVfU1FMSVRFICov
CiAKKyNpZmRlZiBIQVZFX1NRTElURTMKKyNpbmNsdWRlIDxzcWxpdGUzLmg+CisKK3N0YXRpYyB2
b2lkICpfc3FsaXRlM19vcGVuKGNoYXIgKmhvc3QgX19hdHRyaWJ1dGVfXygodW51c2VkKSksCisJ
CQkgIGNoYXIgKnBvcnQgX19hdHRyaWJ1dGVfXygodW51c2VkKSksCisJCQkgIGludCB1c2Vzc2wg
X19hdHRyaWJ1dGVfXygodW51c2VkKSksCisJCQkgIGNvbnN0IGNoYXIgKnVzZXIgX19hdHRyaWJ1
dGVfXygodW51c2VkKSksCisJCQkgIGNvbnN0IGNoYXIgKnBhc3N3b3JkIF9fYXR0cmlidXRlX18o
KHVudXNlZCkpLAorCQkJICBjb25zdCBjaGFyICpkYXRhYmFzZSwgY29uc3Qgc2FzbF91dGlsc190
ICp1dGlscykKK3sKKyAgICBpbnQgcmM7CisgICAgc3FsaXRlMyAqZGI7CisgICAgY2hhciAqekVy
ck1zZyA9IE5VTEw7CisKKyAgICByYyA9IHNxbGl0ZTNfb3BlbihkYXRhYmFzZSwgJmRiKTsKKyAg
ICBpZiAoU1FMSVRFX09LICE9IHJjKSB7CisgICAgCWlmIChkYikKKwkJdXRpbHMtPmxvZyhOVUxM
LCBTQVNMX0xPR19FUlIsICJzcWwgcGx1Z2luOiAlcyIsIHNxbGl0ZTNfZXJybXNnKGRiKSk7CisJ
ZWxzZQorCQl1dGlscy0+bG9nKE5VTEwsIFNBU0xfTE9HX0VSUiwgInNxbCBwbHVnaW46ICVkIiwg
cmMpOworCXNxbGl0ZTNfY2xvc2UoZGIpOworCXJldHVybiBOVUxMOworICAgIH0KKworICAgIHJj
ID0gc3FsaXRlM19leGVjKGRiLCAiUFJBR01BIGVtcHR5X3Jlc3VsdF9jYWxsYmFja3MgPSBPTiIs
IE5VTEwsIE5VTEwsICZ6RXJyTXNnKTsKKyAgICBpZiAocmMgIT0gU1FMSVRFX09LKSB7CisgICAg
CWlmICh6RXJyTXNnKSB7CisJCXV0aWxzLT5sb2coTlVMTCwgU0FTTF9MT0dfRVJSLCAic3FsIHBs
dWdpbjogJXMiLCB6RXJyTXNnKTsKKwkJc3FsaXRlM19mcmVlKHpFcnJNc2cpOworCX0gZWxzZQor
CQl1dGlscy0+bG9nKE5VTEwsIFNBU0xfTE9HX0RFQlVHLCAic3FsIHBsdWdpbjogJWQiLCByYyk7
CisJc3FsaXRlM19jbG9zZShkYik7CisJcmV0dXJuIE5VTEw7CisgICAgfQorCisgICAgcmV0dXJu
ICh2b2lkKilkYjsKK30KKworc3RhdGljIGludCBfc3FsaXRlM19lc2NhcGVfc3RyKGNoYXIgKnRv
LCBjb25zdCBjaGFyICpmcm9tKQoreworICAgIGNoYXIgczsKKworICAgIHdoaWxlICggKHMgPSAq
ZnJvbSsrKSAhPSAnXDAnICkgeworCWlmIChzID09ICdcJycgfHwgcyA9PSAnXFwnKSB7CisJICAg
ICp0bysrID0gJ1xcJzsKKwl9CisJKnRvKysgPSBzOworICAgIH0KKyAgICAqdG8gPSAnXDAnOwor
CisgICAgcmV0dXJuIDA7Cit9CisKK3N0YXRpYyBpbnQgc3FsaXRlM19teV9jYWxsYmFjayh2b2lk
ICpwQXJnLCBpbnQgYXJnYyBfX2F0dHJpYnV0ZV9fKCh1bnVzZWQpKSwKKwkJCSAgICAgIGNoYXIg
Kiphcmd2LAorCQkJICAgICAgY2hhciAqKmNvbHVtbk5hbWVzIF9fYXR0cmlidXRlX18oKHVudXNl
ZCkpKQoreworICAgIGNoYXIgKipyZXN1bHQgPSAoY2hhcioqKXBBcmc7CisKKyAgICBpZiAoYXJn
diA9PSBOVUxMKSB7CisJKnJlc3VsdCA9IE5VTEw7CQkJCS8qIG5vIHJlY29yZCAqLworICAgIH0g
ZWxzZSBpZiAoYXJndlswXSA9PSBOVUxMKSB7CisJKnJlc3VsdCA9IHN0cmR1cChTUUxfTlVMTF9W
QUxVRSk7CS8qIE5VTEwgSVMgU1FMX05VTExfVkFMVUUgKi8KKyAgICB9IGVsc2UgeworCSpyZXN1
bHQgPSBzdHJkdXAoYXJndlswXSk7CisgICAgfQorCisgICAgcmV0dXJuIC8qQUJPUlQqLzE7Cit9
CisKK3N0YXRpYyBpbnQgX3NxbGl0ZTNfZXhlYyh2b2lkICpkYiwgY29uc3QgY2hhciAqY21kLCBj
aGFyICp2YWx1ZSwgc2l6ZV90IHNpemUsCisJCSAgICAgICAgc2l6ZV90ICp2YWx1ZV9sZW4sIGNv
bnN0IHNhc2xfdXRpbHNfdCAqdXRpbHMpCit7CisgICAgaW50IHJjOworICAgIGNoYXIgKnJlc3Vs
dCA9IE5VTEw7CisgICAgY2hhciAqekVyck1zZyA9IE5VTEw7CisKKyAgICByYyA9IHNxbGl0ZTNf
ZXhlYygoc3FsaXRlMyopZGIsIGNtZCwgc3FsaXRlM19teV9jYWxsYmFjaywgKHZvaWQqKSZyZXN1
bHQsICZ6RXJyTXNnKTsKKyAgICBpZiAocmMgIT0gU1FMSVRFX09LICYmIHJjICE9IFNRTElURV9B
Qk9SVCkgeworICAgIAlpZiAoekVyck1zZykgeworCQl1dGlscy0+bG9nKE5VTEwsIFNBU0xfTE9H
X0RFQlVHLCAic3FsIHBsdWdpbjogJXMiLCB6RXJyTXNnKTsKKwkJc3FsaXRlM19mcmVlKHpFcnJN
c2cpOworCX0gZWxzZQorCQl1dGlscy0+bG9nKE5VTEwsIFNBU0xfTE9HX0RFQlVHLCAic3FsIHBs
dWdpbjogJWQiLCByYyk7CisJcmV0dXJuIC0xOworICAgIH0KKworICAgIGlmIChyYyA9PSBTUUxJ
VEVfT0spIHsKKwkvKiBubyByZXN1bHRzIChCRUdJTiwgQ09NTUlULCBERUxFVEUsIElOU0VSVCwg
VVBEQVRFKSAqLworCXJldHVybiAwOworICAgIH0KKworICAgIGlmIChyZXN1bHQgPT0gTlVMTCkg
eworCS8qIHVtbSBub3RoaW5nIGZvdW5kICovCisJdXRpbHMtPmxvZyhOVUxMLCBTQVNMX0xPR19O
T1RFLCAic3FsIHBsdWdpbjogbm8gcmVzdWx0IGZvdW5kIik7CisJcmV0dXJuIC0xOworICAgIH0K
KworICAgIC8qIFhYWDogRHVwbGljYXRpb24gY2Fubm90IGJlIGZvdW5kIGJ5IHRoaXMgbWV0aG9k
LiAqLworCisgICAgLyogbm93IGdldCB0aGUgcmVzdWx0IHNldCB2YWx1ZSBhbmQgdmFsdWVfbGVu
ICovCisgICAgLyogd2Ugb25seSBmZXRjaCBvbmUgYmVjYXVzZSB3ZSBkb24ndCBjYXJlIGFib3V0
IHRoZSByZXN0ICovCisgICAgaWYgKHZhbHVlKSB7CisJc3RybmNweSh2YWx1ZSwgcmVzdWx0LCBz
aXplIC0gMik7CisJdmFsdWVbc2l6ZSAtIDFdID0gJ1wwJzsKKwlpZiAodmFsdWVfbGVuKSB7CisJ
ICAgICp2YWx1ZV9sZW4gPSBzdHJsZW4odmFsdWUpOworCX0KKyAgICB9CisKKyAgICBmcmVlKHJl
c3VsdCk7CisgICAgcmV0dXJuIDA7Cit9CisKK3N0YXRpYyBpbnQgX3NxbGl0ZTNfYmVnaW5fdHhu
KHZvaWQgKmRiLCBjb25zdCBzYXNsX3V0aWxzX3QgKnV0aWxzKQoreworICAgIHJldHVybiBfc3Fs
aXRlM19leGVjKGRiLCAiQkVHSU4gVFJBTlNBQ1RJT04iLCBOVUxMLCAwLCBOVUxMLCB1dGlscyk7
Cit9CisKK3N0YXRpYyBpbnQgX3NxbGl0ZTNfY29tbWl0X3R4bih2b2lkICpkYiwgY29uc3Qgc2Fz
bF91dGlsc190ICp1dGlscykKK3sKKyAgICByZXR1cm4gX3NxbGl0ZTNfZXhlYyhkYiwgIkNPTU1J
VCBUUkFOU0FDVElPTiIsIE5VTEwsIDAsIE5VTEwsIHV0aWxzKTsKK30KKworc3RhdGljIGludCBf
c3FsaXRlM19yb2xsYmFja190eG4odm9pZCAqZGIsIGNvbnN0IHNhc2xfdXRpbHNfdCAqdXRpbHMp
Cit7CisgICAgcmV0dXJuIF9zcWxpdGUzX2V4ZWMoZGIsICJST0xMQkFDSyBUUkFOU0FDVElPTiIs
IE5VTEwsIDAsIE5VTEwsIHV0aWxzKTsKK30KKworc3RhdGljIHZvaWQgX3NxbGl0ZTNfY2xvc2Uo
dm9pZCAqZGIpCit7CisgICAgc3FsaXRlM19jbG9zZSgoc3FsaXRlMyopZGIpOworfQorI2VuZGlm
IC8qIEhBVkVfU1FMSVRFMyAqLworCiBzdGF0aWMgY29uc3Qgc3FsX2VuZ2luZV90IHNxbF9lbmdp
bmVzW10gPSB7CiAjaWZkZWYgSEFWRV9NWVNRTAogICAgIHsgIm15c3FsIiwgJl9teXNxbF9vcGVu
LCAmX215c3FsX2VzY2FwZV9zdHIsCkBAIC00ODQsNiArNjE5LDExIEBACiAgICAgICAmX3NxbGl0
ZV9iZWdpbl90eG4sICZfc3FsaXRlX2NvbW1pdF90eG4sICZfc3FsaXRlX3JvbGxiYWNrX3R4biwK
ICAgICAgICZfc3FsaXRlX2V4ZWMsICZfc3FsaXRlX2Nsb3NlIH0sCiAjZW5kaWYKKyNpZmRlZiBI
QVZFX1NRTElURTMKKyAgICB7ICJzcWxpdGUzIiwgJl9zcWxpdGUzX29wZW4sICZfc3FsaXRlM19l
c2NhcGVfc3RyLAorICAgICAgJl9zcWxpdGUzX2JlZ2luX3R4biwgJl9zcWxpdGUzX2NvbW1pdF90
eG4sICZfc3FsaXRlM19yb2xsYmFja190eG4sCisgICAgICAmX3NxbGl0ZTNfZXhlYywgJl9zcWxp
dGUzX2Nsb3NlIH0sCisjZW5kaWYKICAgICB7IE5VTEwsIE5VTEwsIE5VTEwsIE5VTEwsIE5VTEws
IE5VTEwsIE5VTEwsIE5VTEwgfQogfTsKIAo=
</data>        

          </attachment>
      

    </bug>

</bugzilla>