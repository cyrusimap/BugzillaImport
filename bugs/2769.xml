<?xml version="1.0" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugzilla.cyrusimap.org/bugzilla.dtd">

<bugzilla version="3.2.5.1-2"
          urlbase="https://bugzilla.cyrusimap.org/"
          maintainer="Dave McMurtrie &lt;dave64@andrew.cmu.edu&gt;"
>

    <bug>
          <bug_id>2769</bug_id>
          
          <creation_ts>2005-12-13 11:19 EDT</creation_ts>
          <short_desc>Need CONDSTORE support</short_desc>
          <delta_ts>2010-10-25 18:46:37 EDT</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Cyrus IMAP</product>
          <component>IMAP</component>
          <version>2.3.x</version>
          <rep_platform>Other</rep_platform>
          <op_sys>other</op_sys>
          <bug_status>CLOSED</bug_status>
          <resolution>FIXED</resolution>
          
          
          
          
          <priority>P2</priority>
          <bug_severity>enhancement</bug_severity>
          <target_milestone>Future</target_milestone>
          
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Ken Murchison">murch@andrew.cmu.edu</reporter>
          <assigned_to name="Ken Murchison">murch@andrew.cmu.edu</assigned_to>
          <cc>dave@cridland.net</cc>
          <qa_contact name="The Cyrus Bugzilla List">cyrus-bugzilla@lists.andrew.cmu.edu</qa_contact>

      

      

      
          <long_desc isprivate="0">
            <who name="Ken Murchison">murch@andrew.cmu.edu</who>
            <bug_when>2005-12-13 11:19:38 EDT</bug_when>
            <thetext>CONDSTORE is the last feature that we need to implement to be compliant with
Lemonade Profile 1</thetext>
          </long_desc>
          <long_desc isprivate="0">
            <who name="Ken Murchison">murch@andrew.cmu.edu</who>
            <bug_when>2005-12-13 11:32:26 EDT</bug_when>
            <thetext>Created an attachment (id=405)
CONDSTORE patch

Initial implementation.  Does nothing with \Seen state yet.  Doesn&apos;t implement
[MODIFIED] response for STORE UNCHANGEDSINCE, or optional entry name/type for
SEARCH MODSEQ.</thetext>
          </long_desc>
          <long_desc isprivate="0">
            <who name="Ken Murchison">murch@andrew.cmu.edu</who>
            <bug_when>2005-12-13 21:23:25 EDT</bug_when>
            <thetext>Created an attachment (id=406)
CONDSTORE patch

Fixed a few bugs from Dave Cridland.</thetext>
          </long_desc>
          <long_desc isprivate="0">
            <who name="Ken Murchison">murch@andrew.cmu.edu</who>
            <bug_when>2006-04-04 10:33:59 EDT</bug_when>
            <thetext>Implementation applied to 2.3 CVS.</thetext>
          </long_desc>
      
          <attachment
              isobsolete="1"
              ispatch="1"
              isprivate="0"
          >
            <attachid>405</attachid>
            <date>2005-12-13 11:32 EDT</date>
            <desc>CONDSTORE patch</desc>
            <filename>CONDSTORE.patch</filename>
            <type>text/plain</type>
            <size>45315</size>
            <attacher>murch@andrew.cmu.edu</attacher>
            
              <data encoding="base64">SW5kZXg6IGRvYy9zcGVjcy5odG1sCj09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KUkNTIGZpbGU6IC9hZnMvYW5kcmV3L3N5
c3RlbS9jdnMvc3JjL2N5cnVzL2RvYy9zcGVjcy5odG1sLHYKcmV0cmlldmluZyByZXZpc2lvbiAx
LjUwLjIuMTgKZGlmZiAtdSAtcjEuNTAuMi4xOCBzcGVjcy5odG1sCi0tLSBkb2Mvc3BlY3MuaHRt
bAkyMSBOb3YgMjAwNSAxNzowNToyMiAtMDAwMAkxLjUwLjIuMTgKKysrIGRvYy9zcGVjcy5odG1s
CTEzIERlYyAyMDA1IDE2OjI3OjU2IC0wMDAwCkBAIC00OSw2ICs0OSw5IEBACiA8VFI+PFREPjxB
IEhSRUY9Imh0dHA6Ly93d3cuaWV0Zi5vcmcvaW50ZXJuZXQtZHJhZnRzL2RyYWZ0LWlldGYtaW1h
cGV4dC1saXN0LWV4dGVuc2lvbnMtMTMudHh0Ij4KIGRyYWZ0LWlldGYtaW1hcGV4dC1saXN0LWV4
dGVuc2lvbnM8L0E+PC9URD4KIDxURD5JTUFQNCBMSVNUIENvbW1hbmQgRXh0ZW5zaW9uczwvVEQ+
PC9UUj4KKzxUUj48VEQ+PEEgSFJFRj0iaHR0cDovL3d3dy5pZXRmLm9yZy9pbnRlcm5ldC1kcmFm
dHMvZHJhZnQtaWV0Zi1pbWFwZXh0LWNvbmRzdG9yZS0wNy50eHQiPgorZHJhZnQtaWV0Zi1pbWFw
ZXh0LWNvbmRzdG9yZTwvQT48L1REPgorPFREPklNQVAgRXh0ZW5zaW9uIGZvciBDb25kaXRpb25h
bCBTVE9SRSBvcGVyYXRpb248L1REPjwvVFI+CiA8VFI+PFREPjxBIEhSRUY9Imh0dHA6Ly93d3cu
aWV0Zi5vcmcvaW50ZXJuZXQtZHJhZnRzL2RyYWZ0LWlldGYtbGVtb25hZGUtY2F0ZW5hdGUtMDUu
dHh0Ij4KIGRyYWZ0LWlldGYtbGVtb25hZGUtY2F0ZW5hdGU8L0E+PC9URD4KIDxURD5JbnRlcm5l
dCBNZXNzYWdlIEFjY2VzcyBQcm90b2NvbCAoSU1BUCkgQ0FURU5BVEUgRXh0ZW5zaW9uPC9URD48
L1RSPgpJbmRleDogZG9jL2ludGVybmFsL21haWxib3gtZm9ybWF0Lmh0bWwKPT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQpS
Q1MgZmlsZTogL2Fmcy9hbmRyZXcvc3lzdGVtL2N2cy9zcmMvY3lydXMvZG9jL2ludGVybmFsL21h
aWxib3gtZm9ybWF0Lmh0bWwsdgpyZXRyaWV2aW5nIHJldmlzaW9uIDEuMy4yLjUKZGlmZiAtdSAt
cjEuMy4yLjUgbWFpbGJveC1mb3JtYXQuaHRtbAotLS0gZG9jL2ludGVybmFsL21haWxib3gtZm9y
bWF0Lmh0bWwJMTIgRGVjIDIwMDUgMjE6NDA6NDMgLTAwMDAJMS4zLjIuNQorKysgZG9jL2ludGVy
bmFsL21haWxib3gtZm9ybWF0Lmh0bWwJMTMgRGVjIDIwMDUgMTY6Mjc6NTcgLTAwMDAKQEAgLTE3
Nyw2ICsxNzcsMTEgQEAKIAogPGR0PkxlYWtlZCBDYWNoZSAoNCBieXRlcyk8L2R0PiAKIDxkZD4g
TnVtYmVyIG9mIGxlYWtlZCByZWNvcmRzIGluIHRoZSBjYWNoZSBmaWxlLjwvZGQ+CisKKzxkdD5I
aWdoZXN0TW9kU2VxICg4IGJ5dGVzKTwvZHQ+CisKKzxkZD4gSGlnaGVzdCBNb2RpZmljYXRpb24g
U2VxdWVuY2Ugb2YgYWxsIHRoZSBtZXNzYWdlcyBpbiB0aGUKK21haWxib3ggKENPTkRTVE9SRSku
PC9kZD4KIDwvZGw+CiAKIDxwPgpAQCAtMjMwLDYgKzIzNSw5IEBACiAKIDxkdD5VVUlEIChNRVNT
QUdFX1VVSURfU0laRSBieXRlcyk8L2R0PgogPGRkPlVuaXZlcnNhbCBVSUQgb2YgdGhlIG1lc3Nh
Z2UgKHVzZWQgYnkgcmVwbGljYXRpb24gY29kZSkuPC9kZD4KKworPGR0Pk1PRFNFUSAoOCBieXRl
cyk8L2R0PgorPGRkPk1vZGlmaWNhdGlvbiBTZXF1ZW5jZSBvZiB0aGUgbWVzc2FnZSAoQ09ORFNU
T1JFKS48L2RkPgogPC9kbD4KIAogPGgzPjx0dD5jeXJ1cy5jYWNoZTwvdHQ+IGZpbGUgZm9ybWF0
IGRldGFpbDwvaDM+CkluZGV4OiBpbWFwL2FwcGVuZC5jCj09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KUkNTIGZpbGU6IC9h
ZnMvYW5kcmV3L3N5c3RlbS9jdnMvc3JjL2N5cnVzL2ltYXAvYXBwZW5kLmMsdgpyZXRyaWV2aW5n
IHJldmlzaW9uIDEuMTAyLjIuMTEKZGlmZiAtdSAtcjEuMTAyLjIuMTEgYXBwZW5kLmMKLS0tIGlt
YXAvYXBwZW5kLmMJMiBKdW4gMjAwNSAxNjoxNjowMSAtMDAwMAkxLjEwMi4yLjExCisrKyBpbWFw
L2FwcGVuZC5jCTEzIERlYyAyMDA1IDE2OjI3OjU3IC0wMDAwCkBAIC0yOTEsNiArMjkxLDcgQEAK
ICAgICAvKiBDYWxjdWxhdGUgbmV3IGluZGV4IGhlYWRlciBpbmZvcm1hdGlvbiAqLwogICAgIGFz
LT5tLmV4aXN0cyArPSBhcy0+bnVtbXNnOwogICAgIGFzLT5tLmxhc3RfdWlkICs9IGFzLT5udW1t
c2c7CisgICAgYXMtPm0uaGlnaGVzdG1vZHNlcSsrOwogICAgIAogICAgIGFzLT5tLmFuc3dlcmVk
ICs9IGFzLT5udW1hbnN3ZXJlZDsKICAgICBhcy0+bS5kZWxldGVkICs9IGFzLT5udW1kZWxldGVk
OwpAQCAtNTUwLDYgKzU1MSw3IEBACiAKICAgICAvKiBTZXR1cCAqLwogICAgIG1lc3NhZ2VfaW5k
ZXgudWlkID0gbWFpbGJveC0+bGFzdF91aWQgKyBhcy0+bnVtbXNnICsgMTsKKyAgICBtZXNzYWdl
X2luZGV4Lm1vZHNlcSA9IG1haWxib3gtPmhpZ2hlc3Rtb2RzZXEgKyAxOwogICAgIG1lc3NhZ2Vf
aW5kZXgubGFzdF91cGRhdGVkID0gdGltZSgwKTsKICAgICBtZXNzYWdlX2luZGV4LmludGVybmFs
ZGF0ZSA9IGludGVybmFsZGF0ZTsKICAgICBsc2VlayhtYWlsYm94LT5jYWNoZV9mZCwgMEwsIFNF
RUtfRU5EKTsKQEAgLTcwMyw2ICs3MDUsNyBAQAogICAgIHplcm9faW5kZXgobWVzc2FnZV9pbmRl
eCk7CiAgICAgLyogU2V0dXAgKi8KICAgICBtZXNzYWdlX2luZGV4LnVpZCA9IG1haWxib3gtPmxh
c3RfdWlkICsgYXMtPm51bW1zZyArIDE7CisgICAgbWVzc2FnZV9pbmRleC5tb2RzZXEgPSBtYWls
Ym94LT5oaWdoZXN0bW9kc2VxICsgMTsKICAgICBtZXNzYWdlX2luZGV4Lmxhc3RfdXBkYXRlZCA9
IHRpbWUoMCk7CiAgICAgbWVzc2FnZV9pbmRleC5pbnRlcm5hbGRhdGUgPSBpbnRlcm5hbGRhdGU7
CiAgICAgbHNlZWsobWFpbGJveC0+Y2FjaGVfZmQsIDBMLCBTRUVLX0VORCk7CkluZGV4OiBpbWFw
L2N5cmR1bXAuYwo9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09ClJDUyBmaWxlOiAvYWZzL2FuZHJldy9zeXN0ZW0vY3ZzL3Ny
Yy9jeXJ1cy9pbWFwL2N5cmR1bXAuYyx2CnJldHJpZXZpbmcgcmV2aXNpb24gMS4xNC4yLjQKZGlm
ZiAtdSAtcjEuMTQuMi40IGN5cmR1bXAuYwotLS0gaW1hcC9jeXJkdW1wLmMJMjcgTWF5IDIwMDUg
MTc6NDA6MzggLTAwMDAJMS4xNC4yLjQKKysrIGltYXAvY3lyZHVtcC5jCTEzIERlYyAyMDA1IDE2
OjI3OjU3IC0wMDAwCkBAIC04NSw2ICs4NSw3IEBACiBzdHJ1Y3QgcHJvdHN0cmVhbSAqaW1hcGRf
b3V0ID0gTlVMTDsKIHN0cnVjdCBhdXRoX3N0YXRlICppbWFwZF9hdXRoc3RhdGUgPSBOVUxMOwog
Y2hhciAqaW1hcGRfdXNlcmlkID0gTlVMTDsKK2ludCBpbWFwZF9jb25kc3RvcmVfZW5hYmxlZCA9
IDA7CiAKIHN0cnVjdCBpbmNyZW1lbnRhbF9yZWNvcmQgewogICAgIGludCBpbmNydWlkOwpJbmRl
eDogaW1hcC9pbWFwZC5jCj09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT0KUkNTIGZpbGU6IC9hZnMvYW5kcmV3L3N5c3RlbS9j
dnMvc3JjL2N5cnVzL2ltYXAvaW1hcGQuYyx2CnJldHJpZXZpbmcgcmV2aXNpb24gMS40NDMuMi42
OApkaWZmIC11IC1yMS40NDMuMi42OCBpbWFwZC5jCi0tLSBpbWFwL2ltYXBkLmMJMTIgRGVjIDIw
MDUgMjE6MjM6NTkgLTAwMDAJMS40NDMuMi42OAorKysgaW1hcC9pbWFwZC5jCTEzIERlYyAyMDA1
IDE2OjI3OjU4IC0wMDAwCkBAIC0xNTEsNiArMTUxLDcgQEAKIHN0cnVjdCBhdXRoX3N0YXRlICpp
bWFwZF9hdXRoc3RhdGUgPSAwOwogc3RhdGljIGludCBpbWFwZF91c2VyaXNhZG1pbiA9IDA7CiBz
dGF0aWMgaW50IGltYXBkX3VzZXJpc3Byb3h5YWRtaW4gPSAwOworaW50IGltYXBkX2NvbmRzdG9y
ZV9lbmFibGVkID0gMDsKIHN0YXRpYyBzYXNsX2Nvbm5fdCAqaW1hcGRfc2FzbGNvbm47IC8qIHRo
ZSBzYXNsIGNvbm5lY3Rpb24gY29udGV4dCAqLwogc3RhdGljIGludCBpbWFwZF9zdGFydHRsc19k
b25lID0gMDsgLyogaGF2ZSB3ZSBkb25lIGEgc3VjY2Vzc2Z1bCBzdGFydHRscz8gKi8KICNpZmRl
ZiBIQVZFX1NTTApAQCAtMjA1LDcgKzIwNiw3IEBACiB2b2lkIGNtZF9mZXRjaChjaGFyICp0YWcs
IGNoYXIgKnNlcXVlbmNlLCBpbnQgdXNpbmd1aWQpOwogdm9pZCBjbWRfcGFydGlhbChjb25zdCBj
aGFyICp0YWcsIGNvbnN0IGNoYXIgKm1zZ25vLCBjaGFyICpkYXRhLAogCQkgY29uc3QgY2hhciAq
c3RhcnQsIGNvbnN0IGNoYXIgKmNvdW50KTsKLXZvaWQgY21kX3N0b3JlKGNoYXIgKnRhZywgY2hh
ciAqc2VxdWVuY2UsIGNoYXIgKm9wZXJhdGlvbiwgaW50IHVzaW5ndWlkKTsKK3ZvaWQgY21kX3N0
b3JlKGNoYXIgKnRhZywgY2hhciAqc2VxdWVuY2UsIGludCB1c2luZ3VpZCk7CiB2b2lkIGNtZF9z
ZWFyY2goY2hhciAqdGFnLCBpbnQgdXNpbmd1aWQpOwogdm9pZCBjbWRfc29ydChjaGFyICp0YWcs
IGludCB1c2luZ3VpZCk7CiB2b2lkIGNtZF90aHJlYWQoY2hhciAqdGFnLCBpbnQgdXNpbmd1aWQp
OwpAQCAtNTc0LDYgKzU3NSw3IEBACiAgICAgfQogICAgIGltYXBkX3VzZXJpc2FkbWluID0gMDsK
ICAgICBpbWFwZF91c2VyaXNwcm94eWFkbWluID0gMDsKKyAgICBpbWFwZF9jb25kc3RvcmVfZW5h
YmxlZCA9IDA7CiAgICAgaWYgKGltYXBkX3Nhc2xjb25uKSB7CiAJc2FzbF9kaXNwb3NlKCZpbWFw
ZF9zYXNsY29ubik7CiAJaW1hcGRfc2FzbGNvbm4gPSBOVUxMOwpAQCAtMTA3NCw4ICsxMDc2LDcg
QEAKIAkJaWYgKGMgIT0gJyAnKSBnb3RvIG1pc3NpbmdhcmdzOwogCQljID0gZ2V0YXN0cmluZyhp
bWFwZF9pbiwgaW1hcGRfb3V0LCAmYXJnMSk7CiAJCWlmIChjID09IEVPRikgZ290byBtaXNzaW5n
YXJnczsKLQkJaWYgKGMgPT0gJ1xyJykgYyA9IHByb3RfZ2V0YyhpbWFwZF9pbik7Ci0JCWlmIChj
ICE9ICdcbicpIGdvdG8gZXh0cmFhcmdzOworCQlwcm90X3VuZ2V0YyhjLCBpbWFwZF9pbik7CiAK
IAkJY21kX3NlbGVjdCh0YWcucywgY21kLnMsIGFyZzEucyk7CiAKQEAgLTEyMDQsOCArMTIwNSw3
IEBACiAJCWlmIChjICE9ICcgJykgZ290byBtaXNzaW5nYXJnczsKIAkJYyA9IGdldGFzdHJpbmco
aW1hcGRfaW4sIGltYXBkX291dCwgJmFyZzEpOwogCQlpZiAoYyA9PSBFT0YpIGdvdG8gbWlzc2lu
Z2FyZ3M7Ci0JCWlmIChjID09ICdccicpIGMgPSBwcm90X2dldGMoaW1hcGRfaW4pOwotCQlpZiAo
YyAhPSAnXG4nKSBnb3RvIGV4dHJhYXJnczsKKwkJcHJvdF91bmdldGMoYywgaW1hcGRfaW4pOwog
CiAJCWNtZF9zZWxlY3QodGFnLnMsIGNtZC5zLCBhcmcxLnMpOwogCkBAIC0xNjE4LDEwICsxNjE4
LDggQEAKIAkgICAgc3RvcmU6CiAJCWMgPSBnZXR3b3JkKGltYXBkX2luLCAmYXJnMSk7CiAJCWlm
IChjICE9ICcgJyB8fCAhaW1wYXJzZV9pc3NlcXVlbmNlKGFyZzEucykpIGdvdG8gYmFkc2VxdWVu
Y2U7Ci0JCWMgPSBnZXR3b3JkKGltYXBkX2luLCAmYXJnMik7Ci0JCWlmIChjICE9ICcgJykgZ290
byBtaXNzaW5nYXJnczsKIAotCQljbWRfc3RvcmUodGFnLnMsIGFyZzEucywgYXJnMi5zLCB1c2lu
Z3VpZCk7CisJCWNtZF9zdG9yZSh0YWcucywgYXJnMS5zLCB1c2luZ3VpZCk7CiAKIAkJc25tcF9p
bmNyZW1lbnQoU1RPUkVfQ09VTlQsIDEpOwogCSAgICB9CkBAIC0xNjI5LDggKzE2MjcsNyBAQAog
CQlpZiAoYyAhPSAnICcpIGdvdG8gbWlzc2luZ2FyZ3M7CiAJCWMgPSBnZXRhc3RyaW5nKGltYXBk
X2luLCBpbWFwZF9vdXQsICZhcmcxKTsKIAkJaWYgKGMgPT0gRU9GKSBnb3RvIG1pc3Npbmdhcmdz
OwotCQlpZiAoYyA9PSAnXHInKSBjID0gcHJvdF9nZXRjKGltYXBkX2luKTsKLQkJaWYgKGMgIT0g
J1xuJykgZ290byBleHRyYWFyZ3M7CisJCXByb3RfdW5nZXRjKGMsIGltYXBkX2luKTsKIAogCQlj
bWRfc2VsZWN0KHRhZy5zLCBjbWQucywgYXJnMS5zKTsKIApAQCAtMzE3Myw2ICszMTcwLDcgQEAK
ICAqLwogdm9pZCBjbWRfc2VsZWN0KGNoYXIgKnRhZywgY2hhciAqY21kLCBjaGFyICpuYW1lKQog
eworICAgIGludCBjOwogICAgIHN0cnVjdCBtYWlsYm94IG1haWxib3g7CiAgICAgY2hhciBtYWls
Ym94bmFtZVtNQVhfTUFJTEJPWF9OQU1FKzFdOwogICAgIGludCByID0gMDsKQEAgLTMxODQsNiAr
MzE4Miw0OCBAQAogICAgIHN0YXRpYyBjaGFyIGxhc3RxcltNQVhfTUFJTEJPWF9QQVRIKzFdID0g
IiI7CiAgICAgc3RhdGljIHRpbWVfdCBuZXh0YWxlcnQgPSAwOwogCisgICAgYyA9IHByb3RfZ2V0
YyhpbWFwZF9pbik7CisgICAgaWYgKGNtZFswXSAhPSAnQicgJiYgYyA9PSAnICcpIHsKKwlzdGF0
aWMgc3RydWN0IGJ1ZiBhcmc7CisKKwljID0gcHJvdF9nZXRjKGltYXBkX2luKTsKKwlpZiAoYyAh
PSAnKCcpIGdvdG8gYmFkbGlzdDsKKworCWMgPSBnZXR3b3JkKGltYXBkX2luLCAmYXJnKTsKKwlp
ZiAoYXJnLnNbMF0gPT0gJ1wwJykgZ290byBiYWRsaXN0OworCWZvciAoOzspIHsKKwkgICAgbGNh
c2UoYXJnLnMpOworCSAgICBpZiAoIXN0cmNtcChhcmcucywgImNvbmRzdG9yZSIpKSB7CisJCWlt
YXBkX2NvbmRzdG9yZV9lbmFibGVkID0gMTsKKwkgICAgfQorCSAgICBlbHNlIHsKKwkJcHJvdF9w
cmludGYoaW1hcGRfb3V0LCAiJXMgQkFEIEludmFsaWQgJXMgbW9kaWZpZXIgJXNcclxuIiwKKwkJ
CSAgICB0YWcsIGNtZCwgYXJnLnMpOworCQllYXRsaW5lKGltYXBkX2luLCBjKTsKKwkJcmV0dXJu
OworCSAgICB9CisJICAgIAorCSAgICBpZiAoYyA9PSAnICcpIGMgPSBnZXR3b3JkKGltYXBkX2lu
LCAmYXJnKTsKKwkgICAgZWxzZSBicmVhazsKKwl9CisKKwlpZiAoYyAhPSAnKScpIHsKKwkgICAg
cHJvdF9wcmludGYoaW1hcGRfb3V0LAorCQkJIiVzIEJBRCBNaXNzaW5nIGNsb3NlIHBhcmVudGhl
c2lzIGluICVzXHJcbiIsIHRhZywgY21kKTsKKwkgICAgZWF0bGluZShpbWFwZF9pbiwgYyk7CisJ
ICAgIHJldHVybjsKKwl9CisKKwljID0gcHJvdF9nZXRjKGltYXBkX2luKTsKKyAgICB9CisgICAg
aWYgKGMgPT0gJ1xyJykgYyA9IHByb3RfZ2V0YyhpbWFwZF9pbik7CisgICAgaWYgKGMgIT0gJ1xu
JykgeworCXByb3RfcHJpbnRmKGltYXBkX291dCwKKwkJICAgICIlcyBCQUQgVW5leHBlY3RlZCBl
eHRyYSBhcmd1bWVudHMgdG8gJXNcclxuIiwgdGFnLCBjbWQpOworCWVhdGxpbmUoaW1hcGRfaW4s
IGMpOworCXJldHVybjsKKyAgICB9CisKICAgICBpZiAoaW1hcGRfbWFpbGJveCkgewogCWluZGV4
X2Nsb3NlbWFpbGJveChpbWFwZF9tYWlsYm94KTsKIAltYWlsYm94X2Nsb3NlKGltYXBkX21haWxi
b3gpOwpAQCAtMzM0NSw2ICszMzg1LDExIEBACiAKICAgICBwcm9jX3JlZ2lzdGVyKCJpbWFwZCIs
IGltYXBkX2NsaWVudGhvc3QsIGltYXBkX3VzZXJpZCwgbWFpbGJveG5hbWUpOwogICAgIHN5c2xv
ZyhMT0dfREVCVUcsICJvcGVuOiB1c2VyICVzIG9wZW5lZCAlcyIsIGltYXBkX3VzZXJpZCwgbmFt
ZSk7CisgICAgcmV0dXJuOworCisgYmFkbGlzdDoKKyAgICBwcm90X3ByaW50ZihpbWFwZF9vdXQs
ICIlcyBCQUQgSW52YWxpZCBtb2RpZmllciBsaXN0IGluICVzXHJcbiIsIHRhZywgY21kKTsKKyAg
ICBlYXRsaW5lKGltYXBkX2luLCBjKTsKIH0KIAkgIAogLyoKQEAgLTM2OTksNiArMzc0NCwxMiBA
QAogCSAgICBlbHNlIGdvdG8gYmFkYXR0OwogCSAgICBicmVhazsKIAorCWNhc2UgJ00nOgorCSAg
ICBpZiAoIXN0cmNtcChmZXRjaGF0dC5zLCAiTU9EU0VRIikpIHsKKwkJZmV0Y2hpdGVtcyB8PSBG
RVRDSF9NT0RTRVE7CisJICAgIH0KKwkgICAgZWxzZSBnb3RvIGJhZGF0dDsKKwkgICAgYnJlYWs7
CiAJY2FzZSAnUic6CiAJICAgIGlmICghc3RyY21wKGZldGNoYXR0LnMsICJSRkM4MjIiKSkgewog
CQlmZXRjaGl0ZW1zIHw9IEZFVENIX1JGQzgyMnxGRVRDSF9TRVRTRUVOOwpAQCAtMzc5Miw5ICsz
ODQzLDU1IEBACiAgICAgaWYgKGlubGlzdCAmJiBjID09ICcpJykgewogCWlubGlzdCA9IDA7CiAJ
YyA9IHByb3RfZ2V0YyhpbWFwZF9pbik7CisJaWYgKGMgPT0gJyAnKSB7CisJICAgIC8qIEdyYWIv
cGFyc2UgdGhlIG1vZGlmaWVyKHMpICovCisJICAgIGMgPSBwcm90X2dldGMoaW1hcGRfaW4pOwor
CSAgICBpZiAoYyAhPSAnKCcpIHsKKwkJcHJvdF9wcmludGYoaW1hcGRfb3V0LAorCQkJICAgICIl
cyBCQUQgTWlzc2luZyByZXF1aXJlZCBvcGVuIHBhcmVudGhlc2lzIGluICVzIG1vZGlmaWVyc1xy
XG4iLAorCQkJICAgIHRhZywgY21kKTsKKwkJZWF0bGluZShpbWFwZF9pbiwgYyk7CisJCWdvdG8g
ZnJlZWFyZ3M7CisJICAgIH0KKwkgICAgaW5saXN0ID0gMTsKKwkgICAgZG8geworCQljID0gZ2V0
d29yZChpbWFwZF9pbiwgJmZldGNoYXR0KTsKKwkJdWNhc2UoZmV0Y2hhdHQucyk7CisJCWlmICgh
c3RyY21wKGZldGNoYXR0LnMsICJDSEFOR0VEU0lOQ0UiKSkgeworCQkgICAgaWYgKGMgIT0gJyAn
KSB7CisJCQlwcm90X3ByaW50ZihpbWFwZF9vdXQsCisJCQkJICAgICIlcyBCQUQgTWlzc2luZyBy
ZXF1aXJlZCBhcmd1bWVudCB0byAlcyAlc1xyXG4iLAorCQkJCSAgICB0YWcsIGNtZCwgZmV0Y2hh
dHQucyk7CisJCQllYXRsaW5lKGltYXBkX2luLCBjKTsKKwkJCWdvdG8gZnJlZWFyZ3M7CisJCSAg
ICB9CisJCSAgICBjID0gZ2V0YXN0cmluZyhpbWFwZF9pbiwgaW1hcGRfb3V0LCAmZmllbGRuYW1l
KTsKKwkJICAgIGZldGNoYXJncy5jaGFuZ2Vkc2luY2UgPSBzdHJ0b3VsKGZpZWxkbmFtZS5zLCAm
cCwgMTApOworCQkgICAgaWYgKCpwIHx8IGZldGNoYXJncy5jaGFuZ2Vkc2luY2UgPT0gVUxPTkdf
TUFYKSB7CisJCQlwcm90X3ByaW50ZihpbWFwZF9vdXQsCisJCQkJICAgICIlcyBCQUQgSW52YWxp
ZCBhcmd1bWVudCB0byAlcyAlc1xyXG4iLAorCQkJCSAgICB0YWcsIGNtZCwgZmV0Y2hhdHQucyk7
CisJCQllYXRsaW5lKGltYXBkX2luLCBjKTsKKwkJCWdvdG8gZnJlZWFyZ3M7CisJCSAgICB9CisJ
CSAgICBmZXRjaGl0ZW1zIHw9IEZFVENIX01PRFNFUTsKKwkJfQorCQllbHNlIHsKKwkJICAgIHBy
b3RfcHJpbnRmKGltYXBkX291dCwgIiVzIEJBRCBJbnZhbGlkICVzIG1vZGlmaWVyICVzXHJcbiIs
CisJCQkJdGFnLCBjbWQsIGZldGNoYXR0LnMpOworCQkgICAgZWF0bGluZShpbWFwZF9pbiwgYyk7
CisJCSAgICBnb3RvIGZyZWVhcmdzOworCQl9CisJICAgIH0gd2hpbGUgKGMgPT0gJyAnKTsKKwkg
ICAgaWYgKGMgPT0gJyknKSB7CisJCWlubGlzdCA9IDA7CisJCWMgPSBwcm90X2dldGMoaW1hcGRf
aW4pOworCSAgICB9CisJfQogICAgIH0KICAgICBpZiAoaW5saXN0KSB7Ci0JcHJvdF9wcmludGYo
aW1hcGRfb3V0LCAiJXMgQkFEIE1pc3NpbmcgY2xvc2UgcGFyZW50aGVzaXMgaW4gJXNcclxuIiwg
dGFnLCBjbWQpOworCXByb3RfcHJpbnRmKGltYXBkX291dCwgIiVzIEJBRCBNaXNzaW5nIGNsb3Nl
IHBhcmVudGhlc2lzIGluICVzXHJcbiIsCisJCSAgICB0YWcsIGNtZCk7CiAJZWF0bGluZShpbWFw
ZF9pbiwgYyk7CiAJZ290byBmcmVlYXJnczsKICAgICB9CkBAIC0zODEyLDYgKzM5MDksMTIgQEAK
IAlnb3RvIGZyZWVhcmdzOwogICAgIH0KIAorICAgIGlmIChmZXRjaGl0ZW1zICYgRkVUQ0hfTU9E
U0VRKSB7CisJaWYgKCFpbWFwZF9jb25kc3RvcmVfZW5hYmxlZCsrKQorCSAgICBwcm90X3ByaW50
ZihpbWFwZF9vdXQsICIqIE9LIFtISUdIRVNUTU9EU0VRICIgTU9EU0VRX0ZNVCAiXSAgXHJcbiIs
CisJCQlpbWFwZF9tYWlsYm94LT5oaWdoZXN0bW9kc2VxKTsKKyAgICB9CisKICAgICBpZiAodXNp
bmd1aWQgfHwgY29uZmlnX2dldHN3aXRjaChJTUFQT1BUX0ZMVVNIU0VFTlNUQVRFKSkgewogCWlm
ICh1c2luZ3VpZCkgZmV0Y2hpdGVtcyB8PSBGRVRDSF9VSUQ7IAogCWluZGV4X2NoZWNrKGltYXBk
X21haWxib3gsIHVzaW5ndWlkLCAvKiB1cGRhdGUgXFNlZW4gc3RhdGUgZnJvbSBkaXNrPyAqLwpA
QCAtMzk4MSwxMyArNDA4NCwxMyBAQAogLyoKICAqIFBhcnNlIGFuZCBwZXJmb3JtIGEgU1RPUkUv
VUlEIFNUT1JFIGNvbW1hbmQKICAqIFRoZSBjb21tYW5kIGhhcyBiZWVuIHBhcnNlZCB1cCB0byBh
bmQgaW5jbHVkaW5nCi0gKiB0aGUgRkxBR1MvK0ZMQUdTLy1GTEFHUworICogdGhlIHNlcXVlbmNl
CiAgKi8KLXZvaWQgY21kX3N0b3JlKGNoYXIgKnRhZywgY2hhciAqc2VxdWVuY2UsIGNoYXIgKm9w
ZXJhdGlvbiwgaW50IHVzaW5ndWlkKQordm9pZCBjbWRfc3RvcmUoY2hhciAqdGFnLCBjaGFyICpz
ZXF1ZW5jZSwgaW50IHVzaW5ndWlkKQogewogICAgIGNvbnN0IGNoYXIgKmNtZCA9IHVzaW5ndWlk
ID8gIlVJRCBTdG9yZSIgOiAiU3RvcmUiOwogICAgIHN0cnVjdCBzdG9yZWFyZ3Mgc3RvcmVhcmdz
OwotICAgIHN0YXRpYyBzdHJ1Y3QgYnVmIGZsYWduYW1lOworICAgIHN0YXRpYyBzdHJ1Y3QgYnVm
IG9wZXJhdGlvbiwgZmxhZ25hbWU7CiAgICAgaW50IGxlbiwgYzsKICAgICBjaGFyICoqZmxhZyA9
IDA7CiAgICAgaW50IG5mbGFncyA9IDAsIGZsYWdhbGxvYyA9IDA7CkBAIC00MDA0LDIyICs0MTA3
LDgzIEBACiAKICAgICAvKiBsb2NhbCBtYWlsYm94ICovCiAgICAgbWVtc2V0KCZzdG9yZWFyZ3Ms
IDAsIHNpemVvZiBzdG9yZWFyZ3MpOworICAgIHN0b3JlYXJncy51bmNoYW5nZWRzaW5jZSA9IFVM
T05HX01BWDsKKworICAgIGMgPSBwcm90X2dldGMoaW1hcGRfaW4pOworICAgIGlmIChjID09ICco
JykgeworCS8qIEdyYWIvcGFyc2UgdGhlIG1vZGlmaWVyKHMpICovCisJc3RhdGljIHN0cnVjdCBi
dWYgc3RvcmVtb2QsIG1vZHZhbHVlOworCWNoYXIgKnA7CisKKwlkbyB7CisJICAgIGMgPSBnZXR3
b3JkKGltYXBkX2luLCAmc3RvcmVtb2QpOworCSAgICBsY2FzZShzdG9yZW1vZC5zKTsKKwkgICAg
aWYgKCFzdHJjbXAoc3RvcmVtb2QucywgInVuY2hhbmdlZHNpbmNlIikpIHsKKwkJaWYgKGMgIT0g
JyAnKSB7CisJCSAgICBwcm90X3ByaW50ZihpbWFwZF9vdXQsCisJCQkJIiVzIEJBRCBNaXNzaW5n
IHJlcXVpcmVkIGFyZ3VtZW50IHRvICVzICVzXHJcbiIsCisJCQkJdGFnLCBjbWQsIHN0b3JlbW9k
LnMpOworCQkgICAgZWF0bGluZShpbWFwZF9pbiwgYyk7CisJCSAgICByZXR1cm47CisJCX0KKwkJ
YyA9IGdldGFzdHJpbmcoaW1hcGRfaW4sIGltYXBkX291dCwgJm1vZHZhbHVlKTsKKwkJc3RvcmVh
cmdzLnVuY2hhbmdlZHNpbmNlID0gc3RydG91bChtb2R2YWx1ZS5zLCAmcCwgMTApOworCQlpZiAo
KnAgfHwgc3RvcmVhcmdzLnVuY2hhbmdlZHNpbmNlID09IFVMT05HX01BWCkgeworCQkgICAgcHJv
dF9wcmludGYoaW1hcGRfb3V0LAorCQkJCSIlcyBCQUQgSW52YWxpZCBhcmd1bWVudCB0byAlcyAl
c1xyXG4iLAorCQkJCXRhZywgY21kLCBzdG9yZW1vZC5zKTsKKwkJICAgIGVhdGxpbmUoaW1hcGRf
aW4sIGMpOworCQkgICAgcmV0dXJuOworCQl9CisJICAgIH0KKwkgICAgZWxzZSB7CisJCXByb3Rf
cHJpbnRmKGltYXBkX291dCwgIiVzIEJBRCBJbnZhbGlkICVzIG1vZGlmaWVyICVzXHJcbiIsCisJ
CQkgICAgdGFnLCBjbWQsIHN0b3JlbW9kLnMpOworCQllYXRsaW5lKGltYXBkX2luLCBjKTsKKwkJ
cmV0dXJuOworCSAgICB9CisJfSB3aGlsZSAoYyA9PSAnICcpOworCWlmIChjICE9ICcpJykgewor
CSAgICBwcm90X3ByaW50ZihpbWFwZF9vdXQsCisJCQkiJXMgQkFEIE1pc3NpbmcgY2xvc2UgcGFy
ZW4gaW4gc3RvcmUgbW9kaWZpZXIgZW50cnkgXHJcbiIsCisJCQl0YWcpOworCSAgICBlYXRsaW5l
KGltYXBkX2luLCBjKTsKKwkgICAgcmV0dXJuOworCX0KKwljID0gcHJvdF9nZXRjKGltYXBkX2lu
KTsKKwlpZiAoYyAhPSAnICcpIHsKKwkgICAgcHJvdF9wcmludGYoaW1hcGRfb3V0LAorCQkJIiVz
IEJBRCBNaXNzaW5nIHJlcXVpcmVkIGFyZ3VtZW50IHRvICVzXHJcbiIsCisJCQl0YWcsIGNtZCk7
CisJICAgIGVhdGxpbmUoaW1hcGRfaW4sIGMpOworCSAgICByZXR1cm47CisJfQorICAgIH0KKyAg
ICBlbHNlCisJcHJvdF91bmdldGMoYywgaW1hcGRfaW4pOwogCi0gICAgbGNhc2Uob3BlcmF0aW9u
KTsKKyAgICBjID0gZ2V0d29yZChpbWFwZF9pbiwgJm9wZXJhdGlvbik7CisgICAgaWYgKGMgIT0g
JyAnKSB7CisJcHJvdF9wcmludGYoaW1hcGRfb3V0LAorCQkgICAgIiVzIEJBRCBNaXNzaW5nIHJl
cXVpcmVkIGFyZ3VtZW50IHRvICVzXHJcbiIsIHRhZywgY21kKTsKKwllYXRsaW5lKGltYXBkX2lu
LCBjKTsKKwlyZXR1cm47CisgICAgfQorICAgIGxjYXNlKG9wZXJhdGlvbi5zKTsKIAotICAgIGxl
biA9IHN0cmxlbihvcGVyYXRpb24pOwotICAgIGlmIChsZW4gPiA3ICYmICFzdHJjbXAob3BlcmF0
aW9uK2xlbi03LCAiLnNpbGVudCIpKSB7CisgICAgbGVuID0gc3RybGVuKG9wZXJhdGlvbi5zKTsK
KyAgICBpZiAobGVuID4gNyAmJiAhc3RyY21wKG9wZXJhdGlvbi5zK2xlbi03LCAiLnNpbGVudCIp
KSB7CiAJc3RvcmVhcmdzLnNpbGVudCA9IDE7Ci0Jb3BlcmF0aW9uW2xlbi03XSA9ICdcMCc7CisJ
b3BlcmF0aW9uLnNbbGVuLTddID0gJ1wwJzsKICAgICB9CiAgICAgCi0gICAgaWYgKCFzdHJjbXAo
b3BlcmF0aW9uLCAiK2ZsYWdzIikpIHsKKyAgICBpZiAoIXN0cmNtcChvcGVyYXRpb24ucywgIitm
bGFncyIpKSB7CiAJc3RvcmVhcmdzLm9wZXJhdGlvbiA9IFNUT1JFX0FERDsKICAgICB9Ci0gICAg
ZWxzZSBpZiAoIXN0cmNtcChvcGVyYXRpb24sICItZmxhZ3MiKSkgeworICAgIGVsc2UgaWYgKCFz
dHJjbXAob3BlcmF0aW9uLnMsICItZmxhZ3MiKSkgewogCXN0b3JlYXJncy5vcGVyYXRpb24gPSBT
VE9SRV9SRU1PVkU7CiAgICAgfQotICAgIGVsc2UgaWYgKCFzdHJjbXAob3BlcmF0aW9uLCAiZmxh
Z3MiKSkgeworICAgIGVsc2UgaWYgKCFzdHJjbXAob3BlcmF0aW9uLnMsICJmbGFncyIpKSB7CiAJ
c3RvcmVhcmdzLm9wZXJhdGlvbiA9IFNUT1JFX1JFUExBQ0U7CiAgICAgfQogICAgIGVsc2UgewpA
QCAtNDEwMiw2ICs0MjY2LDExIEBACiAJZ290byBmcmVlZmxhZ3M7CiAgICAgfQogCisgICAgaWYg
KChzdG9yZWFyZ3MudW5jaGFuZ2Vkc2luY2UgIT0gVUxPTkdfTUFYKSAmJiAhaW1hcGRfY29uZHN0
b3JlX2VuYWJsZWQrKykgeworCXByb3RfcHJpbnRmKGltYXBkX291dCwgIiogT0sgW0hJR0hFU1RN
T0RTRVEgIiBNT0RTRVFfRk1UICJdICBcclxuIiwKKwkJICAgIGltYXBkX21haWxib3gtPmhpZ2hl
c3Rtb2RzZXEpOworICAgIH0KKwogICAgIHIgPSBpbmRleF9zdG9yZShpbWFwZF9tYWlsYm94LCBz
ZXF1ZW5jZSwgdXNpbmd1aWQsICZzdG9yZWFyZ3MsCiAJCSAgICBmbGFnLCBuZmxhZ3MpOwogCkBA
IC02NDUwLDYgKzY2MTksOSBAQAogCWVsc2UgaWYgKCFzdHJjbXAoYXJnLnMsICJ1bnNlZW4iKSkg
ewogCSAgICBzdGF0dXNpdGVtcyB8PSBTVEFUVVNfVU5TRUVOOwogCX0KKwllbHNlIGlmICghc3Ry
Y21wKGFyZy5zLCAiaGlnaGVzdG1vZHNlcSIpKSB7CisJICAgIHN0YXR1c2l0ZW1zIHw9IFNUQVRV
U19ISUdIRVNUTU9EU0VROworCX0KIAllbHNlIHsKIAkgICAgcHJvdF9wcmludGYoaW1hcGRfb3V0
LCAiJXMgQkFEIEludmFsaWQgU3RhdHVzIGF0dHJpYnV0ZSAlc1xyXG4iLAogCQkJdGFnLCBhcmcu
cyk7CkBAIC03MjI3LDYgKzczOTksMTggQEAKIAllbHNlIGdvdG8gYmFkY3JpOwogCWJyZWFrOwog
CisgICAgY2FzZSAnbSc6CisJaWYgKCFzdHJjbXAoY3JpdGVyaWEucywgIm1vZHNlcSIpKSB7CisJ
ICAgIGlmIChjICE9ICcgJykgZ290byBtaXNzaW5nYXJnOwkJCisJICAgIGMgPSBnZXR3b3JkKGlt
YXBkX2luLCAmYXJnKTsKKwkgICAgZm9yIChwID0gYXJnLnM7ICpwICYmIGlzZGlnaXQoKGludCkg
KnApOyBwKyspIHsKKwkJc2VhcmNoYXJncy0+bW9kc2VxID0gc2VhcmNoYXJncy0+bW9kc2VxICog
MTAgKyAqcCAtICcwJzsKKwkgICAgfQorCSAgICBpZiAoIWFyZy5zIHx8ICpwKSBnb3RvIGJhZG51
bWJlcjsKKwl9CisJZWxzZSBnb3RvIGJhZGNyaTsKKwlicmVhazsKKwogICAgIGNhc2UgJ24nOgog
CWlmICghc3RyY21wKGNyaXRlcmlhLnMsICJub3QiKSkgewogCSAgICBpZiAoYyAhPSAnICcpIGdv
dG8gbWlzc2luZ2FyZzsJCQpAQCAtODM5Myw2ICs4NTc3LDggQEAKIAkgICAgKCpzb3J0Y3JpdClb
bl0uYXJncy5hbm5vdC5hdHRyaWIgPSB4c3RyZHVwKGFyZy5zKTsKIAl9CiAjZW5kaWYKKwllbHNl
IGlmICghc3RyY21wKGNyaXRlcmlhLnMsICJtb2RzZXEiKSkKKwkgICAgKCpzb3J0Y3JpdClbbl0u
a2V5ID0gU09SVF9NT0RTRVE7CiAJZWxzZSB7CiAJICAgIHByb3RfcHJpbnRmKGltYXBkX291dCwg
IiVzIEJBRCBJbnZhbGlkIFNvcnQgY3JpdGVyaW9uICVzXHJcbiIsCiAJCQl0YWcsIGNyaXRlcmlh
LnMpOwpJbmRleDogaW1hcC9pbWFwZC5oCj09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KUkNTIGZpbGU6IC9hZnMvYW5kcmV3
L3N5c3RlbS9jdnMvc3JjL2N5cnVzL2ltYXAvaW1hcGQuaCx2CnJldHJpZXZpbmcgcmV2aXNpb24g
MS41NS4yLjMKZGlmZiAtdSAtcjEuNTUuMi4zIGltYXBkLmgKLS0tIGltYXAvaW1hcGQuaAkyIEp1
biAyMDA1IDE2OjE2OjEzIC0wMDAwCTEuNTUuMi4zCisrKyBpbWFwL2ltYXBkLmgJMTMgRGVjIDIw
MDUgMTY6Mjc6NTggLTAwMDAKQEAgLTU4LDYgKzU4LDkgQEAKIC8qIE51bWJlciBvZiBtZXNzYWdl
cyBpbiBjdXJyZW50bHkgb3BlbiBtYWlsYm94ICovCiBleHRlcm4gaW50IGltYXBkX2V4aXN0czsK
IAorLyogSXMgY29uZHN0b3JlIGVuYWJsZWQ/ICovCitleHRlcm4gaW50IGltYXBkX2NvbmRzdG9y
ZV9lbmFibGVkOworCiAvKiBMaXN0IG9mIEhFQURFUi5GSUVMRFNbLk5PVF0gZmV0Y2ggc3BlY2lm
aWNhdGlvbnMgKi8KIHN0cnVjdCBmaWVsZGxpc3QgewogICAgIGNoYXIgKnNlY3Rpb247CQkvKiBG
aXJzdCBwYXJ0IG9mIEJPRFlbeF0gdmFsdWUgKi8KQEAgLTY5LDE1ICs3MiwxNiBAQAogCiAvKiBJ
dGVtcyB0aGF0IG1heSBiZSBmZXRjaGVkICovCiBzdHJ1Y3QgZmV0Y2hhcmdzIHsKLSAgICBpbnQg
ZmV0Y2hpdGVtczsJCS8qIEJpdG1hc2sgKi8KLSAgICBzdHJ1Y3Qgc3RybGlzdCAqYmluc2VjdGlv
bnM7IC8qIEJJTkFSWVt4XTx4PiB2YWx1ZXMgKi8KKyAgICBpbnQgZmV0Y2hpdGVtczsJCSAgLyog
Qml0bWFzayAqLworICAgIHN0cnVjdCBzdHJsaXN0ICpiaW5zZWN0aW9uczsgIC8qIEJJTkFSWVt4
XTx4PiB2YWx1ZXMgKi8KICAgICBzdHJ1Y3Qgc3RybGlzdCAqc2l6ZXNlY3Rpb25zOyAvKiBCSU5B
UlkuU0laRVt4XSB2YWx1ZXMgKi8KICAgICBzdHJ1Y3Qgc3RybGlzdCAqYm9keXNlY3Rpb25zOyAv
KiBCT0RZW3hdPHg+IHZhbHVlcyAqLwogICAgIHN0cnVjdCBmaWVsZGxpc3QgKmZzZWN0aW9uczsg
IC8qIEJPRFlbeEhFQURFUi5GSUVMRFN4XTx4PiB2YWx1ZXMgKi8KLSAgICBzdHJ1Y3Qgc3RybGlz
dCAqaGVhZGVyczsJLyogUkZDODIyLkhFQURFUi5MSU5FUyAqLwotICAgIHN0cnVjdCBzdHJsaXN0
ICpoZWFkZXJzX25vdDsgLyogUkZDODIyLkhFQURFUi5MSU5FUy5OT1QgKi8KLSAgICBpbnQgc3Rh
cnRfb2N0ZXQ7ICAgICAgICAgICAvKiBzdGFydF9vY3RldCBmb3IgcGFydGlhbCBmZXRjaCAqLwot
ICAgIGludCBvY3RldF9jb3VudDsgICAgICAgICAgIC8qIG9jdGV0X2NvdW50IGZvciBwYXJ0aWFs
IGZldGNoLCBvciAwICovCisgICAgc3RydWN0IHN0cmxpc3QgKmhlYWRlcnM7CSAgLyogUkZDODIy
LkhFQURFUi5MSU5FUyAqLworICAgIHN0cnVjdCBzdHJsaXN0ICpoZWFkZXJzX25vdDsgIC8qIFJG
QzgyMi5IRUFERVIuTElORVMuTk9UICovCisgICAgaW50IHN0YXJ0X29jdGV0OyAgICAgICAgICAg
ICAgLyogc3RhcnRfb2N0ZXQgZm9yIHBhcnRpYWwgZmV0Y2ggKi8KKyAgICBpbnQgb2N0ZXRfY291
bnQ7ICAgICAgICAgICAgICAvKiBvY3RldF9jb3VudCBmb3IgcGFydGlhbCBmZXRjaCwgb3IgMCAq
LworICAgIG1vZHNlcV90IGNoYW5nZWRzaW5jZTsgICAgICAgIC8qIGNoYW5nZWQgc2luY2UgbW9k
c2VxLCBvciAwICovCiAKICAgICBiaXQzMiBjYWNoZV9hdGxlYXN0OyAgICAgICAgICAvKiB0byBk
byBoZWFkZXJzIHdlIG5lZWQgYXRsZWFzdCB0aGlzCiAJCQkJICAgKiBjYWNoZSB2ZXJzaW9uICov
CkBAIC0xMDMsNyArMTA3LDggQEAKICAgICBGRVRDSF9SRkM4MjIgPSAgICAgICAgICAgICAgKDE8
PDkpLAogICAgIEZFVENIX1NFVFNFRU4gPSAgICAgICAgICAgICAoMTw8MTApLAogLyogICAgIEZF
VENIX1VOQ0FDSEVESEVBREVSID0gICAgICAoMTw8MTEpIC0tIG9ic29sZXRlICovCi0gICAgRkVU
Q0hfSVNfUEFSVElBTCA9ICAgICAgICAgICgxPDwxMikgLyogdGhpcyBpcyB0aGUgUEFSVElBTCBj
b21tYW5kICovCisgICAgRkVUQ0hfSVNfUEFSVElBTCA9ICAgICAgICAgICgxPDwxMiksIC8qIHRo
aXMgaXMgdGhlIFBBUlRJQUwgY29tbWFuZCAqLworICAgIEZFVENIX01PRFNFUSA9CQkoMTw8MTMp
CiB9OwogCiBlbnVtIHsKQEAgLTExNSw2ICsxMjAsNyBAQAogLyogQXJndW1lbnRzIHRvIFN0b3Jl
IGZ1bmN0aW9ucyAqLwogc3RydWN0IHN0b3JlYXJncyB7CiAgICAgaW50IG9wZXJhdGlvbjsKKyAg
ICBtb2RzZXFfdCB1bmNoYW5nZWRzaW5jZTsgLyogdW5jaGFuZ2VkIHNpbmNlIG1vZHNlcSwgb3Ig
VUxMT05HX01BWCAqLwogICAgIGludCBzaWxlbnQ7CiAgICAgaW50IHNlZW47CiAgICAgYml0MzIg
c3lzdGVtX2ZsYWdzOwpAQCAtMTc0LDYgKzE4MCw3IEBACiAgICAgc3RydWN0IHN0cmxpc3QgKnRl
eHQ7CiAgICAgc3RydWN0IHN0cmxpc3QgKmhlYWRlcl9uYW1lLCAqaGVhZGVyOwogICAgIHN0cnVj
dCBzZWFyY2hzdWIgKnN1Ymxpc3Q7CisgICAgbW9kc2VxX3QgbW9kc2VxOwogCiAgICAgYml0MzIg
Y2FjaGVfYXRsZWFzdDsKIH07CkBAIC0yMDAsNyArMjA3LDggQEAKICAgICBTT1JUX1NJWkUsCiAg
ICAgU09SVF9TVUJKRUNULAogICAgIFNPUlRfVE8sCi0gICAgU09SVF9BTk5PVEFUSU9OCisgICAg
U09SVF9BTk5PVEFUSU9OLAorICAgIFNPUlRfTU9EU0VRCiAgICAgLyogdmFsdWVzID4gMjU1IGFy
ZSByZXNlcnZlZCBmb3IgaW50ZXJuYWwgdXNlICovCiB9OwogCkBAIC0yMTMsNyArMjIxLDggQEAK
ICAgICBTVEFUVVNfUkVDRU5UID0JCSgxPDwxKSwKICAgICBTVEFUVVNfVUlETkVYVCA9CQkoMTw8
MiksCiAgICAgU1RBVFVTX1VJRFZBTElESVRZID0JKDE8PDMpLAotICAgIFNUQVRVU19VTlNFRU4g
PQkJKDE8PDQpCisgICAgU1RBVFVTX1VOU0VFTiA9CQkoMTw8NCksCisgICAgU1RBVFVTX0hJR0hF
U1RNT0RTRVEgPQkoMTw8NSkKIH07CiAKIC8qIEJpdG1hc2sgZm9yIGxpc3Qgb3B0aW9ucyAqLwpJ
bmRleDogaW1hcC9pbmRleC5jCj09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KUkNTIGZpbGU6IC9hZnMvYW5kcmV3L3N5c3Rl
bS9jdnMvc3JjL2N5cnVzL2ltYXAvaW5kZXguYyx2CnJldHJpZXZpbmcgcmV2aXNpb24gMS4xOTku
Mi4yNApkaWZmIC11IC1yMS4xOTkuMi4yNCBpbmRleC5jCi0tLSBpbWFwL2luZGV4LmMJMTcgTm92
IDIwMDUgMTU6NDY6MjUgLTAwMDAJMS4xOTkuMi4yNAorKysgaW1hcC9pbmRleC5jCTEzIERlYyAy
MDA1IDE2OjI3OjU4IC0wMDAwCkBAIC0xNjEsNyArMTYxLDggQEAKIAkJCQkgICBjb21wX3BhdCAq
cGF0KTsKIHN0YXRpYyBpbmRleF9zZXF1ZW5jZXByb2NfdCBpbmRleF9jb3B5c2V0dXA7CiBzdGF0
aWMgaW50IF9pbmRleF9zZWFyY2godW5zaWduZWQgKiptc2dub19saXN0LCBzdHJ1Y3QgbWFpbGJv
eCAqbWFpbGJveCwKLQkJCSBzdHJ1Y3Qgc2VhcmNoYXJncyAqc2VhcmNoYXJncyk7CisJCQkgc3Ry
dWN0IHNlYXJjaGFyZ3MgKnNlYXJjaGFyZ3MsCisJCQkgbW9kc2VxX3QgKmhpZ2hlc3Rtb2RzZXEp
OwogCiBzdGF0aWMgdm9pZCBwYXJzZV9jYWNoZWRfZW52ZWxvcGUoY2hhciAqZW52LCBjaGFyICp0
b2tlbnNbXSwgaW50IHRva2Vuc19zaXplKTsKIHN0YXRpYyBjaGFyICpmaW5kX21zZ2lkKGNoYXIg
KnN0ciwgY2hhciAqKnJlbSk7CkBAIC00MzEsNiArNDMyLDggQEAKIAkJICAgIG1haWxib3gtPnVp
ZHZhbGlkaXR5KTsKIAlwcm90X3ByaW50ZihpbWFwZF9vdXQsICIqIE9LIFtVSURORVhUICVsdV0g
IFxyXG4iLAogCQkgICAgbWFpbGJveC0+bGFzdF91aWQgKyAxKTsKKwlwcm90X3ByaW50ZihpbWFw
ZF9vdXQsICIqIE9LIFtISUdIRVNUTU9EU0VRICIgTU9EU0VRX0ZNVCAiXSAgXHJcbiIsCisJCSAg
ICBtYWlsYm94LT5oaWdoZXN0bW9kc2VxKTsKICAgICB9CiAKICAgICBmb3IgKG1zZ25vID0gMTsg
bXNnbm8gPD0gb2xkZXhpc3RzOyBtc2dubysrKSB7CkBAIC00NDAsNiArNDQzLDkgQEAKIAkgICAg
fQogCSAgICBpbmRleF9mZXRjaGZsYWdzKG1haWxib3gsIG1zZ25vLCBTWVNURU1fRkxBR1MobXNn
bm8pLCB1c2VyX2ZsYWdzLAogCQkJICAgICBMQVNUX1VQREFURUQobXNnbm8pKTsKKwkgICAgaWYg
KGltYXBkX2NvbmRzdG9yZV9lbmFibGVkKSB7CisJCXByb3RfcHJpbnRmKGltYXBkX291dCwgIiBN
T0RTRVEgKCIgTU9EU0VRX0ZNVCAiKSIsIE1PRFNFUShtc2dubykpOworCSAgICB9CiAJICAgIGlm
ICh1c2luZ3VpZCkgcHJvdF9wcmludGYoaW1hcGRfb3V0LCAiIFVJRCAldSIsIFVJRChtc2dubykp
OwogCSAgICBwcm90X3ByaW50ZihpbWFwZF9vdXQsICIpXHJcbiIpOwogCX0KQEAgLTkzOSw2ICs5
NDUsOCBAQAogICAgIC8qIG5vdGUgdGhhdCBpbmRleF9mb3JzZXF1ZW5jZSgpIGRvZXNuJ3Qgc3lu
YyB0aGUgaW5kZXggZmlsZTsKICAgICAgICB0aGF0J3MgZG9uZSBiZWxvdyBpbiBtYWlsYm94X3dy
aXRlX2luZGV4X2hlYWRlcigpICovCiAgICAgaWYgKG1haWxib3gtPmRpcnR5KSB7CisJLyogYnVt
cCBISUdIRVNUTU9EU0VRICovCisJbWFpbGJveC0+aGlnaGVzdG1vZHNlcSsrOwogCS8qIHh4eCB3
aGF0IHRvIGRvIG9uIGZhaWx1cmU/ICovCiAJbWFpbGJveF93cml0ZV9pbmRleF9oZWFkZXIobWFp
bGJveCk7CiAJbWFpbGJveC0+ZGlydHkgPSAwOwpAQCAtOTYxLDExICs5NjksOSBAQAogICogUmV0
dXJucyBtZXNzYWdlIG51bWJlcnMgaW4gYW4gYXJyYXkuICBUaGlzIGZ1bmN0aW9uIGlzIHVzZWQg
YnkKICAqIFNFQVJDSCwgU09SVCBhbmQgVEhSRUFELgogICovCi1zdGF0aWMgaW50Ci1faW5kZXhf
c2VhcmNoKG1zZ25vX2xpc3QsIG1haWxib3gsIHNlYXJjaGFyZ3MpCi11bnNpZ25lZCAqKm1zZ25v
X2xpc3Q7Ci1zdHJ1Y3QgbWFpbGJveCAqbWFpbGJveDsKLXN0cnVjdCBzZWFyY2hhcmdzICpzZWFy
Y2hhcmdzOworc3RhdGljIGludCBfaW5kZXhfc2VhcmNoKHVuc2lnbmVkICoqbXNnbm9fbGlzdCwg
c3RydWN0IG1haWxib3ggKm1haWxib3gsCisJCQkgc3RydWN0IHNlYXJjaGFyZ3MgKnNlYXJjaGFy
Z3MsCisJCQkgbW9kc2VxX3QgKmhpZ2hlc3Rtb2RzZXEpCiB7CiAgICAgdW5zaWduZWQgbXNnbm87
CiAgICAgc3RydWN0IG1hcGZpbGUgbXNnZmlsZTsKQEAgLTk5MSw2ICs5OTcsOSBAQAogCiAJaWYg
KGluZGV4X3NlYXJjaF9ldmFsdWF0ZShtYWlsYm94LCBzZWFyY2hhcmdzLCBtc2dubywgJm1zZ2Zp
bGUpKSB7CiAJICAgICgqbXNnbm9fbGlzdClbbisrXSA9IG1zZ25vOworCSAgICBpZiAoaGlnaGVz
dG1vZHNlcSAmJiAoTU9EU0VRKG1zZ25vKSA+ICpoaWdoZXN0bW9kc2VxKSkgeworCQkqaGlnaGVz
dG1vZHNlcSA9IE1PRFNFUShtc2dubyk7CisJICAgIH0KIAl9CiAJaWYgKG1zZ2ZpbGUuYmFzZSkg
ewogCSAgICBtYWlsYm94X3VubWFwX21lc3NhZ2UobWFpbGJveCwgVUlEKG1zZ25vKSwKQEAgLTEw
MjAsNyArMTAyOSw3IEBACiAgICAgdW5zaWduZWQgKm1zZ25vX2xpc3Q7CiAgICAgaW50IGksIG47
CiAKLSAgICBuID0gX2luZGV4X3NlYXJjaCgmbXNnbm9fbGlzdCwgbWFpbGJveCwgc2VhcmNoYXJn
cyk7CisgICAgbiA9IF9pbmRleF9zZWFyY2goJm1zZ25vX2xpc3QsIG1haWxib3gsIHNlYXJjaGFy
Z3MsIE5VTEwpOwogICAgIGlmIChuID09IDApIHsKIAkqdWlkX2xpc3QgPSBOVUxMOwogCXJldHVy
biAwOwpAQCAtMTAzOCwxNiArMTA0NywxNSBAQAogICogUGVyZm9ybXMgYSBTRUFSQ0ggY29tbWFu
ZC4KICAqIFRoaXMgaXMgYSB3cmFwcGVyIGFyb3VuZCBfaW5kZXhfc2VhcmNoKCkgd2hpY2ggc2lt
cGx5IHByaW50cyB0aGUgcmVzdWx0cy4KICAqLwotaW50Ci1pbmRleF9zZWFyY2gobWFpbGJveCwg
c2VhcmNoYXJncywgdXNpbmd1aWQpCi1zdHJ1Y3QgbWFpbGJveCAqbWFpbGJveDsKLXN0cnVjdCBz
ZWFyY2hhcmdzICpzZWFyY2hhcmdzOwotaW50IHVzaW5ndWlkOworaW50IGluZGV4X3NlYXJjaChz
dHJ1Y3QgbWFpbGJveCAqbWFpbGJveCwgc3RydWN0IHNlYXJjaGFyZ3MgKnNlYXJjaGFyZ3MsCisJ
CSBpbnQgdXNpbmd1aWQpCiB7CiAgICAgdW5zaWduZWQgKm1zZ25vX2xpc3Q7CiAgICAgaW50IGks
IG47CisgICAgbW9kc2VxX3QgaGlnaGVzdG1vZHNlcSA9IDA7CiAKLSAgICBuID0gX2luZGV4X3Nl
YXJjaCgmbXNnbm9fbGlzdCwgbWFpbGJveCwgc2VhcmNoYXJncyk7CisgICAgbiA9IF9pbmRleF9z
ZWFyY2goJm1zZ25vX2xpc3QsIG1haWxib3gsIHNlYXJjaGFyZ3MsCisJCSAgICAgIHNlYXJjaGFy
Z3MtPm1vZHNlcSA/ICZoaWdoZXN0bW9kc2VxIDogTlVMTCk7CiAKICAgICBwcm90X3ByaW50Zihp
bWFwZF9vdXQsICIqIFNFQVJDSCIpOwogCkBAIC0xMDU3LDYgKzEwNjUsMTAgQEAKIAogICAgIGlm
IChuKSBmcmVlKG1zZ25vX2xpc3QpOwogCisgICAgaWYgKGhpZ2hlc3Rtb2RzZXEpIHsKKwlwcm90
X3ByaW50ZihpbWFwZF9vdXQsICIgKE1PRFNFUSAiIE1PRFNFUV9GTVQgIikiLCBoaWdoZXN0bW9k
c2VxKTsKKyAgICB9CisKICAgICBwcm90X3ByaW50ZihpbWFwZF9vdXQsICJcclxuIik7CiAKICAg
ICByZXR1cm4gbjsKQEAgLTEwNjUsMjIgKzEwNzcsMzIgQEAKIC8qCiAgKiBQZXJmb3JtcyBhIFNP
UlQgY29tbWFuZAogICovCi1pbnQKLWluZGV4X3NvcnQoc3RydWN0IG1haWxib3ggKm1haWxib3gs
Ci0JICAgc3RydWN0IHNvcnRjcml0ICpzb3J0Y3JpdCwKLQkgICBzdHJ1Y3Qgc2VhcmNoYXJncyAq
c2VhcmNoYXJncywKLQkgICBpbnQgdXNpbmd1aWQpCitpbnQgaW5kZXhfc29ydChzdHJ1Y3QgbWFp
bGJveCAqbWFpbGJveCwgc3RydWN0IHNvcnRjcml0ICpzb3J0Y3JpdCwKKwkgICAgICAgc3RydWN0
IHNlYXJjaGFyZ3MgKnNlYXJjaGFyZ3MsIGludCB1c2luZ3VpZCkKIHsKICAgICB1bnNpZ25lZCAq
bXNnbm9fbGlzdDsKICAgICBNc2dEYXRhICptc2dkYXRhID0gTlVMTCwgKmZyZWVtZSA9IE5VTEw7
CiAgICAgaW50IG5tc2c7CiAgICAgY2xvY2tfdCBzdGFydDsKKyAgICBtb2RzZXFfdCBoaWdoZXN0
bW9kc2VxID0gMDsKKyAgICBpbnQgaSwgbW9kc2VxID0gMDsKIAogICAgIGlmKENPTkZJR19USU1J
TkdfVkVSQk9TRSkKIAlzdGFydCA9IGNsb2NrKCk7CiAKKyAgICBpZiAoc2VhcmNoYXJncy0+bW9k
c2VxKSBtb2RzZXEgPSAxOworICAgIGVsc2UgeworCWZvciAoaSA9IDA7IHNvcnRjcml0W2ldLmtl
eSAhPSBTT1JUX1NFUVVFTkNFOyBpKyspIHsKKwkgICAgaWYgKHNvcnRjcml0W2ldLmtleSA9PSBT
T1JUX01PRFNFUSkgeworCQltb2RzZXEgPSAxOworCQlicmVhazsKKwkgICAgfQorCX0KKyAgICB9
CisKICAgICAvKiBTZWFyY2ggZm9yIG1lc3NhZ2VzIGJhc2VkIG9uIHRoZSBnaXZlbiBjcml0ZXJp
YSAqLwotICAgIG5tc2cgPSBfaW5kZXhfc2VhcmNoKCZtc2dub19saXN0LCBtYWlsYm94LCBzZWFy
Y2hhcmdzKTsKKyAgICBubXNnID0gX2luZGV4X3NlYXJjaCgmbXNnbm9fbGlzdCwgbWFpbGJveCwg
c2VhcmNoYXJncywKKwkJCSBtb2RzZXEgPyAmaGlnaGVzdG1vZHNlcSA6IE5VTEwpOwogCiAgICAg
cHJvdF9wcmludGYoaW1hcGRfb3V0LCAiKiBTT1JUIik7CiAKQEAgLTExMTEsMTMgKzExMzMsMTcg
QEAKIAlmcmVlKGZyZWVtZSk7CiAgICAgfQogCisgICAgaWYgKGhpZ2hlc3Rtb2RzZXEpIHsKKwlw
cm90X3ByaW50ZihpbWFwZF9vdXQsICIgKE1PRFNFUSAiIE1PRFNFUV9GTVQgIikiLCBoaWdoZXN0
bW9kc2VxKTsKKyAgICB9CisKICAgICBwcm90X3ByaW50ZihpbWFwZF9vdXQsICJcclxuIik7CiAK
ICAgICAvKiBkZWJ1ZyAqLwogICAgIGlmIChDT05GSUdfVElNSU5HX1ZFUkJPU0UpIHsKIAlpbnQg
bGVuOwogCWNoYXIgKmtleV9uYW1lc1tdID0geyAiU0VRVUVOQ0UiLCAiQVJSSVZBTCIsICJDQyIs
ICJEQVRFIiwgIkZST00iLAotCQkJICAgICAgIlNJWkUiLCAiU1VCSkVDVCIsICJUTyIsICJBTk5P
VEFUSU9OIiB9OworCQkJICAgICAgIlNJWkUiLCAiU1VCSkVDVCIsICJUTyIsICJBTk5PVEFUSU9O
IiwgIk1PRFNFUSIgfTsKIAljaGFyIGJ1ZlsxMDI0XSA9ICIiOwogCiAJd2hpbGUgKHNvcnRjcml0
LT5rZXkgJiYgc29ydGNyaXQtPmtleSA8IFZFQ1RPUl9TSVpFKGtleV9uYW1lcykpIHsKQEAgLTEx
NTMsMjQgKzExNzksMzIgQEAKICAgICB1bnNpZ25lZCAqbXNnbm9fbGlzdDsKICAgICBpbnQgbm1z
ZzsKICAgICBjbG9ja190IHN0YXJ0OworICAgIG1vZHNlcV90IGhpZ2hlc3Rtb2RzZXEgPSAwOwog
CiAgICAgaWYoQ09ORklHX1RJTUlOR19WRVJCT1NFKQogCXN0YXJ0ID0gY2xvY2soKTsKIAogICAg
IC8qIFNlYXJjaCBmb3IgbWVzc2FnZXMgYmFzZWQgb24gdGhlIGdpdmVuIGNyaXRlcmlhICovCi0g
ICAgbm1zZyA9IF9pbmRleF9zZWFyY2goJm1zZ25vX2xpc3QsIG1haWxib3gsIHNlYXJjaGFyZ3Mp
OworICAgIG5tc2cgPSBfaW5kZXhfc2VhcmNoKCZtc2dub19saXN0LCBtYWlsYm94LCBzZWFyY2hh
cmdzLAorCQkJIHNlYXJjaGFyZ3MtPm1vZHNlcSA/ICZoaWdoZXN0bW9kc2VxIDogTlVMTCk7CiAK
ICAgICBpZiAobm1zZykgewogCS8qIFRocmVhZCBtZXNzYWdlcyB1c2luZyBnaXZlbiBhbGdvcml0
aG0gKi8KIAkoKnRocmVhZF9hbGdzW2FsZ29yaXRobV0udGhyZWFkZXIpKG1zZ25vX2xpc3QsIG5t
c2csIHVzaW5ndWlkKTsKIAogCWZyZWUobXNnbm9fbGlzdCk7CisKKwlpZiAoaGlnaGVzdG1vZHNl
cSkgeworCSAgICBwcm90X3ByaW50ZihpbWFwZF9vdXQsICIgKE1PRFNFUSAiIE1PRFNFUV9GTVQg
IikiLCBoaWdoZXN0bW9kc2VxKTsKKwl9CiAgICAgfQogCiAgICAgLyogcHJpbnQgYW4gZW1wdHkg
dW50YWdnZWQgcmVzcG9uc2UgKi8KICAgICBlbHNlCiAJaW5kZXhfdGhyZWFkX3ByaW50KE5VTEws
IHVzaW5ndWlkKTsKIAorICAgIHByb3RfcHJpbnRmKGltYXBkX291dCwgIlxyXG4iKTsKKwogICAg
IGlmIChDT05GSUdfVElNSU5HX1ZFUkJPU0UpIHsKIAkvKiBkZWJ1ZyAqLwogCXN5c2xvZyhMT0df
REVCVUcsICJUSFJFQUQgJXMgcHJvY2Vzc2luZyB0aW1lOiAlZCBtc2cgaW4gJWYgc2VjIiwKQEAg
LTE0MzcsNiArMTQ3MSwxMSBAQAogCXByb3RfcHJpbnRmKGltYXBkX291dCwgIiVjVU5TRUVOICV1
Iiwgc2VwY2hhciwgbnVtX3Vuc2Vlbik7CiAJc2VwY2hhciA9ICcgJzsKICAgICB9CisgICAgaWYg
KHN0YXR1c2l0ZW1zICYgU1RBVFVTX0hJR0hFU1RNT0RTRVEpIHsKKwlwcm90X3ByaW50ZihpbWFw
ZF9vdXQsICIlY0hJR0hFU1RNT0RTRVEgIiBNT0RTRVFfRk1ULCBzZXBjaGFyLAorCQkgICAgbWFp
bGJveC0+aGlnaGVzdG1vZHNlcSk7CisJc2VwY2hhciA9ICcgJzsKKyAgICB9CiAgICAgcHJvdF9w
cmludGYoaW1hcGRfb3V0LCAiKVxyXG4iKTsKICAgICByZXR1cm4gMDsKIH0KQEAgLTIzNzIsNiAr
MjQxMSw5IEBACiAgICAgY2hhciByZXNwYnVmWzEwMF07CiAgICAgaW50IHIgPSAwOwogCisgICAg
LyogQ2hlY2sgdGhlIG1vZHNlcSBhZ2FpbnN0IGNoYW5nZWRzaW5jZSAqLworICAgIGlmIChNT0RT
RVEobXNnbm8pIDw9IGZldGNoYXJncy0+Y2hhbmdlZHNpbmNlKSByZXR1cm4gMDsKKwogICAgIC8q
IE9wZW4gdGhlIG1lc3NhZ2UgZmlsZSBpZiB3ZSdyZSBnb2luZyB0byBuZWVkIGl0ICovCiAgICAg
aWYgKChmZXRjaGl0ZW1zICYgKEZFVENIX0hFQURFUnxGRVRDSF9URVhUfEZFVENIX1JGQzgyMikp
IHx8CiAJZmV0Y2hhcmdzLT5jYWNoZV9hdGxlYXN0ID4gQ0FDSEVfVkVSU0lPTihtc2dubykgfHwK
QEAgLTI0MjAsNiArMjQ2MiwxMSBAQAogCQkgICAgc2VwY2hhciwgZGF0ZWJ1Zik7CiAJc2VwY2hh
ciA9ICcgJzsKICAgICB9CisgICAgaWYgKGZldGNoaXRlbXMgJiBGRVRDSF9NT0RTRVEpIHsKKwlw
cm90X3ByaW50ZihpbWFwZF9vdXQsICIlY01PRFNFUSAoIiBNT0RTRVFfRk1UICIpIiwKKwkJICAg
IHNlcGNoYXIsIE1PRFNFUShtc2dubykpOworCXNlcGNoYXIgPSAnICc7CisgICAgfQogICAgIGlm
IChmZXRjaGl0ZW1zICYgRkVUQ0hfU0laRSkgewogCXByb3RfcHJpbnRmKGltYXBkX291dCwgIiVj
UkZDODIyLlNJWkUgJXUiLCBzZXBjaGFyLCBTSVpFKG1zZ25vKSk7CiAJc2VwY2hhciA9ICcgJzsK
QEAgLTI3NTUsMjEgKzI4MDIsMzMgQEAKICAgICBpbnQgdmFsID0gKHN0b3JlYXJncy0+b3BlcmF0
aW9uID09IFNUT1JFX0FERCkgPyAxIDogMDsKICAgICBpbnQgaTsKICAgICBiaXQzMiB1c2VyX2Zs
YWdzW01BWF9VU0VSX0ZMQUdTLzMyXTsKKyAgICBjaGFyICpzZXAgPSAiIjsKICAgICAKKyAgICAv
KiBDaGVjayB0aGUgbW9kc2VxIGFnYWluc3QgdW5jaGFuZ2Vkc2luY2UgKi8KKyAgICBpZiAoTU9E
U0VRKG1zZ25vKSA+IHN0b3JlYXJncy0+dW5jaGFuZ2Vkc2luY2UpIHJldHVybiAwOworCiAgICAg
aWYgKHNlZW5mbGFnW21zZ25vXSA9PSB2YWwpIHJldHVybiAwOwogICAgIHNlZW5mbGFnW21zZ25v
XSA9IHZhbDsKIAotICAgIGlmIChzdG9yZWFyZ3MtPnNpbGVudCkgcmV0dXJuIDA7Ci0KLSAgICBm
b3IgKGk9MDsgaSA8IFZFQ1RPUl9TSVpFKHVzZXJfZmxhZ3MpOyBpKyspIHsKLQl1c2VyX2ZsYWdz
W2ldID0gVVNFUl9GTEFHUyhtc2dubywgaSk7CisgICAgaWYgKCFzdG9yZWFyZ3MtPnNpbGVudCkg
eworCWZvciAoaT0wOyBpIDwgVkVDVE9SX1NJWkUodXNlcl9mbGFncyk7IGkrKykgeworCSAgICB1
c2VyX2ZsYWdzW2ldID0gVVNFUl9GTEFHUyhtc2dubywgaSk7CisJfQorCWluZGV4X2ZldGNoZmxh
Z3MobWFpbGJveCwgbXNnbm8sIFNZU1RFTV9GTEFHUyhtc2dubyksIHVzZXJfZmxhZ3MsCisJCQkg
TEFTVF9VUERBVEVEKG1zZ25vKSk7CisJc2VwID0gIiAiOwogICAgIH0KLSAgICBpbmRleF9mZXRj
aGZsYWdzKG1haWxib3gsIG1zZ25vLCBTWVNURU1fRkxBR1MobXNnbm8pLCB1c2VyX2ZsYWdzLAot
CQkgICAgIExBU1RfVVBEQVRFRChtc2dubykpOwotICAgIGlmIChzdG9yZWFyZ3MtPnVzaW5ndWlk
KSB7Ci0JcHJvdF9wcmludGYoaW1hcGRfb3V0LCAiIFVJRCAldSIsIFVJRChtc2dubykpOworICAg
IGlmIChpbWFwZF9jb25kc3RvcmVfZW5hYmxlZCkgeworCXByb3RfcHJpbnRmKGltYXBkX291dCwg
IiVzTU9EU0VRICgiIE1PRFNFUV9GTVQgIikiLAorCQkgICAgc2VwLCBNT0RTRVEobXNnbm8pKTsK
KwlzZXAgPSAiICI7CisgICAgfQorICAgIGlmICgqc2VwKSB7CisJaWYgKHN0b3JlYXJncy0+dXNp
bmd1aWQpIHsKKwkgICAgcHJvdF9wcmludGYoaW1hcGRfb3V0LCAiIFVJRCAldSIsIFVJRChtc2du
bykpOworCX0KKwlwcm90X3ByaW50ZihpbWFwZF9vdXQsICIpXHJcbiIpOwogICAgIH0KLSAgICBw
cm90X3ByaW50ZihpbWFwZF9vdXQsICIpXHJcbiIpOwogCiAgICAgcmV0dXJuIDA7CiB9CkBAIC0y
NzkwLDE0ICsyODQ5LDIwIEBACiAgICAgaW50IGZpcnN0dHJ5ID0gMTsKICAgICBpbnQgZGlydHkg
PSAwOwogICAgIGJpdDMyIG9sZGZsYWdzOworICAgIGludCBzZXBjaGFyID0gJygnOworCisgICAg
LyogQ2hlY2sgdGhlIG1vZHNlcSBhZ2FpbnN0IHVuY2hhbmdlZHNpbmNlICovCisgICAgaWYgKE1P
RFNFUShtc2dubykgPiBzdG9yZWFyZ3MtPnVuY2hhbmdlZHNpbmNlKSByZXR1cm4gMDsKIAogICAg
IC8qIENoYW5nZSBcU2VlbiBmbGFnICovCi0gICAgaWYgKHN0b3JlYXJncy0+b3BlcmF0aW9uID09
IFNUT1JFX1JFUExBQ0UgJiYgKG1haWxib3gtPm15cmlnaHRzJkFDTF9TRUVOKSkKKyAgICBpZiAo
c3RvcmVhcmdzLT5vcGVyYXRpb24gPT0gU1RPUkVfUkVQTEFDRSAmJiAobWFpbGJveC0+bXlyaWdo
dHMgJiBBQ0xfU0VFTikpCiAgICAgeworCWlmIChzZWVuZmxhZ1ttc2dub10gIT0gc3RvcmVhcmdz
LT5zZWVuKSBkaXJ0eSsrOwogCXNlZW5mbGFnW21zZ25vXSA9IHN0b3JlYXJncy0+c2VlbjsKICAg
ICB9CiAgICAgZWxzZSBpZiAoc3RvcmVhcmdzLT5zZWVuKSB7CiAJaSA9IChzdG9yZWFyZ3MtPm9w
ZXJhdGlvbiA9PSBTVE9SRV9BREQpID8gMSA6IDA7CisJaWYgKHNlZW5mbGFnW21zZ25vXSAhPSBp
KSBkaXJ0eSsrOwogCXNlZW5mbGFnW21zZ25vXSA9IGk7CiAgICAgfQogCkBAIC0yODQ4LDIyICsy
OTEzLDI4IEBACiAKICAgICBpZiAoc3RvcmVhcmdzLT5vcGVyYXRpb24gPT0gU1RPUkVfUkVQTEFD
RSkgewogCWlmICghKG1haWxib3gtPm15cmlnaHRzICYgQUNMX1dSSVRFKSkgewotCSAgICByZWNv
cmQuc3lzdGVtX2ZsYWdzID0gKHJlY29yZC5zeXN0ZW1fZmxhZ3MmfkZMQUdfREVMRVRFRCkgfAot
CSAgICAgIChzdG9yZWFyZ3MtPnN5c3RlbV9mbGFncyZGTEFHX0RFTEVURUQpOworCSAgICAvKiBB
Q0xfREVMRVRFIGhhbmRsZWQgaW4gaW5kZXhfc3RvcmUoKSAqLworCSAgICBpZiAoKHJlY29yZC5z
eXN0ZW1fZmxhZ3MgJiBGTEFHX0RFTEVURUQpICE9CisJCShzdG9yZWFyZ3MtPnN5c3RlbV9mbGFn
cyAmIEZMQUdfREVMRVRFRCkpIGRpcnR5Kys7CisJICAgIHJlY29yZC5zeXN0ZW1fZmxhZ3MgPSAo
cmVjb3JkLnN5c3RlbV9mbGFncyAmIH5GTEFHX0RFTEVURUQpIHwKKwkgICAgICAoc3RvcmVhcmdz
LT5zeXN0ZW1fZmxhZ3MgJiBGTEFHX0RFTEVURUQpOwogCX0KIAllbHNlIHsKIAkgICAgaWYgKCEo
bWFpbGJveC0+bXlyaWdodHMgJiBBQ0xfREVMRVRFKSkgewotCQlyZWNvcmQuc3lzdGVtX2ZsYWdz
ID0gKHJlY29yZC5zeXN0ZW1fZmxhZ3MmRkxBR19ERUxFVEVEKSB8Ci0JCSAgKHN0b3JlYXJncy0+
c3lzdGVtX2ZsYWdzJn5GTEFHX0RFTEVURUQpOworCQlpZiAoKHJlY29yZC5zeXN0ZW1fZmxhZ3Mg
JiB+RkxBR19ERUxFVEVEKSAhPQorCQkgICAgKHN0b3JlYXJncy0+c3lzdGVtX2ZsYWdzICYgfkZM
QUdfREVMRVRFRCkpIGRpcnR5Kys7CisJCXJlY29yZC5zeXN0ZW1fZmxhZ3MgPSAocmVjb3JkLnN5
c3RlbV9mbGFncyAmIEZMQUdfREVMRVRFRCkgfAorCQkgIChzdG9yZWFyZ3MtPnN5c3RlbV9mbGFn
cyAmIH5GTEFHX0RFTEVURUQpOwogCSAgICB9CiAJICAgIGVsc2UgeworCQlpZiAocmVjb3JkLnN5
c3RlbV9mbGFncyAhPSBzdG9yZWFyZ3MtPnN5c3RlbV9mbGFncykgZGlydHkrKzsKIAkJcmVjb3Jk
LnN5c3RlbV9mbGFncyA9IHN0b3JlYXJncy0+c3lzdGVtX2ZsYWdzOwogCSAgICB9CiAJICAgIGZv
ciAoaSA9IDA7IGkgPCBWRUNUT1JfU0laRShyZWNvcmQudXNlcl9mbGFncyk7IGkrKykgeworCQlp
ZiAocmVjb3JkLnVzZXJfZmxhZ3NbaV0gIT0gc3RvcmVhcmdzLT51c2VyX2ZsYWdzW2ldKSBkaXJ0
eSsrOwogCQlyZWNvcmQudXNlcl9mbGFnc1tpXSA9IHN0b3JlYXJncy0+dXNlcl9mbGFnc1tpXTsK
IAkgICAgfQogCX0KLQlkaXJ0eSsrOwkJLyogRG9uJ3QgdHJ5IHRvIGJlIGNsZXZlciAqLwogICAg
IH0KICAgICBlbHNlIGlmIChzdG9yZWFyZ3MtPm9wZXJhdGlvbiA9PSBTVE9SRV9BREQpIHsKIAlp
ZiAofnJlY29yZC5zeXN0ZW1fZmxhZ3MgJiBzdG9yZWFyZ3MtPnN5c3RlbV9mbGFncykgZGlydHkr
KzsKQEAgLTI4ODYsNiArMjk1Nyw5IEBACiAgICAgfQogCiAgICAgaWYgKGRpcnR5KSB7CisJLyog
YnVtcCBNT0RTRVEgKi8KKwlyZWNvcmQubW9kc2VxID0gbWFpbGJveC0+aGlnaGVzdG1vZHNlcSAr
IDE7CisKIAkvKiB1cGRhdGUgdG90YWxzICovCiAJaWYgKCAocmVjb3JkLnN5c3RlbV9mbGFncyAm
IEZMQUdfREVMRVRFRCkgJiYgIShvbGRmbGFncyAmIEZMQUdfREVMRVRFRCkpCiAJICAgIG1haWxi
b3gtPmRlbGV0ZWQrKzsKQEAgLTI5MjIsNiArMjk5NiwxOCBAQAogICAgIGlmICghc3RvcmVhcmdz
LT5zaWxlbnQpIHsKIAlpbmRleF9mZXRjaGZsYWdzKG1haWxib3gsIG1zZ25vLCByZWNvcmQuc3lz
dGVtX2ZsYWdzLAogCQkJIHJlY29yZC51c2VyX2ZsYWdzLCByZWNvcmQubGFzdF91cGRhdGVkKTsK
KwlzZXBjaGFyID0gJyAnOworICAgIH0KKyAgICBpZiAoaW1hcGRfY29uZHN0b3JlX2VuYWJsZWQp
IHsKKwlpZiAoc2VwY2hhciA9PSAnKCcpIHsKKwkgICAgLyogd2UgaGF2ZW4ndCBvdXRwdXQgYSBm
ZXRjaCBpdGVtIHlldCwgc28gc3RhcnQgdGhlIHJlc3BvbnNlICovCisJICAgIHByb3RfcHJpbnRm
KGltYXBkX291dCwgIiogJXUgRkVUQ0ggIiwgbXNnbm8pOworCX0KKwlwcm90X3ByaW50ZihpbWFw
ZF9vdXQsICIlY01PRFNFUSAoIiBNT0RTRVFfRk1UICIpIiwKKwkJICAgIHNlcGNoYXIsIHJlY29y
ZC5tb2RzZXEpOworICAgIH0KKyAgICBpZiAoc2VwY2hhciAhPSAnKCcpIHsKKwkvKiBmaW5zaCB0
aGUgcmVzcG9uc2UgaWYgd2UgaGF2ZSBvbmUgKi8KIAlpZiAoc3RvcmVhcmdzLT51c2luZ3VpZCkg
ewogCSAgICBwcm90X3ByaW50ZihpbWFwZF9vdXQsICIgVUlEICV1IiwgVUlEKG1zZ25vKSk7CiAJ
fQpAQCAtMjk3MSw2ICszMDU3LDggQEAKICAgICBpZiAoc2VhcmNoYXJncy0+c2VudGJlZm9yZSAm
JiBTRU5UREFURShtc2dubykgPiBzZWFyY2hhcmdzLT5zZW50YmVmb3JlKQogICAgICAgcmV0dXJu
IDA7CiAKKyAgICBpZiAoc2VhcmNoYXJncy0+bW9kc2VxICYmIE1PRFNFUShtc2dubykgPCBzZWFy
Y2hhcmdzLT5tb2RzZXEpIHJldHVybiAwOworCiAgICAgaWYgKH5TWVNURU1fRkxBR1MobXNnbm8p
ICYgc2VhcmNoYXJncy0+c3lzdGVtX2ZsYWdzX3NldCkgcmV0dXJuIDA7CiAgICAgaWYgKFNZU1RF
TV9GTEFHUyhtc2dubykgJiBzZWFyY2hhcmdzLT5zeXN0ZW1fZmxhZ3NfdW5zZXQpIHJldHVybiAw
OwogCQpAQCAtNDAyNSw5ICs0MTEzLDkgQEAKIC8qCiAgKiBGdW5jdGlvbiBmb3IgY29tcGFyaW5n
IHR3byBpbnRlZ2Vycy4KICAqLwotc3RhdGljIGludCBudW1jbXAoaW50IGkxLCBpbnQgaTIpCitz
dGF0aWMgaW50IG51bWNtcChtb2RzZXFfdCBuMSwgbW9kc2VxX3QgbjIpCiB7Ci0gICAgcmV0dXJu
ICgoaTEgPCBpMikgPyAtMSA6IChpMSA+IGkyKSA/IDEgOiAwKTsKKyAgICByZXR1cm4gKChuMSA8
IG4yKSA/IC0xIDogKG4xID4gbjIpID8gMSA6IDApOwogfQogCiAvKgpAQCAtNDA3Miw2ICs0MTYw
LDkgQEAKIAkgICAgcmV0ID0gc3RyY21wKG1kMS0+YW5ub3RbYW5uXSwgbWQyLT5hbm5vdFthbm5d
KTsKIAkgICAgYW5uKys7CiAJICAgIGJyZWFrOworCWNhc2UgU09SVF9NT0RTRVE6CisJICAgIHJl
dCA9IG51bWNtcChNT0RTRVEobWQxLT5tc2dubyksIE1PRFNFUShtZDItPm1zZ25vKSk7CisJICAg
IGJyZWFrOwogCX0KICAgICB9IHdoaWxlICghcmV0ICYmIHNvcnRjcml0W2krK10ua2V5ICE9IFNP
UlRfU0VRVUVOQ0UpOwogCkBAIC00MzE0LDggKzQ0MDUsNiBAQAogCXByb3RfcHJpbnRmKGltYXBk
X291dCwgIiAiKTsKIAlfaW5kZXhfdGhyZWFkX3ByaW50KHRocmVhZC0+Y2hpbGQsIHVzaW5ndWlk
KTsKICAgICB9Ci0KLSAgICBwcm90X3ByaW50ZihpbWFwZF9vdXQsICJcclxuIik7CiB9CiAKIC8q
CkluZGV4OiBpbWFwL2luZGV4LmgKPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQpSQ1MgZmlsZTogL2Fmcy9hbmRyZXcvc3lz
dGVtL2N2cy9zcmMvY3lydXMvaW1hcC9pbmRleC5oLHYKcmV0cmlldmluZyByZXZpc2lvbiAxLjku
Mi41CmRpZmYgLXUgLXIxLjkuMi41IGluZGV4LmgKLS0tIGltYXAvaW5kZXguaAkxNyBOb3YgMjAw
NSAxNTo0NjoyOCAtMDAwMAkxLjkuMi41CisrKyBpbWFwL2luZGV4LmgJMTMgRGVjIDIwMDUgMTY6
Mjc6NTggLTAwMDAKQEAgLTc5LDYgKzc5LDExIEBACiAjZGVmaW5lIFVTRVJfRkxBR1MobXNnbm8s
aSkgbnRvaGwoKigoYml0MzIgKikoSU5ERUNfT0ZGU0VUKG1zZ25vKStPRkZTRVRfVVNFUl9GTEFH
UysoKGkpKjQpKSkpCiAjZGVmaW5lIENPTlRFTlRfTElORVMobXNnbm8pIG50b2hsKCooKGJpdDMy
ICopKElOREVDX09GRlNFVChtc2dubykrT0ZGU0VUX0NPTlRFTlRfTElORVMpKSkKICNkZWZpbmUg
Q0FDSEVfVkVSU0lPTihtc2dubykgbnRvaGwoKigoYml0MzIgKikoSU5ERUNfT0ZGU0VUKG1zZ25v
KStPRkZTRVRfQ0FDSEVfVkVSU0lPTikpKQorI2lmZGVmIEhBVkVfTE9OR19MT05HX0lOVAorI2Rl
ZmluZSBNT0RTRVEobXNnbm8pIG50b2hsbCgqKChiaXQ2NCAqKShJTkRFQ19PRkZTRVQobXNnbm8p
K09GRlNFVF9NT0RTRVFfNjQpKSkKKyNlbHNlCisjZGVmaW5lIE1PRFNFUShtc2dubykgbnRvaGwo
KigoYml0MzIgKikoSU5ERUNfT0ZGU0VUKG1zZ25vKStPRkZTRVRfTU9EU0VRKSkpCisjZW5kaWYK
IAogLyogQWNjZXNzIGFzc2lzdGFuY2UgbWFjcm9zIGZvciBtZW1vcnktbWFwcGVkIGNhY2hlIGZp
bGUgZGF0YSAqLwogLyogQ0FDSEVfSVRFTV9CSVQzMjogQ29udmVydCB0byBob3N0IGJ5dGUgb3Jk
ZXIgKi8KSW5kZXg6IGltYXAvbWFpbGJveC5jCj09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KUkNTIGZpbGU6IC9hZnMvYW5k
cmV3L3N5c3RlbS9jdnMvc3JjL2N5cnVzL2ltYXAvbWFpbGJveC5jLHYKcmV0cmlldmluZyByZXZp
c2lvbiAxLjE0Ny4yLjMwCmRpZmYgLXUgLXIxLjE0Ny4yLjMwIG1haWxib3guYwotLS0gaW1hcC9t
YWlsYm94LmMJMTAgTm92IDIwMDUgMDY6MDQ6NTUgLTAwMDAJMS4xNDcuMi4zMAorKysgaW1hcC9t
YWlsYm94LmMJMTMgRGVjIDIwMDUgMTY6Mjc6NTkgLTAwMDAKQEAgLTg0LDcgKzg0LDYgQEAKICNp
bmNsdWRlICJzZWVuLmgiCiAjaW5jbHVkZSAidXRpbC5oIgogI2luY2x1ZGUgInhtYWxsb2MuaCIK
LSNpbmNsdWRlICJieXRlb3JkZXI2NC5oIgogCiBzdGF0aWMgaW50IG1haWxib3hfZG9pbmdfcmVj
b25zdHJ1Y3QgPSAwOwogI2RlZmluZSB6ZXJvbWFpbGJveChtKSB7IG1lbXNldCgmbSwgMCwgc2l6
ZW9mKHN0cnVjdCBtYWlsYm94KSk7IFwKQEAgLTg5OCw3ICs4OTcsNyBAQAogICAgIG1haWxib3gt
PnJlY29yZF9zaXplID0KIAludG9obCgqKChiaXQzMiAqKShtYWlsYm94LT5pbmRleF9iYXNlK09G
RlNFVF9SRUNPUkRfU0laRSkpKTsKIAotICAgIGlmICgobWFpbGJveC0+c3RhcnRfb2Zmc2V0IDwg
T0ZGU0VUX0xFQUtFRF9DQUNIRStzaXplb2YoYml0MzIpKSB8fAorICAgIGlmICgobWFpbGJveC0+
c3RhcnRfb2Zmc2V0IDwgT0ZGU0VUX0hJR0hFU1RNT0RTRVErNCkgfHwKIAkobWFpbGJveC0+cmVj
b3JkX3NpemUgPCBJTkRFWF9SRUNPUkRfU0laRSkpIHsKIAlpZiAobWFpbGJveF91cGdyYWRlX2lu
ZGV4KG1haWxib3gpKQogCSAgICByZXR1cm4gSU1BUF9JT0VSUk9SOwpAQCAtOTQwLDYgKzkzOSwx
MyBAQAogCW50b2hsKCooKGJpdDMyICopKG1haWxib3gtPmluZGV4X2Jhc2UrT0ZGU0VUX1BPUDNf
TkVXX1VJREwpKSk7CiAgICAgbWFpbGJveC0+bGVha2VkX2NhY2hlX3JlY29yZHMgPQogCW50b2hs
KCooKGJpdDMyICopKG1haWxib3gtPmluZGV4X2Jhc2UrT0ZGU0VUX0xFQUtFRF9DQUNIRSkpKTsK
KyNpZmRlZiBIQVZFX0xPTkdfTE9OR19JTlQKKyAgICBtYWlsYm94LT5oaWdoZXN0bW9kc2VxID0K
KwludG9obGwoKigoYml0NjQgKikobWFpbGJveC0+aW5kZXhfYmFzZStPRkZTRVRfSElHSEVTVE1P
RFNFUV82NCkpKTsKKyNlbHNlCisgICAgbWFpbGJveC0+aGlnaGVzdG1vZHNlcSA9CisJbnRvaGwo
KigoYml0MzIgKikobWFpbGJveC0+aW5kZXhfYmFzZStPRkZTRVRfSElHSEVTVE1PRFNFUSkpKTsK
KyNlbmRpZgogCiAgICAgaWYgKCFtYWlsYm94X2RvaW5nX3JlY29uc3RydWN0ICYmCiAJKG1haWxi
b3gtPm1pbm9yX3ZlcnNpb24gPCBNQUlMQk9YX01JTk9SX1ZFUlNJT04pKSB7CkBAIC05ODYsOCAr
OTkyLDEyIEBACiAgICAgfQogICAgIHJlY29yZC0+Y29udGVudF9saW5lcyA9IGh0b25sKCooKGJp
dDMyICopKGJ1ZitPRkZTRVRfQ09OVEVOVF9MSU5FUykpKTsKICAgICByZWNvcmQtPmNhY2hlX3Zl
cnNpb24gPSBodG9ubCgqKChiaXQzMiAqKShidWYrT0ZGU0VUX0NBQ0hFX1ZFUlNJT04pKSk7Ci0K
ICAgICBtZXNzYWdlX3V1aWRfdW5wYWNrKCZyZWNvcmQtPnV1aWQsIGJ1ZitPRkZTRVRfTUVTU0FH
RV9VVUlEKTsKKyNpZmRlZiBIQVZFX0xPTkdfTE9OR19JTlQKKyAgICByZWNvcmQtPm1vZHNlcSA9
IGh0b25sbCgqKChiaXQ2NCAqKShidWYrT0ZGU0VUX01PRFNFUV82NCkpKTsKKyNlbHNlCisgICAg
cmVjb3JkLT5tb2RzZXEgPSBodG9ubCgqKChiaXQzMiAqKShidWYrT0ZGU0VUX01PRFNFUSkpKTsK
KyNlbmRpZgogICAgIHJldHVybiAwOwogfQogCkBAIC0xMzAxLDggKzEzMTEsMTcgQEAKICAgICAq
KChiaXQzMiAqKShidWYrT0ZGU0VUX1BPUDNfTkVXX1VJREwpKSA9IGh0b25sKG1haWxib3gtPnBv
cDNfbmV3X3VpZGwpOwogICAgICooKGJpdDMyICopKGJ1ZitPRkZTRVRfTEVBS0VEX0NBQ0hFKSkg
PQogCWh0b25sKG1haWxib3gtPmxlYWtlZF9jYWNoZV9yZWNvcmRzKTsKKyNpZmRlZiBIQVZFX0xP
TkdfTE9OR19JTlQKKyAgICAqKChiaXQ2NCAqKShidWYrT0ZGU0VUX0hJR0hFU1RNT0RTRVFfNjQp
KSA9IGh0b25sbChtYWlsYm94LT5oaWdoZXN0bW9kc2VxKTsKKyNlbHNlCisgICAgLyogemVybyB0
aGUgdW51c2VkIDMyYml0cyAqLworICAgICooKGJpdDMyICopKGJ1ZitPRkZTRVRfSElHSEVTVE1P
RFNFUV82NCkpID0gaHRvbmwoMCk7CisgICAgKigoYml0MzIgKikoYnVmK09GRlNFVF9ISUdIRVNU
TU9EU0VRKSkgPSBodG9ubChtYWlsYm94LT5oaWdoZXN0bW9kc2VxKTsKKyNlbmRpZgorICAgICoo
KGJpdDMyICopKGJ1ZitPRkZTRVRfU1BBUkUwKSkgPSBodG9ubCgwKTsgLyogUkVTRVJWRUQgKi8K
ICAgICAqKChiaXQzMiAqKShidWYrT0ZGU0VUX1NQQVJFMSkpID0gaHRvbmwoMCk7IC8qIFJFU0VS
VkVEICovCiAgICAgKigoYml0MzIgKikoYnVmK09GRlNFVF9TUEFSRTIpKSA9IGh0b25sKDApOyAv
KiBSRVNFUlZFRCAqLworICAgICooKGJpdDMyICopKGJ1ZitPRkZTRVRfU1BBUkUzKSkgPSBodG9u
bCgwKTsgLyogUkVTRVJWRUQgKi8KIAogICAgIGlmIChtYWlsYm94LT5zdGFydF9vZmZzZXQgPCBo
ZWFkZXJfc2l6ZSkKIAloZWFkZXJfc2l6ZSA9IG1haWxib3gtPnN0YXJ0X29mZnNldDsKQEAgLTEz
NDIsNiArMTM2MSwxMyBAQAogICAgICooKGJpdDMyICopKGJ1ZitPRkZTRVRfQ09OVEVOVF9MSU5F
UykpID0gaHRvbmwocmVjb3JkLT5jb250ZW50X2xpbmVzKTsKICAgICAqKChiaXQzMiAqKShidWYr
T0ZGU0VUX0NBQ0hFX1ZFUlNJT04pKSA9IGh0b25sKHJlY29yZC0+Y2FjaGVfdmVyc2lvbik7CiAg
ICAgbWVzc2FnZV91dWlkX3BhY2soJnJlY29yZC0+dXVpZCwgYnVmK09GRlNFVF9NRVNTQUdFX1VV
SUQpOworI2lmZGVmIEhBVkVfTE9OR19MT05HX0lOVAorICAgICooKGJpdDY0ICopKGJ1ZitPRkZT
RVRfTU9EU0VRXzY0KSkgPSBodG9ubGwocmVjb3JkLT5tb2RzZXEpOworI2Vsc2UKKyAgICAvKiB6
ZXJvIHRoZSB1bnVzZWQgMzJiaXRzICovCisgICAgKigoYml0MzIgKikoYnVmK09GRlNFVF9NT0RT
RVFfNjQpKSA9IGh0b25sKDApOworICAgICooKGJpdDMyICopKGJ1ZitPRkZTRVRfTU9EU0VRKSkg
PSBodG9ubChyZWNvcmQtPm1vZHNlcSk7CisjZW5kaWYKIH0KIAogLyoKQEAgLTE1MTIsNiArMTUz
OCwxNSBAQAogCSooKGJpdDMyICopKGJ1ZitPRkZTRVRfUVVPVEFfTUFJTEJPWF9VU0VENjQpKSA9
IGh0b25sKDApOwogICAgIH0KIAorICAgIGlmIChudG9obCgqKChiaXQzMiAqKShidWYrT0ZGU0VU
X01JTk9SX1ZFUlNJT04pKSkgPCA4KSB7CisjaWZkZWYgSEFWRV9MT05HX0xPTkdfSU5UCisJKigo
Yml0NjQgKikoYnVmK09GRlNFVF9ISUdIRVNUTU9EU0VRXzY0KSkgPSBodG9ubGwoMSk7CisjZWxz
ZQorCSooKGJpdDMyICopKGJ1ZitPRkZTRVRfSElHSEVTVE1PRFNFUV82NCkpID0gaHRvbmwoMCk7
CisJKigoYml0MzIgKikoYnVmK09GRlNFVF9ISUdIRVNUTU9EU0VRKSkgPSBodG9ubCgxKTsKKyNl
bmRpZgorICAgIH0KKwogICAgIC8qIGNoYW5nZSB2ZXJzaW9uIG51bWJlciAqLwogICAgICooKGJp
dDMyICopKGJ1ZitPRkZTRVRfTUlOT1JfVkVSU0lPTikpID0gaHRvbmwoTUFJTEJPWF9NSU5PUl9W
RVJTSU9OKTsKIApAQCAtMTU0OCwxMSArMTU4MywxNiBAQAogICAgIGlmIChvbGRzdGFydF9vZmZz
ZXQgPCBPRkZTRVRfUE9QM19ORVdfVUlETC1xdW90YV9vZmZzZXQrc2l6ZW9mKGJpdDMyKSkgewog
CSooKGJpdDMyICopKGJ1ZitPRkZTRVRfUE9QM19ORVdfVUlETCkpID0gaHRvbmwoIWV4aXN0cyk7
CiAgICAgfQotICAgIGlmIChvbGRzdGFydF9vZmZzZXQgPCBPRkZTRVRfTEVBS0VEX0NBQ0hFLXF1
b3RhX29mZnNldCtzaXplb2YoYml0MzIpKSB7Ci0JKigoYml0MzIgKikoYnVmK09GRlNFVF9MRUFL
RURfQ0FDSEUpKSA9IGh0b25sKDApOworI2lmIDAKKyAgICBpZiAob2xkc3RhcnRfb2Zmc2V0IDwg
T0ZGU0VUX0hJR0hFU1RNT0RTRVEtcXVvdGFfb2Zmc2V0K3NpemVvZihiaXQzMikgfHwKKwkhbnRv
aGxsKCooKGJpdDY0ICopKGJ1ZitPRkZTRVRfSElHSEVTVE1PRFNFUV82NCkpKSkgeworCSooKGJp
dDY0ICopKGJ1ZitPRkZTRVRfSElHSEVTVE1PRFNFUV82NCkpID0gaHRvbmxsKDEpOwogICAgIH0K
KyNlbmRpZgorICAgICooKGJpdDMyICopKGJ1ZitPRkZTRVRfU1BBUkUwKSkgPSBodG9ubCgwKTsg
LyogUkVTRVJWRUQgKi8KICAgICAqKChiaXQzMiAqKShidWYrT0ZGU0VUX1NQQVJFMSkpID0gaHRv
bmwoMCk7IC8qIFJFU0VSVkVEICovCiAgICAgKigoYml0MzIgKikoYnVmK09GRlNFVF9TUEFSRTIp
KSA9IGh0b25sKDApOyAvKiBSRVNFUlZFRCAqLworICAgICooKGJpdDMyICopKGJ1ZitPRkZTRVRf
U1BBUkUzKSkgPSBodG9ubCgwKTsgLyogUkVTRVJWRUQgKi8KIAogICAgIC8qIFdyaXRlIG5ldyBo
ZWFkZXIgKi8KICAgICBmd3JpdGUoYnVmLCAxLCBJTkRFWF9IRUFERVJfU0laRSwgbmV3aW5kZXgp
OwpAQCAtMTU5NSw2ICsxNjM1LDE2IEBACiAgICAgICAgICAgICBpZiAob2xkcmVjb3JkX3NpemUg
PCBPRkZTRVRfTUVTU0FHRV9VVUlEK01FU1NBR0VfVVVJRF9QQUNLRURfU0laRSkKICAgICAgICAg
ICAgICAgICBtZW1zZXQoYnVmK09GRlNFVF9NRVNTQUdFX1VVSUQsIDAsIE1FU1NBR0VfVVVJRF9Q
QUNLRURfU0laRSk7CiAKKwkgICAgLyogU2V0IHRoZSBpbml0aWFsIG1vZHNlcSB0byAxICovCisJ
ICAgIGlmIChvbGRyZWNvcmRfc2l6ZSA8IE9GRlNFVF9NT0RTRVErNCkgeworI2lmZGVmIEhBVkVf
TE9OR19MT05HX0lOVAorCQkqKChiaXQ2NCAqKShidWYrT0ZGU0VUX01PRFNFUV82NCkpID0gaHRv
bmxsKDEpOworI2Vsc2UKKwkJKigoYml0MzIgKikoYnVmK09GRlNFVF9NT0RTRVFfNjQpKSA9IGh0
b25sKDApOworCQkqKChiaXQzMiAqKShidWYrT0ZGU0VUX01PRFNFUSkpID0gaHRvbmwoMSk7Cisj
ZW5kaWYKKwkgICAgfQorCiAJICAgIGZ3cml0ZShidWYrb2xkcmVjb3JkX3NpemUsIHJlY3NpemVf
ZGlmZiwgMSwgbmV3aW5kZXgpOwogCX0KICAgICB9CkBAIC0yNTcxLDYgKzI2MjEsOCBAQAogICAg
IG1haWxib3guYW5zd2VyZWQgPSAwOwogICAgIG1haWxib3guZmxhZ2dlZCA9IDA7CiAgICAgbWFp
bGJveC5wb3AzX25ld191aWRsID0gMTsKKyAgICBtYWlsYm94LmxlYWtlZF9jYWNoZV9yZWNvcmRz
ID0gMDsKKyAgICBtYWlsYm94LmhpZ2hlc3Rtb2RzZXEgPSAwOwogCiAgICAgaWYgKCF1bmlxdWVp
ZCkgewogCXNpemVfdCB1bmlxdWVfc2l6ZSA9IHNpemVvZihjaGFyKSAqIDMyOwpJbmRleDogaW1h
cC9tYWlsYm94LmgKPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PQpSQ1MgZmlsZTogL2Fmcy9hbmRyZXcvc3lzdGVtL2N2cy9z
cmMvY3lydXMvaW1hcC9tYWlsYm94LmgsdgpyZXRyaWV2aW5nIHJldmlzaW9uIDEuNzcuMi4xMQpk
aWZmIC11IC1yMS43Ny4yLjExIG1haWxib3guaAotLS0gaW1hcC9tYWlsYm94LmgJMjcgTWF5IDIw
MDUgMTc6NDA6NTQgLTAwMDAJMS43Ny4yLjExCisrKyBpbWFwL21haWxib3guaAkxMyBEZWMgMjAw
NSAxNjoyNzo1OSAtMDAwMApAQCAtNTAsNiArNTAsNyBAQAogI2luY2x1ZGUgImF1dGguaCIKICNp
bmNsdWRlICJxdW90YS5oIgogI2luY2x1ZGUgIm1lc3NhZ2VfdXVpZC5oIgorI2luY2x1ZGUgImJ5
dGVvcmRlcjY0LmgiCiAKIAogI2RlZmluZSBCSVQzMl9NQVggNDI5NDk2NzI5NVUKQEAgLTY2LDYg
KzY3LDExIEBACiAKICNpZmRlZiBIQVZFX0xPTkdfTE9OR19JTlQKIHR5cGVkZWYgdW5zaWduZWQg
bG9uZyBsb25nIGludCBiaXQ2NDsKK3R5cGVkZWYgdW5zaWduZWQgbG9uZyBsb25nIGludCBtb2Rz
ZXFfdDsKKyNkZWZpbmUgTU9EU0VRX0ZNVCAiJWxsdSIKKyNlbHNlIAordHlwZWRlZiB1bnNpZ25l
ZCBsb25nIGludCBtb2RzZXFfdDsKKyNkZWZpbmUgTU9EU0VRX0ZNVCAiJWx1IgogI2VuZGlmCiAK
ICNkZWZpbmUgTUFYX01BSUxCT1hfTkFNRSA0OTAKQEAgLTgwLDcgKzg2LDcgQEAKICNkZWZpbmUg
TUFJTEJPWF9GT1JNQVRfTk9STUFMCTAKICNkZWZpbmUgTUFJTEJPWF9GT1JNQVRfTkVUTkVXUwkx
CiAKLSNkZWZpbmUgTUFJTEJPWF9NSU5PUl9WRVJTSU9OCTcKKyNkZWZpbmUgTUFJTEJPWF9NSU5P
Ul9WRVJTSU9OCTgKICNkZWZpbmUgTUFJTEJPWF9DQUNIRV9NSU5PUl9WRVJTSU9OIDIKIAogI2Rl
ZmluZSBGTkFNRV9IRUFERVIgIi9jeXJ1cy5oZWFkZXIiCkBAIC0xNDYsOSArMTUyLDE3IEBACiAK
ICAgICBpbnQgcG9wM19uZXdfdWlkbDsKICAgICB1bnNpZ25lZCBsb25nIGxlYWtlZF9jYWNoZV9y
ZWNvcmRzOworICAgIG1vZHNlcV90IGhpZ2hlc3Rtb2RzZXE7CiAKLSAgICAvKiBmdXR1cmUgZXhw
YW5zaW9uIC0tIHdvbid0IG5lZWQgZXhwYW5kIHRoZSBoZWFkZXIgKi8KLSAgICB1bnNpZ25lZCBs
b25nIHNwYXJlc1syXTsKKyAgICAvKgorICAgICAqIGZ1dHVyZSBleHBhbnNpb24gLS0gd29uJ3Qg
bmVlZCBleHBhbmQgdGhlIGhlYWRlcgorICAgICAqCisgICAgICogSWYgdGhlIGNoYW5nZSB0byB0
aGUgaW5kZXggaGVhZGVyIGNoYW5nZSBhbHNvIGluY2x1ZGVzIGEgY2hhbmdlCisgICAgICogdG8g
dGhlIGluZGV4IHJlY29yZCwgdGhlcmUgaXMgbm8gYmVuZWZpdCB0byB1c2luZyBhIHNwYXJlLiAg
SW4KKyAgICAgKiB0aGlzIGNhc2UsIGp1c3QgYWRkIGEgbmV3IGZpZWxkLCBhbmQgb3B0aW9uYWxs
eSBhZGQgc29tZSBtb3JlCisgICAgICogc3BhcmVzLgorICAgICAqLworICAgIHVuc2lnbmVkIGxv
bmcgc3BhcmVzWzRdOwogCiAgICAgc3RydWN0IHF1b3RhIHF1b3RhOwogCkBAIC0xNzMsNiArMTg3
LDcgQEAKICAgICB1bnNpZ25lZCBsb25nIGNvbnRlbnRfbGluZXM7CiAgICAgdW5zaWduZWQgbG9u
ZyBjYWNoZV92ZXJzaW9uOwogICAgIHN0cnVjdCBtZXNzYWdlX3V1aWQgdXVpZDsKKyAgICBtb2Rz
ZXFfdCBtb2RzZXE7CiB9OwogCiAvKiBPZmZzZXRzIG9mIGluZGV4L2V4cHVuZ2UgaGVhZGVyIGZp
ZWxkcyAqLwpAQCAtMTkzLDggKzIwOCwxMiBAQAogI2RlZmluZSBPRkZTRVRfRkxBR0dFRCA1Ngog
I2RlZmluZSBPRkZTRVRfUE9QM19ORVdfVUlETCA2MAkvKiBhZGRlZCBmb3IgT3V0bG9vayBzdHVw
aWRpdHkgKi8KICNkZWZpbmUgT0ZGU0VUX0xFQUtFRF9DQUNIRSA2NCAvKiBOdW1iZXIgb2YgbGVh
a2VkIHJlY29yZHMgaW4gY2FjaGUgZmlsZSAqLwotI2RlZmluZSBPRkZTRVRfU1BBUkUxIDY4Ci0j
ZGVmaW5lIE9GRlNFVF9TUEFSRTIgNzIKKyNkZWZpbmUgT0ZGU0VUX0hJR0hFU1RNT0RTRVFfNjQg
NjggLyogQ09ORFNUT1JFICg2NC1iaXQgbW9kc2VxKSAqLworI2RlZmluZSBPRkZTRVRfSElHSEVT
VE1PRFNFUSA3MiAgICAvKiBDT05EU1RPUkUgKDMyLWJpdCBtb2RzZXEpICovCisjZGVmaW5lIE9G
RlNFVF9TUEFSRTAgNzYgLyogU3BhcmVzIC0gb25seSB1c2UgdGhlc2UgaWYgdGhlIGluZGV4ICov
CisjZGVmaW5lIE9GRlNFVF9TUEFSRTEgODAgLyogIHJlY29yZCBzaXplIHJlbWFpbnMgdGhlIHNh
bWUgKi8KKyNkZWZpbmUgT0ZGU0VUX1NQQVJFMiA4NCAvKiAgKHNlZSBub3RlIGFib3ZlIGFib3V0
IHNwYXJlcykgKi8KKyNkZWZpbmUgT0ZGU0VUX1NQQVJFMyA4OAogCiAvKiBPZmZzZXRzIG9mIGlu
ZGV4X3JlY29yZCBmaWVsZHMgaW4gaW5kZXgvZXhwdW5nZSBmaWxlICovCiAjZGVmaW5lIE9GRlNF
VF9VSUQgMApAQCAtMjEwLDkgKzIyOSwxMSBAQAogI2RlZmluZSBPRkZTRVRfQ09OVEVOVF9MSU5F
UyAoT0ZGU0VUX1VTRVJfRkxBR1MrTUFYX1VTRVJfRkxBR1MvOCkgLyogYWRkZWQgZm9yIG5udHBk
ICovCiAjZGVmaW5lIE9GRlNFVF9DQUNIRV9WRVJTSU9OIE9GRlNFVF9DT05URU5UX0xJTkVTK3Np
emVvZihiaXQzMikKICNkZWZpbmUgT0ZGU0VUX01FU1NBR0VfVVVJRCBPRkZTRVRfQ0FDSEVfVkVS
U0lPTitzaXplb2YoYml0MzIpCisjZGVmaW5lIE9GRlNFVF9NT0RTRVFfNjQgKE9GRlNFVF9NRVNT
QUdFX1VVSUQrTUVTU0FHRV9VVUlEX1BBQ0tFRF9TSVpFKSAvKiBDT05EU1RPUkUgKDY0LWJpdCBt
b2RzZXEpICovCisjZGVmaW5lIE9GRlNFVF9NT0RTRVEgKE9GRlNFVF9NT0RTRVFfNjQrc2l6ZW9m
KGJpdDMyKSkgLyogQ09ORFNUT1JFICgzMi1iaXQgbW9kc2VxKSAqLwogCi0jZGVmaW5lIElOREVY
X0hFQURFUl9TSVpFIChPRkZTRVRfU1BBUkUyK3NpemVvZihiaXQzMikpCi0jZGVmaW5lIElOREVY
X1JFQ09SRF9TSVpFIChPRkZTRVRfTUVTU0FHRV9VVUlEK01FU1NBR0VfVVVJRF9QQUNLRURfU0la
RSkKKyNkZWZpbmUgSU5ERVhfSEVBREVSX1NJWkUgKE9GRlNFVF9TUEFSRTMrc2l6ZW9mKGJpdDMy
KSkKKyNkZWZpbmUgSU5ERVhfUkVDT1JEX1NJWkUgKE9GRlNFVF9NT0RTRVErc2l6ZW9mKGJpdDMy
KSkKIAogLyogTnVtYmVyIG9mIGZpZWxkcyBpbiBhbiBpbmRpdmlkdWFsIG1lc3NhZ2UncyBjYWNo
ZSByZWNvcmQgKi8KICNkZWZpbmUgTlVNX0NBQ0hFX0ZJRUxEUyAxMApJbmRleDogaW1hcC9tYmV4
YW1pbmUuYwo9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09ClJDUyBmaWxlOiAvYWZzL2FuZHJldy9zeXN0ZW0vY3ZzL3NyYy9j
eXJ1cy9pbWFwL21iZXhhbWluZS5jLHYKcmV0cmlldmluZyByZXZpc2lvbiAxLjUuMi43CmRpZmYg
LXUgLXIxLjUuMi43IG1iZXhhbWluZS5jCi0tLSBpbWFwL21iZXhhbWluZS5jCTUgRGVjIDIwMDUg
MTU6MDE6MzcgLTAwMDAJMS41LjIuNworKysgaW1hcC9tYmV4YW1pbmUuYwkxMyBEZWMgMjAwNSAx
NjoyNzo1OSAtMDAwMApAQCAtMTIxLDggKzEyMSw4IEBACiAvKiAgICBpZiAoZ2V0ZXVpZCgpID09
IDApIGZhdGFsKCJtdXN0IHJ1biBhcyB0aGUgQ3lydXMgdXNlciIsIEVDX1VTQUdFKTsgKi8KIAog
ICAgIC8qIEVuc3VyZSB3ZSdyZSB1cC10by1kYXRlIG9uIHRoZSBpbmRleCBmaWxlIGZvcm1hdCAq
LwotICAgIGFzc2VydChJTkRFWF9IRUFERVJfU0laRSA9PSAoT0ZGU0VUX1NQQVJFMis0KSk7Ci0g
ICAgYXNzZXJ0KElOREVYX1JFQ09SRF9TSVpFID09IChPRkZTRVRfTUVTU0FHRV9VVUlEK01FU1NB
R0VfVVVJRF9QQUNLRURfU0laRSkpOworICAgIGFzc2VydChJTkRFWF9IRUFERVJfU0laRSA9PSAo
T0ZGU0VUX1NQQVJFMys0KSk7CisgICAgYXNzZXJ0KElOREVYX1JFQ09SRF9TSVpFID09IChPRkZT
RVRfTU9EU0VRKzQpKTsKIAogICAgIHdoaWxlICgob3B0ID0gZ2V0b3B0KGFyZ2MsIGFyZ3YsICJD
OnU6czoiKSkgIT0gRU9GKSB7CiAJc3dpdGNoIChvcHQpIHsKQEAgLTI3OCw2ICsyNzgsMTAgQEAK
IAlwcmludGYoIiAgUE9QMyBOZXcgVUlETDogJWRcbiIsIG1haWxib3gucG9wM19uZXdfdWlkbCk7
CiAgICAgcHJpbnRmKCIgIExhc3QgUE9QMyBMb2dpbjogKCVsZCkgJXMiLCBtYWlsYm94LnBvcDNf
bGFzdF9sb2dpbiwKIAkgICBjdGltZSgmbWFpbGJveC5wb3AzX2xhc3RfbG9naW4pKTsKKyAgICBp
ZiAobWFpbGJveC5taW5vcl92ZXJzaW9uID49IDgpIHsKKwlwcmludGYoIiAgSGlnaGVzdCBNb2Qg
U2VxdWVuY2U6ICIgTU9EU0VRX0ZNVCAiXG4iLAorCSAgICAgICBtYWlsYm94LmhpZ2hlc3Rtb2Rz
ZXEpOworICAgIH0KIAogICAgIHByaW50ZigiXG4gTWVzc2FnZSBJbmZvOlxuIik7CiAKQEAgLTMw
OCw2ICszMTIsMTAgQEAKIAogCWlmIChtYWlsYm94Lm1pbm9yX3ZlcnNpb24gPj0gNikKIAkgICAg
cHJpbnRmKCIgQ0FDSEVWRVI6JS02ZCIsIENBQ0hFX1ZFUlNJT04oaSkpOworCisJaWYgKG1haWxi
b3gubWlub3JfdmVyc2lvbiA+PSA4KSB7CisJICAgIHByaW50ZigiIE1PRFNFUToiIE1PRFNFUV9G
TVQsIE1PRFNFUShpKSk7CisJfQogCiAJcHJpbnRmKCJcbiIpOwogCkluZGV4OiBpbWFwL3JlY29u
c3RydWN0LmMKPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PQpSQ1MgZmlsZTogL2Fmcy9hbmRyZXcvc3lzdGVtL2N2cy9zcmMv
Y3lydXMvaW1hcC9yZWNvbnN0cnVjdC5jLHYKcmV0cmlldmluZyByZXZpc2lvbiAxLjgxLjIuMTYK
ZGlmZiAtdSAtcjEuODEuMi4xNiByZWNvbnN0cnVjdC5jCi0tLSBpbWFwL3JlY29uc3RydWN0LmMJ
MjcgTWFyIDIwMDUgMTQ6MzY6MjUgLTAwMDAJMS44MS4yLjE2CisrKyBpbWFwL3JlY29uc3RydWN0
LmMJMTMgRGVjIDIwMDUgMTY6Mjc6NTkgLTAwMDAKQEAgLTk0LDcgKzk0LDYgQEAKICNpbmNsdWRl
ICJyZXRyeS5oIgogI2luY2x1ZGUgImNvbnZlcnRfY29kZS5oIgogI2luY2x1ZGUgInV0aWwuaCIK
LSNpbmNsdWRlICJieXRlb3JkZXI2NC5oIgogCiBleHRlcm4gaW50IG9wdGluZDsKIGV4dGVybiBj
aGFyICpvcHRhcmc7CkBAIC0xMzksOCArMTM4LDggQEAKICAgICBpZiAoZ2V0ZXVpZCgpID09IDAp
IGZhdGFsKCJtdXN0IHJ1biBhcyB0aGUgQ3lydXMgdXNlciIsIEVDX1VTQUdFKTsKIAogICAgIC8q
IEVuc3VyZSB3ZSdyZSB1cC10by1kYXRlIG9uIHRoZSBpbmRleCBmaWxlIGZvcm1hdCAqLwotICAg
IGFzc2VydChJTkRFWF9IRUFERVJfU0laRSA9PSAoT0ZGU0VUX1NQQVJFMis0KSk7Ci0gICAgYXNz
ZXJ0KElOREVYX1JFQ09SRF9TSVpFID09IChPRkZTRVRfTUVTU0FHRV9VVUlEK01FU1NBR0VfVVVJ
RF9QQUNLRURfU0laRSkpOworICAgIGFzc2VydChJTkRFWF9IRUFERVJfU0laRSA9PSAoT0ZGU0VU
X1NQQVJFMys0KSk7CisgICAgYXNzZXJ0KElOREVYX1JFQ09SRF9TSVpFID09IChPRkZTRVRfTU9E
U0VRKzQpKTsKIAogICAgIHdoaWxlICgob3B0ID0gZ2V0b3B0KGFyZ2MsIGFyZ3YsICJDOnA6cm1m
eCIpKSAhPSBFT0YpIHsKIAlzd2l0Y2ggKG9wdCkgewpAQCAtNTM2LDYgKzUzNSw3IEBACiAJLyog
SWYgd2UgY2FuJ3QgcmVhZCB0aGUgaW5kZXgsIGFzc3VtZSBuZXcgVUlETCBzbyB0aGF0IHN0dXBp
ZCBjbGllbnRzCiAJICAgd2lsbCByZXRyaWV2ZSBhbGwgb2YgdGhlIG1lc3NhZ2VzIGluIHRoZSBt
YWlsYm94LiAqLwogCW1haWxib3gucG9wM19uZXdfdWlkbCA9IDE7CisJbWFpbGJveC5oaWdoZXN0
bW9kc2VxID0gMTsKICAgICB9CiAgICAgZWxzZSB7CiAJKHZvaWQpIG1haWxib3hfbG9ja19pbmRl
eCgmbWFpbGJveCk7CkBAIC03MTMsNiArNzEzLDcgQEAKIAlpZiAob2xkX2luZGV4LnVpZCA9PSB1
aWRbbXNnXSkgewogCSAgICAvKiBVc2UgZGF0YSBpbiBvbGQgaW5kZXggZmlsZSwgc3ViamVjdCB0
byB2YWxpZGl0eSBjaGVja3MgKi8KIAkgICAgbWVzc2FnZV9pbmRleC5pbnRlcm5hbGRhdGUgPSBv
bGRfaW5kZXguaW50ZXJuYWxkYXRlOworCSAgICBtZXNzYWdlX2luZGV4Lm1vZHNlcSA9IG9sZF9p
bmRleC5tb2RzZXE7CiAJICAgIG1lc3NhZ2VfaW5kZXguc3lzdGVtX2ZsYWdzID0gb2xkX2luZGV4
LnN5c3RlbV9mbGFncyAmCiAJICAgICAgKEZMQUdfQU5TV0VSRUR8RkxBR19GTEFHR0VEfEZMQUdf
REVMRVRFRHxGTEFHX0RSQUZUKTsKIAkgICAgZm9yIChpID0gMDsgaSA8IE1BWF9VU0VSX0ZMQUdT
LzMyOyBpKyspIHsKQEAgLTczMCw4ICs3MzEsMTMgQEAKIAkgICAgbWFpbGJveC5wb3AzX25ld191
aWRsID0gMTsKICAgICAgICAgICAgIC8qIFdpcGUgdGhlIE1lc3NhZ2UgVVVJRCAqLwogICAgICAg
ICAgICAgbWVzc2FnZV91dWlkX3NldF9udWxsKCZtZXNzYWdlX2luZGV4LnV1aWQpOworCSAgICAv
KiBJZiB3ZSBhcmUgcmVjb3ZlcmluZyBhIG1lc3NhZ2UsIHJlc2V0IE1PRFNFUSAqLworCSAgICBt
ZXNzYWdlX2luZGV4Lm1vZHNlcSA9IDE7CiAJfQogCW1lc3NhZ2VfaW5kZXgubGFzdF91cGRhdGVk
ID0gdGltZSgwKTsKKwlpZiAobWVzc2FnZV9pbmRleC5tb2RzZXEgPiBtYWlsYm94LmhpZ2hlc3Rt
b2RzZXEpIHsKKwkgICAgbWFpbGJveC5oaWdoZXN0bW9kc2VxID0gbWVzc2FnZV9pbmRleC5tb2Rz
ZXE7CisJfQogCQogCWlmICgoKHIgPSBtZXNzYWdlX3BhcnNlX2ZpbGUobXNnZmlsZSwgTlVMTCwg
TlVMTCwgJmJvZHkpKSAhPSAwKSB8fAogCSAgICAoKHIgPSBtZXNzYWdlX2NyZWF0ZV9yZWNvcmQo
Jm1haWxib3gsICZtZXNzYWdlX2luZGV4LCBib2R5KSkgIT0gMCkpIHsKQEAgLTc3NSw2ICs3ODEs
NyBAQAogICAgIGlmIChtYWlsYm94LnVpZHZhbGlkaXR5ID09IDAgfHwgbWFpbGJveC51aWR2YWxp
ZGl0eSA+IHRpbWUoMCkpIHsKIAltYWlsYm94LnVpZHZhbGlkaXR5ID0gdGltZSgwKTsKICAgICB9
CisKICAgICBmcmVlKHVpZCk7CiAgICAgKigoYml0MzIgKikoYnVmK09GRlNFVF9HRU5FUkFUSU9O
X05PKSkgPSBodG9ubChtYWlsYm94LmdlbmVyYXRpb25fbm8gKyAxKTsKICAgICAqKChiaXQzMiAq
KShidWYrT0ZGU0VUX0ZPUk1BVCkpID0gaHRvbmwobWFpbGJveC5mb3JtYXQpOwpAQCAtODAxLDgg
KzgwOCwxNyBAQAogICAgICooKGJpdDMyICopKGJ1ZitPRkZTRVRfRkxBR0dFRCkpID0gaHRvbmwo
bmV3X2ZsYWdnZWQpOwogICAgICooKGJpdDMyICopKGJ1ZitPRkZTRVRfUE9QM19ORVdfVUlETCkp
ID0gaHRvbmwobWFpbGJveC5wb3AzX25ld191aWRsKTsKICAgICAqKChiaXQzMiAqKShidWYrT0ZG
U0VUX0xFQUtFRF9DQUNIRSkpID0gaHRvbmwoMCk7Ci0KLSAgICBtZXNzYWdlX3V1aWRfcGFjaygm
bWVzc2FnZV9pbmRleC51dWlkLCBidWYrT0ZGU0VUX01FU1NBR0VfVVVJRCk7CisjaWZkZWYgSEFW
RV9MT05HX0xPTkdfSU5UCisgICAgKigoYml0NjQgKikoYnVmK09GRlNFVF9ISUdIRVNUTU9EU0VR
XzY0KSkgPSBodG9ubGwobWFpbGJveC5oaWdoZXN0bW9kc2VxKTsKKyNlbHNlCisgICAgLyogemVy
byB0aGUgdW51c2VkIDMyYml0cyAqLworICAgICooKGJpdDMyICopKGJ1ZitPRkZTRVRfSElHSEVT
VE1PRFNFUV82NCkpID0gaHRvbmwoMCk7CisgICAgKigoYml0MzIgKikoYnVmK09GRlNFVF9ISUdI
RVNUTU9EU0VRKSkgPSBodG9ubChtYWlsYm94LmhpZ2hlc3Rtb2RzZXEpOworI2VuZGlmCisgICAg
KigoYml0MzIgKikoYnVmK09GRlNFVF9TUEFSRTApKSA9IGh0b25sKDApOyAvKiBSRVNFUlZFRCAq
LworICAgICooKGJpdDMyICopKGJ1ZitPRkZTRVRfU1BBUkUxKSkgPSBodG9ubCgwKTsgLyogUkVT
RVJWRUQgKi8KKyAgICAqKChiaXQzMiAqKShidWYrT0ZGU0VUX1NQQVJFMikpID0gaHRvbmwoMCk7
IC8qIFJFU0VSVkVEICovCisgICAgKigoYml0MzIgKikoYnVmK09GRlNFVF9TUEFSRTMpKSA9IGh0
b25sKDApOyAvKiBSRVNFUlZFRCAqLwogCiAgICAgbiA9IGZ3cml0ZShidWYsIDEsIElOREVYX0hF
QURFUl9TSVpFLCBuZXdpbmRleCk7CiAgICAgZmZsdXNoKG5ld2luZGV4KTsKSW5kZXg6IGltYXAv
c3F1YXR0ZXIuYwo9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09ClJDUyBmaWxlOiAvYWZzL2FuZHJldy9zeXN0ZW0vY3ZzL3Ny
Yy9jeXJ1cy9pbWFwL3NxdWF0dGVyLmMsdgpyZXRyaWV2aW5nIHJldmlzaW9uIDEuMTIuMi40CmRp
ZmYgLXUgLXIxLjEyLjIuNCBzcXVhdHRlci5jCi0tLSBpbWFwL3NxdWF0dGVyLmMJMjUgTWF5IDIw
MDQgMDE6Mjg6MTMgLTAwMDAJMS4xMi4yLjQKKysrIGltYXAvc3F1YXR0ZXIuYwkxMyBEZWMgMjAw
NSAxNjoyNzo1OSAtMDAwMApAQCAtMTA5LDYgKzEwOSw3IEBACiBzdHJ1Y3QgcHJvdHN0cmVhbSAq
aW1hcGRfb3V0ID0gTlVMTDsKIHN0cnVjdCBhdXRoX3N0YXRlICppbWFwZF9hdXRoc3RhdGUgPSBO
VUxMOwogY2hhciAqaW1hcGRfdXNlcmlkID0gTlVMTDsKK2ludCBpbWFwZF9jb25kc3RvcmVfZW5h
YmxlZCA9IDA7CiB2b2lkIHByaW50YXN0cmluZyhjb25zdCBjaGFyICpzIF9fYXR0cmlidXRlX18o
KHVudXNlZCkpKQogewogICAgIGZhdGFsKCJub3QgaW1wbGVtZW50ZWQiLCBFQ19TT0ZUV0FSRSk7
CkluZGV4OiBpbWFwL3VuZXhwdW5nZS5jCj09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KUkNTIGZpbGU6IC9hZnMvYW5kcmV3
L3N5c3RlbS9jdnMvc3JjL2N5cnVzL2ltYXAvQXR0aWMvdW5leHB1bmdlLmMsdgpyZXRyaWV2aW5n
IHJldmlzaW9uIDEuMS4yLjQKZGlmZiAtdSAtcjEuMS4yLjQgdW5leHB1bmdlLmMKLS0tIGltYXAv
dW5leHB1bmdlLmMJMyBNYXkgMjAwNSAwMTozMjoxNCAtMDAwMAkxLjEuMi40CisrKyBpbWFwL3Vu
ZXhwdW5nZS5jCTEzIERlYyAyMDA1IDE2OjI3OjU5IC0wMDAwCkBAIC01Nyw3ICs1Nyw2IEBACiAj
aW5jbHVkZSA8c2lnbmFsLmg+CiAKICNpbmNsdWRlICJhbm5vdGF0ZS5oIgotI2luY2x1ZGUgImJ5
dGVvcmRlcjY0LmgiCiAjaW5jbHVkZSAiY3lydXNkYi5oIgogI2luY2x1ZGUgImR1cGxpY2F0ZS5o
IgogI2luY2x1ZGUgImV4aXRjb2Rlcy5oIgpJbmRleDogaW1hcC92ZXJzaW9uLmgKPT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PQpSQ1MgZmlsZTogL2Fmcy9hbmRyZXcvc3lzdGVtL2N2cy9zcmMvY3lydXMvaW1hcC92ZXJzaW9u
LmgsdgpyZXRyaWV2aW5nIHJldmlzaW9uIDEuMTI4LjIuNgpkaWZmIC11IC1yMS4xMjguMi42IHZl
cnNpb24uaAotLS0gaW1hcC92ZXJzaW9uLmgJMjEgTm92IDIwMDUgMTc6MTM6MzAgLTAwMDAJMS4x
MjguMi42CisrKyBpbWFwL3ZlcnNpb24uaAkxMyBEZWMgMjAwNSAxNjoyNzo1OSAtMDAwMApAQCAt
NTgsOCArNTgsOCBAQAogCSJNQUlMQk9YLVJFRkVSUkFMUyBOQU1FU1BBQ0UgVUlEUExVUyBJRCAi
IFwKIAkiTk9fQVRPTUlDX1JFTkFNRSBVTlNFTEVDVCAiIFwKIAkiQ0hJTERSRU4gTVVMVElBUFBF
TkQgQklOQVJZICIgXAotCSJTT1JUIFRIUkVBRD1PUkRFUkVEU1VCSkVDVCBUSFJFQUQ9UkVGRVJF
TkNFUyAiIFwKLQkiQU5OT1RBVEVNT1JFIENBVEVOQVRFIgorCSJTT1JUIFNPUlQ9TU9EU0VRIFRI
UkVBRD1PUkRFUkVEU1VCSkVDVCBUSFJFQUQ9UkVGRVJFTkNFUyAiIFwKKwkiQU5OT1RBVEVNT1JF
IENBVEVOQVRFIENPTkRTVE9SRSIKIAogCiAvKiBWYWx1ZXMgZm9yIElEIHByb2Nlc3NpbmcgKi8K
</data>        

          </attachment>
          <attachment
              isobsolete="0"
              ispatch="1"
              isprivate="0"
          >
            <attachid>406</attachid>
            <date>2005-12-13 21:23 EDT</date>
            <desc>CONDSTORE patch</desc>
            <filename>CONDSTORE.patch</filename>
            <type>text/plain</type>
            <size>45480</size>
            <attacher>murch@andrew.cmu.edu</attacher>
            
              <data encoding="base64">SW5kZXg6IGRvYy9zcGVjcy5odG1sCj09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KUkNTIGZpbGU6IC9hZnMvYW5kcmV3L3N5
c3RlbS9jdnMvc3JjL2N5cnVzL2RvYy9zcGVjcy5odG1sLHYKcmV0cmlldmluZyByZXZpc2lvbiAx
LjUwLjIuMTkKZGlmZiAtdSAtcjEuNTAuMi4xOSBzcGVjcy5odG1sCi0tLSBkb2Mvc3BlY3MuaHRt
bAkxMyBEZWMgMjAwNSAxOTozNTo0OCAtMDAwMAkxLjUwLjIuMTkKKysrIGRvYy9zcGVjcy5odG1s
CTE0IERlYyAyMDA1IDAyOjE4OjU4IC0wMDAwCkBAIC00OSw2ICs0OSw5IEBACiA8VFI+PFREPjxB
IEhSRUY9Imh0dHA6Ly93d3cuaWV0Zi5vcmcvaW50ZXJuZXQtZHJhZnRzL2RyYWZ0LWlldGYtaW1h
cGV4dC1saXN0LWV4dGVuc2lvbnMtMTMudHh0Ij4KIGRyYWZ0LWlldGYtaW1hcGV4dC1saXN0LWV4
dGVuc2lvbnM8L0E+PC9URD4KIDxURD5JTUFQNCBMSVNUIENvbW1hbmQgRXh0ZW5zaW9uczwvVEQ+
PC9UUj4KKzxUUj48VEQ+PEEgSFJFRj0iaHR0cDovL3d3dy5pZXRmLm9yZy9pbnRlcm5ldC1kcmFm
dHMvZHJhZnQtaWV0Zi1pbWFwZXh0LWNvbmRzdG9yZS0wNy50eHQiPgorZHJhZnQtaWV0Zi1pbWFw
ZXh0LWNvbmRzdG9yZTwvQT48L1REPgorPFREPklNQVAgRXh0ZW5zaW9uIGZvciBDb25kaXRpb25h
bCBTVE9SRSBvcGVyYXRpb248L1REPjwvVFI+CiA8VFI+PFREPjxBIEhSRUY9Imh0dHA6Ly93d3cu
aWV0Zi5vcmcvaW50ZXJuZXQtZHJhZnRzL2RyYWZ0LWlldGYtbGVtb25hZGUtY2F0ZW5hdGUtMDUu
dHh0Ij4KIGRyYWZ0LWlldGYtbGVtb25hZGUtY2F0ZW5hdGU8L0E+PC9URD4KIDxURD5JbnRlcm5l
dCBNZXNzYWdlIEFjY2VzcyBQcm90b2NvbCAoSU1BUCkgQ0FURU5BVEUgRXh0ZW5zaW9uPC9URD48
L1RSPgpJbmRleDogZG9jL2ludGVybmFsL21haWxib3gtZm9ybWF0Lmh0bWwKPT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQpS
Q1MgZmlsZTogL2Fmcy9hbmRyZXcvc3lzdGVtL2N2cy9zcmMvY3lydXMvZG9jL2ludGVybmFsL21h
aWxib3gtZm9ybWF0Lmh0bWwsdgpyZXRyaWV2aW5nIHJldmlzaW9uIDEuMy4yLjUKZGlmZiAtdSAt
cjEuMy4yLjUgbWFpbGJveC1mb3JtYXQuaHRtbAotLS0gZG9jL2ludGVybmFsL21haWxib3gtZm9y
bWF0Lmh0bWwJMTIgRGVjIDIwMDUgMjE6NDA6NDMgLTAwMDAJMS4zLjIuNQorKysgZG9jL2ludGVy
bmFsL21haWxib3gtZm9ybWF0Lmh0bWwJMTQgRGVjIDIwMDUgMDI6MTg6NTggLTAwMDAKQEAgLTE3
Nyw2ICsxNzcsMTEgQEAKIAogPGR0PkxlYWtlZCBDYWNoZSAoNCBieXRlcyk8L2R0PiAKIDxkZD4g
TnVtYmVyIG9mIGxlYWtlZCByZWNvcmRzIGluIHRoZSBjYWNoZSBmaWxlLjwvZGQ+CisKKzxkdD5I
aWdoZXN0TW9kU2VxICg4IGJ5dGVzKTwvZHQ+CisKKzxkZD4gSGlnaGVzdCBNb2RpZmljYXRpb24g
U2VxdWVuY2Ugb2YgYWxsIHRoZSBtZXNzYWdlcyBpbiB0aGUKK21haWxib3ggKENPTkRTVE9SRSku
PC9kZD4KIDwvZGw+CiAKIDxwPgpAQCAtMjMwLDYgKzIzNSw5IEBACiAKIDxkdD5VVUlEIChNRVNT
QUdFX1VVSURfU0laRSBieXRlcyk8L2R0PgogPGRkPlVuaXZlcnNhbCBVSUQgb2YgdGhlIG1lc3Nh
Z2UgKHVzZWQgYnkgcmVwbGljYXRpb24gY29kZSkuPC9kZD4KKworPGR0Pk1PRFNFUSAoOCBieXRl
cyk8L2R0PgorPGRkPk1vZGlmaWNhdGlvbiBTZXF1ZW5jZSBvZiB0aGUgbWVzc2FnZSAoQ09ORFNU
T1JFKS48L2RkPgogPC9kbD4KIAogPGgzPjx0dD5jeXJ1cy5jYWNoZTwvdHQ+IGZpbGUgZm9ybWF0
IGRldGFpbDwvaDM+CkluZGV4OiBpbWFwL2FwcGVuZC5jCj09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KUkNTIGZpbGU6IC9h
ZnMvYW5kcmV3L3N5c3RlbS9jdnMvc3JjL2N5cnVzL2ltYXAvYXBwZW5kLmMsdgpyZXRyaWV2aW5n
IHJldmlzaW9uIDEuMTAyLjIuMTIKZGlmZiAtdSAtcjEuMTAyLjIuMTIgYXBwZW5kLmMKLS0tIGlt
YXAvYXBwZW5kLmMJMTMgRGVjIDIwMDUgMTk6MzU6NDkgLTAwMDAJMS4xMDIuMi4xMgorKysgaW1h
cC9hcHBlbmQuYwkxNCBEZWMgMjAwNSAwMjoxODo1OSAtMDAwMApAQCAtMjkxLDYgKzI5MSw3IEBA
CiAgICAgLyogQ2FsY3VsYXRlIG5ldyBpbmRleCBoZWFkZXIgaW5mb3JtYXRpb24gKi8KICAgICBh
cy0+bS5leGlzdHMgKz0gYXMtPm51bW1zZzsKICAgICBhcy0+bS5sYXN0X3VpZCArPSBhcy0+bnVt
bXNnOworICAgIGFzLT5tLmhpZ2hlc3Rtb2RzZXErKzsKICAgICAKICAgICBhcy0+bS5hbnN3ZXJl
ZCArPSBhcy0+bnVtYW5zd2VyZWQ7CiAgICAgYXMtPm0uZGVsZXRlZCArPSBhcy0+bnVtZGVsZXRl
ZDsKQEAgLTU1MCw2ICs1NTEsNyBAQAogCiAgICAgLyogU2V0dXAgKi8KICAgICBtZXNzYWdlX2lu
ZGV4LnVpZCA9IG1haWxib3gtPmxhc3RfdWlkICsgYXMtPm51bW1zZyArIDE7CisgICAgbWVzc2Fn
ZV9pbmRleC5tb2RzZXEgPSBtYWlsYm94LT5oaWdoZXN0bW9kc2VxICsgMTsKICAgICBtZXNzYWdl
X2luZGV4Lmxhc3RfdXBkYXRlZCA9IHRpbWUoMCk7CiAgICAgbWVzc2FnZV9pbmRleC5pbnRlcm5h
bGRhdGUgPSBpbnRlcm5hbGRhdGU7CiAgICAgbHNlZWsobWFpbGJveC0+Y2FjaGVfZmQsIDBMLCBT
RUVLX0VORCk7CkBAIC03MDMsNiArNzA1LDcgQEAKICAgICB6ZXJvX2luZGV4KG1lc3NhZ2VfaW5k
ZXgpOwogICAgIC8qIFNldHVwICovCiAgICAgbWVzc2FnZV9pbmRleC51aWQgPSBtYWlsYm94LT5s
YXN0X3VpZCArIGFzLT5udW1tc2cgKyAxOworICAgIG1lc3NhZ2VfaW5kZXgubW9kc2VxID0gbWFp
bGJveC0+aGlnaGVzdG1vZHNlcSArIDE7CiAgICAgbWVzc2FnZV9pbmRleC5sYXN0X3VwZGF0ZWQg
PSB0aW1lKDApOwogICAgIG1lc3NhZ2VfaW5kZXguaW50ZXJuYWxkYXRlID0gaW50ZXJuYWxkYXRl
OwogICAgIGxzZWVrKG1haWxib3gtPmNhY2hlX2ZkLCAwTCwgU0VFS19FTkQpOwpJbmRleDogaW1h
cC9jeXJkdW1wLmMKPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PQpSQ1MgZmlsZTogL2Fmcy9hbmRyZXcvc3lzdGVtL2N2cy9z
cmMvY3lydXMvaW1hcC9jeXJkdW1wLmMsdgpyZXRyaWV2aW5nIHJldmlzaW9uIDEuMTQuMi40CmRp
ZmYgLXUgLXIxLjE0LjIuNCBjeXJkdW1wLmMKLS0tIGltYXAvY3lyZHVtcC5jCTI3IE1heSAyMDA1
IDE3OjQwOjM4IC0wMDAwCTEuMTQuMi40CisrKyBpbWFwL2N5cmR1bXAuYwkxNCBEZWMgMjAwNSAw
MjoxODo1OSAtMDAwMApAQCAtODUsNiArODUsNyBAQAogc3RydWN0IHByb3RzdHJlYW0gKmltYXBk
X291dCA9IE5VTEw7CiBzdHJ1Y3QgYXV0aF9zdGF0ZSAqaW1hcGRfYXV0aHN0YXRlID0gTlVMTDsK
IGNoYXIgKmltYXBkX3VzZXJpZCA9IE5VTEw7CitpbnQgaW1hcGRfY29uZHN0b3JlX2VuYWJsZWQg
PSAwOwogCiBzdHJ1Y3QgaW5jcmVtZW50YWxfcmVjb3JkIHsKICAgICBpbnQgaW5jcnVpZDsKSW5k
ZXg6IGltYXAvaW1hcGQuYwo9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09ClJDUyBmaWxlOiAvYWZzL2FuZHJldy9zeXN0ZW0v
Y3ZzL3NyYy9jeXJ1cy9pbWFwL2ltYXBkLmMsdgpyZXRyaWV2aW5nIHJldmlzaW9uIDEuNDQzLjIu
NjkKZGlmZiAtdSAtcjEuNDQzLjIuNjkgaW1hcGQuYwotLS0gaW1hcC9pbWFwZC5jCTEzIERlYyAy
MDA1IDE5OjM1OjUwIC0wMDAwCTEuNDQzLjIuNjkKKysrIGltYXAvaW1hcGQuYwkxNCBEZWMgMjAw
NSAwMjoxODo1OSAtMDAwMApAQCAtMTUxLDYgKzE1MSw3IEBACiBzdHJ1Y3QgYXV0aF9zdGF0ZSAq
aW1hcGRfYXV0aHN0YXRlID0gMDsKIHN0YXRpYyBpbnQgaW1hcGRfdXNlcmlzYWRtaW4gPSAwOwog
c3RhdGljIGludCBpbWFwZF91c2VyaXNwcm94eWFkbWluID0gMDsKK2ludCBpbWFwZF9jb25kc3Rv
cmVfZW5hYmxlZCA9IDA7CiBzdGF0aWMgc2FzbF9jb25uX3QgKmltYXBkX3Nhc2xjb25uOyAvKiB0
aGUgc2FzbCBjb25uZWN0aW9uIGNvbnRleHQgKi8KIHN0YXRpYyBpbnQgaW1hcGRfc3RhcnR0bHNf
ZG9uZSA9IDA7IC8qIGhhdmUgd2UgZG9uZSBhIHN1Y2Nlc3NmdWwgc3RhcnR0bHM/ICovCiAjaWZk
ZWYgSEFWRV9TU0wKQEAgLTIwNSw3ICsyMDYsNyBAQAogdm9pZCBjbWRfZmV0Y2goY2hhciAqdGFn
LCBjaGFyICpzZXF1ZW5jZSwgaW50IHVzaW5ndWlkKTsKIHZvaWQgY21kX3BhcnRpYWwoY29uc3Qg
Y2hhciAqdGFnLCBjb25zdCBjaGFyICptc2dubywgY2hhciAqZGF0YSwKIAkJIGNvbnN0IGNoYXIg
KnN0YXJ0LCBjb25zdCBjaGFyICpjb3VudCk7Ci12b2lkIGNtZF9zdG9yZShjaGFyICp0YWcsIGNo
YXIgKnNlcXVlbmNlLCBjaGFyICpvcGVyYXRpb24sIGludCB1c2luZ3VpZCk7Cit2b2lkIGNtZF9z
dG9yZShjaGFyICp0YWcsIGNoYXIgKnNlcXVlbmNlLCBpbnQgdXNpbmd1aWQpOwogdm9pZCBjbWRf
c2VhcmNoKGNoYXIgKnRhZywgaW50IHVzaW5ndWlkKTsKIHZvaWQgY21kX3NvcnQoY2hhciAqdGFn
LCBpbnQgdXNpbmd1aWQpOwogdm9pZCBjbWRfdGhyZWFkKGNoYXIgKnRhZywgaW50IHVzaW5ndWlk
KTsKQEAgLTU3NCw2ICs1NzUsNyBAQAogICAgIH0KICAgICBpbWFwZF91c2VyaXNhZG1pbiA9IDA7
CiAgICAgaW1hcGRfdXNlcmlzcHJveHlhZG1pbiA9IDA7CisgICAgaW1hcGRfY29uZHN0b3JlX2Vu
YWJsZWQgPSAwOwogICAgIGlmIChpbWFwZF9zYXNsY29ubikgewogCXNhc2xfZGlzcG9zZSgmaW1h
cGRfc2FzbGNvbm4pOwogCWltYXBkX3Nhc2xjb25uID0gTlVMTDsKQEAgLTEwNzQsOCArMTA3Niw3
IEBACiAJCWlmIChjICE9ICcgJykgZ290byBtaXNzaW5nYXJnczsKIAkJYyA9IGdldGFzdHJpbmco
aW1hcGRfaW4sIGltYXBkX291dCwgJmFyZzEpOwogCQlpZiAoYyA9PSBFT0YpIGdvdG8gbWlzc2lu
Z2FyZ3M7Ci0JCWlmIChjID09ICdccicpIGMgPSBwcm90X2dldGMoaW1hcGRfaW4pOwotCQlpZiAo
YyAhPSAnXG4nKSBnb3RvIGV4dHJhYXJnczsKKwkJcHJvdF91bmdldGMoYywgaW1hcGRfaW4pOwog
CiAJCWNtZF9zZWxlY3QodGFnLnMsIGNtZC5zLCBhcmcxLnMpOwogCkBAIC0xMjA0LDggKzEyMDUs
NyBAQAogCQlpZiAoYyAhPSAnICcpIGdvdG8gbWlzc2luZ2FyZ3M7CiAJCWMgPSBnZXRhc3RyaW5n
KGltYXBkX2luLCBpbWFwZF9vdXQsICZhcmcxKTsKIAkJaWYgKGMgPT0gRU9GKSBnb3RvIG1pc3Np
bmdhcmdzOwotCQlpZiAoYyA9PSAnXHInKSBjID0gcHJvdF9nZXRjKGltYXBkX2luKTsKLQkJaWYg
KGMgIT0gJ1xuJykgZ290byBleHRyYWFyZ3M7CisJCXByb3RfdW5nZXRjKGMsIGltYXBkX2luKTsK
IAogCQljbWRfc2VsZWN0KHRhZy5zLCBjbWQucywgYXJnMS5zKTsKIApAQCAtMTYxOCwxMCArMTYx
OCw4IEBACiAJICAgIHN0b3JlOgogCQljID0gZ2V0d29yZChpbWFwZF9pbiwgJmFyZzEpOwogCQlp
ZiAoYyAhPSAnICcgfHwgIWltcGFyc2VfaXNzZXF1ZW5jZShhcmcxLnMpKSBnb3RvIGJhZHNlcXVl
bmNlOwotCQljID0gZ2V0d29yZChpbWFwZF9pbiwgJmFyZzIpOwotCQlpZiAoYyAhPSAnICcpIGdv
dG8gbWlzc2luZ2FyZ3M7CiAKLQkJY21kX3N0b3JlKHRhZy5zLCBhcmcxLnMsIGFyZzIucywgdXNp
bmd1aWQpOworCQljbWRfc3RvcmUodGFnLnMsIGFyZzEucywgdXNpbmd1aWQpOwogCiAJCXNubXBf
aW5jcmVtZW50KFNUT1JFX0NPVU5ULCAxKTsKIAkgICAgfQpAQCAtMTYyOSw4ICsxNjI3LDcgQEAK
IAkJaWYgKGMgIT0gJyAnKSBnb3RvIG1pc3NpbmdhcmdzOwogCQljID0gZ2V0YXN0cmluZyhpbWFw
ZF9pbiwgaW1hcGRfb3V0LCAmYXJnMSk7CiAJCWlmIChjID09IEVPRikgZ290byBtaXNzaW5nYXJn
czsKLQkJaWYgKGMgPT0gJ1xyJykgYyA9IHByb3RfZ2V0YyhpbWFwZF9pbik7Ci0JCWlmIChjICE9
ICdcbicpIGdvdG8gZXh0cmFhcmdzOworCQlwcm90X3VuZ2V0YyhjLCBpbWFwZF9pbik7CiAKIAkJ
Y21kX3NlbGVjdCh0YWcucywgY21kLnMsIGFyZzEucyk7CiAKQEAgLTMxNzMsNiArMzE3MCw3IEBA
CiAgKi8KIHZvaWQgY21kX3NlbGVjdChjaGFyICp0YWcsIGNoYXIgKmNtZCwgY2hhciAqbmFtZSkK
IHsKKyAgICBpbnQgYzsKICAgICBzdHJ1Y3QgbWFpbGJveCBtYWlsYm94OwogICAgIGNoYXIgbWFp
bGJveG5hbWVbTUFYX01BSUxCT1hfTkFNRSsxXTsKICAgICBpbnQgciA9IDA7CkBAIC0zMTg0LDYg
KzMxODIsNDggQEAKICAgICBzdGF0aWMgY2hhciBsYXN0cXJbTUFYX01BSUxCT1hfUEFUSCsxXSA9
ICIiOwogICAgIHN0YXRpYyB0aW1lX3QgbmV4dGFsZXJ0ID0gMDsKIAorICAgIGMgPSBwcm90X2dl
dGMoaW1hcGRfaW4pOworICAgIGlmIChjbWRbMF0gIT0gJ0InICYmIGMgPT0gJyAnKSB7CisJc3Rh
dGljIHN0cnVjdCBidWYgYXJnOworCisJYyA9IHByb3RfZ2V0YyhpbWFwZF9pbik7CisJaWYgKGMg
IT0gJygnKSBnb3RvIGJhZGxpc3Q7CisKKwljID0gZ2V0d29yZChpbWFwZF9pbiwgJmFyZyk7CisJ
aWYgKGFyZy5zWzBdID09ICdcMCcpIGdvdG8gYmFkbGlzdDsKKwlmb3IgKDs7KSB7CisJICAgIGxj
YXNlKGFyZy5zKTsKKwkgICAgaWYgKCFzdHJjbXAoYXJnLnMsICJjb25kc3RvcmUiKSkgeworCQlp
bWFwZF9jb25kc3RvcmVfZW5hYmxlZCA9IDE7CisJICAgIH0KKwkgICAgZWxzZSB7CisJCXByb3Rf
cHJpbnRmKGltYXBkX291dCwgIiVzIEJBRCBJbnZhbGlkICVzIG1vZGlmaWVyICVzXHJcbiIsCisJ
CQkgICAgdGFnLCBjbWQsIGFyZy5zKTsKKwkJZWF0bGluZShpbWFwZF9pbiwgYyk7CisJCXJldHVy
bjsKKwkgICAgfQorCSAgICAKKwkgICAgaWYgKGMgPT0gJyAnKSBjID0gZ2V0d29yZChpbWFwZF9p
biwgJmFyZyk7CisJICAgIGVsc2UgYnJlYWs7CisJfQorCisJaWYgKGMgIT0gJyknKSB7CisJICAg
IHByb3RfcHJpbnRmKGltYXBkX291dCwKKwkJCSIlcyBCQUQgTWlzc2luZyBjbG9zZSBwYXJlbnRo
ZXNpcyBpbiAlc1xyXG4iLCB0YWcsIGNtZCk7CisJICAgIGVhdGxpbmUoaW1hcGRfaW4sIGMpOwor
CSAgICByZXR1cm47CisJfQorCisJYyA9IHByb3RfZ2V0YyhpbWFwZF9pbik7CisgICAgfQorICAg
IGlmIChjID09ICdccicpIGMgPSBwcm90X2dldGMoaW1hcGRfaW4pOworICAgIGlmIChjICE9ICdc
bicpIHsKKwlwcm90X3ByaW50ZihpbWFwZF9vdXQsCisJCSAgICAiJXMgQkFEIFVuZXhwZWN0ZWQg
ZXh0cmEgYXJndW1lbnRzIHRvICVzXHJcbiIsIHRhZywgY21kKTsKKwllYXRsaW5lKGltYXBkX2lu
LCBjKTsKKwlyZXR1cm47CisgICAgfQorCiAgICAgaWYgKGltYXBkX21haWxib3gpIHsKIAlpbmRl
eF9jbG9zZW1haWxib3goaW1hcGRfbWFpbGJveCk7CiAJbWFpbGJveF9jbG9zZShpbWFwZF9tYWls
Ym94KTsKQEAgLTMzNDUsNiArMzM4NSwxMSBAQAogCiAgICAgcHJvY19yZWdpc3RlcigiaW1hcGQi
LCBpbWFwZF9jbGllbnRob3N0LCBpbWFwZF91c2VyaWQsIG1haWxib3huYW1lKTsKICAgICBzeXNs
b2coTE9HX0RFQlVHLCAib3BlbjogdXNlciAlcyBvcGVuZWQgJXMiLCBpbWFwZF91c2VyaWQsIG5h
bWUpOworICAgIHJldHVybjsKKworIGJhZGxpc3Q6CisgICAgcHJvdF9wcmludGYoaW1hcGRfb3V0
LCAiJXMgQkFEIEludmFsaWQgbW9kaWZpZXIgbGlzdCBpbiAlc1xyXG4iLCB0YWcsIGNtZCk7Cisg
ICAgZWF0bGluZShpbWFwZF9pbiwgYyk7CiB9CiAJICAKIC8qCkBAIC0zNjk5LDYgKzM3NDQsMTIg
QEAKIAkgICAgZWxzZSBnb3RvIGJhZGF0dDsKIAkgICAgYnJlYWs7CiAKKwljYXNlICdNJzoKKwkg
ICAgaWYgKCFzdHJjbXAoZmV0Y2hhdHQucywgIk1PRFNFUSIpKSB7CisJCWZldGNoaXRlbXMgfD0g
RkVUQ0hfTU9EU0VROworCSAgICB9CisJICAgIGVsc2UgZ290byBiYWRhdHQ7CisJICAgIGJyZWFr
OwogCWNhc2UgJ1InOgogCSAgICBpZiAoIXN0cmNtcChmZXRjaGF0dC5zLCAiUkZDODIyIikpIHsK
IAkJZmV0Y2hpdGVtcyB8PSBGRVRDSF9SRkM4MjJ8RkVUQ0hfU0VUU0VFTjsKQEAgLTM3OTIsOSAr
Mzg0Myw1NSBAQAogICAgIGlmIChpbmxpc3QgJiYgYyA9PSAnKScpIHsKIAlpbmxpc3QgPSAwOwog
CWMgPSBwcm90X2dldGMoaW1hcGRfaW4pOworCWlmIChjID09ICcgJykgeworCSAgICAvKiBHcmFi
L3BhcnNlIHRoZSBtb2RpZmllcihzKSAqLworCSAgICBjID0gcHJvdF9nZXRjKGltYXBkX2luKTsK
KwkgICAgaWYgKGMgIT0gJygnKSB7CisJCXByb3RfcHJpbnRmKGltYXBkX291dCwKKwkJCSAgICAi
JXMgQkFEIE1pc3NpbmcgcmVxdWlyZWQgb3BlbiBwYXJlbnRoZXNpcyBpbiAlcyBtb2RpZmllcnNc
clxuIiwKKwkJCSAgICB0YWcsIGNtZCk7CisJCWVhdGxpbmUoaW1hcGRfaW4sIGMpOworCQlnb3Rv
IGZyZWVhcmdzOworCSAgICB9CisJICAgIGlubGlzdCA9IDE7CisJICAgIGRvIHsKKwkJYyA9IGdl
dHdvcmQoaW1hcGRfaW4sICZmZXRjaGF0dCk7CisJCXVjYXNlKGZldGNoYXR0LnMpOworCQlpZiAo
IXN0cmNtcChmZXRjaGF0dC5zLCAiQ0hBTkdFRFNJTkNFIikpIHsKKwkJICAgIGlmIChjICE9ICcg
JykgeworCQkJcHJvdF9wcmludGYoaW1hcGRfb3V0LAorCQkJCSAgICAiJXMgQkFEIE1pc3Npbmcg
cmVxdWlyZWQgYXJndW1lbnQgdG8gJXMgJXNcclxuIiwKKwkJCQkgICAgdGFnLCBjbWQsIGZldGNo
YXR0LnMpOworCQkJZWF0bGluZShpbWFwZF9pbiwgYyk7CisJCQlnb3RvIGZyZWVhcmdzOworCQkg
ICAgfQorCQkgICAgYyA9IGdldGFzdHJpbmcoaW1hcGRfaW4sIGltYXBkX291dCwgJmZpZWxkbmFt
ZSk7CisJCSAgICBmZXRjaGFyZ3MuY2hhbmdlZHNpbmNlID0gc3RydG91bChmaWVsZG5hbWUucywg
JnAsIDEwKTsKKwkJICAgIGlmICgqcCB8fCBmZXRjaGFyZ3MuY2hhbmdlZHNpbmNlID09IFVMT05H
X01BWCkgeworCQkJcHJvdF9wcmludGYoaW1hcGRfb3V0LAorCQkJCSAgICAiJXMgQkFEIEludmFs
aWQgYXJndW1lbnQgdG8gJXMgJXNcclxuIiwKKwkJCQkgICAgdGFnLCBjbWQsIGZldGNoYXR0LnMp
OworCQkJZWF0bGluZShpbWFwZF9pbiwgYyk7CisJCQlnb3RvIGZyZWVhcmdzOworCQkgICAgfQor
CQkgICAgZmV0Y2hpdGVtcyB8PSBGRVRDSF9NT0RTRVE7CisJCX0KKwkJZWxzZSB7CisJCSAgICBw
cm90X3ByaW50ZihpbWFwZF9vdXQsICIlcyBCQUQgSW52YWxpZCAlcyBtb2RpZmllciAlc1xyXG4i
LAorCQkJCXRhZywgY21kLCBmZXRjaGF0dC5zKTsKKwkJICAgIGVhdGxpbmUoaW1hcGRfaW4sIGMp
OworCQkgICAgZ290byBmcmVlYXJnczsKKwkJfQorCSAgICB9IHdoaWxlIChjID09ICcgJyk7CisJ
ICAgIGlmIChjID09ICcpJykgeworCQlpbmxpc3QgPSAwOworCQljID0gcHJvdF9nZXRjKGltYXBk
X2luKTsKKwkgICAgfQorCX0KICAgICB9CiAgICAgaWYgKGlubGlzdCkgewotCXByb3RfcHJpbnRm
KGltYXBkX291dCwgIiVzIEJBRCBNaXNzaW5nIGNsb3NlIHBhcmVudGhlc2lzIGluICVzXHJcbiIs
IHRhZywgY21kKTsKKwlwcm90X3ByaW50ZihpbWFwZF9vdXQsICIlcyBCQUQgTWlzc2luZyBjbG9z
ZSBwYXJlbnRoZXNpcyBpbiAlc1xyXG4iLAorCQkgICAgdGFnLCBjbWQpOwogCWVhdGxpbmUoaW1h
cGRfaW4sIGMpOwogCWdvdG8gZnJlZWFyZ3M7CiAgICAgfQpAQCAtMzgxMiw2ICszOTA5LDEyIEBA
CiAJZ290byBmcmVlYXJnczsKICAgICB9CiAKKyAgICBpZiAoZmV0Y2hpdGVtcyAmIEZFVENIX01P
RFNFUSkgeworCWlmICghaW1hcGRfY29uZHN0b3JlX2VuYWJsZWQrKykKKwkgICAgcHJvdF9wcmlu
dGYoaW1hcGRfb3V0LCAiKiBPSyBbSElHSEVTVE1PRFNFUSAiIE1PRFNFUV9GTVQgIl0gIFxyXG4i
LAorCQkJaW1hcGRfbWFpbGJveC0+aGlnaGVzdG1vZHNlcSk7CisgICAgfQorCiAgICAgaWYgKHVz
aW5ndWlkIHx8IGNvbmZpZ19nZXRzd2l0Y2goSU1BUE9QVF9GTFVTSFNFRU5TVEFURSkpIHsKIAlp
ZiAodXNpbmd1aWQpIGZldGNoaXRlbXMgfD0gRkVUQ0hfVUlEOyAKIAlpbmRleF9jaGVjayhpbWFw
ZF9tYWlsYm94LCB1c2luZ3VpZCwgLyogdXBkYXRlIFxTZWVuIHN0YXRlIGZyb20gZGlzaz8gKi8K
QEAgLTM5ODEsMTMgKzQwODQsMTMgQEAKIC8qCiAgKiBQYXJzZSBhbmQgcGVyZm9ybSBhIFNUT1JF
L1VJRCBTVE9SRSBjb21tYW5kCiAgKiBUaGUgY29tbWFuZCBoYXMgYmVlbiBwYXJzZWQgdXAgdG8g
YW5kIGluY2x1ZGluZwotICogdGhlIEZMQUdTLytGTEFHUy8tRkxBR1MKKyAqIHRoZSBzZXF1ZW5j
ZQogICovCi12b2lkIGNtZF9zdG9yZShjaGFyICp0YWcsIGNoYXIgKnNlcXVlbmNlLCBjaGFyICpv
cGVyYXRpb24sIGludCB1c2luZ3VpZCkKK3ZvaWQgY21kX3N0b3JlKGNoYXIgKnRhZywgY2hhciAq
c2VxdWVuY2UsIGludCB1c2luZ3VpZCkKIHsKICAgICBjb25zdCBjaGFyICpjbWQgPSB1c2luZ3Vp
ZCA/ICJVSUQgU3RvcmUiIDogIlN0b3JlIjsKICAgICBzdHJ1Y3Qgc3RvcmVhcmdzIHN0b3JlYXJn
czsKLSAgICBzdGF0aWMgc3RydWN0IGJ1ZiBmbGFnbmFtZTsKKyAgICBzdGF0aWMgc3RydWN0IGJ1
ZiBvcGVyYXRpb24sIGZsYWduYW1lOwogICAgIGludCBsZW4sIGM7CiAgICAgY2hhciAqKmZsYWcg
PSAwOwogICAgIGludCBuZmxhZ3MgPSAwLCBmbGFnYWxsb2MgPSAwOwpAQCAtNDAwNCwyMiArNDEw
Nyw4MyBAQAogCiAgICAgLyogbG9jYWwgbWFpbGJveCAqLwogICAgIG1lbXNldCgmc3RvcmVhcmdz
LCAwLCBzaXplb2Ygc3RvcmVhcmdzKTsKKyAgICBzdG9yZWFyZ3MudW5jaGFuZ2Vkc2luY2UgPSBV
TE9OR19NQVg7CisKKyAgICBjID0gcHJvdF9nZXRjKGltYXBkX2luKTsKKyAgICBpZiAoYyA9PSAn
KCcpIHsKKwkvKiBHcmFiL3BhcnNlIHRoZSBtb2RpZmllcihzKSAqLworCXN0YXRpYyBzdHJ1Y3Qg
YnVmIHN0b3JlbW9kLCBtb2R2YWx1ZTsKKwljaGFyICpwOworCisJZG8geworCSAgICBjID0gZ2V0
d29yZChpbWFwZF9pbiwgJnN0b3JlbW9kKTsKKwkgICAgbGNhc2Uoc3RvcmVtb2Qucyk7CisJICAg
IGlmICghc3RyY21wKHN0b3JlbW9kLnMsICJ1bmNoYW5nZWRzaW5jZSIpKSB7CisJCWlmIChjICE9
ICcgJykgeworCQkgICAgcHJvdF9wcmludGYoaW1hcGRfb3V0LAorCQkJCSIlcyBCQUQgTWlzc2lu
ZyByZXF1aXJlZCBhcmd1bWVudCB0byAlcyAlc1xyXG4iLAorCQkJCXRhZywgY21kLCBzdG9yZW1v
ZC5zKTsKKwkJICAgIGVhdGxpbmUoaW1hcGRfaW4sIGMpOworCQkgICAgcmV0dXJuOworCQl9CisJ
CWMgPSBnZXRhc3RyaW5nKGltYXBkX2luLCBpbWFwZF9vdXQsICZtb2R2YWx1ZSk7CisJCXN0b3Jl
YXJncy51bmNoYW5nZWRzaW5jZSA9IHN0cnRvdWwobW9kdmFsdWUucywgJnAsIDEwKTsKKwkJaWYg
KCpwIHx8IHN0b3JlYXJncy51bmNoYW5nZWRzaW5jZSA9PSBVTE9OR19NQVgpIHsKKwkJICAgIHBy
b3RfcHJpbnRmKGltYXBkX291dCwKKwkJCQkiJXMgQkFEIEludmFsaWQgYXJndW1lbnQgdG8gJXMg
JXNcclxuIiwKKwkJCQl0YWcsIGNtZCwgc3RvcmVtb2Qucyk7CisJCSAgICBlYXRsaW5lKGltYXBk
X2luLCBjKTsKKwkJICAgIHJldHVybjsKKwkJfQorCSAgICB9CisJICAgIGVsc2UgeworCQlwcm90
X3ByaW50ZihpbWFwZF9vdXQsICIlcyBCQUQgSW52YWxpZCAlcyBtb2RpZmllciAlc1xyXG4iLAor
CQkJICAgIHRhZywgY21kLCBzdG9yZW1vZC5zKTsKKwkJZWF0bGluZShpbWFwZF9pbiwgYyk7CisJ
CXJldHVybjsKKwkgICAgfQorCX0gd2hpbGUgKGMgPT0gJyAnKTsKKwlpZiAoYyAhPSAnKScpIHsK
KwkgICAgcHJvdF9wcmludGYoaW1hcGRfb3V0LAorCQkJIiVzIEJBRCBNaXNzaW5nIGNsb3NlIHBh
cmVuIGluIHN0b3JlIG1vZGlmaWVyIGVudHJ5IFxyXG4iLAorCQkJdGFnKTsKKwkgICAgZWF0bGlu
ZShpbWFwZF9pbiwgYyk7CisJICAgIHJldHVybjsKKwl9CisJYyA9IHByb3RfZ2V0YyhpbWFwZF9p
bik7CisJaWYgKGMgIT0gJyAnKSB7CisJICAgIHByb3RfcHJpbnRmKGltYXBkX291dCwKKwkJCSIl
cyBCQUQgTWlzc2luZyByZXF1aXJlZCBhcmd1bWVudCB0byAlc1xyXG4iLAorCQkJdGFnLCBjbWQp
OworCSAgICBlYXRsaW5lKGltYXBkX2luLCBjKTsKKwkgICAgcmV0dXJuOworCX0KKyAgICB9Cisg
ICAgZWxzZQorCXByb3RfdW5nZXRjKGMsIGltYXBkX2luKTsKIAotICAgIGxjYXNlKG9wZXJhdGlv
bik7CisgICAgYyA9IGdldHdvcmQoaW1hcGRfaW4sICZvcGVyYXRpb24pOworICAgIGlmIChjICE9
ICcgJykgeworCXByb3RfcHJpbnRmKGltYXBkX291dCwKKwkJICAgICIlcyBCQUQgTWlzc2luZyBy
ZXF1aXJlZCBhcmd1bWVudCB0byAlc1xyXG4iLCB0YWcsIGNtZCk7CisJZWF0bGluZShpbWFwZF9p
biwgYyk7CisJcmV0dXJuOworICAgIH0KKyAgICBsY2FzZShvcGVyYXRpb24ucyk7CiAKLSAgICBs
ZW4gPSBzdHJsZW4ob3BlcmF0aW9uKTsKLSAgICBpZiAobGVuID4gNyAmJiAhc3RyY21wKG9wZXJh
dGlvbitsZW4tNywgIi5zaWxlbnQiKSkgeworICAgIGxlbiA9IHN0cmxlbihvcGVyYXRpb24ucyk7
CisgICAgaWYgKGxlbiA+IDcgJiYgIXN0cmNtcChvcGVyYXRpb24ucytsZW4tNywgIi5zaWxlbnQi
KSkgewogCXN0b3JlYXJncy5zaWxlbnQgPSAxOwotCW9wZXJhdGlvbltsZW4tN10gPSAnXDAnOwor
CW9wZXJhdGlvbi5zW2xlbi03XSA9ICdcMCc7CiAgICAgfQogICAgIAotICAgIGlmICghc3RyY21w
KG9wZXJhdGlvbiwgIitmbGFncyIpKSB7CisgICAgaWYgKCFzdHJjbXAob3BlcmF0aW9uLnMsICIr
ZmxhZ3MiKSkgewogCXN0b3JlYXJncy5vcGVyYXRpb24gPSBTVE9SRV9BREQ7CiAgICAgfQotICAg
IGVsc2UgaWYgKCFzdHJjbXAob3BlcmF0aW9uLCAiLWZsYWdzIikpIHsKKyAgICBlbHNlIGlmICgh
c3RyY21wKG9wZXJhdGlvbi5zLCAiLWZsYWdzIikpIHsKIAlzdG9yZWFyZ3Mub3BlcmF0aW9uID0g
U1RPUkVfUkVNT1ZFOwogICAgIH0KLSAgICBlbHNlIGlmICghc3RyY21wKG9wZXJhdGlvbiwgImZs
YWdzIikpIHsKKyAgICBlbHNlIGlmICghc3RyY21wKG9wZXJhdGlvbi5zLCAiZmxhZ3MiKSkgewog
CXN0b3JlYXJncy5vcGVyYXRpb24gPSBTVE9SRV9SRVBMQUNFOwogICAgIH0KICAgICBlbHNlIHsK
QEAgLTQxMDIsNiArNDI2NiwxMSBAQAogCWdvdG8gZnJlZWZsYWdzOwogICAgIH0KIAorICAgIGlm
ICgoc3RvcmVhcmdzLnVuY2hhbmdlZHNpbmNlICE9IFVMT05HX01BWCkgJiYgIWltYXBkX2NvbmRz
dG9yZV9lbmFibGVkKyspIHsKKwlwcm90X3ByaW50ZihpbWFwZF9vdXQsICIqIE9LIFtISUdIRVNU
TU9EU0VRICIgTU9EU0VRX0ZNVCAiXSAgXHJcbiIsCisJCSAgICBpbWFwZF9tYWlsYm94LT5oaWdo
ZXN0bW9kc2VxKTsKKyAgICB9CisKICAgICByID0gaW5kZXhfc3RvcmUoaW1hcGRfbWFpbGJveCwg
c2VxdWVuY2UsIHVzaW5ndWlkLCAmc3RvcmVhcmdzLAogCQkgICAgZmxhZywgbmZsYWdzKTsKIApA
QCAtNjQ1Miw2ICs2NjIxLDkgQEAKIAllbHNlIGlmICghc3RyY21wKGFyZy5zLCAidW5zZWVuIikp
IHsKIAkgICAgc3RhdHVzaXRlbXMgfD0gU1RBVFVTX1VOU0VFTjsKIAl9CisJZWxzZSBpZiAoIXN0
cmNtcChhcmcucywgImhpZ2hlc3Rtb2RzZXEiKSkgeworCSAgICBzdGF0dXNpdGVtcyB8PSBTVEFU
VVNfSElHSEVTVE1PRFNFUTsKKwl9CiAJZWxzZSB7CiAJICAgIHByb3RfcHJpbnRmKGltYXBkX291
dCwgIiVzIEJBRCBJbnZhbGlkIFN0YXR1cyBhdHRyaWJ1dGUgJXNcclxuIiwKIAkJCXRhZywgYXJn
LnMpOwpAQCAtNzIyOSw2ICs3NDAxLDE4IEBACiAJZWxzZSBnb3RvIGJhZGNyaTsKIAlicmVhazsK
IAorICAgIGNhc2UgJ20nOgorCWlmICghc3RyY21wKGNyaXRlcmlhLnMsICJtb2RzZXEiKSkgewor
CSAgICBpZiAoYyAhPSAnICcpIGdvdG8gbWlzc2luZ2FyZzsJCQorCSAgICBjID0gZ2V0d29yZChp
bWFwZF9pbiwgJmFyZyk7CisJICAgIGZvciAocCA9IGFyZy5zOyAqcCAmJiBpc2RpZ2l0KChpbnQp
ICpwKTsgcCsrKSB7CisJCXNlYXJjaGFyZ3MtPm1vZHNlcSA9IHNlYXJjaGFyZ3MtPm1vZHNlcSAq
IDEwICsgKnAgLSAnMCc7CisJICAgIH0KKwkgICAgaWYgKCFhcmcucyB8fCAqcCkgZ290byBiYWRu
dW1iZXI7CisJfQorCWVsc2UgZ290byBiYWRjcmk7CisJYnJlYWs7CisKICAgICBjYXNlICduJzoK
IAlpZiAoIXN0cmNtcChjcml0ZXJpYS5zLCAibm90IikpIHsKIAkgICAgaWYgKGMgIT0gJyAnKSBn
b3RvIG1pc3Npbmdhcmc7CQkKQEAgLTgzOTUsNiArODU3OSw4IEBACiAJICAgICgqc29ydGNyaXQp
W25dLmFyZ3MuYW5ub3QuYXR0cmliID0geHN0cmR1cChhcmcucyk7CiAJfQogI2VuZGlmCisJZWxz
ZSBpZiAoIXN0cmNtcChjcml0ZXJpYS5zLCAibW9kc2VxIikpCisJICAgICgqc29ydGNyaXQpW25d
LmtleSA9IFNPUlRfTU9EU0VROwogCWVsc2UgewogCSAgICBwcm90X3ByaW50ZihpbWFwZF9vdXQs
ICIlcyBCQUQgSW52YWxpZCBTb3J0IGNyaXRlcmlvbiAlc1xyXG4iLAogCQkJdGFnLCBjcml0ZXJp
YS5zKTsKSW5kZXg6IGltYXAvaW1hcGQuaAo9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09ClJDUyBmaWxlOiAvYWZzL2FuZHJl
dy9zeXN0ZW0vY3ZzL3NyYy9jeXJ1cy9pbWFwL2ltYXBkLmgsdgpyZXRyaWV2aW5nIHJldmlzaW9u
IDEuNTUuMi4zCmRpZmYgLXUgLXIxLjU1LjIuMyBpbWFwZC5oCi0tLSBpbWFwL2ltYXBkLmgJMiBK
dW4gMjAwNSAxNjoxNjoxMyAtMDAwMAkxLjU1LjIuMworKysgaW1hcC9pbWFwZC5oCTE0IERlYyAy
MDA1IDAyOjE4OjU5IC0wMDAwCkBAIC01OCw2ICs1OCw5IEBACiAvKiBOdW1iZXIgb2YgbWVzc2Fn
ZXMgaW4gY3VycmVudGx5IG9wZW4gbWFpbGJveCAqLwogZXh0ZXJuIGludCBpbWFwZF9leGlzdHM7
CiAKKy8qIElzIGNvbmRzdG9yZSBlbmFibGVkPyAqLworZXh0ZXJuIGludCBpbWFwZF9jb25kc3Rv
cmVfZW5hYmxlZDsKKwogLyogTGlzdCBvZiBIRUFERVIuRklFTERTWy5OT1RdIGZldGNoIHNwZWNp
ZmljYXRpb25zICovCiBzdHJ1Y3QgZmllbGRsaXN0IHsKICAgICBjaGFyICpzZWN0aW9uOwkJLyog
Rmlyc3QgcGFydCBvZiBCT0RZW3hdIHZhbHVlICovCkBAIC02OSwxNSArNzIsMTYgQEAKIAogLyog
SXRlbXMgdGhhdCBtYXkgYmUgZmV0Y2hlZCAqLwogc3RydWN0IGZldGNoYXJncyB7Ci0gICAgaW50
IGZldGNoaXRlbXM7CQkvKiBCaXRtYXNrICovCi0gICAgc3RydWN0IHN0cmxpc3QgKmJpbnNlY3Rp
b25zOyAvKiBCSU5BUllbeF08eD4gdmFsdWVzICovCisgICAgaW50IGZldGNoaXRlbXM7CQkgIC8q
IEJpdG1hc2sgKi8KKyAgICBzdHJ1Y3Qgc3RybGlzdCAqYmluc2VjdGlvbnM7ICAvKiBCSU5BUllb
eF08eD4gdmFsdWVzICovCiAgICAgc3RydWN0IHN0cmxpc3QgKnNpemVzZWN0aW9uczsgLyogQklO
QVJZLlNJWkVbeF0gdmFsdWVzICovCiAgICAgc3RydWN0IHN0cmxpc3QgKmJvZHlzZWN0aW9uczsg
LyogQk9EWVt4XTx4PiB2YWx1ZXMgKi8KICAgICBzdHJ1Y3QgZmllbGRsaXN0ICpmc2VjdGlvbnM7
ICAvKiBCT0RZW3hIRUFERVIuRklFTERTeF08eD4gdmFsdWVzICovCi0gICAgc3RydWN0IHN0cmxp
c3QgKmhlYWRlcnM7CS8qIFJGQzgyMi5IRUFERVIuTElORVMgKi8KLSAgICBzdHJ1Y3Qgc3RybGlz
dCAqaGVhZGVyc19ub3Q7IC8qIFJGQzgyMi5IRUFERVIuTElORVMuTk9UICovCi0gICAgaW50IHN0
YXJ0X29jdGV0OyAgICAgICAgICAgLyogc3RhcnRfb2N0ZXQgZm9yIHBhcnRpYWwgZmV0Y2ggKi8K
LSAgICBpbnQgb2N0ZXRfY291bnQ7ICAgICAgICAgICAvKiBvY3RldF9jb3VudCBmb3IgcGFydGlh
bCBmZXRjaCwgb3IgMCAqLworICAgIHN0cnVjdCBzdHJsaXN0ICpoZWFkZXJzOwkgIC8qIFJGQzgy
Mi5IRUFERVIuTElORVMgKi8KKyAgICBzdHJ1Y3Qgc3RybGlzdCAqaGVhZGVyc19ub3Q7ICAvKiBS
RkM4MjIuSEVBREVSLkxJTkVTLk5PVCAqLworICAgIGludCBzdGFydF9vY3RldDsgICAgICAgICAg
ICAgIC8qIHN0YXJ0X29jdGV0IGZvciBwYXJ0aWFsIGZldGNoICovCisgICAgaW50IG9jdGV0X2Nv
dW50OyAgICAgICAgICAgICAgLyogb2N0ZXRfY291bnQgZm9yIHBhcnRpYWwgZmV0Y2gsIG9yIDAg
Ki8KKyAgICBtb2RzZXFfdCBjaGFuZ2Vkc2luY2U7ICAgICAgICAvKiBjaGFuZ2VkIHNpbmNlIG1v
ZHNlcSwgb3IgMCAqLwogCiAgICAgYml0MzIgY2FjaGVfYXRsZWFzdDsgICAgICAgICAgLyogdG8g
ZG8gaGVhZGVycyB3ZSBuZWVkIGF0bGVhc3QgdGhpcwogCQkJCSAgICogY2FjaGUgdmVyc2lvbiAq
LwpAQCAtMTAzLDcgKzEwNyw4IEBACiAgICAgRkVUQ0hfUkZDODIyID0gICAgICAgICAgICAgICgx
PDw5KSwKICAgICBGRVRDSF9TRVRTRUVOID0gICAgICAgICAgICAgKDE8PDEwKSwKIC8qICAgICBG
RVRDSF9VTkNBQ0hFREhFQURFUiA9ICAgICAgKDE8PDExKSAtLSBvYnNvbGV0ZSAqLwotICAgIEZF
VENIX0lTX1BBUlRJQUwgPSAgICAgICAgICAoMTw8MTIpIC8qIHRoaXMgaXMgdGhlIFBBUlRJQUwg
Y29tbWFuZCAqLworICAgIEZFVENIX0lTX1BBUlRJQUwgPSAgICAgICAgICAoMTw8MTIpLCAvKiB0
aGlzIGlzIHRoZSBQQVJUSUFMIGNvbW1hbmQgKi8KKyAgICBGRVRDSF9NT0RTRVEgPQkJKDE8PDEz
KQogfTsKIAogZW51bSB7CkBAIC0xMTUsNiArMTIwLDcgQEAKIC8qIEFyZ3VtZW50cyB0byBTdG9y
ZSBmdW5jdGlvbnMgKi8KIHN0cnVjdCBzdG9yZWFyZ3MgewogICAgIGludCBvcGVyYXRpb247Cisg
ICAgbW9kc2VxX3QgdW5jaGFuZ2Vkc2luY2U7IC8qIHVuY2hhbmdlZCBzaW5jZSBtb2RzZXEsIG9y
IFVMTE9OR19NQVggKi8KICAgICBpbnQgc2lsZW50OwogICAgIGludCBzZWVuOwogICAgIGJpdDMy
IHN5c3RlbV9mbGFnczsKQEAgLTE3NCw2ICsxODAsNyBAQAogICAgIHN0cnVjdCBzdHJsaXN0ICp0
ZXh0OwogICAgIHN0cnVjdCBzdHJsaXN0ICpoZWFkZXJfbmFtZSwgKmhlYWRlcjsKICAgICBzdHJ1
Y3Qgc2VhcmNoc3ViICpzdWJsaXN0OworICAgIG1vZHNlcV90IG1vZHNlcTsKIAogICAgIGJpdDMy
IGNhY2hlX2F0bGVhc3Q7CiB9OwpAQCAtMjAwLDcgKzIwNyw4IEBACiAgICAgU09SVF9TSVpFLAog
ICAgIFNPUlRfU1VCSkVDVCwKICAgICBTT1JUX1RPLAotICAgIFNPUlRfQU5OT1RBVElPTgorICAg
IFNPUlRfQU5OT1RBVElPTiwKKyAgICBTT1JUX01PRFNFUQogICAgIC8qIHZhbHVlcyA+IDI1NSBh
cmUgcmVzZXJ2ZWQgZm9yIGludGVybmFsIHVzZSAqLwogfTsKIApAQCAtMjEzLDcgKzIyMSw4IEBA
CiAgICAgU1RBVFVTX1JFQ0VOVCA9CQkoMTw8MSksCiAgICAgU1RBVFVTX1VJRE5FWFQgPQkJKDE8
PDIpLAogICAgIFNUQVRVU19VSURWQUxJRElUWSA9CSgxPDwzKSwKLSAgICBTVEFUVVNfVU5TRUVO
ID0JCSgxPDw0KQorICAgIFNUQVRVU19VTlNFRU4gPQkJKDE8PDQpLAorICAgIFNUQVRVU19ISUdI
RVNUTU9EU0VRID0JKDE8PDUpCiB9OwogCiAvKiBCaXRtYXNrIGZvciBsaXN0IG9wdGlvbnMgKi8K
SW5kZXg6IGltYXAvaW5kZXguYwo9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09ClJDUyBmaWxlOiAvYWZzL2FuZHJldy9zeXN0
ZW0vY3ZzL3NyYy9jeXJ1cy9pbWFwL2luZGV4LmMsdgpyZXRyaWV2aW5nIHJldmlzaW9uIDEuMTk5
LjIuMjUKZGlmZiAtdSAtcjEuMTk5LjIuMjUgaW5kZXguYwotLS0gaW1hcC9pbmRleC5jCTEzIERl
YyAyMDA1IDE5OjM2OjAwIC0wMDAwCTEuMTk5LjIuMjUKKysrIGltYXAvaW5kZXguYwkxNCBEZWMg
MjAwNSAwMjoxOTowMCAtMDAwMApAQCAtMTYxLDcgKzE2MSw4IEBACiAJCQkJICAgY29tcF9wYXQg
KnBhdCk7CiBzdGF0aWMgaW5kZXhfc2VxdWVuY2Vwcm9jX3QgaW5kZXhfY29weXNldHVwOwogc3Rh
dGljIGludCBfaW5kZXhfc2VhcmNoKHVuc2lnbmVkICoqbXNnbm9fbGlzdCwgc3RydWN0IG1haWxi
b3ggKm1haWxib3gsCi0JCQkgc3RydWN0IHNlYXJjaGFyZ3MgKnNlYXJjaGFyZ3MpOworCQkJIHN0
cnVjdCBzZWFyY2hhcmdzICpzZWFyY2hhcmdzLAorCQkJIG1vZHNlcV90ICpoaWdoZXN0bW9kc2Vx
KTsKIAogc3RhdGljIHZvaWQgcGFyc2VfY2FjaGVkX2VudmVsb3BlKGNoYXIgKmVudiwgY2hhciAq
dG9rZW5zW10sIGludCB0b2tlbnNfc2l6ZSk7CiBzdGF0aWMgY2hhciAqZmluZF9tc2dpZChjaGFy
ICpzdHIsIGNoYXIgKipyZW0pOwpAQCAtNDMxLDYgKzQzMiw4IEBACiAJCSAgICBtYWlsYm94LT51
aWR2YWxpZGl0eSk7CiAJcHJvdF9wcmludGYoaW1hcGRfb3V0LCAiKiBPSyBbVUlETkVYVCAlbHVd
ICBcclxuIiwKIAkJICAgIG1haWxib3gtPmxhc3RfdWlkICsgMSk7CisJcHJvdF9wcmludGYoaW1h
cGRfb3V0LCAiKiBPSyBbSElHSEVTVE1PRFNFUSAiIE1PRFNFUV9GTVQgIl0gIFxyXG4iLAorCQkg
ICAgbWFpbGJveC0+aGlnaGVzdG1vZHNlcSk7CiAgICAgfQogCiAgICAgZm9yIChtc2dubyA9IDE7
IG1zZ25vIDw9IG9sZGV4aXN0czsgbXNnbm8rKykgewpAQCAtNDQwLDYgKzQ0Myw5IEBACiAJICAg
IH0KIAkgICAgaW5kZXhfZmV0Y2hmbGFncyhtYWlsYm94LCBtc2dubywgU1lTVEVNX0ZMQUdTKG1z
Z25vKSwgdXNlcl9mbGFncywKIAkJCSAgICAgTEFTVF9VUERBVEVEKG1zZ25vKSk7CisJICAgIGlm
IChpbWFwZF9jb25kc3RvcmVfZW5hYmxlZCkgeworCQlwcm90X3ByaW50ZihpbWFwZF9vdXQsICIg
TU9EU0VRICgiIE1PRFNFUV9GTVQgIikiLCBNT0RTRVEobXNnbm8pKTsKKwkgICAgfQogCSAgICBp
ZiAodXNpbmd1aWQpIHByb3RfcHJpbnRmKGltYXBkX291dCwgIiBVSUQgJXUiLCBVSUQobXNnbm8p
KTsKIAkgICAgcHJvdF9wcmludGYoaW1hcGRfb3V0LCAiKVxyXG4iKTsKIAl9CkBAIC01NTUsNiAr
NTYxLDEwIEBACiAJCSAgICB9CiAJCSAgICBpbmRleF9mZXRjaGZsYWdzKG1haWxib3gsIG1zZ25v
LCBTWVNURU1fRkxBR1MobXNnbm8pLCAKIAkJCQkgICAgIHVzZXJfZmxhZ3MsIExBU1RfVVBEQVRF
RChtc2dubykpOworCQkgICAgaWYgKGltYXBkX2NvbmRzdG9yZV9lbmFibGVkKSB7CisJCQlwcm90
X3ByaW50ZihpbWFwZF9vdXQsICIgTU9EU0VRICgiIE1PRFNFUV9GTVQgIikiLAorCQkJCSAgICBN
T0RTRVEobXNnbm8pKTsKKwkJICAgIH0KIAkJICAgIGlmICh1c2luZ3VpZCkgewogCQkJcHJvdF9w
cmludGYoaW1hcGRfb3V0LCAiIFVJRCAldSIsIFVJRChtc2dubykpOwogCQkgICAgfQpAQCAtOTM5
LDYgKzk0OSw4IEBACiAgICAgLyogbm90ZSB0aGF0IGluZGV4X2ZvcnNlcXVlbmNlKCkgZG9lc24n
dCBzeW5jIHRoZSBpbmRleCBmaWxlOwogICAgICAgIHRoYXQncyBkb25lIGJlbG93IGluIG1haWxi
b3hfd3JpdGVfaW5kZXhfaGVhZGVyKCkgKi8KICAgICBpZiAobWFpbGJveC0+ZGlydHkpIHsKKwkv
KiBidW1wIEhJR0hFU1RNT0RTRVEgKi8KKwltYWlsYm94LT5oaWdoZXN0bW9kc2VxKys7CiAJLyog
eHh4IHdoYXQgdG8gZG8gb24gZmFpbHVyZT8gKi8KIAltYWlsYm94X3dyaXRlX2luZGV4X2hlYWRl
cihtYWlsYm94KTsKIAltYWlsYm94LT5kaXJ0eSA9IDA7CkBAIC05NjEsMTEgKzk3Myw5IEBACiAg
KiBSZXR1cm5zIG1lc3NhZ2UgbnVtYmVycyBpbiBhbiBhcnJheS4gIFRoaXMgZnVuY3Rpb24gaXMg
dXNlZCBieQogICogU0VBUkNILCBTT1JUIGFuZCBUSFJFQUQuCiAgKi8KLXN0YXRpYyBpbnQKLV9p
bmRleF9zZWFyY2gobXNnbm9fbGlzdCwgbWFpbGJveCwgc2VhcmNoYXJncykKLXVuc2lnbmVkICoq
bXNnbm9fbGlzdDsKLXN0cnVjdCBtYWlsYm94ICptYWlsYm94Owotc3RydWN0IHNlYXJjaGFyZ3Mg
KnNlYXJjaGFyZ3M7CitzdGF0aWMgaW50IF9pbmRleF9zZWFyY2godW5zaWduZWQgKiptc2dub19s
aXN0LCBzdHJ1Y3QgbWFpbGJveCAqbWFpbGJveCwKKwkJCSBzdHJ1Y3Qgc2VhcmNoYXJncyAqc2Vh
cmNoYXJncywKKwkJCSBtb2RzZXFfdCAqaGlnaGVzdG1vZHNlcSkKIHsKICAgICB1bnNpZ25lZCBt
c2dubzsKICAgICBzdHJ1Y3QgbWFwZmlsZSBtc2dmaWxlOwpAQCAtOTkxLDYgKzEwMDEsOSBAQAog
CiAJaWYgKGluZGV4X3NlYXJjaF9ldmFsdWF0ZShtYWlsYm94LCBzZWFyY2hhcmdzLCBtc2dubywg
Jm1zZ2ZpbGUpKSB7CiAJICAgICgqbXNnbm9fbGlzdClbbisrXSA9IG1zZ25vOworCSAgICBpZiAo
aGlnaGVzdG1vZHNlcSAmJiAoTU9EU0VRKG1zZ25vKSA+ICpoaWdoZXN0bW9kc2VxKSkgeworCQkq
aGlnaGVzdG1vZHNlcSA9IE1PRFNFUShtc2dubyk7CisJICAgIH0KIAl9CiAJaWYgKG1zZ2ZpbGUu
YmFzZSkgewogCSAgICBtYWlsYm94X3VubWFwX21lc3NhZ2UobWFpbGJveCwgVUlEKG1zZ25vKSwK
QEAgLTEwMjAsNyArMTAzMyw3IEBACiAgICAgdW5zaWduZWQgKm1zZ25vX2xpc3Q7CiAgICAgaW50
IGksIG47CiAKLSAgICBuID0gX2luZGV4X3NlYXJjaCgmbXNnbm9fbGlzdCwgbWFpbGJveCwgc2Vh
cmNoYXJncyk7CisgICAgbiA9IF9pbmRleF9zZWFyY2goJm1zZ25vX2xpc3QsIG1haWxib3gsIHNl
YXJjaGFyZ3MsIE5VTEwpOwogICAgIGlmIChuID09IDApIHsKIAkqdWlkX2xpc3QgPSBOVUxMOwog
CXJldHVybiAwOwpAQCAtMTAzOCwxNiArMTA1MSwxNSBAQAogICogUGVyZm9ybXMgYSBTRUFSQ0gg
Y29tbWFuZC4KICAqIFRoaXMgaXMgYSB3cmFwcGVyIGFyb3VuZCBfaW5kZXhfc2VhcmNoKCkgd2hp
Y2ggc2ltcGx5IHByaW50cyB0aGUgcmVzdWx0cy4KICAqLwotaW50Ci1pbmRleF9zZWFyY2gobWFp
bGJveCwgc2VhcmNoYXJncywgdXNpbmd1aWQpCi1zdHJ1Y3QgbWFpbGJveCAqbWFpbGJveDsKLXN0
cnVjdCBzZWFyY2hhcmdzICpzZWFyY2hhcmdzOwotaW50IHVzaW5ndWlkOworaW50IGluZGV4X3Nl
YXJjaChzdHJ1Y3QgbWFpbGJveCAqbWFpbGJveCwgc3RydWN0IHNlYXJjaGFyZ3MgKnNlYXJjaGFy
Z3MsCisJCSBpbnQgdXNpbmd1aWQpCiB7CiAgICAgdW5zaWduZWQgKm1zZ25vX2xpc3Q7CiAgICAg
aW50IGksIG47CisgICAgbW9kc2VxX3QgaGlnaGVzdG1vZHNlcSA9IDA7CiAKLSAgICBuID0gX2lu
ZGV4X3NlYXJjaCgmbXNnbm9fbGlzdCwgbWFpbGJveCwgc2VhcmNoYXJncyk7CisgICAgbiA9IF9p
bmRleF9zZWFyY2goJm1zZ25vX2xpc3QsIG1haWxib3gsIHNlYXJjaGFyZ3MsCisJCSAgICAgIHNl
YXJjaGFyZ3MtPm1vZHNlcSA/ICZoaWdoZXN0bW9kc2VxIDogTlVMTCk7CiAKICAgICBwcm90X3By
aW50ZihpbWFwZF9vdXQsICIqIFNFQVJDSCIpOwogCkBAIC0xMDU3LDYgKzEwNjksMTAgQEAKIAog
ICAgIGlmIChuKSBmcmVlKG1zZ25vX2xpc3QpOwogCisgICAgaWYgKGhpZ2hlc3Rtb2RzZXEpIHsK
Kwlwcm90X3ByaW50ZihpbWFwZF9vdXQsICIgKE1PRFNFUSAiIE1PRFNFUV9GTVQgIikiLCBoaWdo
ZXN0bW9kc2VxKTsKKyAgICB9CisKICAgICBwcm90X3ByaW50ZihpbWFwZF9vdXQsICJcclxuIik7
CiAKICAgICByZXR1cm4gbjsKQEAgLTEwNjUsMjIgKzEwODEsMzIgQEAKIC8qCiAgKiBQZXJmb3Jt
cyBhIFNPUlQgY29tbWFuZAogICovCi1pbnQKLWluZGV4X3NvcnQoc3RydWN0IG1haWxib3ggKm1h
aWxib3gsCi0JICAgc3RydWN0IHNvcnRjcml0ICpzb3J0Y3JpdCwKLQkgICBzdHJ1Y3Qgc2VhcmNo
YXJncyAqc2VhcmNoYXJncywKLQkgICBpbnQgdXNpbmd1aWQpCitpbnQgaW5kZXhfc29ydChzdHJ1
Y3QgbWFpbGJveCAqbWFpbGJveCwgc3RydWN0IHNvcnRjcml0ICpzb3J0Y3JpdCwKKwkgICAgICAg
c3RydWN0IHNlYXJjaGFyZ3MgKnNlYXJjaGFyZ3MsIGludCB1c2luZ3VpZCkKIHsKICAgICB1bnNp
Z25lZCAqbXNnbm9fbGlzdDsKICAgICBNc2dEYXRhICptc2dkYXRhID0gTlVMTCwgKmZyZWVtZSA9
IE5VTEw7CiAgICAgaW50IG5tc2c7CiAgICAgY2xvY2tfdCBzdGFydDsKKyAgICBtb2RzZXFfdCBo
aWdoZXN0bW9kc2VxID0gMDsKKyAgICBpbnQgaSwgbW9kc2VxID0gMDsKIAogICAgIGlmKENPTkZJ
R19USU1JTkdfVkVSQk9TRSkKIAlzdGFydCA9IGNsb2NrKCk7CiAKKyAgICBpZiAoc2VhcmNoYXJn
cy0+bW9kc2VxKSBtb2RzZXEgPSAxOworICAgIGVsc2UgeworCWZvciAoaSA9IDA7IHNvcnRjcml0
W2ldLmtleSAhPSBTT1JUX1NFUVVFTkNFOyBpKyspIHsKKwkgICAgaWYgKHNvcnRjcml0W2ldLmtl
eSA9PSBTT1JUX01PRFNFUSkgeworCQltb2RzZXEgPSAxOworCQlicmVhazsKKwkgICAgfQorCX0K
KyAgICB9CisKICAgICAvKiBTZWFyY2ggZm9yIG1lc3NhZ2VzIGJhc2VkIG9uIHRoZSBnaXZlbiBj
cml0ZXJpYSAqLwotICAgIG5tc2cgPSBfaW5kZXhfc2VhcmNoKCZtc2dub19saXN0LCBtYWlsYm94
LCBzZWFyY2hhcmdzKTsKKyAgICBubXNnID0gX2luZGV4X3NlYXJjaCgmbXNnbm9fbGlzdCwgbWFp
bGJveCwgc2VhcmNoYXJncywKKwkJCSBtb2RzZXEgPyAmaGlnaGVzdG1vZHNlcSA6IE5VTEwpOwog
CiAgICAgcHJvdF9wcmludGYoaW1hcGRfb3V0LCAiKiBTT1JUIik7CiAKQEAgLTExMTEsMTMgKzEx
MzcsMTcgQEAKIAlmcmVlKGZyZWVtZSk7CiAgICAgfQogCisgICAgaWYgKGhpZ2hlc3Rtb2RzZXEp
IHsKKwlwcm90X3ByaW50ZihpbWFwZF9vdXQsICIgKE1PRFNFUSAiIE1PRFNFUV9GTVQgIikiLCBo
aWdoZXN0bW9kc2VxKTsKKyAgICB9CisKICAgICBwcm90X3ByaW50ZihpbWFwZF9vdXQsICJcclxu
Iik7CiAKICAgICAvKiBkZWJ1ZyAqLwogICAgIGlmIChDT05GSUdfVElNSU5HX1ZFUkJPU0UpIHsK
IAlpbnQgbGVuOwogCWNoYXIgKmtleV9uYW1lc1tdID0geyAiU0VRVUVOQ0UiLCAiQVJSSVZBTCIs
ICJDQyIsICJEQVRFIiwgIkZST00iLAotCQkJICAgICAgIlNJWkUiLCAiU1VCSkVDVCIsICJUTyIs
ICJBTk5PVEFUSU9OIiB9OworCQkJICAgICAgIlNJWkUiLCAiU1VCSkVDVCIsICJUTyIsICJBTk5P
VEFUSU9OIiwgIk1PRFNFUSIgfTsKIAljaGFyIGJ1ZlsxMDI0XSA9ICIiOwogCiAJd2hpbGUgKHNv
cnRjcml0LT5rZXkgJiYgc29ydGNyaXQtPmtleSA8IFZFQ1RPUl9TSVpFKGtleV9uYW1lcykpIHsK
QEAgLTExNTMsMjQgKzExODMsMzIgQEAKICAgICB1bnNpZ25lZCAqbXNnbm9fbGlzdDsKICAgICBp
bnQgbm1zZzsKICAgICBjbG9ja190IHN0YXJ0OworICAgIG1vZHNlcV90IGhpZ2hlc3Rtb2RzZXEg
PSAwOwogCiAgICAgaWYoQ09ORklHX1RJTUlOR19WRVJCT1NFKQogCXN0YXJ0ID0gY2xvY2soKTsK
IAogICAgIC8qIFNlYXJjaCBmb3IgbWVzc2FnZXMgYmFzZWQgb24gdGhlIGdpdmVuIGNyaXRlcmlh
ICovCi0gICAgbm1zZyA9IF9pbmRleF9zZWFyY2goJm1zZ25vX2xpc3QsIG1haWxib3gsIHNlYXJj
aGFyZ3MpOworICAgIG5tc2cgPSBfaW5kZXhfc2VhcmNoKCZtc2dub19saXN0LCBtYWlsYm94LCBz
ZWFyY2hhcmdzLAorCQkJIHNlYXJjaGFyZ3MtPm1vZHNlcSA/ICZoaWdoZXN0bW9kc2VxIDogTlVM
TCk7CiAKICAgICBpZiAobm1zZykgewogCS8qIFRocmVhZCBtZXNzYWdlcyB1c2luZyBnaXZlbiBh
bGdvcml0aG0gKi8KIAkoKnRocmVhZF9hbGdzW2FsZ29yaXRobV0udGhyZWFkZXIpKG1zZ25vX2xp
c3QsIG5tc2csIHVzaW5ndWlkKTsKIAogCWZyZWUobXNnbm9fbGlzdCk7CisKKwlpZiAoaGlnaGVz
dG1vZHNlcSkgeworCSAgICBwcm90X3ByaW50ZihpbWFwZF9vdXQsICIgKE1PRFNFUSAiIE1PRFNF
UV9GTVQgIikiLCBoaWdoZXN0bW9kc2VxKTsKKwl9CiAgICAgfQogCiAgICAgLyogcHJpbnQgYW4g
ZW1wdHkgdW50YWdnZWQgcmVzcG9uc2UgKi8KICAgICBlbHNlCiAJaW5kZXhfdGhyZWFkX3ByaW50
KE5VTEwsIHVzaW5ndWlkKTsKIAorICAgIHByb3RfcHJpbnRmKGltYXBkX291dCwgIlxyXG4iKTsK
KwogICAgIGlmIChDT05GSUdfVElNSU5HX1ZFUkJPU0UpIHsKIAkvKiBkZWJ1ZyAqLwogCXN5c2xv
ZyhMT0dfREVCVUcsICJUSFJFQUQgJXMgcHJvY2Vzc2luZyB0aW1lOiAlZCBtc2cgaW4gJWYgc2Vj
IiwKQEAgLTE0MzcsNiArMTQ3NSwxMSBAQAogCXByb3RfcHJpbnRmKGltYXBkX291dCwgIiVjVU5T
RUVOICV1Iiwgc2VwY2hhciwgbnVtX3Vuc2Vlbik7CiAJc2VwY2hhciA9ICcgJzsKICAgICB9Cisg
ICAgaWYgKHN0YXR1c2l0ZW1zICYgU1RBVFVTX0hJR0hFU1RNT0RTRVEpIHsKKwlwcm90X3ByaW50
ZihpbWFwZF9vdXQsICIlY0hJR0hFU1RNT0RTRVEgIiBNT0RTRVFfRk1ULCBzZXBjaGFyLAorCQkg
ICAgbWFpbGJveC0+aGlnaGVzdG1vZHNlcSk7CisJc2VwY2hhciA9ICcgJzsKKyAgICB9CiAgICAg
cHJvdF9wcmludGYoaW1hcGRfb3V0LCAiKVxyXG4iKTsKICAgICByZXR1cm4gMDsKIH0KQEAgLTIz
NzIsNiArMjQxNSw5IEBACiAgICAgY2hhciByZXNwYnVmWzEwMF07CiAgICAgaW50IHIgPSAwOwog
CisgICAgLyogQ2hlY2sgdGhlIG1vZHNlcSBhZ2FpbnN0IGNoYW5nZWRzaW5jZSAqLworICAgIGlm
IChNT0RTRVEobXNnbm8pIDw9IGZldGNoYXJncy0+Y2hhbmdlZHNpbmNlKSByZXR1cm4gMDsKKwog
ICAgIC8qIE9wZW4gdGhlIG1lc3NhZ2UgZmlsZSBpZiB3ZSdyZSBnb2luZyB0byBuZWVkIGl0ICov
CiAgICAgaWYgKChmZXRjaGl0ZW1zICYgKEZFVENIX0hFQURFUnxGRVRDSF9URVhUfEZFVENIX1JG
QzgyMikpIHx8CiAJZmV0Y2hhcmdzLT5jYWNoZV9hdGxlYXN0ID4gQ0FDSEVfVkVSU0lPTihtc2du
bykgfHwKQEAgLTI0MjAsNiArMjQ2NiwxMSBAQAogCQkgICAgc2VwY2hhciwgZGF0ZWJ1Zik7CiAJ
c2VwY2hhciA9ICcgJzsKICAgICB9CisgICAgaWYgKGZldGNoaXRlbXMgJiBGRVRDSF9NT0RTRVEp
IHsKKwlwcm90X3ByaW50ZihpbWFwZF9vdXQsICIlY01PRFNFUSAoIiBNT0RTRVFfRk1UICIpIiwK
KwkJICAgIHNlcGNoYXIsIE1PRFNFUShtc2dubykpOworCXNlcGNoYXIgPSAnICc7CisgICAgfQog
ICAgIGlmIChmZXRjaGl0ZW1zICYgRkVUQ0hfU0laRSkgewogCXByb3RfcHJpbnRmKGltYXBkX291
dCwgIiVjUkZDODIyLlNJWkUgJXUiLCBzZXBjaGFyLCBTSVpFKG1zZ25vKSk7CiAJc2VwY2hhciA9
ICcgJzsKQEAgLTI3NTUsMjEgKzI4MDYsMzMgQEAKICAgICBpbnQgdmFsID0gKHN0b3JlYXJncy0+
b3BlcmF0aW9uID09IFNUT1JFX0FERCkgPyAxIDogMDsKICAgICBpbnQgaTsKICAgICBiaXQzMiB1
c2VyX2ZsYWdzW01BWF9VU0VSX0ZMQUdTLzMyXTsKKyAgICBjaGFyICpzZXAgPSAiIjsKICAgICAK
KyAgICAvKiBDaGVjayB0aGUgbW9kc2VxIGFnYWluc3QgdW5jaGFuZ2Vkc2luY2UgKi8KKyAgICBp
ZiAoTU9EU0VRKG1zZ25vKSA+IHN0b3JlYXJncy0+dW5jaGFuZ2Vkc2luY2UpIHJldHVybiAwOwor
CiAgICAgaWYgKHNlZW5mbGFnW21zZ25vXSA9PSB2YWwpIHJldHVybiAwOwogICAgIHNlZW5mbGFn
W21zZ25vXSA9IHZhbDsKIAotICAgIGlmIChzdG9yZWFyZ3MtPnNpbGVudCkgcmV0dXJuIDA7Ci0K
LSAgICBmb3IgKGk9MDsgaSA8IFZFQ1RPUl9TSVpFKHVzZXJfZmxhZ3MpOyBpKyspIHsKLQl1c2Vy
X2ZsYWdzW2ldID0gVVNFUl9GTEFHUyhtc2dubywgaSk7CisgICAgaWYgKCFzdG9yZWFyZ3MtPnNp
bGVudCkgeworCWZvciAoaT0wOyBpIDwgVkVDVE9SX1NJWkUodXNlcl9mbGFncyk7IGkrKykgewor
CSAgICB1c2VyX2ZsYWdzW2ldID0gVVNFUl9GTEFHUyhtc2dubywgaSk7CisJfQorCWluZGV4X2Zl
dGNoZmxhZ3MobWFpbGJveCwgbXNnbm8sIFNZU1RFTV9GTEFHUyhtc2dubyksIHVzZXJfZmxhZ3Ms
CisJCQkgTEFTVF9VUERBVEVEKG1zZ25vKSk7CisJc2VwID0gIiAiOwogICAgIH0KLSAgICBpbmRl
eF9mZXRjaGZsYWdzKG1haWxib3gsIG1zZ25vLCBTWVNURU1fRkxBR1MobXNnbm8pLCB1c2VyX2Zs
YWdzLAotCQkgICAgIExBU1RfVVBEQVRFRChtc2dubykpOwotICAgIGlmIChzdG9yZWFyZ3MtPnVz
aW5ndWlkKSB7Ci0JcHJvdF9wcmludGYoaW1hcGRfb3V0LCAiIFVJRCAldSIsIFVJRChtc2dubykp
OworICAgIGlmIChpbWFwZF9jb25kc3RvcmVfZW5hYmxlZCkgeworCXByb3RfcHJpbnRmKGltYXBk
X291dCwgIiVzTU9EU0VRICgiIE1PRFNFUV9GTVQgIikiLAorCQkgICAgc2VwLCBNT0RTRVEobXNn
bm8pKTsKKwlzZXAgPSAiICI7CisgICAgfQorICAgIGlmICgqc2VwKSB7CisJaWYgKHN0b3JlYXJn
cy0+dXNpbmd1aWQpIHsKKwkgICAgcHJvdF9wcmludGYoaW1hcGRfb3V0LCAiIFVJRCAldSIsIFVJ
RChtc2dubykpOworCX0KKwlwcm90X3ByaW50ZihpbWFwZF9vdXQsICIpXHJcbiIpOwogICAgIH0K
LSAgICBwcm90X3ByaW50ZihpbWFwZF9vdXQsICIpXHJcbiIpOwogCiAgICAgcmV0dXJuIDA7CiB9
CkBAIC0yNzkwLDE0ICsyODUzLDIwIEBACiAgICAgaW50IGZpcnN0dHJ5ID0gMTsKICAgICBpbnQg
ZGlydHkgPSAwOwogICAgIGJpdDMyIG9sZGZsYWdzOworICAgIGludCBzZXBjaGFyID0gJygnOwor
CisgICAgLyogQ2hlY2sgdGhlIG1vZHNlcSBhZ2FpbnN0IHVuY2hhbmdlZHNpbmNlICovCisgICAg
aWYgKE1PRFNFUShtc2dubykgPiBzdG9yZWFyZ3MtPnVuY2hhbmdlZHNpbmNlKSByZXR1cm4gMDsK
IAogICAgIC8qIENoYW5nZSBcU2VlbiBmbGFnICovCi0gICAgaWYgKHN0b3JlYXJncy0+b3BlcmF0
aW9uID09IFNUT1JFX1JFUExBQ0UgJiYgKG1haWxib3gtPm15cmlnaHRzJkFDTF9TRUVOKSkKKyAg
ICBpZiAoc3RvcmVhcmdzLT5vcGVyYXRpb24gPT0gU1RPUkVfUkVQTEFDRSAmJiAobWFpbGJveC0+
bXlyaWdodHMgJiBBQ0xfU0VFTikpCiAgICAgeworCWlmIChzZWVuZmxhZ1ttc2dub10gIT0gc3Rv
cmVhcmdzLT5zZWVuKSBkaXJ0eSsrOwogCXNlZW5mbGFnW21zZ25vXSA9IHN0b3JlYXJncy0+c2Vl
bjsKICAgICB9CiAgICAgZWxzZSBpZiAoc3RvcmVhcmdzLT5zZWVuKSB7CiAJaSA9IChzdG9yZWFy
Z3MtPm9wZXJhdGlvbiA9PSBTVE9SRV9BREQpID8gMSA6IDA7CisJaWYgKHNlZW5mbGFnW21zZ25v
XSAhPSBpKSBkaXJ0eSsrOwogCXNlZW5mbGFnW21zZ25vXSA9IGk7CiAgICAgfQogCkBAIC0yODQ4
LDIyICsyOTE3LDMyIEBACiAKICAgICBpZiAoc3RvcmVhcmdzLT5vcGVyYXRpb24gPT0gU1RPUkVf
UkVQTEFDRSkgewogCWlmICghKG1haWxib3gtPm15cmlnaHRzICYgQUNMX1dSSVRFKSkgeworCSAg
ICAvKiBBQ0xfREVMRVRFIGhhbmRsZWQgaW4gaW5kZXhfc3RvcmUoKSAqLworCSAgICBpZiAoKHJl
Y29yZC5zeXN0ZW1fZmxhZ3MgJiBGTEFHX0RFTEVURUQpICE9CisJCShzdG9yZWFyZ3MtPnN5c3Rl
bV9mbGFncyAmIEZMQUdfREVMRVRFRCkpIHsKKwkJZGlydHkrKzsKKwkgICAgfQogCSAgICByZWNv
cmQuc3lzdGVtX2ZsYWdzID0gKHJlY29yZC5zeXN0ZW1fZmxhZ3MmfkZMQUdfREVMRVRFRCkgfAog
CSAgICAgIChzdG9yZWFyZ3MtPnN5c3RlbV9mbGFncyZGTEFHX0RFTEVURUQpOwogCX0KIAllbHNl
IHsKIAkgICAgaWYgKCEobWFpbGJveC0+bXlyaWdodHMgJiBBQ0xfREVMRVRFTVNHKSkgeworCQlp
ZiAoKHJlY29yZC5zeXN0ZW1fZmxhZ3MgJiB+RkxBR19ERUxFVEVEKSAhPQorCQkgICAgKHN0b3Jl
YXJncy0+c3lzdGVtX2ZsYWdzICYgfkZMQUdfREVMRVRFRCkpIHsKKwkJICAgIGRpcnR5Kys7CisJ
CX0KIAkJcmVjb3JkLnN5c3RlbV9mbGFncyA9IChyZWNvcmQuc3lzdGVtX2ZsYWdzJkZMQUdfREVM
RVRFRCkgfAogCQkgIChzdG9yZWFyZ3MtPnN5c3RlbV9mbGFncyZ+RkxBR19ERUxFVEVEKTsKIAkg
ICAgfQogCSAgICBlbHNlIHsKKwkJaWYgKHJlY29yZC5zeXN0ZW1fZmxhZ3MgIT0gc3RvcmVhcmdz
LT5zeXN0ZW1fZmxhZ3MpIGRpcnR5Kys7CiAJCXJlY29yZC5zeXN0ZW1fZmxhZ3MgPSBzdG9yZWFy
Z3MtPnN5c3RlbV9mbGFnczsKIAkgICAgfQogCSAgICBmb3IgKGkgPSAwOyBpIDwgVkVDVE9SX1NJ
WkUocmVjb3JkLnVzZXJfZmxhZ3MpOyBpKyspIHsKKwkJaWYgKHJlY29yZC51c2VyX2ZsYWdzW2ld
ICE9IHN0b3JlYXJncy0+dXNlcl9mbGFnc1tpXSkgZGlydHkrKzsKIAkJcmVjb3JkLnVzZXJfZmxh
Z3NbaV0gPSBzdG9yZWFyZ3MtPnVzZXJfZmxhZ3NbaV07CiAJICAgIH0KIAl9Ci0JZGlydHkrKzsJ
CS8qIERvbid0IHRyeSB0byBiZSBjbGV2ZXIgKi8KICAgICB9CiAgICAgZWxzZSBpZiAoc3RvcmVh
cmdzLT5vcGVyYXRpb24gPT0gU1RPUkVfQUREKSB7CiAJaWYgKH5yZWNvcmQuc3lzdGVtX2ZsYWdz
ICYgc3RvcmVhcmdzLT5zeXN0ZW1fZmxhZ3MpIGRpcnR5Kys7CkBAIC0yODg2LDYgKzI5NjUsOSBA
QAogICAgIH0KIAogICAgIGlmIChkaXJ0eSkgeworCS8qIGJ1bXAgTU9EU0VRICovCisJcmVjb3Jk
Lm1vZHNlcSA9IG1haWxib3gtPmhpZ2hlc3Rtb2RzZXEgKyAxOworCiAJLyogdXBkYXRlIHRvdGFs
cyAqLwogCWlmICggKHJlY29yZC5zeXN0ZW1fZmxhZ3MgJiBGTEFHX0RFTEVURUQpICYmICEob2xk
ZmxhZ3MgJiBGTEFHX0RFTEVURUQpKQogCSAgICBtYWlsYm94LT5kZWxldGVkKys7CkBAIC0yOTIy
LDYgKzMwMDQsMTkgQEAKICAgICBpZiAoIXN0b3JlYXJncy0+c2lsZW50KSB7CiAJaW5kZXhfZmV0
Y2hmbGFncyhtYWlsYm94LCBtc2dubywgcmVjb3JkLnN5c3RlbV9mbGFncywKIAkJCSByZWNvcmQu
dXNlcl9mbGFncywgcmVjb3JkLmxhc3RfdXBkYXRlZCk7CisJc2VwY2hhciA9ICcgJzsKKyAgICB9
CisgICAgaWYgKGltYXBkX2NvbmRzdG9yZV9lbmFibGVkKSB7CisJaWYgKHNlcGNoYXIgPT0gJygn
KSB7CisJICAgIC8qIHdlIGhhdmVuJ3Qgb3V0cHV0IGEgZmV0Y2ggaXRlbSB5ZXQsIHNvIHN0YXJ0
IHRoZSByZXNwb25zZSAqLworCSAgICBwcm90X3ByaW50ZihpbWFwZF9vdXQsICIqICV1IEZFVENI
ICIsIG1zZ25vKTsKKwl9CisJcHJvdF9wcmludGYoaW1hcGRfb3V0LCAiJWNNT0RTRVEgKCIgTU9E
U0VRX0ZNVCAiKSIsCisJCSAgICBzZXBjaGFyLCByZWNvcmQubW9kc2VxKTsKKwlzZXBjaGFyID0g
JyAnOworICAgIH0KKyAgICBpZiAoc2VwY2hhciAhPSAnKCcpIHsKKwkvKiBmaW5zaCB0aGUgcmVz
cG9uc2UgaWYgd2UgaGF2ZSBvbmUgKi8KIAlpZiAoc3RvcmVhcmdzLT51c2luZ3VpZCkgewogCSAg
ICBwcm90X3ByaW50ZihpbWFwZF9vdXQsICIgVUlEICV1IiwgVUlEKG1zZ25vKSk7CiAJfQpAQCAt
Mjk3MSw2ICszMDY2LDggQEAKICAgICBpZiAoc2VhcmNoYXJncy0+c2VudGJlZm9yZSAmJiBTRU5U
REFURShtc2dubykgPiBzZWFyY2hhcmdzLT5zZW50YmVmb3JlKQogICAgICAgcmV0dXJuIDA7CiAK
KyAgICBpZiAoc2VhcmNoYXJncy0+bW9kc2VxICYmIE1PRFNFUShtc2dubykgPCBzZWFyY2hhcmdz
LT5tb2RzZXEpIHJldHVybiAwOworCiAgICAgaWYgKH5TWVNURU1fRkxBR1MobXNnbm8pICYgc2Vh
cmNoYXJncy0+c3lzdGVtX2ZsYWdzX3NldCkgcmV0dXJuIDA7CiAgICAgaWYgKFNZU1RFTV9GTEFH
Uyhtc2dubykgJiBzZWFyY2hhcmdzLT5zeXN0ZW1fZmxhZ3NfdW5zZXQpIHJldHVybiAwOwogCQpA
QCAtNDAyNSw5ICs0MTIyLDkgQEAKIC8qCiAgKiBGdW5jdGlvbiBmb3IgY29tcGFyaW5nIHR3byBp
bnRlZ2Vycy4KICAqLwotc3RhdGljIGludCBudW1jbXAoaW50IGkxLCBpbnQgaTIpCitzdGF0aWMg
aW50IG51bWNtcChtb2RzZXFfdCBuMSwgbW9kc2VxX3QgbjIpCiB7Ci0gICAgcmV0dXJuICgoaTEg
PCBpMikgPyAtMSA6IChpMSA+IGkyKSA/IDEgOiAwKTsKKyAgICByZXR1cm4gKChuMSA8IG4yKSA/
IC0xIDogKG4xID4gbjIpID8gMSA6IDApOwogfQogCiAvKgpAQCAtNDA3Miw2ICs0MTY5LDkgQEAK
IAkgICAgcmV0ID0gc3RyY21wKG1kMS0+YW5ub3RbYW5uXSwgbWQyLT5hbm5vdFthbm5dKTsKIAkg
ICAgYW5uKys7CiAJICAgIGJyZWFrOworCWNhc2UgU09SVF9NT0RTRVE6CisJICAgIHJldCA9IG51
bWNtcChNT0RTRVEobWQxLT5tc2dubyksIE1PRFNFUShtZDItPm1zZ25vKSk7CisJICAgIGJyZWFr
OwogCX0KICAgICB9IHdoaWxlICghcmV0ICYmIHNvcnRjcml0W2krK10ua2V5ICE9IFNPUlRfU0VR
VUVOQ0UpOwogCkBAIC00MzE0LDggKzQ0MTQsNiBAQAogCXByb3RfcHJpbnRmKGltYXBkX291dCwg
IiAiKTsKIAlfaW5kZXhfdGhyZWFkX3ByaW50KHRocmVhZC0+Y2hpbGQsIHVzaW5ndWlkKTsKICAg
ICB9Ci0KLSAgICBwcm90X3ByaW50ZihpbWFwZF9vdXQsICJcclxuIik7CiB9CiAKIC8qCkluZGV4
OiBpbWFwL2luZGV4LmgKPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PQpSQ1MgZmlsZTogL2Fmcy9hbmRyZXcvc3lzdGVtL2N2
cy9zcmMvY3lydXMvaW1hcC9pbmRleC5oLHYKcmV0cmlldmluZyByZXZpc2lvbiAxLjkuMi41CmRp
ZmYgLXUgLXIxLjkuMi41IGluZGV4LmgKLS0tIGltYXAvaW5kZXguaAkxNyBOb3YgMjAwNSAxNTo0
NjoyOCAtMDAwMAkxLjkuMi41CisrKyBpbWFwL2luZGV4LmgJMTQgRGVjIDIwMDUgMDI6MTk6MDAg
LTAwMDAKQEAgLTc5LDYgKzc5LDExIEBACiAjZGVmaW5lIFVTRVJfRkxBR1MobXNnbm8saSkgbnRv
aGwoKigoYml0MzIgKikoSU5ERUNfT0ZGU0VUKG1zZ25vKStPRkZTRVRfVVNFUl9GTEFHUysoKGkp
KjQpKSkpCiAjZGVmaW5lIENPTlRFTlRfTElORVMobXNnbm8pIG50b2hsKCooKGJpdDMyICopKElO
REVDX09GRlNFVChtc2dubykrT0ZGU0VUX0NPTlRFTlRfTElORVMpKSkKICNkZWZpbmUgQ0FDSEVf
VkVSU0lPTihtc2dubykgbnRvaGwoKigoYml0MzIgKikoSU5ERUNfT0ZGU0VUKG1zZ25vKStPRkZT
RVRfQ0FDSEVfVkVSU0lPTikpKQorI2lmZGVmIEhBVkVfTE9OR19MT05HX0lOVAorI2RlZmluZSBN
T0RTRVEobXNnbm8pIG50b2hsbCgqKChiaXQ2NCAqKShJTkRFQ19PRkZTRVQobXNnbm8pK09GRlNF
VF9NT0RTRVFfNjQpKSkKKyNlbHNlCisjZGVmaW5lIE1PRFNFUShtc2dubykgbnRvaGwoKigoYml0
MzIgKikoSU5ERUNfT0ZGU0VUKG1zZ25vKStPRkZTRVRfTU9EU0VRKSkpCisjZW5kaWYKIAogLyog
QWNjZXNzIGFzc2lzdGFuY2UgbWFjcm9zIGZvciBtZW1vcnktbWFwcGVkIGNhY2hlIGZpbGUgZGF0
YSAqLwogLyogQ0FDSEVfSVRFTV9CSVQzMjogQ29udmVydCB0byBob3N0IGJ5dGUgb3JkZXIgKi8K
SW5kZXg6IGltYXAvbWFpbGJveC5jCj09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KUkNTIGZpbGU6IC9hZnMvYW5kcmV3L3N5
c3RlbS9jdnMvc3JjL2N5cnVzL2ltYXAvbWFpbGJveC5jLHYKcmV0cmlldmluZyByZXZpc2lvbiAx
LjE0Ny4yLjMwCmRpZmYgLXUgLXIxLjE0Ny4yLjMwIG1haWxib3guYwotLS0gaW1hcC9tYWlsYm94
LmMJMTAgTm92IDIwMDUgMDY6MDQ6NTUgLTAwMDAJMS4xNDcuMi4zMAorKysgaW1hcC9tYWlsYm94
LmMJMTQgRGVjIDIwMDUgMDI6MTk6MDAgLTAwMDAKQEAgLTg0LDcgKzg0LDYgQEAKICNpbmNsdWRl
ICJzZWVuLmgiCiAjaW5jbHVkZSAidXRpbC5oIgogI2luY2x1ZGUgInhtYWxsb2MuaCIKLSNpbmNs
dWRlICJieXRlb3JkZXI2NC5oIgogCiBzdGF0aWMgaW50IG1haWxib3hfZG9pbmdfcmVjb25zdHJ1
Y3QgPSAwOwogI2RlZmluZSB6ZXJvbWFpbGJveChtKSB7IG1lbXNldCgmbSwgMCwgc2l6ZW9mKHN0
cnVjdCBtYWlsYm94KSk7IFwKQEAgLTg5OCw3ICs4OTcsNyBAQAogICAgIG1haWxib3gtPnJlY29y
ZF9zaXplID0KIAludG9obCgqKChiaXQzMiAqKShtYWlsYm94LT5pbmRleF9iYXNlK09GRlNFVF9S
RUNPUkRfU0laRSkpKTsKIAotICAgIGlmICgobWFpbGJveC0+c3RhcnRfb2Zmc2V0IDwgT0ZGU0VU
X0xFQUtFRF9DQUNIRStzaXplb2YoYml0MzIpKSB8fAorICAgIGlmICgobWFpbGJveC0+c3RhcnRf
b2Zmc2V0IDwgT0ZGU0VUX0hJR0hFU1RNT0RTRVErNCkgfHwKIAkobWFpbGJveC0+cmVjb3JkX3Np
emUgPCBJTkRFWF9SRUNPUkRfU0laRSkpIHsKIAlpZiAobWFpbGJveF91cGdyYWRlX2luZGV4KG1h
aWxib3gpKQogCSAgICByZXR1cm4gSU1BUF9JT0VSUk9SOwpAQCAtOTQwLDYgKzkzOSwxMyBAQAog
CW50b2hsKCooKGJpdDMyICopKG1haWxib3gtPmluZGV4X2Jhc2UrT0ZGU0VUX1BPUDNfTkVXX1VJ
REwpKSk7CiAgICAgbWFpbGJveC0+bGVha2VkX2NhY2hlX3JlY29yZHMgPQogCW50b2hsKCooKGJp
dDMyICopKG1haWxib3gtPmluZGV4X2Jhc2UrT0ZGU0VUX0xFQUtFRF9DQUNIRSkpKTsKKyNpZmRl
ZiBIQVZFX0xPTkdfTE9OR19JTlQKKyAgICBtYWlsYm94LT5oaWdoZXN0bW9kc2VxID0KKwludG9o
bGwoKigoYml0NjQgKikobWFpbGJveC0+aW5kZXhfYmFzZStPRkZTRVRfSElHSEVTVE1PRFNFUV82
NCkpKTsKKyNlbHNlCisgICAgbWFpbGJveC0+aGlnaGVzdG1vZHNlcSA9CisJbnRvaGwoKigoYml0
MzIgKikobWFpbGJveC0+aW5kZXhfYmFzZStPRkZTRVRfSElHSEVTVE1PRFNFUSkpKTsKKyNlbmRp
ZgogCiAgICAgaWYgKCFtYWlsYm94X2RvaW5nX3JlY29uc3RydWN0ICYmCiAJKG1haWxib3gtPm1p
bm9yX3ZlcnNpb24gPCBNQUlMQk9YX01JTk9SX1ZFUlNJT04pKSB7CkBAIC05ODYsOCArOTkyLDEy
IEBACiAgICAgfQogICAgIHJlY29yZC0+Y29udGVudF9saW5lcyA9IGh0b25sKCooKGJpdDMyICop
KGJ1ZitPRkZTRVRfQ09OVEVOVF9MSU5FUykpKTsKICAgICByZWNvcmQtPmNhY2hlX3ZlcnNpb24g
PSBodG9ubCgqKChiaXQzMiAqKShidWYrT0ZGU0VUX0NBQ0hFX1ZFUlNJT04pKSk7Ci0KICAgICBt
ZXNzYWdlX3V1aWRfdW5wYWNrKCZyZWNvcmQtPnV1aWQsIGJ1ZitPRkZTRVRfTUVTU0FHRV9VVUlE
KTsKKyNpZmRlZiBIQVZFX0xPTkdfTE9OR19JTlQKKyAgICByZWNvcmQtPm1vZHNlcSA9IGh0b25s
bCgqKChiaXQ2NCAqKShidWYrT0ZGU0VUX01PRFNFUV82NCkpKTsKKyNlbHNlCisgICAgcmVjb3Jk
LT5tb2RzZXEgPSBodG9ubCgqKChiaXQzMiAqKShidWYrT0ZGU0VUX01PRFNFUSkpKTsKKyNlbmRp
ZgogICAgIHJldHVybiAwOwogfQogCkBAIC0xMzAxLDggKzEzMTEsMTcgQEAKICAgICAqKChiaXQz
MiAqKShidWYrT0ZGU0VUX1BPUDNfTkVXX1VJREwpKSA9IGh0b25sKG1haWxib3gtPnBvcDNfbmV3
X3VpZGwpOwogICAgICooKGJpdDMyICopKGJ1ZitPRkZTRVRfTEVBS0VEX0NBQ0hFKSkgPQogCWh0
b25sKG1haWxib3gtPmxlYWtlZF9jYWNoZV9yZWNvcmRzKTsKKyNpZmRlZiBIQVZFX0xPTkdfTE9O
R19JTlQKKyAgICAqKChiaXQ2NCAqKShidWYrT0ZGU0VUX0hJR0hFU1RNT0RTRVFfNjQpKSA9IGh0
b25sbChtYWlsYm94LT5oaWdoZXN0bW9kc2VxKTsKKyNlbHNlCisgICAgLyogemVybyB0aGUgdW51
c2VkIDMyYml0cyAqLworICAgICooKGJpdDMyICopKGJ1ZitPRkZTRVRfSElHSEVTVE1PRFNFUV82
NCkpID0gaHRvbmwoMCk7CisgICAgKigoYml0MzIgKikoYnVmK09GRlNFVF9ISUdIRVNUTU9EU0VR
KSkgPSBodG9ubChtYWlsYm94LT5oaWdoZXN0bW9kc2VxKTsKKyNlbmRpZgorICAgICooKGJpdDMy
ICopKGJ1ZitPRkZTRVRfU1BBUkUwKSkgPSBodG9ubCgwKTsgLyogUkVTRVJWRUQgKi8KICAgICAq
KChiaXQzMiAqKShidWYrT0ZGU0VUX1NQQVJFMSkpID0gaHRvbmwoMCk7IC8qIFJFU0VSVkVEICov
CiAgICAgKigoYml0MzIgKikoYnVmK09GRlNFVF9TUEFSRTIpKSA9IGh0b25sKDApOyAvKiBSRVNF
UlZFRCAqLworICAgICooKGJpdDMyICopKGJ1ZitPRkZTRVRfU1BBUkUzKSkgPSBodG9ubCgwKTsg
LyogUkVTRVJWRUQgKi8KIAogICAgIGlmIChtYWlsYm94LT5zdGFydF9vZmZzZXQgPCBoZWFkZXJf
c2l6ZSkKIAloZWFkZXJfc2l6ZSA9IG1haWxib3gtPnN0YXJ0X29mZnNldDsKQEAgLTEzNDIsNiAr
MTM2MSwxMyBAQAogICAgICooKGJpdDMyICopKGJ1ZitPRkZTRVRfQ09OVEVOVF9MSU5FUykpID0g
aHRvbmwocmVjb3JkLT5jb250ZW50X2xpbmVzKTsKICAgICAqKChiaXQzMiAqKShidWYrT0ZGU0VU
X0NBQ0hFX1ZFUlNJT04pKSA9IGh0b25sKHJlY29yZC0+Y2FjaGVfdmVyc2lvbik7CiAgICAgbWVz
c2FnZV91dWlkX3BhY2soJnJlY29yZC0+dXVpZCwgYnVmK09GRlNFVF9NRVNTQUdFX1VVSUQpOwor
I2lmZGVmIEhBVkVfTE9OR19MT05HX0lOVAorICAgICooKGJpdDY0ICopKGJ1ZitPRkZTRVRfTU9E
U0VRXzY0KSkgPSBodG9ubGwocmVjb3JkLT5tb2RzZXEpOworI2Vsc2UKKyAgICAvKiB6ZXJvIHRo
ZSB1bnVzZWQgMzJiaXRzICovCisgICAgKigoYml0MzIgKikoYnVmK09GRlNFVF9NT0RTRVFfNjQp
KSA9IGh0b25sKDApOworICAgICooKGJpdDMyICopKGJ1ZitPRkZTRVRfTU9EU0VRKSkgPSBodG9u
bChyZWNvcmQtPm1vZHNlcSk7CisjZW5kaWYKIH0KIAogLyoKQEAgLTE1MTIsNiArMTUzOCwxNSBA
QAogCSooKGJpdDMyICopKGJ1ZitPRkZTRVRfUVVPVEFfTUFJTEJPWF9VU0VENjQpKSA9IGh0b25s
KDApOwogICAgIH0KIAorICAgIGlmIChudG9obCgqKChiaXQzMiAqKShidWYrT0ZGU0VUX01JTk9S
X1ZFUlNJT04pKSkgPCA4KSB7CisjaWZkZWYgSEFWRV9MT05HX0xPTkdfSU5UCisJKigoYml0NjQg
KikoYnVmK09GRlNFVF9ISUdIRVNUTU9EU0VRXzY0KSkgPSBodG9ubGwoMSk7CisjZWxzZQorCSoo
KGJpdDMyICopKGJ1ZitPRkZTRVRfSElHSEVTVE1PRFNFUV82NCkpID0gaHRvbmwoMCk7CisJKigo
Yml0MzIgKikoYnVmK09GRlNFVF9ISUdIRVNUTU9EU0VRKSkgPSBodG9ubCgxKTsKKyNlbmRpZgor
ICAgIH0KKwogICAgIC8qIGNoYW5nZSB2ZXJzaW9uIG51bWJlciAqLwogICAgICooKGJpdDMyICop
KGJ1ZitPRkZTRVRfTUlOT1JfVkVSU0lPTikpID0gaHRvbmwoTUFJTEJPWF9NSU5PUl9WRVJTSU9O
KTsKIApAQCAtMTU0OCwxMSArMTU4MywxNiBAQAogICAgIGlmIChvbGRzdGFydF9vZmZzZXQgPCBP
RkZTRVRfUE9QM19ORVdfVUlETC1xdW90YV9vZmZzZXQrc2l6ZW9mKGJpdDMyKSkgewogCSooKGJp
dDMyICopKGJ1ZitPRkZTRVRfUE9QM19ORVdfVUlETCkpID0gaHRvbmwoIWV4aXN0cyk7CiAgICAg
fQotICAgIGlmIChvbGRzdGFydF9vZmZzZXQgPCBPRkZTRVRfTEVBS0VEX0NBQ0hFLXF1b3RhX29m
ZnNldCtzaXplb2YoYml0MzIpKSB7Ci0JKigoYml0MzIgKikoYnVmK09GRlNFVF9MRUFLRURfQ0FD
SEUpKSA9IGh0b25sKDApOworI2lmIDAKKyAgICBpZiAob2xkc3RhcnRfb2Zmc2V0IDwgT0ZGU0VU
X0hJR0hFU1RNT0RTRVEtcXVvdGFfb2Zmc2V0K3NpemVvZihiaXQzMikgfHwKKwkhbnRvaGxsKCoo
KGJpdDY0ICopKGJ1ZitPRkZTRVRfSElHSEVTVE1PRFNFUV82NCkpKSkgeworCSooKGJpdDY0ICop
KGJ1ZitPRkZTRVRfSElHSEVTVE1PRFNFUV82NCkpID0gaHRvbmxsKDEpOwogICAgIH0KKyNlbmRp
ZgorICAgICooKGJpdDMyICopKGJ1ZitPRkZTRVRfU1BBUkUwKSkgPSBodG9ubCgwKTsgLyogUkVT
RVJWRUQgKi8KICAgICAqKChiaXQzMiAqKShidWYrT0ZGU0VUX1NQQVJFMSkpID0gaHRvbmwoMCk7
IC8qIFJFU0VSVkVEICovCiAgICAgKigoYml0MzIgKikoYnVmK09GRlNFVF9TUEFSRTIpKSA9IGh0
b25sKDApOyAvKiBSRVNFUlZFRCAqLworICAgICooKGJpdDMyICopKGJ1ZitPRkZTRVRfU1BBUkUz
KSkgPSBodG9ubCgwKTsgLyogUkVTRVJWRUQgKi8KIAogICAgIC8qIFdyaXRlIG5ldyBoZWFkZXIg
Ki8KICAgICBmd3JpdGUoYnVmLCAxLCBJTkRFWF9IRUFERVJfU0laRSwgbmV3aW5kZXgpOwpAQCAt
MTU5NSw2ICsxNjM1LDE2IEBACiAgICAgICAgICAgICBpZiAob2xkcmVjb3JkX3NpemUgPCBPRkZT
RVRfTUVTU0FHRV9VVUlEK01FU1NBR0VfVVVJRF9QQUNLRURfU0laRSkKICAgICAgICAgICAgICAg
ICBtZW1zZXQoYnVmK09GRlNFVF9NRVNTQUdFX1VVSUQsIDAsIE1FU1NBR0VfVVVJRF9QQUNLRURf
U0laRSk7CiAKKwkgICAgLyogU2V0IHRoZSBpbml0aWFsIG1vZHNlcSB0byAxICovCisJICAgIGlm
IChvbGRyZWNvcmRfc2l6ZSA8IE9GRlNFVF9NT0RTRVErNCkgeworI2lmZGVmIEhBVkVfTE9OR19M
T05HX0lOVAorCQkqKChiaXQ2NCAqKShidWYrT0ZGU0VUX01PRFNFUV82NCkpID0gaHRvbmxsKDEp
OworI2Vsc2UKKwkJKigoYml0MzIgKikoYnVmK09GRlNFVF9NT0RTRVFfNjQpKSA9IGh0b25sKDAp
OworCQkqKChiaXQzMiAqKShidWYrT0ZGU0VUX01PRFNFUSkpID0gaHRvbmwoMSk7CisjZW5kaWYK
KwkgICAgfQorCiAJICAgIGZ3cml0ZShidWYrb2xkcmVjb3JkX3NpemUsIHJlY3NpemVfZGlmZiwg
MSwgbmV3aW5kZXgpOwogCX0KICAgICB9CkBAIC0yNTcxLDYgKzI2MjEsOCBAQAogICAgIG1haWxi
b3guYW5zd2VyZWQgPSAwOwogICAgIG1haWxib3guZmxhZ2dlZCA9IDA7CiAgICAgbWFpbGJveC5w
b3AzX25ld191aWRsID0gMTsKKyAgICBtYWlsYm94LmxlYWtlZF9jYWNoZV9yZWNvcmRzID0gMDsK
KyAgICBtYWlsYm94LmhpZ2hlc3Rtb2RzZXEgPSAwOwogCiAgICAgaWYgKCF1bmlxdWVpZCkgewog
CXNpemVfdCB1bmlxdWVfc2l6ZSA9IHNpemVvZihjaGFyKSAqIDMyOwpJbmRleDogaW1hcC9tYWls
Ym94LmgKPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PQpSQ1MgZmlsZTogL2Fmcy9hbmRyZXcvc3lzdGVtL2N2cy9zcmMvY3ly
dXMvaW1hcC9tYWlsYm94LmgsdgpyZXRyaWV2aW5nIHJldmlzaW9uIDEuNzcuMi4xMQpkaWZmIC11
IC1yMS43Ny4yLjExIG1haWxib3guaAotLS0gaW1hcC9tYWlsYm94LmgJMjcgTWF5IDIwMDUgMTc6
NDA6NTQgLTAwMDAJMS43Ny4yLjExCisrKyBpbWFwL21haWxib3guaAkxNCBEZWMgMjAwNSAwMjox
OTowMCAtMDAwMApAQCAtNTAsNiArNTAsNyBAQAogI2luY2x1ZGUgImF1dGguaCIKICNpbmNsdWRl
ICJxdW90YS5oIgogI2luY2x1ZGUgIm1lc3NhZ2VfdXVpZC5oIgorI2luY2x1ZGUgImJ5dGVvcmRl
cjY0LmgiCiAKIAogI2RlZmluZSBCSVQzMl9NQVggNDI5NDk2NzI5NVUKQEAgLTY2LDYgKzY3LDEx
IEBACiAKICNpZmRlZiBIQVZFX0xPTkdfTE9OR19JTlQKIHR5cGVkZWYgdW5zaWduZWQgbG9uZyBs
b25nIGludCBiaXQ2NDsKK3R5cGVkZWYgdW5zaWduZWQgbG9uZyBsb25nIGludCBtb2RzZXFfdDsK
KyNkZWZpbmUgTU9EU0VRX0ZNVCAiJWxsdSIKKyNlbHNlIAordHlwZWRlZiB1bnNpZ25lZCBsb25n
IGludCBtb2RzZXFfdDsKKyNkZWZpbmUgTU9EU0VRX0ZNVCAiJWx1IgogI2VuZGlmCiAKICNkZWZp
bmUgTUFYX01BSUxCT1hfTkFNRSA0OTAKQEAgLTgwLDcgKzg2LDcgQEAKICNkZWZpbmUgTUFJTEJP
WF9GT1JNQVRfTk9STUFMCTAKICNkZWZpbmUgTUFJTEJPWF9GT1JNQVRfTkVUTkVXUwkxCiAKLSNk
ZWZpbmUgTUFJTEJPWF9NSU5PUl9WRVJTSU9OCTcKKyNkZWZpbmUgTUFJTEJPWF9NSU5PUl9WRVJT
SU9OCTgKICNkZWZpbmUgTUFJTEJPWF9DQUNIRV9NSU5PUl9WRVJTSU9OIDIKIAogI2RlZmluZSBG
TkFNRV9IRUFERVIgIi9jeXJ1cy5oZWFkZXIiCkBAIC0xNDYsOSArMTUyLDE3IEBACiAKICAgICBp
bnQgcG9wM19uZXdfdWlkbDsKICAgICB1bnNpZ25lZCBsb25nIGxlYWtlZF9jYWNoZV9yZWNvcmRz
OworICAgIG1vZHNlcV90IGhpZ2hlc3Rtb2RzZXE7CiAKLSAgICAvKiBmdXR1cmUgZXhwYW5zaW9u
IC0tIHdvbid0IG5lZWQgZXhwYW5kIHRoZSBoZWFkZXIgKi8KLSAgICB1bnNpZ25lZCBsb25nIHNw
YXJlc1syXTsKKyAgICAvKgorICAgICAqIGZ1dHVyZSBleHBhbnNpb24gLS0gd29uJ3QgbmVlZCBl
eHBhbmQgdGhlIGhlYWRlcgorICAgICAqCisgICAgICogSWYgdGhlIGNoYW5nZSB0byB0aGUgaW5k
ZXggaGVhZGVyIGNoYW5nZSBhbHNvIGluY2x1ZGVzIGEgY2hhbmdlCisgICAgICogdG8gdGhlIGlu
ZGV4IHJlY29yZCwgdGhlcmUgaXMgbm8gYmVuZWZpdCB0byB1c2luZyBhIHNwYXJlLiAgSW4KKyAg
ICAgKiB0aGlzIGNhc2UsIGp1c3QgYWRkIGEgbmV3IGZpZWxkLCBhbmQgb3B0aW9uYWxseSBhZGQg
c29tZSBtb3JlCisgICAgICogc3BhcmVzLgorICAgICAqLworICAgIHVuc2lnbmVkIGxvbmcgc3Bh
cmVzWzRdOwogCiAgICAgc3RydWN0IHF1b3RhIHF1b3RhOwogCkBAIC0xNzMsNiArMTg3LDcgQEAK
ICAgICB1bnNpZ25lZCBsb25nIGNvbnRlbnRfbGluZXM7CiAgICAgdW5zaWduZWQgbG9uZyBjYWNo
ZV92ZXJzaW9uOwogICAgIHN0cnVjdCBtZXNzYWdlX3V1aWQgdXVpZDsKKyAgICBtb2RzZXFfdCBt
b2RzZXE7CiB9OwogCiAvKiBPZmZzZXRzIG9mIGluZGV4L2V4cHVuZ2UgaGVhZGVyIGZpZWxkcyAq
LwpAQCAtMTkzLDggKzIwOCwxMiBAQAogI2RlZmluZSBPRkZTRVRfRkxBR0dFRCA1NgogI2RlZmlu
ZSBPRkZTRVRfUE9QM19ORVdfVUlETCA2MAkvKiBhZGRlZCBmb3IgT3V0bG9vayBzdHVwaWRpdHkg
Ki8KICNkZWZpbmUgT0ZGU0VUX0xFQUtFRF9DQUNIRSA2NCAvKiBOdW1iZXIgb2YgbGVha2VkIHJl
Y29yZHMgaW4gY2FjaGUgZmlsZSAqLwotI2RlZmluZSBPRkZTRVRfU1BBUkUxIDY4Ci0jZGVmaW5l
IE9GRlNFVF9TUEFSRTIgNzIKKyNkZWZpbmUgT0ZGU0VUX0hJR0hFU1RNT0RTRVFfNjQgNjggLyog
Q09ORFNUT1JFICg2NC1iaXQgbW9kc2VxKSAqLworI2RlZmluZSBPRkZTRVRfSElHSEVTVE1PRFNF
USA3MiAgICAvKiBDT05EU1RPUkUgKDMyLWJpdCBtb2RzZXEpICovCisjZGVmaW5lIE9GRlNFVF9T
UEFSRTAgNzYgLyogU3BhcmVzIC0gb25seSB1c2UgdGhlc2UgaWYgdGhlIGluZGV4ICovCisjZGVm
aW5lIE9GRlNFVF9TUEFSRTEgODAgLyogIHJlY29yZCBzaXplIHJlbWFpbnMgdGhlIHNhbWUgKi8K
KyNkZWZpbmUgT0ZGU0VUX1NQQVJFMiA4NCAvKiAgKHNlZSBub3RlIGFib3ZlIGFib3V0IHNwYXJl
cykgKi8KKyNkZWZpbmUgT0ZGU0VUX1NQQVJFMyA4OAogCiAvKiBPZmZzZXRzIG9mIGluZGV4X3Jl
Y29yZCBmaWVsZHMgaW4gaW5kZXgvZXhwdW5nZSBmaWxlICovCiAjZGVmaW5lIE9GRlNFVF9VSUQg
MApAQCAtMjEwLDkgKzIyOSwxMSBAQAogI2RlZmluZSBPRkZTRVRfQ09OVEVOVF9MSU5FUyAoT0ZG
U0VUX1VTRVJfRkxBR1MrTUFYX1VTRVJfRkxBR1MvOCkgLyogYWRkZWQgZm9yIG5udHBkICovCiAj
ZGVmaW5lIE9GRlNFVF9DQUNIRV9WRVJTSU9OIE9GRlNFVF9DT05URU5UX0xJTkVTK3NpemVvZihi
aXQzMikKICNkZWZpbmUgT0ZGU0VUX01FU1NBR0VfVVVJRCBPRkZTRVRfQ0FDSEVfVkVSU0lPTitz
aXplb2YoYml0MzIpCisjZGVmaW5lIE9GRlNFVF9NT0RTRVFfNjQgKE9GRlNFVF9NRVNTQUdFX1VV
SUQrTUVTU0FHRV9VVUlEX1BBQ0tFRF9TSVpFKSAvKiBDT05EU1RPUkUgKDY0LWJpdCBtb2RzZXEp
ICovCisjZGVmaW5lIE9GRlNFVF9NT0RTRVEgKE9GRlNFVF9NT0RTRVFfNjQrc2l6ZW9mKGJpdDMy
KSkgLyogQ09ORFNUT1JFICgzMi1iaXQgbW9kc2VxKSAqLwogCi0jZGVmaW5lIElOREVYX0hFQURF
Ul9TSVpFIChPRkZTRVRfU1BBUkUyK3NpemVvZihiaXQzMikpCi0jZGVmaW5lIElOREVYX1JFQ09S
RF9TSVpFIChPRkZTRVRfTUVTU0FHRV9VVUlEK01FU1NBR0VfVVVJRF9QQUNLRURfU0laRSkKKyNk
ZWZpbmUgSU5ERVhfSEVBREVSX1NJWkUgKE9GRlNFVF9TUEFSRTMrc2l6ZW9mKGJpdDMyKSkKKyNk
ZWZpbmUgSU5ERVhfUkVDT1JEX1NJWkUgKE9GRlNFVF9NT0RTRVErc2l6ZW9mKGJpdDMyKSkKIAog
LyogTnVtYmVyIG9mIGZpZWxkcyBpbiBhbiBpbmRpdmlkdWFsIG1lc3NhZ2UncyBjYWNoZSByZWNv
cmQgKi8KICNkZWZpbmUgTlVNX0NBQ0hFX0ZJRUxEUyAxMApJbmRleDogaW1hcC9tYmV4YW1pbmUu
Ywo9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09ClJDUyBmaWxlOiAvYWZzL2FuZHJldy9zeXN0ZW0vY3ZzL3NyYy9jeXJ1cy9p
bWFwL21iZXhhbWluZS5jLHYKcmV0cmlldmluZyByZXZpc2lvbiAxLjUuMi43CmRpZmYgLXUgLXIx
LjUuMi43IG1iZXhhbWluZS5jCi0tLSBpbWFwL21iZXhhbWluZS5jCTUgRGVjIDIwMDUgMTU6MDE6
MzcgLTAwMDAJMS41LjIuNworKysgaW1hcC9tYmV4YW1pbmUuYwkxNCBEZWMgMjAwNSAwMjoxOTow
MCAtMDAwMApAQCAtMTIxLDggKzEyMSw4IEBACiAvKiAgICBpZiAoZ2V0ZXVpZCgpID09IDApIGZh
dGFsKCJtdXN0IHJ1biBhcyB0aGUgQ3lydXMgdXNlciIsIEVDX1VTQUdFKTsgKi8KIAogICAgIC8q
IEVuc3VyZSB3ZSdyZSB1cC10by1kYXRlIG9uIHRoZSBpbmRleCBmaWxlIGZvcm1hdCAqLwotICAg
IGFzc2VydChJTkRFWF9IRUFERVJfU0laRSA9PSAoT0ZGU0VUX1NQQVJFMis0KSk7Ci0gICAgYXNz
ZXJ0KElOREVYX1JFQ09SRF9TSVpFID09IChPRkZTRVRfTUVTU0FHRV9VVUlEK01FU1NBR0VfVVVJ
RF9QQUNLRURfU0laRSkpOworICAgIGFzc2VydChJTkRFWF9IRUFERVJfU0laRSA9PSAoT0ZGU0VU
X1NQQVJFMys0KSk7CisgICAgYXNzZXJ0KElOREVYX1JFQ09SRF9TSVpFID09IChPRkZTRVRfTU9E
U0VRKzQpKTsKIAogICAgIHdoaWxlICgob3B0ID0gZ2V0b3B0KGFyZ2MsIGFyZ3YsICJDOnU6czoi
KSkgIT0gRU9GKSB7CiAJc3dpdGNoIChvcHQpIHsKQEAgLTI3OCw2ICsyNzgsMTAgQEAKIAlwcmlu
dGYoIiAgUE9QMyBOZXcgVUlETDogJWRcbiIsIG1haWxib3gucG9wM19uZXdfdWlkbCk7CiAgICAg
cHJpbnRmKCIgIExhc3QgUE9QMyBMb2dpbjogKCVsZCkgJXMiLCBtYWlsYm94LnBvcDNfbGFzdF9s
b2dpbiwKIAkgICBjdGltZSgmbWFpbGJveC5wb3AzX2xhc3RfbG9naW4pKTsKKyAgICBpZiAobWFp
bGJveC5taW5vcl92ZXJzaW9uID49IDgpIHsKKwlwcmludGYoIiAgSGlnaGVzdCBNb2QgU2VxdWVu
Y2U6ICIgTU9EU0VRX0ZNVCAiXG4iLAorCSAgICAgICBtYWlsYm94LmhpZ2hlc3Rtb2RzZXEpOwor
ICAgIH0KIAogICAgIHByaW50ZigiXG4gTWVzc2FnZSBJbmZvOlxuIik7CiAKQEAgLTMwOCw2ICsz
MTIsMTAgQEAKIAogCWlmIChtYWlsYm94Lm1pbm9yX3ZlcnNpb24gPj0gNikKIAkgICAgcHJpbnRm
KCIgQ0FDSEVWRVI6JS02ZCIsIENBQ0hFX1ZFUlNJT04oaSkpOworCisJaWYgKG1haWxib3gubWlu
b3JfdmVyc2lvbiA+PSA4KSB7CisJICAgIHByaW50ZigiIE1PRFNFUToiIE1PRFNFUV9GTVQsIE1P
RFNFUShpKSk7CisJfQogCiAJcHJpbnRmKCJcbiIpOwogCkluZGV4OiBpbWFwL3JlY29uc3RydWN0
LmMKPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PQpSQ1MgZmlsZTogL2Fmcy9hbmRyZXcvc3lzdGVtL2N2cy9zcmMvY3lydXMv
aW1hcC9yZWNvbnN0cnVjdC5jLHYKcmV0cmlldmluZyByZXZpc2lvbiAxLjgxLjIuMTYKZGlmZiAt
dSAtcjEuODEuMi4xNiByZWNvbnN0cnVjdC5jCi0tLSBpbWFwL3JlY29uc3RydWN0LmMJMjcgTWFy
IDIwMDUgMTQ6MzY6MjUgLTAwMDAJMS44MS4yLjE2CisrKyBpbWFwL3JlY29uc3RydWN0LmMJMTQg
RGVjIDIwMDUgMDI6MTk6MDAgLTAwMDAKQEAgLTk0LDcgKzk0LDYgQEAKICNpbmNsdWRlICJyZXRy
eS5oIgogI2luY2x1ZGUgImNvbnZlcnRfY29kZS5oIgogI2luY2x1ZGUgInV0aWwuaCIKLSNpbmNs
dWRlICJieXRlb3JkZXI2NC5oIgogCiBleHRlcm4gaW50IG9wdGluZDsKIGV4dGVybiBjaGFyICpv
cHRhcmc7CkBAIC0xMzksOCArMTM4LDggQEAKICAgICBpZiAoZ2V0ZXVpZCgpID09IDApIGZhdGFs
KCJtdXN0IHJ1biBhcyB0aGUgQ3lydXMgdXNlciIsIEVDX1VTQUdFKTsKIAogICAgIC8qIEVuc3Vy
ZSB3ZSdyZSB1cC10by1kYXRlIG9uIHRoZSBpbmRleCBmaWxlIGZvcm1hdCAqLwotICAgIGFzc2Vy
dChJTkRFWF9IRUFERVJfU0laRSA9PSAoT0ZGU0VUX1NQQVJFMis0KSk7Ci0gICAgYXNzZXJ0KElO
REVYX1JFQ09SRF9TSVpFID09IChPRkZTRVRfTUVTU0FHRV9VVUlEK01FU1NBR0VfVVVJRF9QQUNL
RURfU0laRSkpOworICAgIGFzc2VydChJTkRFWF9IRUFERVJfU0laRSA9PSAoT0ZGU0VUX1NQQVJF
Mys0KSk7CisgICAgYXNzZXJ0KElOREVYX1JFQ09SRF9TSVpFID09IChPRkZTRVRfTU9EU0VRKzQp
KTsKIAogICAgIHdoaWxlICgob3B0ID0gZ2V0b3B0KGFyZ2MsIGFyZ3YsICJDOnA6cm1meCIpKSAh
PSBFT0YpIHsKIAlzd2l0Y2ggKG9wdCkgewpAQCAtNTM2LDYgKzUzNSw3IEBACiAJLyogSWYgd2Ug
Y2FuJ3QgcmVhZCB0aGUgaW5kZXgsIGFzc3VtZSBuZXcgVUlETCBzbyB0aGF0IHN0dXBpZCBjbGll
bnRzCiAJICAgd2lsbCByZXRyaWV2ZSBhbGwgb2YgdGhlIG1lc3NhZ2VzIGluIHRoZSBtYWlsYm94
LiAqLwogCW1haWxib3gucG9wM19uZXdfdWlkbCA9IDE7CisJbWFpbGJveC5oaWdoZXN0bW9kc2Vx
ID0gMTsKICAgICB9CiAgICAgZWxzZSB7CiAJKHZvaWQpIG1haWxib3hfbG9ja19pbmRleCgmbWFp
bGJveCk7CkBAIC03MTMsNiArNzEzLDcgQEAKIAlpZiAob2xkX2luZGV4LnVpZCA9PSB1aWRbbXNn
XSkgewogCSAgICAvKiBVc2UgZGF0YSBpbiBvbGQgaW5kZXggZmlsZSwgc3ViamVjdCB0byB2YWxp
ZGl0eSBjaGVja3MgKi8KIAkgICAgbWVzc2FnZV9pbmRleC5pbnRlcm5hbGRhdGUgPSBvbGRfaW5k
ZXguaW50ZXJuYWxkYXRlOworCSAgICBtZXNzYWdlX2luZGV4Lm1vZHNlcSA9IG9sZF9pbmRleC5t
b2RzZXE7CiAJICAgIG1lc3NhZ2VfaW5kZXguc3lzdGVtX2ZsYWdzID0gb2xkX2luZGV4LnN5c3Rl
bV9mbGFncyAmCiAJICAgICAgKEZMQUdfQU5TV0VSRUR8RkxBR19GTEFHR0VEfEZMQUdfREVMRVRF
RHxGTEFHX0RSQUZUKTsKIAkgICAgZm9yIChpID0gMDsgaSA8IE1BWF9VU0VSX0ZMQUdTLzMyOyBp
KyspIHsKQEAgLTczMCw4ICs3MzEsMTMgQEAKIAkgICAgbWFpbGJveC5wb3AzX25ld191aWRsID0g
MTsKICAgICAgICAgICAgIC8qIFdpcGUgdGhlIE1lc3NhZ2UgVVVJRCAqLwogICAgICAgICAgICAg
bWVzc2FnZV91dWlkX3NldF9udWxsKCZtZXNzYWdlX2luZGV4LnV1aWQpOworCSAgICAvKiBJZiB3
ZSBhcmUgcmVjb3ZlcmluZyBhIG1lc3NhZ2UsIHJlc2V0IE1PRFNFUSAqLworCSAgICBtZXNzYWdl
X2luZGV4Lm1vZHNlcSA9IDE7CiAJfQogCW1lc3NhZ2VfaW5kZXgubGFzdF91cGRhdGVkID0gdGlt
ZSgwKTsKKwlpZiAobWVzc2FnZV9pbmRleC5tb2RzZXEgPiBtYWlsYm94LmhpZ2hlc3Rtb2RzZXEp
IHsKKwkgICAgbWFpbGJveC5oaWdoZXN0bW9kc2VxID0gbWVzc2FnZV9pbmRleC5tb2RzZXE7CisJ
fQogCQogCWlmICgoKHIgPSBtZXNzYWdlX3BhcnNlX2ZpbGUobXNnZmlsZSwgTlVMTCwgTlVMTCwg
JmJvZHkpKSAhPSAwKSB8fAogCSAgICAoKHIgPSBtZXNzYWdlX2NyZWF0ZV9yZWNvcmQoJm1haWxi
b3gsICZtZXNzYWdlX2luZGV4LCBib2R5KSkgIT0gMCkpIHsKQEAgLTc3NSw2ICs3ODEsNyBAQAog
ICAgIGlmIChtYWlsYm94LnVpZHZhbGlkaXR5ID09IDAgfHwgbWFpbGJveC51aWR2YWxpZGl0eSA+
IHRpbWUoMCkpIHsKIAltYWlsYm94LnVpZHZhbGlkaXR5ID0gdGltZSgwKTsKICAgICB9CisKICAg
ICBmcmVlKHVpZCk7CiAgICAgKigoYml0MzIgKikoYnVmK09GRlNFVF9HRU5FUkFUSU9OX05PKSkg
PSBodG9ubChtYWlsYm94LmdlbmVyYXRpb25fbm8gKyAxKTsKICAgICAqKChiaXQzMiAqKShidWYr
T0ZGU0VUX0ZPUk1BVCkpID0gaHRvbmwobWFpbGJveC5mb3JtYXQpOwpAQCAtODAxLDggKzgwOCwx
NyBAQAogICAgICooKGJpdDMyICopKGJ1ZitPRkZTRVRfRkxBR0dFRCkpID0gaHRvbmwobmV3X2Zs
YWdnZWQpOwogICAgICooKGJpdDMyICopKGJ1ZitPRkZTRVRfUE9QM19ORVdfVUlETCkpID0gaHRv
bmwobWFpbGJveC5wb3AzX25ld191aWRsKTsKICAgICAqKChiaXQzMiAqKShidWYrT0ZGU0VUX0xF
QUtFRF9DQUNIRSkpID0gaHRvbmwoMCk7Ci0KLSAgICBtZXNzYWdlX3V1aWRfcGFjaygmbWVzc2Fn
ZV9pbmRleC51dWlkLCBidWYrT0ZGU0VUX01FU1NBR0VfVVVJRCk7CisjaWZkZWYgSEFWRV9MT05H
X0xPTkdfSU5UCisgICAgKigoYml0NjQgKikoYnVmK09GRlNFVF9ISUdIRVNUTU9EU0VRXzY0KSkg
PSBodG9ubGwobWFpbGJveC5oaWdoZXN0bW9kc2VxKTsKKyNlbHNlCisgICAgLyogemVybyB0aGUg
dW51c2VkIDMyYml0cyAqLworICAgICooKGJpdDMyICopKGJ1ZitPRkZTRVRfSElHSEVTVE1PRFNF
UV82NCkpID0gaHRvbmwoMCk7CisgICAgKigoYml0MzIgKikoYnVmK09GRlNFVF9ISUdIRVNUTU9E
U0VRKSkgPSBodG9ubChtYWlsYm94LmhpZ2hlc3Rtb2RzZXEpOworI2VuZGlmCisgICAgKigoYml0
MzIgKikoYnVmK09GRlNFVF9TUEFSRTApKSA9IGh0b25sKDApOyAvKiBSRVNFUlZFRCAqLworICAg
ICooKGJpdDMyICopKGJ1ZitPRkZTRVRfU1BBUkUxKSkgPSBodG9ubCgwKTsgLyogUkVTRVJWRUQg
Ki8KKyAgICAqKChiaXQzMiAqKShidWYrT0ZGU0VUX1NQQVJFMikpID0gaHRvbmwoMCk7IC8qIFJF
U0VSVkVEICovCisgICAgKigoYml0MzIgKikoYnVmK09GRlNFVF9TUEFSRTMpKSA9IGh0b25sKDAp
OyAvKiBSRVNFUlZFRCAqLwogCiAgICAgbiA9IGZ3cml0ZShidWYsIDEsIElOREVYX0hFQURFUl9T
SVpFLCBuZXdpbmRleCk7CiAgICAgZmZsdXNoKG5ld2luZGV4KTsKSW5kZXg6IGltYXAvc3F1YXR0
ZXIuYwo9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09ClJDUyBmaWxlOiAvYWZzL2FuZHJldy9zeXN0ZW0vY3ZzL3NyYy9jeXJ1
cy9pbWFwL3NxdWF0dGVyLmMsdgpyZXRyaWV2aW5nIHJldmlzaW9uIDEuMTIuMi40CmRpZmYgLXUg
LXIxLjEyLjIuNCBzcXVhdHRlci5jCi0tLSBpbWFwL3NxdWF0dGVyLmMJMjUgTWF5IDIwMDQgMDE6
Mjg6MTMgLTAwMDAJMS4xMi4yLjQKKysrIGltYXAvc3F1YXR0ZXIuYwkxNCBEZWMgMjAwNSAwMjox
OTowMSAtMDAwMApAQCAtMTA5LDYgKzEwOSw3IEBACiBzdHJ1Y3QgcHJvdHN0cmVhbSAqaW1hcGRf
b3V0ID0gTlVMTDsKIHN0cnVjdCBhdXRoX3N0YXRlICppbWFwZF9hdXRoc3RhdGUgPSBOVUxMOwog
Y2hhciAqaW1hcGRfdXNlcmlkID0gTlVMTDsKK2ludCBpbWFwZF9jb25kc3RvcmVfZW5hYmxlZCA9
IDA7CiB2b2lkIHByaW50YXN0cmluZyhjb25zdCBjaGFyICpzIF9fYXR0cmlidXRlX18oKHVudXNl
ZCkpKQogewogICAgIGZhdGFsKCJub3QgaW1wbGVtZW50ZWQiLCBFQ19TT0ZUV0FSRSk7CkluZGV4
OiBpbWFwL3VuZXhwdW5nZS5jCj09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KUkNTIGZpbGU6IC9hZnMvYW5kcmV3L3N5c3Rl
bS9jdnMvc3JjL2N5cnVzL2ltYXAvQXR0aWMvdW5leHB1bmdlLmMsdgpyZXRyaWV2aW5nIHJldmlz
aW9uIDEuMS4yLjQKZGlmZiAtdSAtcjEuMS4yLjQgdW5leHB1bmdlLmMKLS0tIGltYXAvdW5leHB1
bmdlLmMJMyBNYXkgMjAwNSAwMTozMjoxNCAtMDAwMAkxLjEuMi40CisrKyBpbWFwL3VuZXhwdW5n
ZS5jCTE0IERlYyAyMDA1IDAyOjE5OjAxIC0wMDAwCkBAIC01Nyw3ICs1Nyw2IEBACiAjaW5jbHVk
ZSA8c2lnbmFsLmg+CiAKICNpbmNsdWRlICJhbm5vdGF0ZS5oIgotI2luY2x1ZGUgImJ5dGVvcmRl
cjY0LmgiCiAjaW5jbHVkZSAiY3lydXNkYi5oIgogI2luY2x1ZGUgImR1cGxpY2F0ZS5oIgogI2lu
Y2x1ZGUgImV4aXRjb2Rlcy5oIgpJbmRleDogaW1hcC92ZXJzaW9uLmgKPT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQpSQ1Mg
ZmlsZTogL2Fmcy9hbmRyZXcvc3lzdGVtL2N2cy9zcmMvY3lydXMvaW1hcC92ZXJzaW9uLmgsdgpy
ZXRyaWV2aW5nIHJldmlzaW9uIDEuMTI4LjIuNwpkaWZmIC11IC1yMS4xMjguMi43IHZlcnNpb24u
aAotLS0gaW1hcC92ZXJzaW9uLmgJMTMgRGVjIDIwMDUgMTk6MzY6MDkgLTAwMDAJMS4xMjguMi43
CisrKyBpbWFwL3ZlcnNpb24uaAkxNCBEZWMgMjAwNSAwMjoxOTowMSAtMDAwMApAQCAtNTgsOCAr
NTgsOCBAQAogCSJNQUlMQk9YLVJFRkVSUkFMUyBOQU1FU1BBQ0UgVUlEUExVUyBJRCAiIFwKIAki
Tk9fQVRPTUlDX1JFTkFNRSBVTlNFTEVDVCAiIFwKIAkiQ0hJTERSRU4gTVVMVElBUFBFTkQgQklO
QVJZICIgXAotCSJTT1JUIFRIUkVBRD1PUkRFUkVEU1VCSkVDVCBUSFJFQUQ9UkVGRVJFTkNFUyAi
IFwKLQkiQU5OT1RBVEVNT1JFIENBVEVOQVRFIgorCSJTT1JUIFNPUlQ9TU9EU0VRIFRIUkVBRD1P
UkRFUkVEU1VCSkVDVCBUSFJFQUQ9UkVGRVJFTkNFUyAiIFwKKwkiQU5OT1RBVEVNT1JFIENBVEVO
QVRFIENPTkRTVE9SRSIKIAogCiAvKiBWYWx1ZXMgZm9yIElEIHByb2Nlc3NpbmcgKi8K
</data>        

          </attachment>
      

    </bug>

</bugzilla>